{"version":3,"file":"excalibur.min.js","mappings":"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AAY7mC,EAGRb,iBACT,OAAO1pD,KAAKqxF,YAGH3nC,eAAWnxD,GACpByH,KAAKqxF,YAAc94F,EAGV8xD,yBACT,OAAOrqD,KAAKsxF,oBAGHjnC,uBAAmB9xD,GAC5ByH,KAAKsxF,oBAAsB/4F,EAGlBywD,iBACT,OAAOhpD,KAAKuxF,YAGHvoC,eAAWzwD,GACpByH,KAAKuxF,YAAch5F,EAGV+xD,kBACT,OAAOtqD,KAAKwxF,aAGHlnC,gBAAY/xD,GACrByH,KAAKwxF,aAAej5F,IL3hBxB,SAAY4zF,GAEV,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,qBACA,+BACA,+BACA,2BAEA,6BACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,wBACA,kCACA,kCACA,8BAEA,gCAGA,oBACA,wBACA,0BACA,oBACA,sBAGA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBAGA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cAGA,wBACA,gBACA,gBACA,gBACA,kBACA,gBACA,gBACA,4BACA,wBACA,8BACA,wBAGA,eACA,mBACA,mBACA,qBACA,oBACA,wBACA,wBACA,0BAGA,gBACA,eACA,kBAhJF,CAAYA,KAAAA,GAAI,KAsJT,MAAMuF,WAAiB,GAM5B7kF,YAAmB9R,EAAkBxC,EAAuBo5F,GAC1Dv4E,QADiB,KAAAre,IAAAA,EAAkB,KAAAxC,MAAAA,EAAuB,KAAAo5F,cAAAA,GAQvD,MAAMC,WAAiBl7C,GAK5B7pC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","sources":["webpack://ex/webpack/universalModuleDefinition","webpack://ex/../../node_modules/core-js/es/array/sort.js","webpack://ex/../../node_modules/core-js/es/object/keys.js","webpack://ex/../../node_modules/core-js/internals/a-callable.js","webpack://ex/../../node_modules/core-js/internals/an-object.js","webpack://ex/../../node_modules/core-js/internals/array-includes.js","webpack://ex/../../node_modules/core-js/internals/array-method-is-strict.js","webpack://ex/../../node_modules/core-js/internals/array-sort.js","webpack://ex/../../node_modules/core-js/internals/classof-raw.js","webpack://ex/../../node_modules/core-js/internals/classof.js","webpack://ex/../../node_modules/core-js/internals/copy-constructor-properties.js","webpack://ex/../../node_modules/core-js/internals/create-non-enumerable-property.js","webpack://ex/../../node_modules/core-js/internals/create-property-descriptor.js","webpack://ex/../../node_modules/core-js/internals/descriptors.js","webpack://ex/../../node_modules/core-js/internals/document-create-element.js","webpack://ex/../../node_modules/core-js/internals/engine-ff-version.js","webpack://ex/../../node_modules/core-js/internals/engine-is-ie-or-edge.js","webpack://ex/../../node_modules/core-js/internals/engine-user-agent.js","webpack://ex/../../node_modules/core-js/internals/engine-v8-version.js","webpack://ex/../../node_modules/core-js/internals/engine-webkit-version.js","webpack://ex/../../node_modules/core-js/internals/entry-unbind.js","webpack://ex/../../node_modules/core-js/internals/enum-bug-keys.js","webpack://ex/../../node_modules/core-js/internals/export.js","webpack://ex/../../node_modules/core-js/internals/fails.js","webpack://ex/../../node_modules/core-js/internals/function-bind-context.js","webpack://ex/../../node_modules/core-js/internals/function-name.js","webpack://ex/../../node_modules/core-js/internals/get-built-in.js","webpack://ex/../../node_modules/core-js/internals/get-method.js","webpack://ex/../../node_modules/core-js/internals/global.js","webpack://ex/../../node_modules/core-js/internals/has.js","webpack://ex/../../node_modules/core-js/internals/hidden-keys.js","webpack://ex/../../node_modules/core-js/internals/ie8-dom-define.js","webpack://ex/../../node_modules/core-js/internals/indexed-object.js","webpack://ex/../../node_modules/core-js/internals/inspect-source.js","webpack://ex/../../node_modules/core-js/internals/internal-state.js","webpack://ex/../../node_modules/core-js/internals/is-callable.js","webpack://ex/../../node_modules/core-js/internals/is-forced.js","webpack://ex/../../node_modules/core-js/internals/is-object.js","webpack://ex/../../node_modules/core-js/internals/is-pure.js","webpack://ex/../../node_modules/core-js/internals/is-symbol.js","webpack://ex/../../node_modules/core-js/internals/native-symbol.js","webpack://ex/../../node_modules/core-js/internals/native-weak-map.js","webpack://ex/../../node_modules/core-js/internals/object-define-property.js","webpack://ex/../../node_modules/core-js/internals/object-get-own-property-descriptor.js","webpack://ex/../../node_modules/core-js/internals/object-get-own-property-names.js","webpack://ex/../../node_modules/core-js/internals/object-get-own-property-symbols.js","webpack://ex/../../node_modules/core-js/internals/object-keys-internal.js","webpack://ex/../../node_modules/core-js/internals/object-keys.js","webpack://ex/../../node_modules/core-js/internals/object-property-is-enumerable.js","webpack://ex/../../node_modules/core-js/internals/ordinary-to-primitive.js","webpack://ex/../../node_modules/core-js/internals/own-keys.js","webpack://ex/../../node_modules/core-js/internals/path.js","webpack://ex/../../node_modules/core-js/internals/redefine.js","webpack://ex/../../node_modules/core-js/internals/require-object-coercible.js","webpack://ex/../../node_modules/core-js/internals/set-global.js","webpack://ex/../../node_modules/core-js/internals/shared-key.js","webpack://ex/../../node_modules/core-js/internals/shared-store.js","webpack://ex/../../node_modules/core-js/internals/shared.js","webpack://ex/../../node_modules/core-js/internals/to-absolute-index.js","webpack://ex/../../node_modules/core-js/internals/to-indexed-object.js","webpack://ex/../../node_modules/core-js/internals/to-integer.js","webpack://ex/../../node_modules/core-js/internals/to-length.js","webpack://ex/../../node_modules/core-js/internals/to-object.js","webpack://ex/../../node_modules/core-js/internals/to-primitive.js","webpack://ex/../../node_modules/core-js/internals/to-property-key.js","webpack://ex/../../node_modules/core-js/internals/to-string-tag-support.js","webpack://ex/../../node_modules/core-js/internals/to-string.js","webpack://ex/../../node_modules/core-js/internals/try-to-string.js","webpack://ex/../../node_modules/core-js/internals/uid.js","webpack://ex/../../node_modules/core-js/internals/use-symbol-as-uid.js","webpack://ex/../../node_modules/core-js/internals/well-known-symbol.js","webpack://ex/../../node_modules/core-js/modules/es.array.sort.js","webpack://ex/../../node_modules/core-js/modules/es.object.keys.js","webpack://ex/./Loader.css","webpack://ex/../../node_modules/css-loader/dist/runtime/api.js","webpack://ex/../../node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://ex/webpack/bootstrap","webpack://ex/webpack/runtime/compat get default export","webpack://ex/webpack/runtime/define property getters","webpack://ex/webpack/runtime/global","webpack://ex/webpack/runtime/hasOwnProperty shorthand","webpack://ex/webpack/runtime/make namespace object","webpack://ex/./Flags.ts","webpack://ex/./Util/Log.ts","webpack://ex/./Polyfill.ts","webpack://ex/./Id.ts","webpack://ex/./Math/Random.ts","webpack://ex/./Collision/Side.ts","webpack://ex/./Util/Util.ts","webpack://ex/./Util/Decorators.ts","webpack://ex/./Math/vector.ts","webpack://ex/./Math/matrix.ts","webpack://ex/./Color.ts","webpack://ex/./Collision/BoundingBox.ts","webpack://ex/./Graphics/Context/transform-stack.ts","webpack://ex/./Graphics/Context/state-stack.ts","webpack://ex/./Graphics/Context/shader.ts","webpack://ex/./Graphics/Context/batch.ts","webpack://ex/./Graphics/GraphicsDiagnostics.ts","webpack://ex/./Util/Pool.ts","webpack://ex/./Graphics/Context/renderer.ts","webpack://ex/./Graphics/Context/line-renderer.ts","webpack://ex/./Graphics/Context/shaders/line-vertex.glsl","webpack://ex/./Graphics/Context/shaders/line-fragment.glsl","webpack://ex/./Graphics/Context/draw-image-command.ts","webpack://ex/./Graphics/Context/webgl-util.ts","webpack://ex/./Graphics/Context/texture-loader.ts","webpack://ex/./Graphics/Context/image-renderer.ts","webpack://ex/./Graphics/Context/shaders/image-vertex.glsl","webpack://ex/./Graphics/Context/shaders/image-fragment.glsl","webpack://ex/./Graphics/Context/point-renderer.ts","webpack://ex/./Graphics/Context/shaders/point-vertex.glsl","webpack://ex/./Graphics/Context/shaders/point-fragment.glsl","webpack://ex/./Graphics/Graphic.ts","webpack://ex/./Util/Watch.ts","webpack://ex/./Graphics/Raster.ts","webpack://ex/./Graphics/Canvas.ts","webpack://ex/./Events.ts","webpack://ex/./EventDispatcher.ts","webpack://ex/./Resources/Resource.ts","webpack://ex/./Drawing/SpriteEffects.ts","webpack://ex/./Drawing/Texture.ts","webpack://ex/./Configurable.ts","webpack://ex/./Drawing/Sprite.ts","webpack://ex/./Graphics/Sprite.ts","webpack://ex/./Graphics/ImageSource.ts","webpack://ex/./Drawing/Animation.ts","webpack://ex/./Graphics/FontCommon.ts","webpack://ex/./Drawing/SpriteSheet.ts","webpack://ex/./Graphics/SpriteSheet.ts","webpack://ex/./Graphics/SpriteFont.ts","webpack://ex/./Graphics/Context/debug-text.ts","webpack://ex/./Graphics/Context/debug-font.png","webpack://ex/./Graphics/Context/ExcaliburGraphicsContextWebGL.ts","webpack://ex/./Screen.ts","webpack://ex/./Resources/Sound/AudioContext.ts","webpack://ex/./Util/WebAudio.ts","webpack://ex/./Class.ts","webpack://ex/./Util/DrawUtil.ts","webpack://ex/./Loader.ts","webpack://ex/./Loader.logo.png","webpack://ex/./Util/Detector.ts","webpack://ex/./Collision/CollisionType.ts","webpack://ex/./Collision/Physics.ts","webpack://ex/./Math/vector-view.ts","webpack://ex/./EntityComponentSystem/Component.ts","webpack://ex/./EntityComponentSystem/Components/TransformComponent.ts","webpack://ex/./EntityComponentSystem/Components/MotionComponent.ts","webpack://ex/./Collision/Group/CollisionGroup.ts","webpack://ex/./Util/Observable.ts","webpack://ex/./Collision/Detection/Pair.ts","webpack://ex/./Math/projection.ts","webpack://ex/./Collision/Detection/DynamicTree.ts","webpack://ex/./Math/ray.ts","webpack://ex/./Collision/Detection/DynamicTreeCollisionProcessor.ts","webpack://ex/./Collision/Colliders/Collider.ts","webpack://ex/./Collision/Colliders/CompositeCollider.ts","webpack://ex/./Math/line.ts","webpack://ex/./Collision/Colliders/ClosestLineJumpTable.ts","webpack://ex/./Collision/Colliders/CircleCollider.ts","webpack://ex/./Collision/Detection/CollisionContact.ts","webpack://ex/./Collision/Colliders/SeparatingAxis.ts","webpack://ex/./Collision/Colliders/CollisionJumpTable.ts","webpack://ex/./Collision/Colliders/EdgeCollider.ts","webpack://ex/./Collision/Colliders/PolygonCollider.ts","webpack://ex/./Collision/Colliders/Shape.ts","webpack://ex/./Collision/ColliderComponent.ts","webpack://ex/./Collision/BodyComponent.ts","webpack://ex/./Util/CullingBox.ts","webpack://ex/./Traits/OffscreenCulling.ts","webpack://ex/./Traits/CapturePointer.ts","webpack://ex/./EntityComponentSystem/Entity.ts","webpack://ex/./Drawing/CanvasDrawComponent.ts","webpack://ex/./Graphics/GraphicsComponent.ts","webpack://ex/./Graphics/Rectangle.ts","webpack://ex/./Graphics/Circle.ts","webpack://ex/./Actions/RotationType.ts","webpack://ex/./Util/EasingFunctions.ts","webpack://ex/./Actions/ActionQueue.ts","webpack://ex/./Actions/Action/Repeat.ts","webpack://ex/./Actions/Action/RepeatForever.ts","webpack://ex/./Actions/Action/MoveBy.ts","webpack://ex/./Actions/Action/MoveTo.ts","webpack://ex/./Actions/Action/RotateTo.ts","webpack://ex/./Actions/Action/RotateBy.ts","webpack://ex/./Actions/Action/ScaleTo.ts","webpack://ex/./Actions/Action/ScaleBy.ts","webpack://ex/./Actions/Action/CallMethod.ts","webpack://ex/./Actions/Action/EaseTo.ts","webpack://ex/./Actions/Action/Blink.ts","webpack://ex/./Actions/Action/Fade.ts","webpack://ex/./Actions/Action/Delay.ts","webpack://ex/./Actions/Action/Die.ts","webpack://ex/./Actions/Action/Follow.ts","webpack://ex/./Actions/Action/Meet.ts","webpack://ex/./Actions/ActionContext.ts","webpack://ex/./Actions/ActionsComponent.ts","webpack://ex/./Actor.ts","webpack://ex/./ScreenElement.ts","webpack://ex/./Timer.ts","webpack://ex/./Camera.ts","webpack://ex/./TileMap.ts","webpack://ex/./Util/Actors.ts","webpack://ex/./Trigger.ts","webpack://ex/./EntityComponentSystem/System.ts","webpack://ex/./EntityComponentSystem/EntityManager.ts","webpack://ex/./EntityComponentSystem/Util.ts","webpack://ex/./EntityComponentSystem/Query.ts","webpack://ex/./EntityComponentSystem/QueryManager.ts","webpack://ex/./EntityComponentSystem/SystemManager.ts","webpack://ex/./EntityComponentSystem/World.ts","webpack://ex/./Collision/Integrator.ts","webpack://ex/./Collision/MotionSystem.ts","webpack://ex/./Collision/Solver/Solver.ts","webpack://ex/./Collision/Solver/ArcadeSolver.ts","webpack://ex/./Collision/Solver/ContactConstraintPoint.ts","webpack://ex/./Collision/Solver/RealisticSolver.ts","webpack://ex/./Collision/CollisionSystem.ts","webpack://ex/./Graphics/Animation.ts","webpack://ex/./Particles.ts","webpack://ex/./Graphics/GraphicsGroup.ts","webpack://ex/./Graphics/GraphicsSystem.ts","webpack://ex/./Drawing/CanvasDrawingSystem.ts","webpack://ex/./Debug/DebugSystem.ts","webpack://ex/./Actions/ActionsSystem.ts","webpack://ex/./PostProcessing/ColorBlindCorrector.ts","webpack://ex/./Input/Keyboard.ts","webpack://ex/./Input/Pointer.ts","webpack://ex/./Input/PointerEvents.ts","webpack://ex/./Scene.ts","webpack://ex/./Debug/DebugFlags.ts","webpack://ex/./Debug/Debug.ts","webpack://ex/./Math/global-coordinates.ts","webpack://ex/./Input/Pointers.ts","webpack://ex/./Input/Gamepad.ts","webpack://ex/./Util/Browser.ts","webpack://ex/./Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","webpack://ex/./Engine.ts","webpack://ex/./Events/MediaEvents.ts","webpack://ex/./Graphics/Font.ts","webpack://ex/./Graphics/Text.ts","webpack://ex/./Label.ts","webpack://ex/./Collision/Group/CollisionGroupManager.ts","webpack://ex/./Drawing/Polygon.ts","webpack://ex/./Interfaces/AudioImplementation.ts","webpack://ex/./Interfaces/LifecycleEvents.ts","webpack://ex/./Resources/Sound/WebAudioInstance.ts","webpack://ex/./Util/Sound.ts","webpack://ex/./Resources/Sound/Sound.ts","webpack://ex/./Resources/Gif.ts","webpack://ex/./Graphics/Polygon.ts","webpack://ex/./Util/SortedList.ts","webpack://ex/./Promises.ts","webpack://ex/./index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ex\"] = factory();\n\telse\n\t\troot[\"ex\"] = factory();\n})(self, function() {\nreturn ","require('../../modules/es.array.sort');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'sort');\n","require('../../modules/es.object.keys');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.keys;\n","var isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw TypeError(tryToString(argument) + ' is not a function');\n};\n","var isObject = require('../internals/is-object');\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw TypeError(String(argument) + ' is not an object');\n};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toLength = require('../internals/to-length');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","// TODO: use something more complex like timsort?\nvar floor = Math.floor;\n\nvar mergeSort = function (array, comparefn) {\n  var length = array.length;\n  var middle = floor(length / 2);\n  return length < 8 ? insertionSort(array, comparefn) : merge(\n    mergeSort(array.slice(0, middle), comparefn),\n    mergeSort(array.slice(middle), comparefn),\n    comparefn\n  );\n};\n\nvar insertionSort = function (array, comparefn) {\n  var length = array.length;\n  var i = 1;\n  var element, j;\n\n  while (i < length) {\n    j = i;\n    element = array[i];\n    while (j && comparefn(array[j - 1], element) > 0) {\n      array[j] = array[--j];\n    }\n    if (j !== i++) array[j] = element;\n  } return array;\n};\n\nvar merge = function (left, right, comparefn) {\n  var llength = left.length;\n  var rlength = right.length;\n  var lindex = 0;\n  var rindex = 0;\n  var result = [];\n\n  while (lindex < llength || rindex < rlength) {\n    if (lindex < llength && rindex < rlength) {\n      result.push(comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]);\n    } else {\n      result.push(lindex < llength ? left[lindex++] : right[rindex++]);\n    }\n  } return result;\n};\n\nmodule.exports = mergeSort;\n","var toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n","var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n","var has = require('../internals/has');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!has(target, key)) defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","var fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nvar firefox = userAgent.match(/firefox\\/(\\d+)/i);\n\nmodule.exports = !!firefox && +firefox[1];\n","var UA = require('../internals/engine-user-agent');\n\nmodule.exports = /MSIE|Trident/.test(UA);\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  version = match[0] < 4 ? 1 : match[0] + match[1];\n} else if (userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = match[1];\n  }\n}\n\nmodule.exports = version && +version;\n","var userAgent = require('../internals/engine-user-agent');\n\nvar webkit = userAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\nmodule.exports = !!webkit && +webkit[1];\n","var global = require('../internals/global');\nvar bind = require('../internals/function-bind-context');\n\nvar call = Function.call;\n\nmodule.exports = function (CONSTRUCTOR, METHOD, length) {\n  return bind(call, global[CONSTRUCTOR].prototype[METHOD], length);\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n  options.name        - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty === typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var aCallable = require('../internals/a-callable');\n\n// optional / simple context binding\nmodule.exports = function (fn, that, length) {\n  aCallable(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 0: return function () {\n      return fn.call(that);\n    };\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar has = require('../internals/has');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = has(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n","var aCallable = require('../internals/a-callable');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return func == null ? undefined : aCallable(func);\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n","var toObject = require('../internals/to-object');\n\nvar hasOwnProperty = {}.hasOwnProperty;\n\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty.call(toObject(it), key);\n};\n","module.exports = {};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- requied for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar split = ''.split;\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split.call(it, '') : Object(it);\n} : Object;\n","var isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = Function.toString;\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString.call(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar objectHas = require('../internals/has');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = store.get;\n  var wmhas = store.has;\n  var wmset = store.set;\n  set = function (it, metadata) {\n    if (wmhas.call(store, it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    wmset.call(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget.call(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas.call(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (objectHas(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return objectHas(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return objectHas(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\nmodule.exports = function (argument) {\n  return typeof argument === 'function';\n};\n","var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","var isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it === 'object' ? it !== null : isCallable(it);\n};\n","module.exports = false;\n","var isCallable = require('../internals/is-callable');\nvar getBuiltIn = require('../internals/get-built-in');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && Object(it) instanceof $Symbol;\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\n\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol();\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(inspectSource(WeakMap));\n","var DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar has = require('../internals/has');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (has(O, P)) return createPropertyDescriptor(!propertyIsEnumerableModule.f.call(O, P), O[P]);\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","// eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n","var has = require('../internals/has');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !has(hiddenKeys, key) && has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~indexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n","var isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = fn.call(input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = fn.call(input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = fn.call(input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? keys.concat(getOwnPropertySymbols(it)) : keys;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar has = require('../internals/has');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  var name = options && options.name !== undefined ? options.name : key;\n  var state;\n  if (isCallable(value)) {\n    if (String(name).slice(0, 7) === 'Symbol(') {\n      name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n    }\n    if (!has(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n      createNonEnumerableProperty(value, 'name', name);\n    }\n    state = enforceInternalState(value);\n    if (!state.source) {\n      state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n    }\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n});\n","// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var global = require('../internals/global');\n\nmodule.exports = function (key, value) {\n  try {\n    // eslint-disable-next-line es/no-object-defineproperty -- safe\n    Object.defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.18.1',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '© 2021 Denis Pushkarev (zloirock.ru)'\n});\n","var toInteger = require('../internals/to-integer');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toInteger(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToInteger` abstract operation\n// https://tc39.es/ecma262/#sec-tointeger\nmodule.exports = function (argument) {\n  return isNaN(argument = +argument) ? 0 : (argument > 0 ? floor : ceil)(argument);\n};\n","var toInteger = require('../internals/to-integer');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toInteger(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","var isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = exoticToPrim.call(input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n","var toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : String(key);\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var classof = require('../internals/classof');\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n  return String(argument);\n};\n","module.exports = function (argument) {\n  try {\n    return String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n","var id = 0;\nvar postfix = Math.random();\n\nmodule.exports = function (key) {\n  return 'Symbol(' + String(key === undefined ? '' : key) + ')_' + (++id + postfix).toString(36);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar has = require('../internals/has');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!has(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {\n    if (NATIVE_SYMBOL && has(Symbol, name)) {\n      WellKnownSymbolsStore[name] = Symbol[name];\n    } else {\n      WellKnownSymbolsStore[name] = createWellKnownSymbol('Symbol.' + name);\n    }\n  } return WellKnownSymbolsStore[name];\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\nvar internalSort = require('../internals/array-sort');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar FF = require('../internals/engine-ff-version');\nvar IE_OR_EDGE = require('../internals/engine-is-ie-or-edge');\nvar V8 = require('../internals/engine-v8-version');\nvar WEBKIT = require('../internals/engine-webkit-version');\n\nvar test = [];\nvar nativeSort = test.sort;\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar STABLE_SORT = !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 70;\n  if (FF && FF > 3) return;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 603;\n\n  var result = '';\n  var code, chr, value, index;\n\n  // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n  for (code = 65; code < 76; code++) {\n    chr = String.fromCharCode(code);\n\n    switch (code) {\n      case 66: case 69: case 70: case 72: value = 3; break;\n      case 68: case 71: value = 4; break;\n      default: value = 2;\n    }\n\n    for (index = 0; index < 47; index++) {\n      test.push({ k: chr + index, v: value });\n    }\n  }\n\n  test.sort(function (a, b) { return b.v - a.v; });\n\n  for (index = 0; index < test.length; index++) {\n    chr = test[index].k.charAt(0);\n    if (result.charAt(result.length - 1) !== chr) result += chr;\n  }\n\n  return result !== 'DGBEFHACIJK';\n});\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (y === undefined) return -1;\n    if (x === undefined) return 1;\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    return toString(x) > toString(y) ? 1 : -1;\n  };\n};\n\n// `Array.prototype.sort` method\n// https://tc39.es/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    if (comparefn !== undefined) aCallable(comparefn);\n\n    var array = toObject(this);\n\n    if (STABLE_SORT) return comparefn === undefined ? nativeSort.call(array) : nativeSort.call(array, comparefn);\n\n    var items = [];\n    var arrayLength = toLength(array.length);\n    var itemsLength, index;\n\n    for (index = 0; index < arrayLength; index++) {\n      if (index in array) items.push(array[index]);\n    }\n\n    items = internalSort(items, getSortCompare(comparefn));\n    itemsLength = items.length;\n    index = 0;\n\n    while (index < itemsLength) array[index] = items[index++];\n    while (index < arrayLength) delete array[index++];\n\n    return array;\n  }\n});\n","var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var _i = 0; _i < this.length; _i++) {\n        var id = this[_i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i2 = 0; _i2 < modules.length; _i2++) {\n      var item = [].concat(modules[_i2]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\r\n/**\r\n * Features in preview\r\n */\r\nexport enum Experiments {\r\n  WebGL = 'use-webgl'\r\n}\r\n\r\n/**\r\n * Legacy features that will go away\r\n */\r\nexport enum Legacy {\r\n  Canvas = 'use-canvas-context',\r\n  LegacyDrawing = 'use-legacy-drawing'\r\n}\r\n\r\n/**\r\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\r\n * after which they are frozen and are read-only.\r\n *\r\n * Flags are used to enable experimental or preview features in Excalibur.\r\n */\r\nexport class Flags {\r\n  private static _FROZEN = false;\r\n  private static _FLAGS: Record<string, boolean> = {};\r\n\r\n  /**\r\n   * Freeze all flag modifications making them readonly\r\n   */\r\n  public static freeze() {\r\n    Flags._FROZEN = true;\r\n  }\r\n\r\n  /**\r\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\r\n   *\r\n   * Calling this in your game is UNSUPPORTED\r\n   * @internal\r\n   */\r\n  public static _reset() {\r\n    Flags._FROZEN = false;\r\n    Flags._FLAGS = {};\r\n  }\r\n\r\n  /**\r\n   * Turn on webgl support\r\n   */\r\n  public static useWebGL() {\r\n    Flags.enable(Experiments.WebGL);\r\n  }\r\n\r\n  public static useCanvasGraphicsContext() {\r\n    Flags.enable(Legacy.Canvas);\r\n  }\r\n\r\n  /**\r\n   * @deprecated Recommended not to use legacy drawing, going away in v0.26.0\r\n   */\r\n  public static useLegacyDrawing() {\r\n    Flags.enable(Legacy.LegacyDrawing);\r\n  }\r\n\r\n  /**\r\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static enable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be enabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = true;\r\n  }\r\n\r\n  /**\r\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static disable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be disabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = false;\r\n  }\r\n\r\n  /**\r\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\r\n   * @param flagName\r\n   */\r\n  public static isEnabled(flagName: string): boolean {\r\n    return !!Flags._FLAGS[flagName];\r\n  }\r\n\r\n  /**\r\n   * Show a list of currently known flags\r\n   */\r\n  public static show(): string[] {\r\n    return Object.keys(Flags._FLAGS);\r\n  }\r\n}\r\n","/* eslint-disable no-console */\r\n/**\r\n * Logging level that Excalibur will tag\r\n */\r\nexport enum LogLevel {\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error,\r\n  Fatal\r\n}\r\n\r\n/**\r\n * Static singleton that represents the logging facility for Excalibur.\r\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\r\n * Derive from [[Appender]] to create your own logging appenders.\r\n */\r\nexport class Logger {\r\n  private static _INSTANCE: Logger = null;\r\n  private _appenders: Appender[] = [];\r\n\r\n  constructor() {\r\n    if (Logger._INSTANCE) {\r\n      throw new Error('Logger is a singleton');\r\n    }\r\n    Logger._INSTANCE = this;\r\n    // Default console appender\r\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the default logging level. Excalibur will only log\r\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\r\n   */\r\n  public defaultLevel: LogLevel = LogLevel.Info;\r\n\r\n  /**\r\n   * Gets the current static instance of Logger\r\n   */\r\n  public static getInstance(): Logger {\r\n    if (Logger._INSTANCE == null) {\r\n      Logger._INSTANCE = new Logger();\r\n    }\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[Appender]] to the list of appenders to write to\r\n   */\r\n  public addAppender(appender: Appender): void {\r\n    this._appenders.push(appender);\r\n  }\r\n\r\n  /**\r\n   * Clears all appenders from the logger\r\n   */\r\n  public clearAppenders(): void {\r\n    this._appenders.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at a given LogLevel\r\n   * @param level  The LogLevel`to log the message at\r\n   * @param args   An array of arguments to write to an appender\r\n   */\r\n  private _log(level: LogLevel, args: any[]): void {\r\n    if (level == null) {\r\n      level = this.defaultLevel;\r\n    }\r\n\r\n    const len = this._appenders.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (level >= this.defaultLevel) {\r\n        this._appenders[i].log(level, args);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Debug]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debug(...args: any[]): void {\r\n    this._log(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Info]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public info(...args: any[]): void {\r\n    this._log(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Warn]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warn(...args: any[]): void {\r\n    this._log(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Error]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public error(...args: any[]): void {\r\n    this._log(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Fatal]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatal(...args: any[]): void {\r\n    this._log(LogLevel.Fatal, args);\r\n  }\r\n}\r\n\r\n/**\r\n * Contract for any log appender (such as console/screen)\r\n */\r\nexport interface Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  log(level: LogLevel, args: any[]): void;\r\n}\r\n\r\n/**\r\n * Console appender for browsers (i.e. `console.log`)\r\n */\r\nexport class ConsoleAppender implements Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    // Check for console support\r\n    if (!console && !console.log && console.warn && console.error) {\r\n      // todo maybe do something better than nothing\r\n      return;\r\n    }\r\n\r\n    // Create a new console args array\r\n    const consoleArgs: any[] = [];\r\n    consoleArgs.unshift.apply(consoleArgs, args);\r\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\r\n\r\n    if (level < LogLevel.Warn) {\r\n      // Call .log for Debug/Info\r\n      if (console.log.apply) {\r\n        // this is required on some older browsers that don't support apply on console.log :(\r\n        console.log.apply(console, consoleArgs);\r\n      } else {\r\n        console.log(consoleArgs.join(' '));\r\n      }\r\n    } else if (level < LogLevel.Error) {\r\n      // Call .warn for Warn\r\n      if (console.warn.apply) {\r\n        console.warn.apply(console, consoleArgs);\r\n      } else {\r\n        console.warn(consoleArgs.join(' '));\r\n      }\r\n    } else {\r\n      // Call .error for Error/Fatal\r\n      if (console.error.apply) {\r\n        console.error.apply(console, consoleArgs);\r\n      } else {\r\n        console.error(consoleArgs.join(' '));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * On-screen (canvas) appender\r\n */\r\nexport class ScreenAppender implements Appender {\r\n  // @todo Clean this up\r\n\r\n  private _messages: string[] = [];\r\n  private _canvas: HTMLCanvasElement;\r\n  private _ctx: CanvasRenderingContext2D;\r\n\r\n  /**\r\n   * @param width   Width of the screen appender in pixels\r\n   * @param height  Height of the screen appender in pixels\r\n   */\r\n  constructor(width?: number, height?: number) {\r\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    this._canvas.width = width || window.innerWidth;\r\n    this._canvas.height = height || window.innerHeight;\r\n    this._canvas.style.position = 'absolute';\r\n    // eslint-disable-next-line\r\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\r\n    document.body.appendChild(this._canvas);\r\n  }\r\n\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    const message = args.join(',');\r\n\r\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\r\n\r\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\r\n\r\n    let pos = 10;\r\n    let opacity = 1.0;\r\n    for (let i = 0; i < this._messages.length; i++) {\r\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\r\n      this._ctx.fillText(this._messages[i], 200, pos);\r\n      pos += 10;\r\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\r\n    }\r\n  }\r\n}\r\n","import 'core-js/es/array/sort';\r\nimport 'core-js/es/object/keys';\r\n\r\n/**\r\n * Polyfill adding function\r\n */\r\nexport function polyfill() {\r\n  /* istanbul ignore next */\r\n  if (typeof window === 'undefined') {\r\n    window = <any>{\r\n      audioContext: function () {\r\n        return;\r\n      }\r\n    };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\r\n    (<any>window).requestAnimationFrame =\r\n      (<any>window).webkitRequestAnimationFrame ||\r\n      (<any>window).mozRequestAnimationFrame ||\r\n      function (callback: Function) {\r\n        window.setInterval(callback, 1000 / 60);\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\r\n    (<any>window).cancelAnimationFrame =\r\n      (<any>window).webkitCancelAnimationFrame ||\r\n      (<any>window).mozCancelAnimationFrame ||\r\n      function () {\r\n        return;\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\r\n    if ((<any>window).webkitAudioContext) {\r\n      const ctx = (<any>window).webkitAudioContext;\r\n      const replaceMe = ctx.prototype.decodeAudioData;\r\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\r\n        return new Promise((resolve, reject) => {\r\n          replaceMe.call(this, arrayBuffer, resolve, reject);\r\n        });\r\n      };\r\n    }\r\n\r\n    (<any>window).AudioContext =\r\n      (<any>window).AudioContext ||\r\n      (<any>window).webkitAudioContext ||\r\n      (<any>window).mozAudioContext ||\r\n      (<any>window).msAudioContext ||\r\n      (<any>window).oAudioContext;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\r\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\r\n  }\r\n}\r\n","export type Id<T extends string> = {\r\n  type: T,\r\n  value: number\r\n};\r\n\r\n/**\r\n *\r\n */\r\nexport function createId<T extends string>(type: T, value: number): Id<T> {\r\n  return { type, value };\r\n};\r\n","/**\r\n * @module\r\n * Pseudo-Random Utility\r\n *\r\n * A pseudo-random utility to add seeded random support for help in\r\n * generating things like terrain or reproducible randomness. Uses the\r\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\r\n */\r\n\r\n/**\r\n * 32-bit mask\r\n */\r\nconst BITMASK32: number = 0xffffffff;\r\n\r\n/**\r\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\r\n * of numbers each time it is called.\r\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\r\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\r\n *\r\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\r\n */\r\nexport class Random {\r\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\r\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\r\n  private _upperMask: number = 0x80000000; // 34 high bits\r\n\r\n  // Word size, 64 bits\r\n  private _w: number = 32;\r\n\r\n  // Degree of recurrence\r\n  private _n: number = 624;\r\n\r\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\r\n  private _m: number = 397;\r\n  // coefficients of teh rational normal form twist matrix\r\n  private _a: number = 0x9908b0df;\r\n\r\n  // tempering bit shifts and masks\r\n  private _u: number = 11;\r\n  private _s: number = 7;\r\n  private _b: number = 0x9d2c5680;\r\n  private _t: number = 15;\r\n  private _c: number = 0xefc60000;\r\n  private _l: number = 18;\r\n  private _f: number = 1812433253;\r\n\r\n  private _mt: number[];\r\n\r\n  private _index: number;\r\n\r\n  /**\r\n   * If no seed is specified, the Date.now() is used\r\n   */\r\n  constructor(public seed?: number) {\r\n    this._mt = new Array<number>(this._n);\r\n    // need to mask to support higher bit machines\r\n    this._mt[0] = (seed || Date.now()) >>> 0;\r\n\r\n    for (let i = 1; i < this._n; i++) {\r\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\r\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\r\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\r\n    }\r\n    this._index = this._n;\r\n  }\r\n\r\n  /**\r\n   * Apply the twist\r\n   */\r\n  private _twist(): void {\r\n    const mag01 = [0x0, this._a];\r\n    let y = 0,\r\n      i = 0;\r\n    for (; i < this._n - this._m; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    for (; i < this._n - 1; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\r\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n\r\n    this._index = 0;\r\n  }\r\n\r\n  /**\r\n   * Return next 32 bit integer number in sequence\r\n   */\r\n  public nextInt(): number {\r\n    if (this._index >= this._n) {\r\n      this._twist();\r\n    }\r\n\r\n    let y = this._mt[this._index++];\r\n\r\n    y ^= y >>> this._u;\r\n    y ^= (y << this._s) & this._b;\r\n    y ^= (y << this._t) & this._c;\r\n    y ^= y >>> this._l;\r\n\r\n    return y >>> 0;\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point number between [0, 1)\r\n   */\r\n  public next(): number {\r\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point in range [min, max) min is included, max is not included\r\n   */\r\n  public floating(min: number, max: number): number {\r\n    return (max - min) * this.next() + min;\r\n  }\r\n\r\n  /**\r\n   * Return a random integer in range [min, max] min is included, max is included.\r\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\r\n   */\r\n  public integer(min: number, max: number): number {\r\n    return Math.floor((max - min + 1) * this.next() + min);\r\n  }\r\n\r\n  /**\r\n   * Returns true or false randomly with 50/50 odds by default.\r\n   * By default the likelihood of returning a true is .5 (50%).\r\n   * @param likelihood takes values between [0, 1]\r\n   */\r\n  public bool(likelihood: number = 0.5): boolean {\r\n    return this.next() <= likelihood;\r\n  }\r\n\r\n  /**\r\n   * Returns one element from an array at random\r\n   */\r\n  public pickOne<T>(array: Array<T>): T {\r\n    return array[this.integer(0, array.length - 1)];\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original\r\n   * @param array Original array to pick from\r\n   * @param numPicks can be any positive number\r\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\r\n   * just that it is possible)\r\n   */\r\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\r\n    if (allowDuplicates) {\r\n      return this._pickSetWithDuplicates(array, numPicks);\r\n    } else {\r\n      return this._pickSetWithoutDuplicates(array, numPicks);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new array randomly picking elements in the original (not reused)\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks must be less than or equal to the number of elements in the array.\r\n   */\r\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    if (numPicks > array.length || numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\r\n    }\r\n    if (numPicks === array.length) {\r\n      return array;\r\n    }\r\n\r\n    const result: Array<T> = new Array<T>(numPicks);\r\n    let currentPick = 0;\r\n    const tempArray = array.slice(0);\r\n    while (currentPick < numPicks) {\r\n      const index = this.integer(0, tempArray.length - 1);\r\n      result[currentPick++] = tempArray[index];\r\n      tempArray.splice(index, 1);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original allowing duplicates\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks can be any positive number\r\n   */\r\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\r\n    if (numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\r\n    }\r\n    const result = new Array<T>(numPicks);\r\n    for (let i = 0; i < numPicks; i++) {\r\n      result[i] = this.pickOne(array);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\r\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\n   */\r\n  public shuffle<T>(array: Array<T>): Array<T> {\r\n    const tempArray = array.slice(0);\r\n    let swap: T = null;\r\n    for (let i = 0; i < tempArray.length - 2; i++) {\r\n      const randomIndex = this.integer(i, tempArray.length - 1);\r\n      swap = tempArray[i];\r\n      tempArray[i] = tempArray[randomIndex];\r\n      tempArray[randomIndex] = swap;\r\n    }\r\n\r\n    return tempArray;\r\n  }\r\n\r\n  /**\r\n   * Generate a list of random integer numbers\r\n   * @param length the length of the final array\r\n   * @param min the minimum integer number to generate inclusive\r\n   * @param max the maximum integer number to generate inclusive\r\n   */\r\n  public range(length: number, min: number, max: number): Array<number> {\r\n    const result: Array<number> = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n      result[i] = this.integer(min, max);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d4 dice roll\r\n   */\r\n  public d4() {\r\n    return this.integer(1, 4);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d6 dice roll\r\n   */\r\n  public d6() {\r\n    return this.integer(1, 6);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d8 dice roll\r\n   */\r\n  public d8() {\r\n    return this.integer(1, 8);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d10 dice roll\r\n   */\r\n  public d10() {\r\n    return this.integer(1, 10);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d12 dice roll\r\n   */\r\n  public d12() {\r\n    return this.integer(1, 12);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d20 dice roll\r\n   */\r\n  public d20() {\r\n    return this.integer(1, 20);\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * An enum that describes the sides of an axis aligned box for collision\r\n */\r\nexport enum Side {\r\n  None = 'None',\r\n  Top = 'Top',\r\n  Bottom = 'Bottom',\r\n  Left = 'Left',\r\n  Right = 'Right'\r\n}\r\n\r\nexport module Side {\r\n  /**\r\n   * Returns the opposite side from the current\r\n   */\r\n  export function getOpposite(side: Side): Side {\r\n    if (side === Side.Top) {\r\n      return Side.Bottom;\r\n    }\r\n    if (side === Side.Bottom) {\r\n      return Side.Top;\r\n    }\r\n    if (side === Side.Left) {\r\n      return Side.Right;\r\n    }\r\n    if (side === Side.Right) {\r\n      return Side.Left;\r\n    }\r\n\r\n    return Side.None;\r\n  }\r\n\r\n  /**\r\n   * Given a vector, return the Side most in that direction (via dot product)\r\n   */\r\n  export function fromDirection(direction: Vector): Side {\r\n    const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n    const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n    let max = -Number.MAX_VALUE;\r\n    let maxIndex = -1;\r\n    for (let i = 0; i < directions.length; i++) {\r\n      if (directions[i].dot(direction) > max) {\r\n        max = directions[i].dot(direction);\r\n        maxIndex = i;\r\n      }\r\n    }\r\n    return directionEnum[maxIndex];\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Random } from '../Math/Random';\r\nimport { Side } from '../Collision/Side';\r\n\r\n/**\r\n * Two PI constant\r\n */\r\nexport const TwoPI: number = Math.PI * 2;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param deep Whether or not to do a deep clone\r\n * @param target The target object to attach properties on\r\n * @param objects The objects whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend(deep: boolean, target: any, ...objects: any[]): any;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param object2 The second object whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend<T1, T2>(target: T1, object2: T2): T1 & T2;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param object2 The second object whose properties to merge\r\n * @param object3 The third object whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend<T1, T2, T3>(target: T1, object2: T2, object3: T3): T1 & T2 & T3;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param objects The objects whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend(target: any, ...objects: any[]): any;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @returns Merged object with properties from other objects\r\n * @credit https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\r\n */\r\nexport function extend() {\r\n  const extended: { [key: string]: any } = {};\r\n  let deep = false;\r\n  let i = 0;\r\n  const length = arguments.length;\r\n\r\n  // Check if a deep merge\r\n  if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\r\n    deep = arguments[0];\r\n    i++;\r\n  }\r\n\r\n  // Merge the object into the extended object\r\n  const assignExists = typeof (<any>Object).assign === 'function';\r\n  let merge = null;\r\n  if (!assignExists) {\r\n    merge = function (obj: any) {\r\n      for (const prop in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\r\n          // If deep merge and property is an object, merge properties\r\n          if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\r\n            extended[prop] = extend(true, extended[prop], obj[prop]);\r\n          } else {\r\n            extended[prop] = obj[prop];\r\n          }\r\n        }\r\n      }\r\n    };\r\n  } else {\r\n    merge = (<any>Object).assign;\r\n  }\r\n\r\n  // Loop through each object and conduct a merge\r\n  for (; i < length; i++) {\r\n    const obj = arguments[i];\r\n    if (!assignExists) {\r\n      merge(obj);\r\n    } else {\r\n      merge(extended, obj);\r\n    }\r\n  }\r\n\r\n  return extended;\r\n}\r\n\r\n/**\r\n * Encode a string in base64\r\n * @deprecated This will be removed in v0.26.0\r\n */\r\nexport function base64Encode(inputStr: string) {\r\n  const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\n  let outputStr = '';\r\n  let i = 0;\r\n\r\n  while (i < inputStr.length) {\r\n    //all three \"& 0xff\" added below are there to fix a known bug\r\n    //with bytes returned by xhr.responseText\r\n    const byte1 = inputStr.charCodeAt(i++) & 0xff;\r\n    const byte2 = inputStr.charCodeAt(i++) & 0xff;\r\n    const byte3 = inputStr.charCodeAt(i++) & 0xff;\r\n\r\n    const enc1 = byte1 >> 2;\r\n    const enc2 = ((byte1 & 3) << 4) | (byte2 >> 4);\r\n\r\n    let enc3, enc4;\r\n    if (isNaN(byte2)) {\r\n      enc3 = enc4 = 64;\r\n    } else {\r\n      enc3 = ((byte2 & 15) << 2) | (byte3 >> 6);\r\n      if (isNaN(byte3)) {\r\n        enc4 = 64;\r\n      } else {\r\n        enc4 = byte3 & 63;\r\n      }\r\n    }\r\n\r\n    outputStr += b64.charAt(enc1) + b64.charAt(enc2) + b64.charAt(enc3) + b64.charAt(enc4);\r\n  }\r\n\r\n  return outputStr;\r\n}\r\n\r\n/**\r\n * Sugar that will use `nullishVal` if it's not null or undefined. Simulates the `??` operator\r\n * @param nullishVal\r\n * @param defaultVal\r\n */\r\nexport function nullish<T>(nullishVal: T | undefined | null, defaultVal: T): T {\r\n  return nullishVal !== null && nullishVal !== undefined ? nullishVal : defaultVal;\r\n}\r\n\r\n/**\r\n * Clamps a value between a min and max inclusive\r\n */\r\nexport function clamp(val: number, min: number, max: number) {\r\n  return Math.min(Math.max(min, val), max);\r\n}\r\n\r\n/**\r\n * Find a random floating point number in range\r\n */\r\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\r\n}\r\n\r\n/**\r\n * Find a random integer in a range\r\n */\r\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\r\n}\r\n\r\n/**\r\n * Convert an angle to be the equivalent in the range [0, 2PI]\r\n */\r\nexport function canonicalizeAngle(angle: number): number {\r\n  let tmpAngle = angle;\r\n  if (angle > TwoPI) {\r\n    while (tmpAngle > TwoPI) {\r\n      tmpAngle -= TwoPI;\r\n    }\r\n  }\r\n\r\n  if (angle < 0) {\r\n    while (tmpAngle < 0) {\r\n      tmpAngle += TwoPI;\r\n    }\r\n  }\r\n  return tmpAngle;\r\n}\r\n\r\n/**\r\n * Convert radians to degrees\r\n */\r\nexport function toDegrees(radians: number): number {\r\n  return (180 / Math.PI) * radians;\r\n}\r\n\r\n/**\r\n * Convert degrees to radians\r\n */\r\nexport function toRadians(degrees: number): number {\r\n  return (degrees / 180) * Math.PI;\r\n}\r\n\r\n/**\r\n * Find the screen position of an HTML element\r\n */\r\nexport function getPosition(el: HTMLElement): Vector {\r\n  let oLeft: number = 0,\r\n    oTop: number = 0;\r\n\r\n  const calcOffsetLeft = (parent: HTMLElement) => {\r\n    oLeft += parent.offsetLeft;\r\n\r\n    if (parent.offsetParent) {\r\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n  const calcOffsetTop = (parent: HTMLElement) => {\r\n    oTop += parent.offsetTop;\r\n    if (parent.offsetParent) {\r\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n\r\n  calcOffsetLeft(el);\r\n  calcOffsetTop(el);\r\n\r\n  return new Vector(oLeft, oTop);\r\n}\r\n\r\n/**\r\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\r\n  if (array.indexOf(item) === -1) {\r\n    array.push(item);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Remove an item from an list\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\r\n  let index = -1;\r\n  if ((index = array.indexOf(item)) > -1) {\r\n    array.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * See if an array contains something\r\n */\r\nexport function contains(array: Array<any>, obj: any): boolean {\r\n  for (let i = 0; i < array.length; i++) {\r\n    if (array[i] === obj) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Get the opposit side\r\n * TODO: Move to Side type\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function getOppositeSide(side: Side) {\r\n  if (side === Side.Top) {\r\n    return Side.Bottom;\r\n  }\r\n  if (side === Side.Bottom) {\r\n    return Side.Top;\r\n  }\r\n  if (side === Side.Left) {\r\n    return Side.Right;\r\n  }\r\n  if (side === Side.Right) {\r\n    return Side.Left;\r\n  }\r\n\r\n  return Side.None;\r\n}\r\n\r\n/**\r\n * Returns the side in the direction of the vector supplied\r\n * @param direction Vector to check\r\n * @deprecated\r\n * TODO: Move to Side type\r\n */\r\nexport function getSideFromDirection(direction: Vector) {\r\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n  let max = -Number.MAX_VALUE;\r\n  let maxIndex = -1;\r\n  for (let i = 0; i < directions.length; i++) {\r\n    if (directions[i].dot(direction) > max) {\r\n      max = directions[i].dot(direction);\r\n      maxIndex = i;\r\n    }\r\n  }\r\n  return directionEnum[maxIndex];\r\n}\r\n\r\n/**\r\n * Excalibur's dynamically resizing collection\r\n * @deprecated Will be removed v0.26.0\r\n */\r\nexport class Collection<T> {\r\n  /**\r\n   * Default collection size\r\n   */\r\n  public static DefaultSize = 200;\r\n  private _internalArray: T[] = null;\r\n  private _endPointer: number = 0;\r\n\r\n  /**\r\n   * @param initialSize  Initial size of the internal backing array\r\n   */\r\n  constructor(initialSize: number = Collection.DefaultSize) {\r\n    this._internalArray = new Array<T>(initialSize);\r\n  }\r\n\r\n  private _resize() {\r\n    const newSize = this._internalArray.length * 2;\r\n    const newArray = new Array<T>(newSize);\r\n    const count = this.count();\r\n    for (let i = 0; i < count; i++) {\r\n      newArray[i] = this._internalArray[i];\r\n    }\r\n\r\n    delete this._internalArray;\r\n    this._internalArray = newArray;\r\n  }\r\n\r\n  /**\r\n   * Push elements to the end of the collection\r\n   */\r\n  public push(element: T): T {\r\n    if (this._endPointer === this._internalArray.length) {\r\n      this._resize();\r\n    }\r\n    return (this._internalArray[this._endPointer++] = element);\r\n  }\r\n\r\n  /**\r\n   * Removes elements from the end of the collection\r\n   */\r\n  public pop(): T {\r\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\r\n    return this._internalArray[this._endPointer];\r\n  }\r\n\r\n  /**\r\n   * Returns the count of the collection\r\n   */\r\n  public count(): number {\r\n    return this._endPointer;\r\n  }\r\n\r\n  /**\r\n   * Empties the collection\r\n   */\r\n  public clear() {\r\n    this._endPointer = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the size of the internal backing array\r\n   */\r\n  public internalSize(): number {\r\n    return this._internalArray.length;\r\n  }\r\n\r\n  /**\r\n   * Returns an element at a specific index\r\n   * @param index  Index of element to retrieve\r\n   */\r\n  public elementAt(index: number): T {\r\n    if (index >= this.count()) {\r\n      //Logger.getInstance().error('Invalid parameter: ' + index);\r\n      throw new Error('Invalid index ' + index);\r\n    }\r\n    return this._internalArray[index];\r\n  }\r\n\r\n  /**\r\n   * Inserts an element at a specific index\r\n   * @param index  Index to insert the element\r\n   * @param value  Element to insert\r\n   */\r\n  public insert(index: number, value: T): T {\r\n    if (index >= this.count()) {\r\n      this._resize();\r\n    }\r\n    return (this._internalArray[index] = value);\r\n  }\r\n\r\n  /**\r\n   * Removes an element at a specific index\r\n   * @param index  Index of element to remove\r\n   */\r\n  public remove(index: number): T {\r\n    const count = this.count();\r\n    if (count === 0) {\r\n      //Logger.getInstance().error('Invalid parameter: ' + index);\r\n      throw new Error('Invalid parameter ' + index);\r\n    }\r\n    // O(n) Shift\r\n    const removed = this._internalArray[index];\r\n    for (let i = index; i < count; i++) {\r\n      this._internalArray[i] = this._internalArray[i + 1];\r\n    }\r\n    this._endPointer--;\r\n    return removed;\r\n  }\r\n\r\n  /**\r\n   * Removes an element by reference\r\n   * @param element  Element to retrieve\r\n   */\r\n  public removeElement(element: T) {\r\n    const index = this._internalArray.indexOf(element);\r\n    this.remove(index);\r\n  }\r\n\r\n  /**\r\n   * Returns a array representing the collection\r\n   */\r\n  public toArray(): T[] {\r\n    return this._internalArray.slice(0, this._endPointer);\r\n  }\r\n\r\n  /**\r\n   * Iterate over every element in the collection\r\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\r\n   */\r\n  public forEach(func: (element: T, index: number) => any) {\r\n    let i = 0;\r\n    const count = this.count();\r\n    for (i; i < count; i++) {\r\n      func.call(this, this._internalArray[i], i);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mutate every element in the collection\r\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\r\n   * the collection\r\n   */\r\n  public map(func: (element: T, index: number) => any) {\r\n    const count = this.count();\r\n    for (let i = 0; i < count; i++) {\r\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Used for exhaustive checks at compile time\r\n */\r\nexport function fail(message: never): never {\r\n  throw new Error(message);\r\n}\r\n\r\n/**\r\n * Generate a range of numbers\r\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\r\n * @param from inclusive\r\n * @param to inclusive\r\n */\r\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\r\n\r\n/**\r\n * Create a promise that resolves after a certain number of milliseconds\r\n * @param milliseconds\r\n */\r\nexport function delay(milliseconds: number): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    setTimeout(() => {\r\n      resolve();\r\n    }, milliseconds);\r\n  });\r\n}\r\n","import { Flags } from '../Flags';\r\nimport { Logger } from './Log';\r\nimport { extend } from './Util';\r\n\r\n/**\r\n * Obsolete decorator options\r\n */\r\nexport interface ObsoleteOptions {\r\n  // Optionally specify a custom message\r\n  message?: string;\r\n  // Optionally indicate that an alternate method to the obsolete one exists\r\n  alternateMethod?: string;\r\n  // Optional show stack trace, by default off\r\n  showStackTrace?: boolean;\r\n}\r\n\r\nexport const maxMessages = 5;\r\nconst obsoleteMessage: { [messageCount: string]: number } = {};\r\nexport const resetObsoleteCounter = () => {\r\n  for (const message in obsoleteMessage) {\r\n    obsoleteMessage[message] = 0;\r\n  }\r\n};\r\n\r\nconst logMessage = (message: string, options: ObsoleteOptions) => {\r\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\r\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\r\n    Logger.getInstance().warn(message);\r\n\r\n    // tslint:disable-next-line: no-console\r\n    if (console.trace && options.showStackTrace) {\r\n      // tslint:disable-next-line: no-console\r\n      console.trace();\r\n    }\r\n  }\r\n  obsoleteMessage[message]++;\r\n};\r\n\r\n/**\r\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\r\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\r\n */\r\nexport function obsolete(options?: ObsoleteOptions): any {\r\n  options = extend(\r\n    {},\r\n    {\r\n      message: 'This feature will be removed in future versions of Excalibur.',\r\n      alternateMethod: null,\r\n      showStackTrack: false\r\n    },\r\n    options\r\n  );\r\n\r\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\r\n    if (\r\n      descriptor &&\r\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\r\n    ) {\r\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\r\n    }\r\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\r\n\r\n    const message =\r\n      `${methodSignature} is marked obsolete: ${options.message}` +\r\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\r\n\r\n    if (!obsoleteMessage[message]) {\r\n      obsoleteMessage[message] = 0;\r\n    }\r\n\r\n    // If descriptor is null it is a class\r\n    const method = descriptor ? { ...descriptor } : target;\r\n    if (!descriptor) {\r\n      // with es2015 classes we need to change our decoration tactic\r\n      class DecoratedClass extends method {\r\n        constructor(...args: any) {\r\n          logMessage(message, options);\r\n          super(...args);\r\n        }\r\n      }\r\n      return DecoratedClass;\r\n    }\r\n\r\n    if (descriptor && descriptor.value) {\r\n      method.value = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.value.apply(this, arguments);\r\n      };\r\n      return method;\r\n    }\r\n\r\n    if (descriptor && descriptor.get) {\r\n      method.get = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.get.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    if (descriptor && descriptor.set) {\r\n      method.set = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.set.apply(this, arguments);\r\n      };\r\n    }\r\n    return method;\r\n  };\r\n}\r\n","import { Clonable } from '../Interfaces/Clonable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * A 2D vector on a plane.\r\n */\r\n\r\nexport class Vector implements Clonable<Vector> {\r\n  /**\r\n   * A (0, 0) vector\r\n   */\r\n  public static get Zero() {\r\n    return new Vector(0, 0);\r\n  }\r\n\r\n  /**\r\n   * A (1, 1) vector\r\n   */\r\n  public static get One() {\r\n    return new Vector(1, 1);\r\n  }\r\n\r\n  /**\r\n   * A (0.5, 0.5) vector\r\n   */\r\n  public static get Half() {\r\n    return new Vector(0.5, 0.5);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing up (0, -1)\r\n   */\r\n  public static get Up() {\r\n    return new Vector(0, -1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing down (0, 1)\r\n   */\r\n  public static get Down() {\r\n    return new Vector(0, 1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing left (-1, 0)\r\n   */\r\n  public static get Left() {\r\n    return new Vector(-1, 0);\r\n  }\r\n  /**\r\n   * A unit vector pointing right (1, 0)\r\n   */\r\n  public static get Right() {\r\n    return new Vector(1, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\r\n   * @param angle The angle to generate the vector\r\n   */\r\n  public static fromAngle(angle: number) {\r\n    return new Vector(Math.cos(angle), Math.sin(angle));\r\n  }\r\n\r\n  /**\r\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\r\n   */\r\n  public static isValid(vec: Vector) {\r\n    if (vec === null || vec === undefined) {\r\n      return false;\r\n    }\r\n    if (isNaN(vec.x) || isNaN(vec.y)) {\r\n      return false;\r\n    }\r\n\r\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Calculates distance between two Vectors\r\n   * @param vec1\r\n   * @param vec2\r\n   */\r\n  public static distance(vec1: Vector, vec2: Vector) {\r\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\r\n  }\r\n\r\n  /**\r\n   * @param x  X component of the Vector\r\n   * @param y  Y component of the Vector\r\n   */\r\n  constructor(x: number, y: number) {\r\n    this._x = x;\r\n    this._y = y;\r\n  }\r\n\r\n  protected _x = 0;\r\n  /**\r\n   * Get the x component of the vector\r\n   */\r\n  public get x(): number {\r\n    return this._x;\r\n  }\r\n\r\n  /**\r\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set x(val: number) {\r\n    this._x = val;\r\n  }\r\n\r\n  protected _y = 0;\r\n  /**\r\n   * Get the y component of the vector\r\n   */\r\n  public get y(): number {\r\n    return this._y;\r\n  }\r\n\r\n  /**\r\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set y(val: number) {\r\n    this._y = val;\r\n  }\r\n\r\n  /**\r\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   *\r\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  setTo(x: number, y: number) {\r\n    (this.x as number) = x;\r\n    (this.y as number) = y;\r\n  }\r\n\r\n  /**\r\n   * Compares this point against another and tests for equality\r\n   * @param vector The other point to compare to\r\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\r\n   */\r\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\r\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\r\n  }\r\n\r\n  /**\r\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\r\n   * @param v  The other vector. Leave blank to use origin vector.\r\n   */\r\n  public distance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\r\n  }\r\n\r\n  public squareDistance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    return Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2);\r\n  }\r\n\r\n  /**\r\n   * The magnitude (size) of the Vector\r\n   * @deprecated magnitude will be removed in favour of '.size' in version 0.25.0\r\n   */\r\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\r\n  public magnitude(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * The size (magnitude) of the Vector\r\n   */\r\n  public get size(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   *\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  public set size(newLength: number) {\r\n    const v = this.normalize().scale(newLength);\r\n    this.setTo(v.x, v.y);\r\n  }\r\n\r\n  /**\r\n   * Normalizes a vector to have a magnitude of 1.\r\n   */\r\n  public normalize(): Vector {\r\n    const d = this.distance();\r\n    if (d > 0) {\r\n      return new Vector(this.x / d, this.y / d);\r\n    } else {\r\n      return new Vector(0, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the average (midpoint) between the current point and the specified\r\n   */\r\n  public average(vec: Vector): Vector {\r\n    return this.add(vec).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Scales a vector's by a factor of size\r\n   * @param size  The factor to scale the magnitude by\r\n   */\r\n  public scale(scale: Vector): Vector;\r\n  public scale(size: number): Vector;\r\n  public scale(sizeOrScale: number | Vector): Vector {\r\n    if (sizeOrScale instanceof Vector) {\r\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\r\n    } else {\r\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to another\r\n   * @param v The vector to add\r\n   */\r\n  public add(v: Vector): Vector {\r\n    return new Vector(this.x + v.x, this.y + v.y);\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\r\n   * @param v The vector to subtract\r\n   */\r\n  public sub(v: Vector): Vector {\r\n    return new Vector(this.x - v.x, this.y - v.y);\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to this one modifying the original\r\n   * @param v The vector to add\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public addEqual(v: Vector): Vector {\r\n    this.setTo(this.x + v.x, this.y + v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from this one modifying the original\r\n   * @param v The vector to subtract\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public subEqual(v: Vector): Vector {\r\n    this.setTo(this.x - v.x, this.y - v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales this vector by a factor of size and modifies the original\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public scaleEqual(size: number): Vector {\r\n    this.setTo(this.x * size, this.y * size);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Performs a dot product with another vector\r\n   * @param v  The vector to dot\r\n   */\r\n  public dot(v: Vector): number {\r\n    return this.x * v.x + this.y * v.y;\r\n  }\r\n\r\n  /**\r\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\r\n   * @param v  The scalar to cross\r\n   */\r\n  public cross(v: number): Vector;\r\n  /**\r\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\r\n   * @param v  The vector to cross\r\n   */\r\n  public cross(v: Vector): number;\r\n  public cross(v: any): any {\r\n    if (v instanceof Vector) {\r\n      return this.x * v.y - this.y * v.x;\r\n    } else if (typeof v === 'number') {\r\n      return new Vector(v * this.y, -v * this.x);\r\n    }\r\n  }\r\n\r\n  static cross(num: number, vec: Vector): Vector {\r\n    return new Vector(-num * vec.y, num * vec.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the perpendicular vector to this one\r\n   */\r\n  public perpendicular(): Vector {\r\n    return new Vector(this.y, -this.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the normal vector to this one, same as the perpendicular of length 1\r\n   */\r\n  public normal(): Vector {\r\n    return this.perpendicular().normalize();\r\n  }\r\n\r\n  /**\r\n   * Negate the current vector\r\n   */\r\n  public negate(): Vector {\r\n    return this.scale(-1);\r\n  }\r\n\r\n  /**\r\n   * Returns the angle of this vector.\r\n   */\r\n  public toAngle(): number {\r\n    return Math.atan2(this.y, this.x);\r\n  }\r\n\r\n  /**\r\n   * Rotates the current vector around a point by a certain number of\r\n   * degrees in radians\r\n   */\r\n  public rotate(angle: number, anchor?: Vector): Vector {\r\n    if (!anchor) {\r\n      anchor = new Vector(0, 0);\r\n    }\r\n    const sinAngle = Math.sin(angle);\r\n    const cosAngle = Math.cos(angle);\r\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\r\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\r\n    return new Vector(x, y);\r\n  }\r\n\r\n  /**\r\n   * Creates new vector that has the same values as the previous.\r\n   */\r\n  public clone(): Vector {\r\n    return new Vector(this.x, this.y);\r\n  }\r\n\r\n  /**\r\n   * Returns a string representation of the vector.\r\n   */\r\n  public toString(fixed?: number): string {\r\n    if (fixed) {\r\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\r\n    }\r\n    return `(${this.x}, ${this.y})`;\r\n  }\r\n}\r\n\r\n/**\r\n * Shorthand for creating new Vectors - returns a new Vector instance with the\r\n * provided X and Y components.\r\n *\r\n * @param x  X component of the Vector\r\n * @param y  Y component of the Vector\r\n */\r\nexport function vec(x: number, y: number): Vector {\r\n  return new Vector(x, y);\r\n}\r\n","import { vec } from '..';\nimport { Vector } from './vector';\nimport { canonicalizeAngle } from '../Util/Util';\n\nexport enum MatrixLocations {\n  X = 12,\n  Y = 13\n}\n\nconst sign = (val: number) => {\n  if (val === 0) {\n    return 0;\n  }\n  return val < 0 ? -1 : 1;\n};\n\n// const multMatch = (a: number, b: number) => {\n//   if (sign(a) < 0 && sign(b) < 0) {\n//     return -Math.abs(a * b);\n//   }\n//   return a * b;\n// }\n\n// const epsilon = (val: number) => {\n//   if (val * val < .0001) {\n//     return 0;\n//   }\n//   return val;\n// }\n\n/**\n * Excalibur Matrix helper for 4x4 matrices\n *\n * Useful for webgl 4x4 matrices\n */\nexport class Matrix {\n  /**\n   *  4x4 matrix in column major order\n   *\n   * |         |         |          |          |\n   * | ------- | ------- | -------- |          |\n   * | data[0] | data[4] | data[8]  | data[12] |\n   * | data[1] | data[5] | data[9]  | data[13] |\n   * | data[2] | data[6] | data[10] | data[14] |\n   * | data[3] | data[7] | data[11] | data[15] |\n   *\n   */\n  public data: Float32Array = new Float32Array(16);\n\n  /**\n   * Creates an orthographic (flat non-perspective) projection\n   * https://en.wikipedia.org/wiki/Orthographic_projection\n   * @param left\n   * @param right\n   * @param bottom\n   * @param top\n   * @param near\n   * @param far\n   */\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 2 / (right - left);\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 2 / (top - bottom);\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = -2 / (far - near);\n    mat.data[11] = 0;\n\n    mat.data[12] = -(right + left) / (right - left);\n    mat.data[13] = -(top + bottom) / (top - bottom);\n    mat.data[14] = -(far + near) / (far - near);\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a new Matrix with the same data as the current 4x4\n   */\n  public clone(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = this.data[0];\n    mat.data[1] = this.data[1];\n    mat.data[2] = this.data[2];\n    mat.data[3] = this.data[3];\n\n    mat.data[4] = this.data[4];\n    mat.data[5] = this.data[5];\n    mat.data[6] = this.data[6];\n    mat.data[7] = this.data[7];\n\n    mat.data[8] = this.data[8];\n    mat.data[9] = this.data[9];\n    mat.data[10] = this.data[10];\n    mat.data[11] = this.data[11];\n\n    mat.data[12] = this.data[12];\n    mat.data[13] = this.data[13];\n    mat.data[14] = this.data[14];\n    mat.data[15] = this.data[15];\n    return mat;\n  }\n\n  /**\n   * Creates a new identity matrix (a matrix that when applied does nothing)\n   */\n  public static identity(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new translation matrix at the specified 3d point\n   * @param x\n   * @param y\n   */\n  public static translation(x: number, y: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[12] = x;\n    mat.data[13] = y;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new scaling matrix with the specified scaling factor\n   * @param sx\n   * @param sy\n   */\n  public static scale(sx: number, sy: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = sx;\n    mat.data[5] = sy;\n    mat.data[10] = 1;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new rotation matrix with the specified angle\n   * @param angleRadians\n   */\n  public static rotation(angleRadians: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = Math.cos(angleRadians);\n    mat.data[4] = -Math.sin(angleRadians);\n    mat.data[1] = Math.sin(angleRadians);\n    mat.data[5] = Math.cos(angleRadians);\n    return mat;\n  }\n\n  /**\n   * Multiplies the current matrix by a vector and returns the resulting vector\n   * @param other\n   */\n  multv(other: [number, number]): [number, number];\n  multv(other: Vector): Vector;\n  multv(other: [number, number] | Vector): [number, number] | Vector {\n    const z = 0;\n    if (other instanceof Vector) {\n      return new Vector(\n        other.x * this.data[0] + other.y * this.data[4] + z * this.data[6] + 1 * this.data[12],\n        other.x * this.data[1] + other.y * this.data[5] + z * this.data[9] + 1 * this.data[13]\n      );\n    } else {\n      const dest: [number, number] = [\n        other[0] * this.data[0] + other[1] * this.data[4] + z * this.data[6] + 1 * this.data[12],\n\n        other[0] * this.data[1] + other[1] * this.data[5] + z * this.data[9] + 1 * this.data[13]\n      ];\n      return dest;\n    }\n  }\n\n  /**\n   * Multiplies the current matrix by another and returns the resulting matrix\n   * @param other\n   */\n  multm(other: Matrix): Matrix {\n    const dest = new Matrix();\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    const b11 = other.data[0];\n    const b21 = other.data[1];\n    const b31 = other.data[2];\n    const b41 = other.data[3];\n\n    const b12 = other.data[4];\n    const b22 = other.data[5];\n    const b32 = other.data[6];\n    const b42 = other.data[7];\n\n    const b13 = other.data[8];\n    const b23 = other.data[9];\n    const b33 = other.data[10];\n    const b43 = other.data[11];\n\n    const b14 = other.data[12];\n    const b24 = other.data[13];\n    const b34 = other.data[14];\n    const b44 = other.data[15];\n\n    dest.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n    dest.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n    dest.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n    dest.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n\n    dest.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n    dest.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n    dest.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n    dest.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n\n    dest.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n    dest.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n    dest.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n    dest.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n\n    dest.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n    dest.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n    dest.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n    dest.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n\n    const s = this.getScale();\n    dest._scaleSignX = sign(s.x) * sign(dest._scaleSignX);\n    dest._scaleSignY = sign(s.y) * sign(dest._scaleSignY);\n\n    return dest;\n  }\n\n  /**\n   * Applies translation to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    // Doesn't change z\n    const z = 0;\n    const w = 1;\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\n\n    return this;\n  }\n\n  public setPosition(x: number, y: number) {\n    this.data[12] = x;\n    this.data[13] = y;\n  }\n\n  public getPosition(): Vector {\n    return vec(this.data[12], this.data[13]);\n  }\n\n  /**\n   * Applies rotation to the current matrix mutating it\n   * @param angle in Radians\n   */\n  rotate(angle: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * a11 + sine * a12;\n    this.data[1] = cosine * a21 + sine * a22;\n    this.data[2] = cosine * a31 + sine * a32;\n    this.data[3] = cosine * a41 + sine * a42;\n\n    this.data[4] = cosine * a12 - sine * a11;\n    this.data[5] = cosine * a22 - sine * a21;\n    this.data[6] = cosine * a32 - sine * a31;\n    this.data[7] = cosine * a42 - sine * a41;\n\n    return this;\n  }\n\n  /**\n   * Applies scaling to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    this.data[0] = a11 * x;\n    this.data[1] = a21 * x;\n    this.data[2] = a31 * x;\n    this.data[3] = a41 * x;\n\n    this.data[4] = a12 * y;\n    this.data[5] = a22 * y;\n    this.data[6] = a32 * y;\n    this.data[7] = a42 * y;\n\n    return this;\n  }\n\n  public setRotation(angle: number) {\n    const currentScale = this.getScale();\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * currentScale.x;\n    this.data[1] = sine * currentScale.y;\n    this.data[4] = -sine * currentScale.x;\n    this.data[5] = cosine * currentScale.y;\n  }\n\n  public getRotation(): number {\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\n    return canonicalizeAngle(angle);\n  }\n\n  public getScaleX(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const xscale = vec(this.data[0], this.data[4]).size;\n    return this._scaleSignX * xscale;\n  }\n\n  public getScaleY(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const yscale = vec(this.data[1], this.data[5]).size;\n    return this._scaleSignY * yscale;\n  }\n\n  /**\n   * Get the scale of the matrix\n   */\n  public getScale(): Vector {\n    return vec(this.getScaleX(), this.getScaleY());\n  }\n\n  private _scaleSignX = 1;\n  public setScaleX(val: number) {\n    this._scaleSignX = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\n    this.data[0] = xscale.x * val;\n    this.data[4] = xscale.y * val;\n  }\n\n  private _scaleSignY = 1;\n  public setScaleY(val: number) {\n    this._scaleSignY = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\n    this.data[1] = yscale.x * val;\n    this.data[5] = yscale.y * val;\n  }\n\n  public setScale(scale: Vector) {\n    this.setScaleX(scale.x);\n    this.setScaleY(scale.y);\n  }\n\n  /**\n   * Determinant of the upper left 2x2 matrix\n   */\n  public getBasisDeterminant() {\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\n  }\n\n  public getAffineInverse(): Matrix {\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\n    // Since we are actually only doing 2D transformations we can use this hack\n    // We don't actually use the 3rd or 4th dimension\n\n    const det = this.getBasisDeterminant();\n    const inverseDet = 1 / det; // todo zero check\n    const a = this.data[0];\n    const b = this.data[4];\n    const c = this.data[1];\n    const d = this.data[5];\n\n    const m = Matrix.identity();\n    // inverts rotation and scale\n    m.data[0] = d * inverseDet;\n    m.data[1] = -c * inverseDet;\n    m.data[4] = -b * inverseDet;\n    m.data[5] = a * inverseDet;\n\n    const tx = this.data[12];\n    const ty = this.data[13];\n    // invert translation\n    // transform translation into the matrix basis created by rot/scale\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\n\n    return m;\n  }\n\n  public isIdentity(): boolean {\n    return (\n      this.data[0] === 1 &&\n      this.data[1] === 0 &&\n      this.data[2] === 0 &&\n      this.data[3] === 0 &&\n      this.data[4] === 0 &&\n      this.data[5] === 1 &&\n      this.data[6] === 0 &&\n      this.data[7] === 0 &&\n      this.data[8] === 0 &&\n      this.data[9] === 0 &&\n      this.data[10] === 1 &&\n      this.data[11] === 0 &&\n      this.data[12] === 0 &&\n      this.data[13] === 0 &&\n      this.data[14] === 0 &&\n      this.data[15] === 1\n    );\n  }\n\n  public toString() {\n    return `\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`;\n  }\n}\n","import { obsolete } from './Util/Decorators';\r\n\r\n/**\r\n * Provides standard colors (e.g. [[Color.Black]])\r\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\r\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\r\n */\r\nexport class Color {\r\n  /**\r\n   * Red channel\r\n   */\r\n  public r: number;\r\n  /**\r\n   * Green channel\r\n   */\r\n  public g: number;\r\n  /**\r\n   * Blue channel\r\n   */\r\n  public b: number;\r\n  /**\r\n   * Alpha channel (between 0 and 1)\r\n   */\r\n  public a: number;\r\n\r\n  /**\r\n   * Hue\r\n   */\r\n  public h: number;\r\n  /**\r\n   * Saturation\r\n   */\r\n  public s: number;\r\n  /**\r\n   * Lightness\r\n   */\r\n  public l: number;\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  constructor(r: number, g: number, b: number, a?: number) {\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a != null ? a : 1;\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\r\n    return new Color(r, g, b, a);\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a rgb string\r\n   *\r\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\r\n   */\r\n  public static fromRGBString(string: string): Color {\r\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\r\n    let match = null;\r\n    if ((match = string.match(rgbaRegEx))) {\r\n      const r = parseInt(match[1], 10);\r\n      const g = parseInt(match[2], 10);\r\n      const b = parseInt(match[3], 10);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseFloat(match[4]);\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid rgb/a string: ' + string);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a hex string\r\n   *\r\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\r\n   */\r\n  public static fromHex(hex: string): Color {\r\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\r\n    let match = null;\r\n    if ((match = hex.match(hexRegEx))) {\r\n      const r = parseInt(match[1], 16);\r\n      const g = parseInt(match[2], 16);\r\n      const b = parseInt(match[3], 16);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseInt(match[4], 16) / 255;\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid hex string: ' + hex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from hsla values\r\n   *\r\n   * @param h  Hue is represented [0-1]\r\n   * @param s  Saturation is represented [0-1]\r\n   * @param l  Luminance is represented [0-1]\r\n   * @param a  Alpha is represented [0-1]\r\n   */\r\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\r\n    const temp = new HSLColor(h, s, l, a);\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Lightens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to lighten by [0-1]\r\n   */\r\n  public lighten(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l += (1 - temp.l) * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Darkens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to darken by [0-1]\r\n   */\r\n  public darken(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l -= temp.l * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Saturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to saturate by [0-1]\r\n   */\r\n  public saturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s += temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Desaturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to desaturate by [0-1]\r\n   */\r\n  public desaturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s -= temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public multiply(color: Color): Color {\r\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\r\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\r\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\r\n    const newA = color.a * this.a;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   * @param color\r\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\r\n   */\r\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\r\n  public mulitiply(color: Color): Color {\r\n    return this.multiply(color);\r\n  }\r\n\r\n  /**\r\n   * Screens a color by another, results in a lighter color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public screen(color: Color): Color {\r\n    const color1 = color.invert();\r\n    const color2 = color.invert();\r\n    return color1.multiply(color2).invert();\r\n  }\r\n\r\n  /**\r\n   * Inverts the current color\r\n   */\r\n  public invert(): Color {\r\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\r\n  }\r\n\r\n  /**\r\n   * Averages the current color with another\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public average(color: Color): Color {\r\n    const newR = (color.r + this.r) / 2;\r\n    const newG = (color.g + this.g) / 2;\r\n    const newB = (color.b + this.b) / 2;\r\n    const newA = (color.a + this.a) / 2;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  public equal(color: Color): boolean {\r\n    return this.toString() === color.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   *\r\n   * @param format Color representation, accepts: rgb, hsl, or hex\r\n   */\r\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\r\n    switch (format) {\r\n      case 'rgb':\r\n        return this.toRGBA();\r\n      case 'hsl':\r\n        return this.toHSLA();\r\n      case 'hex':\r\n        return this.toHex();\r\n      default:\r\n        throw new Error('Invalid Color format');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns Hex Value of a color component\r\n   * @param c color component\r\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\r\n   */\r\n  private _componentToHex(c: number) {\r\n    const hex = c.toString(16);\r\n    return hex.length === 1 ? '0' + hex : hex;\r\n  }\r\n\r\n  /**\r\n   * Return Hex representation of a color.\r\n   */\r\n  public toHex() {\r\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\r\n  }\r\n\r\n  /**\r\n   * Return RGBA representation of a color.\r\n   */\r\n  public toRGBA() {\r\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\r\n    if (this.a !== undefined || this.a !== null) {\r\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\r\n    }\r\n    return 'rgb(' + result + ')';\r\n  }\r\n\r\n  /**\r\n   * Return HSLA representation of a color.\r\n   */\r\n  public toHSLA() {\r\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   */\r\n  public fillStyle() {\r\n    return this.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of the current color.\r\n   */\r\n  public clone(): Color {\r\n    return new Color(this.r, this.g, this.b, this.a);\r\n  }\r\n\r\n  /**\r\n   * Black (#000000)\r\n   */\r\n  public static get Black(): Color {\r\n    return Color.fromHex('#000000');\r\n  }\r\n\r\n  /**\r\n   * White (#FFFFFF)\r\n   */\r\n  public static get White(): Color {\r\n    return Color.fromHex('#FFFFFF');\r\n  }\r\n\r\n  /**\r\n   * Gray (#808080)\r\n   */\r\n  public static get Gray(): Color {\r\n    return Color.fromHex('#808080');\r\n  }\r\n\r\n  /**\r\n   * Light gray (#D3D3D3)\r\n   */\r\n  public static get LightGray(): Color {\r\n    return Color.fromHex('#D3D3D3');\r\n  }\r\n\r\n  /**\r\n   * Dark gray (#A9A9A9)\r\n   */\r\n  public static get DarkGray(): Color {\r\n    return Color.fromHex('#A9A9A9');\r\n  }\r\n\r\n  /**\r\n   * Yellow (#FFFF00)\r\n   */\r\n  public static get Yellow(): Color {\r\n    return Color.fromHex('#FFFF00');\r\n  }\r\n\r\n  /**\r\n   * Orange (#FFA500)\r\n   */\r\n  public static get Orange(): Color {\r\n    return Color.fromHex('#FFA500');\r\n  }\r\n\r\n  /**\r\n   * Red (#FF0000)\r\n   */\r\n  public static get Red(): Color {\r\n    return Color.fromHex('#FF0000');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   */\r\n  public static get Vermilion(): Color {\r\n    return Color.fromHex('#FF5B31');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\r\n   */\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions',\r\n    alternateMethod: 'Vermilion'\r\n  })\r\n  public static get Vermillion(): Color {\r\n    return Color.Vermilion;\r\n  }\r\n\r\n  /**\r\n   * Rose (#FF007F)\r\n   */\r\n  public static get Rose(): Color {\r\n    return Color.fromHex('#FF007F');\r\n  }\r\n\r\n  /**\r\n   * Magenta (#FF00FF)\r\n   */\r\n  public static get Magenta(): Color {\r\n    return Color.fromHex('#FF00FF');\r\n  }\r\n\r\n  /**\r\n   * Violet (#7F00FF)\r\n   */\r\n  public static get Violet(): Color {\r\n    return Color.fromHex('#7F00FF');\r\n  }\r\n\r\n  /**\r\n   * Blue (#0000FF)\r\n   */\r\n  public static get Blue(): Color {\r\n    return Color.fromHex('#0000FF');\r\n  }\r\n\r\n  /**\r\n   * Azure (#007FFF)\r\n   */\r\n  public static get Azure(): Color {\r\n    return Color.fromHex('#007FFF');\r\n  }\r\n\r\n  /**\r\n   * Cyan (#00FFFF)\r\n   */\r\n  public static get Cyan(): Color {\r\n    return Color.fromHex('#00FFFF');\r\n  }\r\n\r\n  /**\r\n   * Viridian (#59978F)\r\n   */\r\n  public static get Viridian(): Color {\r\n    return Color.fromHex('#59978F');\r\n  }\r\n\r\n  /**\r\n   * Green (#00FF00)\r\n   */\r\n  public static get Green(): Color {\r\n    return Color.fromHex('#00FF00');\r\n  }\r\n\r\n  /**\r\n   * Chartreuse (#7FFF00)\r\n   */\r\n  public static get Chartreuse(): Color {\r\n    return Color.fromHex('#7FFF00');\r\n  }\r\n\r\n  /**\r\n   * Transparent (#FFFFFF00)\r\n   */\r\n  public static get Transparent(): Color {\r\n    return Color.fromHex('#FFFFFF00');\r\n  }\r\n\r\n  /**\r\n   * ExcaliburBlue (#176BAA)\r\n   */\r\n  public static get ExcaliburBlue(): Color {\r\n    return Color.fromHex('#176BAA');\r\n  }\r\n}\r\n\r\n/**\r\n * Internal HSL Color representation\r\n *\r\n * http://en.wikipedia.org/wiki/HSL_and_HSV\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n */\r\nclass HSLColor {\r\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\r\n\r\n  public static hue2rgb(p: number, q: number, t: number): number {\r\n    if (t < 0) {\r\n      t += 1;\r\n    }\r\n    if (t > 1) {\r\n      t -= 1;\r\n    }\r\n    if (t < 1 / 6) {\r\n      return p + (q - p) * 6 * t;\r\n    }\r\n    if (t < 1 / 2) {\r\n      return q;\r\n    }\r\n    if (t < 2 / 3) {\r\n      return p + (q - p) * (2 / 3 - t) * 6;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    const max = Math.max(r, g, b),\r\n      min = Math.min(r, g, b);\r\n    let h, s;\r\n    const l = (max + min) / 2;\r\n\r\n    if (max === min) {\r\n      h = s = 0; // achromatic\r\n    } else {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n      }\r\n      h /= 6;\r\n    }\r\n\r\n    return new HSLColor(h, s, l, a);\r\n  }\r\n\r\n  public toRGBA(): Color {\r\n    let r: number, g: number, b: number;\r\n\r\n    if (this.s === 0) {\r\n      r = g = b = this.l; // achromatic\r\n    } else {\r\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\r\n      const p = 2 * this.l - q;\r\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\r\n      g = HSLColor.hue2rgb(p, q, this.h);\r\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\r\n    }\r\n\r\n    return new Color(r * 255, g * 255, b * 255, this.a);\r\n  }\r\n\r\n  public toString(): string {\r\n    const h = this.h.toFixed(0),\r\n      s = this.s.toFixed(0),\r\n      l = this.l.toFixed(0),\r\n      a = this.a.toFixed(0);\r\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { Ray } from '../Math/ray';\nimport { Color } from '../Color';\nimport { Side } from './Side';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { Matrix } from '../Math/matrix';\n\nexport interface BoundingBoxOptions {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  public top: number;\n  public right: number;\n  public bottom: number;\n  public left: number;\n\n  /**\n   * Constructor allows passing of either an object with all coordinate components,\n   * or the coordinate components passed separately.\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\n   * containing the four coordinate components.\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\n    if (typeof leftOrOptions === 'object') {\n      this.left = leftOrOptions.left;\n      this.top = leftOrOptions.top;\n      this.right = leftOrOptions.right;\n      this.bottom = leftOrOptions.bottom;\n    } else if (typeof leftOrOptions === 'number') {\n      this.left = leftOrOptions;\n      this.top = top;\n      this.right = right;\n      this.bottom = bottom;\n    }\n  }\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Return whether the bounding box has zero dimensions in height,width or both\n   */\n  public hasZeroDimensions() {\n    return this.width === 0 || this.height === 0;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  public transform(matrix: Matrix) {\n    const points = this.getPoints().map((p) => matrix.multv(p));\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n\n  /**\n   * Draw a debug bounding box\n   * @param ex\n   * @param color\n   */\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\n  }\n}\n","import { Matrix } from '../../Math/matrix';\r\n\r\nexport class TransformStack {\r\n  private _transforms: Matrix[] = [];\r\n  private _currentTransform: Matrix = Matrix.identity();\r\n\r\n  public save(): void {\r\n    this._transforms.push(this._currentTransform);\r\n    this._currentTransform = this._currentTransform.clone();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentTransform = this._transforms.pop();\r\n  }\r\n\r\n  public translate(x: number, y: number): Matrix {\r\n    return this._currentTransform.translate(x, y);\r\n  }\r\n\r\n  public rotate(angle: number): Matrix {\r\n    return this._currentTransform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): Matrix {\r\n    return this._currentTransform.scale(x, y);\r\n  }\r\n\r\n  public set current(matrix: Matrix) {\r\n    this._currentTransform = matrix;\r\n  }\r\n\r\n  public get current(): Matrix {\r\n    return this._currentTransform;\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\n\r\nexport class StateStack {\r\n  private _states: ExcaliburGraphicsContextState[] = [];\r\n  private _currentState: ExcaliburGraphicsContextState = this._getDefaultState();\r\n\r\n  private _getDefaultState() {\r\n    return {\r\n      opacity: 1\r\n    };\r\n  }\r\n\r\n  private _cloneState() {\r\n    return {\r\n      opacity: this._currentState.opacity\r\n    };\r\n  }\r\n\r\n  public save(): void {\r\n    this._states.push(this._currentState);\r\n    this._currentState = this._cloneState();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentState = this._states.pop();\r\n  }\r\n\r\n  public get current(): ExcaliburGraphicsContextState {\r\n    return this._currentState;\r\n  }\r\n}\r\n","export interface VertexAttributeDefinition {\r\n  name: string;\r\n  size: number;\r\n  glType: number;\r\n  normalized: boolean;\r\n  location: number;\r\n}\r\n\r\nexport interface UniformDefinition {\r\n  name: string;\r\n  location: WebGLUniformLocation;\r\n  type: string;\r\n  data: any;\r\n}\r\n\r\n/**\r\n * Create a shader program for the Excalibur WebGL Graphics Context\r\n */\r\nexport class Shader {\r\n  public program: WebGLProgram | null = null;\r\n\r\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\r\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\r\n  public layout: VertexAttributeDefinition[] = [];\r\n\r\n  /**\r\n   * Create a shader program in excalibur\r\n   * @param _gl WebGL graphics context\r\n   * @param _vertexSource Vertex shader source as a string\r\n   * @param _fragmentSource Fragment shader source as a string\r\n   */\r\n  constructor(private _gl: WebGLRenderingContext, private _vertexSource: string, private _fragmentSource: string) {\r\n    this.compile(_gl);\r\n  }\r\n\r\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n    const program = gl.createProgram();\r\n    if (program === null) {\r\n      throw Error('Could not create graphics shader program');\r\n    }\r\n\r\n    // attach the shaders.\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    // link the program.\r\n    gl.linkProgram(program);\r\n\r\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\r\n    }\r\n\r\n    return program;\r\n  }\r\n\r\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\r\n    const shader = gl.createShader(type);\r\n    if (shader === null) {\r\n      throw Error(`Could not build shader: [${source}]`);\r\n    }\r\n\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n\r\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not compile shader [${gl.getShaderInfoLog(shader)}]`);\r\n    }\r\n    return shader;\r\n  }\r\n\r\n  /**\r\n   * Compile the current shader against a webgl context\r\n   * @param gl WebGL context\r\n   */\r\n  compile(gl: WebGLRenderingContext): WebGLProgram {\r\n    const vertexShader = this._compileShader(gl, this._vertexSource, gl.VERTEX_SHADER);\r\n    const fragmentShader = this._compileShader(gl, this._fragmentSource, gl.FRAGMENT_SHADER);\r\n    const program = this._createProgram(gl, vertexShader, fragmentShader);\r\n    return (this.program = program);\r\n  }\r\n\r\n  /**\r\n   * Add a uniform [[Matrix]] to the shader\r\n   * @param name Name of the uniform in the shader source\r\n   * @param data (4x4) matrix in column major order\r\n   */\r\n  public addUniformMatrix(name: string, data: Float32Array) {\r\n    if (!data) {\r\n      throw Error(`Shader Uniform Matrix '${name}' was set to null or undefined`);\r\n    }\r\n    const gl = this._gl;\r\n    this.uniforms[name] = {\r\n      name,\r\n      type: 'matrix',\r\n      location: gl.getUniformLocation(this.program, name),\r\n      data: data\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add a uniform array of numbers to the shader\r\n   * @param name Name of the uniform in the shader source\r\n   * @param data List of numbers\r\n   */\r\n  public addUniformIntegerArray(name: string, data: number[]) {\r\n    if (!data) {\r\n      throw Error(`Shader Uniform Integery Array '${name}' was set to null or undefined`);\r\n    }\r\n    const gl = this._gl;\r\n    this.uniforms[name] = {\r\n      name,\r\n      type: 'numbers',\r\n      location: gl.getUniformLocation(this.program, name),\r\n      data: data\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add attributes in the order they appear in the VBO\r\n   * @param name Name of the attribute in the shader source\r\n   * @param size The size of the attribute in gl.Type units, for example `vec2 a_pos` would be 2 gl.FLOAT\r\n   * @param glType The gl.Type of the attribute\r\n   */\r\n  public addAttribute(name: string, size: number, glType: number, normalized = false) {\r\n    const gl = this._gl;\r\n    // TODO needs to be compiled first\r\n    const location = gl.getAttribLocation(this.program, name);\r\n    this.attributes[name] = {\r\n      name,\r\n      size,\r\n      glType,\r\n      normalized,\r\n      location\r\n    };\r\n    this.layout.push(this.attributes[name]);\r\n  }\r\n\r\n  /**\r\n   * Number of javascript floats a vertex will take up\r\n   */\r\n  public get vertexAttributeSize(): number {\r\n    let vertexSize = 0;\r\n    for (const vert of this.layout) {\r\n      vertexSize += vert.size;\r\n    }\r\n    return vertexSize;\r\n  }\r\n\r\n  /**\r\n   * Total number of bytes that the vertex will take up\r\n   */\r\n  public get totalVertexSizeBytes(): number {\r\n    let vertexSize = 0;\r\n    for (const vert of this.layout) {\r\n      let typeSize = 1;\r\n      switch (vert.glType) {\r\n        case this._gl.FLOAT: {\r\n          typeSize = 4;\r\n          break;\r\n        }\r\n        default: {\r\n          typeSize = 1;\r\n        }\r\n      }\r\n      vertexSize += typeSize * vert.size;\r\n    }\r\n\r\n    return vertexSize;\r\n  }\r\n\r\n  /**\r\n   * Get a previously defined attribute size in bytes\r\n   * @param name\r\n   */\r\n  public getAttributeSize(name: string) {\r\n    let typeSize = 1;\r\n    switch (this.attributes[name].glType) {\r\n      case this._gl.FLOAT: {\r\n        typeSize = 4;\r\n        break;\r\n      }\r\n      default: {\r\n        typeSize = 1;\r\n      }\r\n    }\r\n    return typeSize * this.attributes[name].size;\r\n  }\r\n\r\n  /**\r\n   * Sets this shader program as the current in the underlying webgl context\r\n   *\r\n   * **Must** specify all attributes and uniforms before calling this\r\n   */\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.useProgram(this.program);\r\n    let offset = 0;\r\n    for (const vert of this.layout) {\r\n      gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\r\n      gl.enableVertexAttribArray(vert.location);\r\n      offset += this.getAttributeSize(vert.name);\r\n    }\r\n\r\n    for (const key in this.uniforms) {\r\n      const uniform = this.uniforms[key];\r\n      switch (uniform.type) {\r\n        case 'matrix': {\r\n          gl.uniformMatrix4fv(uniform.location, false, uniform.data);\r\n          break;\r\n        }\r\n        case 'numbers': {\r\n          gl.uniform1iv(uniform.location, uniform.data);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport class BatchCommand<T> implements Poolable {\r\n  _pool: Pool<this> = undefined;\r\n  public commands: T[] = [];\r\n  constructor(public max: number) {}\r\n\r\n  isFull() {\r\n    if (this.commands.length >= this.max) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  canAdd() {\r\n    return !this.isFull();\r\n  }\r\n\r\n  add(cmd: T) {\r\n    this.commands.push(cmd);\r\n  }\r\n\r\n  dispose() {\r\n    this.commands.length = 0;\r\n    return this;\r\n  }\r\n}\r\n","export class GraphicsDiagnostics {\r\n  public static DrawCallCount: number = 0;\r\n  public static DrawnImagesCount: number = 0;\r\n  public static clear(): void {\r\n    GraphicsDiagnostics.DrawCallCount = 0;\r\n    GraphicsDiagnostics.DrawnImagesCount = 0;\r\n  }\r\n}\r\n","import { Logger } from '..';\r\n\r\nexport interface Poolable {\r\n  /**\r\n   * Any type that is a member of a an object pool will have a reference to teh pool\r\n   * @internal\r\n   */\r\n  _pool?: Pool<this>;\r\n  dispose(): this;\r\n}\r\n\r\nexport class Pool<Type extends Poolable> {\r\n  public totalAllocations = 0;\r\n  public index = 0;\r\n  public objects: Type[] = [];\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(\r\n    public builder: (...args: any[]) => Type,\r\n    public recycler: (instance: Type, ...args: any[]) => Type,\r\n    public maxObjects: number = 100\r\n  ) {}\r\n\r\n  /**\r\n   * Use many instances out of the in the context and return all to the pool.\r\n   *\r\n   * By returning values out of the contex they will be un-hooked from the pool and are free to be passed to consumers\r\n   * @param context\r\n   */\r\n  using(context: (pool: Pool<Type>) => Type[] | void) {\r\n    const result = context(this);\r\n    if (result) {\r\n      return this.done(...result);\r\n    }\r\n    return this.done();\r\n  }\r\n\r\n  /**\r\n   * Use a single instance out of th pool and immediately return it to the pool\r\n   * @param context\r\n   */\r\n  borrow(context: (object: Type) => void) {\r\n    const object = this.get();\r\n    context(object);\r\n    this.index--;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\r\n   * @param args\r\n   */\r\n  get(...args: any[]): Type {\r\n    if (this.index === this.maxObjects) {\r\n      // TODO implement hard or soft cap\r\n      this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\r\n      this.maxObjects = this.maxObjects * 2;\r\n      // throw new Error('Max pooled objects reached, possible memory leak?');\r\n    }\r\n\r\n    if (this.objects[this.index]) {\r\n      // Pool has an available object already constructed\r\n      return this.recycler(this.objects[this.index++], ...args);\r\n    } else {\r\n      // New allocation\r\n      this.totalAllocations++;\r\n      const object = (this.objects[this.index++] = this.builder(...args));\r\n      object._pool = this;\r\n      return object;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\r\n   *\r\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\r\n   * to be passed to consumers\r\n   * @param objects A list of object to separate from the pool\r\n   */\r\n  done(...objects: Type[]): Type[];\r\n  done(): void;\r\n  done(...objects: Type[]): Type[] | void {\r\n    // All objects in pool now considered \"free\"\r\n    this.index = 0;\r\n    for (const object of objects) {\r\n      const poolIndex = this.objects.indexOf(object);\r\n      // Build a new object to take the pool place\r\n      this.objects[poolIndex] = (this as any).builder(); // TODO problematic 0-arg only support\r\n      this.objects[poolIndex]._pool = this;\r\n      this.totalAllocations++;\r\n      // Unhook object from the pool\r\n      object._pool = undefined;\r\n    }\r\n    return objects;\r\n  }\r\n}\r\n","import { BatchCommand } from './batch';\r\nimport { Shader } from './shader';\r\n// import { Pool, Poolable } from './pool';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport interface Renderer {\r\n  render(): void;\r\n}\r\n\r\nexport interface Ctor<T> {\r\n  new (): T;\r\n}\r\n\r\nexport interface BatchRendererOptions<T extends Poolable> {\r\n  gl: WebGLRenderingContext;\r\n  /**\r\n   * Draw command constructor\r\n   */\r\n  command: Ctor<T>;\r\n  /**\r\n   * Number of vertices that are generated per draw command\r\n   */\r\n  verticesPerCommand?: number;\r\n  /**\r\n   * Maximum commands to batch before drawing\r\n   */\r\n  maxCommandsPerBatch?: number;\r\n  /**\r\n   * Override the built in command batching mechanism\r\n   */\r\n  batchFactory?: () => BatchCommand<T>;\r\n}\r\n\r\nexport abstract class BatchRenderer<T extends Poolable> implements Renderer {\r\n  priority = 0;\r\n  private _gl: WebGLRenderingContext;\r\n  private _vertices: Float32Array;\r\n  private _verticesPerCommand: number;\r\n  private _buffer: WebGLBuffer | null = null;\r\n  private _maxCommandsPerBatch: number = 2000;\r\n\r\n  public shader: Shader;\r\n\r\n  public commands: Pool<T>;\r\n  private _batchPool: Pool<BatchCommand<T>>;\r\n  private _batches: BatchCommand<T>[] = [];\r\n  constructor(options: BatchRendererOptions<T>) {\r\n    this._gl = options.gl;\r\n    const command = options.command;\r\n    this._verticesPerCommand = options?.verticesPerCommand ?? 1;\r\n    this._maxCommandsPerBatch = options?.maxCommandsPerBatch ?? this._maxCommandsPerBatch;\r\n    const batchFactory = options?.batchFactory ?? (() => new BatchCommand<T>(this._maxCommandsPerBatch));\r\n\r\n    this.commands = new Pool<T>(\r\n      () => new command(),\r\n      (c) => c.dispose(),\r\n      this._maxCommandsPerBatch\r\n    );\r\n    this._batchPool = new Pool<BatchCommand<T>>(batchFactory, (b) => b.dispose(), 100);\r\n  }\r\n\r\n  /**\r\n   * Initialize render, builds shader and initialized webgl buffers\r\n   */\r\n  public init() {\r\n    const gl = this._gl;\r\n    this.shader = this.buildShader(gl);\r\n    // Initialize VBO\r\n    // https://groups.google.com/forum/#!topic/webgl-dev-list/vMNXSNRAg8M\r\n    this._vertices = new Float32Array(this.shader.vertexAttributeSize * this._verticesPerCommand * this._maxCommandsPerBatch);\r\n    this._buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this._vertices, gl.DYNAMIC_DRAW);\r\n  }\r\n\r\n  public get vertexSize(): number {\r\n    return this.shader.vertexAttributeSize;\r\n  }\r\n\r\n  public addCommand(cmd: T) {\r\n    if (this._batches.length === 0) {\r\n      this._batches.push(this._batchPool.get());\r\n    }\r\n\r\n    const lastBatch = this._batches[this._batches.length - 1];\r\n    if (lastBatch.canAdd()) {\r\n      lastBatch.add(cmd);\r\n    } else {\r\n      const newBatch = this._batchPool.get();\r\n      newBatch.add(cmd);\r\n      this._batches.push(newBatch);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Construct or return the Shader to be used in this batch renderer\r\n   * @param gl\r\n   */\r\n  abstract buildShader(gl: WebGLRenderingContext): Shader;\r\n\r\n  /**\r\n   * Implement populating the vertex buffer, return the number of vertices added to the buffer\r\n   * @param vertices\r\n   * @param batch\r\n   */\r\n  abstract buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<T>): number;\r\n\r\n  /**\r\n   * Implement gl draw call to render batch. The vertextBuffer from buildBatchVertices is already bound and the data has been updated.\r\n   */\r\n  abstract renderBatch(gl: WebGLRenderingContext, batch: BatchCommand<T>, vertexCount: number): void;\r\n\r\n  /**\r\n   * Build batch geometry, submit to the gpu, and issue draw command to underlying webgl\r\n   */\r\n  public render(): void {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._buffer);\r\n    this.shader.use();\r\n    let drawCallCount = 0;\r\n    let drawnImagesCount = 0;\r\n    for (const batch of this._batches) {\r\n      // Build all geometry and ship to GPU\r\n      // interleave VBOs https://goharsha.com/lwjgl-tutorial-series/interleaving-buffer-objects/\r\n      const vertexCount = this.buildBatchVertices(this._vertices, batch);\r\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, this._vertices);\r\n\r\n      this.renderBatch(gl, batch, vertexCount);\r\n      drawnImagesCount += batch.commands.length;\r\n      drawCallCount++;\r\n    }\r\n    this.commands.done();\r\n    this._batchPool.done();\r\n    this._batches.length = 0;\r\n    GraphicsDiagnostics.DrawCallCount += drawCallCount;\r\n    GraphicsDiagnostics.DrawnImagesCount += drawnImagesCount;\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { Shader } from './shader';\r\nimport lineVertexSource from './shaders/line-vertex.glsl';\r\nimport lineFragmentSource from './shaders/line-fragment.glsl';\r\nimport { BatchRenderer } from './renderer';\r\nimport { BatchCommand } from './batch';\r\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport class DrawLine implements Poolable {\r\n  _pool?: Pool<this>;\r\n  public color: Color = Color.Black;\r\n  public start: Vector = Vector.Zero;\r\n  public end: Vector = Vector.Zero;\r\n  public dispose() {\r\n    this.color.r = 0;\r\n    this.color.g = 0;\r\n    this.color.b = 0;\r\n    this.color.a = 1;\r\n    this.start.setTo(0, 0);\r\n    this.end.setTo(0, 0);\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class LineRenderer extends BatchRenderer<DrawLine> {\r\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\r\n    super({ gl, command: DrawLine, verticesPerCommand: 2 });\r\n    this.init();\r\n  }\r\n\r\n  buildShader(gl: WebGLRenderingContext) {\r\n    const shader = new Shader(gl, lineVertexSource, lineFragmentSource);\r\n\r\n    shader.addAttribute('a_position', 2, gl.FLOAT);\r\n    shader.addAttribute('a_color', 4, gl.FLOAT);\r\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\r\n    return shader;\r\n  }\r\n\r\n  addLine(start: Vector, end: Vector, color: Color) {\r\n    const cmd = this.commands.get();\r\n    cmd.start = this._contextInfo.transform.current.multv(start);\r\n    cmd.end = this._contextInfo.transform.current.multv(end);\r\n    cmd.color.r = color.r;\r\n    cmd.color.g = color.g;\r\n    cmd.color.b = color.b;\r\n    cmd.color.a = cmd.color.a * this._contextInfo.state.current.opacity;\r\n    this.addCommand(cmd);\r\n  }\r\n\r\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<DrawLine>): number {\r\n    let index = 0;\r\n    for (const command of batch.commands) {\r\n      // Start\r\n      vertexBuffer[index++] = command.start.x;\r\n      vertexBuffer[index++] = command.start.y;\r\n      vertexBuffer[index++] = command.color.r / 255;\r\n      vertexBuffer[index++] = command.color.g / 255;\r\n      vertexBuffer[index++] = command.color.b / 255;\r\n      vertexBuffer[index++] = command.color.a;\r\n\r\n      // End\r\n      vertexBuffer[index++] = command.end.x;\r\n      vertexBuffer[index++] = command.end.y;\r\n      vertexBuffer[index++] = command.color.r / 255;\r\n      vertexBuffer[index++] = command.color.g / 255;\r\n      vertexBuffer[index++] = command.color.b / 255;\r\n      vertexBuffer[index++] = command.color.a;\r\n    }\r\n    return index / this.vertexSize;\r\n  }\r\n\r\n  renderBatch(gl: WebGLRenderingContext, _batch: BatchCommand<DrawLine>, vertexCount: number) {\r\n    gl.drawArrays(gl.LINES, 0, vertexCount);\r\n  }\r\n}\r\n","export default \"attribute vec4 a_position;\\r\\nattribute vec4 a_color;\\r\\n\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * a_position;\\r\\n\\r\\n   // Passthrough the color\\r\\n   v_color = a_color;\\r\\n}\";","export default \"precision mediump float;\\r\\n\\r\\n// Color\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n  gl_FragColor = v_color;\\r\\n}\";","import { Matrix } from '../../Math/matrix';\r\nimport { BoundingBox } from '../../Collision/Index';\r\nimport { Color } from '../../Color';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../../Math/vector';\r\n\r\nexport enum DrawCommandType {\r\n  Image = 'image',\r\n  Line = 'line',\r\n  Rectangle = 'rectangle',\r\n  Circle = 'circle'\r\n}\r\n\r\nexport class DrawImageCommand implements Poolable {\r\n  _pool: Pool<this> = undefined;\r\n\r\n  public snapToPixel: boolean = true;\r\n  public image: HTMLImageSource;\r\n  public color: Color;\r\n  public type = DrawCommandType.Image;\r\n  public opacity: number = 1;\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n  public dest: [number, number] = [0, 0]; // x, y\r\n  public view: [number, number, number, number] = [0, 0, 0, 0]; // sx, sy, sw, sh\r\n  private _geom: [number, number][] = [\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0]\r\n  ];\r\n  constructor();\r\n  constructor(image: HTMLImageSource, x: number, y: number);\r\n  constructor(image: HTMLImageSource, x: number, y: number, width?: number, height?: number);\r\n  constructor(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  );\r\n  constructor(\r\n    image?: HTMLImageSource,\r\n    sx?: number,\r\n    sy?: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    this.init(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n  }\r\n\r\n  public init(\r\n    image?: HTMLImageSource,\r\n    sx?: number,\r\n    sy?: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    this.type = DrawCommandType.Image;\r\n    this.image = image;\r\n    this.width = image?.width || swidth || 0;\r\n    this.height = image?.height || sheight || 0;\r\n    this.view = [0, 0, swidth ?? image?.width, sheight ?? image?.height];\r\n    this.dest = [sx, sy];\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      this.view = [sx, sy, swidth ?? image?.width, sheight ?? image?.height];\r\n      this.dest = [dx, dy];\r\n      this.width = dwidth;\r\n      this.height = dheight;\r\n    }\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [this.dest[0], this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1] + this.height];\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initRect(color: Color, start: Vector, width: number, height: number) {\r\n    this.type = DrawCommandType.Rectangle;\r\n    this.color = color;\r\n    this.width = width;\r\n    this.height = height;\r\n    let index = 0;\r\n    this._geom[index++] = [start.x, start.y];\r\n    this._geom[index++] = [start.x, start.y + this.height];\r\n    this._geom[index++] = [start.x + this.width, start.y];\r\n    this._geom[index++] = [start.x + this.width, start.y];\r\n    this._geom[index++] = [start.x, start.y + this.height];\r\n    this._geom[index++] = [start.x + this.width, start.y + this.height];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initLine(color: Color, start: Vector, end: Vector, thickness: number) {\r\n    this.type = DrawCommandType.Line;\r\n    this.color = color;\r\n    const dir = end.sub(start).normalize();\r\n    const normal = dir.perpendicular();\r\n    const halfThick = thickness / 2;\r\n    const startTop = normal.scale(halfThick).add(start);\r\n    const startBottom = normal.scale(-halfThick).add(start);\r\n    const endTop = normal.scale(halfThick).add(end);\r\n    const endBottom = normal.scale(-halfThick).add(end);\r\n\r\n    /**\r\n     *    +---------------------^----------------------+\r\n     *    |                     | (normal)             |\r\n     *   (startx, starty)------------------>(endx, endy)\r\n     *    |                                            |\r\n     *    + -------------------------------------------+\r\n     */\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [startTop.x, startTop.y];\r\n    this._geom[index++] = [endTop.x, endTop.y];\r\n    this._geom[index++] = [startBottom.x, startBottom.y];\r\n    this._geom[index++] = [startBottom.x, startBottom.y];\r\n    this._geom[index++] = [endTop.x, endTop.y];\r\n    this._geom[index++] = [endBottom.x, endBottom.y];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initCircle(pos: Vector, radius: number, color: Color) {\r\n    this.type = DrawCommandType.Circle;\r\n    this.color = color;\r\n    const topLeft = pos.add(vec(-radius, -radius));\r\n    const topRight = pos.add(vec(radius, -radius));\r\n    const bottomRight = pos.add(vec(radius, radius));\r\n    const bottomLeft = pos.add(vec(-radius, radius));\r\n    let index = 0;\r\n    this._geom[index++] = [topLeft.x, topLeft.y];\r\n    this._geom[index++] = [topRight.x, topRight.y];\r\n    this._geom[index++] = [bottomLeft.x, bottomLeft.y];\r\n    this._geom[index++] = [bottomLeft.x, bottomLeft.y];\r\n    this._geom[index++] = [topRight.x, topRight.y];\r\n    this._geom[index++] = [bottomRight.x, bottomRight.y];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public dispose() {\r\n    this.image = null;\r\n    this.width = 0;\r\n    this.height = 0;\r\n    this.view = [0, 0, 0, 0];\r\n    this.dest = [0, 0];\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [this.dest[0], this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1] + this.height];\r\n    return this;\r\n  }\r\n\r\n  // todo weird\r\n  applyTransform(transform: Matrix, opacity: number): void {\r\n    if (transform) {\r\n      for (let i = 0; i < this._geom.length; i++) {\r\n        this._geom[i] = transform.multv(this._geom[i]);\r\n        if (this.snapToPixel) {\r\n          this._geom[i] = [~~this._geom[i][0], ~~this._geom[i][1]];\r\n        }\r\n      }\r\n    }\r\n    this.opacity = opacity;\r\n  }\r\n\r\n  public get geometry() {\r\n    return this._geom;\r\n  }\r\n}\r\n\r\nexport class DrawRectCommand {\r\n  public dest: [number, number] = [0, 0];\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n  constructor(x: number, y: number, width: number, height: number) {\r\n    this.dest = [x, y];\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n}\r\n\r\nexport class DrawDebugRectCommand {\r\n  constructor(public bounds: BoundingBox, public color: Color) {}\r\n}\r\n","/**\r\n * Checks if the current number is a power of two\r\n */\r\nexport function isPowerOfTwo(x: number): boolean {\r\n  return (x & (x - 1)) === 0;\r\n}\r\n\r\n/**\r\n * Returns the next highest power of two\r\n */\r\nexport function nextHighestPowerOfTwo(x: number): number {\r\n  --x;\r\n  for (let i = 1; i < 32; i <<= 1) {\r\n    x = x | (x >> i);\r\n  }\r\n  return x + 1;\r\n}\r\n\r\n/**\r\n * Returns the input number if a power of two, otherwise the next highest power of two\r\n */\r\nexport function ensurePowerOfTwo(x: number): number {\r\n  if (!isPowerOfTwo(x)) {\r\n    return nextHighestPowerOfTwo(x);\r\n  }\r\n  return x;\r\n}\r\n","import { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { ensurePowerOfTwo, isPowerOfTwo } from './webgl-util';\r\n\r\n/**\r\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\r\n */\r\nexport class TextureLoader {\r\n  private static _POT_CANVAS = document.createElement('canvas');\r\n  private static _POT_CTX = TextureLoader._POT_CANVAS.getContext('2d');\r\n\r\n  private static _GL: WebGLRenderingContext;\r\n\r\n  private static _TEXTURE_MAP = new Map<HTMLImageSource, WebGLTexture>();\r\n\r\n  public static registerContext(context: WebGLRenderingContext): void {\r\n    TextureLoader._GL = context;\r\n  }\r\n\r\n  /**\r\n   * Get the WebGL Texture from a source image\r\n   * @param image\r\n   */\r\n  public static get(image: HTMLImageSource): WebGLTexture {\r\n    return TextureLoader._TEXTURE_MAP.get(image);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a source image has been loaded as a texture\r\n   * @param image\r\n   */\r\n  public static has(image: HTMLImageSource): boolean {\r\n    return TextureLoader._TEXTURE_MAP.has(image);\r\n  }\r\n\r\n  /**\r\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\r\n   * @param image Source graphic\r\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\r\n   */\r\n  public static load(image: HTMLImageSource, forceUpdate = false): WebGLTexture {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = TextureLoader._GL;\r\n    if (!gl) {\r\n      return null;\r\n    }\r\n\r\n    let tex: WebGLTexture = null;\r\n    // If reuse the texture if it's from the same source\r\n    if (TextureLoader.has(image)) {\r\n      tex = TextureLoader.get(image);\r\n    }\r\n\r\n    // Update existing webgl texture and return early\r\n    if (tex) {\r\n      if (forceUpdate) {\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        const source = TextureLoader.toPowerOfTwoImage(image);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n      }\r\n      return tex;\r\n    }\r\n\r\n    // No texture exists create a new one\r\n    tex = gl.createTexture();\r\n    const source = TextureLoader.toPowerOfTwoImage(image);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n    // NEAREST for pixels\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n\r\n    TextureLoader._TEXTURE_MAP.set(image, tex);\r\n    return tex;\r\n  }\r\n\r\n  /**\r\n   * Converts source images into power of two images, WebGL only supports POT images\r\n   * https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support\r\n   * @param image\r\n   */\r\n  public static toPowerOfTwoImage(image: HTMLImageSource): HTMLImageSource {\r\n    const potCanvas = TextureLoader._POT_CANVAS;\r\n    const potCtx = TextureLoader._POT_CTX;\r\n    if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height)) {\r\n      // Scale up the texture to the next highest power of two dimensions.\r\n\r\n      potCanvas.width = ensurePowerOfTwo(image.width);\r\n      potCanvas.height = ensurePowerOfTwo(image.height);\r\n      potCtx.imageSmoothingEnabled = false;\r\n      potCtx.clearRect(0, 0, potCanvas.width, potCanvas.height);\r\n      potCtx.drawImage(image, 0, 0, image.width, image.height);\r\n      image = potCanvas;\r\n    }\r\n    return image;\r\n  }\r\n}\r\n","import { Shader } from './shader';\r\nimport imageVertexSource from './shaders/image-vertex.glsl';\r\nimport imageFragmentSource from './shaders/image-fragment.glsl';\r\nimport { BatchCommand } from './batch';\r\nimport { DrawCommandType, DrawImageCommand } from './draw-image-command';\r\nimport { Graphic } from '../Graphic';\r\nimport { ensurePowerOfTwo } from './webgl-util';\r\nimport { BatchRenderer } from './renderer';\r\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\r\nimport { TextureLoader } from './texture-loader';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { Color } from '../../Color';\r\nimport { Vector } from '../..';\r\n\r\nexport class BatchImage extends BatchCommand<DrawImageCommand> {\r\n  public textures: WebGLTexture[] = [];\r\n  public commands: DrawImageCommand[] = [];\r\n  private _graphicMap: { [id: string]: Graphic } = {};\r\n\r\n  constructor(public maxDraws: number, public maxTextures: number) {\r\n    super(maxDraws);\r\n  }\r\n\r\n  isFull() {\r\n    if (this.commands.length >= this.maxDraws) {\r\n      return true;\r\n    }\r\n    if (this.textures.length >= this.maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  canAdd() {\r\n    if (this.commands.length >= this.maxDraws) {\r\n      return false;\r\n    }\r\n\r\n    if (this.textures.length < this.maxTextures) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  private _isCommandFull() {\r\n    return this.commands.length >= this.maxDraws;\r\n  }\r\n\r\n  private _isTextureFull() {\r\n    return this.textures.length >= this.maxTextures;\r\n  }\r\n\r\n  private _wouldAddTexture(command: DrawImageCommand) {\r\n    return !this._graphicMap[command.image.id];\r\n  }\r\n\r\n  maybeAdd(command: DrawImageCommand): boolean {\r\n    if ((this._isCommandFull() || this._isTextureFull()) && this._wouldAddTexture(command)) {\r\n      return false;\r\n    }\r\n\r\n    this.add(command);\r\n    return true;\r\n  }\r\n\r\n  add(command: DrawImageCommand) {\r\n    if (command.type === DrawCommandType.Image) {\r\n      const texture = TextureLoader.load(command.image);\r\n      if (this.textures.indexOf(texture) === -1) {\r\n        this.textures.push(texture);\r\n      }\r\n    }\r\n\r\n    this.commands.push(command);\r\n  }\r\n\r\n  bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    for (let i = 0; i < this.maxTextures; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this.textures[i] || this.textures[0]);\r\n    }\r\n  }\r\n\r\n  getBatchTextureId(command: DrawImageCommand) {\r\n    if (command.image) {\r\n      return this.textures.indexOf(TextureLoader.get(command.image));\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  dispose() {\r\n    this.clear();\r\n    return this;\r\n  }\r\n\r\n  clear() {\r\n    this.commands.length = 0;\r\n    this.textures.length = 0;\r\n    this._graphicMap = {};\r\n  }\r\n}\r\n\r\nexport class ImageRenderer extends BatchRenderer<DrawImageCommand> {\r\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\r\n    super({\r\n      gl,\r\n      command: DrawImageCommand,\r\n      // 6 verts per quad\r\n      verticesPerCommand: 6,\r\n      maxCommandsPerBatch: 2000,\r\n      batchFactory: () => new BatchImage(2000, gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS))\r\n    });\r\n    TextureLoader.registerContext(gl);\r\n    this.init();\r\n  }\r\n\r\n  buildShader(gl: WebGLRenderingContext): Shader {\r\n    // Initialilze default batch rendering shader\r\n    const maxGPUTextures = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n    const shader = new Shader(gl, imageVertexSource, this._transformFragmentSource(imageFragmentSource, maxGPUTextures));\r\n    shader.addAttribute('a_position', 3, gl.FLOAT);\r\n    shader.addAttribute('a_texcoord', 2, gl.FLOAT);\r\n    shader.addAttribute('a_textureIndex', 1, gl.FLOAT);\r\n    shader.addAttribute('a_opacity', 1, gl.FLOAT);\r\n    shader.addAttribute('a_color', 4, gl.FLOAT);\r\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    shader.addUniformIntegerArray(\r\n      'u_textures',\r\n      [...Array(maxGPUTextures)].map((_, i) => i)\r\n    );\r\n    return shader;\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      color = texture2D(u_textures[${i}], v_texcoord);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  public addCircle(pos: Vector, radius: number, color: Color) {\r\n    const command = this.commands.get().initCircle(pos, radius, color);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addRectangle(color: Color, pos: Vector, width: number, height: number) {\r\n    const command = this.commands.get().initRect(color, pos, width, height);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addLine(color: Color, start: Vector, end: Vector, thickness = 1) {\r\n    const command = this.commands.get().initLine(color, start, end, thickness);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addImage(\r\n    graphic: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    const command = this.commands.get().init(graphic, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public renderBatch(gl: WebGLRenderingContext, batch: BatchImage, vertexCount: number) {\r\n    // Bind textures in the correct order\r\n    batch.bindTextures(gl);\r\n    // draw the quads\r\n    gl.drawArrays(gl.TRIANGLES, 0, vertexCount);\r\n  }\r\n\r\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchImage): number {\r\n    let vertIndex = 0;\r\n    let sx: number = 0;\r\n    let sy: number = 0;\r\n    let sw: number = 0;\r\n    let sh: number = 0;\r\n    let potWidth: number = 1;\r\n    let potHeight: number = 1;\r\n    let textureId = 0;\r\n    let commandColor = Color.Transparent;\r\n    for (const command of batch.commands) {\r\n      sx = command.view[0];\r\n      sy = command.view[1];\r\n      sw = command.view[2];\r\n      sh = command.view[3];\r\n\r\n      potWidth = ensurePowerOfTwo(command.image?.width || command.width);\r\n      potHeight = ensurePowerOfTwo(command.image?.height || command.height);\r\n\r\n      textureId = batch.getBatchTextureId(command);\r\n      if (command.type === DrawCommandType.Line || command.type === DrawCommandType.Rectangle) {\r\n        textureId = -1; // sentinel for no image rect\r\n        commandColor = command.color;\r\n      }\r\n      if (command.type === DrawCommandType.Circle) {\r\n        textureId = -2; // sentinel for circle\r\n        commandColor = command.color;\r\n      }\r\n\r\n      // potential optimization when divding by 2 (bitshift)\r\n      // Modifying the images to poweroftwo images warp the UV coordinates\r\n      let uvx0 = sx / potWidth;\r\n      let uvy0 = sy / potHeight;\r\n      let uvx1 = (sx + sw) / potWidth;\r\n      let uvy1 = (sy + sh) / potHeight;\r\n      if (textureId === -2) {\r\n        uvx0 = 0;\r\n        uvy0 = 0;\r\n        uvx1 = 1;\r\n        uvy1 = 1;\r\n      }\r\n\r\n      // Quad update\r\n      // (0, 0, z) z-index doesn't work in batch rendering between batches\r\n      vertexBuffer[vertIndex++] = command.geometry[0][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[0][1]; //y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy0; // 0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (0, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[1][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[1][1]; // y + 1 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 0)\r\n      vertexBuffer[vertIndex++] = command.geometry[2][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[2][1]; // y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; //1;\r\n      vertexBuffer[vertIndex++] = uvy0; //0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 0)\r\n      vertexBuffer[vertIndex++] = command.geometry[3][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[3][1]; // y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; //1;\r\n      vertexBuffer[vertIndex++] = uvy0; //0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (0, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[4][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[4][1]; // y + 1 * height\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[5][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[5][1]; // y + 1 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; // 1;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n    }\r\n\r\n    return vertIndex / this.vertexSize;\r\n  }\r\n}\r\n","export default \"attribute vec4 a_position;\\r\\n\\r\\n// Opacity \\r\\nattribute float a_opacity;\\r\\nvarying float v_opacity;\\r\\n\\r\\nattribute vec4 a_color;\\r\\nvarying vec4 v_color;\\r\\n\\r\\n// UV coordinate\\r\\nattribute vec2 a_texcoord;\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// Texture number\\r\\nattribute lowp float a_textureIndex;\\r\\nvarying lowp float v_textureIndex;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * a_position;\\r\\n\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the UV coord to the fragment shader\\r\\n   v_texcoord = a_texcoord;\\r\\n   // Pass through the texture number to the fragment shader\\r\\n   v_textureIndex = a_textureIndex;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\n#endif\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// Texture index\\r\\nvarying lowp float v_textureIndex;\\r\\n\\r\\n// Color coord to blend with image\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\n// Opacity\\r\\nvarying float v_opacity;\\r\\n\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\nfloat circle(in vec2 st, in float radius) {\\r\\n  vec2 dist = st - vec2(0.5);\\r\\n  float r = dot(dist, dist) * 4.0;\\r\\n  float delta = fwidth(r);\\r\\n  return 1.0 - smoothstep(radius - delta, radius + delta, r);\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n   // In order to support the most efficient sprite batching, we have multiple\\r\\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n   // that do not apply to a particular sprite.\\r\\n\\r\\n   vec4 color;\\r\\n   // -1 If there is no texture to sample we are drawing a solid geometry (rectangles)\\r\\n   if (v_textureIndex == -1.0) {\\r\\n     color = v_color;\\r\\n     color.w = color.w * v_opacity;\\r\\n   // -2 If there is no texture we are drawing a circle\\r\\n   } else if (v_textureIndex == -2.0) {\\r\\n     color = v_color;\\r\\n     color.a = color.a * circle(v_texcoord, .95);\\r\\n   } else {\\r\\n     // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n      %%texture_picker%%\\r\\n   }\\r\\n   color.w = color.w * v_opacity;\\r\\n   gl_FragColor = color;\\r\\n}\";","import { Shader } from './shader';\r\nimport pointVertexSource from './shaders/point-vertex.glsl';\r\nimport pointFragmentSource from './shaders/point-fragment.glsl';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { BatchRenderer } from './renderer';\r\nimport { BatchCommand } from './batch';\r\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\n// import { Random } from '../../Math/Index';\r\n\r\nexport class DrawPoint implements Poolable {\r\n  _pool?: Pool<this>;\r\n  public point: Vector = Vector.Zero;\r\n  public color: Color = Color.Black;\r\n  public size: number = 1;\r\n  public dispose() {\r\n    this.point.setTo(0, 0);\r\n    this.color.r = 0;\r\n    this.color.g = 0;\r\n    this.color.b = 0;\r\n    this.color.a = 1;\r\n    this.size = 1;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class PointRenderer extends BatchRenderer<DrawPoint> {\r\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\r\n    super({ gl, command: DrawPoint, verticesPerCommand: 1 });\r\n    this.init();\r\n  }\r\n\r\n  buildShader(gl: WebGLRenderingContext): Shader {\r\n    gl.getExtension('OES_standard_derivatives');\r\n    const shader = new Shader(gl, pointVertexSource, pointFragmentSource);\r\n    shader.addAttribute('a_position', 2, gl.FLOAT);\r\n    shader.addAttribute('a_color', 4, gl.FLOAT);\r\n    shader.addAttribute('a_size', 1, gl.FLOAT);\r\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\r\n    return shader;\r\n  }\r\n\r\n  addPoint(point: Vector, color: Color, size: number) {\r\n    const cmd = this.commands.get();\r\n    cmd.point = this._contextInfo.transform.current.multv(point);\r\n    cmd.color.r = color.r;\r\n    cmd.color.g = color.g;\r\n    cmd.color.b = color.b;\r\n    cmd.color.a = color.a * this._contextInfo.state.current.opacity;\r\n    cmd.size = size * Math.max(this._contextInfo.transform.current.getScaleX(), this._contextInfo.transform.current.getScaleY());\r\n    this.addCommand(cmd);\r\n  }\r\n\r\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<DrawPoint>): number {\r\n    let index = 0;\r\n    for (const command of batch.commands) {\r\n      vertexBuffer[index++] = command.point.x;\r\n      vertexBuffer[index++] = command.point.y;\r\n      // normalize to [0, 1] for webgl\r\n      vertexBuffer[index++] = command.color.r / 255;\r\n      vertexBuffer[index++] = command.color.g / 255;\r\n      vertexBuffer[index++] = command.color.b / 255;\r\n      vertexBuffer[index++] = command.color.a;\r\n\r\n      vertexBuffer[index++] = command.size;\r\n    }\r\n    return index / this.vertexSize;\r\n  }\r\n\r\n  renderBatch(gl: WebGLRenderingContext, _batch: BatchCommand<DrawPoint>, vertexCount: number): void {\r\n    gl.drawArrays(gl.POINTS, 0, vertexCount);\r\n  }\r\n}\r\n","export default \"attribute vec4 a_position;\\r\\nattribute vec4 a_color;\\r\\nattribute float a_size;\\r\\nvarying lowp vec4 v_color;\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = u_matrix * a_position;\\r\\n  gl_PointSize = a_size * 2.0;\\r\\n  v_color = a_color;\\r\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\n#endif\\r\\n\\r\\nprecision mediump float;\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\r\\n  r = dot(cxy, cxy);\\r\\n  \\r\\n#ifdef GL_OES_standard_derivatives\\r\\n  delta = fwidth(r);\\r\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\r\\n#else\\r\\n  if (r > 1.0) {\\r\\n    discard;\\r\\n  }\\r\\n#endif\\r\\n  gl_FragColor = vec4(v_color.rgb, v_color.a * alpha);\\r\\n}\";","import { Vector, vec } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\n\nexport interface GraphicOptions {\n  /**\n   * The width of the graphic\n   */\n  width?: number;\n  /**\n   * The height of the graphic\n   */\n  height?: number;\n  /**\n   * SHould the graphic be flipped horizontally\n   */\n  flipHorizontal?: boolean;\n  /**\n   * Should the graphic be flipped vertically\n   */\n  flipVertical?: boolean;\n  /**\n   * The rotation of the graphic\n   */\n  rotation?: number;\n  /**\n   * The scale of the graphic\n   */\n  scale?: Vector;\n  /**\n   * The opacity of the graphic\n   */\n  opacity?: number;\n  /**\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image\n   */\n  origin?: Vector;\n}\n\n/**\n * A Graphic is the base Excalibur primitive for something that can be drawn to the [[ExcaliburGraphicsContext]].\n * [[Sprite]], [[Animation]], [[GraphicsGroup]], [[Canvas]], [[Rectangle]], [[Circle]], and [[Polygon]] all derive from the\n * [[Graphic]] abstract class.\n *\n * Implementors of a Graphic must override the abstract [[Graphic._drawImage]] method to render an image to the graphics context. Graphic\n * handles all the position, rotation, and scale transformations in [[Graphic._preDraw]] and [[Graphic._postDraw]]\n */\nexport abstract class Graphic {\n  private static _ID: number = 0;\n  readonly id = Graphic._ID++;\n\n  /**\n   * Gets or sets wether to show debug information about the graphic\n   */\n  public showDebug: boolean = false;\n\n  /**\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\n   */\n  public flipHorizontal: boolean = false;\n\n  /**\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Gets or sets the rotation of the graphic\n   */\n  public rotation: number = 0;\n\n  /**\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\n   */\n  public opacity: number = 1;\n\n  /**\n   * Gets or sets the scale of the graphic, this affects the width and\n   */\n  public scale = Vector.One;\n\n  /**\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\n   */\n  public origin: Vector | null = null;\n\n  constructor(options?: GraphicOptions) {\n    if (options) {\n      this.origin = options.origin ?? this.origin;\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\n      this.rotation = options.rotation ?? this.rotation;\n      this.opacity = options.opacity ?? this.opacity;\n      this.scale = options.scale ?? this.scale;\n    }\n  }\n\n  public cloneGraphicOptions(): GraphicOptions {\n    return {\n      origin: this.origin ? this.origin.clone() : null,\n      flipHorizontal: this.flipHorizontal,\n      flipVertical: this.flipVertical,\n      rotation: this.rotation,\n      opacity: this.opacity,\n      scale: this.scale ? this.scale.clone() : null\n    };\n  }\n\n  private _width: number = 0;\n\n  /**\n   * Gets or sets the width of the graphic (always positive)\n   */\n  public get width() {\n    return Math.abs(this._width * this.scale.x);\n  }\n\n  private _height: number = 0;\n\n  /**\n   * Gets or sets the height of the graphic (always positive)\n   */\n  public get height() {\n    return Math.abs(this._height * this.scale.y);\n  }\n\n  public set width(value: number) {\n    this._width = value;\n  }\n\n  public set height(value: number) {\n    this._height = value;\n  }\n\n  /**\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\n  }\n\n  /**\n   * Draw the whole graphic to the context including transform\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._preDraw(ex, x, y);\n    this._drawImage(ex, 0, 0);\n    this._postDraw(ex);\n  }\n\n  /**\n   * Meant to be overriden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by [[Graphic._preDraw]]\n   * and [[Graphic._postDraw]]\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\n\n  /**\n   * Apply affine transformations to the graphics context to manipulate the graphic before [[Graphic._drawImage]]\n   * @param ex\n   * @param x\n   * @param y\n   */\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    ex.save();\n    ex.translate(x, y);\n    ex.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n    this._rotate(ex);\n    this._flip(ex);\n    // it is important to multiply alphas so graphics respect the current context\n    ex.opacity = ex.opacity * this.opacity;\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ex.scale(scaleDirX, scaleDirY);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, this.height / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  /**\n   * Apply any addtional work after [[Graphic._drawImage]] and restore the context state.\n   * @param ex\n   */\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      ex.debug.drawRect(0, 0, this.width, this.height);\n    }\n    ex.restore();\n  }\n\n  /**\n   * Returns a new instance of the graphic that has the same properties\n   */\n  abstract clone(): Graphic;\n}\n","/**\r\n * Watch an object with a proxy, only fires if property value is different\r\n */\r\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        if ((obj as any)[prop] !== value) {\r\n          (obj as any)[prop] = value;\r\n          // Avoid watching private junk\r\n          if (typeof prop === 'string') {\r\n            if (prop[0] !== '_') {\r\n              change(obj);\r\n            }\r\n          }\r\n        }\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n\r\n/**\r\n * Watch an object with a proxy, fires change on any property value change\r\n */\r\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        (obj as any)[prop] = value;\r\n        // Avoid watching private junk\r\n        if (typeof prop === 'string') {\r\n          if (prop[0] !== '_') {\r\n            change(obj);\r\n          }\r\n        }\r\n\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Color } from '../Color';\nimport { ensurePowerOfTwo } from './Context/webgl-util';\nimport { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { watch } from '../Util/Watch';\nimport { TextureLoader } from './Context/texture-loader';\n\nexport interface RasterOptions {\n  smoothing?: boolean;\n  color?: Color;\n  strokeColor?: Color;\n  lineWidth?: number;\n  lineDash?: number[];\n  padding?: number;\n}\n\n/**\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\n * [[ExcaliburGraphicsContext]]. This is useful for generating custom images using the 2D canvas api.\n *\n * Implementors must implemenet the [[Raster.execute]] method to rasterize their drawing.\n */\nexport abstract class Raster extends Graphic {\n  public _bitmap: HTMLCanvasElement;\n  protected _ctx: CanvasRenderingContext2D;\n  private _dirty: boolean = true;\n\n  constructor(options?: GraphicOptions & RasterOptions) {\n    super(options);\n    if (options) {\n      this.color = options.color ?? Color.Black;\n      this.strokeColor = options?.strokeColor;\n      this.smoothing = options.smoothing ?? this.smoothing;\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\n      this.lineDash = options.lineDash ?? this.lineDash;\n      this.padding = options.padding ?? this.padding;\n    }\n\n    this._bitmap = document.createElement('canvas');\n    // get the default canvas width/height as a fallback\n    const bitmapWidth = options?.width ?? this._bitmap.width;\n    const bitmapHeight = options?.height ?? this._bitmap.height;\n    // Rasters use power of two images as an optimization for webgl\n    this.width = ensurePowerOfTwo(bitmapWidth);\n    this.height = ensurePowerOfTwo(bitmapHeight);\n    const maybeCtx = this._bitmap.getContext('2d');\n    if (!maybeCtx) {\n      /* istanbul ignore next */\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\n    } else {\n      this._ctx = maybeCtx;\n    }\n  }\n\n  public cloneRasterOptions(): RasterOptions {\n    return {\n      color: this.color ? this.color.clone() : null,\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : null,\n      smoothing: this.smoothing,\n      lineWidth: this.lineWidth,\n      lineDash: this.lineDash,\n      padding: this.padding\n    };\n  }\n\n  /**\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\n   */\n  public get dirty() {\n    return this._dirty;\n  }\n\n  /**\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\n   * This should be called any time the graphics state changes such that it affects the outputed drawing\n   */\n  public flagDirty() {\n    this._dirty = true;\n  }\n\n  private _originalWidth: number;\n  /**\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding`s set will be factored into the width\n   */\n  public get width() {\n    return this._getTotalWidth();\n  }\n  public set width(value: number) {\n    this._bitmap.width = value;\n    this._originalWidth = value;\n    this.flagDirty();\n  }\n\n  private _originalHeight: number;\n  /**\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding` set will be factored into the height\n   */\n  public get height() {\n    return this._getTotalHeight();\n  }\n\n  public set height(value: number) {\n    this._bitmap.height = value;\n    this._originalHeight = value;\n    this.flagDirty();\n  }\n\n  private _getTotalWidth() {\n    return (this._originalWidth ?? this._bitmap.width) + this.padding * 2;\n  }\n\n  private _getTotalHeight() {\n    return (this._originalHeight ?? this._bitmap.height) + this.padding * 2;\n  }\n\n  /**\n   * Returns the local bounds of the Raster including the padding\n   */\n  public get localBounds() {\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\n  }\n\n  private _smoothing: boolean = false;\n  /**\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   */\n  public get smoothing() {\n    return this._smoothing;\n  }\n  public set smoothing(value: boolean) {\n    this._smoothing = value;\n    this.flagDirty();\n  }\n\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\n  /**\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get color() {\n    return this._color;\n  }\n  public set color(value) {\n    if (!this._color?.equal(value)) {\n      this.flagDirty();\n    }\n    this._color = watch(value, () => this.flagDirty());\n  }\n\n  private _strokeColor: Color;\n  /**\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get strokeColor() {\n    return this._strokeColor;\n  }\n  public set strokeColor(value) {\n    if (!this._strokeColor?.equal(value)) {\n      this.flagDirty();\n    }\n    this._strokeColor = watch(value, () => this.flagDirty());\n  }\n\n  private _lineWidth: number = 1;\n  /**\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get lineWidth() {\n    return this._lineWidth;\n  }\n  public set lineWidth(value) {\n    this._lineWidth = value;\n    this.flagDirty();\n  }\n\n  private _lineDash: number[] = [];\n  public get lineDash() {\n    return this._lineDash;\n  }\n\n  public set lineDash(value) {\n    this._lineDash = value;\n    this.flagDirty();\n  }\n\n  private _padding: number = 0;\n  public get padding() {\n    return this._padding;\n  }\n\n  public set padding(value: number) {\n    this._padding = value;\n    this.flagDirty();\n  }\n\n  /**\n   * Rasterize the graphic to a bitmap making it usuable as in excalibur. Rasterize is called automatically if\n   * the graphic is [[Raster.dirty]] on the next [[Graphic.draw]] call\n   */\n  public rasterize(): void {\n    this._dirty = false;\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\n    this._ctx.save();\n    this._applyRasterProperites(this._ctx);\n    this.execute(this._ctx);\n    this._ctx.restore();\n    // The webgl texture needs to be updated if it exists after a raster cycle\n    TextureLoader.load(this._bitmap, true);\n  }\n\n  protected _applyRasterProperites(ctx: CanvasRenderingContext2D) {\n    this._bitmap.width = this._getTotalWidth();\n    this._bitmap.height = this._getTotalHeight();\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = this.color?.toString();\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this._dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(this._bitmap, x, y);\n  }\n\n  /**\n   * Executes drawing implemenation of the graphic, this is where the specific drawing code for the graphic\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the [[ExcaliburGraphicsContext]] via `draw(...)`\n   * @param ctx Canvas to draw the graphic to\n   */\n  abstract execute(ctx: CanvasRenderingContext2D): void;\n}\n","import { GraphicOptions } from './Graphic';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CanvasOptions {\r\n  draw?: (ctx: CanvasRenderingContext2D) => void;\r\n  cache?: boolean;\r\n}\r\n\r\n/**\r\n * A canvas [[Graphic]] to provide an adapter between the 2D Canvas API and the [[ExcaliburGraphicsContext]].\r\n *\r\n * The [[Canvas]] works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\r\n * to the [[ExcaliburGraphicsContext]] implementation as a rendered image.\r\n *\r\n * **Low performance API**\r\n */\r\nexport class Canvas extends Raster {\r\n  /**\r\n   * Return the 2D graphics context of this canvas\r\n   */\r\n  public get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions) {\r\n    super(_options);\r\n  }\r\n\r\n  public clone(): Canvas {\r\n    return new Canvas({\r\n      ...this._options,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this._options?.draw) {\r\n      this._options?.draw(ctx);\r\n    }\r\n    if (!this._options.cache) {\r\n      this.flagDirty();\r\n    }\r\n  }\r\n}\r\n","import { Scene } from './Scene';\nimport { Vector } from './Math/vector';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\nimport { Collider } from './Collision/Colliders/Collider';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from './Interfaces/LifecycleEvents';\nimport { BodyComponent } from './Collision/BodyComponent';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\n   * to all actors that apply.\n   */\n  public get bubbles(): boolean {\n    return this._bubbles;\n  }\n\n  public set bubbles(value: boolean) {\n    this._bubbles = value;\n  }\n\n  private _bubbles: boolean = true;\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\nexport class ContactStartEvent<T> {\n  constructor(public target: T, public other: T, public contact: CollisionContact) {}\n}\n\nexport class ContactEndEvent<T> {\n  constructor(public target: T, public other: T) {}\n}\n\nexport class CollisionPreSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\nexport class CollisionPostSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param contact\n   */\n  constructor(actor: T, public other: T, public contact: CollisionContact) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: T) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\nexport class EventDispatcher<T = any> implements Eventable {\r\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\r\n  private _wiredEventDispatchers: Eventable[] = [];\r\n\r\n  private _target: T;\r\n\r\n  /**\r\n   * @param target  The object that will be the recipient of events from this event dispatcher\r\n   */\r\n  constructor(target: T) {\r\n    this._target = target;\r\n  }\r\n\r\n  /**\r\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\r\n   */\r\n  public clear() {\r\n    this._handlers = {};\r\n    this._wiredEventDispatchers = [];\r\n  }\r\n\r\n  /**\r\n   * Emits an event for target\r\n   * @param eventName  The name of the event to publish\r\n   * @param event      Optionally pass an event data object to the handler\r\n   */\r\n  public emit(eventName: string, event: GameEvent<T>) {\r\n    if (!eventName) {\r\n      // key not mapped\r\n      return;\r\n    }\r\n    eventName = eventName.toLowerCase();\r\n    const target = this._target;\r\n    if (!event) {\r\n      event = new GameEvent();\r\n    }\r\n    try {\r\n      if (!event.target) {\r\n        event.target = target;\r\n      }\r\n    } catch {\r\n      // pass\r\n    }\r\n    let i: number, len: number;\r\n\r\n    if (this._handlers[eventName]) {\r\n      i = 0;\r\n      len = this._handlers[eventName].length;\r\n\r\n      for (i; i < len; i++) {\r\n        this._handlers[eventName][i].call(target, event);\r\n      }\r\n    }\r\n\r\n    i = 0;\r\n    len = this._wiredEventDispatchers.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this._wiredEventDispatchers[i].emit(eventName, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\r\n   * @param eventName  The name of the event to subscribe to\r\n   * @param handler    The handler callback to fire on this event\r\n   */\r\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    if (!this._handlers[eventName]) {\r\n      this._handlers[eventName] = [];\r\n    }\r\n    this._handlers[eventName].push(handler);\r\n\r\n    // meta event handlers\r\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\r\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe an event handler(s) from an event. If a specific handler\r\n   * is specified for an event, only that handler will be unsubscribed.\r\n   * Otherwise all handlers will be unsubscribed for that event.\r\n   *\r\n   * @param eventName  The name of the event to unsubscribe\r\n   * @param handler    Optionally the specific handler to unsubscribe\r\n   */\r\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    const eventHandlers = this._handlers[eventName];\r\n\r\n    if (eventHandlers) {\r\n      // if no explicit handler is give with the event name clear all handlers\r\n      if (!handler) {\r\n        this._handlers[eventName].length = 0;\r\n      } else {\r\n        const index = eventHandlers.indexOf(handler);\r\n        this._handlers[eventName].splice(index, 1);\r\n      }\r\n    }\r\n    // meta event handlers\r\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\r\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    const metaHandler = (event: GameEvent<T>) => {\r\n      const ev = event || new GameEvent();\r\n      try {\r\n        ev.target = ev.target || this._target;\r\n      } catch {\r\n        // pass\r\n      }\r\n\r\n      this.off(eventName, handler);\r\n      handler.call(ev.target, ev);\r\n    };\r\n\r\n    this.on(eventName, metaHandler);\r\n  }\r\n\r\n  /**\r\n   * Wires this event dispatcher to also receive events from another\r\n   */\r\n  public wire(eventDispatcher: EventDispatcher): void {\r\n    eventDispatcher._wiredEventDispatchers.push(this);\r\n  }\r\n\r\n  /**\r\n   * Unwires this event dispatcher from another\r\n   */\r\n  public unwire(eventDispatcher: EventDispatcher): void {\r\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\r\n    if (index > -1) {\r\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\r\n    }\r\n  }\r\n}\r\n","import { Loadable } from '../Interfaces/Loadable';\r\nimport { Logger } from '../Util/Log';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\n\r\n/**\r\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\r\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\r\n */\r\nexport class Resource<T> implements Loadable<T> {\r\n  public data: T = null;\r\n  public logger: Logger = Logger.getInstance();\r\n  public events: EventDispatcher = new EventDispatcher(this);\r\n\r\n  /**\r\n   * @param path          Path to the remote resource\r\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\r\n   * @param bustCache     Whether or not to cache-bust requests\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\r\n    public bustCache: boolean = true\r\n  ) {}\r\n\r\n  /**\r\n   * Returns true if the Resource is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return this.data !== null;\r\n  }\r\n\r\n\r\n  private _cacheBust(uri: string): string {\r\n    const query: RegExp = /\\?\\w*=\\w*/;\r\n    if (query.test(uri)) {\r\n      uri += '&__=' + Date.now();\r\n    } else {\r\n      uri += '?__=' + Date.now();\r\n    }\r\n    return uri;\r\n  }\r\n  /**\r\n   * Begin loading the resource and returns a promise to be resolved on completion\r\n   */\r\n  public load(): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      // Exit early if we already have data\r\n      if (this.data !== null) {\r\n        this.logger.debug('Already have data for resource', this.path);\r\n        this.events.emit('complete', this.data as any);\r\n        resolve(this.data);\r\n        return;\r\n      }\r\n\r\n      const request = new XMLHttpRequest();\r\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\r\n      request.responseType = this.responseType;\r\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\r\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\r\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\r\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\r\n      request.addEventListener('load', () => {\r\n        // XHR on file:// success status is 0, such as with PhantomJS\r\n        if (request.status !== 0 && request.status !== 200) {\r\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\r\n          this.events.emit('error', request.response);\r\n          reject(new Error(request.statusText));\r\n          return;\r\n        }\r\n\r\n        this.data = request.response;\r\n        this.events.emit('complete', this.data as any);\r\n        this.logger.debug('Completed loading resource', this.path);\r\n        resolve(this.data);\r\n      });\r\n      request.send();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @module\r\n * @deprecated\r\n * These effects can be applied to any bitmap image but are mainly used\r\n * for [[Sprite]] effects or [[Animation]] effects.\r\n */\r\n\r\n/**\r\n * @typedoc\r\n */\r\n\r\nimport { obsolete } from '../Util/Decorators';\r\nimport { Color } from '../Color';\r\n\r\n/**\r\n * The interface that all sprite effects must implement\r\n * @deprecated SpriteEffect will be removed in v0.26.0\r\n */\r\nexport interface SpriteEffect {\r\n  /**\r\n   * Should update individual pixels values\r\n   * @param x          The pixel's x coordinate\r\n   * @param y          The pixel's y coordinate\r\n   * @param imageData  The sprite's raw pixel data\r\n   */\r\n  updatePixel(x: number, y: number, imageData: ImageData): void;\r\n}\r\n\r\n/**\r\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\r\n * @deprecated [[Grayscale]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Grayscale will be removed in v0.26.0'\r\n})\r\nexport class Grayscale implements SpriteEffect {\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\r\n    pixel[firstPixel + 0] = avg;\r\n    pixel[firstPixel + 1] = avg;\r\n    pixel[firstPixel + 2] = avg;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\r\n * @deprecated [[Invert]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Invert will be removed in v0.26.0'\r\n})\r\nexport class Invert implements SpriteEffect {\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\r\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\r\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\r\n * @deprecated [[Opacity]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Opacity will be removed in v0.26.0'\r\n})\r\nexport class Opacity implements SpriteEffect {\r\n  /**\r\n   * @param opacity  The new opacity of the sprite from 0-1.0\r\n   */\r\n  constructor(public opacity: number) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\r\n * average of the original color and the provided color\r\n * @deprecated [[Colorize]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Colorize will be removed in v0.26.0'\r\n})\r\nexport class Colorize implements SpriteEffect {\r\n  /**\r\n   * @param color  The color to apply to the sprite\r\n   */\r\n  constructor(public color: Color) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\r\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\r\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\r\n * @deprecated [[Lighten]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Lighten will be removed in v0.26.0'\r\n})\r\nexport class Lighten implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\r\n * @deprecated [[Darken]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Darken will be removed v0.26.0'\r\n})\r\nexport class Darken implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\r\n * @deprecated [[Saturate]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Saturate will be removed in v0.26.0'\r\n})\r\nexport class Saturate implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\r\n * @deprecated [[Desaturate]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Desaturate will be removed in v0.26.0'\r\n})\r\nexport class Desaturate implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\r\n * a given color\r\n * @deprecated [[Fill]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Fill will be removed in v0.26.0'\r\n})\r\nexport class Fill implements SpriteEffect {\r\n  /**\r\n   * @param color  The color to apply to the sprite\r\n   */\r\n  constructor(public color: Color) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 0] = this.color.r;\r\n      pixel[firstPixel + 1] = this.color.g;\r\n      pixel[firstPixel + 2] = this.color.b;\r\n    }\r\n  }\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n * @deprecated\r\n */\r\nexport class Texture implements Loadable<HTMLImageElement> {\r\n  private _resource: Resource<Blob>;\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n  private _sprite: Sprite = null;\r\n\r\n  /**\r\n   * Populated once loading is complete\r\n   */\r\n  public data: HTMLImageElement;\r\n  public get image() {\r\n    return this.data;\r\n  }\r\n\r\n  private _loadedResolve: (image: HTMLImageElement) => any;\r\n  public loaded = new Promise<HTMLImageElement>(resolve => {\r\n    this._loadedResolve = resolve;\r\n  });\r\n\r\n  /**\r\n   * @param path       Path to the image resource or a base64 string representing an image \"data:image/png;base64,iVB...\"\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public bustCache = true) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<HTMLImageElement> {\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      image.src = url;\r\n      await image.decode();\r\n\r\n      // Set results\r\n      this.data = image;\r\n      this.width = this._sprite.width = image.naturalWidth;\r\n      this.height = this._sprite.height = image.naturalHeight;\r\n      this._sprite = new Sprite(this, 0, 0, this.width, this.height);\r\n    } catch {\r\n      await Promise.reject('Error loading texture');\r\n    }\r\n    // todo emit complete\r\n    this._loadedResolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  public asSprite(): Sprite {\r\n    return this._sprite;\r\n  }\r\n}\r\n","export type Constructor<T> = {\r\n  new (...args: any[]): T;\r\n};\r\n/**\r\n * Configurable helper extends base type and makes all properties available as option bag arguments\r\n * @internal\r\n * @param base\r\n */\r\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\r\n  return class extends base {\r\n    public assign(props: Partial<T>) {\r\n      //set the value of every property that was passed in,\r\n      //if the constructor previously set this value, it will be overridden here\r\n      for (const k in props) {\r\n        // eslint-disable-next-line\r\n        if (typeof (<any>this)[k] !== 'function') {\r\n          // eslint-disable-next-line\r\n          (<any>this)[k] = (<any>props)[k];\r\n        }\r\n      }\r\n    }\r\n\r\n    constructor(...args: any[]) {\r\n      super(...args);\r\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\r\n      //of whatever ctor is the implementation, so args.length doesn't work here.\r\n      const size = args.filter(function(value) {\r\n        return value !== undefined;\r\n      }).length;\r\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\r\n        this.assign(args[0]);\r\n      }\r\n    }\r\n  };\r\n}\r\n","import * as Effects from './SpriteEffects';\r\nimport { Color } from '../Color';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Texture } from './Texture';\r\nimport { Vector } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { clamp } from '../Util/Util';\r\nimport { Configurable } from '../Configurable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * @hidden\r\n * @deprecated Use [[Sprite]]\r\n */\r\nexport class SpriteImpl implements Drawable {\r\n  public texture: Texture;\r\n\r\n  public x: number = 0;\r\n  public y: number = 0;\r\n\r\n  public get drawWidth(): number {\r\n    return Math.abs(this.width * this.scale.x);\r\n  }\r\n\r\n  public get drawHeight(): number {\r\n    return Math.abs(this.height * this.scale.y);\r\n  }\r\n\r\n  public rotation: number = 0.0;\r\n  public anchor: Vector = Vector.Half;\r\n  public offset: Vector = Vector.Zero;\r\n  public scale: Vector = Vector.One;\r\n  /**\r\n   * Default: false, should the sprite be drawn around the anchor or from the top left.\r\n   * Sprite rotations/scaling still happen around the anchor regardless of this setting.\r\n   */\r\n  public drawAroundAnchor = false;\r\n\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * Draws the sprite flipped vertically\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * Draws the sprite flipped horizontally\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  public effects: Effects.SpriteEffect[] = [];\r\n\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n\r\n  private _spriteCanvas: HTMLCanvasElement = null;\r\n  private _spriteCtx: CanvasRenderingContext2D = null;\r\n  private _pixelData: ImageData = null;\r\n  private _pixelsLoaded: boolean = false;\r\n  private _dirtyEffect: boolean = true;\r\n\r\n  /**\r\n   * @param imageOrConfig  The backing image texture to build the Sprite, or Sprite option bag\r\n   * @param x      The x position of the sprite\r\n   * @param y      The y position of the sprite\r\n   * @param width  The width of the sprite in pixels\r\n   * @param height The height of the sprite in pixels\r\n   */\r\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\r\n    let image = imageOrConfig;\r\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\r\n      x = imageOrConfig.x | 0;\r\n      y = imageOrConfig.y | 0;\r\n      width = imageOrConfig.width | 0;\r\n      height = imageOrConfig.height | 0;\r\n      image = imageOrConfig.image;\r\n      if (!image) {\r\n        const message = 'An image texture is required to construct a sprite';\r\n        throw new Error(message);\r\n      }\r\n    }\r\n\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n\r\n    this.texture = image as Texture;\r\n    this._spriteCanvas = document.createElement('canvas');\r\n    this._spriteCanvas.width = width;\r\n    this._spriteCanvas.height = height;\r\n    this._spriteCtx = this._spriteCanvas.getContext('2d');\r\n    this._initPixelsFromTexture();\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  private async _initPixelsFromTexture() {\r\n    try {\r\n      const image = await this.texture.loaded;\r\n      this.width = this.width || image.naturalWidth;\r\n      this.height = this.height || image.naturalHeight;\r\n      this._spriteCanvas.width = this._spriteCanvas.width || image.naturalWidth;\r\n      this._spriteCanvas.height = this._spriteCanvas.height || image.naturalHeight;\r\n      this._loadPixels();\r\n      this._dirtyEffect = true;\r\n    } catch (e) {\r\n      this.logger.error('Error loading texture ', this.texture.path, e);\r\n    }\r\n  }\r\n\r\n  private _loadPixels() {\r\n    if (this.texture.isLoaded() && !this._pixelsLoaded) {\r\n      const naturalWidth = this.texture.image.naturalWidth || 0;\r\n      const naturalHeight = this.texture.image.naturalHeight || 0;\r\n\r\n      if (this.width > naturalWidth) {\r\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \r\n                              ${naturalWidth} of the backing texture ${this.texture.path}`);\r\n      }\r\n\r\n      if (this.width <= 0 || naturalWidth <= 0) {\r\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\r\n      }\r\n\r\n      if (this.height > naturalHeight) {\r\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \r\n                              ${naturalHeight} of the backing texture ${this.texture.path}`);\r\n      }\r\n\r\n      if (this.height <= 0 || naturalHeight <= 0) {\r\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\r\n      }\r\n\r\n      this._flushTexture();\r\n\r\n      this._pixelsLoaded = true;\r\n    }\r\n  }\r\n\r\n  private _flushTexture() {\r\n    const naturalWidth = this.texture.image.naturalWidth || 0;\r\n    const naturalHeight = this.texture.image.naturalHeight || 0;\r\n\r\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\r\n    this._spriteCtx.drawImage(\r\n      this.texture.image,\r\n      clamp(this.x, 0, naturalWidth),\r\n      clamp(this.y, 0, naturalHeight),\r\n      clamp(this.width, 0, naturalWidth),\r\n      clamp(this.height, 0, naturalHeight),\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    );\r\n  }\r\n\r\n  private _opacity: number = 1;\r\n  /**\r\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\r\n   */\r\n  public opacity(value: number) {\r\n    this._opacity = value;\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\r\n   */\r\n  public grayscale() {\r\n    this.addEffect(new Effects.Grayscale());\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\r\n   */\r\n  public invert() {\r\n    this.addEffect(new Effects.Invert());\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\r\n   */\r\n  public fill(color: Color) {\r\n    this.addEffect(new Effects.Fill(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\r\n   * and the provided color.\r\n   */\r\n  public colorize(color: Color) {\r\n    this.addEffect(new Effects.Colorize(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\r\n   */\r\n  public lighten(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Lighten(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\r\n   */\r\n  public darken(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Darken(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\r\n   */\r\n  public saturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Saturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\r\n   */\r\n  public desaturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Desaturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[SpriteEffect]] to this drawing.\r\n   * @param effect  Effect to add to the this drawing\r\n   */\r\n  public addEffect(effect: Effects.SpriteEffect) {\r\n    this.effects.push(effect);\r\n    // We must check if the texture and the backing sprite pixels are loaded as well before\r\n    // an effect can be applied\r\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\r\n      this._dirtyEffect = true;\r\n    } else {\r\n      this._applyEffects();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[SpriteEffect]] from this sprite.\r\n   * @param effect  Effect to remove from this sprite\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n\r\n  /**\r\n   * Removes an effect given the index from this sprite.\r\n   * @param index  Index of the effect to remove from this sprite\r\n   */\r\n  public removeEffect(index: number): void;\r\n  public removeEffect(param: any) {\r\n    let indexToRemove = -1;\r\n    if (typeof param === 'number') {\r\n      indexToRemove = param;\r\n    } else {\r\n      indexToRemove = this.effects.indexOf(param);\r\n    }\r\n\r\n    // bounds check\r\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\r\n      return;\r\n    }\r\n\r\n    this.effects.splice(indexToRemove, 1);\r\n\r\n    // We must check if the texture and the backing sprite pixels are loaded as well before\r\n    // an effect can be applied\r\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\r\n      this._dirtyEffect = true;\r\n    } else {\r\n      this._applyEffects();\r\n    }\r\n  }\r\n\r\n  private _applyEffects() {\r\n    this._flushTexture();\r\n\r\n    if (this.effects.length > 0) {\r\n      this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n      const len = this.effects.length;\r\n      for (let i = 0; i < len; i++) {\r\n        for (let y = 0; y < this.height; y++) {\r\n          for (let x = 0; x < this.width; x++) {\r\n            this.effects[i].updatePixel(x, y, this._pixelData);\r\n          }\r\n        }\r\n      }\r\n      this._spriteCtx.clearRect(0, 0, this.width, this.height);\r\n      this._spriteCtx.putImageData(this._pixelData, 0, 0);\r\n    }\r\n\r\n    this._dirtyEffect = false;\r\n  }\r\n\r\n  /**\r\n   * Clears all effects from the drawing and return it to its original state.\r\n   */\r\n  public clearEffects() {\r\n    this.effects.length = 0;\r\n    this._applyEffects();\r\n  }\r\n\r\n  /**\r\n   * Resets the internal state of the drawing (if any)\r\n   */\r\n  public reset() {\r\n    // do nothing\r\n  }\r\n\r\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\r\n    ctx.save();\r\n    ctx.translate(x, y);\r\n    ctx.rotate(this.rotation);\r\n    const xpoint = this.drawWidth * this.anchor.x;\r\n    const ypoint = this.drawHeight * this.anchor.y;\r\n\r\n    ctx.strokeStyle = Color.Black.toString();\r\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the sprite with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.width,\r\n      drawHeight: options.drawHeight ?? this.height,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      offset: options.offset ?? this.offset,\r\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\r\n    };\r\n\r\n    if (this._dirtyEffect) {\r\n      this._applyEffects();\r\n    }\r\n    // calculating current dimensions\r\n    const anchorX = drawWidth * anchor.x + offset.x;\r\n    const anchorY = drawHeight * anchor.y + offset.y;\r\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\r\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\r\n\r\n    ctx.save();\r\n    // Move the draw point of origin\r\n    ctx.translate(x, y);\r\n\r\n    // Rotate and scale around anchor point\r\n    // This requires a bit of explaination, scale coordinates first positive flipping or rotating\r\n    ctx.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\r\n\r\n    if (this.drawAroundAnchor) {\r\n      // In the case where you want the anchor to match with the point of draw\r\n      // Otherwise sprites are always drawn from top-left\r\n      ctx.translate(-anchorX, -anchorY);\r\n    }\r\n\r\n    ctx.translate(anchorX, anchorY);\r\n    ctx.rotate(rotation);\r\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\r\n    ctx.scale(scaleDirX, scaleDirY);\r\n    ctx.translate(-anchorX, -anchorY);\r\n\r\n    if (flipHorizontal) {\r\n      ctx.translate(drawWidth, 0);\r\n      ctx.scale(-1, 1);\r\n    }\r\n\r\n    if (flipVertical) {\r\n      ctx.translate(0, drawHeight);\r\n      ctx.scale(1, -1);\r\n    }\r\n    const oldAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = opacity;\r\n    // Context is already rotated and scaled\r\n    ctx.drawImage(\r\n      this._spriteCanvas,\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height, // source\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    ); // dest\r\n    ctx.globalAlpha = oldAlpha;\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Produces a copy of the current sprite\r\n   */\r\n  public clone(): SpriteImpl {\r\n    const result = new Sprite(this.texture, this.x, this.y, this.width, this.height);\r\n    result.anchor = this.anchor.clone();\r\n    result.scale = this.scale.clone();\r\n    result.rotation = this.rotation;\r\n    result.flipHorizontal = this.flipHorizontal;\r\n    result.flipVertical = this.flipVertical;\r\n\r\n    const len = this.effects.length;\r\n    for (let i = 0; i < len; i++) {\r\n      result.addEffect(this.effects[i]);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use [[Sprite]]\r\n */\r\nexport interface SpriteArgs extends Partial<SpriteImpl> {\r\n  image?: Texture;\r\n  x?: number;\r\n  width?: number;\r\n  height?: number;\r\n  rotation?: number;\r\n  anchor?: Vector;\r\n  scale?: Vector;\r\n  flipVertical?: boolean;\r\n  flipHorizontal?: boolean;\r\n}\r\n\r\n/**\r\n * A [[LegacyDrawing.Sprite]] is one of the main drawing primitives. It is responsible for drawing\r\n * images or parts of images from a [[LegacyDrawing.Texture]] resource to the screen.\r\n * @deprecated Use [[Sprite]]\r\n */\r\n@obsolete({\r\n  message: 'Label.clearTextShadow will be removed in v0.26.0',\r\n  alternateMethod: 'Use Label.font.shadow'\r\n})\r\nexport class Sprite extends Configurable(SpriteImpl) {\r\n  constructor(config: SpriteArgs);\r\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\r\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\r\n    super(imageOrConfig, x, y, width, height);\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ImageSource } from './ImageSource';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\n\r\nimport { Sprite as LegacySprite } from '../Drawing/Sprite';\r\nimport { Texture } from '../Drawing/Texture';\r\n\r\nexport type SourceView = { x: number; y: number; width: number; height: number };\r\nexport type DestinationSize = { width: number; height: number };\r\n\r\nexport interface SpriteOptions {\r\n  /**\r\n   * Image to create a sprite from\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * By default the source is the entire dimension of the [[ImageSource]]\r\n   */\r\n  sourceView?: { x: number; y: number; width: number; height: number };\r\n  /**\r\n   * By default the size of the final sprite is the size of the [[ImageSource]]\r\n   */\r\n  destSize?: { width: number; height: number };\r\n}\r\n\r\nexport class Sprite extends Graphic {\r\n  public image: ImageSource;\r\n  public sourceView: SourceView;\r\n  public destSize: DestinationSize;\r\n\r\n  public static from(image: ImageSource): Sprite {\r\n    return new Sprite({\r\n      image: image\r\n    });\r\n  }\r\n\r\n  constructor(options: GraphicOptions & SpriteOptions) {\r\n    super(options);\r\n    this.image = options.image;\r\n    const { width, height } = options;\r\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\r\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\r\n    this._updateSpriteDimensions();\r\n    this.image.ready.then(() => {\r\n      this._updateSpriteDimensions();\r\n    });\r\n  }\r\n\r\n  private _updateSpriteDimensions() {\r\n    const { width: nativeWidth, height: nativeHeight } = this.image;\r\n    // This code uses || to avoid 0's\r\n    // If the source is not specified, use the native dimension\r\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\r\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\r\n\r\n    // If the destination is not specified, use the source if specified, then native\r\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\r\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\r\n\r\n    this.width = Math.ceil(this.destSize.width);\r\n    this.height = Math.ceil(this.destSize.height);\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      this._updateSpriteDimensions();\r\n    }\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      this._updateSpriteDimensions();\r\n      ex.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x,\r\n        this.sourceView.y,\r\n        this.sourceView.width,\r\n        this.sourceView.height,\r\n        x,\r\n        y,\r\n        this.destSize.width,\r\n        this.destSize.height\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a ImageSource from legacy texture\r\n   * @param sprite\r\n   */\r\n  public static fromLegacySprite(sprite: LegacySprite): Sprite {\r\n    const tex = sprite.texture;\r\n    const image = ImageSource.fromLegacyTexture(tex);\r\n    return new Sprite({\r\n      image,\r\n      sourceView: {\r\n        x: sprite.x,\r\n        y: sprite.y,\r\n        width: sprite.width,\r\n        height: sprite.height\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Converts a sprite to a Legacy sprite\r\n   * @deprecated\r\n   * @param sprite\r\n   * @returns LegacyDrawing.Sprite\r\n   */\r\n  public static toLegacySprite(sprite: Sprite): LegacySprite {\r\n    const image = sprite.image;\r\n    const tex = new Texture(image.path);\r\n    tex.data = image.image;\r\n\r\n    return new LegacySprite(tex, sprite.sourceView.x, sprite.sourceView.y, sprite.sourceView.width, sprite.sourceView.height);\r\n  }\r\n\r\n  public clone(): Sprite {\r\n    return new Sprite({\r\n      image: this.image,\r\n      sourceView: { ...this.sourceView },\r\n      destSize: { ...this.destSize },\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Texture } from '../Drawing/Texture';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport class ImageSource implements Loadable<HTMLImageElement> {\r\n  private _logger = Logger.getInstance();\r\n  private _resource: Resource<Blob>;\r\n\r\n  /**\r\n   * The original size of the source image in pixels\r\n   */\r\n  public get width() {\r\n    return this.image.naturalWidth;\r\n  }\r\n\r\n  /**\r\n   * The original height of the source image in pixels\r\n   */\r\n  public get height() {\r\n    return this.image.naturalHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return !!this.data.src;\r\n  }\r\n\r\n  /**\r\n   * Access to the underlying html image elmeent\r\n   */\r\n  public data: HTMLImageElement = new Image();\r\n  public get image(): HTMLImageElement {\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\r\n   */\r\n  public ready: Promise<HTMLImageElement>;\r\n  private _loadedResolve: (value?: HTMLImageElement | PromiseLike<HTMLImageElement>) => void;\r\n\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param path\r\n   */\r\n  constructor(public readonly path: string, bustCache: boolean = false) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    if (path.endsWith('.svg') || path.endsWith('.gif')) {\r\n      this._logger.warn(`Image type is not fully supported, you may have mixed results ${path}. Fully supported: jpg, bmp, and png`);\r\n    }\r\n    this.ready = new Promise<HTMLImageElement>((resolve) => {\r\n      this._loadedResolve = resolve;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Begins loading the image and returns a promise that resolves when the image is loaded\r\n   */\r\n  async load(): Promise<HTMLImageElement> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      image.src = url;\r\n      await image.decode();\r\n\r\n      // Set results\r\n      this.data = image;\r\n    } catch (error) {\r\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\r\n    }\r\n    // todo emit complete\r\n    this._loadedResolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Build a sprite from this ImageSource\r\n   */\r\n  public toSprite(): Sprite {\r\n    return Sprite.from(this);\r\n  }\r\n\r\n  /**\r\n   * Create a ImageSource from legacy texture\r\n   * @param tex\r\n   */\r\n  public static fromLegacyTexture(tex: Texture): ImageSource {\r\n    const image = new ImageSource(tex.path);\r\n    if (tex.isLoaded()) {\r\n      image.data = tex.data;\r\n    } else {\r\n      tex.loaded.then(() => {\r\n        image.data = tex.data;\r\n      });\r\n    }\r\n    return image;\r\n  }\r\n\r\n  /**\r\n   * Unload images from memory\r\n   */\r\n  unload(): void {\r\n    this.data = new Image();\r\n  }\r\n}\r\n","import { Sprite } from './Sprite';\r\nimport * as Effects from './SpriteEffects';\r\nimport { Color } from '../Color';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Vector } from '../Math/vector';\r\nimport { Engine } from '../Engine';\r\nimport * as Util from '../Util/Util';\r\nimport { Configurable } from '../Configurable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * @deprecated Use [[HasTick]]\r\n */\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\n/**\r\n * @hidden\r\n * @deprecated Use [[Animation]]\r\n */\r\nexport class AnimationImpl implements Drawable, HasTick {\r\n  /**\r\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\r\n   * generate an [[Animation]].\r\n   */\r\n  public sprites: Sprite[] = [];\r\n\r\n  /**\r\n   * Duration to show each frame (in milliseconds)\r\n   */\r\n  public speed: number;\r\n\r\n  /**\r\n   * Current frame index being shown\r\n   */\r\n  public currentFrame: number = 0;\r\n\r\n  private _timeLeftInFrame: number = 0;\r\n  private _idempotencyToken: number = -1;\r\n\r\n  public anchor: Vector = Vector.Zero;\r\n  public rotation: number = 0.0;\r\n  public scale: Vector = Vector.One;\r\n\r\n  /**\r\n   * Indicates whether the animation should loop after it is completed\r\n   */\r\n  public loop: boolean = true;\r\n\r\n  /**\r\n   * Indicates the frame index the animation should freeze on for a non-looping\r\n   * animation. By default it is the last frame.\r\n   */\r\n  public freezeFrame: number = -1;\r\n\r\n  private _engine: Engine;\r\n\r\n  /**\r\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  public drawWidth: number = 0;\r\n  public drawHeight: number = 0;\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n\r\n  private _opacity = 1;\r\n\r\n  /**\r\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\r\n   *\r\n   * @param engineOrConfig  Reference to the current game engine\r\n   * @param sprites  An array of sprites to create the frames for the animation\r\n   * @param speed   The number in milliseconds to display each frame in the animation\r\n   * @param loop    Indicates whether the animation should loop after it is completed\r\n   */\r\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\r\n    let engine = engineOrConfig;\r\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\r\n      const config = engineOrConfig;\r\n      engine = config.engine;\r\n      sprites = config.sprites;\r\n      speed = config.speed;\r\n      loop = config.loop;\r\n    }\r\n\r\n    this.sprites = sprites;\r\n    this.speed = speed;\r\n    this._engine = <Engine>engine;\r\n    this._timeLeftInFrame = this.speed;\r\n\r\n    if (loop != null) {\r\n      this.loop = loop;\r\n    }\r\n\r\n    if (sprites && sprites[0]) {\r\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\r\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\r\n\r\n      this.width = sprites[0] ? sprites[0].width : 0;\r\n      this.height = sprites[0] ? sprites[0].height : 0;\r\n\r\n      this.freezeFrame = sprites.length - 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\r\n   */\r\n  public opacity(value: number) {\r\n    this._opacity = value;\r\n  }\r\n\r\n  /**\r\n   * Applies the grayscale effect to a sprite, removing color information.\r\n   */\r\n  public grayscale() {\r\n    this.addEffect(new Effects.Grayscale());\r\n  }\r\n\r\n  /**\r\n   * Applies the invert effect to a sprite, inverting the pixel colors.\r\n   */\r\n  public invert() {\r\n    this.addEffect(new Effects.Invert());\r\n  }\r\n\r\n  /**\r\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\r\n   */\r\n  public fill(color: Color) {\r\n    this.addEffect(new Effects.Fill(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\r\n   * provided color.\r\n   */\r\n  public colorize(color: Color) {\r\n    this.addEffect(new Effects.Colorize(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\r\n   */\r\n  public lighten(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Lighten(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\r\n   */\r\n  public darken(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Darken(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\r\n   */\r\n  public saturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Saturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\r\n   */\r\n  public desaturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Desaturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Add a [[SpriteEffect]] manually\r\n   */\r\n  public addEffect(effect: Effects.SpriteEffect) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].addEffect(effect);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an [[SpriteEffect]] from this animation.\r\n   * @param effect Effect to remove from this animation\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n\r\n  /**\r\n   * Removes an effect given the index from this animation.\r\n   * @param index  Index of the effect to remove from this animation\r\n   */\r\n  public removeEffect(index: number): void;\r\n  public removeEffect(param: any) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].removeEffect(param);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all sprite effects\r\n   */\r\n  public clearEffects() {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].clearEffects();\r\n    }\r\n  }\r\n\r\n  private _setAnchor(point: Vector) {\r\n    //if (!this.anchor.equals(point)) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].anchor.setTo(point.x, point.y);\r\n    }\r\n    //}\r\n  }\r\n\r\n  private _setRotation(radians: number) {\r\n    //if (this.rotation !== radians) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].rotation = radians;\r\n    }\r\n    //}\r\n  }\r\n\r\n  private _setScale(scale: Vector) {\r\n    //if (!this.scale.equals(scale)) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].scale = scale;\r\n    }\r\n    //}\r\n  }\r\n\r\n  /**\r\n   * Resets the animation to first frame.\r\n   */\r\n  public reset() {\r\n    this.currentFrame = 0;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the animation is complete, animations that loop are never complete.\r\n   */\r\n  public isDone() {\r\n    return !this.loop && this.currentFrame >= this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Not meant to be called by game developers. Ticks the animation forward internally and\r\n   * calculates whether to change to the frame.\r\n   * @internal\r\n   */\r\n  public tick(elapsed: number, idempotencyToken?: number) {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    this._timeLeftInFrame -= elapsed;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\r\n      this._timeLeftInFrame = this.speed;\r\n    }\r\n\r\n    this._updateValues();\r\n    const current = this.sprites[this.currentFrame];\r\n    if (current) {\r\n      this.width = current.width;\r\n      this.height = current.height;\r\n      this.drawWidth = current.drawWidth;\r\n      this.drawHeight = current.drawHeight;\r\n    }\r\n  }\r\n\r\n  private _updateValues(): void {\r\n    this._setAnchor(this.anchor);\r\n    this._setRotation(this.rotation);\r\n    this._setScale(this.scale);\r\n  }\r\n\r\n  /**\r\n   * Skips ahead a specified number of frames in the animation\r\n   * @param frames  Frames to skip ahead\r\n   */\r\n  public skip(frames: number) {\r\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the animation with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const animOptions = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.drawWidth,\r\n      drawHeight: options.drawHeight ?? this.drawHeight,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\r\n    };\r\n\r\n    this._updateValues();\r\n    let currSprite: Sprite;\r\n    if (this.currentFrame < this.sprites.length) {\r\n      currSprite = this.sprites[this.currentFrame];\r\n      currSprite.draw(animOptions);\r\n    }\r\n\r\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\r\n      currSprite = this.sprites[Util.clamp(this.freezeFrame, 0, this.sprites.length - 1)];\r\n      currSprite.draw(animOptions);\r\n    }\r\n\r\n    // add the calculated width\r\n    if (currSprite) {\r\n      this.drawWidth = currSprite.drawWidth;\r\n      this.drawHeight = currSprite.drawHeight;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Plays an animation at an arbitrary location in the game.\r\n   * @param x  The x position in the game to play\r\n   * @param y  The y position in the game to play\r\n   */\r\n  public play(x: number, y: number) {\r\n    this.reset();\r\n    this._engine.playAnimation(this, x, y);\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use [[Animation]]\r\n */\r\nexport interface AnimationArgs extends Partial<AnimationImpl> {\r\n  engine: Engine;\r\n  sprites: Sprite[];\r\n  speed: number;\r\n  loop?: boolean;\r\n  anchor?: Vector;\r\n  rotation?: number;\r\n  scale?: Vector;\r\n  flipVertical?: boolean;\r\n  flipHorizontal?: boolean;\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\n/**\r\n * Animations allow you to display a series of images one after another,\r\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\r\n * @deprecated Use [[Animation]]\r\n */\r\n@obsolete({\r\n  message: 'Animation will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.Animation'\r\n})\r\nexport class Animation extends Configurable(AnimationImpl) {\r\n  constructor(config: AnimationArgs);\r\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\r\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\r\n    super(engineOrConfig, images, speed, loop);\r\n  }\r\n}\r\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em = 'em',\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n   */\n  Rem = 'rem',\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px = 'px',\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt = 'pt',\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent = '%'\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left = 'left',\n  /**\n   * The text is right-aligned.\n   */\n  Right = 'right',\n  /**\n   * The text is centered.\n   */\n  Center = 'center',\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start = 'start',\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End = 'end'\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top = 'top',\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging = 'hanging',\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle = 'middle',\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic = 'alphabetic',\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic = 'ideographic',\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom = 'bottom'\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal = 'normal',\n  Italic = 'italic',\n  Oblique = 'oblique'\n}\n\nexport enum Direction {\n  LeftToRight = 'ltr',\n  RightToLeft = 'rtl'\n}\n\nexport interface FontOptions {\n  size?: number;\n  unit?: FontUnit;\n  lineHeight?: number;\n  family?: string;\n  style?: FontStyle;\n  bold?: boolean;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  direction?: Direction;\n  quality?: number;\n  shadow?: {\n    blur?: number;\n    offset?: Vector;\n    color?: Color;\n  };\n}\n\nexport interface FontRenderer {\n  render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number): void;\n}\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from './Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { BaseAlign, TextAlign } from '../Graphics/FontCommon';\nimport { obsolete } from '../Util/Decorators';\nimport { vec } from '../Math/vector';\n\nexport interface SpriteSheetArgs {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number | SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetSpacingDimensions {\n  top?: number;\n  left?: number;\n  margin?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n * @deprecated Will be removed in v0.26.0\n */\nexport class SpriteSheet {\n  private _sprites: Sprite[] = [];\n  private _image: Texture | null = null;\n  private _columns: number = 0;\n  private _rows: number = 0;\n  private _spWidth: number = 0;\n  private _spHeight: number = 0;\n  private _spacing: number | SpriteSheetSpacingDimensions = 0;\n\n  /**\n   * @param config    The configuration of the SpriteSheet\n   */\n  constructor(config: SpriteSheetArgs);\n\n  /**\n   * @param sprites   The backing sprite array to use, if already available\n   */\n  constructor(sprites: Sprite[]);\n\n  /**\n   * @param image     The backing image texture to build the SpriteSheet\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    image: Texture,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfigOrSprites The backing image texture to build the SpriteSheet, option bag, or sprite list\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this._sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this._columns = imageOrConfigOrSprites.columns;\n        this._rows = imageOrConfigOrSprites.rows;\n        this._spWidth = imageOrConfigOrSprites.spWidth;\n        this._spHeight = imageOrConfigOrSprites.spHeight;\n        this._image = imageOrConfigOrSprites.image;\n        this._spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this._image = <Texture>imageOrConfigOrSprites;\n        this._columns = columns;\n        this._rows = rows;\n        this._spWidth = spWidth;\n        this._spHeight = spHeight;\n        this._spacing = spacing || 0;\n      }\n      this._sprites = new Array(this._columns * this._rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      if (this.image.isLoaded()) {\n        isWidthError = this.spWidth * this.columns > this.image.image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > this.image.image.naturalHeight;\n        if (isWidthError) {\n          throw new RangeError(\n            `SpriteSheet specified is wider, ` +\n              `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n              `pixels than image width`\n          );\n        }\n        if (isHeightError) {\n          throw new RangeError(\n            `SpriteSheet specified is taller, ` +\n              `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n              `pixels than image height`\n          );\n        }\n      }\n    }\n\n    if (loadFromImage) {\n      const spacing = this.getSpacingDimensions();\n\n      for (let row = 0; row < this.rows; row++) {\n        for (let col = 0; col < this.columns; col++) {\n          this._sprites[col + row * this.columns] = new Sprite(\n            this.image,\n            col * this.spWidth + spacing.margin * col + spacing.left,\n            row * this.spHeight + spacing.margin * row + spacing.top,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Gets the raw spacing dimensions for the sprites in the sheet, which can be a fixed number or custom dimensions.\n   */\n  public get spacing() {\n    return this._spacing;\n  }\n\n  /**\n   * Get a copy of the backing sprite array\n   */\n  public get sprites() {\n    return [...this._sprites];\n  }\n\n  /**\n   * The backing texture used for the sprite sheet\n   */\n  public get image() {\n    return this._image;\n  }\n\n  /**\n   * The number of columns in the sheet\n   */\n  public get columns() {\n    return this._columns;\n  }\n\n  /**\n   * The number of rows in the sheet\n   */\n  public get rows() {\n    return this._rows;\n  }\n\n  /**\n   * The width of the individual sprites\n   */\n  public get spWidth() {\n    return this._spWidth;\n  }\n\n  /**\n   * The height of the individual sprites\n   */\n  public get spHeight() {\n    return this._spHeight;\n  }\n\n  /**\n   * Gets the calculated spacing dimensions based on whether spacing\n   * is a fixed number or has different values for each dimension\n   */\n  public getSpacingDimensions(): SpriteSheetSpacingDimensions {\n    if (typeof this.spacing === 'number') {\n      return {\n        left: this.spacing,\n        top: this.spacing,\n        margin: this.spacing\n      };\n    } else {\n      return {\n        left: this.spacing.left ?? 0,\n        top: this.spacing.top ?? 0,\n        margin: this.spacing.margin ?? 0\n      };\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifying the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n * @deprecated Will be removed into v0.26.0\n */\n@obsolete({\n  message: 'SpriteSheet will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.SpriteSheet'\n})\nexport class SpriteFont extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _spriteRecord: Record<string, Sprite> = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  public readonly alphabet: string;\n  public readonly caseInsensitive: boolean;\n\n  constructor(config: SpriteFontArgs);\n\n  constructor(\n    image: Texture,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfig   The backing image texture to build the SpriteFont or the sprite font option bag\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    super(\n      imageOrConfig instanceof Texture\n        ? {\n          image: imageOrConfig,\n          spWidth: spWidth,\n          spHeight: spHeight,\n          rows: rows,\n          columns: columns,\n          spacing: spacing || 0\n        }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this.alphabet = alphabet;\n    this.caseInsensitive = caseInsensitive;\n    this._spriteRecord = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this.alphabet.length; i++) {\n      let char = this.alphabet[i];\n      if (this.caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._spriteRecord) {\n      this._textShadowSprites[character] = this._spriteRecord[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._spriteRecord) {\n        this._spriteRecord[char].clearEffects();\n        this._spriteRecord[char].fill(options.color);\n        this._spriteRecord[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.height;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.width * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this.caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].drawAroundAnchor = false;\n          this._textShadowSprites[character].scale = vec(scale, scale);\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._spriteRecord[character];\n        charSprite.drawAroundAnchor = false;\n        charSprite.scale = vec(scale, scale);\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n","import { ImageSource } from './ImageSource';\r\nimport { Sprite } from './Sprite';\r\nimport { SpriteSheet as LegacySpriteSheet } from '../Drawing/SpriteSheet';\r\nimport { Logger } from '..';\r\n\r\n\r\n/**\r\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\r\n * and have space between them.\r\n */\r\nexport interface SpriteSheetSpacingDimensions {\r\n  /**\r\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\r\n   * Default is (0, 0)\r\n   */\r\n  originOffset?: { x?: number, y?: number };\r\n\r\n  /**\r\n   * The margin between sprites.\r\n   * Default is (0, 0)\r\n   */\r\n  margin?: {x?: number, y?: number};\r\n}\r\n\r\n/**\r\n * Sprite sheet options for slicing up images\r\n */\r\nexport interface SpriteSheetGridOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * Grid definition for the sprite sheet\r\n   */\r\n  grid: {\r\n    /**\r\n     * Number of rows in the sprite sheet\r\n     */\r\n    rows: number;\r\n    /**\r\n     * Number of columns in the sprite sheet\r\n     */\r\n    columns: number;\r\n    /**\r\n     * Width of each individual sprite\r\n     */\r\n    spriteWidth: number;\r\n    /**\r\n     * Height of each individual sprite\r\n     */\r\n    spriteHeight: number;\r\n  };\r\n  /**\r\n   * Optionally specifiy any spacing information between sprites\r\n   */\r\n  spacing?: SpriteSheetSpacingDimensions;\r\n}\r\n\r\nexport interface SpriteSheetOptions {\r\n  /**\r\n   * Source sprites for the sprite sheet\r\n   */\r\n  sprites: Sprite[];\r\n  /**\r\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\r\n   */\r\n  rows?: number;\r\n  /**\r\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\r\n   */\r\n  columns?: number;\r\n}\r\n\r\n/**\r\n * Represents a collection of sprites from a source image with some organization in a grid\r\n */\r\nexport class SpriteSheet {\r\n  private _logger = Logger.getInstance();\r\n  public readonly sprites: Sprite[] = [];\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  /**\r\n   * Build a new sprite sheet from a list of sprites\r\n   *\r\n   * Use [[SpriteSheet.fromImageSource]] to create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   * @param options\r\n   */\r\n  constructor(options: SpriteSheetOptions) {\r\n    const { sprites, rows, columns } = options;\r\n    this.sprites = sprites;\r\n    this.rows = rows ?? 1;\r\n    this.columns = columns ?? this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y position in the SpriteSheet, for example `getSprite(0, 0)` is the [[Sprite]] in the top-left\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public getSprite(x: number, y: number): Sprite | null {\r\n    if (x >= this.columns || x < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\r\n      return null;\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\r\n      return null;\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    return this.sprites[spriteIndex];\r\n  }\r\n\r\n  /**\r\n   * To a graphics sprite sheet from a legacy sprite sheet\r\n   */\r\n  public static fromLegacySpriteSheet(legacySpriteSheet: LegacySpriteSheet): SpriteSheet {\r\n    const sprites = legacySpriteSheet.sprites.map(oldSprite => Sprite.fromLegacySprite(oldSprite));\r\n    return new SpriteSheet({\r\n      sprites\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @param spriteSheet\r\n   * @returns\r\n   */\r\n  public static toLegacySpriteSheet(spriteSheet: SpriteSheet): LegacySpriteSheet {\r\n    const sprites = spriteSheet.sprites.map(sprite => Sprite.toLegacySprite(sprite));\r\n    return new LegacySpriteSheet(sprites);\r\n  }\r\n\r\n  /**\r\n   * Create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   *\r\n   * Example:\r\n   * ```\r\n   * const spriteSheet = SpriteSheet.fromImageSource({\r\n   *   image: imageSource,\r\n   *   grid: {\r\n   *     rows: 5,\r\n   *     columns: 2,\r\n   *     spriteWidth: 32, // pixels\r\n   *     spriteHeight: 32 // pixels\r\n   *   },\r\n   *   // Optionally specify spacing\r\n   *   spacing: {\r\n   *     // pixels from the top left to start the sprite parsing\r\n   *     originOffset: {\r\n   *       x: 5,\r\n   *       y: 5\r\n   *     },\r\n   *     // pixels between each sprite while parsing\r\n   *     margin: {\r\n   *       x: 1,\r\n   *       y: 1\r\n   *     }\r\n   *   }\r\n   * })\r\n   * ```\r\n   *\r\n   * @param options\r\n   */\r\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\r\n    const sprites: Sprite[] = [];\r\n    options.spacing = options.spacing ?? {};\r\n    const {\r\n      image,\r\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\r\n      spacing: { originOffset, margin }\r\n    } = options;\r\n    const offsetDefaults = { x: 0, y: 0, ...originOffset};\r\n    const marginDefaults = { x: 0, y: 0, ...margin};\r\n    for (let x = 0; x < cols; x++) {\r\n      for (let y = 0; y < rows; y++) {\r\n        sprites[x + y * cols] = new Sprite({\r\n          image: image,\r\n          sourceView: {\r\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\r\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\r\n            width: spriteWidth,\r\n            height: spriteHeight\r\n          },\r\n          destSize: { height: spriteHeight, width: spriteWidth }\r\n        });\r\n      }\r\n    }\r\n    return new SpriteSheet({\r\n      sprites: sprites,\r\n      rows: rows,\r\n      columns: cols\r\n    });\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { SpriteFont as LegacySpriteFont } from '../Drawing/Index';\nimport { Logger } from '../Util/Log';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet } from './SpriteSheet';\n\nexport interface SpriteFontOptions {\n  /**\n   * Alphabet string in spritsheet order (default is row column order)\n   * example: 'abcdefghijklmnopqrstuvwxyz'\n   */\n  alphabet: string;\n  /**\n   * [[SpriteSheet]] to source character sprites from\n   */\n  spriteSheet: SpriteSheet;\n  /**\n   * Optionally ignore case in the supplied text;\n   */\n  caseInsensitive?: boolean;\n  /**\n   * Optionally adjust the spacing between character sprites\n   */\n  spacing?: number;\n  /**\n   * Optionally specify a \"shadow\"\n   */\n  shadow?: { offset: Vector };\n}\n\nexport class SpriteFont extends Graphic implements FontRenderer {\n  private _text = '';\n  private _dirty = true;\n  public alphabet: string = '';\n  public spriteSheet: SpriteSheet;\n\n  public shadow: { offset: Vector } = null;\n  public caseInsensitive = false;\n  public spacing: number = 0;\n\n  private _logger = Logger.getInstance();\n\n  static fromLegacySpriteFont(spriteFont: LegacySpriteFont): SpriteFont {\n    const sprites = spriteFont.sprites.map(Sprite.fromLegacySprite);\n    return new SpriteFont({\n      alphabet: spriteFont.alphabet,\n      spacing: 0,\n      caseInsensitive: spriteFont.caseInsensitive,\n      spriteSheet: new SpriteSheet({\n        sprites\n      })\n    });\n  }\n\n  constructor(options: SpriteFontOptions & GraphicOptions) {\n    super(options);\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow } = options;\n    this.alphabet = alphabet;\n    this.spriteSheet = spriteSheet;\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\n    this.spacing = spacing ?? this.spacing;\n    this.shadow = shadow ?? this.shadow;\n\n    this.spriteSheet.sprites[0].image.ready.then(() => {\n      this._updateDimensions();\n    });\n  }\n\n  private _sprites: Sprite[] = [];\n  private _getCharacterSprites(text: string): Sprite[] {\n    if (!this._dirty) {\n      return this._sprites;\n    }\n\n    const results: Sprite[] = [];\n    // handle case insenstive\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\n\n    // for each letter in text\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\n      // find the sprite index in alphabet , if there is an error pick the first\n      const letter = textToRender[letterIndex];\n      let spriteIndex = alphabet.indexOf(letter);\n      if (spriteIndex === -1) {\n        spriteIndex = 0;\n        this._logger.warn(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'`);\n      }\n\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\n      if (letterSprite) {\n        results.push(letterSprite);\n      } else {\n        this._logger.warn(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\n      }\n    }\n    this._dirty = false;\n    return (this._sprites = results);\n  }\n\n  private _updateDimensions() {\n    const sprites = this._getCharacterSprites(this._text);\n    let width = 0;\n    let height = 0;\n    for (const sprite of sprites) {\n      width += sprite.width + this.spacing;\n      height = Math.max(height, sprite.height);\n    }\n    this.width = width;\n    this.height = height;\n  }\n\n  public updateText(text: string) {\n    if (this._text !== text) {\n      this._dirty = true;\n      this._text = text;\n      this._updateDimensions();\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    let cursor = 0;\n    for (const sprite of this._getCharacterSprites(this._text)) {\n      // draw it in the right spot and increase the cursor by sprite width\n      sprite.draw(ex, x + cursor, y);\n      cursor += sprite.width + this.spacing;\n    }\n  }\n\n  render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number) {\n    if (this._text !== text) {\n      this._dirty = true;\n      this._text = text;\n    }\n\n    if (this.shadow) {\n      ex.save();\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\n      this.draw(ex, x, y);\n      ex.restore();\n    }\n\n    this.draw(ex, x, y);\n  }\n\n  clone(): SpriteFont {\n    return new SpriteFont({\n      alphabet: this.alphabet,\n      spriteSheet: this.spriteSheet,\n      spacing: this.spacing\n    });\n  }\n}\n","import { ExcaliburGraphicsContext, ImageSource, SpriteFont, SpriteSheet } from '..';\r\nimport { Vector } from '../..';\r\nimport debugFont from './debug-font.png';\r\n\r\n/**\r\n * Internal debugtext helper\r\n */\r\nexport class DebugText {\r\n  constructor() {\r\n    this.load();\r\n  }\r\n\r\n  /**\r\n   * base64 font\r\n   */\r\n  public readonly fontSheet = debugFont;\r\n  public size: number = 16;\r\n  private _imageSource: ImageSource;\r\n  private _spriteSheet: SpriteSheet;\r\n  private _spriteFont: SpriteFont;\r\n  public load() {\r\n    this._imageSource = new ImageSource(this.fontSheet);\r\n    return this._imageSource.load().then(() => {\r\n      this._spriteSheet = SpriteSheet.fromImageSource({\r\n        image: this._imageSource,\r\n        grid: {\r\n          rows: 3,\r\n          columns: 16,\r\n          spriteWidth: 16,\r\n          spriteHeight: 16\r\n        }\r\n      });\r\n      this._spriteFont = new SpriteFont({\r\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+ ',\r\n        caseInsensitive: true,\r\n        spriteSheet: this._spriteSheet,\r\n        spacing: -6\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Writes debug text using the built in sprint font\r\n   * @param ctx\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\r\n    if (this._imageSource.isLoaded()) {\r\n      this._spriteFont.render(ctx, text, pos.x, pos.y);\r\n    }\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  RectGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\n\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { TransformStack } from './transform-stack';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { Logger } from '../../Util/Log';\r\nimport { LineRenderer } from './line-renderer';\r\nimport { ImageRenderer } from './image-renderer';\r\nimport { PointRenderer } from './point-renderer';\r\nimport { Canvas } from '../Canvas';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\nimport { ScreenDimension } from '../../Screen';\r\n\r\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\r\n\r\n  /**\r\n   * Draw a debugging rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\r\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging line to the context\r\n   * @param start\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._webglCtx.__lineRenderer.addLine(start, end, lineOptions.color);\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging point to the context\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._webglCtx.__pointRenderer.addPoint(point, pointOptions.color, pointOptions.size);\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._webglCtx, text, pos);\r\n  }\r\n}\r\n\r\nexport interface WebGLGraphicsContextInfo {\r\n  transform: TransformStack;\r\n  state: StateStack;\r\n  matrix: Matrix;\r\n}\r\n\r\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __gl: WebGLRenderingContext;\r\n\r\n  /**\r\n   * Holds the 2d context shim\r\n   */\r\n  private _canvas: Canvas; // Configure z for shim?\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n\r\n  private _transform = new TransformStack();\r\n  private _state = new StateStack();\r\n  private _ortho!: Matrix;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __pointRenderer: PointRenderer;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __lineRenderer: LineRenderer;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __imageRenderer: ImageRenderer;\r\n\r\n  public snapToPixel: boolean = true;\r\n\r\n  public smoothing: boolean = false;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get width() {\r\n    return this.__gl.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__gl.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\r\n   * @param dim\r\n   */\r\n  public checkIfResolutionSupported(dim: ScreenDimension): boolean {\r\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\r\n    const gl = this.__gl;\r\n    // If any dimension is greater than max texture size (divide by 4 bytes per pixel)\r\n    const maxDim = gl.getParameter(gl.MAX_TEXTURE_SIZE) / 4;\r\n    let supported = true;\r\n    if (dim.width > maxDim ||dim.height > maxDim) {\r\n      supported = false;\r\n    }\r\n    return supported;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, smoothing, snapToPixel, backgroundColor } = options;\r\n    this.__gl = canvasElement.getContext('webgl', {\r\n      antialias: smoothing ?? this.smoothing,\r\n      premultipliedAlpha: false,\r\n      alpha: enableTransparency ?? true,\r\n      depth: true,\r\n      powerPreference: 'high-performance'\r\n    });\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this._init();\r\n  }\r\n\r\n  private _init() {\r\n    const gl = this.__gl;\r\n    // Setup viewport and view matrix\r\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    // Clear background\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    // Enable alpha blending\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    this.__pointRenderer = new PointRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n    this.__lineRenderer = new LineRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n    this.__imageRenderer = new ImageRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n\r\n    // 2D ctx shim\r\n    this._canvas = new Canvas({\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height\r\n    });\r\n    this.__ctx = this._canvas.ctx;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this._transform.current = Matrix.identity();\r\n  }\r\n\r\n  public updateViewport(): void {\r\n    const gl = this.__gl;\r\n    this._ortho = this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    this.__pointRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n    this.__lineRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n    this.__imageRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n\r\n    // 2D ctx shim\r\n    this._canvas.width = gl.canvas.width;\r\n    this._canvas.height = gl.canvas.height;\r\n  }\r\n\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    if (!image) {\r\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\r\n      // tslint:disable-next-line: no-console\r\n      if (console.trace) {\r\n        // tslint:disable-next-line: no-console\r\n        console.trace();\r\n      }\r\n      return;\r\n    }\r\n    this.__imageRenderer.addImage(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__imageRenderer.addLine(color, start, end, thickness);\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__imageRenderer.addRectangle(color, pos, width, height);\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color) {\r\n    this.__imageRenderer.addCircle(pos, radius, color);\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\r\n\r\n  public save(): void {\r\n    this._transform.save();\r\n    this._state.save();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._transform.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  public translate(x: number, y: number): void {\r\n    this._transform.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\r\n  }\r\n\r\n  public rotate(angle: number): void {\r\n    this._transform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): void {\r\n    this._transform.scale(x, y);\r\n  }\r\n\r\n  public transform(matrix: Matrix) {\r\n    this._transform.current = matrix;\r\n  }\r\n\r\n  clear() {\r\n    const gl = this.__gl;\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    // Clear the context with the newly set color. This is\r\n    // the function call that actually does the drawing.\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes all batched rendering to the screen\r\n   */\r\n  flush() {\r\n    const gl = this.__gl;\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    this.__imageRenderer.render();\r\n    this.__lineRenderer.render();\r\n    this.__pointRenderer.render();\r\n  }\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { Camera } from './Camera';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { BoundingBox } from './Collision/Index';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { getPosition } from './Util/Util';\r\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\r\n\r\n/**\r\n * Enum representing the different display modes available to Excalibur.\r\n */\r\nexport enum DisplayMode {\r\n  /**\r\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\r\n   */\r\n  Fixed = 'Fixed',\r\n\r\n  /**\r\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\r\n   * This is not the same as [[Screen.goFullScreen]] but behaves in a similar way maintaining aspect ratio.\r\n   *\r\n   * You may want to center your game here is an example\r\n   * ```html\r\n   * <!-- html -->\r\n   * <body>\r\n   * <main>\r\n   *   <canvas id=\"game\"></canvas>\r\n   * </main>\r\n   * </body>\r\n   * ```\r\n   *\r\n   * ```css\r\n   * // css\r\n   * main {\r\n   *   display: flex;\r\n   *   align-items: center;\r\n   *   justify-content: center;\r\n   *   height: 100%;\r\n   *   width: 100%;\r\n   * }\r\n   * ```\r\n   *\r\n   */\r\n  FitScreen = 'FitScreen',\r\n\r\n  /**\r\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\r\n   * change dynamically as the window is resized. This is not the same as [[Screen.goFullScreen]]\r\n   */\r\n  FillScreen = 'FillScreen',\r\n\r\n  /**\r\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\r\n   */\r\n  FitContainer = 'FitContainer',\r\n\r\n  /**\r\n   * Use the parent DOM container's css width/height for the game resolution dynamically\r\n   */\r\n  FillContainer = 'FillContainer',\r\n\r\n  /**\r\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\r\n   * @deprecated Use CSS to position the game canvas, will be removed in v0.26.0\r\n   */\r\n  Position = 'Position'\r\n}\r\n\r\n/**\r\n * Convenience class for quick resolutions\r\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\r\n */\r\nexport class Resolution {\r\n  /* istanbul ignore next */\r\n  public static get SVGA(): ScreenDimension {\r\n    return { width: 800, height: 600 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Standard(): ScreenDimension {\r\n    return { width: 1920, height: 1080 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Atari2600(): ScreenDimension {\r\n    return { width: 160, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoy(): ScreenDimension {\r\n    return { width: 160, height: 144 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoyAdvance(): ScreenDimension {\r\n    return { width: 240, height: 160 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NintendoDS(): ScreenDimension {\r\n    return { width: 256, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NES(): ScreenDimension {\r\n    return { width: 256, height: 224 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get SNES(): ScreenDimension {\r\n    return { width: 256, height: 244 };\r\n  }\r\n}\r\n\r\n/**\r\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\r\n * is specified and when the user wants to define exact pixel spacing of the window.\r\n * When a number is given, the value is interpreted as pixels\r\n */\r\nexport interface AbsolutePosition {\r\n  top?: number | string;\r\n  left?: number | string;\r\n  right?: number | string;\r\n  bottom?: number | string;\r\n}\r\n\r\nexport type CanvasPosition = string | AbsolutePosition;\r\n\r\nexport interface ScreenDimension {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ScreenOptions {\r\n  /**\r\n   * Canvas element to build a screen on\r\n   */\r\n  canvas: HTMLCanvasElement;\r\n  /**\r\n   * Graphics context for the screen\r\n   */\r\n  context: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Browser abstraction\r\n   */\r\n  browser: BrowserEvents;\r\n  /**\r\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\r\n   */\r\n  antialiasing?: boolean;\r\n  /**\r\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\r\n   */\r\n  pixelRatio?: number;\r\n  /**\r\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\r\n   * resolution will be the same as the viewport. Resolution will be overridden by [[DisplayMode.FillContainer]] and\r\n   * [[DisplayMode.FillScreen]].\r\n   */\r\n  resolution?: ScreenDimension;\r\n  /**\r\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\r\n   */\r\n  viewport: ScreenDimension;\r\n  /**\r\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\r\n   */\r\n  displayMode?: DisplayMode;\r\n  /**\r\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\r\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\r\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\r\n   *\r\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\r\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\r\n   */\r\n  position?: CanvasPosition;\r\n}\r\n\r\n/**\r\n * The Screen handles all aspects of interacting with the screen for Excalibur.\r\n */\r\nexport class Screen {\r\n  private _canvas: HTMLCanvasElement;\r\n  private _ctx: ExcaliburGraphicsContext;\r\n  private _antialiasing: boolean = true;\r\n  private _browser: BrowserEvents;\r\n  private _camera: Camera;\r\n  private _resolution: ScreenDimension;\r\n  private _resolutionStack: ScreenDimension[] = [];\r\n  private _viewport: ScreenDimension;\r\n  private _viewportStack: ScreenDimension[] = [];\r\n  private _pixelRatioOverride: number | null = null;\r\n  private _position: CanvasPosition;\r\n  private _displayMode: DisplayMode;\r\n  private _isFullScreen = false;\r\n  private _mediaQueryList: MediaQueryList;\r\n  private _isDisposed = false;\r\n  private _logger = Logger.getInstance();\r\n  private _resizeObserver: ResizeObserver;\r\n\r\n  constructor(options: ScreenOptions) {\r\n    this.viewport = options.viewport;\r\n    this.resolution = options.resolution ?? { ...this.viewport };\r\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    this._canvas = options.canvas;\r\n    this._ctx = options.context;\r\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\r\n    this._browser = options.browser;\r\n    this._position = options.position;\r\n    this._pixelRatioOverride = options.pixelRatio;\r\n    this._applyDisplayMode();\r\n\r\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\r\n    this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler);\r\n\r\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    this.applyResolutionAndViewport();\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (!this._isDisposed) {\r\n      // Clean up handlers\r\n      this._isDisposed = true;\r\n      this._browser.window.off('resize', this._resizeHandler);\r\n      if (this._resizeObserver) {\r\n        this._resizeObserver.disconnect();\r\n      }\r\n      this.parent.removeEventListener('resize', this._resizeHandler);\r\n      this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\r\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    }\r\n  }\r\n\r\n  private _fullscreenChangeHandler = () => {\r\n    this._isFullScreen = !this._isFullScreen;\r\n    this._logger.debug('Fullscreen Change', this._isFullScreen);\r\n  };\r\n\r\n  private _pixelRatioChangeHandler = () => {\r\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\r\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _resizeHandler = () => {\r\n    const parent = this.parent;\r\n    this._logger.debug('View port resized');\r\n    this._setResolutionAndViewportByDisplayMode(parent);\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _calculateDevicePixelRatio() {\r\n    if (window.devicePixelRatio < 1) {\r\n      return 1;\r\n    }\r\n\r\n    const devicePixelRatio = window.devicePixelRatio || 1;\r\n\r\n    return devicePixelRatio;\r\n  }\r\n\r\n  // Asking the window.devicePixelRatio is expensive we do it once\r\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\r\n\r\n  public get pixelRatio(): number {\r\n    if (this._pixelRatioOverride) {\r\n      return this._pixelRatioOverride;\r\n    }\r\n\r\n    return this._devicePixelRatio;\r\n  }\r\n\r\n  public get isHiDpi() {\r\n    return this.pixelRatio !== 1;\r\n  }\r\n\r\n  public get displayMode(): DisplayMode {\r\n    return this._displayMode;\r\n  }\r\n\r\n  public get canvas(): HTMLCanvasElement {\r\n    return this._canvas;\r\n  }\r\n\r\n  public get parent(): HTMLElement | Window {\r\n    return <HTMLElement | Window>(\r\n      (this.displayMode === DisplayMode.FillContainer || this.displayMode === DisplayMode.FitContainer\r\n        ? this.canvas.parentElement || document.body\r\n        : window)\r\n    );\r\n  }\r\n\r\n  public get resolution(): ScreenDimension {\r\n    return this._resolution;\r\n  }\r\n\r\n  public set resolution(resolution: ScreenDimension) {\r\n    this._resolution = resolution;\r\n  }\r\n\r\n  public get viewport(): ScreenDimension {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n    return this._resolution;\r\n  }\r\n\r\n  public set viewport(viewport: ScreenDimension) {\r\n    this._viewport = viewport;\r\n  }\r\n\r\n  public get aspectRatio() {\r\n    return this._resolution.width / this._resolution.height;\r\n  }\r\n\r\n  public get scaledWidth() {\r\n    return this._resolution.width * this.pixelRatio;\r\n  }\r\n\r\n  public get scaledHeight() {\r\n    return this._resolution.height * this.pixelRatio;\r\n  }\r\n\r\n  public setCurrentCamera(camera: Camera) {\r\n    this._camera = camera;\r\n  }\r\n\r\n  public pushResolutionAndViewport() {\r\n    this._resolutionStack.push(this.resolution);\r\n    this._viewportStack.push(this.viewport);\r\n\r\n    this.resolution = { ...this.resolution };\r\n    this.viewport = { ...this.viewport };\r\n  }\r\n\r\n  public peekViewport(): ScreenDimension {\r\n    return this._viewportStack[this._viewportStack.length - 1];\r\n  }\r\n\r\n  public peekResolution(): ScreenDimension {\r\n    return this._resolutionStack[this._resolutionStack.length - 1];\r\n  }\r\n\r\n  public popResolutionAndViewport() {\r\n    this.resolution = this._resolutionStack.pop();\r\n    this.viewport = this._viewportStack.pop();\r\n  }\r\n\r\n  private _alreadyWarned = false;\r\n  public applyResolutionAndViewport() {\r\n    this._canvas.width = this.scaledWidth;\r\n    this._canvas.height = this.scaledHeight;\r\n\r\n    if (this._ctx instanceof ExcaliburGraphicsContextWebGL) {\r\n      const supported = this._ctx.checkIfResolutionSupported({\r\n        width: this.scaledWidth,\r\n        height: this.scaledHeight\r\n      });\r\n      if (!supported && !this._alreadyWarned) {\r\n        this._alreadyWarned = true; // warn once\r\n        this._logger.warn(\r\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height})` +\r\n          ' is too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\r\n          ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\r\n          ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\r\n      }\r\n    }\r\n\r\n    if (this._antialiasing) {\r\n      this._canvas.style.imageRendering = 'auto';\r\n    } else {\r\n      this._canvas.style.imageRendering = 'pixelated';\r\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\r\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\r\n      if (this._canvas.style.imageRendering === '') {\r\n        this._canvas.style.imageRendering = 'crisp-edges';\r\n      }\r\n    }\r\n    this._canvas.style.width = this.viewport.width + 'px';\r\n    this._canvas.style.height = this.viewport.height + 'px';\r\n\r\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\r\n    this._ctx.updateViewport();\r\n    this._ctx.resetTransform();\r\n    this._ctx.scale(this.pixelRatio, this.pixelRatio);\r\n    this._ctx.smoothing = this._antialiasing;\r\n  }\r\n\r\n  public get antialiasing() {\r\n    return this._antialiasing;\r\n  }\r\n\r\n  public set antialiasing(isSmooth: boolean) {\r\n    this._antialiasing = isSmooth;\r\n    this._ctx.smoothing = this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreened using the browser fullscreen api\r\n   */\r\n  public get isFullScreen() {\r\n    return this._isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   */\r\n  public goFullScreen(): Promise<void> {\r\n    return this._canvas.requestFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Requests to exit fullscreen using the browser fullscreen api\r\n   */\r\n  public exitFullScreen(): Promise<void> {\r\n    return document.exitFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\r\n   * Excalibur screen space.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public pageToScreenCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    if (!this._isFullScreen) {\r\n      newX -= getPosition(this._canvas).x;\r\n      newY -= getPosition(this._canvas).y;\r\n    }\r\n\r\n    // if fullscreen api on it centers with black bars\r\n    // we need to adjust the screen to world coordinates in this case\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = ((newY - screenMarginY) / screenHeight) * this.viewport.height;\r\n        newX = (newX / window.innerWidth) * this.viewport.width;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = ((newX - screenMarginX) / screenWidth) * this.viewport.width;\r\n        newY = (newY / window.innerHeight) * this.viewport.height;\r\n      }\r\n    }\r\n\r\n    newX = (newX / this.viewport.width) * this.resolution.width;\r\n    newY = (newY / this.viewport.height) * this.resolution.height;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\r\n   * this is where html elements might live if you want to position them relative to Excalibur.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public screenToPageCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    newX = (newX / this.resolution.width) * this.viewport.width;\r\n    newY = (newY / this.resolution.height) * this.viewport.height;\r\n\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = (newY / this.viewport.height) * screenHeight + screenMarginY;\r\n        newX = (newX / this.viewport.width) * window.innerWidth;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = (newX / this.viewport.width) * screenWidth + screenMarginX;\r\n        newY = (newY / this.viewport.height) * window.innerHeight;\r\n      }\r\n    }\r\n\r\n    if (!this._isFullScreen) {\r\n      newX += getPosition(this._canvas).x;\r\n      newY += getPosition(this._canvas).y;\r\n    }\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\r\n   *\r\n   * World space is where [[Entity|entities]] in Excalibur live by default [[CoordPlane.World]]\r\n   * and extends infinitely out relative from the [[Camera]].\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    // transform back to world space\r\n    newX = (newX / this.resolution.width) * this.drawWidth;\r\n    newY = (newY / this.resolution.height) * this.drawHeight;\r\n\r\n    // transform based on zoom\r\n    newX = newX - this.halfDrawWidth;\r\n    newY = newY - this.halfDrawHeight;\r\n\r\n    // shift by camera focus\r\n    newX += this._camera?.x ?? 0;\r\n    newY += this._camera?.y ?? 0;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\r\n   *\r\n   * Screen space is where [[ScreenElement|screen elements]] and [[Entity|entities]] with [[CoordPlane.Screen]] live.\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    let screenX = point.x;\r\n    let screenY = point.y;\r\n\r\n    // shift by camera focus\r\n    screenX -= this._camera?.x ?? 0;\r\n    screenY -= this._camera?.y ?? 0;\r\n\r\n    // transform back on zoom\r\n    screenX = screenX + this.halfDrawWidth;\r\n    screenY = screenY + this.halfDrawHeight;\r\n\r\n    // transform back to screen space\r\n    screenX = (screenX / this.drawWidth) * this.resolution.width;\r\n    screenY = (screenY / this.drawHeight) * this.resolution.height;\r\n\r\n    return new Vector(screenX, screenY);\r\n  }\r\n\r\n  public pageToWorldCoordinates(point: Vector): Vector {\r\n    const screen = this.pageToScreenCoordinates(point);\r\n    return this.screenToWorldCoordinates(screen);\r\n  }\r\n\r\n  public worldToPageCoordinates(point: Vector): Vector {\r\n    const screen = this.worldToScreenCoordinates(point);\r\n    return this.screenToPageCoordinates(screen);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   *\r\n   * World bounds are in world coordinates, useful for culling objects offscreen\r\n   */\r\n  public getWorldBounds(): BoundingBox {\r\n    const left = this.screenToWorldCoordinates(Vector.Zero).x;\r\n    const top = this.screenToWorldCoordinates(Vector.Zero).y;\r\n    const right = left + this.drawWidth;\r\n    const bottom = top + this.drawHeight;\r\n\r\n    return new BoundingBox(left, top, right, bottom);\r\n  }\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.canvas.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.canvas.width / 2;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.canvas.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    if (this._camera) {\r\n      return this.resolution.width / this._camera.zoom;\r\n    }\r\n    return this.resolution.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.drawWidth / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    if (this._camera) {\r\n      return this.resolution.height / this._camera.zoom;\r\n    }\r\n    return this.resolution.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.drawHeight / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns screen center coordinates including zoom and device pixel ratio.\r\n   */\r\n  public get center(): Vector {\r\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\r\n  }\r\n\r\n  private _computeFit() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (window.innerWidth / aspect < window.innerHeight) {\r\n      adjustedWidth = window.innerWidth;\r\n      adjustedHeight = window.innerWidth / aspect;\r\n    } else {\r\n      adjustedWidth = window.innerHeight * aspect;\r\n      adjustedHeight = window.innerHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n  }\r\n\r\n  private _computeFitContainer() {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    const parent = this.canvas.parentElement;\r\n    if (parent.clientWidth / aspect < parent.clientHeight) {\r\n      adjustedWidth = parent.clientWidth;\r\n      adjustedHeight = parent.clientWidth / aspect;\r\n    } else {\r\n      adjustedWidth = parent.clientHeight * aspect;\r\n      adjustedHeight = parent.clientHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n  }\r\n\r\n  private _applyDisplayMode() {\r\n    if (this.displayMode === DisplayMode.Position) {\r\n      this._initializeDisplayModePosition(this._position);\r\n    } else {\r\n      this._setResolutionAndViewportByDisplayMode(this.parent);\r\n\r\n      // watch resizing\r\n      if (this.parent instanceof Window) {\r\n        this._browser.window.on('resize', this._resizeHandler);\r\n      } else {\r\n        this._resizeObserver = new ResizeObserver(() => {\r\n          this._resizeHandler();\r\n        });\r\n        this._resizeObserver.observe(this.parent);\r\n      }\r\n      this.parent.addEventListener('resize', this._resizeHandler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the resoultion and viewport based on the selected display mode.\r\n   */\r\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\r\n    if (this.displayMode === DisplayMode.FillContainer) {\r\n      this.resolution = {\r\n        width: (<HTMLElement>parent).clientWidth,\r\n        height: (<HTMLElement>parent).clientHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FillScreen) {\r\n      document.body.style.margin = '0px';\r\n      document.body.style.overflow = 'hidden';\r\n      this.resolution = {\r\n        width: (<Window>parent).innerWidth,\r\n        height: (<Window>parent).innerHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreen) {\r\n      this._computeFit();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainer) {\r\n      this._computeFitContainer();\r\n    }\r\n  }\r\n\r\n  private _initializeDisplayModePosition(position: CanvasPosition) {\r\n    if (!position) {\r\n      throw new Error('DisplayMode of Position was selected but no position option was given');\r\n    } else {\r\n      this.canvas.style.display = 'block';\r\n      this.canvas.style.position = 'absolute';\r\n\r\n      if (typeof position === 'string') {\r\n        const specifiedPosition = position.split(' ');\r\n\r\n        switch (specifiedPosition[0]) {\r\n          case 'top':\r\n            this.canvas.style.top = '0px';\r\n            break;\r\n          case 'bottom':\r\n            this.canvas.style.bottom = '0px';\r\n            break;\r\n          case 'middle':\r\n            this.canvas.style.top = '50%';\r\n            const offsetY = -this.halfDrawHeight;\r\n            this.canvas.style.marginTop = offsetY.toString();\r\n            break;\r\n          default:\r\n            throw new Error('Invalid Position Given');\r\n        }\r\n\r\n        if (specifiedPosition[1]) {\r\n          switch (specifiedPosition[1]) {\r\n            case 'left':\r\n              this.canvas.style.left = '0px';\r\n              break;\r\n            case 'right':\r\n              this.canvas.style.right = '0px';\r\n              break;\r\n            case 'center':\r\n              this.canvas.style.left = '50%';\r\n              const offsetX = -this.halfDrawWidth;\r\n              this.canvas.style.marginLeft = offsetX.toString();\r\n              break;\r\n            default:\r\n              throw new Error('Invalid Position Given');\r\n          }\r\n        }\r\n      } else {\r\n        if (position.top) {\r\n          typeof position.top === 'number'\r\n            ? (this.canvas.style.top = position.top.toString() + 'px')\r\n            : (this.canvas.style.top = position.top);\r\n        }\r\n        if (position.right) {\r\n          typeof position.right === 'number'\r\n            ? (this.canvas.style.right = position.right.toString() + 'px')\r\n            : (this.canvas.style.right = position.right);\r\n        }\r\n        if (position.bottom) {\r\n          typeof position.bottom === 'number'\r\n            ? (this.canvas.style.bottom = position.bottom.toString() + 'px')\r\n            : (this.canvas.style.bottom = position.bottom);\r\n        }\r\n        if (position.left) {\r\n          typeof position.left === 'number'\r\n            ? (this.canvas.style.left = position.left.toString() + 'px')\r\n            : (this.canvas.style.left = position.left);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Internal class used to build instances of AudioContext\r\n */\r\n/* istanbul ignore next */\r\nexport class AudioContextFactory {\r\n  private static _INSTANCE: AudioContext = null;\r\n\r\n  public static create(): AudioContext {\r\n    if (!this._INSTANCE) {\r\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\r\n        this._INSTANCE = new AudioContext();\r\n      }\r\n    }\r\n\r\n    return this._INSTANCE;\r\n  }\r\n}\r\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\r\nimport { Logger } from './Log';\r\n\r\nexport interface LegacyWebAudioSource {\r\n  playbackState: string;\r\n  PLAYING_STATE: 'playing';\r\n  FINISHED_STATE: 'finished';\r\n}\r\n\r\n/**\r\n * Patch for detecting legacy web audio in browsers\r\n * @internal\r\n * @param source\r\n */\r\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\r\n  return !!source.playbackState;\r\n}\r\n\r\nexport class WebAudio {\r\n  private static _UNLOCKED: boolean = false;\r\n\r\n  /**\r\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\r\n   * right after a user interaction event.\r\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\r\n   */\r\n  static unlock(): Promise<boolean> {\r\n    const promise = new Promise<boolean>((resolve, reject) => {\r\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\r\n        return resolve(true);\r\n      }\r\n      const unlockTimeoutTimer = setTimeout(() => {\r\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\r\n        resolve(false);\r\n      }, 200);\r\n\r\n      const audioContext = AudioContextFactory.create();\r\n      audioContext.resume().then(\r\n        () => {\r\n          // create empty buffer and play it\r\n          const buffer = audioContext.createBuffer(1, 1, 22050);\r\n          const source = audioContext.createBufferSource();\r\n          let ended = false;\r\n\r\n          source.buffer = buffer;\r\n          source.connect(audioContext.destination);\r\n          source.onended = () => (ended = true);\r\n\r\n          source.start(0);\r\n\r\n          // by checking the play state after some time, we know if we're really unlocked\r\n          setTimeout(() => {\r\n            if (isLegacyWebAudioSource(source)) {\r\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            } else {\r\n              if (audioContext.currentTime > 0 || ended) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            }\r\n          }, 0);\r\n\r\n          clearTimeout(unlockTimeoutTimer);\r\n          resolve(true);\r\n        },\r\n        () => {\r\n          reject();\r\n        }\r\n      );\r\n    });\r\n\r\n\r\n    return promise;\r\n  }\r\n\r\n  static isUnlocked() {\r\n    return this._UNLOCKED;\r\n  }\r\n}\r\n","import { GameEvent } from './Events';\r\nimport { EventDispatcher } from './EventDispatcher';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\n/**\r\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\r\n * and extending abilities for vanilla Javascript projects\r\n */\r\nexport class Class implements Eventable {\r\n  /**\r\n   * Direct access to the game object event dispatcher.\r\n   */\r\n  public eventDispatcher: EventDispatcher;\r\n\r\n  constructor() {\r\n    this.eventDispatcher = new EventDispatcher(this);\r\n  }\r\n\r\n  /**\r\n   * Alias for `addEventListener`. You can listen for a variety of\r\n   * events off of the engine; see the events section below for a complete list.\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Alias for `removeEventListener`. If only the eventName is specified\r\n   * it will remove all handlers registered for that specific event. If the eventName\r\n   * and the handler instance are specified only that handler will be removed.\r\n   *\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Emits a new event\r\n   * @param eventName   Name of the event to emit\r\n   * @param eventObject Data associated with this event\r\n   */\r\n  public emit(eventName: string, eventObject: GameEvent<any>) {\r\n    this.eventDispatcher.emit(eventName, eventObject);\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.once(eventName, handler);\r\n  }\r\n}\r\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/* istanbul ignore next */\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/* istanbul ignore next */\n/**\n * Draw the vector as a point onto the canvas.\n */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\n/**\n *\n */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param stroke The [[Color]] to stroke rectangle with\n * @param fill The [[Color]] to fill rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\n/**\n *\n */\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","import { Color } from './Color';\r\nimport { WebAudio } from './Util/WebAudio';\r\nimport { Engine } from './Engine';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Class } from './Class';\r\nimport * as DrawUtil from './Util/DrawUtil';\r\n\r\nimport logoImg from './Loader.logo.png';\r\nimport loaderCss from './Loader.css';\r\nimport { Canvas } from './Graphics/Canvas';\r\nimport { Vector } from './Math/vector';\r\nimport { clamp, delay } from './Util/Util';\r\n\r\n/**\r\n * Pre-loading assets\r\n *\r\n * The loader provides a mechanism to preload multiple resources at\r\n * one time. The loader must be passed to the engine in order to\r\n * trigger the loading progress bar.\r\n *\r\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\r\n *\r\n * ## Example: Pre-loading resources for a game\r\n *\r\n * ```js\r\n * // create a loader\r\n * var loader = new ex.Loader();\r\n *\r\n * // create a resource dictionary (best practice is to keep a separate file)\r\n * var resources = {\r\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\r\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\r\n * };\r\n *\r\n * // loop through dictionary and add to loader\r\n * for (var loadable in resources) {\r\n *   if (resources.hasOwnProperty(loadable)) {\r\n *     loader.addResource(resources[loadable]);\r\n *   }\r\n * }\r\n *\r\n * // start game\r\n * game.start(loader).then(function () {\r\n *   console.log(\"Game started!\");\r\n * });\r\n * ```\r\n *\r\n * ## Customize the Loader\r\n *\r\n * The loader can be customized to show different, text, logo, background color, and button.\r\n *\r\n * ```typescript\r\n * const loader = new ex.Loader([playerTexture]);\r\n *\r\n * // The loaders button text can simply modified using this\r\n * loader.playButtonText = 'Start the best game ever';\r\n *\r\n * // The logo can be changed by inserting a base64 image string here\r\n *\r\n * loader.logo = 'data:image/png;base64,iVBORw...';\r\n * loader.logoWidth = 15;\r\n * loader.logoHeight = 14;\r\n *\r\n * // The background color can be changed like so by supplying a valid CSS color string\r\n *\r\n * loader.backgroundColor = 'red'\r\n * loader.backgroundColor = '#176BAA'\r\n *\r\n * // To build a completely new button\r\n * loader.startButtonFactory = () => {\r\n *     let myButton = document.createElement('button');\r\n *     myButton.textContent = 'The best button';\r\n *     return myButton;\r\n * };\r\n *\r\n * engine.start(loader).then(() => {});\r\n * ```\r\n */\r\nexport class Loader extends Class implements Loadable<Loadable<any>[]> {\r\n  public canvas: Canvas = new Canvas({\r\n    smoothing: true,\r\n    draw: this.draw.bind(this)\r\n  });\r\n  private _resourceList: Loadable<any>[] = [];\r\n  private _index = 0;\r\n\r\n  private _playButtonShown: boolean = false;\r\n  private _resourceCount: number = 0;\r\n  private _numLoaded: number = 0;\r\n  private _progressCounts: { [key: string]: number } = {};\r\n  private _totalCounts: { [key: string]: number } = {};\r\n  private _engine: Engine;\r\n\r\n  // logo drawing stuff\r\n\r\n  // base64 string encoding of the excalibur logo (logo-white.png)\r\n  public logo = logoImg;\r\n  public logoWidth = 468;\r\n  public logoHeight = 118;\r\n  /**\r\n   * Positions the top left corner of the logo image\r\n   * If not set, the loader automatically positions the logo\r\n   */\r\n  public logoPosition: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the play button.\r\n   * If not set, the loader automatically positions the play button\r\n   */\r\n  public playButtonPosition: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the loading bar\r\n   * If not set, the loader automatically positions the loading bar\r\n   */\r\n  public loadingBarPosition: Vector | null;\r\n\r\n  /**\r\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\r\n   */\r\n  public loadingBarColor: Color = Color.White;\r\n\r\n  /**\r\n   * Gets or sets the background color of the loader as a hex string\r\n   */\r\n  public backgroundColor: string = '#176BAA';\r\n\r\n  protected _imageElement: HTMLImageElement;\r\n  protected get _image() {\r\n    if (!this._imageElement) {\r\n      this._imageElement = new Image();\r\n      this._imageElement.src = this.logo;\r\n    }\r\n\r\n    return this._imageElement;\r\n  }\r\n\r\n  public suppressPlayButton: boolean = false;\r\n  public get playButtonRootElement(): HTMLElement | null {\r\n    return this._playButtonRootElement;\r\n  }\r\n  public get playButtonElement(): HTMLButtonElement | null {\r\n    return this._playButtonElement;\r\n  }\r\n  protected _playButtonRootElement: HTMLElement;\r\n  protected _playButtonElement: HTMLButtonElement;\r\n  protected _styleBlock: HTMLStyleElement;\r\n  /** Loads the css from Loader.css */\r\n  protected _playButtonStyles: string = loaderCss.toString();\r\n  protected get _playButton() {\r\n    const existingRoot = document.getElementById('excalibur-play-root');\r\n    if (existingRoot) {\r\n      this._playButtonRootElement = existingRoot;\r\n    }\r\n    if (!this._playButtonRootElement) {\r\n      this._playButtonRootElement = document.createElement('div');\r\n      this._playButtonRootElement.id = 'excalibur-play-root';\r\n      this._playButtonRootElement.style.position = 'absolute';\r\n      document.body.appendChild(this._playButtonRootElement);\r\n    }\r\n    if (!this._styleBlock) {\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._playButtonStyles;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n    if (!this._playButtonElement) {\r\n      this._playButtonElement = this.startButtonFactory();\r\n      this._playButtonRootElement.appendChild(this._playButtonElement);\r\n    }\r\n    return this._playButtonElement;\r\n  }\r\n\r\n  /**\r\n   * Get/set play button text\r\n   */\r\n  public playButtonText: string = 'Play game';\r\n\r\n  /**\r\n   * Return a html button element for excalibur to use as a play button\r\n   */\r\n  public startButtonFactory = () => {\r\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\r\n    if (!buttonElement) {\r\n      buttonElement = document.createElement('button');\r\n    }\r\n\r\n    buttonElement.id = 'excalibur-play';\r\n    buttonElement.textContent = this.playButtonText;\r\n    buttonElement.style.display = 'none';\r\n    return buttonElement;\r\n  };\r\n\r\n  /**\r\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\r\n   */\r\n  constructor(loadables?: Loadable<any>[]) {\r\n    super();\r\n\r\n    if (loadables) {\r\n      this.addResources(loadables);\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    this._engine = engine;\r\n    this.canvas.width = this._engine.canvas.width;\r\n    this.canvas.height = this._engine.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Add a resource to the loader to load\r\n   * @param loadable  Resource to add\r\n   */\r\n  public addResource(loadable: Loadable<any>) {\r\n    const key = this._index++;\r\n    this._resourceList.push(loadable);\r\n    this._progressCounts[key] = 0;\r\n    this._totalCounts[key] = 1;\r\n    this._resourceCount++;\r\n  }\r\n\r\n  /**\r\n   * Add a list of resources to the loader to load\r\n   * @param loadables  The list of resources to load\r\n   */\r\n  public addResources(loadables: Loadable<any>[]) {\r\n    let i = 0;\r\n    const len = loadables.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this.addResource(loadables[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns true if the loader has completely loaded all resources\r\n   */\r\n  public isLoaded() {\r\n    return this._numLoaded === this._resourceCount;\r\n  }\r\n\r\n  /**\r\n   * Shows the play button and returns a promise that resolves when clicked\r\n   */\r\n  public showPlayButton(): Promise<void> {\r\n    if (this.suppressPlayButton) {\r\n      this.hidePlayButton();\r\n      return Promise.resolve();\r\n    } else {\r\n      const resizeHandler = () => {\r\n        this._positionPlayButton();\r\n      };\r\n      if (this._engine?.browser) {\r\n        this._engine.browser.window.on('resize', resizeHandler);\r\n      }\r\n      this._playButtonShown = true;\r\n      this._playButton.style.display = 'block';\r\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\r\n        if (evt.key === 'Enter') {\r\n          this._playButton.click();\r\n        }\r\n      });\r\n      const promise = new Promise<void>((resolve) => {\r\n        const startButtonHandler = (e: Event) => {\r\n          // We want to stop propogation to keep bubbling to the engine pointer handlers\r\n          e.stopPropagation();\r\n          // Hide Button after click\r\n          this.hidePlayButton();\r\n          if (this._engine?.browser) {\r\n            this._engine.browser.window.off('resize', resizeHandler);\r\n          }\r\n          resolve();\r\n        };\r\n        this._playButton.addEventListener('click', startButtonHandler);\r\n        this._playButton.addEventListener('touchend', startButtonHandler);\r\n        this._playButton.addEventListener('pointerup', startButtonHandler);\r\n      });\r\n\r\n      return promise;\r\n    }\r\n  }\r\n\r\n  public hidePlayButton() {\r\n    this._playButtonShown = false;\r\n    this._playButton.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Clean up generated elements for the loader\r\n   */\r\n  public dispose() {\r\n    if (this._playButtonRootElement.parentElement) {\r\n      this._playButtonRootElement.removeChild(this._playButtonElement);\r\n      document.body.removeChild(this._playButtonRootElement);\r\n      document.head.removeChild(this._styleBlock);\r\n      this._playButtonRootElement = null;\r\n      this._playButtonElement = null;\r\n      this._styleBlock = null;\r\n    }\r\n  }\r\n\r\n  update(_engine: Engine, _delta: number): void {\r\n    // override me\r\n  }\r\n\r\n  data: Loadable<any>[];\r\n\r\n  /**\r\n   * Begin loading all of the supplied resources, returning a promise\r\n   * that resolves when loading of all is complete\r\n   */\r\n  public async load(): Promise<Loadable<any>[]> {\r\n    await Promise.all(\r\n      this._resourceList.map((r) =>\r\n        r.load().finally(() => {\r\n          // capture progress\r\n          this._numLoaded++;\r\n        })\r\n      )\r\n    );\r\n\r\n    // short delay in showing the button for aesthetics\r\n    await delay(200);\r\n    await this.showPlayButton();\r\n    // Unlock browser AudioContext in after user gesture\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\r\n    await WebAudio.unlock();\r\n\r\n    return (this.data = this._resourceList);\r\n  }\r\n\r\n  public markResourceComplete(): void {\r\n    this._numLoaded++;\r\n  }\r\n\r\n  /**\r\n   * Returns the progess of the loader as a number between [0, 1] inclusive.\r\n   */\r\n  public get progress(): number {\r\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\r\n  }\r\n\r\n  private _positionPlayButton() {\r\n    const screenHeight = this._engine.screen.viewport.height;\r\n    const screenWidth = this._engine.screen.viewport.width;\r\n    if (this._playButtonRootElement) {\r\n      const left = this._engine.canvas.offsetLeft;\r\n      const top = this._engine.canvas.offsetTop;\r\n      const buttonWidth = this._playButton.clientWidth;\r\n      const buttonHeight = this._playButton.clientHeight;\r\n      if (this.playButtonPosition) {\r\n        this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\r\n        this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\r\n      } else {\r\n        this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\r\n        this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loader draw function. Draws the default Excalibur loading screen.\r\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\r\n   * to customize the drawing, or just override entire method.\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\r\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\r\n\r\n    this._positionPlayButton();\r\n\r\n    ctx.fillStyle = this.backgroundColor;\r\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n\r\n    let logoY = canvasHeight / 2;\r\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\r\n    let logoX = canvasWidth / 2 - width / 2;\r\n\r\n    if (this.logoPosition) {\r\n      logoX = this.logoPosition.x;\r\n      logoY = this.logoPosition.y;\r\n    }\r\n\r\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\r\n    const oldAntialias = this._engine.getAntialiasing();\r\n    this._engine.setAntialiasing(true);\r\n    if (!this.logoPosition) {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\r\n    } else {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\r\n    }\r\n\r\n    // loading box\r\n    if (!this.suppressPlayButton && this._playButtonShown) {\r\n      this._engine.setAntialiasing(oldAntialias);\r\n      return;\r\n    }\r\n\r\n    let loadingX = logoX;\r\n    let loadingY = logoY;\r\n    if (this.loadingBarPosition) {\r\n      loadingX = this.loadingBarPosition.x;\r\n      loadingY = this.loadingBarPosition.y;\r\n    }\r\n\r\n    ctx.lineWidth = 2;\r\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\r\n    const progress = width * this.progress;\r\n    const margin = 5;\r\n    const progressWidth = progress - margin * 2;\r\n    const height = 20 - margin * 2;\r\n    DrawUtil.roundRect(\r\n      ctx,\r\n      loadingX + margin,\r\n      loadingY + margin,\r\n      progressWidth > 10 ? progressWidth : 10,\r\n      height,\r\n      5,\r\n      null,\r\n      this.loadingBarColor\r\n    );\r\n    this._engine.setAntialiasing(oldAntialias);\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","import { Logger } from './Log';\r\n/**\r\n * This is the list of features that will be used to log the supported\r\n * features to the console when Detector.logBrowserFeatures() is called.\r\n */\r\n\r\nconst REPORTED_FEATURES: { [key: string]: string } = {\r\n  webgl: 'WebGL',\r\n  webaudio: 'WebAudio',\r\n  gamepadapi: 'Gamepad API'\r\n};\r\n\r\n/**\r\n * Interface for detected browser features matrix\r\n */\r\nexport interface DetectedFeatures {\r\n  readonly canvas: boolean;\r\n  readonly arraybuffer: boolean;\r\n  readonly dataurl: boolean;\r\n  readonly objecturl: boolean;\r\n  readonly rgba: boolean;\r\n  readonly webaudio: boolean;\r\n  readonly webgl: boolean;\r\n  readonly gamepadapi: boolean;\r\n}\r\n\r\ninterface CriticalTests {\r\n  canvasSupport(): boolean;\r\n  arrayBufferSupport(): boolean;\r\n  dataUrlSupport(): boolean;\r\n  objectUrlSupport(): boolean;\r\n  rgbaSupport(): boolean;\r\n}\r\n\r\ninterface WarningTests {\r\n  webAudioSupport(): boolean;\r\n  webglSupport(): boolean;\r\n}\r\n\r\n/**\r\n * Excalibur internal feature detection helper class\r\n */\r\nexport class Detector {\r\n  private _features: DetectedFeatures = null;\r\n\r\n  public failedTests: string[] = [];\r\n\r\n  public constructor() {\r\n    this._features = this._loadBrowserFeatures();\r\n  }\r\n\r\n  /**\r\n   * Returns a map of currently supported browser features. This method\r\n   * treats the features as a singleton and will only calculate feature\r\n   * support if it has not previously been done.\r\n   */\r\n  public getBrowserFeatures(): DetectedFeatures {\r\n    if (this._features === null) {\r\n      this._features = this._loadBrowserFeatures();\r\n    }\r\n    return this._features;\r\n  }\r\n\r\n  /**\r\n   * Report on non-critical browser support for debugging purposes.\r\n   * Use native browser console colors for visibility.\r\n   */\r\n  public logBrowserFeatures(): void {\r\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\r\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\r\n\r\n    const supported: any = this.getBrowserFeatures();\r\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\r\n      if (supported[feature]) {\r\n        msg += '(%c\\u2713%c)'; // (✓)\r\n        args.push('font-weight: bold; color: green');\r\n        args.push('font-weight: normal; color: inherit');\r\n      } else {\r\n        msg += '(%c\\u2717%c)'; // (✗)\r\n        args.push('font-weight: bold; color: red');\r\n        args.push('font-weight: normal; color: inherit');\r\n      }\r\n\r\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\r\n    }\r\n\r\n    args.unshift(msg);\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, args);\r\n  }\r\n\r\n  /**\r\n   * Executes several IIFE's to get a constant reference to supported\r\n   * features within the current execution context.\r\n   */\r\n  private _loadBrowserFeatures(): DetectedFeatures {\r\n    return {\r\n      // IIFE to check canvas support\r\n      canvas: (() => {\r\n        return this._criticalTests.canvasSupport();\r\n      })(),\r\n\r\n      // IIFE to check arraybuffer support\r\n      arraybuffer: (() => {\r\n        return this._criticalTests.arrayBufferSupport();\r\n      })(),\r\n\r\n      // IIFE to check dataurl support\r\n      dataurl: (() => {\r\n        return this._criticalTests.dataUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check objecturl support\r\n      objecturl: (() => {\r\n        return this._criticalTests.objectUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check rgba support\r\n      rgba: (() => {\r\n        return this._criticalTests.rgbaSupport();\r\n      })(),\r\n\r\n      // IIFE to check webaudio support\r\n      webaudio: (() => {\r\n        return this._warningTest.webAudioSupport();\r\n      })(),\r\n\r\n      // IIFE to check webgl support\r\n      webgl: (() => {\r\n        return this._warningTest.webglSupport();\r\n      })(),\r\n\r\n      // IIFE to check gamepadapi support\r\n      gamepadapi: (() => {\r\n        return !!(<any>navigator).getGamepads;\r\n      })()\r\n    };\r\n  }\r\n\r\n  // critical browser features required for ex to run\r\n  private _criticalTests: CriticalTests = {\r\n    // Test canvas/2d context support\r\n    canvasSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('2d'));\r\n    },\r\n\r\n    // Test array buffer support ex uses for downloading binary data\r\n    arrayBufferSupport: function() {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open('GET', '/');\r\n      try {\r\n        xhr.responseType = 'arraybuffer';\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n      return xhr.responseType === 'arraybuffer';\r\n    },\r\n\r\n    // Test data urls ex uses for sprites\r\n    dataUrlSupport: function() {\r\n      const canvas = document.createElement('canvas');\r\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\r\n    },\r\n\r\n    // Test object url support for loading\r\n    objectUrlSupport: function() {\r\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\r\n    },\r\n\r\n    // RGBA support for colors\r\n    rgbaSupport: function() {\r\n      const style = document.createElement('a').style;\r\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\r\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\r\n    }\r\n  };\r\n\r\n  // warnings excalibur performance will be degraded\r\n  private _warningTest: WarningTests = {\r\n    webAudioSupport: function() {\r\n      return !!(\r\n        (<any>window).AudioContext ||\r\n        (<any>window).webkitAudioContext ||\r\n        (<any>window).mozAudioContext ||\r\n        (<any>window).msAudioContext ||\r\n        (<any>window).oAudioContext\r\n      );\r\n    },\r\n    webglSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('webgl'));\r\n    }\r\n  };\r\n\r\n  public test(): boolean {\r\n    // Critical test will for ex not to run\r\n    let failedCritical = false;\r\n    for (const test in this._criticalTests) {\r\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\r\n        this.failedTests.push(test);\r\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\r\n        failedCritical = true;\r\n      }\r\n    }\r\n    if (failedCritical) {\r\n      return false;\r\n    }\r\n\r\n    // Warning tests do not for ex to return false to compatibility\r\n    for (const warning in this._warningTest) {\r\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\r\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/**\r\n * An enum that describes the types of collisions bodies can participate in\r\n */\r\nexport enum CollisionType {\r\n  /**\r\n   * Bodies with the `PreventCollision` setting do not participate in any\r\n   * collisions and do not raise collision events.\r\n   */\r\n  PreventCollision = 'PreventCollision',\r\n  /**\r\n   * Bodies with the `Passive` setting only raise collision events, but are not\r\n   * influenced or moved by other bodies and do not influence or move other bodies.\r\n   * This is useful for use in trigger type behavior.\r\n   */\r\n  Passive = 'Passive',\r\n  /**\r\n   * Bodies with the `Active` setting raise collision events and participate\r\n   * in collisions with other bodies and will be push or moved by bodies sharing\r\n   * the `Active` or `Fixed` setting.\r\n   */\r\n  Active = 'Active',\r\n  /**\r\n   * Bodies with the `Fixed` setting raise collision events and participate in\r\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\r\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\r\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\r\n   * not be pushed or moved by each other, they will not interact except to throw\r\n   * collision events.\r\n   */\r\n  Fixed = 'Fixed'\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n\r\n/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum CollisionResolutionStrategy {\r\n  Arcade = 'arcade',\r\n  Realistic = 'realistic'\r\n}\r\n\r\n/**\r\n * Possible broadphase collision pair identification strategies\r\n *\r\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n * potential collision pairs which is O(nlog(n)) faster.\r\n */\r\nexport enum BroadphaseStrategy {\r\n  DynamicAABBTree\r\n}\r\n\r\n/**\r\n * Possible numerical integrators for position and velocity\r\n */\r\nexport enum Integrator {\r\n  Euler\r\n}\r\n\r\n/**\r\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\r\n */\r\n/* istanbul ignore next */\r\nexport class Physics {\r\n  /**\r\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\r\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\r\n   *\r\n   * This is a great way to globally simulate effects like gravity.\r\n   */\r\n  public static acc = new Vector(0, 0);\r\n  public static get gravity() {\r\n    return Physics.acc;\r\n  }\r\n  public static set gravity(v: Vector) {\r\n    Physics.acc = v;\r\n  }\r\n\r\n  /**\r\n   * Globally switches all Excalibur physics behavior on or off.\r\n   */\r\n  public static enabled = true;\r\n\r\n  /**\r\n   * Gets or sets the broadphase pair identification strategy.\r\n   *\r\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n   * potential collision pairs which is O(nlog(n)) faster.\r\n   */\r\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\r\n\r\n  /**\r\n   * Gets or sets the global collision resolution strategy (narrowphase).\r\n   *\r\n   * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics.\r\n   *\r\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  /**\r\n   * The default mass to use if none is specified\r\n   */\r\n  public static defaultMass: number = 10;\r\n  /**\r\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\r\n   */\r\n  public static integrator: Integrator = Integrator.Euler;\r\n\r\n  /**\r\n   * Configures Excalibur to use \"arcade\" physics. Arcade physics which performs simple axis aligned arcade style physics.\r\n   */\r\n  public static useArcadePhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  }\r\n\r\n  /**\r\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static useRealisticPhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Realistic;\r\n  }\r\n\r\n  /**\r\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\r\n   */\r\n  public static dynamicTreeVelocityMultiplier = 2;\r\n\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\r\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\r\n  })\r\n  public static get dynamicTreeVelocityMultiplyer() {\r\n    return Physics.dynamicTreeVelocityMultiplier;\r\n  }\r\n\r\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\r\n    Physics.dynamicTreeVelocityMultiplier = value;\r\n  }\r\n\r\n  /**\r\n   * Pad RigidBody BoundingBox by a constant amount\r\n   */\r\n  public static boundsPadding = 5;\r\n\r\n  /**\r\n   * Number of position iterations (overlap) to run in the solver\r\n   */\r\n  public static positionIterations = 3;\r\n\r\n  /**\r\n   * Number of velocity iteration (response) to run in the solver\r\n   */\r\n  public static velocityIterations = 8;\r\n\r\n  /**\r\n   * Amount of overlap to tolerate in pixels\r\n   */\r\n  public static slop = 1;\r\n\r\n  /**\r\n   * Amount of positional overlap correction to apply each position iteration of the solver\r\n   * O - meaning no correction, 1 - meaning correct all overlap\r\n   */\r\n  public static steeringFactor = 0.2;\r\n\r\n  /**\r\n   * Warm start set to true re-uses impulses from previous frames back in the solver\r\n   */\r\n  public static warmStart = true;\r\n\r\n  /**\r\n   * By default bodies do not sleep\r\n   */\r\n  public static bodiesCanSleepByDefault = false;\r\n\r\n  /**\r\n   * Surface epsilon is used to help deal with surface penetration\r\n   */\r\n  public static surfaceEpsilon = 0.1;\r\n\r\n  public static sleepEpsilon = 0.07;\r\n\r\n  public static wakeThreshold = Physics.sleepEpsilon * 3;\r\n\r\n  public static sleepBias = 0.9;\r\n\r\n  /**\r\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\r\n   * bodies from tunneling through one another.\r\n   */\r\n  public static checkForFastBodies = true;\r\n\r\n  /**\r\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\r\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\r\n   * Excalibur will always perform the fast body raycast regardless of speed.\r\n   */\r\n  public static disableMinimumSpeedForFastBody = false;\r\n}\r\n","import { Vector } from './vector';\r\n\r\nexport interface VectorViewOptions {\r\n  getX: () => number;\r\n  getY: () => number;\r\n  setX: (x: number) => void;\r\n  setY: (y: number) => void;\r\n}\r\nexport class VectorView extends Vector {\r\n  private _getX: () => number;\r\n  private _getY: () => number;\r\n  private _setX: (x: number) => void;\r\n  private _setY: (y: number) => void;\r\n  constructor(options: VectorViewOptions) {\r\n    super(0, 0);\r\n    this._getX = options.getX;\r\n    this._getY = options.getY;\r\n    this._setX = options.setX;\r\n    this._setY = options.setY;\r\n  }\r\n  public get x() {\r\n    return (this._x = this._getX());\r\n  }\r\n\r\n  public set x(val) {\r\n    this._setX(val);\r\n    this._x = val;\r\n  }\r\n\r\n  public get y() {\r\n    return (this._y = this._getY());\r\n  }\r\n  public set y(val) {\r\n    this._setY(val);\r\n    this._y = val;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\n\r\n/**\r\n * Component Contructor Types\r\n */\r\nexport declare type ComponentCtor<T extends Component = Component> = new (...args:any[]) => T;\r\n\r\n/**\r\n * Type guard to check if a component implements clone\r\n * @param x\r\n */\r\nfunction hasClone(x: any): x is { clone(): any } {\r\n  return !!x?.clone;\r\n}\r\n\r\nexport type ComponentType<ComponentToParse> = ComponentToParse extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * Plucks the string type out of a component type\r\n */\r\nexport type ComponentStringType<T> = T extends Component<infer R> ? R : string;\r\n\r\n/**\r\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity posesses\r\n *\r\n * Implementations of Component must have a zero-arg constructor to support dependecies\r\n *\r\n * ```typescript\r\n * class MyComponent extends ex.Component<'my'> {\r\n *   public readonly type = 'my';\r\n *   // zero arg support required if you want to use component dependencies\r\n *   constructor(public optionalPos?: ex.Vector) {}\r\n * }\r\n * ```\r\n */\r\nexport abstract class Component<TypeName extends string = string> {\r\n  /**\r\n   * Optionally list any component types this component depends on\r\n   * If the owner entity does not have these components, new components will be added to the entity\r\n   *\r\n   * Only components with zero-arg constructors are supported as automatic component dependencies\r\n   */\r\n  readonly dependencies?: ComponentCtor[];\r\n\r\n  // todo implement optional\r\n  readonly optional?: ComponentCtor[];\r\n\r\n  /**\r\n   * Type of this component, must be a unique type among component types in you game.\r\n   */\r\n  abstract readonly type: TypeName;\r\n\r\n  /**\r\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\r\n   */\r\n  owner?: Entity = null;\r\n\r\n  /**\r\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\r\n   */\r\n  clone(): this {\r\n    const newComponent = new (this.constructor as any)();\r\n    for (const prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        const val = this[prop];\r\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\r\n          newComponent[prop] = val.clone();\r\n        } else {\r\n          newComponent[prop] = val;\r\n        }\r\n      }\r\n    }\r\n    return newComponent;\r\n  }\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onAdd?(owner: Entity): void;\r\n\r\n  /**\r\n   * Opitonal callback called when acomponent is added to an entity\r\n   */\r\n  onRemove?(previousOwner: Entity): void;\r\n}\r\n\r\n/**\r\n * Tag components are a way of tagging a component with label and a simple value\r\n *\r\n * For example:\r\n *\r\n * ```typescript\r\n * const isOffscreen = new TagComponent('offscreen');\r\n * entity.addComponent(isOffscreen);\r\n * entity.tags.includes\r\n * ```\r\n */\r\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\r\nTypeName\r\n> {\r\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\r\n    super();\r\n  }\r\n}\r\n","import { Matrix, MatrixLocations } from '../../Math/matrix';\r\nimport { VectorView } from '../../Math/vector-view';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Component } from '../Component';\r\n\r\nexport interface Transform {\r\n  /**\r\n   * The [[CoordPlane|coordinate plane]] for this transform for the entity.\r\n   */\r\n  coordPlane: CoordPlane;\r\n\r\n  /**\r\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\r\n   *\r\n   * If the entity has a parent this position is relative to the parent entity.\r\n   */\r\n  pos: Vector;\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  z: number;\r\n\r\n  /**\r\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\r\n   *\r\n   * If the entity has a parent this rotation is relative to the parent.\r\n   */\r\n  rotation: number;\r\n\r\n  /**\r\n   * The scale of the entity. If the entity has a parent this scale is relative to the parent.\r\n   */\r\n  scale: Vector;\r\n}\r\n\r\nconst createPosView = (matrix: Matrix) => {\r\n  const source = matrix;\r\n  return new VectorView({\r\n    setX: (x) => {\r\n      source.data[MatrixLocations.X] = x;\r\n    },\r\n    setY: (y) => {\r\n      source.data[MatrixLocations.Y] = y;\r\n    },\r\n    getX: () => {\r\n      return source.data[MatrixLocations.X];\r\n    },\r\n    getY: () => {\r\n      return source.data[MatrixLocations.Y];\r\n    }\r\n  });\r\n};\r\n\r\nconst createScaleView = (matrix: Matrix) => {\r\n  const source = matrix;\r\n  return new VectorView({\r\n    setX: (x) => {\r\n      source.setScaleX(x);\r\n    },\r\n    setY: (y) => {\r\n      source.setScaleY(y);\r\n    },\r\n    getX: () => {\r\n      return source.getScaleX();\r\n    },\r\n    getY: () => {\r\n      return source.getScaleY();\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\r\n */\r\nexport enum CoordPlane {\r\n  /**\r\n   * The world coordinate plane (default) represents world space, any entities drawn with world\r\n   * space move when the camera moves.\r\n   */\r\n  World = 'world',\r\n  /**\r\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\r\n   * to screen coordinates ignoring the camera.\r\n   */\r\n  Screen = 'screen'\r\n}\r\n\r\nexport class TransformComponent extends Component<'ex.transform'> implements Transform {\r\n  public readonly type = 'ex.transform';\r\n\r\n  private _dirty = false;\r\n\r\n  public readonly matrix = Matrix.identity().translate(0, 0).rotate(0).scale(1, 1);\r\n  private _position = createPosView(this.matrix);\r\n  private _rotation = 0;\r\n  private _scale = createScaleView(this.matrix);\r\n\r\n  private _recalculate() {\r\n    this._rotation = this.matrix.getRotation();\r\n    this._dirty = false;\r\n  }\r\n\r\n  public getGlobalMatrix(): Matrix {\r\n    if (!this.parent) {\r\n      return this.matrix;\r\n    } else {\r\n      return this.parent.getGlobalMatrix().multm(this.matrix);\r\n    }\r\n  }\r\n\r\n  public getGlobalTransform(): Transform {\r\n    return {\r\n      pos: this.globalPos,\r\n      scale: this.globalScale,\r\n      rotation: this.globalRotation,\r\n      z: this.z,\r\n      coordPlane: this.coordPlane\r\n    };\r\n  }\r\n\r\n  public get parent(): TransformComponent | null {\r\n    return this?.owner?.parent?.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * The [[CoordPlane|coordinate plane|]] for this transform for the entity.\r\n   */\r\n  public coordPlane = CoordPlane.World;\r\n\r\n  /**\r\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\r\n   *\r\n   * If a parent entity exists coordinates are local to the parent.\r\n   */\r\n  public get pos(): Vector {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._position;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.matrix.setPosition(val.x, val.y);\r\n    this._dirty = true;\r\n  }\r\n\r\n  // Dirty flag check up the chain\r\n  public get dirty(): boolean {\r\n    if (this?.owner?.parent) {\r\n      const parent = this.parent;\r\n      return parent.dirty || this._dirty;\r\n    }\r\n    return this._dirty;\r\n  }\r\n\r\n  /**\r\n   * The current world position calculated\r\n   */\r\n  public get globalPos(): Vector {\r\n    const source = this.getGlobalMatrix();\r\n    return new VectorView({\r\n      getX: () => source.data[MatrixLocations.X],\r\n      getY: () => source.data[MatrixLocations.Y],\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const [newX] = this.parent?.getGlobalMatrix().getAffineInverse().multv([x, source.data[MatrixLocations.Y]]);\r\n          this.matrix.data[MatrixLocations.X] = newX;\r\n        } else {\r\n          this.matrix.data[MatrixLocations.X] = x;\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const [, newY] = this.parent?.getGlobalMatrix().getAffineInverse().multv([source.data[MatrixLocations.X], y]);\r\n          this.matrix.data[MatrixLocations.Y] = newY;\r\n        } else {\r\n          this.matrix.data[MatrixLocations.Y] = y;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public set globalPos(val: Vector) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.pos = val;\r\n    } else {\r\n      this.pos = parentTransform.getGlobalMatrix().getAffineInverse().multv(val);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  public z: number = 0;\r\n\r\n  /**\r\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\r\n   */\r\n  public get rotation(): number {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._rotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.matrix.setRotation(val);\r\n    this._dirty = true;\r\n  }\r\n\r\n  public get globalRotation(): number {\r\n    return this.getGlobalMatrix().getRotation();\r\n  }\r\n\r\n  public set globalRotation(val: number) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.rotation = val;\r\n    } else {\r\n      this.rotation = val - parentTransform.globalRotation;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The scale of the entity.\r\n   */\r\n  public get scale(): Vector {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._scale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.matrix.setScale(val);\r\n    this._dirty = true;\r\n  }\r\n\r\n  public get globalScale(): Vector {\r\n    const source = this.getGlobalMatrix();\r\n    return new VectorView({\r\n      getX: () => source.getScaleX(),\r\n      getY: () => source.getScaleY(),\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const globalScaleX = this.parent.globalScale.x;\r\n          this.matrix.setScaleX(x / globalScaleX);\r\n        } else {\r\n          this.matrix.setScaleX(x);\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const globalScaleY = this.parent.globalScale.y;\r\n          this.matrix.setScaleY(y / globalScaleY);\r\n        } else {\r\n          this.matrix.setScaleY(y);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public set globalScale(val: Vector) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.scale = val;\r\n    } else {\r\n      this.scale = vec(val.x / parentTransform.globalScale.x, val.y / parentTransform.globalScale.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply the transform to a point\r\n   * @param point\r\n   */\r\n  public apply(point: Vector): Vector {\r\n    return this.matrix.multv(point);\r\n  }\r\n\r\n  /**\r\n   * Apply the inverse transform to a point\r\n   * @param point\r\n   */\r\n  public applyInverse(point: Vector): Vector {\r\n    return this.matrix.getAffineInverse().multv(point);\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { Component } from '../Component';\n\nexport interface Motion {\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  vel: Vector;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  acc: Vector;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  scaleFactor: Vector;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  angularVelocity: number;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  torque: number;\n\n  /**\n   * Inerita can be thought of as the resistance to motion\n   */\n  inertia: number;\n}\n\nexport class MotionComponent extends Component<'ex.motion'> {\n  public readonly type = 'ex.motion';\n\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  public acc: Vector = Vector.Zero;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  public scaleFactor: Vector = Vector.Zero;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  public angularVelocity = 0;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  public torque: number = 0;\n\n  /**\n   * Inerita can be thought of as the resistance to motion\n   */\n  public inertia: number = 1;\n}\n","/**\r\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\r\n *\r\n * For example:\r\n *\r\n * Players have collision group \"player\"\r\n *\r\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\r\n *\r\n * Enemies have collision group \"enemy\"\r\n *\r\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\r\n *\r\n * Blocks have collision group \"ground\"\r\n *\r\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\r\n *\r\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\r\n * with players and blocks.\r\n *\r\n * This is done with bitmasking, see the following pseudo-code\r\n *\r\n * PlayerGroup = `0b001`\r\n * PlayerGroupMask = `0b110`\r\n *\r\n * EnemyGroup = `0b010`\r\n * EnemyGroupMask = `0b101`\r\n *\r\n * BlockGroup = `0b100`\r\n * BlockGroupMask = `0b011`\r\n *\r\n * Should Players collide? No because the bitwise mask evaluates to 0\r\n * `(player1.group & player2.mask) === 0`\r\n * `(0b001 & 0b110) === 0`\r\n *\r\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & enemy1.mask) === 1`\r\n * `(0b001 & 0b101) === 1`\r\n *\r\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & blocks1.mask) === 1`\r\n * `(0b001 & 0b011) === 1`\r\n */\r\nexport class CollisionGroup {\r\n  /**\r\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\r\n   * it is the default collision group on colliders.\r\n   */\r\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\r\n\r\n  private _name: string;\r\n  private _category: number;\r\n  private _mask: number;\r\n\r\n  /**\r\n   * STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\r\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\r\n   * @param name Name of the collision group\r\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\r\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\r\n   */\r\n  constructor(name: string, category: number, mask: number) {\r\n    this._name = name;\r\n    this._category = category;\r\n    this._mask = mask;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the collision group\r\n   */\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /**\r\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\r\n   */\r\n  public get category() {\r\n    return this._category;\r\n  }\r\n\r\n  /**\r\n   * Get the mask for this collision group\r\n   */\r\n  public get mask() {\r\n    return this._mask;\r\n  }\r\n\r\n  /**\r\n   * Evaluates whether 2 collision groups can collide\r\n   * @param other  CollisionGroup\r\n   */\r\n  public canCollide(other: CollisionGroup): boolean {\r\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\r\n  }\r\n\r\n  /**\r\n   * Inverts the collision group. For example, if before the group specified \"players\",\r\n   * inverting would specify all groups except players\r\n   * @returns CollisionGroup\r\n   */\r\n  public invert(): CollisionGroup {\r\n    return new CollisionGroup('~(' + this.name + ')', ~this.category, ~this.mask);\r\n  }\r\n\r\n  /**\r\n   * Combine collision groups with each other. The new group includes all of the previous groups.\r\n   *\r\n   * @param collisionGroups\r\n   * @returns\r\n   */\r\n  public static combine(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\r\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    const combinedMask = ~combinedCategory;\r\n\r\n    return new CollisionGroup(combinedName, combinedCategory, combinedMask);\r\n  }\r\n\r\n  /**\r\n   * Creates a collision group that collides with the listed groups\r\n   * @param collisionGroups\r\n   */\r\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\r\n    return CollisionGroup.combine(collisionGroups).invert();\r\n  }\r\n}\r\n","/**\r\n * Defines a generic message that can contain any data\r\n * @template T is the typescript Type of the data\r\n */\r\nexport interface Message<T> {\r\n  type: string;\r\n  data: T;\r\n}\r\n\r\n/**\r\n * Defines an interface for an observer to receive a message via a notify() method\r\n */\r\nexport interface Observer<T> {\r\n  notify(message: T): void;\r\n}\r\n\r\n/**\r\n * Defines an interface for something that might be an observer if a notify() is present\r\n */\r\nexport type MaybeObserver<T> = Partial<Observer<T>>;\r\n\r\n/**\r\n * Simple Observable implemenation\r\n * @template T is the typescript Type that defines the data being observed\r\n */\r\nexport class Observable<T> {\r\n  public observers: Observer<T>[] = [];\r\n  public subscriptions: ((val: T) => any)[] = [];\r\n\r\n  /**\r\n   * Register an observer to listen to this observable\r\n   * @param observer\r\n   */\r\n  register(observer: Observer<T>) {\r\n    this.observers.push(observer);\r\n  }\r\n\r\n  /**\r\n   * Register a callback to listen to this observable\r\n   * @param func\r\n   */\r\n  subscribe(func: (val: T) => any) {\r\n    this.subscriptions.push(func);\r\n  }\r\n\r\n  /**\r\n   * Remove an observer from the observable\r\n   * @param observer\r\n   */\r\n  unregister(observer: Observer<T>) {\r\n    const i = this.observers.indexOf(observer);\r\n    if (i !== -1) {\r\n      this.observers.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a callback that is listening to this observable\r\n   * @param func\r\n   */\r\n  unsubscribe(func: (val: T) => any) {\r\n    const i = this.subscriptions.indexOf(func);\r\n    if (i !== -1) {\r\n      this.subscriptions.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Broadcasts a message to all observers and callbacks\r\n   * @param message\r\n   */\r\n  notifyAll(message: T) {\r\n    this.observers.forEach((o) => o.notify(message));\r\n    this.subscriptions.forEach(cb => cb(message));\r\n  }\r\n\r\n  /**\r\n   * Removes all observers and callbacks\r\n   */\r\n  clear() {\r\n    this.observers.length = 0;\r\n    this.subscriptions.length = 0;\r\n  }\r\n}\r\n","import { CollisionContact } from './CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Id } from '../../Id';\r\nimport { Collider } from '../Colliders/Collider';\r\n\r\n/**\r\n * Models a potential collision between 2 colliders\r\n */\r\nexport class Pair {\r\n  public id: string = null;\r\n  constructor(public colliderA: Collider, public colliderB: Collider) {\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n  }\r\n\r\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\r\n    const bodyA = colliderA?.owner?.get(BodyComponent);\r\n    const bodyB = colliderB?.owner?.get(BodyComponent);\r\n\r\n    // Body's needed for collision in the current state\r\n    // TODO can we collide without a body?\r\n    if (!bodyA || !bodyB) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!bodyA.group.canCollide(bodyB.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!bodyA.active || !bodyB.active) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not it is possible for the pairs to collide\r\n   */\r\n  public get canCollide(): boolean {\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Runs the collision intersection logic on the members of this pair\r\n   */\r\n  public collide(): CollisionContact[] {\r\n    return this.colliderA.collide(this.colliderB);\r\n  }\r\n\r\n  /**\r\n   * Check if the collider is part of the pair\r\n   * @param collider\r\n   * @returns\r\n   */\r\n  public hasCollider(collider: Collider) {\r\n    return collider === this.colliderA || collider === this.colliderB;\r\n  }\r\n\r\n  /**\r\n   * Calculates the unique pair hash id for this collision pair (owning id)\r\n   */\r\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\r\n    if (idA.value < idB.value) {\r\n      return `#${idA.value}+${idB.value}`;\r\n    } else {\r\n      return `#${idB.value}+${idA.value}`;\r\n    }\r\n  }\r\n}\r\n","/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\n\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n","import { Physics } from '../Physics';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nimport { Ray } from '../../Math/ray';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Id } from '../../Id';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Color, ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Dynamic Tree Node used for tracking bounds within the tree\r\n */\r\nexport class TreeNode<T> {\r\n  public left: TreeNode<T>;\r\n  public right: TreeNode<T>;\r\n  public bounds: BoundingBox;\r\n  public height: number;\r\n  public data: T;\r\n  constructor(public parent?: TreeNode<T>) {\r\n    this.parent = parent || null;\r\n    this.data = null;\r\n    this.bounds = new BoundingBox();\r\n    this.left = null;\r\n    this.right = null;\r\n    this.height = 0;\r\n  }\r\n\r\n  public isLeaf(): boolean {\r\n    return !this.left && !this.right;\r\n  }\r\n}\r\n\r\nexport interface ColliderProxy<T> {\r\n  id: Id<'collider'>;\r\n  owner: T;\r\n  bounds: BoundingBox;\r\n}\r\n\r\n/**\r\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\r\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\r\n *\r\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\r\n * Every non-leaf node is a bounding box that contains child bounding boxes.\r\n */\r\nexport class DynamicTree<T extends ColliderProxy<Entity>> {\r\n  public root: TreeNode<T>;\r\n  public nodes: { [key: number]: TreeNode<T> };\r\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\r\n    this.root = null;\r\n    this.nodes = {};\r\n  }\r\n\r\n  /**\r\n   * Inserts a node into the dynamic tree\r\n   */\r\n  private _insert(leaf: TreeNode<T>): void {\r\n    // If there are no nodes in the tree, make this the root leaf\r\n    if (this.root === null) {\r\n      this.root = leaf;\r\n      this.root.parent = null;\r\n      return;\r\n    }\r\n\r\n    // Search the tree for a node that is not a leaf and find the best place to insert\r\n    const leafAABB = leaf.bounds;\r\n    let currentRoot = this.root;\r\n    while (!currentRoot.isLeaf()) {\r\n      const left = currentRoot.left;\r\n      const right = currentRoot.right;\r\n\r\n      const area = currentRoot.bounds.getPerimeter();\r\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\r\n      const combinedArea = combinedAABB.getPerimeter();\r\n\r\n      // Calculate cost heuristic for creating a new parent and leaf\r\n      const cost = 2 * combinedArea;\r\n\r\n      // Minimum cost of pushing the leaf down the tree\r\n      const inheritanceCost = 2 * (combinedArea - area);\r\n\r\n      // Cost of descending\r\n      let leftCost = 0;\r\n      const leftCombined = leafAABB.combine(left.bounds);\r\n      let newArea;\r\n      let oldArea;\r\n      if (left.isLeaf()) {\r\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = left.bounds.getPerimeter();\r\n        newArea = leftCombined.getPerimeter();\r\n        leftCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      let rightCost = 0;\r\n      const rightCombined = leafAABB.combine(right.bounds);\r\n      if (right.isLeaf()) {\r\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = right.bounds.getPerimeter();\r\n        newArea = rightCombined.getPerimeter();\r\n        rightCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      // cost is acceptable\r\n      if (cost < leftCost && cost < rightCost) {\r\n        break;\r\n      }\r\n\r\n      // Descend to the depths\r\n      if (leftCost < rightCost) {\r\n        currentRoot = left;\r\n      } else {\r\n        currentRoot = right;\r\n      }\r\n    }\r\n\r\n    // Create the new parent node and insert into the tree\r\n    const oldParent = currentRoot.parent;\r\n    const newParent = new TreeNode(oldParent);\r\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\r\n    newParent.height = currentRoot.height + 1;\r\n\r\n    if (oldParent !== null) {\r\n      // The sibling node was not the root\r\n      if (oldParent.left === currentRoot) {\r\n        oldParent.left = newParent;\r\n      } else {\r\n        oldParent.right = newParent;\r\n      }\r\n\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n    } else {\r\n      // The sibling node was the root\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n      this.root = newParent;\r\n    }\r\n\r\n    // Walk up the tree fixing heights and AABBs\r\n    let currentNode = leaf.parent;\r\n    while (currentNode) {\r\n      currentNode = this._balance(currentNode);\r\n\r\n      if (!currentNode.left) {\r\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\r\n      }\r\n      if (!currentNode.right) {\r\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\r\n      }\r\n\r\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n\r\n      currentNode = currentNode.parent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a node from the dynamic tree\r\n   */\r\n  private _remove(leaf: TreeNode<T>) {\r\n    if (leaf === this.root) {\r\n      this.root = null;\r\n      return;\r\n    }\r\n\r\n    const parent = leaf.parent;\r\n    const grandParent = parent.parent;\r\n    let sibling: TreeNode<T>;\r\n    if (parent.left === leaf) {\r\n      sibling = parent.right;\r\n    } else {\r\n      sibling = parent.left;\r\n    }\r\n\r\n    if (grandParent) {\r\n      if (grandParent.left === parent) {\r\n        grandParent.left = sibling;\r\n      } else {\r\n        grandParent.right = sibling;\r\n      }\r\n      sibling.parent = grandParent;\r\n\r\n      let currentNode = grandParent;\r\n      while (currentNode) {\r\n        currentNode = this._balance(currentNode);\r\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n\r\n        currentNode = currentNode.parent;\r\n      }\r\n    } else {\r\n      this.root = sibling;\r\n      sibling.parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tracks a body in the dynamic tree\r\n   */\r\n  public trackCollider(collider: T) {\r\n    const node = new TreeNode<T>();\r\n    node.data = collider;\r\n    node.bounds = collider.bounds;\r\n    node.bounds.left -= 2;\r\n    node.bounds.top -= 2;\r\n    node.bounds.right += 2;\r\n    node.bounds.bottom += 2;\r\n    this.nodes[collider.id.value] = node;\r\n    this._insert(node);\r\n  }\r\n\r\n  /**\r\n   * Updates the dynamic tree given the current bounds of each body being tracked\r\n   */\r\n  public updateCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return false;\r\n    }\r\n    const b = collider.bounds;\r\n\r\n    // if the body is outside the world no longer update it\r\n    if (!this.worldBounds.contains(b)) {\r\n      Logger.getInstance().warn(\r\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\r\n      );\r\n      this.untrackCollider(collider);\r\n      return false;\r\n    }\r\n\r\n    if (node.bounds.contains(b)) {\r\n      return false;\r\n    }\r\n\r\n    this._remove(node);\r\n    b.left -= Physics.boundsPadding;\r\n    b.top -= Physics.boundsPadding;\r\n    b.right += Physics.boundsPadding;\r\n    b.bottom += Physics.boundsPadding;\r\n\r\n    // THIS IS CAUSING UNECESSARY CHECKS\r\n    if (collider.owner) {\r\n      const body = collider.owner?.get(BodyComponent);\r\n      if (body) {\r\n        const multdx = ((body.vel.x * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n        const multdy = ((body.vel.y * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n\r\n        if (multdx < 0) {\r\n          b.left += multdx;\r\n        } else {\r\n          b.right += multdx;\r\n        }\r\n\r\n        if (multdy < 0) {\r\n          b.top += multdy;\r\n        } else {\r\n          b.bottom += multdy;\r\n        }\r\n      }\r\n    }\r\n\r\n    node.bounds = b;\r\n    this._insert(node);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Untracks a body from the dynamic tree\r\n   */\r\n  public untrackCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return;\r\n    }\r\n    this._remove(node);\r\n    this.nodes[collider.id.value] = null;\r\n    delete this.nodes[collider.id.value];\r\n  }\r\n\r\n  /**\r\n   * Balances the tree about a node\r\n   */\r\n  private _balance(node: TreeNode<T>) {\r\n    if (node === null) {\r\n      throw new Error('Cannot balance at null node');\r\n    }\r\n\r\n    if (node.isLeaf() || node.height < 2) {\r\n      return node;\r\n    }\r\n\r\n    const left = node.left;\r\n    const right = node.right;\r\n\r\n    const a = node;\r\n    const b = left;\r\n    const c = right;\r\n    const d = left.left;\r\n    const e = left.right;\r\n    const f = right.left;\r\n    const g = right.right;\r\n\r\n    const balance = c.height - b.height;\r\n    // Rotate c node up\r\n    if (balance > 1) {\r\n      // Swap the right node with it's parent\r\n      c.left = a;\r\n      c.parent = a.parent;\r\n      a.parent = c;\r\n\r\n      // The original node's old parent should point to the right node\r\n      // this is mega confusing\r\n      if (c.parent) {\r\n        if (c.parent.left === a) {\r\n          c.parent.left = c;\r\n        } else {\r\n          c.parent.right = c;\r\n        }\r\n      } else {\r\n        this.root = c;\r\n      }\r\n\r\n      // Rotate\r\n      if (f.height > g.height) {\r\n        c.right = f;\r\n        a.right = g;\r\n        g.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(g.bounds);\r\n        c.bounds = a.bounds.combine(f.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, g.height);\r\n        c.height = 1 + Math.max(a.height, f.height);\r\n      } else {\r\n        c.right = g;\r\n        a.right = f;\r\n        f.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(f.bounds);\r\n        c.bounds = a.bounds.combine(g.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, f.height);\r\n        c.height = 1 + Math.max(a.height, g.height);\r\n      }\r\n\r\n      return c;\r\n    }\r\n    // Rotate left node up\r\n    if (balance < -1) {\r\n      // swap\r\n      b.left = a;\r\n      b.parent = a.parent;\r\n      a.parent = b;\r\n\r\n      // node's old parent should point to b\r\n      if (b.parent) {\r\n        if (b.parent.left === a) {\r\n          b.parent.left = b;\r\n        } else {\r\n          if (b.parent.right !== a) {\r\n            throw 'Error rotating Dynamic Tree';\r\n          }\r\n          b.parent.right = b;\r\n        }\r\n      } else {\r\n        this.root = b;\r\n      }\r\n\r\n      // rotate\r\n      if (d.height > e.height) {\r\n        b.right = d;\r\n        a.left = e;\r\n        e.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(e.bounds);\r\n        b.bounds = a.bounds.combine(d.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, e.height);\r\n        b.height = 1 + Math.max(a.height, d.height);\r\n      } else {\r\n        b.right = e;\r\n        a.left = d;\r\n        d.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(d.bounds);\r\n        b.bounds = a.bounds.combine(e.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, d.height);\r\n        b.height = 1 + Math.max(a.height, e.height);\r\n      }\r\n      return b;\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\r\n   */\r\n  public getHeight(): number {\r\n    if (this.root === null) {\r\n      return 0;\r\n    }\r\n    return this.root.height;\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\r\n   *\r\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\r\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\r\n   * the tree until all possible colliders have been returned.\r\n   */\r\n  public query(collider: T, callback: (other: T) => boolean): void {\r\n    const bounds = collider.bounds;\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\r\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\r\n          if (callback.call(collider, currentNode.data)) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\r\n   * long ray to test the tree specified by `max`.\r\n   *\r\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\r\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\r\n   * the tree until all possible bodies that would intersect with the ray have been returned.\r\n   */\r\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: T) => boolean): void {\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\r\n        if (currentNode.isLeaf()) {\r\n          if (callback.call(ray, currentNode.data)) {\r\n            // ray hit a leaf! return the body\r\n            return true;\r\n          }\r\n        } else {\r\n          // ray hit but not at a leaf, recurse deeper\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false; // ray missed\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  public getNodes(): TreeNode<T>[] {\r\n    const helper = (currentNode: TreeNode<T>): TreeNode<T>[] => {\r\n      if (currentNode) {\r\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\r\n      } else {\r\n        return [];\r\n      }\r\n    };\r\n    return helper(this.root);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    // draw all the nodes in the Dynamic Tree\r\n    const helper = (currentNode: TreeNode<T>) => {\r\n      if (currentNode) {\r\n        if (currentNode.isLeaf()) {\r\n          currentNode.bounds.draw(ex, Color.Green);\r\n        } else {\r\n          currentNode.bounds.draw(ex, Color.White);\r\n        }\r\n\r\n        if (currentNode.left) {\r\n          helper(currentNode.left);\r\n        }\r\n        if (currentNode.right) {\r\n          helper(currentNode.right);\r\n        }\r\n      }\r\n    };\r\n\r\n    helper(this.root);\r\n  }\r\n}\r\n","import { Line } from './line';\nimport { Vector } from './vector';\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\n\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  public intersectPoint(line: Line): Vector {\n    const time = this.intersect(line);\n    if (time < 0) {\n      return null;\n    }\n    return this.getPoint(time);\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n","import { Physics } from '../Physics';\r\nimport { CollisionProcessor } from './CollisionProcessor';\r\nimport { DynamicTree } from './DynamicTree';\r\nimport { Pair } from './Pair';\r\n\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { FrameStats } from '../../Debug';\r\nimport { Logger } from '../../Util/Log';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Responsible for performing the collision broadphase (locating potential colllisions) and\r\n * the narrowphase (actual collision contacts)\r\n */\r\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\r\n  private _dynamicCollisionTree = new DynamicTree<Collider>();\r\n  private _collisions = new Set<string>();\r\n\r\n  private _collisionPairCache: Pair[] = [];\r\n  private _colliders: Collider[] = [];\r\n\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Tracks a physics body for collisions\r\n   */\r\n  public track(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot track null collider');\r\n      return;\r\n    }\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        c.owner = target.owner;\r\n        this._colliders.push(c);\r\n        this._dynamicCollisionTree.trackCollider(c);\r\n      }\r\n    } else {\r\n      this._colliders.push(target);\r\n      this._dynamicCollisionTree.trackCollider(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Untracks a physics body\r\n   */\r\n  public untrack(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot untrack a null collider');\r\n      return;\r\n    }\r\n\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        const index = this._colliders.indexOf(c);\r\n        if (index !== -1) {\r\n          this._colliders.splice(index, 1);\r\n        }\r\n        this._dynamicCollisionTree.untrackCollider(c);\r\n      }\r\n    } else {\r\n      const index = this._colliders.indexOf(target);\r\n      if (index !== -1) {\r\n        this._colliders.splice(index, 1);\r\n      }\r\n      this._dynamicCollisionTree.untrackCollider(target);\r\n    }\r\n  }\r\n\r\n  private _shouldGenerateCollisionPair(colliderA: Collider, colliderB: Collider) {\r\n    // if the collision pair must be 2 separate colliders\r\n    // Also separate owners for composite colliders\r\n    if (\r\n      (colliderA.id !== null &&\r\n      colliderB.id !== null &&\r\n      colliderA.id === colliderB.id) ||\r\n      (colliderA.owner !== null &&\r\n       colliderB.owner !== null &&\r\n       colliderA.owner === colliderB.owner)) {\r\n      return false;\r\n    }\r\n\r\n    // if the collision pair has been calculated already short circuit\r\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    if (this._collisions.has(hash)) {\r\n      return false; // pair exists easy exit return false\r\n    }\r\n\r\n    // if the pair has a member with zero dimension\r\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\r\n      return false;\r\n    }\r\n\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Detects potential collision pairs in a broadphase approach with the dynamic aabb tree strategy\r\n   */\r\n  public broadphase(targets: Collider[], delta: number, stats?: FrameStats): Pair[] {\r\n    const seconds = delta / 1000;\r\n\r\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\r\n    const potentialColliders = targets.filter((other) => {\r\n      const body = other.owner?.get(BodyComponent);\r\n      return other.owner?.active && body.collisionType !== CollisionType.PreventCollision;\r\n    });\r\n\r\n    // clear old list of collision pairs\r\n    this._collisionPairCache = [];\r\n    this._collisions.clear();\r\n\r\n    // check for normal collision pairs\r\n    let collider: Collider;\r\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\r\n      collider = potentialColliders[j];\r\n      // Query the collision tree for potential colliders\r\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\r\n        if (this._shouldGenerateCollisionPair(collider, other)) {\r\n          const pair = new Pair(collider, other);\r\n          this._collisions.add(pair.id);\r\n          this._collisionPairCache.push(pair);\r\n        }\r\n        // Always return false, to query whole tree. Returning true in the query method stops searching\r\n        return false;\r\n      });\r\n    }\r\n    if (stats) {\r\n      stats.physics.pairs = this._collisionPairCache.length;\r\n    }\r\n\r\n    // Check dynamic tree for fast moving objects\r\n    // Fast moving objects are those moving at least there smallest bound per frame\r\n    if (Physics.checkForFastBodies) {\r\n      for (const collider of potentialColliders) {\r\n        const body = collider.owner.get(BodyComponent);\r\n        // Skip non-active objects. Does not make sense on other collision types\r\n        if (body.collisionType !== CollisionType.Active) {\r\n          continue;\r\n        }\r\n\r\n        // Maximum travel distance next frame\r\n        const updateDistance =\r\n          body.vel.size * seconds + // velocity term\r\n          body.acc.size * 0.5 * seconds * seconds; // acc term\r\n\r\n        // Find the minimum dimension\r\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\r\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\r\n          if (stats) {\r\n            stats.physics.fastBodies++;\r\n          }\r\n\r\n          // start with the oldPos because the integration for actors has already happened\r\n          // objects resting on a surface may be slightly penetrating in the current position\r\n          const updateVec = body.pos.sub(body.oldPos);\r\n          const centerPoint = collider.center;\r\n          const furthestPoint = collider.getFurthestPoint(body.vel);\r\n          const origin: Vector = furthestPoint.sub(updateVec);\r\n\r\n          const ray: Ray = new Ray(origin, body.vel);\r\n\r\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\r\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\r\n          let minCollider: Collider;\r\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\r\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Collider) => {\r\n            if (collider !== other && Pair.canCollide(collider, other)) {\r\n              const hitPoint = other.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\r\n              if (hitPoint) {\r\n                const translate = hitPoint.sub(origin);\r\n                if (translate.size < minTranslate.size) {\r\n                  minTranslate = translate;\r\n                  minCollider = other;\r\n                }\r\n              }\r\n            }\r\n            return false;\r\n          });\r\n\r\n          if (minCollider && Vector.isValid(minTranslate)) {\r\n            const pair = new Pair(collider, minCollider);\r\n            if (!this._collisions.has(pair.id)) {\r\n              this._collisions.add(pair.id);\r\n              this._collisionPairCache.push(pair);\r\n            }\r\n            // move the fast moving object to the other body\r\n            // need to push into the surface by ex.Physics.surfaceEpsilon\r\n            const shift = centerPoint.sub(furthestPoint);\r\n            body.pos = origin\r\n              .add(shift)\r\n              .add(minTranslate)\r\n              .add(ray.dir.scale(10 * Physics.surfaceEpsilon)); // needed to push the shape slightly into contact\r\n            collider.update(body.transform);\r\n\r\n            if (stats) {\r\n              stats.physics.fastBodyCollisions++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // return cache\r\n    return this._collisionPairCache;\r\n  }\r\n\r\n  /**\r\n   * Applies narrow phase on collision pairs to find actual area intersections\r\n   * Adds actual colliding pairs to stats' Frame data\r\n   */\r\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    let contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      contacts = contacts.concat(newContacts);\r\n      if (stats && newContacts.length > 0) {\r\n        for (const c of newContacts) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic tree positions\r\n   */\r\n  public update(targets: Collider[]): number {\r\n    let updated = 0;\r\n    const len = targets.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    this._dynamicCollisionTree.debug(ex);\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Clonable } from '../../Interfaces/Clonable';\r\nimport { Entity, Transform } from '../../EntityComponentSystem';\r\nimport { createId, Id } from '../../Id';\r\nimport { EventDispatcher } from '../../EventDispatcher';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\n/**\r\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\r\n * for the purposes of colliding 2 objects in excalibur.\r\n */\r\nexport abstract class Collider implements Clonable<Collider> {\r\n  private static _ID = 0;\r\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\r\n  public events: EventDispatcher<Collider> = new EventDispatcher<Collider>(this);\r\n\r\n  /**\r\n   * Returns a boolean indicating whether this body collided with\r\n   * or was in stationary contact with\r\n   * the body of the other [[Collider]]\r\n   */\r\n  public touching(other: Collider): boolean {\r\n    const contact = this.collide(other);\r\n\r\n    if (contact) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public owner: Entity;\r\n\r\n  /**\r\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\r\n   * on top of the collider.\r\n   */\r\n  offset: Vector;\r\n\r\n  /**\r\n   * Position of the collision collider in world coordinates\r\n   */\r\n  abstract get worldPos(): Vector;\r\n\r\n  /**\r\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\r\n   */\r\n  abstract get center(): Vector;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\r\n   */\r\n  abstract get bounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\r\n   */\r\n  abstract get localBounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axes of this particular collider\r\n   */\r\n  abstract get axes(): Vector[];\r\n  /**\r\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\r\n   */\r\n  abstract getFurthestPoint(direction: Vector): Vector;\r\n\r\n  abstract getInertia(mass: number): number;\r\n\r\n  // All new CollisionShape need to do the following\r\n  // Create a new collision function in the CollisionJumpTable against all the primitives\r\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\r\n  abstract collide(collider: Collider): CollisionContact[];\r\n\r\n  /**\r\n   * Returns the closest line between the surfaces this collider and another\r\n   * @param collider\r\n   */\r\n  abstract getClosestLineBetween(collider: Collider): Line;\r\n\r\n  /**\r\n   * Return wether the collider contains a point inclusive to it's border\r\n   */\r\n  abstract contains(point: Vector): boolean;\r\n\r\n  /**\r\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\r\n   */\r\n  abstract rayCast(ray: Ray, max?: number): Vector;\r\n\r\n  /**\r\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\r\n   */\r\n  abstract project(axis: Vector): Projection;\r\n\r\n  /**\r\n   * Updates collider world space geometry\r\n   */\r\n  abstract update(transform: Transform): void;\r\n\r\n  /**\r\n   * Draw the collider\r\n   * @deprecated Will be removed in 0.26.0\r\n   * @param ctx\r\n   * @param color\r\n   */\r\n  abstract draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void;\r\n\r\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color): void;\r\n  /**\r\n   * Draw any debug information\r\n   * @deprecated Will be removed in 0.26.0\r\n   */\r\n  abstract debugDraw(ctx: CanvasRenderingContext2D, color: Color): void;\r\n\r\n  abstract clone(): Collider;\r\n}\r\n","import { Util } from '../..';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { Color } from '../../Color';\r\nimport { Transform } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Line } from '../../Math/line';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector } from '../../Math/vector';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { DynamicTree } from '../Detection/DynamicTree';\r\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\r\nimport { Collider } from './Collider';\r\n\r\nexport class CompositeCollider extends Collider {\r\n  private _transform: Transform;\r\n  private _collisionProcessor = new DynamicTreeCollisionProcessor();\r\n  private _dynamicAABBTree = new DynamicTree();\r\n  private _colliders: Collider[] = [];\r\n\r\n  constructor(colliders: Collider[]) {\r\n    super();\r\n    for (const c of colliders) {\r\n      this.addCollider(c);\r\n    }\r\n  }\r\n\r\n  clearColliders() {\r\n    this._colliders = [];\r\n  }\r\n\r\n  addCollider(collider: Collider) {\r\n    this.events.wire(collider.events);\r\n    this._colliders.push(collider);\r\n    this._collisionProcessor.track(collider);\r\n    this._dynamicAABBTree.trackCollider(collider);\r\n  }\r\n\r\n  removeCollider(collider: Collider) {\r\n    this.events.unwire(collider.events);\r\n    Util.removeItemFromArray(collider, this._colliders);\r\n    this._collisionProcessor.untrack(collider);\r\n    this._dynamicAABBTree.untrackCollider(collider);\r\n  }\r\n\r\n  getColliders(): Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    // TODO transform component world pos\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get center(): Vector {\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get bounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce(\r\n      (acc, collider) => acc.combine(collider.bounds),\r\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\r\n    );\r\n\r\n    return results;\r\n  }\r\n\r\n  get localBounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\r\n\r\n    return results;\r\n  }\r\n\r\n  get axes(): Vector[] {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    let axes: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      axes = axes.concat(collider.axes);\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  getFurthestPoint(direction: Vector): Vector {\r\n    const colliders = this.getColliders();\r\n    const furthestPoints: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      furthestPoints.push(collider.getFurthestPoint(direction));\r\n    }\r\n    // Pick best point from all colliders\r\n    let bestPoint = furthestPoints[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (const point of furthestPoints) {\r\n      const distance = point.dot(direction);\r\n      if (distance > maxDistance) {\r\n        bestPoint = point;\r\n        maxDistance = distance;\r\n      }\r\n    }\r\n    return bestPoint;\r\n  }\r\n\r\n  getInertia(mass: number): number {\r\n    const colliders = this.getColliders();\r\n    let totalInertia = 0;\r\n    for (const collider of colliders) {\r\n      totalInertia += collider.getInertia(mass);\r\n    }\r\n    return totalInertia;\r\n  }\r\n\r\n  collide(other: Collider): CollisionContact[] {\r\n    let otherColliders = [other];\r\n    if (other instanceof CompositeCollider) {\r\n      otherColliders = other.getColliders();\r\n    }\r\n\r\n    const pairs: Pair[] = [];\r\n    for (const c of otherColliders) {\r\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\r\n        pairs.push(new Pair(c, potentialCollider));\r\n        return false;\r\n      });\r\n    }\r\n\r\n    let contacts: CollisionContact[] = [];\r\n    for (const p of pairs) {\r\n      contacts = contacts.concat(p.collide());\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  getClosestLineBetween(other: Collider): Line {\r\n    const colliders = this.getColliders();\r\n    const lines: Line[] = [];\r\n    if (other instanceof CompositeCollider) {\r\n      const otherColliders = other.getColliders();\r\n      for (const colliderA of colliders) {\r\n        for (const colliderB of otherColliders) {\r\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\r\n          if (maybeLine) {\r\n            lines.push(maybeLine);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const collider of colliders) {\r\n        const maybeLine = other.getClosestLineBetween(collider);\r\n        if (maybeLine) {\r\n          lines.push(maybeLine);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lines.length) {\r\n      let minLength = lines[0].getLength();\r\n      let minLine = lines[0];\r\n      for (const line of lines) {\r\n        const length = line.getLength();\r\n        if (length < minLength) {\r\n          minLength = length;\r\n          minLine = line;\r\n        }\r\n      }\r\n      return minLine;\r\n    }\r\n    return null;\r\n  }\r\n  contains(point: Vector): boolean {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      if (collider.contains(point)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  rayCast(ray: Ray, max?: number): Vector {\r\n    const colliders = this.getColliders();\r\n    const points: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      const vec = collider.rayCast(ray, max);\r\n      if (vec) {\r\n        points.push(vec);\r\n      }\r\n    }\r\n    if (points.length) {\r\n      let minPoint = points[0];\r\n      let minDistance = minPoint.dot(ray.dir);\r\n      for (const point of points) {\r\n        const distance = ray.dir.dot(point);\r\n        if (distance < minDistance) {\r\n          minPoint = point;\r\n          minDistance = distance;\r\n        }\r\n      }\r\n      return minPoint;\r\n    }\r\n    return null;\r\n  }\r\n  project(axis: Vector): Projection {\r\n    const colliders = this.getColliders();\r\n    const projs: Projection[] = [];\r\n    for (const collider of colliders) {\r\n      const proj = collider.project(axis);\r\n      if (proj) {\r\n        projs.push(proj);\r\n      }\r\n    }\r\n    // Merge all proj's on the same axis\r\n    if (projs.length) {\r\n      const newProjection = new Projection(projs[0].min, projs[0].max);\r\n      for (const proj of projs) {\r\n        newProjection.min = Math.min(proj.min, newProjection.min);\r\n        newProjection.max = Math.max(proj.max, newProjection.max);\r\n      }\r\n      return newProjection;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  update(transform: Transform): void {\r\n    if (transform) {\r\n      const colliders = this.getColliders();\r\n      for (const collider of colliders) {\r\n        collider.owner = this.owner;\r\n        collider.update(transform);\r\n      }\r\n    }\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.draw(ctx, color, pos);\r\n    }\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.debug(ex, color);\r\n    }\r\n  }\r\n\r\n  debugDraw(ctx: CanvasRenderingContext2D, color: Color): void {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.draw(ctx, color);\r\n    }\r\n  }\r\n  clone(): Collider {\r\n    return new CompositeCollider(this._colliders.map((c) => c.clone()));\r\n  }\r\n}\r\n","import { Vector } from './vector';\n\n/**\n * A 2D line segment\n */\n\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  public dir(): Vector {\n    return this.end.sub(this.begin);\n  }\n\n  public getPoints(): Vector[] {\n    return [this.begin, this.end];\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector of length 1\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\n   */\n  public getEdge(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    return end.sub(begin);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Returns the midpoint of the edge\n   */\n  public get midpoint(): Vector {\n    return this.begin.add(this.end).scale(0.5);\n  }\n\n  /**\n   * Flips the direction of the line segment\n   */\n  public flip(): Line {\n    return new Line(this.end, this.begin);\n  }\n\n  /**\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\n   * @param point\n   */\n  public below(point: Vector): boolean {\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\n    return above2 >= 0;\n  }\n\n  /**\n   * Returns the clip point\n   * @param sideVector Vector that traces the line\n   * @param length Length to clip along side\n   */\n  public clip(sideVector: Vector, length: number): Line {\n    let dir = sideVector;\n    dir = dir.normalize();\n\n    const near = dir.dot(this.begin) - length;\n    const far = dir.dot(this.end) - length;\n\n    const results = [];\n    if (near <= 0) {\n      results.push(this.begin);\n    }\n    if (far <= 0) {\n      results.push(this.end);\n    }\n\n    if (near * far < 0) {\n      const clipTime = near / (near - far);\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\n    }\n    if (results.length !== 2) {\n      return null;\n    }\n\n    return new Line(results[0], results[1]);\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector, signed: boolean = false) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return signed ? distance : Math.abs(distance);\n  }\n\n  /**\n   * Find the perpendicular line from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * (a - p) - ((a - p) * n)n\n   * a is a point on the line\n   * p is the arbitrary point above the line\n   * n is a unit vector in direction of the line\n   * @param point\n   */\n  public findVectorToPoint(point: Vector): Vector {\n    const aMinusP = this.begin.sub(point);\n    const n = this.getSlope();\n\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CircleCollider } from './CircleCollider';\n\n/**\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n * @param p0 Point where L1 begins\n * @param u Direction and length of L1\n * @param q0 Point were L2 begins\n * @param v Direction and length of L2\n */\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\n\n  // w(s, t) = P(s) - Q(t)\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\n  //\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\n  //\n  // The closest point between 2 lines then satisfies this pair of equations\n  // 1: u * wClosest = 0\n  // 2: v * wClosest = 0\n  //\n  // Substituting wClosest into the equations we get\n  //\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\n\n  // simplify w0\n  const w0 = p0.sub(q0);\n\n  // simplify (u * u);\n  const a = u.dot(u);\n  // simplify (u * v);\n  const b = u.dot(v);\n  // simplify (v * v)\n  const c = v.dot(v);\n  // simplify (u * w0)\n  const d = u.dot(w0);\n  // simplify (v * w0)\n  const e = v.dot(w0);\n\n  // denominator ac - b^2\n  const denom = a * c - b * b;\n  let sDenom = denom;\n  let tDenom = denom;\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\n  if (denom === 0 || denom <= 0.01) {\n    const tClosestParallel = d / b;\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\n  }\n\n  // Solve for sClosest for infinite line\n  let sClosest = b * e - c * d; // / denom;\n\n  // Solve for tClosest for infinite line\n  let tClosest = a * e - b * d; // / denom;\n\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\n  if (sClosest < 0) {\n    sClosest = 0;\n    tClosest = e;\n    tDenom = c;\n  } else if (sClosest > sDenom) {\n    sClosest = sDenom;\n    tClosest = e + b;\n    tDenom = c;\n  }\n\n  if (tClosest < 0) {\n    tClosest = 0;\n    if (-d < 0) {\n      sClosest = 0;\n    } else if (-d > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d;\n      sDenom = a;\n    }\n  } else if (tClosest > tDenom) {\n    tClosest = tDenom;\n    if (-d + b < 0) {\n      sClosest = 0;\n    } else if (-d + b > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d + b;\n      sDenom = a;\n    }\n  }\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\n\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\n}\n\nexport const ClosestLineJumpTable = {\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = polygonB.worldPos;\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\n    const thisDirection = otherDirection.negate();\n\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\n\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\n\n    const thisFace = polygonA.getClosestFace(thisPoint);\n    const otherFace = polygonB.getClosestFace(otherPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const q0 = otherFace.face.begin;\n    const v = otherFace.face.getEdge();\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = edge.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const q0 = edgeStart;\n    const v = edgeVector;\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circle.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // Time of minimum distance\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n  },\n\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circleB.worldPos;\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\n\n    const thisWorldPos = circleA.worldPos;\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\n\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n\n    const thisPoint = circleA.rayCast(rayTowardsOther);\n    const otherPoint = circleB.rayCast(rayTowardsThis);\n\n    return new Line(thisPoint, otherPoint);\n  },\n\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    const circleWorlPos = circle.worldPos;\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const p0 = edgeStart;\n    const u = edgeVector;\n\n    // Time of minimum distance\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp to edge\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\n  },\n\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLineA = edgeA.asLine();\n    const edgeStartA = edgeLineA.begin;\n    const edgeVectorA = edgeLineA.getEdge();\n    const p0 = edgeStartA;\n    const u = edgeVectorA;\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLineB = edgeB.asLine();\n    const edgeStartB = edgeLineB.begin;\n    const edgeVectorB = edgeLineB.getEdge();\n    const q0 = edgeStartB;\n    const v = edgeVectorB;\n\n    return ClosestLine(p0, u, q0, v);\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\n\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\nexport interface CircleColliderOptions {\r\n  /**\r\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Required radius of the circle\r\n   */\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * This is a circle collider for the excalibur rigid body physics simulation\r\n */\r\nexport class CircleCollider extends Collider {\r\n  /**\r\n   * Position of the circle relative to the collider, by default (0, 0).\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  public get worldPos(): Vector {\r\n    return this.offset.add(this._transform?.pos ?? Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * This is the radius of the circle\r\n   */\r\n  public radius: number;\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: CircleColliderOptions) {\r\n    super();\r\n    this.offset = options.offset || Vector.Zero;\r\n    this.radius = options.radius || 0;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this shape, not associated with any collider\r\n   */\r\n  public clone(): CircleCollider {\r\n    return new CircleCollider({\r\n      offset: this.offset.clone(),\r\n      radius: this.radius\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.offset.add(this._transform?.pos ?? Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    const pos = this._transform?.pos ?? this.offset;\r\n    const distance = pos.distance(point);\r\n    if (distance <= this.radius) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Casts a ray at the Circle collider and returns the nearest point of collision\r\n   * @param ray\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\r\n    const c = this.center;\r\n    const dir = ray.dir;\r\n    const orig = ray.pos;\r\n\r\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\r\n\r\n    if (discriminant < 0) {\r\n      // no intersection\r\n      return null;\r\n    } else {\r\n      let toi = 0;\r\n      if (discriminant === 0) {\r\n        toi = -dir.dot(orig.sub(c));\r\n        if (toi > 0 && toi < max) {\r\n          return ray.getPoint(toi);\r\n        }\r\n        return null;\r\n      } else {\r\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\r\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\r\n\r\n        const positiveToi: number[] = [];\r\n        if (toi1 >= 0) {\r\n          positiveToi.push(toi1);\r\n        }\r\n\r\n        if (toi2 >= 0) {\r\n          positiveToi.push(toi2);\r\n        }\r\n\r\n        const mintoi = Math.min(...positiveToi);\r\n        if (mintoi <= max) {\r\n          return ray.getPoint(mintoi);\r\n        }\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getClosestLineBetween(shape: Collider): Line {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    return this.center.add(direction.normalize().scale(this.radius));\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the shape in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const dir = direction.normalize();\r\n    return dir.scale(this.radius);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform as TransformComponent;\r\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\r\n    return new BoundingBox(\r\n      this.offset.x + bodyPos.x - this.radius,\r\n      this.offset.y + bodyPos.y - this.radius,\r\n      this.offset.x + bodyPos.x + this.radius,\r\n      this.offset.y + bodyPos.y + this.radius\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return new BoundingBox(\r\n      this.offset.x - this.radius,\r\n      this.offset.y - this.radius,\r\n      this.offset.x + this.radius,\r\n      this.offset.y + this.radius\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get axis not implemented on circles, since there are infinite axis in a circle\r\n   */\r\n  public get axes(): Vector[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Returns the moment of inertia of a circle given it's mass\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    return (mass * this.radius * this.radius) / 2;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n  }\r\n\r\n  /**\r\n   * Project the circle along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n    const point = this.center;\r\n    const dotProduct = point.dot(axis);\r\n    scalars.push(dotProduct);\r\n    scalars.push(dotProduct + this.radius);\r\n    scalars.push(dotProduct - this.radius);\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const newPos = pos.add(this.offset);\r\n    ctx.beginPath();\r\n    ctx.fillStyle = color.toString();\r\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const tx = this._transform as TransformComponent;\r\n    const pos = tx?.globalPos ? tx?.globalPos.add(this.offset) : this.offset;\r\n    ex.drawCircle(pos, this.radius, color);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\r\n    const transform = this._transform;\r\n    const pos = transform ? transform.pos.add(this.offset) : this.offset;\r\n    const rotation = transform ? transform.rotation : 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.beginPath();\r\n    ctx.moveTo(pos.x, pos.y);\r\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { Physics } from '../Physics';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionType } from '../CollisionType';\nimport { Pair } from './Pair';\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  private _canceled = false;\n\n  /**\n   * Currently the ids between colliders\n   */\n  readonly id: string;\n\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n\n  /**\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\n   */\n  mtv: Vector;\n\n  /**\n   * World space contact points between colliderA and colliderB\n   */\n  points: Vector[];\n\n  /**\n   * Local space contact points between colliderA and colliderB\n   */\n  localPoints: Vector[];\n\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  /**\n   * The collision tangent\n   */\n  tangent: Vector;\n\n  /**\n   * Information about the specifics of the collision contact separation\n   */\n  info: SeparationInfo;\n\n  constructor(\n    colliderA: Collider,\n    colliderB: Collider,\n    mtv: Vector,\n    normal: Vector,\n    tangent: Vector,\n    points: Vector[],\n    localPoints: Vector[],\n    info: SeparationInfo\n  ) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.normal = normal;\n    this.tangent = tangent;\n    this.points = points;\n    this.localPoints = localPoints;\n    this.info = info;\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Match contact awake state, except if body's are Fixed\n   */\n  public matchAwake(): void {\n    const bodyA = this.colliderA.owner.get(BodyComponent);\n    const bodyB = this.colliderB.owner.get(BodyComponent);\n    if (bodyA && bodyB) {\n      if (bodyA.sleeping !== bodyB.sleeping) {\n        if (bodyA.sleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= Physics.wakeThreshold) {\n          bodyA.setSleeping(false);\n        }\n        if (bodyB.sleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= Physics.wakeThreshold) {\n          bodyB.setSleeping(false);\n        }\n      }\n    }\n  }\n\n  public isCanceled() {\n    return this._canceled;\n  }\n\n  public cancel(): void {\n    this._canceled = true;\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Collider } from './Collider';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\n/**\n * Specific information about a contact and it's separation\n */\nexport interface SeparationInfo {\n  /**\n   * Collider A\n   */\n  collider: Collider;\n\n  /**\n   * Signed value (negative means overlap, positive no overlap)\n   */\n  separation: number;\n\n  /**\n   * Axis of separation from the collider's perpective\n   */\n  axis: Vector;\n\n  /**\n   * Side of separation (reference) from the collider's perpsective\n   */\n\n  side?: Line;\n\n  /**\n   * Local side of separation (reference) from the collider's perspective\n   */\n  localSide?: Line;\n\n  /**\n   * Index of the separation side (reference) from the collider's perspective\n   */\n  sideId?: number;\n\n  /**\n   * Point on collider B (incident point)\n   */\n  point: Vector;\n\n  /**\n   * Local point on collider B (incident point)\n   */\n  localPoint?: Vector;\n}\n\nexport class SeparatingAxis {\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\n    let bestSeparation = -Number.MAX_VALUE;\n    let bestSide: Line | null = null;\n    let bestAxis: Vector | null = null;\n    let bestSideIndex: number = -1;\n    let bestOtherPoint: Vector | null = null;\n    const sides = polyA.getSides();\n    const localSides = polyA.getLocalSides();\n    for (let i = 0; i < sides.length; i++) {\n      const side = sides[i];\n      const axis = side.normal();\n      const vertB = polyB.getFurthestPoint(axis.negate());\n      // Separation on side i's axis\n      // We are looking for the largest separation between poly A's sides\n      const vertSeparation = side.distanceToPoint(vertB, true);\n      if (vertSeparation > bestSeparation) {\n        bestSeparation = vertSeparation;\n        bestSide = side;\n        bestAxis = axis;\n        bestSideIndex = i;\n        bestOtherPoint = vertB;\n      }\n    }\n\n    return {\n      collider: polyA,\n      separation: bestAxis ? bestSeparation : 99,\n      axis: bestAxis as Vector,\n      side: bestSide,\n      localSide: localSides[bestSideIndex],\n      sideId: bestSideIndex,\n      point: bestOtherPoint as Vector,\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\n    };\n  }\n\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const polyDir = pc.sub(circle.worldPos);\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = circle.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n}\n","import { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { TransformComponent } from '../../EntityComponentSystem';\r\nimport { Pair } from '../Detection/Pair';\r\n\r\nexport const CollisionJumpTable = {\r\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\r\n    const circleAPos = circleA.worldPos;\r\n    const circleBPos = circleB.worldPos;\r\n    const combinedRadius = circleA.radius + circleB.radius;\r\n    const distance = circleAPos.distance(circleBPos);\r\n\r\n    if (distance > combinedRadius) {\r\n      return [];\r\n    }\r\n\r\n    // negative means overlap\r\n    const separation = combinedRadius - distance;\r\n\r\n    // Normal points from A -> B\r\n    const normal = circleBPos.sub(circleAPos).normalize();\r\n    const tangent = normal.perpendicular();\r\n    const mvt = normal.scale(separation);\r\n\r\n    const point = circleA.getFurthestPoint(normal);\r\n    const local = circleA.getFurthestLocalPoint(normal);\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circleA,\r\n      separation,\r\n      axis: normal,\r\n      point: point\r\n    };\r\n\r\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\r\n  },\r\n\r\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\r\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\r\n    if (!minAxis) {\r\n      return [];\r\n    }\r\n\r\n    // make sure that the minAxis is pointing away from circle\r\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\r\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\r\n\r\n    const point = circle.getFurthestPoint(minAxis);\r\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const local = xf.applyInverse(point);\r\n    const normal = minAxis.normalize();\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: -minAxis.size,\r\n      axis: normal,\r\n      point: point,\r\n      localPoint: local,\r\n      side: polygon.findSide(normal.negate()),\r\n      localSide: polygon.findLocalSide(normal.negate())\r\n    };\r\n\r\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\r\n  },\r\n\r\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\r\n    // TODO not sure this actually abides by local/world collisions\r\n    // Are edge.begin and edge.end local space or world space? I think they should be local\r\n\r\n    // center of the circle in world pos\r\n    const cc = circle.center;\r\n    // vector in the direction of the edge\r\n    const edgeWorld = edge.asLine();\r\n    const e = edgeWorld.end.sub(edgeWorld.begin);\r\n\r\n    // amount of overlap with the circle's center along the edge direction\r\n    const u = e.dot(edgeWorld.end.sub(cc));\r\n    const v = e.dot(cc.sub(edgeWorld.begin));\r\n    const side = edge.asLine();\r\n    const localSide = edge.asLocalLine();\r\n\r\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\r\n    if (v <= 0) {\r\n      const da = edgeWorld.begin.sub(cc);\r\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\r\n      // save some sqrts\r\n      if (dda > circle.radius * circle.radius) {\r\n        return []; // no collision\r\n      }\r\n\r\n      const normal = da.normalize();\r\n      const separation = circle.radius - Math.sqrt(dda);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.begin,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\r\n      ];\r\n    }\r\n\r\n    // Potential region B collision (circle is on the right side of the edge, after the end)\r\n    if (u <= 0) {\r\n      const db = edgeWorld.end.sub(cc);\r\n      const ddb = db.dot(db);\r\n      if (ddb > circle.radius * circle.radius) {\r\n        return [];\r\n      }\r\n\r\n      const normal = db.normalize();\r\n      const separation = circle.radius - Math.sqrt(ddb);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.end,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\r\n      ];\r\n    }\r\n\r\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\r\n    const den = e.dot(e);\r\n    const pointOnEdge = edgeWorld.begin\r\n      .scale(u)\r\n      .add(edgeWorld.end.scale(v))\r\n      .scale(1 / den);\r\n    const d = cc.sub(pointOnEdge);\r\n\r\n    const dd = d.dot(d);\r\n    if (dd > circle.radius * circle.radius) {\r\n      return []; // no collision\r\n    }\r\n\r\n    let normal = e.perpendicular();\r\n    // flip correct direction\r\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\r\n      normal.x = -normal.x;\r\n      normal.y = -normal.y;\r\n    }\r\n\r\n    normal = normal.normalize();\r\n    const separation = circle.radius - Math.sqrt(dd);\r\n\r\n    const mvt = normal.scale(separation);\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: separation,\r\n      axis: normal,\r\n      point: pointOnEdge,\r\n      side: side,\r\n      localSide: localSide\r\n    };\r\n\r\n    return [\r\n      new CollisionContact(\r\n        circle,\r\n        edge,\r\n        mvt,\r\n        normal.negate(),\r\n        normal.negate().perpendicular(),\r\n        [pointOnEdge],\r\n        [pointOnEdge.sub(edge.worldPos)],\r\n        info\r\n      )\r\n    ];\r\n  },\r\n\r\n  CollideEdgeEdge(): CollisionContact[] {\r\n    // Edge-edge collision doesn't make sense\r\n    return [];\r\n  },\r\n\r\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\r\n    const pc = polygon.center;\r\n    const ec = edge.center;\r\n    const dir = ec.sub(pc).normalize();\r\n\r\n    // build a temporary polygon from the edge to use SAT\r\n    const linePoly = new PolygonCollider({\r\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\r\n      offset: edge.offset\r\n    });\r\n    linePoly.owner = edge.owner;\r\n    const tx = edge.owner?.get(TransformComponent);\r\n    if (tx) {\r\n      linePoly.update(edge.owner.get(TransformComponent));\r\n    }\r\n    // Gross hack but poly-poly works well\r\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\r\n    if (contact.length) {\r\n      // Fudge the contact back to edge\r\n      contact[0].colliderB = edge;\r\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\r\n      // contact[0].info.collider\r\n    }\r\n    return contact;\r\n  },\r\n\r\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\r\n    // If there is no overlap from boxA's perspective we can end early\r\n    if (separationA.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\r\n    // If there is no overlap from boxB's perspective exit now\r\n    if (separationB.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    // Separations are both negative, we want to pick the least negative (minimal movement)\r\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\r\n\r\n    // The incident side is the most opposite from the axes of collision on the other collider\r\n    const other = separation.collider === polyA ? polyB : polyA;\r\n    const incident = other.findSide(separation.axis.negate()) as Line;\r\n\r\n    // Clip incident side by the perpendicular lines at each end of the reference side\r\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\r\n    const reference = separation.side;\r\n    const refDir = reference.dir().normalize();\r\n\r\n    // Find our contact points by clipping the incident by the collision side\r\n    const clipRight = incident.clip(refDir.negate(), -refDir.dot(reference.begin));\r\n    let clipLeft: Line | null = null;\r\n    if (clipRight) {\r\n      clipLeft = clipRight.clip(refDir, refDir.dot(reference.end));\r\n    }\r\n\r\n    // If there is no left there is no collision\r\n    if (clipLeft) {\r\n      // We only want clip points below the reference edge, discard the others\r\n      const points = clipLeft.getPoints().filter((p) => {\r\n        return reference.below(p);\r\n      });\r\n\r\n      let normal = separation.axis;\r\n      let tangent = normal.perpendicular();\r\n      // Point Contact A -> B\r\n      if (polyB.worldPos.sub(polyA.worldPos).dot(normal) < 0) {\r\n        normal = normal.negate();\r\n        tangent = normal.perpendicular();\r\n      }\r\n      // Points are clipped from incident which is the other collider\r\n      // Store those as locals\r\n      let localPoints: Vector[] = [];\r\n      if (separation.collider === polyA) {\r\n        const xf = polyB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      } else {\r\n        const xf = polyA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      }\r\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\r\n    }\r\n    return [];\r\n  },\r\n\r\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\r\n    const shapeA = contact.colliderA;\r\n    const txA = contact.colliderA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const shapeB = contact.colliderB;\r\n    const txB = contact.colliderB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n\r\n    // both are circles\r\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\r\n      const combinedRadius = shapeA.radius + shapeB.radius;\r\n      const distance = txA.pos.distance(txB.pos);\r\n      const separation = combinedRadius - distance;\r\n      return -separation;\r\n    }\r\n\r\n    // both are polygons\r\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\r\n      if (contact.info.localSide) {\r\n        let side: Line;\r\n        let worldPoint: Vector;\r\n        if (contact.info.collider === shapeA) {\r\n          side = new Line(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\r\n          worldPoint = txB.apply(localPoint);\r\n        } else {\r\n          side = new Line(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\r\n          worldPoint = txA.apply(localPoint);\r\n        }\r\n\r\n        return side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v circle\r\n    if (\r\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\r\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\r\n    ) {\r\n      const worldPoint = txA.apply(localPoint);\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v edge\r\n    if (\r\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\r\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\r\n    ) {\r\n      let worldPoint: Vector;\r\n      if (contact.info.collider === shapeA) {\r\n        worldPoint = txB.apply(localPoint);\r\n      } else {\r\n        worldPoint = txA.apply(localPoint);\r\n      }\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // circle v edge\r\n    if (\r\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\r\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\r\n    ) {\r\n      // Local point is always on the edge which is always shapeB\r\n      const worldPoint = txB.apply(localPoint);\r\n\r\n      let circlePoint: Vector;\r\n      if (shapeA instanceof CircleCollider) {\r\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\r\n      }\r\n\r\n      const dist = worldPoint.distance(circlePoint);\r\n\r\n      if (contact.info.side) {\r\n        return dist > 0 ? -dist : 0;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\nexport interface EdgeColliderOptions {\r\n  /**\r\n   * The beginning of the edge defined in local coordinates to the collider\r\n   */\r\n  begin: Vector;\r\n  /**\r\n   * The ending of the edge defined in local coordinates to the collider\r\n   */\r\n  end: Vector;\r\n  /**\r\n   * Optionall specify an offset\r\n   */\r\n  offset?: Vector;\r\n}\r\n\r\n/**\r\n * Edge is a single line collider to create collisions with a single line.\r\n */\r\nexport class EdgeCollider extends Collider {\r\n  offset: Vector;\r\n  begin: Vector;\r\n  end: Vector;\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: EdgeColliderOptions) {\r\n    super();\r\n    this.begin = options.begin || Vector.Zero;\r\n    this.end = options.end || Vector.Zero;\r\n    this.offset = options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this Edge, not associated with any collider\r\n   */\r\n  public clone(): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: this.begin.clone(),\r\n      end: this.end.clone()\r\n    });\r\n  }\r\n\r\n  public get worldPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    return tx?.globalPos.add(this.offset) ?? this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collision area in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\r\n    return pos;\r\n  }\r\n\r\n  private _getBodyPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\r\n    return bodyPos;\r\n  }\r\n\r\n  private _getTransformedBegin(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const angle = tx ? tx.globalRotation : 0;\r\n    return this.begin.rotate(angle).add(this._getBodyPos());\r\n  }\r\n\r\n  private _getTransformedEnd(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const angle = tx ? tx.globalRotation : 0;\r\n    return this.end.rotate(angle).add(this._getBodyPos());\r\n  }\r\n\r\n  /**\r\n   * Returns the slope of the line in the form of a vector\r\n   */\r\n  public getSlope(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collision area\r\n   */\r\n  public contains(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    const numerator = this._getTransformedBegin().sub(ray.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\r\n      return null;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = ray.dir.cross(this.getSlope());\r\n    if (divisor === 0) {\r\n      return null;\r\n    }\r\n\r\n    const t = numerator.cross(this.getSlope()) / divisor;\r\n\r\n    if (t >= 0 && t <= max) {\r\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return ray.getPoint(t);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the closes line between this and another collider, from this -> collider\r\n   * @param shape\r\n   */\r\n  public getClosestLineBetween(shape: Collider): Line {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(shape: Collider): CollisionContact[] {\r\n    if (shape instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideEdgeEdge();\r\n    } else {\r\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    if (direction.dot(transformedBegin) > 0) {\r\n      return transformedBegin;\r\n    } else {\r\n      return transformedEnd;\r\n    }\r\n  }\r\n\r\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\r\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\r\n    // this causes problems for the collision system so we give them some padding\r\n    return new BoundingBox(\r\n      Math.min(begin.x, end.x) - padding,\r\n      Math.min(begin.y, end.y) - padding,\r\n      Math.max(begin.x, end.x) + padding,\r\n      Math.max(begin.y, end.y) + padding\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in world space\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in local space\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return this._boundsFromBeginEnd(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns this edge represented as a line in world coordinates\r\n   */\r\n  public asLine(): Line {\r\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\r\n  }\r\n\r\n  /**\r\n   * Return this edge as a line in local line coordinates (relative to the position)\r\n   */\r\n  public asLocalLine(): Line {\r\n    return new Line(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the edge\r\n   */\r\n  public get axes(): Vector[] {\r\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\r\n    const edgeNormal = e.normal();\r\n\r\n    const axes = [];\r\n    axes.push(edgeNormal);\r\n    axes.push(edgeNormal.negate());\r\n    axes.push(edgeNormal.normal());\r\n    axes.push(edgeNormal.normal().negate());\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an edge\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    const length = this.end.sub(this.begin).distance() / 2;\r\n    return mass * length * length;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n  }\r\n\r\n  /**\r\n   * Project the edge along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n\r\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      scalars.push(points[i].dot(axis));\r\n    }\r\n\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const begin = this.begin.add(pos);\r\n    const end = this.end.add(pos);\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.beginPath();\r\n    ctx.moveTo(begin.x, begin.y);\r\n    ctx.lineTo(end.x, end.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ex.drawLine(begin, end, color, 2);\r\n    ex.drawCircle(begin, 2, color);\r\n    ex.drawCircle(end, 2, color);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.beginPath();\r\n    ctx.moveTo(begin.x, begin.y);\r\n    ctx.lineTo(end.x, end.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\r\nimport { Collider } from './Collider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\nexport interface PolygonColliderOptions {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  points: Vector[];\r\n  /**\r\n   * Whether points are specified in clockwise or counter clockwise order, default counter-clockwise\r\n   */\r\n  clockwiseWinding?: boolean;\r\n}\r\n\r\n/**\r\n * Polygon collider for detecting collisions\r\n */\r\nexport class PolygonCollider extends Collider {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  public offset: Vector;\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  public points: Vector[];\r\n\r\n  private _transform: Transform;\r\n\r\n  private _transformedPoints: Vector[] = [];\r\n  private _axes: Vector[] = [];\r\n  private _sides: Line[] = [];\r\n  private _localSides: Line[] = [];\r\n\r\n  constructor(options: PolygonColliderOptions) {\r\n    super();\r\n    this.offset = options.offset ?? Vector.Zero;\r\n    const winding = !!options.clockwiseWinding;\r\n    this.points = (winding ? options.points.reverse() : options.points) || [];\r\n\r\n    // calculate initial transformation\r\n    this._calculateTransformation();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this ConvexPolygon, not associated with any collider\r\n   */\r\n  public clone(): PolygonCollider {\r\n    return new PolygonCollider({\r\n      offset: this.offset.clone(),\r\n      points: this.points.map((p) => p.clone())\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\r\n   */\r\n  public get worldPos(): Vector {\r\n    if (this._transform) {\r\n      return this._transform.pos.add(this.offset);\r\n    }\r\n    return this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.bounds.center;\r\n  }\r\n\r\n  /**\r\n   * Calculates the underlying transformation from the body relative space to world space\r\n   */\r\n  private _calculateTransformation() {\r\n    const transform = this._transform as TransformComponent;\r\n\r\n    const pos = transform ? transform.globalPos.add(this.offset) : this.offset;\r\n    const angle = transform ? transform.globalRotation : 0;\r\n    const scale = transform ? transform.globalScale : Vector.One;\r\n\r\n    const len = this.points.length;\r\n    this._transformedPoints.length = 0; // clear out old transform\r\n    for (let i = 0; i < len; i++) {\r\n      this._transformedPoints[i] = this.points[i].scale(scale).rotate(angle).add(pos);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\r\n   */\r\n  public getTransformedPoints(): Vector[] {\r\n    this._calculateTransformation();\r\n    return this._transformedPoints;\r\n  }\r\n\r\n  /**\r\n   * Gets the sides of the polygon in world space\r\n   */\r\n  public getSides(): Line[] {\r\n    if (this._sides.length) {\r\n      return this._sides;\r\n    }\r\n    const lines = [];\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      // This winding is important\r\n      lines.push(new Line(points[i], points[(i + 1) % len]));\r\n    }\r\n    this._sides = lines;\r\n    return this._sides;\r\n  }\r\n\r\n  /**\r\n   * Returns the local coordinate space sides\r\n   */\r\n  public getLocalSides(): Line[] {\r\n    if (this._localSides.length) {\r\n      return this._localSides;\r\n    }\r\n    const lines = [];\r\n    const points = this.points;\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      // This winding is important\r\n      lines.push(new Line(points[i], points[(i + 1) % len]));\r\n    }\r\n    this._localSides = lines;\r\n    return this._localSides;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the world space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findSide(direction: Vector): Line {\r\n    const sides = this.getSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the local space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findLocalSide(direction: Vector): Line {\r\n    const sides = this.getLocalSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the convex polygon\r\n   */\r\n  public get axes(): Vector[] {\r\n    if (this._axes.length) {\r\n      return this._axes;\r\n    }\r\n    const axes = this.getSides().map((s) => s.normal());\r\n    this._axes = axes;\r\n    return this._axes;\r\n  }\r\n\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    this._sides.length = 0;\r\n    this._localSides.length = 0;\r\n    this._axes.length = 0;\r\n    this._transformedPoints.length = 0;\r\n    this.getTransformedPoints();\r\n    this.getSides();\r\n    this.getLocalSides();\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider in world space\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\r\n    // will be fine\r\n    const testRay = new Ray(point, new Vector(1, 0));\r\n    const intersectCount = this.getSides().reduce(function (accum, side) {\r\n      if (testRay.intersect(side) >= 0) {\r\n        return accum + 1;\r\n      }\r\n      return accum;\r\n    }, 0);\r\n\r\n    if (intersectCount % 2 === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getClosestLineBetween(collider: Collider): Line {\r\n    if (collider instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\r\n   * return null.\r\n   * @param collider\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const pts = this.getTransformedPoints();\r\n    let furthestPoint = null;\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the collider furthest in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const pts = this.points;\r\n    let furthestPoint = pts[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Finds the closes face to the point using perpendicular distance\r\n   * @param point point to test against polygon\r\n   */\r\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\r\n    const sides = this.getSides();\r\n    let min = Number.POSITIVE_INFINITY;\r\n    let faceIndex = -1;\r\n    let distance = -1;\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const dist = sides[i].distanceToPoint(point);\r\n      if (dist < min) {\r\n        min = dist;\r\n        faceIndex = i;\r\n        distance = dist;\r\n      }\r\n    }\r\n\r\n    if (faceIndex !== -1) {\r\n      return {\r\n        distance: sides[faceIndex].normal().scale(distance),\r\n        face: sides[faceIndex]\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero).add(this.offset);\r\n    return this.localBounds.scale(scale).rotate(rotation).translate(pos);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return BoundingBox.fromPoints(this.points);\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an arbitrary polygon\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    let numerator = 0;\r\n    let denominator = 0;\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      const iplusone = (i + 1) % this.points.length;\r\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\r\n      numerator +=\r\n        crossTerm *\r\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\r\n      denominator += crossTerm;\r\n    }\r\n    return (mass / 6) * (numerator / denominator);\r\n  }\r\n\r\n  /**\r\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity) {\r\n    // find the minimum contact time greater than 0\r\n    // contact times less than 0 are behind the ray and we don't want those\r\n    const sides = this.getSides();\r\n    const len = sides.length;\r\n    let minContactTime = Number.MAX_VALUE;\r\n    let contactIndex = -1;\r\n    for (let i = 0; i < len; i++) {\r\n      const contactTime = ray.intersect(sides[i]);\r\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\r\n        minContactTime = contactTime;\r\n        contactIndex = i;\r\n      }\r\n    }\r\n\r\n    // contact was found\r\n    if (contactIndex >= 0) {\r\n      return ray.getPoint(minContactTime);\r\n    }\r\n\r\n    // no contact found\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Project the edges of the polygon along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    let min = Number.MAX_VALUE;\r\n    let max = -Number.MAX_VALUE;\r\n    for (let i = 0; i < len; i++) {\r\n      const scalar = points[i].dot(axis);\r\n      min = Math.min(min, scalar);\r\n      max = Math.max(max, scalar);\r\n    }\r\n\r\n    return new Projection(min, max);\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const effectiveOffset = pos.add(this.offset);\r\n    ctx.beginPath();\r\n    ctx.fillStyle = color.toString();\r\n\r\n    const firstPoint = this.points[0].add(effectiveOffset);\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n\r\n    // Points are relative\r\n    this.points\r\n      .map((p) => p.add(effectiveOffset))\r\n      .forEach(function (point) {\r\n        ctx.lineTo(point.x, point.y);\r\n      });\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    const points = [firstPoint, ...this.getTransformedPoints(), firstPoint];\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      ex.drawLine(points[i], points[i + 1], color, 2);\r\n      ex.drawCircle(points[i], 2, color);\r\n      ex.drawCircle(points[i + 1], 2, color);\r\n    }\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = color.toString();\r\n    // Iterate through the supplied points and construct a 'polygon'\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n    this.getTransformedPoints().forEach(function (point) {\r\n      ctx.lineTo(point.x, point.y);\r\n    });\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { PolygonCollider } from './PolygonCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Logger } from '../..';\r\n\r\n/**\r\n * Excalibur helper for defining colliders quickly\r\n */\r\nexport class Shape {\r\n  /**\r\n   * Creates a box collider, under the hood defines a [[PolygonCollider]] collider\r\n   * @param width Width of the box\r\n   * @param height Height of the box\r\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[PolygonCollider|arbitrary polygon]] collider\r\n   *\r\n   * PolygonColliders are useful for creating convex polygon shapes\r\n   * @param points Points specified in counter clockwise\r\n   * @param clockwiseWinding Optionally changed the winding of points, by default false meaning counter-clockwise winding.\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Polygon(points: Vector[], clockwiseWinding: boolean = false, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: points,\r\n      offset: offset,\r\n      clockwiseWinding: clockwiseWinding\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[CircleCollider|circle]] collider\r\n   *\r\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\r\n   * @param radius Radius of the circle collider\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\r\n    return new CircleCollider({\r\n      radius: radius,\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[EdgeCollider|edge]] collider\r\n   *\r\n   * Edge colliders are useful for  floors, walls, and other barriers\r\n   * @param begin Beginning of the edge in local coordinates to the collider\r\n   * @param end Ending of the edge in local coordinates to the collider\r\n   */\r\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: begin,\r\n      end: end\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new capsule shaped [[CompositeCollider]] using 2 circles and a box\r\n   *\r\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\r\n   * player experience.\r\n   *\r\n   * @param width\r\n   * @param height\r\n   * @param offset Optional offset\r\n   */\r\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\r\n    const logger = Logger.getInstance();\r\n    if (width === height) {\r\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\r\n    }\r\n\r\n    const vertical = height >= width;\r\n\r\n    if (vertical) {\r\n      // height > width, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\r\n        Shape.Box(width, height - width, Vector.Half, offset),\r\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\r\n      ]);\r\n      return capsule;\r\n    } else {\r\n      // width > height, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\r\n        Shape.Box(width - height, height, Vector.Half, offset),\r\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\r\n      ]);\r\n      return capsule;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\r\nimport { Observable } from '../Util/Observable';\r\nimport { BoundingBox } from './BoundingBox';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { CircleCollider } from './Colliders/CircleCollider';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { PolygonCollider } from './Colliders/PolygonCollider';\r\nimport { EdgeCollider } from './Colliders/EdgeCollider';\r\nimport { Shape } from './Colliders/Shape';\r\n\r\nexport class ColliderComponent extends Component<'ex.collider'> {\r\n  public readonly type = 'ex.collider';\r\n\r\n  public events = new EventDispatcher(this);\r\n  /**\r\n   * Observable that notifies when a collider is added to the body\r\n   */\r\n  public $colliderAdded = new Observable<Collider>();\r\n\r\n  /**\r\n   * Observable that notifies when a collider is removed from the body\r\n   */\r\n  public $colliderRemoved = new Observable<Collider>();\r\n\r\n  constructor(collider?: Collider) {\r\n    super();\r\n    this.set(collider);\r\n  }\r\n\r\n  private _collider: Collider;\r\n  /**\r\n   * Get the current collider geometry\r\n   * @returns\r\n   */\r\n  public get() {\r\n    return this._collider;\r\n  }\r\n\r\n  /**\r\n   * Set the collider geometry\r\n   * @param collider\r\n   * @returns the collider you set\r\n   */\r\n  public set<T extends Collider>(collider: T): T {\r\n    this.clear();\r\n    if (collider) {\r\n      this._collider = collider;\r\n      this._collider.owner = this.owner;\r\n      this.events.wire(collider.events);\r\n      this.$colliderAdded.notifyAll(collider);\r\n      this.update();\r\n    }\r\n    return collider;\r\n  }\r\n\r\n  /**\r\n   * Remove collider geometry from collider component\r\n   */\r\n  public clear() {\r\n    if (this._collider) {\r\n      this.events.unwire(this._collider.events);\r\n      this.$colliderRemoved.notifyAll(this._collider);\r\n      this._collider.owner = null;\r\n      this._collider = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return world space bounds\r\n   */\r\n  public get bounds() {\r\n    return this._collider?.bounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Return local space bounds\r\n   */\r\n  public get localBounds() {\r\n    return this._collider?.localBounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Update the collider's transformed geometry\r\n   */\r\n  public update() {\r\n    const tx = this.owner?.get(TransformComponent);\r\n    if (this._collider) {\r\n      this._collider.owner = this.owner;\r\n      if (tx) {\r\n        this._collider.update(tx);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collide component with another\r\n   * @param other\r\n   * @returns\r\n   */\r\n  collide(other: ColliderComponent): CollisionContact[] {\r\n    let colliderA = this._collider;\r\n    let colliderB = other._collider;\r\n    if (!colliderA || !colliderB) {\r\n      return [];\r\n    }\r\n\r\n    // If we have a composite lefthand side :(\r\n    // Might bite us, but to avoid updating all the handlers make composite always left side\r\n    let flipped = false;\r\n    if (colliderB instanceof CompositeCollider) {\r\n      colliderA = colliderB;\r\n      colliderB = this._collider;\r\n      flipped = true;\r\n    }\r\n\r\n    if (this._collider) {\r\n      const contacts = colliderA.collide(colliderB);\r\n      if (contacts) {\r\n        if (flipped) {\r\n          contacts.forEach((contact) => {\r\n            contact.mtv = contact.mtv.negate();\r\n            contact.normal = contact.normal.negate();\r\n            contact.tangent = contact.normal.perpendicular();\r\n            contact.colliderA = this._collider;\r\n            contact.colliderB = other._collider;\r\n          });\r\n        }\r\n        return contacts;\r\n      }\r\n      return [];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  onAdd(entity: Entity) {\r\n    if (this._collider) {\r\n      this.update();\r\n    }\r\n    // Wire up the collider events to the owning entity\r\n    this.events.on('precollision', (evt: any) => {\r\n      const precollision = evt as PreCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(precollision.target.owner, precollision.other.owner, precollision.side, precollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('postcollision', (evt: any) => {\r\n      const postcollision = evt as PostCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(postcollision.target.owner, postcollision.other.owner, postcollision.side, postcollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('collisionstart', (evt: any) => {\r\n      const start = evt as CollisionStartEvent<Collider>;\r\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.target.owner, start.other.owner, start.contact));\r\n    });\r\n    this.events.on('collisionend', (evt: any) => {\r\n      const end = evt as CollisionEndEvent<Collider>;\r\n      entity.events.emit('collisionend', new CollisionEndEvent(end.target.owner, end.other.owner));\r\n    });\r\n  }\r\n\r\n  onRemove() {\r\n    this.events.clear();\r\n    this.$colliderRemoved.notifyAll(this._collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\r\n   *\r\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\r\n    const collider = Shape.Box(width, height, anchor, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[PolygonCollider|polygon]] collision geometry based on a list of of points relative\r\n   *  to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\r\n    const poly = Shape.Polygon(points, false, center);\r\n    return (this.set(poly));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[Circle|circle collision geometry]] as the only collider with a specified radius in pixels.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\r\n    const collider = Shape.Circle(radius, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\r\n    const collider = Shape.Edge(begin, end);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Setups up a [[CompositeCollider]] which can define any arbitrary set of excalibur colliders\r\n   * @param colliders\r\n   * @returns\r\n   */\r\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\r\n    return (this.set(new CompositeCollider(colliders)));\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { CollisionType } from './CollisionType';\r\nimport { Physics } from './Physics';\r\nimport { Clonable } from '../Interfaces/Clonable';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { CollisionGroup } from './Group/CollisionGroup';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { createId, Id } from '../Id';\r\nimport { clamp } from '../Util/Util';\r\nimport { ColliderComponent } from './ColliderComponent';\r\n\r\nexport interface BodyComponentOptions {\r\n  type?: CollisionType;\r\n  group?: CollisionGroup;\r\n  useGravity?: boolean;\r\n}\r\n\r\nexport enum DegreeOfFreedom {\r\n  Rotation = 'rotation',\r\n  X = 'x',\r\n  Y = 'y'\r\n}\r\n\r\n/**\r\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\r\n * of physics simulation.\r\n */\r\nexport class BodyComponent extends Component<'ex.body'> implements Clonable<BodyComponent> {\r\n  public readonly type = 'ex.body';\r\n  public dependencies = [TransformComponent, MotionComponent];\r\n  public static _ID = 0;\r\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\r\n  public events = new EventDispatcher(this);\r\n\r\n  constructor(options?: BodyComponentOptions) {\r\n    super();\r\n    if (options) {\r\n      this.collisionType = options.type ?? this.collisionType;\r\n      this.group = options.group ?? this.group;\r\n      this.useGravity = options.useGravity ?? this.useGravity;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collision type for the rigidbody physics simulation, by default [[CollisionType.PreventCollision]]\r\n   */\r\n  public collisionType: CollisionType = CollisionType.PreventCollision;\r\n\r\n  /**\r\n   * The collision group for the body's colliders, by default body colliders collide with everything\r\n   */\r\n  public group: CollisionGroup = CollisionGroup.All;\r\n\r\n  /**\r\n   * The amount of mass the body has\r\n   */\r\n  public mass: number = Physics.defaultMass;\r\n\r\n  /**\r\n   * The inverse mass (1/mass) of the body. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseMass(): number {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\r\n  }\r\n\r\n  /**\r\n   * Amount of \"motion\" the body has before sleeping. If below [[Physics.sleepEpsilon]] it goes to \"sleep\"\r\n   */\r\n  public sleepMotion: number = Physics.sleepEpsilon * 5;\r\n\r\n  /**\r\n   * Can this body sleep, by default bodies do not sleep\r\n   */\r\n  public canSleep: boolean = Physics.bodiesCanSleepByDefault;\r\n\r\n  private _sleeping = false;\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   */\r\n  public get sleeping(): boolean {\r\n    return this._sleeping;\r\n  }\r\n\r\n  /**\r\n   * Set the sleep state of the body\r\n   * @param sleeping\r\n   */\r\n  public setSleeping(sleeping: boolean) {\r\n    this._sleeping = sleeping;\r\n    if (!sleeping) {\r\n      // Give it a kick to keep it from falling asleep immediately\r\n      this.sleepMotion = Physics.sleepEpsilon * 5;\r\n    } else {\r\n      this.vel = Vector.Zero;\r\n      this.acc = Vector.Zero;\r\n      this.angularVelocity = 0;\r\n      this.sleepMotion = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update body's [[BodyComponent.sleepMotion]] for the purpose of sleeping\r\n   */\r\n  public updateMotion() {\r\n    if (this._sleeping) {\r\n      this.setSleeping(true);\r\n    }\r\n    const currentMotion = this.vel.size * this.vel.size + Math.abs(this.angularVelocity * this.angularVelocity);\r\n    const bias = Physics.sleepBias;\r\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\r\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * Physics.sleepEpsilon);\r\n    if (this.canSleep && this.sleepMotion < Physics.sleepEpsilon) {\r\n      this.setSleeping(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia from the [[ColliderComponent]]\r\n   */\r\n  public get inertia() {\r\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\r\n    const collider = this.owner.get(ColliderComponent);\r\n    if (collider?.get()) {\r\n      return collider.get().getInertia(this.mass);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Get the inverse moment of inertial from the [[ColliderComponent]]. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseInertia() {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia;\r\n  }\r\n\r\n  /**\r\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\r\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\r\n   */\r\n  public bounciness: number = 0.2;\r\n\r\n  /**\r\n   * The coefficient of friction on this actor\r\n   */\r\n  public friction: number = 0.99;\r\n\r\n  /**\r\n   * Should use global gravity [[Physics.gravity]] in it's physics simulation, default is true\r\n   */\r\n  public useGravity: boolean = true;\r\n\r\n  /**\r\n   * Degrees of freedom to limit\r\n   */\r\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   */\r\n  public get active() {\r\n    return !!this.owner?.active;\r\n  }\r\n\r\n  public get center() {\r\n    return this.pos;\r\n  }\r\n\r\n  public get transform(): TransformComponent {\r\n    return this.owner?.get(TransformComponent);\r\n  }\r\n\r\n  public get motion(): MotionComponent {\r\n    return this.owner?.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * The (x, y) position of the actor this will be in the middle of the actor if the\r\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\r\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.globalPos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.globalPos = val;\r\n  }\r\n\r\n  /**\r\n   * The position of the actor last frame (x, y) in pixels\r\n   */\r\n  public oldPos: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current velocity vector (vx, vy) of the actor in pixels/second\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this.motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * The velocity of the actor last frame (vx, vy) in pixels/second\r\n   */\r\n  public oldVel: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\r\n   * be useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  public set acc(val: Vector) {\r\n    this.motion.acc = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public oldAcc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The current torque applied to the actor\r\n   */\r\n  public get torque(): number {\r\n    return this.motion.torque;\r\n  }\r\n\r\n  public set torque(val: number) {\r\n    this.motion.torque = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the rotation of the body from the last frame.\r\n   */\r\n  public oldRotation: number = 0; // radians\r\n\r\n  /**\r\n   * The rotation of the body in radians\r\n   */\r\n  public get rotation() {\r\n    return this.transform.globalRotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.transform.globalRotation = val;\r\n  }\r\n\r\n  /**\r\n   * The scale vector of the actor\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0, Use ex.Transform.scale\r\n   */\r\n  public get scale(): Vector {\r\n    return this.transform.globalScale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.transform.globalScale = val;\r\n  }\r\n\r\n  /**\r\n   * The scale of the actor last frame\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public oldScale: Vector = Vector.One;\r\n\r\n  /**\r\n   * The x scalar velocity of the actor in scale/second\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public get sx(): number {\r\n    return this.motion.scaleFactor.x;\r\n  }\r\n\r\n  public set sx(xFactor: number) {\r\n    this.motion.scaleFactor.x = xFactor;\r\n  }\r\n\r\n  /**\r\n   * The y scalar velocity of the actor in scale/second\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public get sy(): number {\r\n    return this.motion.scaleFactor.y;\r\n  }\r\n\r\n  public set sy(yFactor: number) {\r\n    this.motion.scaleFactor.y = yFactor;\r\n  }\r\n\r\n  /**\r\n   * The rotational velocity of the actor in radians/second\r\n   * @deprecated\r\n   */\r\n  public get rx(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * The rotational velocity of the actor in radians/second\r\n   * @deprecated\r\n   */\r\n  public set rx(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Get the angular velocity in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Set the angular velocity in radians/second\r\n   */\r\n  public set angularVelocity(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Apply a specific impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel.addEqual(finalImpulse);\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.pos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply only linear impulse to the body\r\n   * @param impulse\r\n   */\r\n  public applyLinearImpulse(impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel = this.vel.add(finalImpulse);\r\n  }\r\n\r\n  /**\r\n   * Apply only angular impuse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.pos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the old versions of pos, vel, acc, and scale.\r\n   */\r\n  public captureOldTransform() {\r\n    // Capture old values before integration step updates them\r\n    this.oldVel.setTo(this.vel.x, this.vel.y);\r\n    this.oldPos.setTo(this.pos.x, this.pos.y);\r\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\r\n    this.oldScale.setTo(this.scale.x, this.scale.y);\r\n    this.oldRotation = this.rotation;\r\n  }\r\n\r\n  debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\n\n/**\n * @deprecated Will be removed in 0.26.0\n */\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getGlobalPos();\n\n    this._topLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight = vec(worldPos.x + drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight = vec(worldPos.x + drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // top left\n      new Vector(this._xMax, this._yMin), // top right\n      new Vector(this._xMin, this._yMax), // bottom left\n      new Vector(this._xMax, this._yMax) // bottom right\n    ];\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\nimport { TagComponent } from '../EntityComponentSystem';\n\n/**\n * @deprecated will be removed in 0.26.0\n */\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport && !actor.parent) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.addComponent(new TagComponent('offscreen'));\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.removeComponent('offscreen');\n      }\n    }\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\r\nimport { Actor } from '../Actor';\r\nimport { Engine } from '../Engine';\r\n\r\n/**\r\n * Revises pointer events path accordingly to the actor\r\n * @deprecated Will be removed in 0.26.0\r\n */\r\nexport class CapturePointer implements Trait {\r\n  public update(actor: Actor, engine: Engine) {\r\n    if (!actor.enableCapturePointer) {\r\n      return;\r\n    }\r\n    if (actor.isKilled()) {\r\n      return;\r\n    }\r\n\r\n    engine.input.pointers.checkAndUpdateActorUnderPointer(actor);\r\n  }\r\n}\r\n","import { Component, ComponentCtor, TagComponent } from './Component';\r\n\r\nimport { Observable, Message } from '../Util/Observable';\r\nimport { Class } from '../Class';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\r\nimport { Engine } from '../Engine';\r\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { Util } from '..';\r\n\r\n/**\r\n * Interface holding an entity component pair\r\n */\r\nexport interface EntityComponent {\r\n  component: Component;\r\n  entity: Entity;\r\n}\r\n\r\n/**\r\n * AddedComponent message\r\n */\r\nexport class AddedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Added' = 'Component Added';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is f an Added Component\r\n */\r\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\r\n  return !!x && x.type === 'Component Added';\r\n}\r\n\r\n/**\r\n * RemovedComponent message\r\n */\r\nexport class RemovedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Removed' = 'Component Removed';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is for a Removed Component\r\n */\r\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\r\n  return !!x && x.type === 'Component Removed';\r\n}\r\n\r\n/**\r\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\r\n *\r\n * Entities can be strongly typed with the components they contain\r\n *\r\n * ```typescript\r\n * const entity = new Entity<ComponentA | ComponentB>();\r\n * entity.components.a; // Type ComponentA\r\n * entity.components.b; // Type ComponentB\r\n * ```\r\n */\r\nexport class Entity extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\r\n  private static _ID = 0;\r\n\r\n  constructor(components?: Component[], name?: string) {\r\n    super();\r\n    this._setName(name);\r\n    if (components) {\r\n      for (const component of components) {\r\n        this.addComponent(component);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The unique identifier for the entity\r\n   */\r\n  public id: number = Entity._ID++;\r\n\r\n  private _name: string = 'anonymous';\r\n  protected _setName(name: string) {\r\n    if (name) {\r\n      this._name = name;\r\n    }\r\n  }\r\n  public get name(): string {\r\n    return this._name;\r\n  }\r\n\r\n  public get events(): EventDispatcher {\r\n    return this.eventDispatcher;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   */\r\n  public active: boolean = true;\r\n\r\n  /**\r\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\r\n   */\r\n  public kill() {\r\n    this.active = false;\r\n  }\r\n\r\n  public isKilled() {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Specifically get the tags on the entity from [[TagComponent]]\r\n   */\r\n  public get tags(): readonly string[] {\r\n    return this._tagsMemo;\r\n  }\r\n\r\n  /**\r\n   * Check if a tag exists on the entity\r\n   * @param tag name to check for\r\n   */\r\n  public hasTag(tag: string): boolean {\r\n    return this.tags.includes(tag);\r\n  }\r\n\r\n  /**\r\n   * Adds a tag to an entity\r\n   * @param tag\r\n   * @returns Entity\r\n   */\r\n  public addTag(tag: string) {\r\n    return this.addComponent(new TagComponent(tag));\r\n  }\r\n\r\n  /**\r\n   * Removes a tag on the entity\r\n   *\r\n   * Removals are deferred until the end of update\r\n   * @param tag\r\n   * @param force Remove component immediately, no deferred\r\n   */\r\n  public removeTag(tag: string, force = false) {\r\n    return this.removeComponent(tag, force);\r\n  }\r\n\r\n  /**\r\n   * The types of the components on the Entity\r\n   */\r\n  public get types(): string[] {\r\n    return this._typesMemo;\r\n  }\r\n\r\n  /**\r\n   * Bucket to hold on to deferred removals\r\n   */\r\n  private _componentsToRemove: (Component | string)[] = [];\r\n  private _componentTypeToInstance = new Map<ComponentCtor, Component>();\r\n  private _componentStringToInstance = new Map<string, Component>();\r\n\r\n  private _tagsMemo: string[] = [];\r\n  private _typesMemo: string[] = [];\r\n  private _rebuildMemos() {\r\n    this._tagsMemo = Array.from(this._componentStringToInstance.values())\r\n      .filter((c) => c instanceof TagComponent)\r\n      .map((c) => c.type);\r\n    this._typesMemo = Array.from(this._componentStringToInstance.keys());\r\n  }\r\n\r\n  public getComponents(): Component[] {\r\n    return Array.from(this._componentStringToInstance.values());\r\n  }\r\n\r\n  /**\r\n   * Observable that keeps track of component add or remove changes on the entity\r\n   */\r\n  public componentAdded$ = new Observable<AddedComponent>();\r\n  private _notifyAddComponent(component: Component) {\r\n    this._rebuildMemos();\r\n    const added = new AddedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentAdded$.notifyAll(added);\r\n  }\r\n\r\n  public componentRemoved$ = new Observable<RemovedComponent>();\r\n  private _notifyRemoveComponent(component: Component) {\r\n    const removed = new RemovedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentRemoved$.notifyAll(removed);\r\n    this._rebuildMemos();\r\n  }\r\n\r\n  private _parent: Entity = null;\r\n  public get parent(): Entity {\r\n    return this._parent;\r\n  }\r\n\r\n  public childrenAdded$ = new Observable<Entity>();\r\n  public childrenRemoved$ = new Observable<Entity>();\r\n\r\n  private _children: Entity[] = [];\r\n  /**\r\n   * Get the direct children of this entity\r\n   */\r\n  public get children(): readonly Entity[] {\r\n    return this._children;\r\n  }\r\n\r\n  /**\r\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\r\n   */\r\n  public unparent() {\r\n    if (this._parent) {\r\n      this._parent.removeChild(this);\r\n      this._parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be a child of this entity\r\n   * @param entity\r\n   */\r\n  public addChild(entity: Entity): Entity {\r\n    if (entity.parent === null) {\r\n      if (this.getAncestors().includes(entity)) {\r\n        throw new Error('Cycle detected, cannot add entity');\r\n      }\r\n      this._children.push(entity);\r\n      entity._parent = this;\r\n      this.childrenAdded$.notifyAll(entity);\r\n    } else {\r\n      throw new Error('Entity already has a parent, cannot add without unparenting');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from children if it exists\r\n   * @param entity\r\n   */\r\n  public removeChild(entity: Entity): Entity {\r\n    if (entity.parent === this) {\r\n      Util.removeItemFromArray(entity, this._children);\r\n      entity._parent = null;\r\n      this.childrenRemoved$.notifyAll(entity);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes all children from this entity\r\n   */\r\n  public removeAllChildren(): Entity {\r\n    this.children.forEach((c) => {\r\n      this.removeChild(c);\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\r\n   */\r\n  public getAncestors(): Entity[] {\r\n    const result: Entity[] = [this];\r\n    let current = this.parent;\r\n    while (current) {\r\n      result.push(current);\r\n      current = current.parent;\r\n    }\r\n    return result.reverse();\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\r\n   */\r\n  public getDescendants(): Entity[] {\r\n    let result: Entity[] = [this];\r\n    let queue: Entity[] = [this];\r\n    while (queue.length > 0) {\r\n      const curr = queue.pop();\r\n      queue = queue.concat(curr.children);\r\n      result = result.concat(curr.children);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates a deep copy of the entity and a copy of all its components\r\n   */\r\n  public clone(): Entity {\r\n    const newEntity = new Entity();\r\n    for (const c of this.types) {\r\n      newEntity.addComponent(this.get(c).clone());\r\n    }\r\n    for (const child of this.children) {\r\n      newEntity.addChild(child.clone());\r\n    }\r\n    return newEntity;\r\n  }\r\n\r\n  /**\r\n   * Adds a copy of all the components from another template entity as a \"prefab\"\r\n   * @param templateEntity Entity to use as a template\r\n   * @param force Force component replacement if it aleady exists on the target entity\r\n   */\r\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\r\n    for (const c of templateEntity.getComponents()) {\r\n      this.addComponent(c.clone(), force);\r\n    }\r\n    for (const child of templateEntity.children) {\r\n      this.addChild(child.clone().addTemplate(child));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the entity\r\n   * @param component Component or Entity to add copy of components from\r\n   * @param force Optionally overwrite any existing components of the same type\r\n   */\r\n  public addComponent<T extends Component>(component: T, force: boolean = false): Entity {\r\n    // if component already exists, skip if not forced\r\n    if (this.has(component.type)) {\r\n      if (force) {\r\n        // Remove existing component type if exists when forced\r\n        this.removeComponent(component);\r\n      } else {\r\n        // early exit component exiss\r\n        return this;\r\n      }\r\n    }\r\n\r\n    // TODO circular dependencies will be a problem\r\n    if (component.dependencies && component.dependencies.length) {\r\n      for (const ctor of component.dependencies) {\r\n        this.addComponent(new ctor());\r\n      }\r\n    }\r\n\r\n    component.owner = this;\r\n    const constuctorType = component.constructor as ComponentCtor<T>;\r\n    this._componentTypeToInstance.set(constuctorType, component);\r\n    this._componentStringToInstance.set(component.type, component);\r\n    if (component.onAdd) {\r\n      component.onAdd(this);\r\n    }\r\n    this._notifyAddComponent(component);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\r\n   *\r\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\r\n   * @param componentOrType\r\n   * @param force\r\n   */\r\n  public removeComponent<ComponentOrType extends string | Component>(componentOrType: ComponentOrType, force = false): Entity {\r\n    if (force) {\r\n      if (typeof componentOrType === 'string') {\r\n        this._removeComponentByType(componentOrType);\r\n      } else if (componentOrType instanceof Component) {\r\n        this._removeComponentByType(componentOrType.type);\r\n      }\r\n    } else {\r\n      this._componentsToRemove.push(componentOrType);\r\n    }\r\n\r\n    return this as any;\r\n  }\r\n\r\n  private _removeComponentByType(type: string) {\r\n    if (this.has(type)) {\r\n      const component = this.get(type);\r\n      component.owner = null;\r\n      if (component.onRemove) {\r\n        component.onRemove(this);\r\n      }\r\n      const ctor = component.constructor as ComponentCtor;\r\n      this._componentTypeToInstance.delete(ctor);\r\n      this._componentStringToInstance.delete(component.type);\r\n      this._notifyRemoveComponent(component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @hidden\r\n   * @internal\r\n   */\r\n  public processComponentRemoval() {\r\n    for (const componentOrType of this._componentsToRemove) {\r\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\r\n      this._removeComponentByType(type);\r\n    }\r\n    this._componentsToRemove.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Check if a component type exists\r\n   * @param type\r\n   */\r\n  public has<T extends Component>(type: ComponentCtor<T>): boolean;\r\n  public has(type: string): boolean;\r\n  public has<T extends Component>(type: ComponentCtor<T> | string): boolean {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.has(type);\r\n    } else {\r\n      return this._componentTypeToInstance.has(type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a component by type with typecheck\r\n   *\r\n   * (Does not work on tag components, use .hasTag(\"mytag\") instead)\r\n   * @param type\r\n   */\r\n  public get<T extends Component>(type: ComponentCtor<T>): T | null;\r\n  public get<T extends Component>(type: string): T | null;\r\n  public get<T extends Component>(type: ComponentCtor<T> | string): T | null {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.get(type) as T;\r\n    } else {\r\n      return this._componentTypeToInstance.get(type) as T;\r\n    }\r\n  }\r\n\r\n  private _isInitialized = false;\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an entity is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an entity is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Entity update lifecycle, called internally\r\n   *\r\n   * @internal\r\n   * @param engine\r\n   * @param delta\r\n   */\r\n  public update(engine: Engine, delta: number): void {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n    for (const child of this.children) {\r\n      child.update(engine, delta);\r\n    }\r\n    this._postupdate(engine, delta);\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem';\r\n\r\n/**\r\n * Shim to draw to the canvas when in LegacyDrawing mode\r\n * @deprecated\r\n */\r\nexport class CanvasDrawComponent extends Component<'ex.canvas'> {\r\n  public readonly type = 'ex.canvas';\r\n\r\n  constructor(public draw?: (ctx: CanvasRenderingContext2D, delta: number) => void) {\r\n    super();\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    this.draw = this.draw ?? (() => {});\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { Graphic } from './Graphic';\r\nimport { HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Logger } from '../Util/Log';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\n\r\n/**\r\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\r\n * @param graphic\r\n */\r\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\r\n  return !!(graphic as unknown as HasTick).tick;\r\n}\r\nexport interface GraphicsShowOptions {\r\n  offset?: Vector;\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsComponentOptions {\r\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Name of current graphic to use\r\n   */\r\n  current?: string;\r\n\r\n  /**\r\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\r\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\r\n   */\r\n  copyGraphics?: boolean;\r\n\r\n  /**\r\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\r\n   */\r\n  visible?: boolean;\r\n\r\n  /**\r\n   * Optional opacity\r\n   */\r\n  opacity?: number;\r\n\r\n  /**\r\n   * List of graphics\r\n   */\r\n  graphics?: { [graphicName: string]: Graphic };\r\n\r\n  /**\r\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\r\n   */\r\n  offset?: Vector;\r\n\r\n  /**\r\n   * Optional anchor\r\n   */\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsLayerOptions {\r\n  /**\r\n   * Name of the layer required, for example 'background'\r\n   */\r\n  name: string;\r\n  /**\r\n   * Order of the layer, a layer with order -1 will be below a layer with order of 1\r\n   */\r\n  order: number;\r\n  /**\r\n   * Offset to shift the entire layer\r\n   */\r\n  offset?: Vector;\r\n}\r\nexport class GraphicsLayer {\r\n  public graphics: { graphic: Graphic; options: GraphicsShowOptions }[] = [];\r\n  constructor(private _options: GraphicsLayerOptions, private _graphics: GraphicsComponent) {}\r\n  public get name(): string {\r\n    return this._options.name;\r\n  }\r\n\r\n  /**\r\n   * Remove any instance(s) of a graphic currently being shown in this layer\r\n   */\r\n  public hide(nameOrGraphic: string | Graphic): void;\r\n  /**\r\n   * Remove all currently shown graphics in this layer\r\n   */\r\n  public hide(): void;\r\n  public hide(nameOrGraphic?: string | Graphic): void {\r\n    if (!nameOrGraphic) {\r\n      this.graphics.length = 0;\r\n    } else {\r\n      let gfx: Graphic = null;\r\n      if (nameOrGraphic instanceof Graphic) {\r\n        gfx = nameOrGraphic;\r\n      } else {\r\n        gfx = this._graphics.getGraphic(nameOrGraphic);\r\n      }\r\n      this.graphics = this.graphics.filter((g) => g.graphic !== gfx);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show a graphic by name or instance at an offset, graphics are shown in the order in which `show()` is called.\r\n   *\r\n   * If `show()` is called multiple times for the same graphic it will be shown multiple times.\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    options = { ...options };\r\n    let gfx: Graphic;\r\n    if (nameOrGraphic instanceof Graphic) {\r\n      gfx = this._graphics.copyGraphics ? nameOrGraphic.clone() : nameOrGraphic;\r\n    } else {\r\n      gfx = this._graphics.getGraphic(nameOrGraphic);\r\n      if (!gfx) {\r\n        Logger.getInstance().error(\r\n          `No such graphic added to component named ${nameOrGraphic}. These named graphics are available: `,\r\n          this._graphics.getNames()\r\n        );\r\n      }\r\n    }\r\n    if (gfx) {\r\n      this.graphics.push({ graphic: gfx, options });\r\n      return gfx as T;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use a specific graphic, swap out any current graphics being shown\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    options = { ...options };\r\n    this.hide();\r\n    return this.show<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Current order of the layer, higher numbers are on top, lower numbers are on the bottom.\r\n   *\r\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\r\n   */\r\n  public get order(): number {\r\n    return this._options.order;\r\n  }\r\n\r\n  /**\r\n   * Set the order of the layer, higher numbers are on top, lower numbers are on the bottom.\r\n   *\r\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\r\n   */\r\n  public set order(order: number) {\r\n    this._options.order = order;\r\n  }\r\n\r\n  /**\r\n   * Get or set the pixel offset from the layer anchor for all graphics in the layer\r\n   */\r\n  public get offset(): Vector {\r\n    return this._options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  public set offset(value: Vector) {\r\n    this._options.offset = value;\r\n  }\r\n\r\n  public get currentKeys(): string {\r\n    return this.name ?? 'anonymous';\r\n  }\r\n}\r\n\r\nexport class GraphicsLayers {\r\n  private _layers: GraphicsLayer[] = [];\r\n  private _layerMap: { [layerName: string]: GraphicsLayer } = {};\r\n  public default: GraphicsLayer;\r\n  constructor(private _component: GraphicsComponent) {\r\n    this.default = new GraphicsLayer({ name: 'default', order: 0 }, _component);\r\n    this._maybeAddLayer(this.default);\r\n  }\r\n  public create(options: GraphicsLayerOptions): GraphicsLayer {\r\n    const layer = new GraphicsLayer(options, this._component);\r\n    return this._maybeAddLayer(layer);\r\n  }\r\n\r\n  /**\r\n   * Retrieve a single layer by name\r\n   * @param name\r\n   */\r\n  public get(name: string): GraphicsLayer;\r\n  /**\r\n   * Retrieve all layers\r\n   */\r\n  public get(): readonly GraphicsLayer[];\r\n  public get(name?: string): GraphicsLayer | readonly GraphicsLayer[] {\r\n    if (name) {\r\n      return this._getLayer(name);\r\n    }\r\n    return this._layers;\r\n  }\r\n\r\n  public currentKeys() {\r\n    const graphicsLayerKeys = [];\r\n    for (const layer of this._layers) {\r\n      graphicsLayerKeys.push(layer.currentKeys);\r\n    }\r\n    return graphicsLayerKeys;\r\n  }\r\n\r\n  public has(name: string): boolean {\r\n    return name in this._layerMap;\r\n  }\r\n\r\n  private _maybeAddLayer(layer: GraphicsLayer) {\r\n    if (this._layerMap[layer.name]) {\r\n      // todo log warning\r\n      return this._layerMap[layer.name];\r\n    }\r\n    this._layerMap[layer.name] = layer;\r\n    this._layers.push(layer);\r\n    this._layers.sort((a, b) => a.order - b.order);\r\n    return layer;\r\n  }\r\n\r\n  private _getLayer(name: string): GraphicsLayer | undefined {\r\n    return this._layerMap[name];\r\n  }\r\n}\r\n\r\n/**\r\n * Component to manage drawings, using with the position component\r\n */\r\nexport class GraphicsComponent extends Component<'ex.graphics'> {\r\n  readonly type = 'ex.graphics';\r\n\r\n  private _graphics: { [graphicName: string]: Graphic } = {};\r\n\r\n  public layers: GraphicsLayers;\r\n\r\n  public getGraphic(name: string): Graphic | undefined {\r\n    return this._graphics[name];\r\n  }\r\n\r\n  /**\r\n   * Get registered graphics names\r\n   */\r\n  public getNames(): string[] {\r\n    return Object.keys(this._graphics);\r\n  }\r\n\r\n  /**\r\n   * Draws after the entity transform has bene applied, but before graphics component graphics have been drawn\r\n   */\r\n  public onPreDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\r\n   */\r\n  public onPostDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   */\r\n  public visible: boolean = true;\r\n\r\n  /**\r\n   * Sets or gets wither all drawings should have an opacity applied\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  /**\r\n   * Offset to apply to graphics by default\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Anchor to apply to graphics by default\r\n   */\r\n  public anchor: Vector = Vector.Half;\r\n\r\n  /**\r\n   * If set to true graphics added to the component will be copied. This can affect performance\r\n   */\r\n  public copyGraphics: boolean = false;\r\n\r\n  constructor(options?: GraphicsComponentOptions) {\r\n    super();\r\n    // Defaults\r\n    options = {\r\n      visible: this.visible,\r\n      ...options\r\n    };\r\n\r\n    const { current, anchor, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw } = options;\r\n\r\n    this._graphics = graphics || {};\r\n    this.offset = offset ?? this.offset;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.anchor = anchor ?? this.anchor;\r\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\r\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\r\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\r\n    this.visible = !!visible;\r\n\r\n    this.layers = new GraphicsLayers(this);\r\n    if (current && this._graphics[current]) {\r\n      this.show(this._graphics[current]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed graphics and their offsets, empty array if hidden\r\n   */\r\n  public get current(): { graphic: Graphic; options: GraphicsShowOptions }[] {\r\n    return this.layers.default.graphics;\r\n  }\r\n\r\n  /**\r\n   * Returns all graphics associated with this component\r\n   */\r\n  public get graphics(): { [graphicName: string]: Graphic } {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\r\n   * `show(\"default\")`\r\n   * @param graphic\r\n   */\r\n  public add(graphic: Graphic): Graphic;\r\n  public add(name: string, graphic: Graphic): Graphic;\r\n  public add(nameOrGraphic: string | Graphic, graphic?: Graphic): Graphic {\r\n    let name = 'default';\r\n    let graphicToSet: Graphic = null;\r\n    if (typeof nameOrGraphic === 'string') {\r\n      name = nameOrGraphic;\r\n      graphicToSet = graphic;\r\n    } else {\r\n      graphicToSet = nameOrGraphic;\r\n    }\r\n\r\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\r\n    if (name === 'default') {\r\n      this.show('default');\r\n    }\r\n    return graphicToSet;\r\n  }\r\n\r\n  /**\r\n   * Show a graphic by name on the **default** layer, returns the new [[Graphic]]\r\n   */\r\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    return this.layers.default.show<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Use a graphic only, swap out any graphics on the **default** layer, returns the new [[Graphic]]\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    return this.layers.default.use<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Remove any instance(s) of a graphic currently being shown in the **default** layer\r\n   */\r\n  public hide(nameOrGraphic: string | Graphic): void;\r\n  /**\r\n   * Remove all currently shown graphics in the **default** layer\r\n   */\r\n  public hide(): void;\r\n  public hide(nameOrGraphic?: string | Graphic): void {\r\n    this.layers.default.hide(nameOrGraphic);\r\n  }\r\n\r\n  private _bounds: BoundingBox = null;\r\n  public set localBounds(bounds: BoundingBox) {\r\n    this._bounds = bounds;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    if (this._bounds) {\r\n      return this._bounds;\r\n    }\r\n    let bb = new BoundingBox();\r\n    for (const layer of this.layers.get()) {\r\n      for (const { graphic, options } of layer.graphics) {\r\n        let anchor = this.anchor;\r\n        let offset = this.offset;\r\n        if (options?.anchor) {\r\n          anchor = options.anchor;\r\n        }\r\n        if (options?.offset) {\r\n          offset = options.offset;\r\n        }\r\n        const bounds = graphic.localBounds;\r\n        const offsetX = -bounds.width * graphic.scale.x * anchor.x + offset.x;\r\n        const offsetY = -bounds.height * graphic.scale.y * anchor.y + offset.y;\r\n        bb = graphic?.localBounds.translate(vec(offsetX + layer.offset.x, offsetY + layer.offset.y)).combine(bb);\r\n      }\r\n    }\r\n    return bb;\r\n  }\r\n\r\n  /**\r\n   * Update underlying graphics if necesary, called internally\r\n   * @param elapsed\r\n   * @internal\r\n   */\r\n  public update(elapsed: number, idempotencyToken: number = 0) {\r\n    for (const layer of this.layers.get()) {\r\n      for (const { graphic } of layer.graphics) {\r\n        if (hasGraphicsTick(graphic)) {\r\n          graphic?.tick(elapsed, idempotencyToken);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface RectangleOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/**\r\n * A Rectangle [[Graphic]] for drawing rectangles to the [[ExcaliburGraphicsContext]]\r\n */\r\nexport class Rectangle extends Raster {\r\n  constructor(options: RasterOptions & RectangleOptions) {\r\n    super(options);\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Rectangle {\r\n    return new Rectangle({\r\n      width: this.width,\r\n      height: this.height,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.color) {\r\n      ctx.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    if (this.strokeColor) {\r\n      ctx.strokeRect(0, 0, this.width, this.height);\r\n    }\r\n  }\r\n}\r\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CircleOptions {\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * A circle [[Graphic]] for drawing circles to the [[ExcaliburGraphicsContext]]\r\n */\r\nexport class Circle extends Raster {\r\n  private _radius: number = 0;\r\n  public get radius() {\r\n    return this._radius;\r\n  }\r\n  public set radius(value: number) {\r\n    this._radius = value;\r\n    this.width = this._radius * 2;\r\n    this.height = this._radius * 2;\r\n    this.flagDirty();\r\n  }\r\n  constructor(options: RasterOptions & CircleOptions) {\r\n    super(options);\r\n    this.padding = options.padding ?? 2; // default 2 padding for circles looks nice\r\n    this.radius = options.radius;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Circle {\r\n    return new Circle({\r\n      radius: this.radius,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.radius > 0) {\r\n      ctx.beginPath();\r\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\r\n\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * An enum that describes the strategies that rotation actions can use\r\n */\r\nexport enum RotationType {\r\n  /**\r\n   * Rotation via `ShortestPath` will use the smallest angle\r\n   * between the starting and ending points. This strategy is the default behavior.\r\n   */\r\n  ShortestPath = 0,\r\n  /**\r\n   * Rotation via `LongestPath` will use the largest angle\r\n   * between the starting and ending points.\r\n   */\r\n  LongestPath = 1,\r\n  /**\r\n   * Rotation via `Clockwise` will travel in a clockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  Clockwise = 2,\r\n  /**\r\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  CounterClockwise = 3\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'CreateReversibleEasingFunction'\n  })\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\n\r\n/**\r\n * Action Queues represent an ordered sequence of actions\r\n *\r\n * Action queues are part of the [[ActionContext|Action API]] and\r\n * store the list of actions to be executed for an [[Actor]].\r\n *\r\n * Actors implement [[Actor.actions]] which can be manipulated by\r\n * advanced users to adjust the actions currently being executed in the\r\n * queue.\r\n */\r\nexport class ActionQueue {\r\n  private _entity: Entity;\r\n  private _actions: Action[] = [];\r\n  private _currentAction: Action;\r\n  private _completedActions: Action[] = [];\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  /**\r\n   * Add an action to the sequence\r\n   * @param action\r\n   */\r\n  public add(action: Action) {\r\n    this._actions.push(action);\r\n  }\r\n\r\n  /**\r\n   * Remove an action by reference from the sequence\r\n   * @param action\r\n   */\r\n  public remove(action: Action) {\r\n    const index = this._actions.indexOf(action);\r\n    this._actions.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Removes all actions from this sequence\r\n   */\r\n  public clearActions(): void {\r\n    this._actions.length = 0;\r\n    this._completedActions.length = 0;\r\n    if (this._currentAction) {\r\n      this._currentAction.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns The total list of actions in this sequence complete or not\r\n   */\r\n  public getActions(): Action[] {\r\n    return this._actions.concat(this._completedActions);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns `true` if there are more actions to process in the sequence\r\n   */\r\n  public hasNext(): boolean {\r\n    return this._actions.length > 0;\r\n  }\r\n\r\n  /**\r\n   * @returns `true` if the current sequence of actions is done\r\n   */\r\n  public isComplete(): boolean {\r\n    return this._actions.length === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\r\n   */\r\n  public reset(): void {\r\n    this._actions = this.getActions();\r\n\r\n    const len = this._actions.length;\r\n    for (let i = 0; i < len; i++) {\r\n      this._actions[i].reset();\r\n    }\r\n    this._completedActions = [];\r\n  }\r\n\r\n  /**\r\n   * Update the queue which updates actions and handles completing actions\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number) {\r\n    if (this._actions.length > 0) {\r\n      this._currentAction = this._actions[0];\r\n      this._currentAction.update(elapsedMs);\r\n\r\n      if (this._currentAction.isComplete(this._entity)) {\r\n        this._completedActions.push(this._actions.shift());\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\nexport class Repeat implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _repeat: number;\r\n  private _originalRepeat: number;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeat = repeat;\r\n    this._originalRepeat = repeat;\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n    this._repeat--; // current execution is the first repeat\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n      this._repeat--;\r\n    }\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._repeat = this._originalRepeat;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * RepeatForever Action implementation, it is recommended you use the fluent action\r\n * context API.\r\n *\r\n *\r\n */\r\nexport class RepeatForever implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._stopped) {\r\n      return;\r\n    }\r\n\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n    }\r\n\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n    this._actionQueue.clearActions();\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class MoveBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _entity: Entity;\r\n  public x: number;\r\n  public y: number;\r\n  private _distance: number;\r\n  private _speed: number;\r\n\r\n  private _start: Vector;\r\n  private _offset: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\r\n    this._entity = entity;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n    if (speed <= 0) {\r\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\r\n      throw new Error('Speed must be greater than 0 pixels per second');\r\n    }\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._end = this._start.add(this._offset);\r\n      this._distance = this._offset.size;\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n\r\n    if (this.isComplete(this._entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    } else {\r\n      this._motion.vel = this._dir.scale(this._speed);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class MoveTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _distance: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(public entity: Entity, destx: number, desty: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = new Vector(destx, desty);\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._distance = this._start.distance(this._end);\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport * as Util from '../../Util/Util';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\n\r\nexport class RotateTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadians: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = angleRadians;\r\n    this._speed = speed;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = Util.TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (!this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport * as Util from '../../Util/Util';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\n\r\nexport class RotateBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _offset: number;\r\n\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = angleRadiansOffset;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      this._end = this._start + this._offset;\r\n\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = Util.TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortDistance >= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (this._shortDistance <= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { vec } from '../../Math/vector';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action } from '../Action';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\n\r\nexport class ScaleTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _startX: number;\r\n  private _startY: number;\r\n  private _endX: number;\r\n  private _endY: number;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  private _distanceX: number;\r\n  private _distanceY: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._endX = scaleX;\r\n    this._endY = scaleY;\r\n    this._speedX = speedX;\r\n    this._speedY = speedY;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startX = this._tx.scale.x;\r\n      this._startY = this._tx.scale.y;\r\n      this._distanceX = Math.abs(this._endX - this._startX);\r\n      this._distanceY = Math.abs(this._endY - this._startY);\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\r\n      const directionX = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.x = this._speedX * directionX;\r\n    } else {\r\n      this._motion.scaleFactor.x = 0;\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\r\n      const directionY = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.y = this._speedY * directionY;\r\n    } else {\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = vec(this._endX, this._endY);\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.y - this._startX) >= this._distanceX && Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action } from '../Action';\r\n\r\nexport class ScaleBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _startScale: Vector;\r\n  private _endScale: Vector;\r\n  private _offset: Vector;\r\n  private _distanceX: number;\r\n  private _distanceY: number;\r\n  private _directionX: number;\r\n  private _directionY: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\r\n    this._speedX = this._speedY = speed;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startScale = this._tx.scale.clone();\r\n      this._endScale = this._startScale.add(this._offset);\r\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\r\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\r\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\r\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\r\n    }\r\n\r\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\r\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX &&\r\n        Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\n\r\nexport class CallMethod implements Action {\r\n  private _method: () => any = null;\r\n  private _hasBeenCalled: boolean = false;\r\n  constructor(method: () => any) {\r\n    this._method = method;\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    this._method();\r\n    this._hasBeenCalled = true;\r\n  }\r\n  public isComplete() {\r\n    return this._hasBeenCalled;\r\n  }\r\n  public reset() {\r\n    this._hasBeenCalled = false;\r\n  }\r\n  public stop() {\r\n    this._hasBeenCalled = true;\r\n  }\r\n}\r\n","import { Entity} from '../../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Actor } from '../../Actor';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class EaseTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  private _distance: number = 0;\r\n  constructor(\r\n    entity: Entity,\r\n    x: number,\r\n    y: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = new Vector(x, y);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n    this._distance = this._lerpStart.distance(this._lerpEnd);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += delta;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (delta / 1000), (newY - this._tx.pos.y) / (delta / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(actor: Actor): boolean {\r\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\n\r\nexport class Blink implements Action {\r\n  private _graphics: GraphicsComponent;\r\n  private _timeVisible: number = 0;\r\n  private _timeNotVisible: number = 0;\r\n  private _elapsedTime: number = 0;\r\n  private _totalTime: number = 0;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._timeVisible = timeVisible;\r\n    this._timeNotVisible = timeNotVisible;\r\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n    this._totalTime += delta;\r\n    if (this._graphics.visible && this._elapsedTime >= this._timeVisible) {\r\n      this._graphics.visible = false;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (!this._graphics.visible && this._elapsedTime >= this._timeNotVisible) {\r\n      this._graphics.visible = true;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.visible = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._totalTime >= this._duration;\r\n  }\r\n\r\n  public stop(): void {\r\n    if (this._graphics) {\r\n      this._graphics.visible = true;\r\n    }\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._elapsedTime = 0;\r\n    this._totalTime = 0;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class Fade implements Action {\r\n  private _graphics: GraphicsComponent;\r\n  public x: number;\r\n  public y: number;\r\n\r\n  private _endOpacity: number;\r\n  private _speed: number;\r\n  private _multiplier: number = 1;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, endOpacity: number, speed: number) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._endOpacity = endOpacity;\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    if (!this._started) {\r\n      this._started = true;\r\n\r\n      // determine direction when we start\r\n      if (this._endOpacity < this._graphics.opacity) {\r\n        this._multiplier = -1;\r\n      } else {\r\n        this._multiplier = 1;\r\n      }\r\n    }\r\n\r\n    if (this._speed > 0) {\r\n      this._graphics.opacity += (this._multiplier *\r\n        (Math.abs(this._graphics.opacity - this._endOpacity) * delta)) / this._speed;\r\n    }\r\n\r\n    this._speed -= delta;\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.opacity = this._endOpacity;\r\n    }\r\n\r\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || Math.abs(this._graphics.opacity - this._endOpacity) < 0.05;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\n\r\nexport class Delay implements Action {\r\n  private _elapsedTime: number = 0;\r\n  private _delay: number;\r\n  private _started: boolean = false;\r\n  private _stopped = false;\r\n  constructor(delay: number) {\r\n    this._delay = delay;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n  }\r\n\r\n  isComplete(): boolean {\r\n    return this._stopped || this._elapsedTime >= this._delay;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  reset(): void {\r\n    this._elapsedTime = 0;\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionsComponent } from '../ActionsComponent';\r\n\r\nexport class Die implements Action {\r\n  private _entity: Entity;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    this._entity.get(ActionsComponent).clearActions();\r\n    this._entity.kill();\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    return;\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class Follow implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _followTx: TransformComponent;\r\n  private _followMotion: MotionComponent;\r\n\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _maximumDistance: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._followTx = entityToFollow.get(TransformComponent);\r\n    this._followMotion = entityToFollow.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\r\n    this._speed = 0;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\r\n    if (actorToFollowSpeed !== 0) {\r\n      this._speed = actorToFollowSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    if (this._distanceBetween >= this._maximumDistance) {\r\n      const m = this._dir.scale(this._speed);\r\n      this._motion.vel = vec(m.x, m.y);\r\n    } else {\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    // the actor following should never stop unless specified to do so\r\n    return this._stopped;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class Meet implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _meetTx: TransformComponent;\r\n  private _meetMotion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedWasSpecified = false;\r\n\r\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\r\n    this._tx = actor.get(TransformComponent);\r\n    this._motion = actor.get(MotionComponent);\r\n    this._meetTx = actorToMeet.get(TransformComponent);\r\n    this._meetMotion = actorToMeet.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._speed = speed || 0;\r\n\r\n    if (speed !== undefined) {\r\n      this._speedWasSpecified = true;\r\n    }\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\r\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\r\n      this._speed = actorToMeetSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._distanceBetween <= 1;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { RotationType } from './RotationType';\r\n\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Repeat } from './Action/Repeat';\r\nimport { RepeatForever } from './Action/RepeatForever';\r\nimport { MoveBy } from './Action/MoveBy';\r\nimport { MoveTo } from './Action/MoveTo';\r\nimport { RotateTo } from './Action/RotateTo';\r\nimport { RotateBy } from './Action/RotateBy';\r\nimport { ScaleTo } from './Action/ScaleTo';\r\nimport { ScaleBy } from './Action/ScaleBy';\r\nimport { CallMethod } from './Action/CallMethod';\r\nimport { EaseTo } from './Action/EaseTo';\r\nimport { Blink } from './Action/Blink';\r\nimport { Fade } from './Action/Fade';\r\nimport { Delay } from './Action/Delay';\r\nimport { Die } from './Action/Die';\r\nimport { Follow } from './Action/Follow';\r\nimport { Meet } from './Action/Meet';\r\nimport { Vector } from '../Math/vector';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\n\r\n/**\r\n * The fluent Action API allows you to perform \"actions\" on\r\n * [[Actor|Actors]] such as following, moving, rotating, and\r\n * more. You can implement your own actions by implementing\r\n * the [[Action]] interface.\r\n */\r\nexport class ActionContext {\r\n  private _entity: Entity;\r\n  private _queue: ActionQueue;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n    this._queue = new ActionQueue(entity);\r\n  }\r\n\r\n  public getQueue(): ActionQueue {\r\n    return this._queue;\r\n  }\r\n\r\n  public update(elapsedMs: number) {\r\n    this._queue.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._queue.clearActions();\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  public easeTo(...args: any[]): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      x = args[0].x;\r\n      y = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      x = args[0];\r\n      y = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let speed = 0;\r\n    if (xOrPos instanceof Vector) {\r\n      x = xOrPos.x;\r\n      y = xOrPos.y;\r\n      speed = yOrSpeed;\r\n    } else {\r\n      x = xOrPos;\r\n      y = yOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveTo(this._entity, x, y, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    let speed = 0;\r\n    if (xOffsetOrVector instanceof Vector) {\r\n      xOffset = xOffsetOrVector.x;\r\n      yOffset = xOffsetOrVector.y;\r\n      speed = yOffsetOrSpeed;\r\n    } else {\r\n      xOffset = xOffsetOrVector;\r\n      yOffset = yOffsetOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateTo(this._entity, angleRadians, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateBy(this._entity, angleRadiansOffset, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number | undefined,\r\n    speedYOrUndefined?: number | undefined): ActionContext {\r\n\r\n    let sizeX = 1;\r\n    let sizeY = 1;\r\n    let speedX = 0;\r\n    let speedY = 0;\r\n\r\n    if (sizeXOrVector instanceof Vector && sizeYOrSpeed instanceof Vector) {\r\n      sizeX = sizeXOrVector.x;\r\n      sizeY = sizeXOrVector.y;\r\n\r\n      speedX = sizeYOrSpeed.x;\r\n      speedY = sizeYOrSpeed.y;\r\n    }\r\n    if (typeof sizeXOrVector === 'number' && typeof sizeYOrSpeed === 'number') {\r\n      sizeX = sizeXOrVector;\r\n      sizeY = sizeYOrSpeed;\r\n\r\n      speedX = speedXOrUndefined;\r\n      speedY = speedYOrUndefined;\r\n    }\r\n\r\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number | undefined): ActionContext {\r\n    let sizeOffsetX = 1;\r\n    let sizeOffsetY = 1;\r\n\r\n    if (sizeOffsetXOrVector instanceof Vector) {\r\n      sizeOffsetX = sizeOffsetXOrVector.x;\r\n      sizeOffsetY = sizeOffsetXOrVector.y;\r\n\r\n      speed = sizeOffsetYOrSpeed;\r\n    }\r\n    if (typeof sizeOffsetXOrVector === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\r\n      sizeOffsetX = sizeOffsetXOrVector;\r\n      sizeOffsetY = sizeOffsetYOrSpeed;\r\n    }\r\n\r\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\r\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    this._queue.add(new Fade(this._entity, opacity, time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    this._queue.add(new Delay(time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    this._queue.add(new Die(this._entity));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    this._queue.add(new CallMethod(method));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    if (!times) {\r\n      this.repeatForever(repeatBuilder);\r\n      return this;\r\n    }\r\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Entity, followDistance?: number): ActionContext {\r\n    if (followDistance === undefined) {\r\n      this._queue.add(new Follow(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Follow(this._entity, entity, followDistance));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Entity, speed?: number): ActionContext {\r\n    if (speed === undefined) {\r\n      this._queue.add(new Meet(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Meet(this._entity, entity, speed));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\r\n   */\r\n  public asPromise(): Promise<void> {\r\n    return this.toPromise();\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    const temp = new Promise<void>((resolve) => {\r\n      this._queue.add(\r\n        new CallMethod(() => {\r\n          resolve();\r\n        })\r\n      );\r\n    });\r\n    return temp;\r\n  }\r\n}\r\n","import { ActionContext } from './ActionContext';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Actor } from '../Actor';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Vector } from '../Math/vector';\r\nimport { EasingFunction } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { RotationType } from './RotationType';\r\n\r\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> { };\r\n\r\nexport class ActionsComponent extends Component<'ex.actions'> implements ActionContextMethods {\r\n  public readonly type = 'ex.actions';\r\n  dependencies = [TransformComponent, MotionComponent]\r\n  private _ctx: ActionContext;\r\n\r\n  onAdd(entity: Entity) {\r\n    this._ctx = new ActionContext(entity);\r\n  }\r\n\r\n  onRemove() {\r\n    this._ctx = null;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal action queue\r\n   * @returns action queu\r\n   */\r\n  public getQueue(): ActionQueue {\r\n    return this._ctx?.getQueue();\r\n  }\r\n\r\n  /**\r\n   * Updates the internal action context, performing action and moving through the internal queue\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number): void {\r\n    return this._ctx?.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._ctx?.clearActions();\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeTo(...args: any[]): ActionContext {\r\n    return this._ctx.easeTo.apply(this._ctx, args);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number): ActionContext {\r\n    return this._ctx.moveTo.apply(this._ctx, [xOrPos, yOrSpeed, speedOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset The (x, y) offset to apply to this actor\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number): ActionContext {\r\n    return this._ctx.moveBy.apply(this._ctx, [xOffsetOrVector, yOffsetOrSpeed, speedOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    return this._ctx.rotateTo(angleRadians, speed, rotationType);\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    return this._ctx.rotateBy(angleRadiansOffset, speed, rotationType);\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(\r\n    sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number,\r\n    speedYOrUndefined?: number): ActionContext {\r\n    return this._ctx.scaleTo.apply(this._ctx, [sizeXOrVector, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number): ActionContext {\r\n    return this._ctx.scaleBy.apply(this._ctx, [sizeOffsetXOrVector, sizeOffsetYOrSpeed, speed]);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\r\n    return this._ctx.blink(timeVisible, timeNotVisible, numBlinks);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    return this._ctx.fade(opacity, time);\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    return this._ctx.delay(time);\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    return this._ctx.die();\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    return this._ctx.callMethod(method);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    return this._ctx.repeat(repeatBuilder, times);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    return this._ctx.repeatForever(repeatBuilder);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Actor, followDistance?: number): ActionContext {\r\n    return this._ctx.follow(entity, followDistance);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Actor, speed?: number): ActionContext {\r\n    return this._ctx.meet(entity, speed);\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\r\n   */\r\n  public asPromise(): Promise<void> {\r\n    return this.toPromise();\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    return this._ctx.toPromise();\r\n  }\r\n}","import { Texture } from './Drawing/Texture';\r\nimport {\r\n  InitializeEvent,\r\n  KillEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  PostCollisionEvent,\r\n  PreCollisionEvent,\r\n  CollisionStartEvent,\r\n  CollisionEndEvent,\r\n  PostKillEvent,\r\n  PreKillEvent,\r\n  GameEvent,\r\n  ExitTriggerEvent,\r\n  EnterTriggerEvent,\r\n  EnterViewPortEvent,\r\n  ExitViewPortEvent\r\n} from './Events';\r\nimport { PointerEvent, WheelEvent, PointerDragEvent, PointerEventName } from './Input/PointerEvents';\r\nimport { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { Sprite } from './Drawing/Sprite';\r\nimport { Animation } from './Drawing/Animation';\r\nimport { Trait } from './Interfaces/Trait';\r\nimport { Drawable } from './Interfaces/Drawable';\r\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\r\nimport { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { Eventable } from './Interfaces/Evented';\r\nimport * as Traits from './Traits/Index';\r\nimport * as Events from './Events';\r\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Rectangle } from './Graphics/Rectangle';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { watch } from './Util/Watch';\r\nimport { Collider, CollisionGroup } from './Collision/Index';\r\nimport { Circle } from './Graphics/Circle';\r\nimport { CapturePointerConfig } from './Input/CapturePointerConfig';\r\nimport { ActionsComponent } from './Actions/ActionsComponent';\r\n\r\n/**\r\n * Type guard for checking if something is an Actor\r\n * @param x\r\n */\r\nexport function isActor(x: any): x is Actor {\r\n  return x instanceof Actor;\r\n}\r\n\r\n/**\r\n * Actor contructor options\r\n */\r\nexport interface ActorArgs {\r\n  /**\r\n   * Optionally set the name of the actor, default is 'anonymous'\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally set the x position of the actor, default is 0\r\n   */\r\n  x?: number;\r\n  /**\r\n   * Optionally set the y position of the actor, default is 0\r\n   */\r\n  y?: number;\r\n  /**\r\n   * Optionaly set the (x, y) position of the actor as a vector, default is (0, 0)\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally set the width of a box collider for the actor\r\n   */\r\n  width?: number;\r\n  /**\r\n   * Optionally set the height of a box collider for the actor\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Optionally set the radius of the circle collider for the actor\r\n   */\r\n  radius?: number;\r\n  /**\r\n   * Optionally set the velocity of the actor in pixels/sec\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Optionally set the acceleration of the actor in pixels/sec^2\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Optionally set the scale of the actor's transform\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * Optionally set the z index of the actor, default is 0\r\n   */\r\n  z?: number;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the visibility of the actor\r\n   */\r\n  visible?: boolean;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  anchor?: Vector;\r\n  /**\r\n   * Optionally set the collision type\r\n   */\r\n  collisionType?: CollisionType;\r\n  /**\r\n   * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\r\n   */\r\n  collider?: Collider;\r\n  /**\r\n   * Optionally suppy a [[CollisionGroup]]\r\n   */\r\n  collisionGroup?: CollisionGroup;\r\n}\r\n\r\n/**\r\n * The most important primitive in Excalibur is an `Actor`. Anything that\r\n * can move on the screen, collide with another `Actor`, respond to events,\r\n * or interact with the current scene, must be an actor. An `Actor` **must**\r\n * be part of a [[Scene]] for it to be drawn to the screen.\r\n */\r\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\r\n  // #region Properties\r\n\r\n  /**\r\n   * Set defaults for all Actors\r\n   */\r\n  public static defaults = {\r\n    anchor: Vector.Half\r\n  };\r\n\r\n  /**\r\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\r\n   * acceleration, mass, inertia, etc.\r\n   */\r\n  public get body(): BodyComponent {\r\n    return this.get(BodyComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[TransformComponent]]\r\n   */\r\n  public get transform(): TransformComponent {\r\n    return this.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[MotionComponent]]\r\n   */\r\n  public get motion(): MotionComponent {\r\n    return this.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[GraphicsComponent]]\r\n   */\r\n  public get graphics(): GraphicsComponent {\r\n    return this.get(GraphicsComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[ColliderComponent]]\r\n   */\r\n  public get collider(): ColliderComponent {\r\n    return this.get(ColliderComponent);\r\n  }\r\n\r\n  /**\r\n   * Useful for quickly scripting actor behavior, like moving to a place, patroling back and forth, blinking, etc.\r\n   *\r\n   *  Access to the Actor's built in [[ActionsComponent]] which forwards to the\r\n   * [[ActionContext|Action context]] of the actor.\r\n   */\r\n  public get actions(): ActionsComponent {\r\n    return this.get(ActionsComponent);\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor in pixels\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in pixels\r\n   */\r\n  public set pos(thePos: Vector) {\r\n    this.transform.pos = thePos.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor from the last frame\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.body.oldPos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in the last frame\r\n   */\r\n  public set oldPos(thePos: Vector) {\r\n    this.body.oldPos.setTo(thePos.x, thePos.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public set vel(theVel: Vector) {\r\n    this.motion.vel = theVel.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor from the last frame\r\n   */\r\n  public get oldVel(): Vector {\r\n    return this.body.oldVel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor from the last frame\r\n   */\r\n  public set oldVel(theVel: Vector) {\r\n    this.body.oldVel.setTo(theVel.x, theVel.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\r\n   * useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration vector of teh actor in pixels/second/second\r\n   */\r\n  public set acc(theAcc: Vector) {\r\n    this.motion.acc = theAcc.clone();\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public set oldAcc(theAcc: Vector) {\r\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public get oldAcc(): Vector {\r\n    return this.body.oldAcc;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public get rotation(): number {\r\n    return this.transform.rotation;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public set rotation(theAngle: number) {\r\n    this.transform.rotation = theAngle;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotational velocity of the actor in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotational velocity of the actor in radians/sec\r\n   */\r\n  public set angularVelocity(angularVelocity: number) {\r\n    this.motion.angularVelocity = angularVelocity;\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this.get(TransformComponent).scale;\r\n  }\r\n\r\n  public set scale(scale: Vector) {\r\n    this.get(TransformComponent).scale = scale;\r\n  }\r\n\r\n  /**\r\n   * The anchor to apply all actor related transformations like rotation,\r\n   * translation, and scaling. By default the anchor is in the center of\r\n   * the actor. By default it is set to the center of the actor (.5, .5)\r\n   *\r\n   * An anchor of (.5, .5) will ensure that drawings are centered.\r\n   *\r\n   * Use `anchor.setTo` to set the anchor to a different point using\r\n   * values between 0 and 1. For example, anchoring to the top-left would be\r\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\r\n   */\r\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n\r\n  public set anchor(vec: Vector) {\r\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\r\n    this._handleAnchorChange(vec);\r\n  }\r\n\r\n  private _handleAnchorChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.anchor = v;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the actor is physically in the viewport\r\n   */\r\n  public get isOffScreen(): boolean {\r\n    return this.hasTag('offscreen');\r\n  }\r\n  /**\r\n   * The visibility of an actor\r\n   * @deprecated Use [[GraphicsComponent.visible|Actor.graphics.visible]], will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Actor.visible will be removed in v0.26.0', alternateMethod: 'Use Actor.graphics.visible' })\r\n  public get visible(): boolean {\r\n    return this.graphics.visible;\r\n  }\r\n\r\n  public set visible(isVisible: boolean) {\r\n    this.graphics.visible = isVisible;\r\n  }\r\n\r\n  /**\r\n   * The opacity of an actor.\r\n   *\r\n   * @deprecated Actor.opacity will be removed in v0.26.0, use [[GraphicsComponent.opacity|Actor.graphics.opacity]].\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.opacity will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.opacity'\r\n  })\r\n  public get opacity(): number {\r\n    return this.graphics.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this.graphics.opacity = opacity;\r\n  }\r\n\r\n  /**\r\n   * Convenience reference to the global logger\r\n   */\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * The scene that the actor is in\r\n   */\r\n  public scene: Scene = null;\r\n\r\n  public frames: { [key: string]: Drawable } = {};\r\n\r\n  /**\r\n   * Access to the current drawing for the actor, this can be\r\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\r\n   * Set drawings with [[setDrawing]].\r\n   * @deprecated\r\n   */\r\n  public currentDrawing: Drawable = null;\r\n\r\n  /**\r\n   * Draggable helper\r\n   */\r\n  private _draggable: boolean = false;\r\n  private _dragging: boolean = false;\r\n\r\n  private _pointerDragStartHandler = () => {\r\n    this._dragging = true;\r\n  };\r\n\r\n  private _pointerDragEndHandler = () => {\r\n    this._dragging = false;\r\n  };\r\n\r\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.pointer.lastWorldPos;\r\n    }\r\n  };\r\n\r\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.pointer.lastWorldPos;\r\n    }\r\n  };\r\n\r\n  public get draggable(): boolean {\r\n    return this._draggable;\r\n  }\r\n\r\n  public set draggable(isDraggable: boolean) {\r\n    if (isDraggable) {\r\n      if (isDraggable && !this._draggable) {\r\n        this.on('pointerdragstart', this._pointerDragStartHandler);\r\n        this.on('pointerdragend', this._pointerDragEndHandler);\r\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\r\n      } else if (!isDraggable && this._draggable) {\r\n        this.off('pointerdragstart', this._pointerDragStartHandler);\r\n        this.off('pointerdragend', this._pointerDragEndHandler);\r\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\r\n      }\r\n\r\n      this._draggable = isDraggable;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Modify the current actor update pipeline.\r\n   */\r\n  public traits: Trait[] = [];\r\n\r\n  /**\r\n   * Sets the color of the actor. A rectangle of this color will be\r\n   * drawn if no [[Drawable]] is specified as the actors drawing.\r\n   *\r\n   * The default is `null` which prevents a rectangle from being drawn.\r\n   */\r\n  public get color(): Color {\r\n    return this._color;\r\n  }\r\n  public set color(v: Color) {\r\n    this._color = v.clone();\r\n  }\r\n  private _color: Color;\r\n\r\n  /**\r\n   * Whether or not to enable the [[Traits.CapturePointer]] trait that propagates\r\n   * pointer events to this actor\r\n   */\r\n  public enableCapturePointer: boolean = false;\r\n\r\n  /**\r\n   * Configuration for [[Traits.CapturePointer]] trait\r\n   */\r\n  public capturePointer: CapturePointerConfig = {\r\n    captureMoveEvents: false,\r\n    captureDragEvents: false\r\n  };\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   *\r\n   * @param config\r\n   */\r\n  constructor(config?: ActorArgs) {\r\n    super();\r\n\r\n    const {\r\n      name,\r\n      x,\r\n      y,\r\n      pos,\r\n      scale,\r\n      width,\r\n      height,\r\n      radius,\r\n      collider,\r\n      vel,\r\n      acc,\r\n      rotation,\r\n      angularVelocity,\r\n      z,\r\n      color,\r\n      visible,\r\n      anchor,\r\n      collisionType,\r\n      collisionGroup\r\n    } = {\r\n      ...config\r\n    };\r\n\r\n    this._setName(name);\r\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\r\n\r\n    this.addComponent(new TransformComponent());\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.rotation = rotation ?? 0;\r\n    this.scale = scale ?? vec(1, 1);\r\n    this.z = z ?? 0;\r\n\r\n    this.addComponent(new GraphicsComponent());\r\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\r\n    this.addComponent(new MotionComponent());\r\n    this.vel = vel ?? Vector.Zero;\r\n    this.acc = acc ?? Vector.Zero;\r\n    this.angularVelocity = angularVelocity ?? 0;\r\n\r\n    this.addComponent(new ActionsComponent());\r\n\r\n    this.addComponent(new BodyComponent());\r\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\r\n    if (collisionGroup) {\r\n      this.body.group = collisionGroup;\r\n    }\r\n\r\n    if (collider) {\r\n      this.addComponent(new ColliderComponent(collider));\r\n    } else if (radius) {\r\n      this.addComponent(new ColliderComponent(Shape.Circle(radius, this.anchor)));\r\n    } else {\r\n      if (width > 0 && height > 0) {\r\n        this.addComponent(new ColliderComponent(Shape.Box(width, height, this.anchor)));\r\n      } else {\r\n        this.addComponent(new ColliderComponent()); // no collider\r\n      }\r\n    }\r\n\r\n    this.graphics.visible = visible ?? true;\r\n\r\n    if (color) {\r\n      this.color = color;\r\n      if (width && height) {\r\n        this.graphics.add(\r\n          new Rectangle({\r\n            color: color,\r\n            width,\r\n            height\r\n          })\r\n        );\r\n      } else if (radius) {\r\n        this.graphics.add(\r\n          new Circle({\r\n            color: color,\r\n            radius\r\n          })\r\n        );\r\n      }\r\n    }\r\n\r\n    // Build default pipeline\r\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\r\n      // TODO remove offscreen trait after legacy drawing removed\r\n      this.traits.push(new Traits.OffscreenCulling());\r\n    }\r\n    this.traits.push(new Traits.CapturePointer());\r\n\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    for (const child of this.children) {\r\n      child._initialize(engine);\r\n    }\r\n  }\r\n\r\n  // #region Events\r\n\r\n  private _capturePointerEvents: PointerEventName[] = [\r\n    'pointerup',\r\n    'pointerdown',\r\n    'pointermove',\r\n    'pointerenter',\r\n    'pointerleave',\r\n    'pointerdragstart',\r\n    'pointerdragend',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _captureMoveEvents: PointerEventName[] = [\r\n    'pointermove',\r\n    'pointerenter',\r\n    'pointerleave',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _captureDragEvents: PointerEventName[] = [\r\n    'pointerdragstart',\r\n    'pointerdragend',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _checkForPointerOptIn(eventName: string) {\r\n    if (eventName) {\r\n      const normalized = <PointerEventName>eventName.toLowerCase();\r\n\r\n      if (this._capturePointerEvents.indexOf(normalized) !== -1) {\r\n        this.enableCapturePointer = true;\r\n\r\n        if (this._captureMoveEvents.indexOf(normalized) !== -1) {\r\n          this.capturePointer.captureMoveEvents = true;\r\n        }\r\n\r\n        if (this._captureDragEvents.indexOf(normalized) !== -1) {\r\n          this.capturePointer.captureDragEvents = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    this._checkForPointerOptIn(eventName);\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    this._checkForPointerOptIn(eventName);\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\r\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\r\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\r\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\r\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _prekill(_scene: Scene) {\r\n    super.emit('prekill', new PreKillEvent(this));\r\n    this.onPreKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\r\n   *\r\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\r\n   */\r\n  public onPreKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postkill(_scene: Scene) {\r\n    super.emit('postkill', new PostKillEvent(this));\r\n    this.onPostKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\r\n   *\r\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\r\n   */\r\n  public onPostKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If the current actor is a member of the scene, this will remove\r\n   * it from the scene graph. It will no longer be drawn or updated.\r\n   */\r\n  public kill() {\r\n    if (this.scene) {\r\n      this._prekill(this.scene);\r\n      this.emit('kill', new KillEvent(this));\r\n      super.kill();\r\n      this._postkill(this.scene);\r\n    } else {\r\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the current actor is killed, it will now not be killed.\r\n   */\r\n  public unkill() {\r\n    this.active = true;\r\n  }\r\n\r\n  /**\r\n   * Indicates wether the actor has been killed.\r\n   */\r\n  public isKilled(): boolean {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Sets the current drawing of the actor to the drawing corresponding to\r\n   * the key.\r\n   * @param key The key of the drawing\r\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\r\n   */\r\n  public setDrawing(key: string): void;\r\n  /**\r\n   * Sets the current drawing of the actor to the drawing corresponding to\r\n   * an `enum` key (e.g. `Animations.Left`)\r\n   * @param key The `enum` key of the drawing\r\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\r\n   */\r\n  public setDrawing(key: number): void;\r\n  @obsolete({\r\n    message: 'Actor.setDrawing will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.show() or Actor.graphics.use()'\r\n  })\r\n  public setDrawing(key: any): void {\r\n    key = key.toString();\r\n    if (this.currentDrawing !== this.frames[<string>key]) {\r\n      if (this.frames[key] != null) {\r\n        this.frames[key].reset();\r\n        this.currentDrawing = this.frames[key];\r\n      } else {\r\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\r\n      }\r\n    }\r\n    if (this.currentDrawing && this.currentDrawing instanceof Animation) {\r\n      this.currentDrawing.tick(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(texture: Texture): void;\r\n  /**\r\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(sprite: Sprite): void;\r\n  /**\r\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\r\n   * @param key     The key to associate with a drawing for this actor\r\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(key: any, drawing: Drawable): void;\r\n  @obsolete({\r\n    message: 'Actor.addDrawing will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.add()'\r\n  })\r\n  public addDrawing(): void {\r\n    if (arguments.length === 2) {\r\n      this.frames[<string>arguments[0]] = arguments[1];\r\n      if (!this.currentDrawing) {\r\n        this.currentDrawing = arguments[1];\r\n      }\r\n    } else {\r\n      if (arguments[0] instanceof Sprite) {\r\n        this.addDrawing('default', arguments[0]);\r\n      }\r\n      if (arguments[0] instanceof Texture) {\r\n        this.addDrawing('default', arguments[0].asSprite());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   */\r\n  public get z(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use [[Actor.z]]\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.getZIndex will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\r\n  })\r\n  public getZIndex(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\r\n   * The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   * @param newZ new z-index to assign\r\n   */\r\n  public set z(newZ: number) {\r\n    this.get(TransformComponent).z = newZ;\r\n  }\r\n\r\n  /**\r\n   * @param newIndex new z-index to assign\r\n   * @deprecated Use [[Actor.z]]\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.setZIndex will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\r\n  })\r\n  public setZIndex(newIndex: number) {\r\n    this.get(TransformComponent).z = newIndex;\r\n  }\r\n\r\n  /**\r\n   * Get the center point of an actor\r\n   */\r\n  public get center(): Vector {\r\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  public get width() {\r\n    return this.collider.localBounds.width * this.getGlobalScale().x;\r\n  }\r\n\r\n  public get height() {\r\n    return this.collider.localBounds.height * this.getGlobalScale().y;\r\n  }\r\n\r\n  /**\r\n   * Gets this actor's rotation taking into account any parent relationships\r\n   *\r\n   * @returns Rotation angle in radians\r\n   */\r\n  public getGlobalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   *\r\n   * @returns Position in world coordinates\r\n   */\r\n  public getGlobalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global scale of the Actor\r\n   */\r\n  public getGlobalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  // #region Collision\r\n\r\n  /**\r\n   * Tests whether the x/y specified are contained in the actor\r\n   * @param x  X coordinate to test (in world coordinates)\r\n   * @param y  Y coordinate to test (in world coordinates)\r\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\r\n   */\r\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\r\n    const point = vec(x, y);\r\n    const collider = this.get(ColliderComponent);\r\n    collider.update();\r\n    const geom = collider.get();\r\n    if (!geom) {\r\n      return false;\r\n    }\r\n    const containment = geom.contains(point);\r\n\r\n    if (recurse) {\r\n      return (\r\n        containment ||\r\n        this.children.some((child: Actor) => {\r\n          return child.contains(x, y, true);\r\n        })\r\n      );\r\n    }\r\n\r\n    return containment;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\r\n   * @param actor     Actor to test\r\n   * @param distance  Distance in pixels to test\r\n   */\r\n  public within(actor: Actor, distance: number): boolean {\r\n    const collider = this.get(ColliderComponent);\r\n    const otherCollider = actor.get(ColliderComponent);\r\n    const me = collider.get();\r\n    const other = otherCollider.get();\r\n    if (me && other) {\r\n      return me.getClosestLineBetween(other).getLength() <= distance;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Update\r\n\r\n  /**\r\n   * Called by the Engine, updates the state of the actor\r\n   * @internal\r\n   * @param engine The reference to the current game engine\r\n   * @param delta  The time elapsed since the last update in milliseconds\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n\r\n    // Tick animations\r\n    const drawing = this.currentDrawing;\r\n    if (drawing && drawing instanceof Animation) {\r\n      drawing.tick(delta, engine.stats.currFrame.id);\r\n    }\r\n\r\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\r\n    for (const trait of this.traits) {\r\n      trait.update(this, engine, delta);\r\n    }\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an actor is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an actor is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  // endregion\r\n\r\n  // #region Drawing\r\n  /**\r\n   * Called by the Engine, draws the actor to the screen\r\n   * @param ctx   The rendering context\r\n   * @param delta The time since the last draw in milliseconds\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics, will be removed in v0.26.0\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n    // translate canvas by anchor offset\r\n    ctx.save();\r\n\r\n    if (this.currentDrawing) {\r\n      ctx.translate(-(this.width * this.anchor.x), -(this.height * this.anchor.y));\r\n\r\n      this._predraw(ctx, delta);\r\n      const drawing = this.currentDrawing;\r\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n      const offsetX = (this.width - drawing.width * drawing.scale.x) * this.anchor.x;\r\n      const offsetY = (this.height - drawing.height * drawing.scale.y) * this.anchor.y;\r\n\r\n      this.currentDrawing.draw({ ctx, x: offsetX, y: offsetY, opacity: this.graphics.opacity });\r\n    } else {\r\n      this._predraw(ctx, delta);\r\n      if (this.color && this.collider) {\r\n        // update collider geometry based on transform\r\n        const collider = this.get(ColliderComponent);\r\n        collider.update();\r\n        if (collider && !collider.bounds.hasZeroDimensions()) {\r\n          // Colliders are already shifted by anchor, unshift\r\n          ctx.globalAlpha = this.graphics.opacity;\r\n          collider.get()?.draw(ctx, this.color, vec(0, 0));\r\n        }\r\n      }\r\n    }\r\n    ctx.restore();\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   */\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   */\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPreDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\r\n    this.onPreDraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\r\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\r\n    this.onPostDraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Called by the Engine, draws the actors debugging to the screen\r\n   * @param ctx The rendering context\r\n   *\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n  // #endregion\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Engine } from './Engine';\r\nimport { Actor, ActorArgs } from './Actor';\r\nimport * as Traits from './Traits/Index';\r\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\n/**\r\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\r\n * not participate in collisions. Drawn on top of all other actors.\r\n */\r\nexport class ScreenElement extends Actor {\r\n  protected _engine: Engine;\r\n\r\n  constructor();\r\n  constructor(config?: ActorArgs);\r\n\r\n  constructor(config?: ActorArgs) {\r\n    super({ ...config });\r\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\r\n    this.traits = [];\r\n    this.traits.push(new Traits.CapturePointer());\r\n    this.anchor = vec(0, 0);\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n    this.collider.useBoxCollider(this.width, this.height, this.anchor);\r\n    this.enableCapturePointer = true;\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    this._engine = engine;\r\n    super._initialize(engine);\r\n  }\r\n\r\n  public contains(x: number, y: number, useWorld: boolean = true) {\r\n    if (useWorld) {\r\n      return super.contains(x, y);\r\n    }\r\n\r\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\r\n    return super.contains(coords.x, coords.y);\r\n  }\r\n}\r\n","import { Scene } from './Scene';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { Logger } from './Util/Log';\r\n\r\nexport interface TimerOptions {\r\n  repeats?: boolean;\r\n  numberOfRepeats?: number;\r\n  fcn?: () => void;\r\n  interval: number;\r\n}\r\n\r\n/**\r\n * The Excalibur timer hooks into the internal timer and fires callbacks,\r\n * after a certain interval, optionally repeating.\r\n */\r\nexport class Timer {\r\n  private _logger = Logger.getInstance();\r\n  private static _MAX_ID: number = 0;\r\n  public id: number = 0;\r\n\r\n  private _elapsedTime: number = 0;\r\n  private _totalTimeAlive: number = 0;\r\n\r\n  private _running = false;\r\n\r\n  private _numberOfTicks: number = 0;\r\n  private _callbacks: Array<() => void>;\r\n\r\n  public interval: number = 10;\r\n  public repeats: boolean = false;\r\n  public maxNumberOfRepeats: number = -1;\r\n\r\n  private _complete = false;\r\n  public get complete() {\r\n    return this._complete;\r\n  }\r\n  public scene: Scene = null;\r\n\r\n  /**\r\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\r\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\r\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\r\n   * @param fcn        The callback to be fired after the interval is complete.\r\n   */\r\n  constructor(options: TimerOptions);\r\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\r\n    if (typeof fcn !== 'function') {\r\n      const options = fcn;\r\n      fcn = options.fcn;\r\n      interval = options.interval;\r\n      repeats = options.repeats;\r\n      numberOfRepeats = options.numberOfRepeats;\r\n    }\r\n\r\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = numberOfRepeats;\r\n      if (!repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this.id = Timer._MAX_ID++;\r\n    this.interval = interval || this.interval;\r\n    this.repeats = repeats || this.repeats;\r\n\r\n    this._callbacks = [];\r\n\r\n    if (fcn) {\r\n      this.on(fcn);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a new callback to be fired after the interval is complete\r\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\r\n   */\r\n  public on(fcn: () => void) {\r\n    this._callbacks.push(fcn);\r\n  }\r\n\r\n  /**\r\n   * Removes a callback from the callback list to be fired after the interval is complete.\r\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\r\n   */\r\n  public off(fcn: () => void) {\r\n    const index = this._callbacks.indexOf(fcn);\r\n    this._callbacks.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\r\n   * @param delta  Number of elapsed milliseconds since the last update.\r\n   */\r\n  public update(delta: number) {\r\n    if (this._running) {\r\n      this._totalTimeAlive += delta;\r\n      this._elapsedTime += delta;\r\n\r\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\r\n        this._complete = true;\r\n        this._running = false;\r\n        this._elapsedTime = 0;\r\n      }\r\n\r\n      if (!this.complete && this._elapsedTime >= this.interval) {\r\n        this._callbacks.forEach((c) => {\r\n          c.call(this);\r\n        });\r\n\r\n        this._numberOfTicks++;\r\n        if (this.repeats) {\r\n          this._elapsedTime = 0;\r\n        } else {\r\n          this._complete = true;\r\n          this._running = false;\r\n          this._elapsedTime = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\r\n   *\r\n   * Warning** you may need to call `timer.start()` again if the timer had completed\r\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\r\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\r\n   */\r\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\r\n    if (!!newInterval && newInterval >= 0) {\r\n      this.interval = newInterval;\r\n    }\r\n\r\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = newNumberOfRepeats;\r\n      if (!this.repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this._complete = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n  }\r\n\r\n  public get timesRepeated(): number {\r\n    return this._numberOfTicks;\r\n  }\r\n\r\n  public getTimeRunning(): number {\r\n    return this._totalTimeAlive;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds until the next action callback, if complete will return 0\r\n   */\r\n  public get timeToNextAction() {\r\n    if (this.complete) {\r\n      return 0;\r\n    }\r\n    return this.interval - this._elapsedTime;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds elapsed toward the next action\r\n   */\r\n  public get timeElapsedTowardNextAction() {\r\n    return this._elapsedTime;\r\n  }\r\n\r\n  public get isRunning() {\r\n    return this._running;\r\n  }\r\n\r\n  /**\r\n   * Pauses the timer, time will no longer increment towards the next call\r\n   */\r\n  public pause(): Timer {\r\n    this._running = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Unpauses the timer. Time will now increment towards the next call\r\n   * @deprecated Will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'Use Timer.resume()' })\r\n  public unpause() {\r\n    this._running = true;\r\n  }\r\n\r\n  /**\r\n   * Resumes the timer, time will now increment towards the next call.\r\n   */\r\n  public resume(): Timer {\r\n    this._running = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\r\n   */\r\n  public start(): Timer {\r\n    if (!this.scene) {\r\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\r\n    }\r\n\r\n    this._running = true;\r\n    if (this.complete) {\r\n      this._complete = false;\r\n      this._elapsedTime = 0;\r\n      this._numberOfTicks = 0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\r\n   */\r\n  public stop(): Timer {\r\n    this._running = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Cancels the timer, preventing any further executions.\r\n   */\r\n  public cancel() {\r\n    this.pause();\r\n    if (this.scene) {\r\n      this.scene.cancelTimer(this);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\r\nimport { Class } from './Class';\r\nimport { BoundingBox } from './Collision/BoundingBox';\r\nimport { Logger } from './Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { watchAny } from './Util/Watch';\r\n\r\n/**\r\n * Interface that describes a custom camera strategy for tracking targets\r\n */\r\nexport interface CameraStrategy<T> {\r\n  /**\r\n   * Target of the camera strategy that will be passed to the action\r\n   */\r\n  target: T;\r\n\r\n  /**\r\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\r\n   * @param target The target object to apply this camera strategy (if any)\r\n   * @param camera The current camera implementation in excalibur running the game\r\n   * @param engine The current engine running the game\r\n   * @param delta The elapsed time in milliseconds since the last frame\r\n   */\r\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\r\n}\r\n\r\n/**\r\n * Container to house convenience strategy methods\r\n * @internal\r\n */\r\nexport class StrategyContainer {\r\n  constructor(public camera: Camera) {}\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\r\n   * @param actor The actor to lock the camera to\r\n   */\r\n  public lockToActor(actor: Actor) {\r\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\r\n   * @param actor The actor to lock the camera to\r\n   * @param axis The axis to follow the actor on\r\n   */\r\n  public lockToActorAxis(actor: Actor, axis: Axis) {\r\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param actor Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\r\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\r\n   * @param actor Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  public radiusAroundActor(actor: Actor, radius: number) {\r\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\r\n   * @param box The bounding box to limit the camera to.\r\n   */\r\n  public limitCameraBounds(box: BoundingBox) {\r\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\r\n  }\r\n}\r\n\r\n/**\r\n * Camera axis enum\r\n */\r\nexport enum Axis {\r\n  X,\r\n  Y\r\n}\r\n\r\n/**\r\n * Lock a camera to the exact x/y position of an actor.\r\n */\r\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor) {}\r\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    return center;\r\n  };\r\n}\r\n\r\n/**\r\n * Lock a camera to a specific axis around an actor.\r\n */\r\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor, public axis: Axis) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    const currentFocus = cam.getFocus();\r\n    if (this.axis === Axis.X) {\r\n      return new Vector(center.x, currentFocus.y);\r\n    } else {\r\n      return new Vector(currentFocus.x, center.y);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\r\n */\r\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param target Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    let focus = cam.getFocus();\r\n    let cameraVel = cam.vel.clone();\r\n\r\n    // Calculate the stretch vector, using the spring equation\r\n    // F = kX\r\n    // https://en.wikipedia.org/wiki/Hooke's_law\r\n    // Apply to the current camera velocity\r\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\r\n    cameraVel = cameraVel.add(stretch);\r\n\r\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\r\n    // Apply to the current camera velocity\r\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\r\n    cameraVel = cameraVel.add(friction);\r\n\r\n    // Update position by velocity deltas\r\n    focus = focus.add(cameraVel);\r\n\r\n    return focus;\r\n  };\r\n}\r\n\r\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   *\r\n   * @param target Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  constructor(public target: Actor, public radius: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    const focus = cam.getFocus();\r\n\r\n    const direction = position.sub(focus);\r\n    const distance = direction.size;\r\n    if (distance >= this.radius) {\r\n      const offset = distance - this.radius;\r\n      return focus.add(direction.normalize().scale(offset));\r\n    }\r\n    return focus;\r\n  };\r\n}\r\n\r\n/**\r\n * Prevent a camera from going beyond the given camera dimensions.\r\n */\r\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\r\n  /**\r\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\r\n   *\r\n   * Note that this strategy does not perform any movement by itself.\r\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\r\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\r\n   *\r\n   * Make sure that the camera bounds are at least as large as the viewport size.\r\n   *\r\n   * @param target The bounding box to limit the camera to\r\n   */\r\n\r\n  boundSizeChecked: boolean = false; // Check and warn only once\r\n\r\n  constructor(public target: BoundingBox) {}\r\n\r\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const focus = cam.getFocus();\r\n\r\n    if (!this.boundSizeChecked) {\r\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\r\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\r\n      }\r\n      this.boundSizeChecked = true;\r\n    }\r\n\r\n    let focusX = focus.x;\r\n    let focusY = focus.y;\r\n    if (focus.x < target.left + _eng.halfDrawWidth) {\r\n      focusX = target.left + _eng.halfDrawWidth;\r\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\r\n      focusX = target.right - _eng.halfDrawWidth;\r\n    }\r\n\r\n    if (focus.y < target.top + _eng.halfDrawHeight) {\r\n      focusY = target.top + _eng.halfDrawHeight;\r\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\r\n      focusY = target.bottom - _eng.halfDrawHeight;\r\n    }\r\n\r\n    return vec(focusX, focusY);\r\n  };\r\n}\r\n\r\n/**\r\n * Cameras\r\n *\r\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\r\n * to move around your game and set focus. They are used to determine\r\n * what is \"off screen\" and can be used to scale the game.\r\n *\r\n */\r\nexport class Camera extends Class implements CanUpdate, CanInitialize {\r\n  protected _follow: Actor;\r\n\r\n  private _cameraStrategies: CameraStrategy<any>[] = [];\r\n\r\n  public strategy: StrategyContainer = new StrategyContainer(this);\r\n\r\n  /**\r\n   * Get or set current zoom of the camera, defaults to 1\r\n   */\r\n  private _z = 1;\r\n  public get zoom(): number {\r\n    return this._z;\r\n  }\r\n\r\n  public set zoom(val: number) {\r\n    this._z = val;\r\n    if (this._engine) {\r\n      this._halfWidth = this._engine.halfDrawWidth;\r\n      this._halfHeight = this._engine.halfDrawHeight;\r\n    }\r\n  }\r\n  /**\r\n   * Get or set rate of change in zoom, defaults to 0\r\n   */\r\n  public dz: number = 0;\r\n  /**\r\n   * Get or set zoom acceleration\r\n   */\r\n  public az: number = 0;\r\n\r\n  /**\r\n   * Current rotation of the camera\r\n   */\r\n  public rotation: number = 0;\r\n\r\n  /**\r\n   * Current angular velocity\r\n   */\r\n  public rx: number = 0;\r\n\r\n  /**\r\n   * Get or set the camera's angular velocity\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.rx;\r\n  }\r\n\r\n  public set angularVelocity(value: number) {\r\n    this.rx = value;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's position\r\n   */\r\n  private _posChanged = false;\r\n  private _pos: Vector = watchAny(Vector.Zero, () => (this._posChanged = true));\r\n  public get pos(): Vector {\r\n    return this._pos;\r\n  }\r\n  public set pos(vec: Vector) {\r\n    this._pos = watchAny(vec, () => (this._posChanged = true));\r\n    this._posChanged = true;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's velocity\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * GEt or set the camera's acceleration\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  private _cameraMoving: boolean = false;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1000; // 1 second\r\n  private _lerpStart: Vector = null;\r\n  private _lerpEnd: Vector = null;\r\n  private _lerpResolve: (value: Vector) => void;\r\n  private _lerpPromise: Promise<Vector>;\r\n\r\n  //camera effects\r\n  protected _isShaking: boolean = false;\r\n  private _shakeMagnitudeX: number = 0;\r\n  private _shakeMagnitudeY: number = 0;\r\n  private _shakeDuration: number = 0;\r\n  private _elapsedShakeTime: number = 0;\r\n  private _xShake: number = 0;\r\n  private _yShake: number = 0;\r\n\r\n  protected _isZooming: boolean = false;\r\n  private _zoomStart: number = 1;\r\n  private _zoomEnd: number = 1;\r\n  private _currentZoomTime: number = 0;\r\n  private _zoomDuration: number = 0;\r\n\r\n  private _zoomResolve: (val: boolean) => void;\r\n  private _zoomPromise: Promise<boolean>;\r\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n\r\n  private _halfWidth: number = 0;\r\n  private _halfHeight: number = 0;\r\n\r\n  /**\r\n   * Get the camera's x position\r\n   */\r\n  public get x() {\r\n    return this.pos.x;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set x(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(value, this.pos.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the camera's y position\r\n   */\r\n  public get y() {\r\n    return this.pos.y;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set y(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(this.pos.x, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x velocity\r\n   */\r\n  public get dx() {\r\n    return this.vel.x;\r\n  }\r\n\r\n  public set dx(value: number) {\r\n    this.vel = vec(value, this.vel.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y velocity\r\n   */\r\n  public get dy() {\r\n    return this.vel.y;\r\n  }\r\n\r\n  public set dy(value: number) {\r\n    this.vel = vec(this.vel.x, value);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x acceleration\r\n   */\r\n  public get ax() {\r\n    return this.acc.x;\r\n  }\r\n\r\n  public set ax(value: number) {\r\n    this.acc = vec(value, this.acc.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y acceleration\r\n   */\r\n  public get ay() {\r\n    return this.acc.y;\r\n  }\r\n\r\n  public set ay(value: number) {\r\n    this.acc = vec(this.acc.x, value);\r\n  }\r\n\r\n  /**\r\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\r\n   */\r\n  public getFocus() {\r\n    return this.pos;\r\n  }\r\n\r\n  /**\r\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\r\n   *\r\n   * @param pos The target position to move to\r\n   * @param duration The duration in milliseconds the move should last\r\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\r\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\r\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\r\n   */\r\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\r\n    if (typeof easingFn !== 'function') {\r\n      throw 'Please specify an EasingFunction';\r\n    }\r\n\r\n    // cannot move when following an actor\r\n    if (this._follow) {\r\n      return Promise.reject(pos);\r\n    }\r\n\r\n    // resolve existing promise, if any\r\n    if (this._lerpPromise && this._lerpResolve) {\r\n      this._lerpResolve(pos);\r\n    }\r\n\r\n    this._lerpPromise = new Promise<Vector>((resolve) => {\r\n      this._lerpResolve = resolve;\r\n    });\r\n    this._lerpStart = this.getFocus().clone();\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = pos;\r\n    this._currentLerpTime = 0;\r\n    this._cameraMoving = true;\r\n    this._easing = easingFn;\r\n\r\n    return this._lerpPromise;\r\n  }\r\n\r\n  /**\r\n   * Sets the camera to shake at the specified magnitudes for the specified duration\r\n   * @param magnitudeX  The x magnitude of the shake\r\n   * @param magnitudeY  The y magnitude of the shake\r\n   * @param duration    The duration of the shake in milliseconds\r\n   */\r\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\r\n    this._isShaking = true;\r\n    this._shakeMagnitudeX = magnitudeX;\r\n    this._shakeMagnitudeY = magnitudeY;\r\n    this._shakeDuration = duration;\r\n  }\r\n\r\n  /**\r\n   * Zooms the camera in or out by the specified scale over the specified duration.\r\n   * If no duration is specified, it take effect immediately.\r\n   * @param scale    The scale of the zoom\r\n   * @param duration The duration of the zoom in milliseconds\r\n   */\r\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\r\n    this._zoomPromise = new Promise<boolean>((resolve) => {\r\n      this._zoomResolve = resolve;\r\n    });\r\n\r\n    if (duration) {\r\n      this._isZooming = true;\r\n      this._zoomEasing = easingFn;\r\n      this._currentZoomTime = 0;\r\n      this._zoomDuration = duration;\r\n      this._zoomStart = this.zoom;\r\n      this._zoomEnd = scale;\r\n    } else {\r\n      this._isZooming = false;\r\n      this.zoom = scale;\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    return this._zoomPromise;\r\n  }\r\n\r\n  private _viewport: BoundingBox = null;\r\n  /**\r\n   * Gets the bounding box of the viewport of this camera in world coordinates\r\n   */\r\n  public get viewport(): BoundingBox {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n\r\n    return new BoundingBox(0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Adds a new camera strategy to this camera\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    this._cameraStrategies.push(cameraStrategy);\r\n  }\r\n\r\n  /**\r\n   * Removes a camera strategy by reference\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\r\n  }\r\n\r\n  /**\r\n   * Clears all camera strategies from the camera\r\n   */\r\n  public clearAllStrategies() {\r\n    this._cameraStrategies.length = 0;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  private _engine: Engine;\r\n  private _isInitialized = false;\r\n  public get isInitialized() {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public _initialize(_engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this._engine = _engine;\r\n\r\n      const currentRes = this._engine.screen.resolution;\r\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\r\n      if (!this._engine.loadingComplete) {\r\n        // If there was a loading screen, we peek the configured resolution\r\n        const res = this._engine.screen.peekResolution();\r\n        if (res) {\r\n          center = vec(res.width / 2, res.height / 2);\r\n        }\r\n      }\r\n      this._halfWidth = center.x;\r\n      this._halfHeight = center.x;\r\n\r\n      // If the user has not set the camera pos, apply default center screen position\r\n      if (!this._posChanged) {\r\n        this.pos = center;\r\n      }\r\n\r\n      this.onInitialize(_engine);\r\n      super.emit('initialize', new InitializeEvent(_engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onInitialize(_engine: Engine) {\r\n    // Overridable\r\n  }\r\n\r\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public on(eventName: any, handler: any) {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\r\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\r\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\r\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public off(eventName: string, handler: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this._initialize(_engine);\r\n    this._preupdate(_engine, delta);\r\n\r\n    // Update placements based on linear algebra\r\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\r\n    this.zoom += (this.dz * delta) / 1000;\r\n\r\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\r\n    this.dz += (this.az * delta) / 1000;\r\n\r\n    this.rotation += (this.angularVelocity * delta) / 1000;\r\n\r\n    if (this._isZooming) {\r\n      if (this._currentZoomTime < this._zoomDuration) {\r\n        const zoomEasing = this._zoomEasing;\r\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\r\n\r\n        this.zoom = newZoom;\r\n        this._currentZoomTime += delta;\r\n      } else {\r\n        this._isZooming = false;\r\n        this.zoom = this._zoomEnd;\r\n        this._currentZoomTime = 0;\r\n        this._zoomResolve(true);\r\n      }\r\n    }\r\n\r\n    if (this._cameraMoving) {\r\n      if (this._currentLerpTime < this._lerpDuration) {\r\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n\r\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\r\n\r\n        this.pos = lerpPoint;\r\n\r\n        this._currentLerpTime += delta;\r\n      } else {\r\n        this.pos = this._lerpEnd;\r\n        const end = this._lerpEnd.clone();\r\n\r\n        this._lerpStart = null;\r\n        this._lerpEnd = null;\r\n        this._currentLerpTime = 0;\r\n        this._cameraMoving = false;\r\n        // Order matters here, resolve should be last so any chain promises have a clean slate\r\n        this._lerpResolve(end);\r\n      }\r\n    }\r\n\r\n    if (this._isDoneShaking()) {\r\n      this._isShaking = false;\r\n      this._elapsedShakeTime = 0;\r\n      this._shakeMagnitudeX = 0;\r\n      this._shakeMagnitudeY = 0;\r\n      this._shakeDuration = 0;\r\n      this._xShake = 0;\r\n      this._yShake = 0;\r\n    } else {\r\n      this._elapsedShakeTime += delta;\r\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\r\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\r\n    }\r\n\r\n    for (const s of this._cameraStrategies) {\r\n      this.pos = s.action.call(s, s.target, this, _engine, delta);\r\n    }\r\n\r\n    this._viewport = new BoundingBox(\r\n      this.x - this._halfWidth,\r\n      this.y - this._halfHeight,\r\n      this.x + this._halfWidth,\r\n      this.y + this._halfHeight\r\n    );\r\n\r\n    this._postupdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\r\n   * @param ctx    Canvas context to apply transformations\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D): void;\r\n  public draw(ctx: ExcaliburGraphicsContext): void;\r\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext): void {\r\n    let canvasWidth = 0;\r\n    let canvasHeight = 0;\r\n    if (ctx instanceof CanvasRenderingContext2D) {\r\n      canvasWidth = ctx.canvas.width;\r\n      canvasHeight = ctx.canvas.height;\r\n    } else {\r\n      canvasWidth = ctx.width;\r\n      canvasHeight = ctx.height;\r\n    }\r\n    const focus = this.getFocus();\r\n    const pixelRatio = this._engine ? this._engine.pixelRatio : 1;\r\n    const zoom = this.zoom;\r\n\r\n    const newCanvasWidth = canvasWidth / zoom / pixelRatio;\r\n    const newCanvasHeight = canvasHeight / zoom / pixelRatio;\r\n\r\n    ctx.scale(zoom, zoom);\r\n    ctx.translate(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n\r\n  private _isDoneShaking(): boolean {\r\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\r\n  }\r\n}\r\n","import { BoundingBox } from './Collision/BoundingBox';\r\nimport { Engine } from './Engine';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { SpriteSheet } from './Drawing/SpriteSheet';\r\nimport * as Events from './Events';\r\nimport { Configurable } from './Configurable';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { ExcaliburGraphicsContext, GraphicsComponent, hasGraphicsTick } from './Graphics';\r\nimport * as Graphics from './Graphics';\r\nimport { CanvasDrawComponent, Sprite } from './Drawing/Index';\r\nimport { Sprite as LegacySprite } from './Drawing/Index';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { CompositeCollider } from './Collision/Colliders/CompositeCollider';\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class TileMapImpl extends Entity {\r\n  private _token = 0;\r\n  private _onScreenXStart: number = 0;\r\n  private _onScreenXEnd: number = 9999;\r\n  private _onScreenYStart: number = 0;\r\n  private _onScreenYEnd: number = 9999;\r\n  private _spriteSheets: { [key: string]: Graphics.SpriteSheet } = {};\r\n\r\n  private _legacySpriteMap = new Map<Graphics.Sprite, Sprite>();\r\n  public logger: Logger = Logger.getInstance();\r\n  public readonly data: Cell[] = [];\r\n  private _rows: Cell[][] = [];\r\n  private _cols: Cell[][] = [];\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n  public readonly cellWidth: number;\r\n  public readonly cellHeight: number;\r\n  public readonly rows: number;\r\n  public readonly cols: number;\r\n\r\n  private _dirty = true;\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n  private _transform: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _collider: ColliderComponent;\r\n  private _composite: CompositeCollider;\r\n\r\n  public get x(): number {\r\n    return this._transform.pos.x ?? 0;\r\n  }\r\n\r\n  public set x(val: number) {\r\n    if (this._transform?.pos) {\r\n      this.get(TransformComponent).pos = vec(val, this.y);\r\n    }\r\n  }\r\n\r\n  public get y(): number {\r\n    return this._transform?.pos.y ?? 0;\r\n  }\r\n\r\n  public set y(val: number) {\r\n    if (this._transform?.pos) {\r\n      this._transform.pos = vec(this.x, val);\r\n    }\r\n  }\r\n\r\n  public get z(): number {\r\n    return this._transform.z ?? 0;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    if (this._transform) {\r\n      this._transform.z = val;\r\n    }\r\n  }\r\n\r\n  public get rotation(): number {\r\n    return this._transform?.rotation ?? 0;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    if (this._transform?.rotation) {\r\n      this._transform.rotation = val;\r\n    }\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this._transform?.scale ?? Vector.One;\r\n  }\r\n  public set scale(val: Vector) {\r\n    if (this._transform?.scale) {\r\n      this._transform.scale = val;\r\n    }\r\n  }\r\n\r\n  public get pos(): Vector {\r\n    return this._transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this._transform.pos = val;\r\n  }\r\n\r\n  public get vel(): Vector {\r\n    return this._motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this._motion.vel = val;\r\n  }\r\n\r\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * @param xOrConfig     The x coordinate to anchor the TileMap's upper left corner (should not be changed once set) or TileMap option bag\r\n   * @param y             The y coordinate to anchor the TileMap's upper left corner (should not be changed once set)\r\n   * @param cellWidth     The individual width of each cell (in pixels) (should not be changed once set)\r\n   * @param cellHeight    The individual height of each cell (in pixels) (should not be changed once set)\r\n   * @param rows          The number of rows in the TileMap (should not be changed once set)\r\n   * @param cols          The number of cols in the TileMap (should not be changed once set)\r\n   */\r\n  constructor(xOrConfig: number | TileMapArgs, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number) {\r\n    super();\r\n    if (xOrConfig && typeof xOrConfig === 'object') {\r\n      const config = xOrConfig;\r\n      xOrConfig = config.x;\r\n      y = config.y;\r\n      cellWidth = config.cellWidth;\r\n      cellHeight = config.cellHeight;\r\n      rows = config.rows;\r\n      cols = config.cols;\r\n    }\r\n    this.addComponent(new TransformComponent());\r\n    this.addComponent(new MotionComponent());\r\n    this.addComponent(\r\n      new BodyComponent({\r\n        type: CollisionType.Fixed\r\n      })\r\n    );\r\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\r\n    this.addComponent(\r\n      new GraphicsComponent({\r\n        onPostDraw: (ctx, delta) => this.draw(ctx, delta)\r\n      })\r\n    );\r\n    this.addComponent(new ColliderComponent());\r\n    this._transform = this.get(TransformComponent);\r\n    this._motion = this.get(MotionComponent);\r\n    this._collider = this.get(ColliderComponent);\r\n    this._composite = this._collider.useCompositeCollider([]);\r\n\r\n    this.x = <number>xOrConfig;\r\n    this.y = y;\r\n    this.cellWidth = cellWidth;\r\n    this.cellHeight = cellHeight;\r\n    this.rows = rows;\r\n    this.cols = cols;\r\n    this.data = new Array<Cell>(rows * cols);\r\n    this._rows = new Array(rows);\r\n    this._cols = new Array(cols);\r\n    let currentCol: Cell[] = [];\r\n    for (let i = 0; i < cols; i++) {\r\n      for (let j = 0; j < rows; j++) {\r\n        const cd = new Cell(i * cellWidth + <number>xOrConfig, j * cellHeight + y, cellWidth, cellHeight, i + j * cols);\r\n        cd.map = this;\r\n        this.data[i + j * cols] = cd;\r\n        currentCol.push(cd);\r\n        if (!this._rows[j]) {\r\n          this._rows[j] = [];\r\n        }\r\n        this._rows[j].push(cd);\r\n      }\r\n      this._cols[i] = currentCol;\r\n      currentCol = [];\r\n    }\r\n\r\n    this.get(GraphicsComponent).localBounds = new BoundingBox({\r\n      left: 0,\r\n      top: 0,\r\n      right: this.cols * this.cellWidth,\r\n      bottom: this.rows * this.cellHeight\r\n    });\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param key\r\n   * @param spriteSheet\r\n   * @deprecated No longer used, will be removed in v0.26.0\r\n   */\r\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet): void;\r\n  public registerSpriteSheet(key: string, spriteSheet: Graphics.SpriteSheet): void;\r\n  @obsolete({ message: 'No longer used, will be removed in v0.26.0' })\r\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet | Graphics.SpriteSheet): void {\r\n    if (spriteSheet instanceof Graphics.SpriteSheet) {\r\n      this._spriteSheets[key] = spriteSheet;\r\n    } else {\r\n      this._spriteSheets[key] = Graphics.SpriteSheet.fromLegacySpriteSheet(spriteSheet);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tiles colliders based on the solid tiles in the tilemap.\r\n   */\r\n  private _updateColliders(): void {\r\n    this._composite.clearColliders();\r\n    const colliders: BoundingBox[] = [];\r\n    let current: BoundingBox;\r\n    // Bad square tessalation algo\r\n    for (let i = 0; i < this.cols; i++) {\r\n      // Scan column for colliders\r\n      for (let j = 0; j < this.rows; j++) {\r\n        // Columns start with a new collider\r\n        if (j === 0) {\r\n          current = null;\r\n        }\r\n        const tile = this.data[i + j * this.cols];\r\n        // Current tile in column is solid build up current collider\r\n        if (tile.solid) {\r\n          if (!current) {\r\n            current = tile.bounds;\r\n          } else {\r\n            current = current.combine(tile.bounds);\r\n          }\r\n        } else {\r\n          // Not solid skip and cut off the current collider\r\n          if (current) {\r\n            colliders.push(current);\r\n          }\r\n          current = null;\r\n        }\r\n      }\r\n      // After a column is complete check to see if it can be merged into the last one\r\n      if (current) {\r\n        // if previous is the same combine it\r\n        const prev = colliders[colliders.length - 1];\r\n        if (prev && prev.top === current.top && prev.bottom === current.bottom) {\r\n          colliders[colliders.length - 1] = prev.combine(current);\r\n        } else {\r\n          // else new collider\r\n          colliders.push(current);\r\n        }\r\n      }\r\n    }\r\n    this._composite = this._collider.useCompositeCollider([]);\r\n    for (const c of colliders) {\r\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\r\n      collider.owner = this;\r\n      this._composite.addCollider(collider);\r\n    }\r\n    this._collider.update();\r\n  }\r\n\r\n  /**\r\n   * Returns the [[Cell]] by index (row major order)\r\n   */\r\n  public getCellByIndex(index: number): Cell {\r\n    return this.data[index];\r\n  }\r\n  /**\r\n   * Returns the [[Cell]] by its x and y coordinates\r\n   */\r\n  public getCell(x: number, y: number): Cell {\r\n    if (x < 0 || y < 0 || x >= this.cols || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.data[x + y * this.cols];\r\n  }\r\n  /**\r\n   * Returns the [[Cell]] by testing a point in global coordinates,\r\n   * returns `null` if no cell was found.\r\n   */\r\n  public getCellByPoint(x: number, y: number): Cell {\r\n    x = Math.floor((x - this.pos.x) / this.cellWidth);\r\n    y = Math.floor((y - this.pos.y) / this.cellHeight);\r\n    const cell = this.getCell(x, y);\r\n    if (x >= 0 && y >= 0 && x < this.cols && y < this.rows && cell) {\r\n      return cell;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public getRows(): readonly Cell[][] {\r\n    return this._rows;\r\n  }\r\n\r\n  public getColumns(): readonly Cell[][] {\r\n    return this._cols;\r\n  }\r\n\r\n  public onPreUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  public onPostUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  public update(engine: Engine, delta: number) {\r\n    this.onPreUpdate(engine, delta);\r\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\r\n    if (this._dirty) {\r\n      this._dirty = false;\r\n      this._updateColliders();\r\n    }\r\n\r\n    this._token++;\r\n    const worldBounds = engine.getWorldBounds();\r\n    const worldCoordsUpperLeft = vec(worldBounds.left, worldBounds.top);\r\n    const worldCoordsLowerRight = vec(worldBounds.right, worldBounds.bottom);\r\n\r\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.cellWidth) - 2, 0);\r\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.cellHeight) - 2, 0);\r\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.cellWidth) + 2, 0);\r\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.cellHeight) + 2, 0);\r\n    this._transform.pos = vec(this.x, this.y);\r\n\r\n    this.onPostUpdate(engine, delta);\r\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\r\n  }\r\n\r\n  /**\r\n   * Draws the tile map to the screen. Called by the [[Scene]].\r\n   * @param ctx CanvasRenderingContext2D or ExcaliburGraphicsContext\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext, delta: number): void {\r\n    this.emit('predraw', new Events.PreDrawEvent(ctx as any, delta, this)); // TODO fix event\r\n\r\n    let x = this._onScreenXStart;\r\n    const xEnd = Math.min(this._onScreenXEnd, this.cols);\r\n    let y = this._onScreenYStart;\r\n    const yEnd = Math.min(this._onScreenYEnd, this.rows);\r\n\r\n    let graphics: Graphics.Graphic[], graphicsIndex: number, graphicsLen: number;\r\n\r\n    for (x; x < xEnd; x++) {\r\n      for (y; y < yEnd; y++) {\r\n        // get non-negative tile sprites\r\n        graphics = this.getCell(x, y).graphics;\r\n\r\n        for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\r\n          // draw sprite, warning if sprite doesn't exist\r\n          const graphic = graphics[graphicsIndex];\r\n          if (graphic) {\r\n            if (!(ctx instanceof CanvasRenderingContext2D)) {\r\n              if (hasGraphicsTick(graphic)) {\r\n                graphic?.tick(delta, this._token);\r\n              }\r\n              graphic.draw(ctx, x * this.cellWidth, y * this.cellHeight);\r\n            } else if (graphic instanceof Graphics.Sprite) {\r\n              // TODO legacy drawing mode\r\n              if (!this._legacySpriteMap.has(graphic)) {\r\n                this._legacySpriteMap.set(graphic, Graphics.Sprite.toLegacySprite(graphic));\r\n              }\r\n              this._legacySpriteMap.get(graphic).draw(ctx, x * this.cellWidth, y * this.cellHeight);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      y = this._onScreenYStart;\r\n    }\r\n\r\n    this.emit('postdraw', new Events.PostDrawEvent(ctx as any, delta, this));\r\n  }\r\n}\r\n\r\nexport interface TileMapArgs extends Partial<TileMapImpl> {\r\n  x: number;\r\n  y: number;\r\n  cellWidth: number;\r\n  cellHeight: number;\r\n  rows: number;\r\n  cols: number;\r\n}\r\n\r\n/**\r\n * The [[TileMap]] class provides a lightweight way to do large complex scenes with collision\r\n * without the overhead of actors.\r\n */\r\nexport class TileMap extends Configurable(TileMapImpl) {\r\n  constructor(config: TileMapArgs);\r\n  constructor(x: number, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number);\r\n  constructor(xOrConfig: number | TileMapArgs, y?: number, cellWidth?: number, cellHeight?: number, rows?: number, cols?: number) {\r\n    super(xOrConfig, y, cellWidth, cellHeight, rows, cols);\r\n  }\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class CellImpl extends Entity {\r\n  private _bounds: BoundingBox;\r\n  /**\r\n   * World space x coordinate of the left of the cell\r\n   */\r\n  public readonly x: number;\r\n  /**\r\n   * World space y coordinate of the top of the cell\r\n   */\r\n  public readonly y: number;\r\n  /**\r\n   * Width of the cell in pixels\r\n   */\r\n  public readonly width: number;\r\n  /**\r\n   * Height of the cell in pixels\r\n   */\r\n  public readonly height: number;\r\n  /**\r\n   * Current index in the tilemap\r\n   */\r\n  public readonly index: number;\r\n\r\n  /**\r\n   * Reference to the TileMap this Cell is associated with\r\n   */\r\n  public map: TileMap;\r\n\r\n  private _solid = false;\r\n  /**\r\n   * Wether this cell should be treated as solid by the tilemap\r\n   */\r\n  public get solid(): boolean {\r\n    return this._solid;\r\n  }\r\n  /**\r\n   * Wether this cell should be treated as solid by the tilemap\r\n   */\r\n  public set solid(val: boolean) {\r\n    this.map?.flagDirty();\r\n    this._solid = val;\r\n  }\r\n  /**\r\n   * Current list of graphics for this cell\r\n   */\r\n  public readonly graphics: Graphics.Graphic[] = [];\r\n  /**\r\n   * Abitrary data storage per cell, useful for any game specific data\r\n   */\r\n  public data = new Map<string, any>();\r\n\r\n  /**\r\n   * @param xOrConfig Gets or sets x coordinate of the cell in world coordinates or cell option bag\r\n   * @param y       Gets or sets y coordinate of the cell in world coordinates\r\n   * @param width   Gets or sets the width of the cell\r\n   * @param height  Gets or sets the height of the cell\r\n   * @param index   The index of the cell in row major order\r\n   * @param solid   Gets or sets whether this cell is solid\r\n   * @param graphics The list of tile graphics to use to draw in this cell (in order)\r\n   */\r\n  constructor(\r\n    xOrConfig: number | CellArgs,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n    index: number,\r\n    solid: boolean = false,\r\n    graphics: Graphics.Graphic[] = []\r\n  ) {\r\n    super();\r\n    if (xOrConfig && typeof xOrConfig === 'object') {\r\n      const config = xOrConfig;\r\n      xOrConfig = config.x;\r\n      y = config.y;\r\n      width = config.width;\r\n      height = config.height;\r\n      index = config.index;\r\n      solid = config.solid;\r\n      graphics = config.sprites;\r\n    }\r\n    this.x = <number>xOrConfig;\r\n    this.y = y;\r\n    this.width = width;\r\n    this.height = height;\r\n    this.index = index;\r\n    this.solid = solid;\r\n    this.graphics = graphics;\r\n    this._bounds = new BoundingBox(this.x, this.y, this.x + this.width, this.y + this.height);\r\n  }\r\n\r\n  public get bounds() {\r\n    return this._bounds;\r\n  }\r\n\r\n  public get center(): Vector {\r\n    return new Vector(this.x + this.width / 2, this.y + this.height / 2);\r\n  }\r\n\r\n  /**\r\n   * Add another [[Sprite]] to this cell\r\n   * @deprecated Use addSprite, will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'addSprite' })\r\n  public pushSprite(sprite: Graphics.Sprite | LegacySprite) {\r\n    this.addGraphic(sprite);\r\n  }\r\n\r\n  /**\r\n   * Add another [[Graphic]] to this TileMap cell\r\n   * @param graphic\r\n   */\r\n  public addGraphic(graphic: Graphics.Graphic | LegacySprite) {\r\n    if (graphic instanceof LegacySprite) {\r\n      this.graphics.push(Graphics.Sprite.fromLegacySprite(graphic));\r\n    } else {\r\n      this.graphics.push(graphic);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an instance of a [[Graphic]] from this cell\r\n   */\r\n  public removeGraphic(graphic: Graphics.Graphic | LegacySprite) {\r\n    removeItemFromArray(graphic, this.graphics);\r\n  }\r\n\r\n  /**\r\n   * Clear all graphis from this cell\r\n   */\r\n  public clearGraphics() {\r\n    this.graphics.length = 0;\r\n  }\r\n}\r\n\r\nexport interface CellArgs extends Partial<CellImpl> {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  index: number;\r\n  solid?: boolean;\r\n  sprites?: Graphics.Sprite[];\r\n}\r\n\r\n/**\r\n * TileMap Cell\r\n *\r\n * A light-weight object that occupies a space in a collision map. Generally\r\n * created by a [[TileMap]].\r\n *\r\n * Cells can draw multiple sprites. Note that the order of drawing is the order\r\n * of the sprites in the array so the last one will be drawn on top. You can\r\n * use transparency to create layers this way.\r\n */\r\nexport class Cell extends Configurable(CellImpl) {\r\n  constructor(config: CellArgs);\r\n  constructor(x: number, y: number, width: number, height: number, index: number, solid?: boolean, sprites?: Graphics.Sprite[]);\r\n  constructor(\r\n    xOrConfig: number | CellArgs,\r\n    y?: number,\r\n    width?: number,\r\n    height?: number,\r\n    index?: number,\r\n    solid?: boolean,\r\n    sprites?: Graphics.Sprite[]\r\n  ) {\r\n    super(xOrConfig, y, width, height, index, solid, sprites);\r\n  }\r\n}\r\n","import { Actor } from '../Actor';\r\nimport { ScreenElement } from '../ScreenElement';\r\nimport { Label } from '../Label';\r\nimport { Trigger } from '../Trigger';\r\n\r\n/**\r\n * Type guard to detect if something is an actor\r\n * @deprecated Will be removed in v0.26.0\r\n * @param actor\r\n */\r\nexport function isVanillaActor(actor: Actor) {\r\n  return !(actor instanceof ScreenElement) && !(actor instanceof Trigger) && !(actor instanceof Label);\r\n}\r\n\r\n/**\r\n * Type guard to detect a screen element\r\n * @todo move to ScreenElement\r\n */\r\nexport function isScreenElement(actor: Actor) {\r\n  return actor instanceof ScreenElement;\r\n}\r\n","import { Color } from './Color';\nimport { Engine } from './Engine';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Vector } from './Math/vector';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport * as Util from './Util/Util';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Entity } from './EntityComponentSystem';\nimport { Actor } from './Actor';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Entity;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Entity) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n */\nexport class Trigger extends Actor {\n  private _target: Entity;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Entity) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super({ x: opts.pos.x, y: opts.pos.y, width: opts.width, height: opts.height });\n    opts = Util.extend({}, triggerDefaults, opts);\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.graphics.visible = opts.visible;\n    this.body.collisionType = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher(this);\n\n    this.events.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.events.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Entity) {\n    this._target = target;\n    this.filter = (actor: Entity) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    if (this.repeat !== 0) {\n      this.action.call(this);\n      this.repeat--;\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.collider.bounds;\n    const wp = this.getGlobalPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Entity } from './Entity';\r\nimport { Message, Observer } from '../Util/Observable';\r\nimport { Component } from './Component';\r\nimport { Scene } from '../Scene';\r\n\r\n/**\r\n * Enum that determines whether to run the system in the update or draw phase\r\n */\r\nexport enum SystemType {\r\n  Update = 'update',\r\n  Draw = 'draw'\r\n}\r\n\r\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * An Excalibur [[System]] that updates entities of certain types.\r\n * Systems are scene specific\r\n *\r\n * Excalibur Systems currently require at least 1 Component type to operated\r\n *\r\n * Multiple types are declared as a type union\r\n * For example:\r\n *\r\n * ```typescript\r\n * class MySystem extends System<ComponentA | ComponentB> {\r\n *   public readonly types = ['a', 'b'] as const;\r\n *   public readonly systemType = SystemType.Update;\r\n *   public update(entities: Entity<ComponentA | ComponentB>) {\r\n *      ...\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\r\nimplements Observer<AddedEntity | RemovedEntity> {\r\n  /**\r\n   * The types of entities that this system operates on\r\n   * For example ['transform', 'motion']\r\n   */\r\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\r\n\r\n  /**\r\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\r\n   */\r\n  abstract readonly systemType: SystemType;\r\n\r\n  /**\r\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\r\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\r\n   * For a system to exectue after all other a higher priority value (10 for example) must be set.\r\n   */\r\n  public priority: number = 0;\r\n\r\n  /**\r\n   * Optionally specify a sort order for entities passed to the your system\r\n   * @param a The left entity\r\n   * @param b The right entity\r\n   */\r\n  sort?(a: Entity, b: Entity): number;\r\n\r\n  /**\r\n   * Optionally specify an initialize handler\r\n   * @param scene\r\n   */\r\n  initialize?(engine: ContextType): void;\r\n\r\n  /**\r\n   * Update all entities that match this system's types\r\n   * @param entities Entities to update that match this system's types\r\n   * @param delta Time in milliseconds\r\n   */\r\n  abstract update(entities: Entity[], delta: number): void;\r\n\r\n  /**\r\n   * Optionally run a preupdate before the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  preupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Optionally run a postupdate after the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  postupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Systems observe when entities match their types or no longer match their types, override\r\n   * @param _entityAddedOrRemoved\r\n   */\r\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\r\n    // Override me\r\n  }\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\r\n */\r\nexport class AddedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Added' = 'Entity Added';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * Type guard to check for AddedEntity messages\r\n * @param x\r\n */\r\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\r\n  return !!x && x.type === 'Entity Added';\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\r\n */\r\nexport class RemovedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Removed' = 'Entity Removed';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * type guard to check for the RemovedEntity message\r\n */\r\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\r\n  return !!x && x.type === 'Entity Removed';\r\n}\r\n","import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\r\nimport { Observer } from '../Util/Observable';\r\nimport { World } from './World';\r\nimport { Util } from '..';\r\n\r\n// Add/Remove entitys and components\r\n\r\nexport class EntityManager<ContextType = any> implements Observer<RemovedComponent | AddedComponent> {\r\n  public entities: Entity[] = [];\r\n  public _entityIndex: { [entityId: string]: Entity } = {};\r\n\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Runs the entity lifecycle\r\n   * @param _context\r\n   */\r\n  public updateEntities(_context: ContextType, elapsed: number) {\r\n    for (const entity of this.entities) {\r\n      // TODO is this right?\r\n      entity.update((_context as any).engine, elapsed);\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  public findEntitiesForRemoval() {\r\n    for (const entity of this.entities) {\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * EntityManager observes changes on entities\r\n   * @param message\r\n   */\r\n  public notify(message: RemovedComponent | AddedComponent): void {\r\n    if (isAddedComponent(message)) {\r\n      // we don't need the component, it's already on the entity\r\n      this._world.queryManager.addEntity(message.data.entity);\r\n    }\r\n\r\n    if (isRemovedComponent(message)) {\r\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be tracked by the EntityManager\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    entity.active = true;\r\n    if (entity && !this._entityIndex[entity.id]) {\r\n      this._entityIndex[entity.id] = entity;\r\n      this.entities.push(entity);\r\n      this._world.queryManager.addEntity(entity);\r\n      entity.componentAdded$.register(this);\r\n      entity.componentRemoved$.register(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.addEntity(c));\r\n      entity.childrenAdded$.register({\r\n        notify: (e) => {\r\n          this.addEntity(e);\r\n        }\r\n      });\r\n      entity.childrenRemoved$.register({\r\n        notify: (e) => {\r\n          this.removeEntity(e, false);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  public removeEntity(entity: Entity, deferred?: boolean): void;\r\n  public removeEntity(id: number, deferred?: boolean): void;\r\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\r\n    let id = 0;\r\n    if (idOrEntity instanceof Entity) {\r\n      id = idOrEntity.id;\r\n    } else {\r\n      id = idOrEntity;\r\n    }\r\n    const entity = this._entityIndex[id];\r\n    if (entity && entity.active) {\r\n      entity.kill();\r\n    }\r\n\r\n    if (entity && deferred) {\r\n      this._entitiesToRemove.push(entity);\r\n      return;\r\n    }\r\n\r\n    delete this._entityIndex[id];\r\n    if (entity) {\r\n      Util.removeItemFromArray(entity, this.entities);\r\n      this._world.queryManager.removeEntity(entity);\r\n      entity.componentAdded$.unregister(this);\r\n      entity.componentRemoved$.unregister(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.removeEntity(c, deferred));\r\n      entity.childrenAdded$.clear();\r\n      entity.childrenRemoved$.clear();\r\n\r\n      // stats\r\n      if ((this._world.context as any)?.engine) {\r\n        (this._world.context as any).engine.stats.currFrame.actors.killed++;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _entitiesToRemove: Entity[] = [];\r\n  public processEntityRemovals(): void {\r\n    for (const entity of this._entitiesToRemove) {\r\n      if (entity.active) {\r\n        continue;\r\n      }\r\n      this.removeEntity(entity, false);\r\n    }\r\n  }\r\n\r\n  public processComponentRemovals(): void {\r\n    for (const entity of this.entities) {\r\n      entity.processComponentRemoval();\r\n    }\r\n  }\r\n\r\n  public getById(id: number): Entity {\r\n    return this._entityIndex[id];\r\n  }\r\n\r\n  public getByName(name: string): Entity[]{\r\n    return this.entities.filter(e => e.name === name);\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const entity of this.entities) {\r\n      this.removeEntity(entity);\r\n    }\r\n  }\r\n}\r\n","export const buildTypeKey = (types: readonly string[]) => {\r\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\r\n  return key;\r\n};\r\n","import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Observable } from '../Util/Observable';\r\nimport { Util, Component, ComponentCtor } from '..';\r\nimport { AddedEntity, RemovedEntity } from './System';\r\n\r\n/**\r\n * Represents query for entities that match a list of types that is cached and observable\r\n *\r\n * Queries can be strongly typed by supplying a type union in the optional type parameter\r\n * ```typescript\r\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\r\n * ```\r\n */\r\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\r\n  public types: readonly string[];\r\n  private _entities: Entity[] = [];\r\n  private _key: string;\r\n  public get key(): string {\r\n    if (this._key) {\r\n      return this._key;\r\n    }\r\n    return (this._key = buildTypeKey(this.types));\r\n  }\r\n\r\n  constructor(types: readonly string[]);\r\n  constructor(types: readonly ComponentCtor<T>[]);\r\n  constructor(types: readonly string[] | readonly ComponentCtor<T>[]) {\r\n    super();\r\n    if (types[0] instanceof Function) {\r\n      this.types = (types as ComponentCtor<T>[]).map(T =>  (new T).type);\r\n    } else {\r\n      this.types = types as string[];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   *\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity[] {\r\n    if (sort) {\r\n      this._entities.sort(sort);\r\n    }\r\n    return this._entities;\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the query, will only be added if the entity matches the query types\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\r\n      this._entities.push(entity);\r\n      this.notifyAll(new AddedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the entity is part of the query it will be removed regardless of types\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity): void {\r\n    if (Util.removeItemFromArray(entity, this._entities)) {\r\n      this.notifyAll(new RemovedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all entities and observers from the query\r\n   */\r\n  public clear(): void {\r\n    this._entities.length = 0;\r\n    for (const observer of this.observers) {\r\n      this.unregister(observer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns whether the entity's types match query\r\n   * @param entity\r\n   */\r\n  public matches(entity: Entity): boolean;\r\n\r\n  /**\r\n   * Returns whether the list of ComponentTypes have at least the same types as the query\r\n   * @param types\r\n   */\r\n  public matches(types: string[]): boolean;\r\n  public matches(typesOrEntity: string[] | Entity): boolean {\r\n    let types: string[] = [];\r\n    if (typesOrEntity instanceof Entity) {\r\n      types = typesOrEntity.types;\r\n    } else {\r\n      types = typesOrEntity;\r\n    }\r\n\r\n    let matches = true;\r\n    for (const type of this.types) {\r\n      matches = matches && types.indexOf(type) > -1;\r\n      if (!matches) {\r\n        return false;\r\n      }\r\n    }\r\n    return matches;\r\n  }\r\n\r\n  public contain(type: string) {\r\n    return this.types.indexOf(type) > -1;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Query } from './Query';\r\nimport { Component } from './Component';\r\nimport { World } from './World';\r\n\r\n/**\r\n * The query manager is responsible for updating all queries when entities/components change\r\n */\r\nexport class QueryManager {\r\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\r\n\r\n  constructor(private _world: World<any>) {}\r\n\r\n  /**\r\n   * Adds a query to the manager and populates with any entities that match\r\n   * @param query\r\n   */\r\n  private _addQuery(query: Query<any>) {\r\n    this._queries[buildTypeKey(query.types)] = query;\r\n    for (const entity of this._world.entityManager.entities) {\r\n      query.addEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes the query if there are no observers left\r\n   * @param query\r\n   */\r\n  public maybeRemoveQuery(query: Query): void {\r\n    if (query.observers.length === 0) {\r\n      query.clear();\r\n      delete this._queries[buildTypeKey(query.types)];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds the entity to any matching query in the query manage\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      if (this._queries[queryType]) {\r\n        this._queries[queryType].addEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from queries if the removed component disqualifies it\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  public removeComponent(entity: Entity, component: Component) {\r\n    for (const queryType in this._queries) {\r\n      // If the component being removed from an entity is a part of a query,\r\n      // it is now disqualified from that query, remove it\r\n      if (this._queries[queryType].contain(component.type)) {\r\n        this._queries[queryType].removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from all queries it is currently a part of\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      this._queries[queryType].removeEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\r\n   * @param types\r\n   */\r\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const maybeExistingQuery = this.getQuery<T>(types);\r\n    if (maybeExistingQuery) {\r\n      return maybeExistingQuery;\r\n    }\r\n    const query = new Query<T>(types);\r\n    this._addQuery(query);\r\n    return query;\r\n  }\r\n\r\n  /**\r\n   * Retrieves an existing query by types if it exists otherwise returns null\r\n   * @param types\r\n   */\r\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const key = buildTypeKey(types);\r\n    if (this._queries[key]) {\r\n      return this._queries[key] as Query<T>;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { System, SystemType } from './System';\r\nimport { Scene, Util } from '..';\r\nimport { World } from './World';\r\n\r\nexport interface SystemCtor<T extends System> {\r\n  new (): T;\r\n}\r\n\r\n/**\r\n * The SystemManager is responsible for keeping track of all systems in a scene.\r\n * Systems are scene specific\r\n */\r\nexport class SystemManager<ContextType> {\r\n  /**\r\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\r\n   */\r\n  public systems: System<any, ContextType>[] = [];\r\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\r\n  public initialized = false;\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Get a system registered in the manager by type\r\n   * @param systemType\r\n   * @returns\r\n   */\r\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\r\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\r\n  }\r\n\r\n  /**\r\n   * Adds a system to the manager, it will now be updated every frame\r\n   * @param system\r\n   */\r\n  public addSystem(system: System<any, ContextType>): void {\r\n    // validate system has types\r\n    if (!system.types || system.types.length === 0) {\r\n      throw new Error(`Attempted to add a System without any types`);\r\n    }\r\n\r\n    const query = this._world.queryManager.createQuery(system.types);\r\n    this.systems.push(system);\r\n    this.systems.sort((a, b) => a.priority - b.priority);\r\n    query.register(system);\r\n    if (this.initialized && system.initialize) {\r\n      system.initialize(this._world.context);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a system from the manager, it will no longer be updated\r\n   * @param system\r\n   */\r\n  public removeSystem(system: System<any, ContextType>) {\r\n    Util.removeItemFromArray(system, this.systems);\r\n    const query = this._world.queryManager.getQuery(system.types);\r\n    if (query) {\r\n      query.unregister(system);\r\n      this._world.queryManager.maybeRemoveQuery(query);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates all systems\r\n   * @param type whether this is an update or draw system\r\n   * @param context context reference\r\n   * @param delta time in milliseconds\r\n   */\r\n  public updateSystems(type: SystemType, context: ContextType, delta: number) {\r\n    if (!this.initialized) {\r\n      this.initialized = true;\r\n      for (const s of this.systems) {\r\n        if (s.initialize) {\r\n          s.initialize(this._world.context);\r\n        }\r\n      }\r\n    }\r\n\r\n    const systems = this.systems.filter((s) => s.systemType === type);\r\n    for (const s of systems) {\r\n      if (s.preupdate) {\r\n        s.preupdate(context, delta);\r\n      }\r\n    }\r\n\r\n    for (const s of systems) {\r\n      // Get entities that match the system types, pre-sort\r\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\r\n      // Initialize entities if needed\r\n      if (context instanceof Scene) {\r\n        for (const entity of entities) {\r\n          entity._initialize(context?.engine);\r\n        }\r\n      }\r\n      s.update(entities, delta);\r\n    }\r\n\r\n    for (const s of systems) {\r\n      if (s.postupdate) {\r\n        s.postupdate(context, delta);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const system of this.systems) {\r\n      this.removeSystem(system);\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { EntityManager } from './EntityManager';\r\nimport { QueryManager } from './QueryManager';\r\nimport { System, SystemType } from './System';\r\nimport { SystemManager } from './SystemManager';\r\n\r\n/**\r\n * The World is a self-contained entity component system for a particular context.\r\n */\r\nexport class World<ContextType> {\r\n  public queryManager: QueryManager = new QueryManager(this);\r\n  public entityManager: EntityManager<ContextType> = new EntityManager<ContextType>(this);\r\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\r\n\r\n  /**\r\n   * The context type is passed to the system updates\r\n   * @param context\r\n   */\r\n  constructor(public context: ContextType) {}\r\n\r\n  /**\r\n   * Update systems by type and time elapsed in milliseconds\r\n   */\r\n  update(type: SystemType, delta: number) {\r\n    if (type === SystemType.Update) {\r\n      this.entityManager.updateEntities(this.context, delta);\r\n    }\r\n    this.systemManager.updateSystems(type, this.context, delta);\r\n    this.entityManager.findEntitiesForRemoval();\r\n    this.entityManager.processComponentRemovals();\r\n    this.entityManager.processEntityRemovals();\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the ECS world\r\n   * @param entity\r\n   */\r\n  add(entity: Entity): void;\r\n  /**\r\n   * Add a system to the ECS world\r\n   * @param system\r\n   */\r\n  add(system: System<any, ContextType>): void;\r\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.addEntity(entityOrSystem);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.addSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from the ECS world\r\n   * @param entity\r\n   */\r\n  remove(entity: Entity, deferred?: boolean): void;\r\n  /**\r\n   * Remove a system from the ECS world\r\n   * @param system\r\n   */\r\n  remove(system: System<any, ContextType>): void;\r\n  remove(entityOrSystem: Entity | System<any, ContextType>, deferred = true): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.removeEntity(entityOrSystem, deferred);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.removeSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  clearEntities(): void {\r\n    this.entityManager.clear();\r\n  }\r\n\r\n  clearSystems(): void {\r\n    this.systemManager.clear();\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\n\nexport class EulerIntegrator {\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsedMs: number): void {\n    const seconds = elapsedMs / 1000;\n    motion.vel.addEqual(totalAcc.scale(seconds));\n    transform.pos.addEqual(motion.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n    transform.rotation += motion.angularVelocity * seconds;\n\n    transform.scale.addEqual(motion.scaleFactor.scale(seconds));\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { Physics } from './Physics';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { CollisionType } from './CollisionType';\r\nimport { EulerIntegrator } from './Integrator';\r\n\r\nexport class MotionSystem extends System<TransformComponent | MotionComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  update(_entities: Entity[], elapsedMs: number): void {\r\n    let transform: TransformComponent;\r\n    let motion: MotionComponent;\r\n    for (const entity of _entities) {\r\n      transform = entity.get(TransformComponent);\r\n      motion = entity.get(MotionComponent);\r\n\r\n      const optionalBody = entity.get(BodyComponent);\r\n      if (optionalBody?.sleeping) {\r\n        continue;\r\n      }\r\n\r\n      const totalAcc = motion.acc.clone();\r\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\r\n        totalAcc.addEqual(Physics.gravity);\r\n      }\r\n      optionalBody?.captureOldTransform();\r\n\r\n      // Update transform and motion based on Euler linear algebra\r\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs);\r\n    }\r\n  }\r\n\r\n  debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n}\r\n","import { CollisionContact } from '../Detection/CollisionContact';\r\n\r\n/**\r\n * A collision solver figures out how to position colliders such that they are no longer overlapping\r\n *\r\n * Solvers are executed in the order\r\n *\r\n * 1. preSolve\r\n * 2. solveVelocity\r\n * 3. solvePosition\r\n * 4. postSolve\r\n * @inheritdoc\r\n */\r\nexport abstract class CollisionSolver {\r\n  /**\r\n   * Pre-solve is fired on contacts before any resolution is started. It is used for any setup work before collision resolution\r\n   * can proceed. Optionally contacts can be \"opted out\" of any collision processing by calling `contact.cancel()`\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract preSolve(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Post-solve is fired after all resolution is complete\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract postSolve(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solve velocity adjusts the velocity of colliders so that they are not overlapping or will not be overlapping from velocity\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract solveVelocity(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solve position adjust the position of collders so that they are not overlapping\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract solvePosition(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solves overlapping contact in\r\n   *\r\n   * Solvers are executed in the order\r\n   * 1. preSolve\r\n   * 2. solveVelocity\r\n   * 3. solvePosition\r\n   * 4. postSolve\r\n   * @param contacts\r\n   */\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter(c => !c.isCanceled());\r\n\r\n    // Solve velocity first\r\n    this.solveVelocity(contacts);\r\n\r\n    // Solve position last because non-overlap is the most important\r\n    this.solvePosition(contacts);\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n}","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\r\n * and negates velocity along the collision normal.\r\n *\r\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\r\n *\r\n */\r\nexport class ArcadeSolver extends CollisionSolver {\r\n  public preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n      }\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public solvePosition(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      let mtv = contact.mtv;\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\r\n          // split overlaps if both are Active\r\n          mtv = mtv.scale(0.5);\r\n        }\r\n\r\n        // Resolve overlaps\r\n        if (bodyA.collisionType === CollisionType.Active) {\r\n          bodyA.pos.x -= mtv.x;\r\n          bodyA.pos.y -= mtv.y;\r\n        }\r\n\r\n        if (bodyB.collisionType === CollisionType.Active) {\r\n          bodyB.pos.x += mtv.x;\r\n          bodyB.pos.y += mtv.y;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public solveVelocity(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        const normal = contact.normal;\r\n        const opposite = normal.negate();\r\n\r\n        // Cancel out velocity opposite direction of collision normal\r\n        if (bodyA.collisionType === CollisionType.Active) {\r\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\r\n          bodyA.vel = bodyA.vel.add(velAdj);\r\n        }\r\n\r\n        if (bodyB.collisionType === CollisionType.Active) {\r\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\r\n          bodyB.vel = bodyB.vel.add(velAdj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * Holds information about contact points, meant to be reused over multiple frames of contact\n */\nexport class ContactConstraintPoint {\n  constructor(public point: Vector, public local: Vector, public contact: CollisionContact) {\n    this.update();\n  }\n\n  /**\n   * Updates the contact information\n   */\n  update() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n\n    if (bodyA && bodyB) {\n      const normal = this.contact.normal;\n      const tangent = this.contact.tangent;\n\n      this.aToContact = this.point.sub(bodyA.pos);\n      this.bToContact = this.point.sub(bodyB.pos);\n\n      const aToContactNormal = this.aToContact.cross(normal);\n      const bToContactNormal = this.bToContact.cross(normal);\n\n      this.normalMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n      const aToContactTangent = this.aToContact.cross(tangent);\n      const bToContactTangent = this.bToContact.cross(tangent);\n\n      this.tangentMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n    }\n\n    return this;\n  }\n\n  /**\n   * Returns the relative velocity betwen bodyA and bodyB\n   */\n  public getRelativeVelocity() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n    if (bodyA && bodyB) {\n      // Relative velocity in linear terms\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\n      return velB.sub(velA);\n    }\n    return Vector.Zero;\n  }\n\n  /**\n   * Impulse accumulated over time in normal direction\n   */\n  public normalImpulse: number = 0;\n\n  /**\n   * Impulse accumulated over time in the tangent direction\n   */\n  public tangentImpulse: number = 0;\n\n  /**\n   * Effective mass seen in the normal direction\n   */\n  public normalMass: number = 0;\n\n  /**\n   * Effective mass seen in the tangent direction\n   */\n  public tangentMass: number = 0;\n\n  /**\n   * Direction from center of mass of bodyA to contact point\n   */\n  public aToContact: Vector = new Vector(0, 0);\n\n  /**\n   * Direction from center of mass of bodyB to contact point\n   */\n  public bToContact: Vector = new Vector(0, 0);\n}\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { clamp } from '../../Util/Util';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\r\nimport { Side } from '../Side';\r\nimport { Physics } from '../Physics';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\r\n\r\nexport class RealisticSolver extends CollisionSolver {\r\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\r\n\r\n  // map contact id to contact points\r\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\r\n\r\n  getContactConstraints(id: string) {\r\n    return this.idToContactConstraint.get(id) ?? [];\r\n  }\r\n\r\n  preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n\r\n      // Match awake state for sleeping\r\n      contact.matchAwake();\r\n    }\r\n\r\n    // Keep track of contacts that done\r\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\r\n    for (const contact of contacts) {\r\n      // Remove all current contacts that are not done\r\n      const index = finishedContactIds.indexOf(contact.id);\r\n      if (index > -1) {\r\n        finishedContactIds.splice(index, 1);\r\n      }\r\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n      let pointIndex = 0;\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        for (const point of contact.points) {\r\n          const normal = contact.normal;\r\n          const tangent = contact.tangent;\r\n\r\n          const aToContact = point.sub(bodyA.pos);\r\n          const bToContact = point.sub(bodyB.pos);\r\n\r\n          const aToContactNormal = aToContact.cross(normal);\r\n          const bToContactNormal = bToContact.cross(normal);\r\n\r\n          const normalMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n          const aToContactTangent = aToContact.cross(tangent);\r\n          const bToContactTangent = bToContact.cross(tangent);\r\n\r\n          const tangentMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n\r\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\r\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\r\n            contactPoints[pointIndex].point = point;\r\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\r\n          } else {\r\n            // new contact if it's not close or doesn't exist\r\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\r\n          }\r\n\r\n          // Update contact point calculations\r\n          contactPoints[pointIndex].aToContact = aToContact;\r\n          contactPoints[pointIndex].bToContact = bToContact;\r\n          contactPoints[pointIndex].normalMass = normalMass;\r\n          contactPoints[pointIndex].tangentMass = tangentMass;\r\n\r\n          pointIndex++;\r\n        }\r\n      }\r\n      this.idToContactConstraint.set(contact.id, contactPoints);\r\n    }\r\n\r\n    // Clean up any contacts that did not occur last frame\r\n    for (const id of finishedContactIds) {\r\n      this.idToContactConstraint.delete(id);\r\n    }\r\n\r\n    // Warm contacts with accumulated impulse\r\n    // Useful for tall stacks\r\n    if (Physics.warmStart) {\r\n      this.warmStart(contacts);\r\n    } else {\r\n      for (const contact of contacts) {\r\n        const contactPoints = this.getContactConstraints(contact.id);\r\n        for (const point of contactPoints) {\r\n          point.normalImpulse = 0;\r\n          point.tangentImpulse = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n        // Skip post solve for active+passive collisions\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        // Update motion values for sleeping\r\n        bodyA.updateMotion();\r\n        bodyB.updateMotion();\r\n      }\r\n\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n    }\r\n\r\n    // Store contacts\r\n    this.lastFrameContacts.clear();\r\n    for (const c of contacts) {\r\n      this.lastFrameContacts.set(c.id, c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Warm up body's based on previous frame contact points\r\n   * @param contacts\r\n   */\r\n  warmStart(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n        for (const point of contactPoints) {\r\n          if (Physics.warmStart) {\r\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\r\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\r\n            const impulse = normalImpulse.add(tangentImpulse);\r\n\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          } else {\r\n            point.normalImpulse = 0;\r\n            point.tangentImpulse = 0;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Iteratively solve the position overlap constraint\r\n   * @param contacts\r\n   */\r\n  solvePosition(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.positionIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n          for (const point of constraints) {\r\n            const normal = contact.normal;\r\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\r\n\r\n            const steeringConstant = Physics.steeringFactor; //0.2;\r\n            const maxCorrection = -5;\r\n            const slop = Physics.slop; //1;\r\n\r\n            // Clamp to avoid over-correction\r\n            // Remember that we are shooting for 0 overlap in the end\r\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\r\n            const impulse = normal.scale(-steeringForce / point.normalMass);\r\n\r\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\r\n            // We adjust position and rotation instead of doing the velocity\r\n            if (bodyA.collisionType === CollisionType.Active) {\r\n              bodyA.pos = bodyA.pos.add(impulse.negate().scale(bodyA.inverseMass));\r\n              bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\r\n            }\r\n\r\n            if (bodyB.collisionType === CollisionType.Active) {\r\n              bodyB.pos = bodyB.pos.add(impulse.scale(bodyB.inverseMass));\r\n              bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  solveVelocity(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.velocityIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const restitution = bodyA.bounciness * bodyB.bounciness;\r\n          const friction = Math.min(bodyA.friction, bodyB.friction);\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n          for (const point of constraints) {\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Negate velocity in tangent direction to simulate friction\r\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\r\n            let impulseDelta = tangentVelocity / point.tangentMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2006 talk\r\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\r\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\r\n            // But deltas can vary\r\n            const maxFriction = friction * point.normalImpulse;\r\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\r\n            impulseDelta = newImpulse - point.tangentImpulse;\r\n            point.tangentImpulse = newImpulse;\r\n\r\n            const impulse = contact.tangent.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n\r\n          for (const point of constraints) {\r\n            // Need to recalc relative velocity because the previous step could have changed vel\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Compute impulse in normal direction\r\n            const normalVelocity = relativeVelocity.dot(contact.normal);\r\n            // See https://en.wikipedia.org/wiki/Collision_response\r\n            let impulseDelta = (-(1 + restitution) * normalVelocity) / point.normalMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2014 talk\r\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\r\n            // But deltas can be negative\r\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\r\n            impulseDelta = newImpulse - point.normalImpulse;\r\n            point.normalImpulse = newImpulse;\r\n\r\n            const impulse = contact.normal.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\r\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\r\nimport { CollisionResolutionStrategy, Physics } from './Physics';\r\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { DynamicTreeCollisionProcessor } from './Detection/DynamicTreeCollisionProcessor';\r\nimport { RealisticSolver } from './Solver/RealisticSolver';\r\nimport { CollisionSolver } from './Solver/Solver';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { Engine, ExcaliburGraphicsContext, Scene } from '..';\r\n\r\nexport class CollisionSystem extends System<TransformComponent | MotionComponent | ColliderComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion', 'ex.collider'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  private _engine: Engine;\r\n  private _realisticSolver = new RealisticSolver();\r\n  private _arcadeSolver = new ArcadeSolver();\r\n  private _processor = new DynamicTreeCollisionProcessor();\r\n  private _lastFrameContacts = new Map<string, CollisionContact>();\r\n  private _currentFrameContacts = new Map<string, CollisionContact>();\r\n\r\n  private _trackCollider = (c: Collider) => this._processor.track(c);\r\n  private _untrackCollider = (c: Collider) => this._processor.untrack(c);\r\n\r\n  notify(message: AddedEntity | RemovedEntity) {\r\n    if (isAddedSystemEntity(message)) {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\r\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\r\n      const collider = colliderComponent.get();\r\n      if (collider) {\r\n        this._processor.track(collider);\r\n      }\r\n    } else {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      const collider = colliderComponent.get();\r\n      if (colliderComponent && collider) {\r\n        this._processor.untrack(collider);\r\n      }\r\n    }\r\n  }\r\n\r\n  initialize(scene: Scene) {\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  update(_entities: Entity[], elapsedMs: number): void {\r\n    if (!Physics.enabled) {\r\n      return;\r\n    }\r\n\r\n    // Collect up all the colliders\r\n    let colliders: Collider[] = [];\r\n    for (const entity of _entities) {\r\n      const colliderComp = entity.get(ColliderComponent);\r\n      const collider = colliderComp?.get();\r\n      if (colliderComp && colliderComp.owner?.active && collider) {\r\n        colliderComp.update();\r\n        if (collider instanceof CompositeCollider) {\r\n          colliders = colliders.concat(collider.getColliders());\r\n        } else {\r\n          colliders.push(collider);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update the spatial partitioning data structures\r\n    // TODO if collider invalid it will break the processor\r\n    // TODO rename \"update\" to something more specific\r\n    this._processor.update(colliders);\r\n\r\n    // Run broadphase on all colliders and locates potential collisions\r\n    const pairs = this._processor.broadphase(colliders, elapsedMs);\r\n\r\n    this._currentFrameContacts.clear();\r\n\r\n    // Given possible pairs find actual contacts\r\n    let contacts = this._processor.narrowphase(pairs, this._engine.debug.stats.currFrame);\r\n\r\n    const solver: CollisionSolver = this.getSolver();\r\n\r\n    // Solve, this resolves the position/velocity so entities arent overlapping\r\n    contacts = solver.solve(contacts);\r\n\r\n    // Record contacts\r\n    contacts.forEach((c) => this._currentFrameContacts.set(c.id, c));\r\n\r\n    // Emit contact start/end events\r\n    this.runContactStartEnd();\r\n\r\n    // reset the last frame cache\r\n    this._lastFrameContacts.clear();\r\n\r\n    // Keep track of collisions contacts that have started or ended\r\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\r\n  }\r\n\r\n  getSolver(): CollisionSolver {\r\n    return Physics.collisionResolutionStrategy === CollisionResolutionStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext) {\r\n    this._processor.debug(ex);\r\n  }\r\n\r\n  public runContactStartEnd() {\r\n    for (const [id, c] of this._currentFrameContacts) {\r\n      // find all new contacts\r\n      if (!this._lastFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, c));\r\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, c) as any);\r\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, c));\r\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, c) as any);\r\n      }\r\n    }\r\n\r\n    // find all contacts taht have ceased\r\n    for (const [id, c] of this._lastFrameContacts) {\r\n      if (!this._currentFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB));\r\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB) as any);\r\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA));\r\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA) as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { clamp } from '../Util/Util';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { Logger } from '../Util/Log';\r\nimport { Engine, LegacyDrawing } from '..';\r\nimport { Sprite } from '.';\r\n\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\nexport enum AnimationDirection {\r\n  /**\r\n   * Animation is playing forwards\r\n   */\r\n  Forward = 'forward',\r\n  /**\r\n   * Animation is play backwards\r\n   */\r\n  Backward = 'backward'\r\n}\r\n\r\nexport enum AnimationStrategy {\r\n  /**\r\n   * Animation ends without displaying anything\r\n   */\r\n  End = 'end',\r\n  /**\r\n   * Animation loops to the first frame after the last frame\r\n   */\r\n  Loop = 'loop',\r\n  /**\r\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\r\n   */\r\n  PingPong = 'pingpong',\r\n  /**\r\n   * Animation ends stopping on the last frame\r\n   */\r\n  Freeze = 'freeze'\r\n}\r\n\r\n/**\r\n * Frame of animation\r\n */\r\nexport interface Frame {\r\n  /**\r\n   * Optionally specify a graphic to show, no graphic shows an empty frame\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Optionally specify the number of ms the frame should be visible, overrids the animation duration (default 100 ms)\r\n   */\r\n  duration?: number;\r\n}\r\n\r\n/**\r\n * Animation options for building an animation via constructor.\r\n */\r\nexport interface AnimationOptions {\r\n  /**\r\n   * List of frames in the order you wish to play them\r\n   */\r\n  frames: Frame[];\r\n  /**\r\n   * Optionally reverse the direction of play\r\n   */\r\n  reverse?: boolean;\r\n  /**\r\n   * Optionally specify a default frame duration in ms (Default is 1000)\r\n   */\r\n  frameDuration?: number;\r\n  /**\r\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\r\n   */\r\n  totalDuration?: number;\r\n  /**\r\n   * Optionally specify the [[AnimationStrategy]] for the Animation\r\n   */\r\n  strategy?: AnimationStrategy;\r\n}\r\n\r\n// TODO wire up to new Emitter\r\nexport type AnimationEvents = {\r\n  frame: Frame;\r\n  loop: Animation;\r\n  ended: Animation;\r\n};\r\n\r\n/**\r\n * Create an Animation given a list of [[Frame|frames]] in [[AnimationOptions]]\r\n *\r\n * To create an Animation from a [[SpriteSheet]], use [[Animation.fromSpriteSheet]]\r\n */\r\nexport class Animation extends Graphic implements HasTick {\r\n  private static _LOGGER = Logger.getInstance();\r\n  public events = new EventDispatcher<any>(this); // TODO replace with new Emitter\r\n  public frames: Frame[] = [];\r\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\r\n  public frameDuration: number = 100;\r\n  public timeScale: number = 1;\r\n\r\n  private _idempotencyToken = -1;\r\n\r\n  private _firstTick = true;\r\n  private _currentFrame = 0;\r\n  private _timeLeftInFrame = 0;\r\n  private _direction = 1; // TODO only used in ping-pong\r\n  private _done = false;\r\n  private _playing = true;\r\n\r\n  constructor(options: GraphicOptions & AnimationOptions) {\r\n    super(options);\r\n    this.frames = options.frames;\r\n    this.strategy = options.strategy ?? this.strategy;\r\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\r\n    if (options.reverse) {\r\n      this.reverse();\r\n    }\r\n    this.goToFrame(0);\r\n  }\r\n\r\n  public clone(): Animation {\r\n    return new Animation({\r\n      frames: this.frames.map((f) => ({ ...f })),\r\n      frameDuration: this.frameDuration,\r\n      reverse: this._reversed,\r\n      strategy: this.strategy,\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create an Animation from a [[SpriteSheet]], a list of indices into the sprite sheet, a duration per frame\r\n   * and optional [[AnimationStrategy]]\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\r\n   * ```\r\n   *\r\n   * @param spriteSheet\r\n   * @param frameIndices\r\n   * @param durationPerFrameMs\r\n   * @param strategy\r\n   */\r\n  public static fromSpriteSheet(\r\n    spriteSheet: SpriteSheet,\r\n    frameIndices: number[],\r\n    durationPerFrameMs: number,\r\n    strategy: AnimationStrategy = AnimationStrategy.Loop\r\n  ): Animation {\r\n    const maxIndex = spriteSheet.sprites.length - 1;\r\n    const invalidIndices = frameIndices.filter((index) => index < 0 || index > maxIndex);\r\n    if (invalidIndices.length) {\r\n      Animation._LOGGER.warn(\r\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\r\n      );\r\n    }\r\n    return new Animation({\r\n      frames: spriteSheet.sprites\r\n        .filter((_, index) => frameIndices.indexOf(index) > -1)\r\n        .map((f) => ({\r\n          graphic: f,\r\n          duration: durationPerFrameMs\r\n        })),\r\n      strategy: strategy\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Converts an animation to a legacy animation\r\n   * @deprecated\r\n   * @param engine\r\n   * @param animation\r\n   * @returns LegacyDrawing.Animation\r\n   */\r\n  public static toLegacyAnimation(engine: Engine, animation: Animation): LegacyDrawing.Animation {\r\n    const legacySprites = animation.frames.map(f => Sprite.toLegacySprite(f.graphic as Sprite));\r\n    return new LegacyDrawing.Animation({\r\n      sprites: legacySprites,\r\n      loop: animation.strategy === AnimationStrategy.Loop,\r\n      freezeFrame: animation.strategy === AnimationStrategy.Freeze ? legacySprites.length - 1 : undefined,\r\n      speed: animation.frameDuration,\r\n      engine: engine\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the current Frame of the animation\r\n   */\r\n  public get currentFrame(): Frame | null {\r\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\r\n      return this.frames[this._currentFrame];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the current frame index of the animation\r\n   */\r\n  public get currentFrameIndex(): number {\r\n    return this._currentFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is playing\r\n   */\r\n  public get isPlaying(): boolean {\r\n    return this._playing;\r\n  }\r\n\r\n  private _reversed = false;\r\n  /**\r\n   * Reverses the play direction of the Animation, this preserves the current frame\r\n   */\r\n  public reverse(): void {\r\n    // Don't mutate with the original frame list, create a copy\r\n    this.frames = this.frames.slice().reverse();\r\n    this._reversed = !this._reversed;\r\n  }\r\n\r\n  /**\r\n   * Returns the current play direction of the animation\r\n   */\r\n  public get direction(): AnimationDirection {\r\n    // Keep logically consistent with ping-pong direction\r\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\r\n    const reversed = (this._reversed && this._direction === 1) ? true : false;\r\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\r\n  }\r\n\r\n  /**\r\n   * Plays or resumes the animation from the current frame\r\n   */\r\n  public play(): void {\r\n    this._playing = true;\r\n  }\r\n\r\n  /**\r\n   * Pauses the animation on the current frame\r\n   */\r\n  public pause(): void {\r\n    this._playing = false;\r\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\r\n  }\r\n\r\n  /**\r\n   * Reset the animation back to the beginning, including if the animation were done\r\n   */\r\n  public reset(): void {\r\n    this._done = false;\r\n    this._firstTick = true;\r\n    this._currentFrame = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation can end\r\n   */\r\n  public get canFinish(): boolean {\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.End:\r\n      case AnimationStrategy.Freeze: {\r\n        return true;\r\n      }\r\n      default: {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is done, for looping type animations\r\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\r\n   *\r\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\r\n   */\r\n  public get done(): boolean {\r\n    return this._done;\r\n  }\r\n\r\n  /**\r\n   * Jump the animation immediately to a specific frame if it exists\r\n   * @param frameNumber\r\n   */\r\n  public goToFrame(frameNumber: number) {\r\n    this._currentFrame = frameNumber;\r\n    this._timeLeftInFrame = this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame && !this._done) {\r\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\r\n      this.width = maybeFrame.graphic?.width;\r\n      this.height = maybeFrame.graphic?.height;\r\n      this.events.emit('frame', maybeFrame as any);\r\n    }\r\n  }\r\n\r\n  private _nextFrame(): number {\r\n    const currentFrame = this._currentFrame;\r\n    if (this._done) {\r\n      return currentFrame;\r\n    }\r\n    let next = -1;\r\n\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.Loop: {\r\n        next = (currentFrame + 1) % this.frames.length;\r\n        if (next === 0) {\r\n          this.events.emit('loop', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.End: {\r\n        next = currentFrame + 1;\r\n        if (next >= this.frames.length) {\r\n          this._done = true;\r\n          this._currentFrame = this.frames.length;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.Freeze: {\r\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\r\n        if (next >= this.frames.length - 1) {\r\n          this._done = true;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.PingPong: {\r\n        if (currentFrame + this._direction >= this.frames.length) {\r\n          this._direction = -1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        if (currentFrame + this._direction < 0) {\r\n          this._direction = 1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        next = currentFrame + (this._direction % this.frames.length);\r\n        break;\r\n      }\r\n    }\r\n    return next;\r\n  }\r\n\r\n  /**\r\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\r\n   * @param elapsedMilliseconds Milliseconds elapsed\r\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\r\n   */\r\n  public tick(elapsedMilliseconds: number, idempotencyToken: number = 0): void {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    if (!this._playing) {\r\n      return;\r\n    }\r\n\r\n    // if it's the first frame emit frame event\r\n    if (this._firstTick) {\r\n      this._firstTick = false;\r\n      this.events.emit('frame', this.currentFrame as any);\r\n    }\r\n\r\n    this._timeLeftInFrame -= elapsedMilliseconds * this.timeScale;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.goToFrame(this._nextFrame());\r\n    }\r\n    this._updateDimensions();\r\n  }\r\n\r\n  private _updateDimensions() {\r\n    if (this.currentFrame) {\r\n      this.width = this.currentFrame.graphic?.width;\r\n      this.height = this.currentFrame.graphic?.height;\r\n    }\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.currentFrame) {\r\n      this.currentFrame.graphic.draw(ctx, x, y);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Actor } from './Actor';\r\nimport { Color } from './Color';\r\nimport { Vector, vec } from './Math/vector';\r\nimport * as Util from './Util/Util';\r\nimport * as DrawUtil from './Util/DrawUtil';\r\nimport * as Traits from './Traits/Index';\r\nimport { Configurable } from './Configurable';\r\nimport { Random } from './Math/Random';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { CanvasDrawComponent } from './Drawing/Index';\r\nimport { Sprite } from './Graphics/Sprite';\r\nimport { LegacyDrawing } from '.';\r\n\r\n/**\r\n * An enum that represents the types of emitter nozzles\r\n */\r\nexport enum EmitterType {\r\n  /**\r\n   * Constant for the circular emitter type\r\n   */\r\n  Circle,\r\n  /**\r\n   * Constant for the rectangular emitter type\r\n   */\r\n  Rectangle\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class ParticleImpl extends Entity {\r\n  public position: Vector = new Vector(0, 0);\r\n  public velocity: Vector = new Vector(0, 0);\r\n  public acceleration: Vector = new Vector(0, 0);\r\n  public particleRotationalVelocity: number = 0;\r\n  public currentRotation: number = 0;\r\n\r\n  public focus: Vector = null;\r\n  public focusAccel: number = 0;\r\n  public opacity: number = 1;\r\n  public beginColor: Color = Color.White;\r\n  public endColor: Color = Color.White;\r\n\r\n  // Life is counted in ms\r\n  public life: number = 300;\r\n  public fadeFlag: boolean = false;\r\n\r\n  // Color transitions\r\n  private _rRate: number = 1;\r\n  private _gRate: number = 1;\r\n  private _bRate: number = 1;\r\n  private _aRate: number = 0;\r\n  private _currentColor: Color = Color.White;\r\n\r\n  public emitter: ParticleEmitter = null;\r\n  public particleSize: number = 5;\r\n  public particleSprite: LegacyDrawing.Sprite = null;\r\n\r\n  public startSize: number;\r\n  public endSize: number;\r\n  public sizeRate: number = 0;\r\n  public elapsedMultiplier: number = 0;\r\n\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n\r\n  public transform: TransformComponent;\r\n  public graphics: GraphicsComponent;\r\n\r\n  constructor(\r\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  ) {\r\n    super();\r\n    let emitter = emitterOrConfig;\r\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\r\n      const config = emitterOrConfig;\r\n      emitter = config.emitter;\r\n      life = config.life;\r\n      opacity = config.opacity;\r\n      endColor = config.endColor;\r\n      beginColor = config.beginColor;\r\n      position = config.position;\r\n      velocity = config.velocity;\r\n      acceleration = config.acceleration;\r\n      startSize = config.startSize;\r\n      endSize = config.endSize;\r\n    }\r\n    this.emitter = <ParticleEmitter>emitter;\r\n    this.life = life || this.life;\r\n    this.opacity = opacity || this.opacity;\r\n    this.endColor = endColor || this.endColor.clone();\r\n    this.beginColor = beginColor || this.beginColor.clone();\r\n    this._currentColor = this.beginColor.clone();\r\n    this.position = (position || this.position).add(this.emitter.pos);\r\n    this.velocity = velocity || this.velocity;\r\n    this.acceleration = acceleration || this.acceleration;\r\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\r\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\r\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\r\n    this._aRate = this.opacity / this.life;\r\n\r\n    this.startSize = startSize || 0;\r\n    this.endSize = endSize || 0;\r\n\r\n    if (this.endSize > 0 && this.startSize > 0) {\r\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\r\n      this.particleSize = this.startSize;\r\n    }\r\n\r\n    this.addComponent((this.transform = new TransformComponent()));\r\n    this.addComponent(new CanvasDrawComponent((ctx) => this.draw(ctx)));\r\n    this.addComponent((this.graphics = new GraphicsComponent()));\r\n\r\n    this.transform.pos = this.position;\r\n    this.transform.rotation = this.currentRotation;\r\n    this.transform.scale = vec(1, 1); // TODO wut\r\n    if (this.particleSprite) {\r\n      this.graphics.opacity = this.opacity;\r\n      this.graphics.use(Sprite.fromLegacySprite(this.particleSprite));\r\n    } else {\r\n      this.graphics.onPostDraw = (ctx) => {\r\n        ctx.save();\r\n        this.graphics.opacity = this.opacity;\r\n        const tmpColor = this._currentColor.clone();\r\n        tmpColor.a = 1;\r\n        ctx.debug.drawPoint(vec(0, 0), { color: tmpColor, size: this.particleSize });\r\n        ctx.restore();\r\n      };\r\n    }\r\n  }\r\n\r\n  public kill() {\r\n    this.emitter.removeParticle(this);\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this.life = this.life - delta;\r\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\r\n\r\n    if (this.life < 0) {\r\n      this.kill();\r\n    }\r\n\r\n    if (this.fadeFlag) {\r\n      this.opacity = Util.clamp(this._aRate * this.life, 0.0001, 1);\r\n    }\r\n\r\n    if (this.startSize > 0 && this.endSize > 0) {\r\n      this.particleSize = Util.clamp(\r\n        this.sizeRate * delta + this.particleSize,\r\n        Math.min(this.startSize, this.endSize),\r\n        Math.max(this.startSize, this.endSize)\r\n      );\r\n    }\r\n\r\n    this._currentColor.r = Util.clamp(this._currentColor.r + this._rRate * delta, 0, 255);\r\n    this._currentColor.g = Util.clamp(this._currentColor.g + this._gRate * delta, 0, 255);\r\n    this._currentColor.b = Util.clamp(this._currentColor.b + this._bRate * delta, 0, 255);\r\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\r\n\r\n    if (this.focus) {\r\n      const accel = this.focus\r\n        .sub(this.position)\r\n        .normalize()\r\n        .scale(this.focusAccel)\r\n        .scale(delta / 1000);\r\n      this.velocity = this.velocity.add(accel);\r\n    } else {\r\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\r\n    }\r\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\r\n\r\n    if (this.particleRotationalVelocity) {\r\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\r\n    }\r\n\r\n    this.transform.pos = this.position;\r\n    this.transform.rotation = this.currentRotation;\r\n    this.transform.scale = vec(1, 1); // todo wut\r\n    this.graphics.opacity = this.opacity;\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    if (this.particleSprite) {\r\n      this.particleSprite.opacity(this.opacity);\r\n      this.particleSprite.draw(ctx, 0, 0);\r\n      return;\r\n    }\r\n\r\n    ctx.save();\r\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\r\n    ctx.fillStyle = this._currentColor.toString();\r\n    ctx.beginPath();\r\n    ctx.arc(0, 0, this.particleSize, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.closePath();\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\nexport interface ParticleArgs extends Partial<ParticleImpl> {\r\n  emitter: ParticleEmitter;\r\n  position?: Vector;\r\n  velocity?: Vector;\r\n  acceleration?: Vector;\r\n  particleRotationalVelocity?: number;\r\n  currentRotation?: number;\r\n  particleSize?: number;\r\n  particleSprite?: LegacyDrawing.Sprite;\r\n}\r\n\r\n/**\r\n * Particle is used in a [[ParticleEmitter]]\r\n */\r\nexport class Particle extends Configurable(ParticleImpl) {\r\n  constructor(config: ParticleArgs);\r\n  constructor(\r\n    emitter: ParticleEmitter,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  );\r\n  constructor(\r\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  ) {\r\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\r\n  }\r\n}\r\n\r\nexport interface ParticleEmitterArgs {\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  width?: number;\r\n  height?: number;\r\n  isEmitting?: boolean;\r\n  minVel?: number;\r\n  maxVel?: number;\r\n  acceleration?: Vector;\r\n  minAngle?: number;\r\n  maxAngle?: number;\r\n  emitRate?: number;\r\n  particleLife?: number;\r\n  opacity?: number;\r\n  fadeFlag?: boolean;\r\n  focus?: Vector;\r\n  focusAccel?: number;\r\n  startSize?: number;\r\n  endSize?: number;\r\n  minSize?: number;\r\n  maxSize?: number;\r\n  beginColor?: Color;\r\n  endColor?: Color;\r\n  particleSprite?: LegacyDrawing.Sprite;\r\n  emitterType?: EmitterType;\r\n  radius?: number;\r\n  particleRotationalVelocity?: number;\r\n  randomRotation?: boolean;\r\n  random?: Random;\r\n}\r\n\r\n/**\r\n * Using a particle emitter is a great way to create interesting effects\r\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\r\n * extend [[Actor]] allowing you to use all of the features that come with.\r\n */\r\nexport class ParticleEmitter extends Actor {\r\n  private _particlesToEmit: number = 0;\r\n\r\n  public numParticles: number = 0;\r\n\r\n  /**\r\n   * Random number generator\r\n   */\r\n  public random: Random;\r\n\r\n  /**\r\n   * Gets or sets the isEmitting flag\r\n   */\r\n  public isEmitting: boolean = true;\r\n  /**\r\n   * Gets or sets the backing particle collection\r\n   */\r\n  public particles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the backing deadParticle collection\r\n   */\r\n  public deadParticles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the minimum particle velocity\r\n   */\r\n  public minVel: number = 0;\r\n  /**\r\n   * Gets or sets the maximum particle velocity\r\n   */\r\n  public maxVel: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the acceleration vector for all particles\r\n   */\r\n  public acceleration: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Gets or sets the minimum angle in radians\r\n   */\r\n  public minAngle: number = 0;\r\n  /**\r\n   * Gets or sets the maximum angle in radians\r\n   */\r\n  public maxAngle: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the emission rate for particles (particles/sec)\r\n   */\r\n  public emitRate: number = 1; //particles/sec\r\n  /**\r\n   * Gets or sets the life of each particle in milliseconds\r\n   */\r\n  public particleLife: number = 2000;\r\n  /**\r\n   * Gets the opacity of each particle from 0 to 1.0\r\n   */\r\n  public get opacity(): number {\r\n    return super.graphics.opacity;\r\n  }\r\n  /**\r\n   * Gets the opacity of each particle from 0 to 1.0\r\n   */\r\n  public set opacity(opacity: number) {\r\n    super.graphics.opacity = opacity;\r\n  }\r\n  /**\r\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\r\n   */\r\n  public fadeFlag: boolean = false;\r\n\r\n  /**\r\n   * Gets or sets the optional focus where all particles should accelerate towards\r\n   */\r\n  public focus: Vector = null;\r\n  /**\r\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\r\n   */\r\n  public focusAccel: number = null;\r\n  /**\r\n   * Gets or sets the optional starting size for the particles\r\n   */\r\n  public startSize: number = null;\r\n  /**\r\n   * Gets or sets the optional ending size for the particles\r\n   */\r\n  public endSize: number = null;\r\n\r\n  /**\r\n   * Gets or sets the minimum size of all particles\r\n   */\r\n  public minSize: number = 5;\r\n  /**\r\n   * Gets or sets the maximum size of all particles\r\n   */\r\n  public maxSize: number = 5;\r\n\r\n  /**\r\n   * Gets or sets the beginning color of all particles\r\n   */\r\n  public beginColor: Color = Color.White;\r\n  /**\r\n   * Gets or sets the ending color of all particles\r\n   */\r\n  public endColor: Color = Color.White;\r\n\r\n  private _og: LegacyDrawing.Sprite = null;\r\n  private _sprite: Sprite = null;\r\n  /**\r\n   * Gets or sets the sprite that a particle should use\r\n   */\r\n  public get particleSprite(): LegacyDrawing.Sprite {\r\n    return this._og;\r\n  }\r\n\r\n  public set particleSprite(val: LegacyDrawing.Sprite) {\r\n    this._og = val;\r\n    if (val) {\r\n      this._sprite = Sprite.fromLegacySprite(val);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the emitter type for the particle emitter\r\n   */\r\n  public emitterType: EmitterType = EmitterType.Rectangle;\r\n\r\n  /**\r\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\r\n   */\r\n  public radius: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the particle rotational speed velocity\r\n   */\r\n  public particleRotationalVelocity: number = 0;\r\n\r\n  /**\r\n   * Indicates whether particles should start with a random rotation\r\n   */\r\n  public randomRotation: boolean = false;\r\n\r\n  /**\r\n   * @param config particle emitter options bag\r\n   */\r\n  constructor(config: ParticleEmitterArgs) {\r\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\r\n\r\n    const {\r\n      x,\r\n      y,\r\n      pos,\r\n      isEmitting,\r\n      minVel,\r\n      maxVel,\r\n      acceleration,\r\n      minAngle,\r\n      maxAngle,\r\n      emitRate,\r\n      particleLife,\r\n      opacity,\r\n      fadeFlag,\r\n      focus,\r\n      focusAccel,\r\n      startSize,\r\n      endSize,\r\n      minSize,\r\n      maxSize,\r\n      beginColor,\r\n      endColor,\r\n      particleSprite,\r\n      emitterType,\r\n      radius,\r\n      particleRotationalVelocity,\r\n      randomRotation,\r\n      random\r\n    } = { ...config };\r\n\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.isEmitting = isEmitting ?? this.isEmitting;\r\n    this.minVel = minVel ?? this.minVel;\r\n    this.maxVel = maxVel ?? this.maxVel;\r\n    this.acceleration = acceleration ?? this.acceleration;\r\n    this.minAngle = minAngle ?? this.minAngle;\r\n    this.maxAngle = maxAngle ?? this.maxAngle;\r\n    this.emitRate = emitRate ?? this.emitRate;\r\n    this.particleLife = particleLife ?? this.particleLife;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.fadeFlag = fadeFlag ?? this.fadeFlag;\r\n    this.focus = focus ?? this.focus;\r\n    this.focusAccel = focusAccel ?? this.focusAccel;\r\n    this.startSize = startSize ?? this.startSize;\r\n    this.endSize = endSize ?? this.endSize;\r\n    this.minSize = minSize ?? this.minSize;\r\n    this.maxSize = maxSize ?? this.maxSize;\r\n    this.beginColor = beginColor ?? this.beginColor;\r\n    this.endColor = endColor ?? this.endColor;\r\n    this.particleSprite = particleSprite ?? this.particleSprite;\r\n    this.emitterType = emitterType ?? this.emitterType;\r\n    this.radius = radius ?? this.radius;\r\n    this.particleRotationalVelocity = particleRotationalVelocity ?? this.particleRotationalVelocity;\r\n    this.randomRotation = randomRotation ?? this.randomRotation;\r\n\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n\r\n    this.random = random ?? new Random();\r\n\r\n    // Remove offscreen culling from particle emitters\r\n    for (let i = 0; i < this.traits.length; i++) {\r\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\r\n        this.traits.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public removeParticle(particle: Particle) {\r\n    this.deadParticles.push(particle);\r\n  }\r\n\r\n  /**\r\n   * Causes the emitter to emit particles\r\n   * @param particleCount  Number of particles to emit right now\r\n   */\r\n  public emitParticles(particleCount: number) {\r\n    for (let i = 0; i < particleCount; i++) {\r\n      const p = this._createParticle();\r\n      this.particles.push(p);\r\n      if (this?.scene?.world) {\r\n        this.scene.world.add(p);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clearParticles() {\r\n    this.particles.length = 0;\r\n  }\r\n\r\n  // Creates a new particle given the constraints of the emitter\r\n  private _createParticle(): Particle {\r\n    // todo implement emitter constraints;\r\n    let ranX = 0;\r\n    let ranY = 0;\r\n\r\n    const angle = Util.randomInRange(this.minAngle, this.maxAngle, this.random);\r\n    const vel = Util.randomInRange(this.minVel, this.maxVel, this.random);\r\n    const size = this.startSize || Util.randomInRange(this.minSize, this.maxSize, this.random);\r\n    const dx = vel * Math.cos(angle);\r\n    const dy = vel * Math.sin(angle);\r\n\r\n    if (this.emitterType === EmitterType.Rectangle) {\r\n      ranX = Util.randomInRange(0, this.width, this.random);\r\n      ranY = Util.randomInRange(0, this.height, this.random);\r\n    } else if (this.emitterType === EmitterType.Circle) {\r\n      const radius = Util.randomInRange(0, this.radius, this.random);\r\n      ranX = radius * Math.cos(angle);\r\n      ranY = radius * Math.sin(angle);\r\n    }\r\n\r\n    const p = new Particle(\r\n      this,\r\n      this.particleLife,\r\n      this.opacity,\r\n      this.beginColor,\r\n      this.endColor,\r\n      new Vector(ranX, ranY),\r\n      new Vector(dx, dy),\r\n      this.acceleration,\r\n      this.startSize,\r\n      this.endSize\r\n    );\r\n    p.fadeFlag = this.fadeFlag;\r\n    p.particleSize = size;\r\n    if (this.particleSprite) {\r\n      p.particleSprite = this.particleSprite;\r\n      p.graphics.opacity = this.opacity;\r\n      p.graphics.use(this._sprite);\r\n    }\r\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\r\n    if (this.randomRotation) {\r\n      p.currentRotation = Util.randomInRange(0, Math.PI * 2, this.random);\r\n    }\r\n    if (this.focus) {\r\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\r\n      p.focusAccel = this.focusAccel;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public update(engine: Engine, delta: number) {\r\n    super.update(engine, delta);\r\n\r\n    if (this.isEmitting) {\r\n      this._particlesToEmit += this.emitRate * (delta / 1000);\r\n      if (this._particlesToEmit > 1.0) {\r\n        this.emitParticles(Math.floor(this._particlesToEmit));\r\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\r\n      }\r\n    }\r\n\r\n    // deferred removal\r\n    for (let i = 0; i < this.deadParticles.length; i++) {\r\n      Util.removeItemFromArray(this.deadParticles[i], this.particles);\r\n      if (this?.scene?.world) {\r\n        this.scene.world.remove(this.deadParticles[i], false);\r\n      }\r\n    }\r\n    this.deadParticles.length = 0;\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    // todo is there a more efficient to draw\r\n    // possibly use a webgl offscreen canvas and shaders to do particles?\r\n    this.particles.forEach((p) => p.draw(ctx));\r\n  }\r\n\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    super.debugDraw(ctx);\r\n    ctx.fillStyle = Color.Black.toString();\r\n    ctx.fillText('Particles: ' + this.particles.length, this.pos.x, this.pos.y + 20);\r\n\r\n    if (this.focus) {\r\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\r\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\r\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Animation, HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/Index';\n\nexport interface GraphicsGroupingOptions {\n  members: GraphicsGrouping[];\n}\n\nexport interface GraphicsGrouping {\n  pos: Vector;\n  graphic: Graphic;\n}\n\nexport class GraphicsGroup extends Graphic implements HasTick {\n  public members: GraphicsGrouping[] = [];\n\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\n    super(options);\n    this.members = options.members;\n    this._updateDimensions();\n  }\n\n  public clone(): GraphicsGroup {\n    return new GraphicsGroup({\n      members: [...this.members],\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  private _updateDimensions(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n\n    this.width = bb.width;\n    this.height = bb.height;\n\n    return bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n    return bb;\n  }\n\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\n  }\n\n  public tick(elapsedMilliseconds: number, idempotencyToken?: number) {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.tick(elapsedMilliseconds, idempotencyToken);\n      }\n    }\n  }\n\n  public reset() {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.reset();\n      }\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    for (const member of this.members) {\n      ex.save();\n      ex.translate(x, y);\n      member.graphic.draw(ex, member.pos.x, member.pos.y);\n      if (this.showDebug) {\n        /* istanbul ignore next */\n        ex.debug.drawRect(0, 0, this.width, this.height);\n      }\n      ex.restore();\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { GraphicsComponent } from './GraphicsComponent';\r\nimport { vec } from '../Math/vector';\r\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Camera } from '../Camera';\r\nimport { System, SystemType, TagComponent } from '../EntityComponentSystem';\r\nimport { Engine } from '../Engine';\r\nimport { GraphicsDiagnostics } from './GraphicsDiagnostics';\r\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\r\nimport { GraphicsGroup } from '.';\r\nimport { Particle } from '../Particles';\r\n\r\nexport class GraphicsSystem extends System<TransformComponent | GraphicsComponent> {\r\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 0;\r\n  private _token = 0;\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\r\n  }\r\n\r\n  public update(entities: Entity[], delta: number): void {\r\n    this._clearScreen();\r\n    this._token++;\r\n    let transform: TransformComponent;\r\n    let graphics: GraphicsComponent;\r\n\r\n    for (const entity of entities) {\r\n      transform = entity.get(TransformComponent);\r\n      graphics = entity.get(GraphicsComponent);\r\n\r\n      // Figure out if entities are offscreen\r\n      const entityOffscreen = this._isOffscreen(transform, graphics);\r\n      if (entityOffscreen && !entity.hasTag('offscreen')) {\r\n        entity.eventDispatcher.emit('exitviewport', new ExitViewPortEvent(entity));\r\n        entity.addComponent(new TagComponent('offscreen'));\r\n      }\r\n\r\n      if (!entityOffscreen && entity.hasTag('offscreen')) {\r\n        entity.eventDispatcher.emit('enterviewport', new EnterViewPortEvent(entity));\r\n        entity.removeComponent('offscreen');\r\n      }\r\n      // Skip entities that have graphics offscreen\r\n      if (entityOffscreen) {\r\n        continue;\r\n      }\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(transform);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      // Tick any graphics state (but only once) for animations and graphics groups\r\n      graphics.update(delta, this._token);\r\n\r\n      // Position the entity\r\n      this._applyTransform(entity);\r\n\r\n      // Optionally run the onPreDraw graphics lifecycle draw\r\n      if (graphics.onPreDraw) {\r\n        graphics.onPreDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      // TODO remove this hack on the particle redo\r\n      const particleOpacity = (entity instanceof Particle) ? entity.opacity : 1;\r\n      this._graphicsContext.opacity = graphics.opacity * particleOpacity;\r\n\r\n      // Draw the graphics component\r\n      this._drawGraphicsComponent(graphics);\r\n\r\n      // Optionally run the onPostDraw graphics lifecycle draw\r\n      if (graphics.onPostDraw) {\r\n        graphics.onPostDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // Reset the transform back to the original\r\n      this._popCameraTransform(transform);\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n  }\r\n\r\n  private _clearScreen(): void {\r\n    this._graphicsContext.clear();\r\n  }\r\n\r\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      const graphicsOffscreen = !this._camera.viewport.intersect(graphics.localBounds.transform(transform.getGlobalMatrix()));\r\n      return graphicsOffscreen;\r\n    } else {\r\n      // TODO sceen coordinates\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent) {\r\n    if (graphicsComponent.visible) {\r\n      // this should be moved to the graphics system\r\n      for (const layer of graphicsComponent.layers.get()) {\r\n        for (const { graphic, options } of layer.graphics) {\r\n          let anchor = graphicsComponent.anchor;\r\n          let offset = graphicsComponent.offset;\r\n          if (options?.anchor) {\r\n            anchor = options.anchor;\r\n          }\r\n          if (options?.offset) {\r\n            offset = options.offset;\r\n          }\r\n          // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n          const offsetX = -graphic.width * anchor.x + offset.x;\r\n          const offsetY = -graphic.height * anchor.y + offset.y;\r\n\r\n          graphic?.draw(this._graphicsContext, offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n\r\n          if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\r\n            const offset = vec(offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n            if (graphic instanceof GraphicsGroup) {\r\n              for (const g of graphic.members) {\r\n                g.graphic?.localBounds.translate(offset.add(g.pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              }\r\n            } else {\r\n              /* istanbul ignore next */\r\n              graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Actor } from '../Actor';\r\nimport { Entity, System, SystemType } from '../EntityComponentSystem';\r\nimport { CanvasDrawComponent } from './CanvasDrawComponent';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsDiagnostics } from '../Graphics/GraphicsDiagnostics';\r\n\r\n/**\r\n * Draws anything with a transform and a \"draw\" method\r\n * @deprecated Shim for canvas drawing, will be removed v0.26.0\r\n */\r\nexport class CanvasDrawingSystem extends System<TransformComponent | CanvasDrawComponent> {\r\n  public readonly types = ['ex.transform', 'ex.canvas'] as const;\r\n  public systemType = SystemType.Draw;\r\n  public priority = -1;\r\n\r\n  private _ctx: CanvasRenderingContext2D;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._ctx = scene.engine.ctx;\r\n    this._engine = scene.engine;\r\n    this._camera = scene.camera;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\r\n  }\r\n\r\n  public update(entities: Entity[], delta: number) {\r\n    this._clearScreen();\r\n\r\n    let transform: TransformComponent;\r\n    let canvasdraw: CanvasDrawComponent;\r\n    const length = entities.length;\r\n    for (let i = 0; i < length; i++) {\r\n      const visible = (entities[i] as Actor)?.graphics?.visible ?? true;\r\n      const offscreen = (entities[i] as Actor).isOffScreen;\r\n      if (visible && !offscreen) {\r\n        transform = entities[i].get(TransformComponent);\r\n        canvasdraw = entities[i].get(CanvasDrawComponent);\r\n\r\n        this._ctx.save();\r\n        this._pushCameraTransform(transform);\r\n\r\n        this._ctx.save();\r\n        this._applyTransform(entities[i]);\r\n        canvasdraw.draw(this._ctx, delta);\r\n        this._ctx.restore();\r\n\r\n        this._popCameraTransform(transform);\r\n        this._ctx.restore();\r\n      }\r\n\r\n      if (this._engine.isDebug) {\r\n        this._ctx.save();\r\n        this._pushCameraTransform(transform);\r\n        this._ctx.strokeStyle = 'yellow';\r\n        (entities[i] as unknown as Actor).debugDraw(this._ctx);\r\n        this._popCameraTransform(transform);\r\n        this._ctx.restore();\r\n      }\r\n    }\r\n    if (this._engine.isDebug) {\r\n      this._ctx.save();\r\n      this._camera.draw(this._ctx);\r\n      this._camera.debugDraw(this._ctx);\r\n      this._ctx.restore();\r\n    }\r\n\r\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n  }\r\n\r\n  private _applyTransform(entity: Entity) {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._ctx.translate(transform.pos.x, transform.pos.y);\r\n        this._ctx.rotate(transform.rotation);\r\n        this._ctx.scale(transform.scale.x, transform.scale.y);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _clearScreen(): void {\r\n    this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\r\n    this._ctx.fillStyle = this._engine.backgroundColor.toString();\r\n    this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\r\n  }\r\n\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera transform to place entity in world space\r\n      this._ctx.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._ctx);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Restore back to screen space from world space if we were drawing an entity there\r\n      this._ctx.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { CoordPlane, Entity, TransformComponent } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { BodyComponent, CollisionSystem, CompositeCollider, GraphicsComponent, Particle, Util } from '..';\r\n\r\nexport class DebugSystem extends System<TransformComponent> {\r\n  public readonly types = ['ex.transform'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 999; // lowest priority\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _collisionSystem: CollisionSystem;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n    this._collisionSystem = scene.world.systemManager.get(CollisionSystem);\r\n  }\r\n\r\n  update(entities: Entity[], _delta: number): void {\r\n    if (!this._engine.isDebug) {\r\n      return;\r\n    }\r\n\r\n    const filterSettings = this._engine.debug.filter;\r\n\r\n    let id: number;\r\n    let name: string;\r\n    const entitySettings = this._engine.debug.entity;\r\n\r\n    let tx: TransformComponent;\r\n    const txSettings = this._engine.debug.transform;\r\n\r\n    let motion: MotionComponent;\r\n    const motionSettings = this._engine.debug.motion;\r\n\r\n    let colliderComp: ColliderComponent;\r\n    const colliderSettings = this._engine.debug.collider;\r\n\r\n    const physicsSettings = this._engine.debug.physics;\r\n\r\n    let graphics: GraphicsComponent;\r\n    const graphicsSettings = this._engine.debug.graphics;\r\n\r\n    let body: BodyComponent;\r\n    const bodySettings = this._engine.debug.body;\r\n\r\n    const cameraSettings = this._engine.debug.camera;\r\n    for (const entity of entities) {\r\n      if (entity.hasTag('offscreen')) {\r\n        // skip offscreen entities\r\n        continue;\r\n      }\r\n      if (entity instanceof Particle) {\r\n        // Particles crush the renderer :(\r\n        continue;\r\n      }\r\n      if (filterSettings.useFilter) {\r\n        const allIds = filterSettings.ids.length === 0;\r\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\r\n        if (!idMatch) {\r\n          continue;\r\n        }\r\n        const allNames = filterSettings.nameQuery === '';\r\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\r\n        if (!nameMatch) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      let cursor = Vector.Zero;\r\n      const lineHeight = vec(0, 16);\r\n      id = entity.id;\r\n      name = entity.name;\r\n      tx = entity.get(TransformComponent);\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(tx);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      this._applyTransform(entity);\r\n      if (tx) {\r\n        if (txSettings.showAll || txSettings.showPosition) {\r\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 2, color: txSettings.positionColor });\r\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showId) {\r\n          this._graphicsContext.debug.drawText(`id(${id}) ${tx.parent ? 'child of id(' + tx.parent?.owner?.id + ')' : ''}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showName) {\r\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showRotation) {\r\n          this._graphicsContext.drawLine(\r\n            Vector.Zero,\r\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\r\n            txSettings.rotationColor,\r\n            2\r\n          );\r\n          this._graphicsContext.debug.drawText(`rot deg(${Util.toDegrees(tx.rotation).toFixed(2)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showScale) {\r\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\r\n        }\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics) {\r\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\r\n          const bounds = graphics.localBounds;\r\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\r\n        }\r\n      }\r\n\r\n      body = entity.get(BodyComponent);\r\n      if (body) {\r\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\r\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\r\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMass) {\r\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMotion) {\r\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showSleeping) {\r\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.sleeping: 'cant sleep'})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      motion = entity.get(MotionComponent);\r\n      if (motion) {\r\n        if (motionSettings.showAll || motionSettings.showVelocity) {\r\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\r\n        }\r\n      }\r\n\r\n      // Colliders live in world space already so after the restore()\r\n      colliderComp = entity.get(ColliderComponent);\r\n      if (colliderComp) {\r\n        const collider = colliderComp.get();\r\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\r\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor);\r\n        }\r\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\r\n          if (collider instanceof CompositeCollider) {\r\n            const colliders = collider.getColliders();\r\n            for (const collider of colliders) {\r\n              const bounds = collider.bounds;\r\n              const pos = vec(bounds.left, bounds.top);\r\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\r\n              }\r\n            }\r\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\r\n          } else if (collider) {\r\n            const bounds = colliderComp.bounds;\r\n            const pos = vec(bounds.left, bounds.top);\r\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this._popCameraTransform(tx);\r\n    }\r\n\r\n    this._graphicsContext.save();\r\n    this._camera.draw(this._graphicsContext);\r\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\r\n      this._collisionSystem.debug(this._graphicsContext);\r\n    }\r\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\r\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawPoint(point, { size: 5, color: physicsSettings.collisionContactColor });\r\n          }\r\n        }\r\n\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\r\n              color: physicsSettings.collisionNormalColor\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this._graphicsContext.restore();\r\n\r\n    if (cameraSettings) {\r\n      this._graphicsContext.save();\r\n      this._camera.draw(this._graphicsContext);\r\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\r\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\r\n      }\r\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\r\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\r\n      }\r\n      this._graphicsContext.restore();\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ActionsComponent } from './ActionsComponent';\r\n\r\n\r\nexport class ActionsSystem extends System<ActionsComponent> {\r\n  public readonly types = ['ex.actions'] as const;\r\n  systemType = SystemType.Update;\r\n  priority = -1;\r\n\r\n  update(entities: Entity[], delta: number): void {\r\n    let actions: ActionsComponent;\r\n    for (const entity of entities) {\r\n      actions = entity.get(ActionsComponent);\r\n      actions.update(delta);\r\n    }\r\n  }\r\n}","import { Logger } from './../Util/Log';\r\nimport { PostProcessor } from './PostProcessor';\r\nimport { Engine } from '../Engine';\r\n\r\nexport enum ColorBlindness {\r\n  Protanope,\r\n  Deuteranope,\r\n  Tritanope\r\n}\r\n\r\n/**\r\n * This post processor can correct colors and simulate color blindness.\r\n * It is possible to use this on every game, but the game's performance\r\n * will suffer measurably. It's better to use it as a helpful tool while developing your game.\r\n * Remember, the best practice is to design with color blindness in mind.\r\n */\r\nexport class ColorBlindCorrector implements PostProcessor {\r\n  /*eslint-disable */\r\n  private _vertexShader =\r\n    '' +\r\n    'attribute vec2 a_position;' +\r\n    'attribute vec2 a_texCoord;' +\r\n    'uniform vec2 u_resolution;' +\r\n    'varying vec2 v_texCoord;' +\r\n    'void main() {' +\r\n    // convert the rectangle from pixels to 0.0 to 1.0\r\n    'vec2 zeroToOne = a_position / u_resolution;' +\r\n    // convert from 0->1 to 0->2\r\n    'vec2 zeroToTwo = zeroToOne * 2.0;' +\r\n    // convert from 0->2 to -1->+1 (clipspace)\r\n    'vec2 clipSpace = zeroToTwo - 1.0;' +\r\n    'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' +\r\n    // pass the texCoord to the fragment shader\r\n    // The GPU will interpolate this value between points.\r\n    'v_texCoord = a_texCoord;' +\r\n    '}';\r\n\r\n  private _fragmentShader =\r\n    'precision mediump float;' +\r\n    // our texture\r\n    'uniform sampler2D u_image;' +\r\n    // the texCoords passed in from the vertex shader.\r\n    'varying vec2 v_texCoord;' +\r\n    // Color blind conversions\r\n    /*'mat3 m[9] =' +\r\n   '{' +\r\n      'mat3(1.0, 0.0, 0.0,  0.0, 1.0, 0.0,  0.0, 0.0, 1.0  ),' + // normal\r\n      'mat3(0.567, 0.433, 0.0,  0.558, 0.442, 0.0,  0.0, 0.242, 0.758),' + // protanopia\r\n      'mat3(0.817, 0.183, 0.0,  0.333, 0.667, 0.0,  0.0, 0.125,0.875),' + // protanomaly\r\n      'mat3(0.625, 0.375, 0.0,  0.7, 0.3, 0.0,  0.0, 0.3,0.7  ),' + // deuteranopia\r\n      'mat3(0.8, 0.2, 0.0,  0.258, 0.742, 0.0,  0.0, 0.142,0.858),' + // deuteranomaly\r\n      'mat3(0.95, 0.05, 0.0,  0.0, 0.433, 0.567,  0.0, 0.475,0.525),' + // tritanopia\r\n      'mat3(0.967, 0.033, 0.0,  0.0, 0.733, 0.267,  0.0, 0.183,0.817),' + // tritanomaly\r\n      'mat3(0.299, 0.587, 0.114,  0.299, 0.587, 0.114,  0.299, 0.587,0.114),' + // achromatopsia\r\n      'mat3(0.618, 0.320, 0.062,  0.163, 0.775, 0.062,  0.163, 0.320,0.516)' +  // achromatomaly\r\n   '};' +*/\r\n\r\n    'void main() {' +\r\n    'vec4 o =  texture2D(u_image, v_texCoord);' +\r\n    // RGB to LMS matrix conversion\r\n    'float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);' +\r\n    'float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);' +\r\n    'float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);' +\r\n    // Simulate color blindness\r\n\r\n    '//MODE CODE//' +\r\n    /* Deuteranope for testing\r\n      'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n            'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\r\n            'float s = 0.0 * L + 0.0 * M + 1.0 * S;' +*/\r\n\r\n    // LMS to RGB matrix conversion\r\n    'vec4 error;' +\r\n    'error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);' +\r\n    'error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);' +\r\n    'error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);' +\r\n    'error.a = 1.0;' +\r\n    'vec4 diff = o - error;' +\r\n    'vec4 correction;' +\r\n    'correction.r = 0.0;' +\r\n    'correction.g =  (diff.r * 0.7) + (diff.g * 1.0);' +\r\n    'correction.b =  (diff.r * 0.7) + (diff.b * 1.0);' +\r\n    'correction = o + correction;' +\r\n    'correction.a = o.a;' +\r\n    '//SIMULATE//' +\r\n    '}';\r\n\r\n  /*eslint-enable */\r\n  private _internalCanvas: HTMLCanvasElement;\r\n  private _gl: WebGLRenderingContext;\r\n  private _program: WebGLProgram;\r\n\r\n  constructor(public engine: Engine, public simulate: boolean = false, public colorMode: ColorBlindness = ColorBlindness.Protanope) {\r\n    this._internalCanvas = document.createElement('canvas');\r\n    this._internalCanvas.width = engine.drawWidth;\r\n    this._internalCanvas.height = engine.drawHeight;\r\n\r\n    // eslint-disable-next-line\r\n    this._gl = <WebGLRenderingContext>this._internalCanvas.getContext('webgl', { preserveDrawingBuffer: true });\r\n\r\n    this._program = this._gl.createProgram();\r\n    const fragmentShader = this._getShader('Fragment', this._getFragmentShaderByMode(colorMode));\r\n    const vertextShader = this._getShader('Vertex', this._vertexShader);\r\n\r\n    this._gl.attachShader(this._program, vertextShader);\r\n    this._gl.attachShader(this._program, fragmentShader);\r\n    this._gl.linkProgram(this._program);\r\n\r\n    if (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {\r\n      Logger.getInstance().error('Unable to link shader program!');\r\n    }\r\n\r\n    this._gl.useProgram(this._program);\r\n  }\r\n\r\n  private _getFragmentShaderByMode(colorMode: ColorBlindness) {\r\n    let code = '';\r\n    if (colorMode === ColorBlindness.Protanope) {\r\n      code =\r\n        'float l = 0.0 * L + 2.02344 * M + -2.52581 * S;' +\r\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\r\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\r\n    } else if (colorMode === ColorBlindness.Deuteranope) {\r\n      code =\r\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n        'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\r\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\r\n    } else if (colorMode === ColorBlindness.Tritanope) {\r\n      code =\r\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\r\n        'float s = -0.395913 * L + 0.801109 * M + 0.0 * S;';\r\n    }\r\n\r\n    if (this.simulate) {\r\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = error.rgba;');\r\n    } else {\r\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = correction.rgba;');\r\n    }\r\n\r\n    return this._fragmentShader.replace('//MODE CODE//', code);\r\n  }\r\n\r\n  private _setRectangle(x: number, y: number, width: number, height: number) {\r\n    const x1 = x;\r\n    const x2 = x + width;\r\n    const y1 = y;\r\n    const y2 = y + height;\r\n    this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), this._gl.STATIC_DRAW);\r\n  }\r\n\r\n  private _getShader(type: string, program: string): WebGLShader {\r\n    let shader: WebGLShader;\r\n    if (type === 'Fragment') {\r\n      shader = this._gl.createShader(this._gl.FRAGMENT_SHADER);\r\n    } else if (type === 'Vertex') {\r\n      shader = this._gl.createShader(this._gl.VERTEX_SHADER);\r\n    } else {\r\n      Logger.getInstance().error('Error unknown shader type', type);\r\n    }\r\n\r\n    this._gl.shaderSource(shader, program);\r\n    this._gl.compileShader(shader);\r\n\r\n    if (!this._gl.getShaderParameter(shader, this._gl.COMPILE_STATUS)) {\r\n      Logger.getInstance().error('Unable to compile shader!', this._gl.getShaderInfoLog(shader));\r\n      return null;\r\n    }\r\n\r\n    return shader;\r\n  }\r\n\r\n  public process(image: ImageData, out: CanvasRenderingContext2D) {\r\n    // look up where the vertex data needs to go.\r\n    const positionLocation = this._gl.getAttribLocation(this._program, 'a_position');\r\n    const texCoordLocation = this._gl.getAttribLocation(this._program, 'a_texCoord');\r\n\r\n    const texCoordBuffer = this._gl.createBuffer();\r\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, texCoordBuffer);\r\n    this._gl.bufferData(\r\n      this._gl.ARRAY_BUFFER,\r\n      new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\r\n      this._gl.STATIC_DRAW\r\n    );\r\n    this._gl.enableVertexAttribArray(texCoordLocation);\r\n    this._gl.vertexAttribPointer(texCoordLocation, 2, this._gl.FLOAT, false, 0, 0);\r\n\r\n    // Create a texture.\r\n    const texture = this._gl.createTexture();\r\n    this._gl.bindTexture(this._gl.TEXTURE_2D, texture);\r\n\r\n    // Set the parameters so we can render any size image.\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.CLAMP_TO_EDGE);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.CLAMP_TO_EDGE);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, this._gl.NEAREST);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, this._gl.NEAREST);\r\n    // Flip the texture when unpacking into the gl context, gl reads textures in the opposite order as everything else :/\r\n    this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, 1);\r\n    // Upload the image into the texture.\r\n    this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, image);\r\n\r\n    // lookup uniforms\r\n    const resolutionLocation = this._gl.getUniformLocation(this._program, 'u_resolution');\r\n\r\n    // set the resolution\r\n    this._gl.uniform2f(resolutionLocation, this._internalCanvas.width, this._internalCanvas.height);\r\n\r\n    // Create a buffer for the position of the rectangle corners.\r\n    const positionBuffer = this._gl.createBuffer();\r\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, positionBuffer);\r\n    this._gl.enableVertexAttribArray(positionLocation);\r\n    this._gl.vertexAttribPointer(positionLocation, 2, this._gl.FLOAT, false, 0, 0);\r\n\r\n    // Set a rectangle the same size as the image.\r\n    this._setRectangle(0, 0, image.width, image.height);\r\n\r\n    // Draw the rectangle.\r\n    this._gl.drawArrays(this._gl.TRIANGLES, 0, 6);\r\n\r\n    // Grab transformed image from internal canvas\r\n    const pixelData = new Uint8Array(image.width * image.height * 4);\r\n    this._gl.readPixels(0, 0, image.width, image.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, pixelData);\r\n\r\n    (<any>image.data).set(pixelData);\r\n\r\n    out.putImageData(image, 0, 0);\r\n  }\r\n}\r\n","import { Logger } from '../Util/Log';\r\nimport { Class } from '../Class';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Enum representing physical input key codes\r\n */\r\nexport enum Keys {\r\n  // NUMPAD\r\n  Num0 = 'Numpad0',\r\n  Num1 = 'Numpad1',\r\n  Num2 = 'Numpad2',\r\n  Num3 = 'Numpad3',\r\n  Num4 = 'Numpad4',\r\n  Num5 = 'Numpad5',\r\n  Num6 = 'Numpad6',\r\n  Num7 = 'Numpad7',\r\n  Num8 = 'Numpad8',\r\n  Num9 = 'Numpad9',\r\n  NumAdd = 'NumpadAdd',\r\n  NumSubtract = 'NumpadSubtract',\r\n  NumMultiply = 'NumpadMultiply',\r\n  NumDivide = 'NumpadDivide',\r\n  // NumComma = 'NumpadComma', // not x-browser\r\n  NumDecimal = 'NumpadDecimal',\r\n  Numpad0 = 'Numpad0',\r\n  Numpad1 = 'Numpad1',\r\n  Numpad2 = 'Numpad2',\r\n  Numpad3 = 'Numpad3',\r\n  Numpad4 = 'Numpad4',\r\n  Numpad5 = 'Numpad5',\r\n  Numpad6 = 'Numpad6',\r\n  Numpad7 = 'Numpad7',\r\n  Numpad8 = 'Numpad8',\r\n  Numpad9 = 'Numpad9',\r\n  NumpadAdd = 'NumpadAdd',\r\n  NumpadSubtract = 'NumpadSubtract',\r\n  NumpadMultiply = 'NumpadMultiply',\r\n  NumpadDivide = 'NumpadDivide',\r\n  // NumpadComma = 'NumpadComma', // not x-browser\r\n  NumpadDecimal = 'NumpadDecimal',\r\n\r\n  // MODIFIERS\r\n  NumLock = 'NumLock',\r\n  ShiftLeft = 'ShiftLeft',\r\n  ShiftRight = 'ShiftRight',\r\n  AltLeft = 'AltLeft',\r\n  AltRight = 'AltRight',\r\n\r\n  // NUMBERS\r\n  Key0 = 'Digit0',\r\n  Key1 = 'Digit1',\r\n  Key2 = 'Digit2',\r\n  Key3 = 'Digit3',\r\n  Key4 = 'Digit4',\r\n  Key5 = 'Digit5',\r\n  Key6 = 'Digit6',\r\n  Key7 = 'Digit7',\r\n  Key8 = 'Digit8',\r\n  Key9 = 'Digit9',\r\n  Digit0 = 'Digit0',\r\n  Digit1 = 'Digit1',\r\n  Digit2 = 'Digit2',\r\n  Digit3 = 'Digit3',\r\n  Digit4 = 'Digit4',\r\n  Digit5 = 'Digit5',\r\n  Digit6 = 'Digit6',\r\n  Digit7 = 'Digit7',\r\n  Digit8 = 'Digit8',\r\n  Digit9 = 'Digit9',\r\n\r\n  // LETTERS\r\n  A = 'KeyA',\r\n  B = 'KeyB',\r\n  C = 'KeyC',\r\n  D = 'KeyD',\r\n  E = 'KeyE',\r\n  F = 'KeyF',\r\n  G = 'KeyG',\r\n  H = 'KeyH',\r\n  I = 'KeyI',\r\n  J = 'KeyJ',\r\n  K = 'KeyK',\r\n  L = 'KeyL',\r\n  M = 'KeyM',\r\n  N = 'KeyN',\r\n  O = 'KeyO',\r\n  P = 'KeyP',\r\n  Q = 'KeyQ',\r\n  R = 'KeyR',\r\n  S = 'KeyS',\r\n  T = 'KeyT',\r\n  U = 'KeyU',\r\n  V = 'KeyV',\r\n  W = 'KeyW',\r\n  X = 'KeyX',\r\n  Y = 'KeyY',\r\n  Z = 'KeyZ',\r\n  KeyA = 'KeyA',\r\n  KeyB = 'KeyB',\r\n  KeyC = 'KeyC',\r\n  KeyD = 'KeyD',\r\n  KeyE = 'KeyE',\r\n  KeyF = 'KeyF',\r\n  KeyG = 'KeyG',\r\n  KeyH = 'KeyH',\r\n  KeyI = 'KeyI',\r\n  KeyJ = 'KeyJ',\r\n  KeyK = 'KeyK',\r\n  KeyL = 'KeyL',\r\n  KeyM = 'KeyM',\r\n  KeyN = 'KeyN',\r\n  KeyO = 'KeyO',\r\n  KeyP = 'KeyP',\r\n  KeyQ = 'KeyQ',\r\n  KeyR = 'KeyR',\r\n  KeyS = 'KeyS',\r\n  KeyT = 'KeyT',\r\n  KeyU = 'KeyU',\r\n  KeyV = 'KeyV',\r\n  KeyW = 'KeyW',\r\n  KeyX = 'KeyX',\r\n  KeyY = 'KeyY',\r\n  KeyZ = 'KeyZ',\r\n\r\n  // SYMBOLS\r\n  Semicolon = 'Semicolon',\r\n  Quote = 'Quote',\r\n  Comma = 'Comma',\r\n  Minus = 'Minus',\r\n  Period = 'Period',\r\n  Slash = 'Slash',\r\n  Equal = 'Equal',\r\n  BracketLeft = 'BracketLeft',\r\n  Backslash = 'Backslash',\r\n  BracketRight = 'BracketRight',\r\n  Backquote = 'Backquote',\r\n\r\n  // DIRECTIONS\r\n  Up = 'ArrowUp',\r\n  Down = 'ArrowDown',\r\n  Left = 'ArrowLeft',\r\n  Right = 'ArrowRight',\r\n  ArrowUp = 'ArrowUp',\r\n  ArrowDown = 'ArrowDown',\r\n  ArrowLeft = 'ArrowLeft',\r\n  ArrowRight = 'ArrowRight',\r\n\r\n  // OTHER\r\n  Space = 'Space',\r\n  Esc = 'Escape',\r\n  Escape = 'Escape'\r\n}\r\n\r\n/**\r\n * Event thrown on a game object for a key event\r\n */\r\nexport class KeyEvent extends Events.GameEvent<any> {\r\n  /**\r\n   * @param key  The key responsible for throwing the event\r\n   * @param value The key's typed value the browser detected\r\n   * @param originalEvent The original keyboard event that Excalibur handled\r\n   */\r\n  constructor(public key: Keys, public value?: string, public originalEvent?: KeyboardEvent) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Provides keyboard support for Excalibur.\r\n */\r\nexport class Keyboard extends Class {\r\n  private _keys: Keys[] = [];\r\n  private _keysUp: Keys[] = [];\r\n  private _keysDown: Keys[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Initialize Keyboard event listeners\r\n   */\r\n  init(global?: GlobalEventHandlers): void {\r\n    if (!global) {\r\n      try {\r\n        // Try and listen to events on top window frame if within an iframe.\r\n        //\r\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\r\n        //\r\n        // Attempt to add an event listener, which triggers a DOMException on\r\n        // cross-origin iframes\r\n        const noop = () => {\r\n          return;\r\n        };\r\n        window.top.addEventListener('blur', noop);\r\n        window.top.removeEventListener('blur', noop);\r\n\r\n        // this will be the same as window if not embedded within an iframe\r\n        global = window.top;\r\n      } catch {\r\n        // fallback to current frame\r\n        global = window;\r\n\r\n        Logger.getInstance().warn(\r\n          'Failed to bind to keyboard events to top frame. ' +\r\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\r\n        );\r\n      }\r\n    }\r\n\r\n    global.addEventListener('blur', () => {\r\n      this._keys.length = 0; // empties array efficiently\r\n    });\r\n\r\n    // key up is on window because canvas cannot have focus\r\n    global.addEventListener('keyup', (ev: KeyboardEvent) => {\r\n      const code = ev.code as Keys;\r\n      const key = this._keys.indexOf(code);\r\n      this._keys.splice(key, 1);\r\n      this._keysUp.push(code);\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n\r\n      // alias the old api, we may want to deprecate this in the future\r\n      this.eventDispatcher.emit('up', keyEvent);\r\n      this.eventDispatcher.emit('release', keyEvent);\r\n    });\r\n\r\n    // key down is on window because canvas cannot have focus\r\n    global.addEventListener('keydown', (ev: KeyboardEvent) => {\r\n      const code = ev.code as Keys;\r\n      if (this._keys.indexOf(code) === -1) {\r\n        this._keys.push(code);\r\n        this._keysDown.push(code);\r\n        const keyEvent = new KeyEvent(code, ev.key, ev);\r\n        this.eventDispatcher.emit('down', keyEvent);\r\n        this.eventDispatcher.emit('press', keyEvent);\r\n      }\r\n    });\r\n  }\r\n\r\n  public update() {\r\n    // Reset keysDown and keysUp after update is complete\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n\r\n    // Emit synthetic \"hold\" event\r\n    for (let i = 0; i < this._keys.length; i++) {\r\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets list of keys being pressed down\r\n   */\r\n  public getKeys(): Keys[] {\r\n    return this._keys;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param key Test whether a key was just pressed\r\n   */\r\n  public wasPressed(key: Keys): boolean {\r\n    return this._keysDown.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key is held down. This is persisted between frames.\r\n   * @param key  Test whether a key is held down\r\n   */\r\n  public isHeld(key: Keys): boolean {\r\n    return this._keys.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\r\n   * @param key  Test whether a key was just released\r\n   */\r\n  public wasReleased(key: Keys): boolean {\r\n    return this._keysUp.indexOf(key) > -1;\r\n  }\r\n}\r\n","import { Actor } from '../Actor';\r\nimport { Vector } from '../Math/vector';\r\nimport { Class } from '../Class';\r\nimport * as Actors from '../Util/Actors';\r\nimport { removeItemFromArray } from '../Util/Util';\r\nimport { PointerMoveEvent, PointerDownEvent, PointerUpEvent, WheelEvent } from './PointerEvents';\r\n\r\nexport interface ActorsUnderPointer {\r\n  [ActorId: number]: Actor;\r\n  length: number;\r\n}\r\n\r\n/**\r\n * The type of pointer for a [[PointerEvent]].\r\n */\r\nexport enum PointerType {\r\n  Touch = 'Touch',\r\n  Mouse = 'Mouse',\r\n  Pen = 'Pen',\r\n  Unknown = 'Unknown'\r\n}\r\n\r\n/**\r\n * Determines the scope of handling mouse/touch events. See [[Pointers]] for more information.\r\n */\r\nexport enum PointerScope {\r\n  /**\r\n   * Handle events on the `canvas` element only. Events originating outside the\r\n   * `canvas` will not be handled.\r\n   */\r\n  Canvas = 'Canvas',\r\n\r\n  /**\r\n   * Handles events on the entire document. All events will be handled by Excalibur.\r\n   */\r\n  Document = 'Document'\r\n}\r\n\r\n/**\r\n * Captures and dispatches PointerEvents\r\n */\r\nexport class Pointer extends Class {\r\n  private static _MAX_ID = 0;\r\n  public readonly id = Pointer._MAX_ID++;\r\n  private _isDown: boolean = false;\r\n  private _wasDown: boolean = false;\r\n\r\n  private _actorsUnderPointer: ActorsUnderPointer = { length: 0 };\r\n\r\n  private _actors: Actor[] = [];\r\n  private _actorsLastFrame: Actor[] = [];\r\n  private _actorsNoLongerUnderPointer: Actor[] = [];\r\n\r\n  private _actorSortingFcn = (a: Actor, b: Actor) => {\r\n    if (a.z === b.z) {\r\n      return b.id - a.id;\r\n    }\r\n    return b.z - a.z;\r\n  };\r\n\r\n  /**\r\n   * Whether the Pointer is currently dragging.\r\n   */\r\n  public get isDragging(): boolean {\r\n    return this._isDown;\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just started dragging.\r\n   */\r\n  public get isDragStart(): boolean {\r\n    return !this._wasDown && this._isDown;\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just ended dragging.\r\n   */\r\n  public get isDragEnd(): boolean {\r\n    return this._wasDown && !this._isDown;\r\n  }\r\n\r\n  /**\r\n   * Returns true if pointer has any actors under\r\n   */\r\n  public get hasActorsUnderPointer(): boolean {\r\n    return !!this._actorsUnderPointer.length;\r\n  }\r\n\r\n  /**\r\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastPagePos: Vector = null;\r\n\r\n  /**\r\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastScreenPos: Vector = null;\r\n\r\n  /**\r\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastWorldPos: Vector = null;\r\n\r\n  /**\r\n   * Returns the currently dragging target or null if it isn't exist\r\n   */\r\n  public dragTarget: Actor = null;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.on('move', this._onPointerMove);\r\n    this.on('down', this._onPointerDown);\r\n    this.on('up', this._onPointerUp);\r\n  }\r\n\r\n  on(event: 'move', handler: (event: PointerMoveEvent) => void): void;\r\n  on(event: 'down', handler: (event: PointerDownEvent) => void): void;\r\n  on(event: 'up', handler: (event: PointerUpEvent) => void): void;\r\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  on(event: string, handler: (event: any) => void): void {\r\n    super.on(event, handler);\r\n  }\r\n\r\n  once(event: 'move', handler: (event: PointerMoveEvent) => void): void;\r\n  once(event: 'down', handler: (event: PointerDownEvent) => void): void;\r\n  once(event: 'up', handler: (event: PointerUpEvent) => void): void;\r\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  once(event: string, handler: (event: any) => void): void {\r\n    super.once(event, handler);\r\n  }\r\n\r\n  off(event: 'move', handler?: (event: PointerMoveEvent) => void): void;\r\n  off(event: 'down', handler?: (event: PointerDownEvent) => void): void;\r\n  off(event: 'up', handler?: (event: PointerUpEvent) => void): void;\r\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\r\n  off(event: string, handler?: (event: any) => void): void {\r\n    super.off(event, handler);\r\n  }\r\n\r\n  /**\r\n   * Update the state of current pointer, meant to be called a the end of frame\r\n   */\r\n  public update(): void {\r\n    if (this._wasDown && !this._isDown) {\r\n      this._wasDown = false;\r\n    } else if (!this._wasDown && this._isDown) {\r\n      this._wasDown = true;\r\n    }\r\n    this._actorsLastFrame = [...this._actors];\r\n    this._actorsNoLongerUnderPointer = [];\r\n  }\r\n\r\n  /**\r\n   * Adds an Actor to actorsUnderPointer object.\r\n   * @param actor An Actor to be added;\r\n   */\r\n  public addActorUnderPointer(actor: Actor): void {\r\n    if (!this.isActorAliveUnderPointer(actor)) {\r\n      this._actorsUnderPointer[actor.id] = actor;\r\n      this._actorsUnderPointer.length += 1;\r\n      this._actors.push(actor);\r\n    }\r\n\r\n    // Actors are processed in z-order highest z to lowest\r\n    // ties are broken by id highest id (newest) to lowest id (oldest)\r\n    this._actors.sort(this._actorSortingFcn);\r\n  }\r\n\r\n  /**\r\n   * Removes an Actor from actorsUnderPointer object.\r\n   * @param actor An Actor to be removed;\r\n   */\r\n  public removeActorUnderPointer(actor: Actor): void {\r\n    if (this.isActorAliveUnderPointer(actor)) {\r\n      delete this._actorsUnderPointer[actor.id];\r\n      this._actorsUnderPointer.length -= 1;\r\n      removeItemFromArray(actor, this._actors);\r\n      this._actorsNoLongerUnderPointer.push(actor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns all actors under this pointer this frame\r\n   */\r\n  public getActorsUnderPointer(): Actor[] {\r\n    return this._actors;\r\n  }\r\n\r\n  /**\r\n   * Returns all actors that are no longer under the pointer this frame\r\n   */\r\n  public getActorsUnderPointerLastFrame(): Actor[] {\r\n    return this._actorsLastFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns all actors relevant for events to pointer this frame\r\n   */\r\n  public getActorsForEvents(): Actor[] {\r\n    return this._actors\r\n      .concat(this._actorsLastFrame)\r\n      .filter((actor, i, self) => {\r\n        return self.indexOf(actor) === i; // de-dup\r\n      })\r\n      .sort(this._actorSortingFcn); // sort by z\r\n  }\r\n\r\n  /**\r\n   * Checks if Pointer location has a specific Actor bounds contained underneath.\r\n   * @param actor An Actor for check;\r\n   */\r\n  public checkActorUnderPointer(actor: Actor): boolean {\r\n    if (this.lastWorldPos) {\r\n      return actor.contains(this.lastWorldPos.x, this.lastWorldPos.y, !Actors.isScreenElement(actor));\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Checks if an actor was under the pointer last frame\r\n   * @param actor\r\n   */\r\n  public wasActorUnderPointer(actor: Actor): boolean {\r\n    return this._actorsLastFrame.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Checks if Pointer has a specific Actor in ActorsUnderPointer list.\r\n   * @param actor An Actor for check;\r\n   */\r\n  public isActorAliveUnderPointer(actor: Actor): boolean {\r\n    return !!(!actor.isKilled() && actor.scene && this._actorsUnderPointer.hasOwnProperty(actor.id.toString()));\r\n  }\r\n\r\n  private _onPointerMove(ev: PointerMoveEvent): void {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  }\r\n\r\n  private _onPointerDown(ev: PointerDownEvent): void {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n    this._isDown = true;\r\n  }\r\n\r\n  private _onPointerUp(_ev: PointerUpEvent): void {\r\n    this._isDown = false;\r\n    this.dragTarget = null;\r\n  }\r\n}\r\n","import { Actor } from '../Actor';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Vector } from '../Math/vector';\r\nimport { Pointer, PointerType } from './Pointer';\r\nimport { GameEvent } from '../Events';\r\n\r\n/**\r\n * Native browser button enumeration\r\n */\r\nexport enum NativePointerButton {\r\n  NoButton = -1,\r\n  Left = 0,\r\n  Middle = 1,\r\n  Right = 2,\r\n  Unknown = 3\r\n}\r\n\r\n/**\r\n * The mouse button being pressed.\r\n */\r\nexport enum PointerButton {\r\n  Left = 'Left',\r\n  Middle = 'Middle',\r\n  Right = 'Right',\r\n  Unknown = 'Unknown',\r\n  NoButton = 'NoButton'\r\n}\r\n\r\nexport enum WheelDeltaMode {\r\n  Pixel = 'Pixel',\r\n  Line = 'Line',\r\n  Page = 'Page'\r\n}\r\n\r\n/**\r\n * Type that indicates Excalibur's valid synthetic pointer events\r\n */\r\nexport type PointerEventName =\r\n  | 'pointerdragstart'\r\n  | 'pointerdragend'\r\n  | 'pointerdragmove'\r\n  | 'pointerdragenter'\r\n  | 'pointerdragleave'\r\n  | 'pointermove'\r\n  | 'pointerenter'\r\n  | 'pointerleave'\r\n  | 'pointerup'\r\n  | 'pointerdown';\r\n\r\n/**\r\n * Pointer events\r\n *\r\n * Represents a mouse, touch, or stylus event. See [[Pointers]] for more information on\r\n * handling pointer input.\r\n *\r\n * For mouse-based events, you can inspect [[PointerEvent.button]] to see what button was pressed.\r\n */\r\nexport class PointerEvent extends GameEvent<Actor> {\r\n  protected _name: string;\r\n\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /** The world coordinates of the event. */\r\n  public get worldPos(): Vector {\r\n    return this.coordinates.worldPos.clone();\r\n  }\r\n\r\n  /** The page coordinates of the event. */\r\n  public get pagePos(): Vector {\r\n    return this.coordinates.pagePos.clone();\r\n  }\r\n\r\n  /** The screen coordinates of the event. */\r\n  public get screenPos(): Vector {\r\n    return this.coordinates.screenPos.clone();\r\n  }\r\n\r\n  /**\r\n   * @param coordinates         The [[GlobalCoordinates]] of the event\r\n   * @param pointer             The [[Pointer]] of the event\r\n   * @param index               The index of the pointer (zero-based)\r\n   * @param pointerType         The type of pointer\r\n   * @param button              The button pressed (if [[PointerType.Mouse]])\r\n   * @param ev                  The raw DOM event being handled\r\n   */\r\n  constructor(\r\n    protected coordinates: GlobalCoordinates,\r\n    public pointer: Pointer,\r\n    public index: number,\r\n    public pointerType: PointerType,\r\n    public button: PointerButton,\r\n    public ev: any\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  public get pos(): Vector {\r\n    return this.coordinates.worldPos.clone();\r\n  }\r\n\r\n  public _canceled = false;\r\n\r\n  /**\r\n   * Cancels pointer event propogation, event will not be transmitted to any other actors\r\n   */\r\n  public cancel() {\r\n    this._canceled = true;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns If the event is canceled it will no longer be transmitted to any other actors\r\n   */\r\n  public isCanceled() {\r\n    return this._canceled;\r\n  }\r\n\r\n  public propagate(actor: Actor): void {\r\n    this.doAction(actor);\r\n\r\n    if (this.bubbles && !this.isCanceled() && actor.parent) {\r\n      this.propagate(actor.parent as Actor); // TODO not true\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public doAction(actor: Actor): void {\r\n    if (actor) {\r\n      this._onActionStart(actor);\r\n      actor.emit(this._name, this);\r\n      this._onActionEnd(actor);\r\n    }\r\n  }\r\n\r\n  protected _onActionStart(_actor?: Actor) {\r\n    // to be rewritten\r\n  }\r\n\r\n  protected _onActionEnd(_actor?: Actor) {\r\n    // to be rewritten\r\n  }\r\n}\r\n\r\nexport class PointerEventFactory<T extends PointerEvent> {\r\n  constructor(\r\n    protected _pointerEventType: new (\r\n      coordinates: GlobalCoordinates,\r\n      pointer: Pointer,\r\n      index: number,\r\n      pointerType: PointerType,\r\n      button: PointerButton,\r\n      ev: any\r\n    ) => T\r\n  ) {}\r\n\r\n  /**\r\n   * Create specific PointerEvent\r\n   */\r\n  public create(\r\n    coordinates: GlobalCoordinates,\r\n    pointer: Pointer,\r\n    index: number,\r\n    pointerType: PointerType,\r\n    button: PointerButton,\r\n    ev: any\r\n  ): T {\r\n    return new this._pointerEventType(coordinates, pointer, index, pointerType, button, ev);\r\n  }\r\n}\r\n\r\nexport class PointerDragEvent extends PointerEvent {}\r\n\r\nexport class PointerUpEvent extends PointerEvent {\r\n  protected _name = 'pointerup';\r\n\r\n  protected _onActionEnd(actor: Actor) {\r\n    const pointer = this.pointer;\r\n\r\n    if (pointer.isDragEnd && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragend', this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class PointerDownEvent extends PointerEvent {\r\n  protected _name = 'pointerdown';\r\n\r\n  protected _onActionEnd(actor: Actor) {\r\n    if (this.pointer.isDragStart && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragstart', this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class PointerMoveEvent extends PointerEvent {\r\n  protected _name = 'pointermove';\r\n\r\n  public propagate(actor: Actor): void {\r\n    // If the actor was under the pointer last frame, but not this one it left\r\n    // if (this.pointer.wasActorUnderPointer(actor) && !this.pointer.isActorUnderPointer(actor)) {\r\n    //   this._onActorLeave(actor);\r\n    //   return;\r\n    // }\r\n\r\n    if (this.pointer.isActorAliveUnderPointer(actor)) {\r\n      this.doAction(actor);\r\n\r\n      if (this.bubbles && !this.isCanceled() && actor.parent) {\r\n        this.propagate(actor.parent as Actor); // TODO not true\r\n      }\r\n    }\r\n  }\r\n\r\n  protected _onActionStart(actor: Actor) {\r\n    if (!actor.capturePointer.captureMoveEvents) {\r\n      return;\r\n    }\r\n\r\n    // In the case this is new\r\n    // if (this.pointer.checkActorUnderPointer(actor) && !this.pointer.wasActorUnderPointer(actor)) {\r\n    //   this._onActorEnter(actor);\r\n    // }\r\n\r\n    if (this.pointer.isDragging && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragmove', this);\r\n    }\r\n  }\r\n\r\n  // private _onActorEnter(actor: Actor) {\r\n  //   const pe = createPointerEventByName('enter', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\r\n  //   pe.propagate(actor);\r\n  //   this.pointer.addActorUnderPointer(actor);\r\n\r\n  //   if (this.pointer.isDragging) {\r\n  //     this.pointer.dragTarget = actor;\r\n  //   }\r\n  // }\r\n\r\n  // private _onActorLeave(actor: Actor) {\r\n  //   const pe = createPointerEventByName('leave', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\r\n  //   pe.propagate(actor);\r\n  //   this.pointer.removeActorUnderPointer(actor);\r\n  // }\r\n}\r\n\r\nexport class PointerEnterEvent extends PointerEvent {\r\n  protected _name = 'pointerenter';\r\n\r\n  protected _onActionStart(actor: Actor) {\r\n    if (!actor.capturePointer.captureMoveEvents) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  protected _onActionEnd(actor: Actor) {\r\n    const pointer = this.pointer;\r\n\r\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragenter', this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class PointerLeaveEvent extends PointerEvent {\r\n  protected _name = 'pointerleave';\r\n\r\n  protected _onActionStart(actor: Actor) {\r\n    if (!actor.capturePointer.captureMoveEvents) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  protected _onActionEnd(actor: Actor) {\r\n    const pointer = this.pointer;\r\n\r\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragleave', this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class PointerCancelEvent extends PointerEvent {\r\n  protected _name = 'pointercancel';\r\n}\r\n/**\r\n * Wheel Events\r\n *\r\n * Represents a mouse wheel event. See [[Pointers]] for more information on\r\n * handling point input.\r\n */\r\nexport class WheelEvent extends GameEvent<Actor> {\r\n  /**\r\n   * @param x            The `x` coordinate of the event (in world coordinates)\r\n   * @param y            The `y` coordinate of the event (in world coordinates)\r\n   * @param pageX        The `x` coordinate of the event (in document coordinates)\r\n   * @param pageY        The `y` coordinate of the event (in document coordinates)\r\n   * @param screenX      The `x` coordinate of the event (in screen coordinates)\r\n   * @param screenY      The `y` coordinate of the event (in screen coordinates)\r\n   * @param index        The index of the pointer (zero-based)\r\n   * @param deltaX       The type of pointer\r\n   * @param deltaY       The type of pointer\r\n   * @param deltaZ       The type of pointer\r\n   * @param deltaMode    The type of movement [[WheelDeltaMode]]\r\n   * @param ev           The raw DOM event being handled\r\n   */\r\n  constructor(\r\n    public x: number,\r\n    public y: number,\r\n    public pageX: number,\r\n    public pageY: number,\r\n    public screenX: number,\r\n    public screenY: number,\r\n    public index: number,\r\n    public deltaX: number,\r\n    public deltaY: number,\r\n    public deltaZ: number,\r\n    public deltaMode: WheelDeltaMode,\r\n    public ev: any\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  private _isCanceled = false;\r\n\r\n  /**\r\n   * Cancels pointer event propogation, event will not be transmitted to any other actors\r\n   */\r\n  public cancel() {\r\n    this._isCanceled = true;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns If the event is canceled it will no longer be transmitted to any other actors\r\n   */\r\n  public isCanceled() {\r\n    return this._isCanceled;\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function createPointerEventByName(\r\n  eventName: string,\r\n  coordinates: GlobalCoordinates,\r\n  pointer: Pointer,\r\n  index: number,\r\n  pointerType: PointerType,\r\n  button: PointerButton,\r\n  ev: any\r\n) {\r\n  let factory: PointerEventFactory<PointerEvent>;\r\n\r\n  switch (eventName) {\r\n    case 'up':\r\n      factory = new PointerEventFactory(<any>PointerUpEvent);\r\n      break;\r\n    case 'down':\r\n      factory = new PointerEventFactory(<any>PointerDownEvent);\r\n      break;\r\n    case 'move':\r\n      factory = new PointerEventFactory(<any>PointerMoveEvent);\r\n      break;\r\n    case 'cancel':\r\n      factory = new PointerEventFactory(<any>PointerCancelEvent);\r\n      break;\r\n    case 'enter':\r\n      factory = new PointerEventFactory(<any>PointerEnterEvent);\r\n      break;\r\n    case 'leave':\r\n      factory = new PointerEventFactory(<any>PointerLeaveEvent);\r\n      break;\r\n  }\r\n\r\n  return factory.create(coordinates, pointer, index, pointerType, button, ev);\r\n}\r\n","import { ScreenElement } from './ScreenElement';\r\nimport {\r\n  InitializeEvent,\r\n  ActivateEvent,\r\n  DeactivateEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  GameEvent\r\n} from './Events';\r\nimport { Logger } from './Util/Log';\r\nimport { Timer } from './Timer';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Camera } from './Camera';\r\nimport { Actor } from './Actor';\r\nimport { Class } from './Class';\r\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\r\nimport * as Util from './Util/Util';\r\nimport * as Events from './Events';\r\nimport * as ActorUtils from './Util/Actors';\r\nimport { Trigger } from './Trigger';\r\nimport { SystemType } from './EntityComponentSystem/System';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { World } from './EntityComponentSystem/World';\r\nimport { MotionSystem } from './Collision/MotionSystem';\r\nimport { CollisionSystem } from './Collision/CollisionSystem';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\r\nimport { CanvasDrawingSystem } from './Drawing/CanvasDrawingSystem';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { DebugSystem } from './Debug/DebugSystem';\r\nimport { ActionsSystem } from './Actions/ActionsSystem';\r\n/**\r\n * [[Actor|Actors]] are composed together into groupings called Scenes in\r\n * Excalibur. The metaphor models the same idea behind real world\r\n * actors in a scene. Only actors in scenes will be updated and drawn.\r\n *\r\n * Typical usages of a scene include: levels, menus, loading screens, etc.\r\n */\r\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Gets or sets the current camera for the scene\r\n   */\r\n  public camera: Camera = new Camera();\r\n\r\n  /**\r\n   * The ECS world for the scene\r\n   */\r\n  public world = new World(this);\r\n\r\n  /**\r\n   * The actors in the current scene\r\n   */\r\n  public get actors(): Actor[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Actor;\r\n    }) as Actor[];\r\n  }\r\n\r\n  /**\r\n   * The entities in the current scene\r\n   */\r\n  public get entities(): Entity[] {\r\n    return this.world.entityManager.entities;\r\n  }\r\n\r\n  /**\r\n   * The triggers in the current scene\r\n   */\r\n  public get triggers(): Trigger[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Trigger;\r\n    }) as Trigger[];\r\n  }\r\n\r\n  /**\r\n   * The [[TileMap]]s in the scene, if any\r\n   */\r\n  public get tileMaps(): TileMap[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof TileMap;\r\n    }) as TileMap[];\r\n  }\r\n\r\n  /**\r\n   * Access to the Excalibur engine\r\n   */\r\n  public engine: Engine;\r\n\r\n  /**\r\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\r\n   * @deprecated Use [[Scene.actors]]\r\n   */\r\n  @obsolete({\r\n    message: 'Will be removed in excalibur v0.26.0',\r\n    alternateMethod: 'ScreenElements now are normal actors with a Transform Coordinate Plane of Screen'\r\n  })\r\n  public get screenElements(): ScreenElement[] {\r\n    return this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n  }\r\n\r\n  private _isInitialized: boolean = false;\r\n  private _timers: Timer[] = [];\r\n  private _cancelQueue: Timer[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n    // TODO how to people do there own systems\r\n    // Initialize systems\r\n    this.world.add(new ActionsSystem());\r\n    this.world.add(new MotionSystem());\r\n    this.world.add(new CollisionSystem());\r\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\r\n      this.world.add(new CanvasDrawingSystem());\r\n    } else {\r\n      this.world.add(new GraphicsSystem());\r\n    }\r\n    this.world.add(new DebugSystem());\r\n  }\r\n\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\r\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\r\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\r\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made active and started. It is meant to be overridden,\r\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\r\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before a scene is drawn.\r\n   */\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after a scene is drawn.\r\n   */\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Initializes actors in the scene\r\n   */\r\n  private _initializeChildren(): void {\r\n    for (const child of this.entities) {\r\n      child._initialize(this.engine);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets whether or not the [[Scene]] has been initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Initializes the scene before the first update, meant to be called by engine not by users of\r\n   * Excalibur\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.engine = engine;\r\n      // Initialize camera first\r\n      this.camera._initialize(engine);\r\n\r\n      // This order is important! we want to be sure any custom init that add actors\r\n      // fire before the actor init\r\n      this.onInitialize.call(this, engine);\r\n      this._initializeChildren();\r\n\r\n      this._logger.debug('Scene.onInitialize', this, engine);\r\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\r\n   * @internal\r\n   */\r\n  public _activate(oldScene: Scene, newScene: Scene): void {\r\n    this._logger.debug('Scene.onActivate', this);\r\n    this.onActivate(oldScene, newScene);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\r\n   * @internal\r\n   */\r\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\r\n    this._logger.debug('Scene.onDeactivate', this);\r\n    this.onDeactivate(oldScene, newScene);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(_engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\r\n    this.onPreUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(_engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\r\n    this.onPostUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\r\n    this.onPreDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\r\n    this.onPostDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\r\n   * @param engine  Reference to the current Engine\r\n   * @param delta   The number of milliseconds since the last update\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._preupdate(engine, delta);\r\n    if (this.camera) {\r\n      this.camera.update(engine, delta);\r\n    }\r\n    // TODO differed entity removal for timers\r\n    let i: number, len: number;\r\n    // Remove timers in the cancel queue before updating them\r\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\r\n      this.removeTimer(this._cancelQueue[i]);\r\n    }\r\n    this._cancelQueue.length = 0;\r\n\r\n    // Cycle through timers updating timers\r\n    for (const timer of this._timers) {\r\n      timer.update(delta);\r\n    }\r\n\r\n    this.world.update(SystemType.Update, delta);\r\n\r\n    this._collectActorStats(engine);\r\n\r\n    engine.input.pointers.dispatchPointerEvents();\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors in the Scene. Called by the [[Engine]].\r\n   * @param ctx    The current rendering context\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n    this._predraw(ctx, delta);\r\n\r\n    this.world.update(SystemType.Draw, delta);\r\n\r\n    if (this.engine?.isDebug) {\r\n      this.debugDraw(ctx);\r\n    }\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\r\n   * @param ctx  The current rendering context\r\n   * @deprecated\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\r\n    // pass\r\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\r\n  }\r\n\r\n  /**\r\n   * Checks whether an actor is contained in this scene or not\r\n   */\r\n  public contains(actor: Actor): boolean {\r\n    return this.actors.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the current [[Scene]].\r\n   * @param timer  The timer to add to the current [[Scene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\r\n   * @param trigger\r\n   */\r\n  public add(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\r\n   * @param actor  The actor to add to the current scene\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the scene.\r\n   * @param screenElement  The ScreenElement to add to the current scene\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    this.emit('entityadded', { target: entity } as any);\r\n    this.world.add(entity);\r\n    entity.scene = this;\r\n    if (entity instanceof Timer) {\r\n      if (!Util.contains(this._timers, entity)) {\r\n        this.addTimer(entity);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\r\n   * @param timer  The timer to remove to the current scene.\r\n   */\r\n  public remove(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @param tileMap {TileMap}\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes an actor from the scene, it will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the current scene.\r\n   */\r\n  public remove(actor: Actor): void;\r\n\r\n  public remove(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the current scene\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.emit('entityremoved', { target: entity } as any);\r\n      this.world.remove(entity);\r\n    }\r\n    if (entity instanceof Timer) {\r\n      this.removeTimer(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\r\n   * in screen coordinates. UI actors do not participate in collisions.\r\n   * @todo Should this be `ScreenElement` only?\r\n   * @deprecated Use [[Scene.add]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\r\n  public addScreenElement(actor: Actor) {\r\n    this.add(actor);\r\n  }\r\n\r\n  /**\r\n   * Removes an actor as a piece of UI\r\n   * @deprecated Use [[Scene.remove]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\r\n  public removeScreenElement(actor: Actor) {\r\n    this.remove(actor);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\r\n   * @deprecated Use [[Scene.add]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\r\n  public addTileMap(tileMap: TileMap) {\r\n    this.world.add(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @deprecated Use [[Scene.remove]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\r\n  public removeTileMap(tileMap: TileMap) {\r\n    this.world.remove(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the scene\r\n   * @param timer  The timer to add\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    this._timers.push(timer);\r\n    timer.scene = this;\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the scene.\r\n   * @warning Can be dangerous, use [[cancelTimer]] instead\r\n   * @param timer  The timer to remove\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    const i = this._timers.indexOf(timer);\r\n    if (i !== -1) {\r\n      this._timers.splice(i, 1);\r\n    }\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Cancels a [[Timer]], removing it from the scene nicely\r\n   * @param timer  The timer to cancel\r\n   */\r\n  public cancelTimer(timer: Timer): Timer {\r\n    this._cancelQueue.push(timer);\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a [[Timer]] is active in the scene\r\n   */\r\n  public isTimerActive(timer: Timer): boolean {\r\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\r\n  }\r\n\r\n  public isCurrentScene(): boolean {\r\n    if (this.engine) {\r\n      return this.engine.currentScene === this;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _collectActorStats(engine: Engine) {\r\n    const screenElements = this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n    for (const _ui of screenElements) {\r\n      engine.stats.currFrame.actors.ui++;\r\n    }\r\n\r\n    for (const actor of this.actors) {\r\n      engine.stats.currFrame.actors.alive++;\r\n      for (const child of actor.children) {\r\n        if (ActorUtils.isScreenElement(child as Actor)) {\r\n          // TODO not true\r\n          engine.stats.currFrame.actors.ui++;\r\n        } else {\r\n          engine.stats.currFrame.actors.alive++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { ColorBlindCorrector, ColorBlindness } from '../PostProcessing/Index';\r\n\r\nexport interface DebugFlags {\r\n  colorBlindMode: ColorBlindFlags;\r\n}\r\n\r\nexport class ColorBlindFlags {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n  }\r\n\r\n  public correct(colorBlindness: ColorBlindness) {\r\n    this._engine.postProcessors.push(new ColorBlindCorrector(this._engine, false, colorBlindness));\r\n  }\r\n\r\n  public simulate(colorBlindness: ColorBlindness) {\r\n    this._engine.postProcessors.push(new ColorBlindCorrector(this._engine, true, colorBlindness));\r\n  }\r\n}\r\n","import { DebugFlags, ColorBlindFlags } from './DebugFlags';\r\nimport { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\r\n\r\n/**\r\n * Debug stats containing current and previous frame statistics\r\n */\r\nexport interface DebugStats {\r\n  currFrame: FrameStats;\r\n  prevFrame: FrameStats;\r\n}\r\n\r\n/**\r\n * Represents a frame's individual statistics\r\n */\r\nexport interface FrameStatistics {\r\n  /**\r\n   * The number of the frame\r\n   */\r\n  id: number;\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\r\n   */\r\n  delta: number;\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  fps: number;\r\n\r\n  /**\r\n   * Duration statistics (in ms)\r\n   */\r\n  duration: FrameDurationStats;\r\n\r\n  /**\r\n   * Actor statistics\r\n   */\r\n  actors: FrameActorStats;\r\n\r\n  /**\r\n   * Physics statistics\r\n   */\r\n  physics: PhysicsStatistics;\r\n\r\n  /**\r\n   * Graphics statistics\r\n   */\r\n  graphics: GraphicsStatistics;\r\n}\r\n\r\n/**\r\n * Represents actor stats for a frame\r\n */\r\nexport interface FrameActorStats {\r\n  /**\r\n   * Gets the frame's number of actors (alive)\r\n   */\r\n  alive: number;\r\n\r\n  /**\r\n   * Gets the frame's number of actors (killed)\r\n   */\r\n  killed: number;\r\n\r\n  /**\r\n   * Gets the frame's number of remaining actors (alive - killed)\r\n   */\r\n  remaining: number;\r\n\r\n  /**\r\n   * Gets the frame's number of UI actors\r\n   */\r\n  ui: number;\r\n\r\n  /**\r\n   * Gets the frame's number of total actors (remaining + UI)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents duration stats for a frame\r\n */\r\nexport interface FrameDurationStats {\r\n  /**\r\n   * Gets the frame's total time to run the update function (in ms)\r\n   */\r\n  update: number;\r\n\r\n  /**\r\n   * Gets the frame's total time to run the draw function (in ms)\r\n   */\r\n  draw: number;\r\n\r\n  /**\r\n   * Gets the frame's total render duration (update + draw duration) (in ms)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents physics stats for the current frame\r\n */\r\nexport interface PhysicsStatistics {\r\n  /**\r\n   * Gets the number of broadphase collision pairs which\r\n   */\r\n  pairs: number;\r\n\r\n  /**\r\n   * Gets the number of actual collisions\r\n   */\r\n  collisions: number;\r\n\r\n  /**\r\n   * Copy of the current frame contacts (only updated if debug is toggled on)\r\n   */\r\n  contacts: Map<string, CollisionContact>;\r\n\r\n  /**\r\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\r\n   */\r\n  fastBodies: number;\r\n\r\n  /**\r\n   * Gets the number of bodies that had a fast body collision resolution\r\n   */\r\n  fastBodyCollisions: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the broadphase pairs\r\n   */\r\n  broadphase: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the narrowphase\r\n   */\r\n  narrowphase: number;\r\n}\r\n\r\nexport interface GraphicsStatistics {\r\n  drawCalls: number;\r\n  drawnImages: number;\r\n}\r\n\r\n/**\r\n * Debug statistics and flags for Excalibur. If polling these values, it would be\r\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\r\n * updated during a frame.\r\n */\r\nexport class Debug implements DebugFlags {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n\r\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\r\n  }\r\n\r\n  /**\r\n   * Performance statistics\r\n   */\r\n  public stats: DebugStats = {\r\n    /**\r\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\r\n     */\r\n    currFrame: new FrameStats(),\r\n\r\n    /**\r\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\r\n     */\r\n    prevFrame: new FrameStats()\r\n  };\r\n\r\n  /**\r\n   * Correct or simulate color blindness using [[ColorBlindness]] post processor.\r\n   * @warning Will reduce FPS.\r\n   */\r\n  public colorBlindMode: ColorBlindFlags;\r\n\r\n  /**\r\n   * Filter debug context to named entities or entity ids\r\n   */\r\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\r\n    /**\r\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\r\n     */\r\n    useFilter: false,\r\n    /**\r\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\r\n     */\r\n    nameQuery: '',\r\n    /**\r\n     * Query for Entity ids, if the id matches it will be included\r\n     */\r\n    ids: []\r\n  };\r\n\r\n  /**\r\n   * Entity debug settings\r\n   */\r\n  public entity = {\r\n    showAll: false,\r\n    showId: true,\r\n    showName: false\r\n  };\r\n\r\n  /**\r\n   * Transform component debug settings\r\n   */\r\n  public transform = {\r\n    showAll: false,\r\n\r\n    showPosition: false,\r\n    positionColor: Color.Yellow,\r\n\r\n    showScale: false,\r\n    scaleColor: Color.Green,\r\n\r\n    showRotation: false,\r\n    rotationColor: Color.Blue\r\n  };\r\n\r\n  /**\r\n   * Graphics component debug settings\r\n   */\r\n  public graphics = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Yellow\r\n  };\r\n\r\n  /**\r\n   * Collider component debug settings\r\n   */\r\n  public collider = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Blue,\r\n\r\n    showOwner: false,\r\n\r\n    showGeometry: true,\r\n    geometryColor: Color.Green\r\n  };\r\n\r\n  /**\r\n   * Physics simulation debug settings\r\n   */\r\n  public physics = {\r\n    showAll: false,\r\n\r\n    showBroadphaseSpacePartitionDebug: false,\r\n\r\n    showCollisionNormals: false,\r\n    collisionNormalColor: Color.Cyan,\r\n\r\n    showCollisionContacts: true,\r\n    collisionContactColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Motion component debug settings\r\n   */\r\n  public motion = {\r\n    showAll: false,\r\n\r\n    showVelocity: false,\r\n    velocityColor: Color.Yellow,\r\n\r\n    showAcceleration: false,\r\n    accelerationColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Body component debug settings\r\n   */\r\n  public body = {\r\n    showAll: false,\r\n\r\n    showCollisionGroup: false,\r\n    showCollisionType: false,\r\n    showSleeping: false,\r\n    showMotion: false,\r\n    showMass: false\r\n  };\r\n\r\n  /**\r\n   * Camera debug settings\r\n   */\r\n  public camera = {\r\n    showAll: false,\r\n\r\n    showFocus: false,\r\n    focusColor: Color.Red,\r\n\r\n    showZoom: false\r\n  };\r\n}\r\n\r\n/**\r\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\r\n * creating instances of this every frame.\r\n */\r\nexport class FrameStats implements FrameStatistics {\r\n  private _id: number = 0;\r\n  private _delta: number = 0;\r\n  private _fps: number = 0;\r\n  private _actorStats: FrameActorStats = {\r\n    alive: 0,\r\n    killed: 0,\r\n    ui: 0,\r\n    get remaining() {\r\n      return this.alive - this.killed;\r\n    },\r\n    get total() {\r\n      return this.remaining + this.ui;\r\n    }\r\n  };\r\n  private _durationStats: FrameDurationStats = {\r\n    update: 0,\r\n    draw: 0,\r\n    get total() {\r\n      return this.update + this.draw;\r\n    }\r\n  };\r\n\r\n  private _physicsStats: PhysicsStats = new PhysicsStats();\r\n\r\n  private _graphicsStats: GraphicsStatistics = {\r\n    drawCalls: 0,\r\n    drawnImages: 0\r\n  };\r\n\r\n  /**\r\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: FrameStatistics) {\r\n    if (otherStats) {\r\n      this.id = otherStats.id;\r\n      this.delta = otherStats.delta;\r\n      this.fps = otherStats.fps;\r\n      this.actors.alive = otherStats.actors.alive;\r\n      this.actors.killed = otherStats.actors.killed;\r\n      this.actors.ui = otherStats.actors.ui;\r\n      this.duration.update = otherStats.duration.update;\r\n      this.duration.draw = otherStats.duration.draw;\r\n      this._physicsStats.reset(otherStats.physics);\r\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\r\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\r\n    } else {\r\n      this.id = this.delta = this.fps = 0;\r\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\r\n      this.duration.update = this.duration.draw = 0;\r\n      this._physicsStats.reset();\r\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): FrameStats {\r\n    const fs = new FrameStats();\r\n\r\n    fs.reset(this);\r\n\r\n    return fs;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's id\r\n   */\r\n  public get id() {\r\n    return this._id;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's id\r\n   */\r\n  public set id(value: number) {\r\n    this._id = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame)\r\n   */\r\n  public get delta() {\r\n    return this._delta;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's delta (time since last frame). Internal use only.\r\n   * @internal\r\n   */\r\n  public set delta(value: number) {\r\n    this._delta = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  public get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's frames-per-second (FPS). Internal use only.\r\n   * @internal\r\n   */\r\n  public set fps(value: number) {\r\n    this._fps = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's actor statistics\r\n   */\r\n  public get actors() {\r\n    return this._actorStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's duration statistics\r\n   */\r\n  public get duration() {\r\n    return this._durationStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's physics statistics\r\n   */\r\n  public get physics() {\r\n    return this._physicsStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's graphics statistics\r\n   */\r\n  public get graphics() {\r\n    return this._graphicsStats;\r\n  }\r\n}\r\n\r\nexport class PhysicsStats implements PhysicsStatistics {\r\n  private _pairs: number = 0;\r\n  private _collisions: number = 0;\r\n  private _contacts: Map<string, CollisionContact> = new Map();\r\n  private _fastBodies: number = 0;\r\n  private _fastBodyCollisions: number = 0;\r\n  private _broadphase: number = 0;\r\n  private _narrowphase: number = 0;\r\n\r\n  /**\r\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: PhysicsStatistics) {\r\n    if (otherStats) {\r\n      this.pairs = otherStats.pairs;\r\n      this.collisions = otherStats.collisions;\r\n      this.contacts = otherStats.contacts;\r\n      this.fastBodies = otherStats.fastBodies;\r\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\r\n      this.broadphase = otherStats.broadphase;\r\n      this.narrowphase = otherStats.narrowphase;\r\n    } else {\r\n      this.pairs = this.collisions = this.fastBodies = 0;\r\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\r\n      this.contacts.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): PhysicsStatistics {\r\n    const ps = new PhysicsStats();\r\n\r\n    ps.reset(this);\r\n\r\n    return ps;\r\n  }\r\n\r\n  public get pairs(): number {\r\n    return this._pairs;\r\n  }\r\n\r\n  public set pairs(value: number) {\r\n    this._pairs = value;\r\n  }\r\n\r\n  public get collisions(): number {\r\n    return this._collisions;\r\n  }\r\n\r\n  public set collisions(value: number) {\r\n    this._collisions = value;\r\n  }\r\n\r\n  public get contacts(): Map<string, CollisionContact> {\r\n    return this._contacts;\r\n  }\r\n\r\n  public set contacts(contacts: Map<string, CollisionContact>) {\r\n    this._contacts = contacts;\r\n  }\r\n\r\n  public get fastBodies(): number {\r\n    return this._fastBodies;\r\n  }\r\n\r\n  public set fastBodies(value: number) {\r\n    this._fastBodies = value;\r\n  }\r\n\r\n  public get fastBodyCollisions(): number {\r\n    return this._fastBodyCollisions;\r\n  }\r\n\r\n  public set fastBodyCollisions(value: number) {\r\n    this._fastBodyCollisions = value;\r\n  }\r\n\r\n  public get broadphase(): number {\r\n    return this._broadphase;\r\n  }\r\n\r\n  public set broadphase(value: number) {\r\n    this._broadphase = value;\r\n  }\r\n\r\n  public get narrowphase(): number {\r\n    return this._narrowphase;\r\n  }\r\n\r\n  public set narrowphase(value: number) {\r\n    this._narrowphase = value;\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\nimport { Vector } from './vector';\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n","import { Class } from '../Class';\r\nimport { Engine, ScrollPreventionMode } from '../Engine';\r\nimport { Pointer, PointerType } from './Pointer';\r\nimport {\r\n  PointerEvent,\r\n  WheelEvent,\r\n  NativePointerButton,\r\n  PointerButton,\r\n  WheelDeltaMode,\r\n  createPointerEventByName,\r\n  PointerLeaveEvent,\r\n  PointerEnterEvent\r\n} from './PointerEvents';\r\nimport { GameEvent } from '../Events';\r\n\r\nimport * as Events from '../Events';\r\nimport * as Util from '../Util/Util';\r\nimport { vec } from '../Math/vector';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Vector } from '../Math/vector';\r\nimport { CapturePointer } from '../Traits/CapturePointer';\r\nimport { Actor } from '../Actor';\r\n\r\nexport type DOMPointerEvent = globalThis.PointerEvent;\r\nexport type DOMWheelEvent = globalThis.WheelEvent;\r\n\r\ninterface TouchEvent extends Event {\r\n  altKey: boolean;\r\n  changedTouches: Touch[];\r\n  ctrlKey: boolean;\r\n  metaKey: boolean;\r\n  shiftKey: boolean;\r\n  targetTouches: Touch[];\r\n  touches: Touch[];\r\n  type: string;\r\n  target: Element;\r\n}\r\n\r\ninterface Touch {\r\n  identifier: number;\r\n  screenX: number;\r\n  screenY: number;\r\n  clientX: number;\r\n  clientY: number;\r\n  pageX: number;\r\n  pageY: number;\r\n  radiusX: number;\r\n  radiusY: number;\r\n  rotationAngle: number;\r\n  force: number;\r\n  target: Element;\r\n}\r\n\r\n/**\r\n * A constant used to normalize wheel events across different browsers\r\n *\r\n * This normalization factor is pulled from https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\r\n */\r\nconst ScrollWheelNormalizationFactor = -1 / 40;\r\n\r\n/**\r\n * Handles pointer events (mouse, touch, stylus, etc.) and normalizes to\r\n * [W3C Pointer Events](http://www.w3.org/TR/pointerevents/).\r\n */\r\nexport class Pointers extends Class {\r\n  private _engine: Engine;\r\n\r\n  private _pointerDown: PointerEvent[] = [];\r\n  private _pointerUp: PointerEvent[] = [];\r\n  private _pointerMove: PointerEvent[] = [];\r\n  private _pointerCancel: PointerEvent[] = [];\r\n  private _wheel: WheelEvent[] = [];\r\n  private _pointers: Pointer[] = [];\r\n  private _activePointers: number[] = [];\r\n\r\n  constructor(engine: Engine) {\r\n    super();\r\n\r\n    this._engine = engine;\r\n    this._pointers.push(new Pointer());\r\n    this._activePointers = [-1];\r\n    this.primary = this._pointers[0];\r\n  }\r\n\r\n  public on(eventName: Events.up, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.down, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.move, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.enter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.leave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.cancel, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.wheel, handler: (event: WheelEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Primary pointer (mouse, 1 finger, stylus, etc.)\r\n   */\r\n  public primary: Pointer;\r\n\r\n  /**\r\n   * Initializes pointer event listeners\r\n   */\r\n  public init(target?: GlobalEventHandlers): void {\r\n    target = target || this._engine.canvas;\r\n\r\n    // Touch Events\r\n    target.addEventListener('touchstart', this._handleTouchEvent('down', this._pointerDown));\r\n    target.addEventListener('touchend', this._handleTouchEvent('up', this._pointerUp));\r\n    target.addEventListener('touchmove', this._handleTouchEvent('move', this._pointerMove));\r\n    target.addEventListener('touchcancel', this._handleTouchEvent('cancel', this._pointerCancel));\r\n\r\n    // W3C Pointer Events\r\n    // Current: IE11, IE10\r\n    if ((<any>window).PointerEvent) {\r\n      // IE11\r\n      this._engine.canvas.style.touchAction = 'none';\r\n      target.addEventListener('pointerdown', this._handlePointerEvent('down', this._pointerDown));\r\n      target.addEventListener('pointerup', this._handlePointerEvent('up', this._pointerUp));\r\n      target.addEventListener('pointermove', this._handlePointerEvent('move', this._pointerMove));\r\n      target.addEventListener('pointercancel', this._handlePointerEvent('cancel', this._pointerCancel));\r\n    } else if ((<any>window).MSPointerEvent) {\r\n      // IE10\r\n      (this._engine.canvas.style as any).msTouchAction = 'none';\r\n      target.addEventListener('MSPointerDown', this._handlePointerEvent('down', this._pointerDown));\r\n      target.addEventListener('MSPointerUp', this._handlePointerEvent('up', this._pointerUp));\r\n      target.addEventListener('MSPointerMove', this._handlePointerEvent('move', this._pointerMove));\r\n      target.addEventListener('MSPointerCancel', this._handlePointerEvent('cancel', this._pointerCancel));\r\n    } else {\r\n      // Mouse Events\r\n      target.addEventListener('mousedown', this._handleMouseEvent('down', this._pointerDown));\r\n      target.addEventListener('mouseup', this._handleMouseEvent('up', this._pointerUp));\r\n      target.addEventListener('mousemove', this._handleMouseEvent('move', this._pointerMove));\r\n    }\r\n\r\n    // MDN MouseWheelEvent\r\n    const wheelOptions = {\r\n      passive: !(\r\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\r\n      )\r\n    };\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      target.addEventListener('wheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      target.addEventListener('mousewheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      target.addEventListener('MozMousePixelScroll', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Synthesize a pointer event that looks like a real browser event to excalibur\r\n   * @param eventName\r\n   * @param pos\r\n   */\r\n  public triggerEvent(\r\n    eventName: 'up' | 'down' | 'move' | 'cancel' | 'wheel',\r\n    pos: Vector | GlobalCoordinates,\r\n    button: NativePointerButton = NativePointerButton.Left,\r\n    pointerType: 'mouse' | 'touch' | 'pen' = 'mouse',\r\n    pointerId: number = 0\r\n  ): void {\r\n    let x = 0;\r\n    let y = 0;\r\n    let coords: GlobalCoordinates;\r\n    if (pos instanceof GlobalCoordinates) {\r\n      x = pos.pagePos.x;\r\n      y = pos.pagePos.y;\r\n      coords = pos;\r\n    } else {\r\n      x = pos.x;\r\n      y = pos.y;\r\n      coords = new GlobalCoordinates(pos.clone(), pos.clone(), pos.clone());\r\n    }\r\n\r\n    const eventish = {\r\n      pageX: x,\r\n      pageY: y,\r\n      pointerId: pointerId,\r\n      pointerType: pointerType,\r\n      button: button,\r\n      preventDefault: () => {\r\n        /* do nothing */\r\n      }\r\n    };\r\n\r\n    switch (eventName) {\r\n      case 'move':\r\n        this._handlePointerEvent(eventName, this._pointerMove, coords)(eventish as DOMPointerEvent);\r\n        break;\r\n      case 'down':\r\n        this._handlePointerEvent(eventName, this._pointerDown, coords)(eventish as DOMPointerEvent);\r\n        break;\r\n      case 'up':\r\n        this._handlePointerEvent(eventName, this._pointerUp, coords)(eventish as DOMPointerEvent);\r\n        break;\r\n      case 'cancel':\r\n        this._handlePointerEvent(eventName, this._pointerCancel, coords)(eventish as DOMPointerEvent);\r\n        break;\r\n    }\r\n    for (const actor of this._engine.currentScene.actors) {\r\n      const capturePointer = actor.traits.filter((t) => t instanceof CapturePointer)[0];\r\n      if (capturePointer) {\r\n        capturePointer.update(actor, this._engine, 1);\r\n      }\r\n    }\r\n    this.dispatchPointerEvents();\r\n    this.update();\r\n  }\r\n\r\n  /**\r\n   * Update all pointer events and pointers, meant to be called at the end of frame\r\n   */\r\n  public update(): void {\r\n    this._pointerUp.length = 0;\r\n    this._pointerDown.length = 0;\r\n    this._pointerMove.length = 0;\r\n    this._pointerCancel.length = 0;\r\n    this._wheel.length = 0;\r\n\r\n    for (let i = 0; i < this._pointers.length; i++) {\r\n      this._pointers[i].update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely gets a Pointer at a specific index and initializes one if it doesn't yet exist\r\n   * @param index  The pointer index to retrieve\r\n   */\r\n  public at(index: number): Pointer {\r\n    if (index >= this._pointers.length) {\r\n      // Ensure there is a pointer to retrieve\r\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\r\n        this._pointers.push(new Pointer());\r\n        this._activePointers.push(-1);\r\n      }\r\n    }\r\n\r\n    return this._pointers[index];\r\n  }\r\n\r\n  /**\r\n   * Get number of pointers being watched\r\n   */\r\n  public count(): number {\r\n    return this._pointers.length;\r\n  }\r\n\r\n  public checkAndUpdateActorUnderPointer(actor: Actor) {\r\n    for (const pointer of this._pointers) {\r\n      if (pointer.checkActorUnderPointer(actor)) {\r\n        pointer.addActorUnderPointer(actor);\r\n      } else {\r\n        pointer.removeActorUnderPointer(actor);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _dispatchWithBubble(events: PointerEvent[]) {\r\n    for (const evt of events) {\r\n      for (const actor of evt.pointer.getActorsForEvents()) {\r\n        if (!evt.isCanceled()) {\r\n          evt.propagate(actor);\r\n        }\r\n        if (!evt.bubbles || evt.isCanceled()) {\r\n          // if the event stops bubbling part way stop processing\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _dispatchPointerLeaveEvents() {\r\n    const lastMoveEventPerPointerPerActor: { [pointerId: string]: PointerEvent } = {};\r\n    const pointerLeave: PointerLeaveEvent[] = [];\r\n\r\n    for (const evt of this._pointerMove) {\r\n      for (const actor of evt.pointer.getActorsForEvents()) {\r\n        // If the actor was under the pointer last frame, but not this this frame, pointer left\r\n        if (\r\n          !lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] &&\r\n          evt.pointer.wasActorUnderPointer(actor) &&\r\n          !evt.pointer.isActorAliveUnderPointer(actor) &&\r\n          !evt.isCanceled()\r\n        ) {\r\n          lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] = evt;\r\n          const pe = createPointerEventByName(\r\n            'leave',\r\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\r\n            evt.pointer,\r\n            evt.index,\r\n            evt.pointerType,\r\n            evt.button,\r\n            evt.ev\r\n          );\r\n\r\n          pe.propagate(actor);\r\n          pointerLeave.push(<PointerLeaveEvent>pe);\r\n        }\r\n      }\r\n    }\r\n    return pointerLeave;\r\n  }\r\n\r\n  private _dispatchPointerEnterEvents() {\r\n    const lastMoveEventPerPointer: { [pointerId: number]: PointerEvent } = {};\r\n    const pointerEnter: PointerEnterEvent[] = [];\r\n\r\n    for (const evt of this._pointerMove) {\r\n      for (const actor of evt.pointer.getActorsForEvents()) {\r\n        // If the actor was not under the pointer last frame, but it is this frame, pointer entered\r\n        if (\r\n          !lastMoveEventPerPointer[evt.pointer.id] &&\r\n          !evt.pointer.wasActorUnderPointer(actor) &&\r\n          evt.pointer.isActorAliveUnderPointer(actor) &&\r\n          !evt.isCanceled()\r\n        ) {\r\n          lastMoveEventPerPointer[evt.pointer.id] = evt;\r\n          const pe = createPointerEventByName(\r\n            'enter',\r\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\r\n            evt.pointer,\r\n            evt.index,\r\n            evt.pointerType,\r\n            evt.button,\r\n            evt.ev\r\n          );\r\n          pe.propagate(actor);\r\n          pointerEnter.push(<PointerEnterEvent>pe);\r\n          // if pointer is dragging set the drag target\r\n          if (evt.pointer.isDragging) {\r\n            evt.pointer.dragTarget = actor;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return pointerEnter;\r\n  }\r\n\r\n  public dispatchPointerEvents() {\r\n    this._dispatchWithBubble(this._pointerDown);\r\n    this._dispatchWithBubble(this._pointerUp);\r\n    this._dispatchWithBubble(this._pointerMove);\r\n    this._dispatchPointerLeaveEvents();\r\n    this._dispatchPointerEnterEvents();\r\n    this._dispatchWithBubble(this._pointerCancel);\r\n\r\n    // TODO some duplication here\r\n    for (const evt of this._wheel) {\r\n      for (const actor of this._pointers[evt.index].getActorsUnderPointer()) {\r\n        this._propagateWheelPointerEvent(actor, evt);\r\n        if (!evt.bubbles || evt.isCanceled()) {\r\n          // if the event stops bubbling part way stop processing\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _propagateWheelPointerEvent(actor: Actor, wheelEvent: WheelEvent) {\r\n    actor.emit('pointerwheel', wheelEvent);\r\n\r\n    // Recurse and propagate\r\n    if (wheelEvent.bubbles && !wheelEvent.isCanceled() && actor.parent) {\r\n      this._propagateWheelPointerEvent(actor.parent as Actor, wheelEvent); // TODO not true\r\n    }\r\n  }\r\n\r\n  private _handleMouseEvent(eventName: string, eventArr: PointerEvent[]) {\r\n    return (e: MouseEvent) => {\r\n      e.preventDefault();\r\n\r\n      const pointer = this.at(0);\r\n      const coordinates = GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\r\n      const pe = createPointerEventByName(\r\n        eventName,\r\n        coordinates,\r\n        pointer,\r\n        0,\r\n        PointerType.Mouse,\r\n        this._nativeButtonToPointerButton(e.button),\r\n        e\r\n      );\r\n\r\n      eventArr.push(pe);\r\n      pointer.eventDispatcher.emit(eventName, pe);\r\n    };\r\n  }\r\n\r\n  private _handleTouchEvent(eventName: string, eventArr: PointerEvent[]) {\r\n    return (e: TouchEvent) => {\r\n      e.preventDefault();\r\n      for (let i = 0, len = e.changedTouches.length; i < len; i++) {\r\n        const index = this._pointers.length > 1 ? this._getPointerIndex(e.changedTouches[i].identifier) : 0;\r\n        if (index === -1) {\r\n          continue;\r\n        }\r\n\r\n        const pointer = this.at(index);\r\n        const coordinates = GlobalCoordinates.fromPagePosition(e.changedTouches[i].pageX, e.changedTouches[i].pageY, this._engine);\r\n        const pe = createPointerEventByName(eventName, coordinates, pointer, index, PointerType.Touch, PointerButton.Unknown, e);\r\n\r\n        eventArr.push(pe);\r\n        pointer.eventDispatcher.emit(eventName, pe);\r\n        this.emit(eventName, pe);\r\n        // only with multi-pointer\r\n        if (this._pointers.length > 1) {\r\n          if (eventName === 'up') {\r\n            // remove pointer ID from pool when pointer is lifted\r\n            this._activePointers[index] = -1;\r\n          } else if (eventName === 'down') {\r\n            // set pointer ID to given index\r\n            this._activePointers[index] = e.changedTouches[i].identifier;\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private _handlePointerEvent(eventName: string, eventArr: PointerEvent[], coords?: GlobalCoordinates) {\r\n    return (e: DOMPointerEvent) => {\r\n      e.preventDefault();\r\n\r\n      // get the index for this pointer ID if multi-pointer is asked for\r\n      const index = this._pointers.length > 1 ? this._getPointerIndex(e.pointerId) : 0;\r\n      if (index === -1) {\r\n        return;\r\n      }\r\n\r\n      const pointer = this.at(index);\r\n      const coordinates = coords || GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\r\n      const pe = createPointerEventByName(\r\n        eventName,\r\n        coordinates,\r\n        pointer,\r\n        index,\r\n        this._stringToPointerType(e.pointerType),\r\n        this._nativeButtonToPointerButton(e.button),\r\n        e\r\n      );\r\n\r\n      eventArr.push(pe);\r\n      pointer.eventDispatcher.emit(eventName, pe);\r\n      this.emit(eventName, pe);\r\n\r\n      // only with multi-pointer\r\n      if (this._pointers.length > 1) {\r\n        if (eventName === 'up') {\r\n          // remove pointer ID from pool when pointer is lifted\r\n          this._activePointers[index] = -1;\r\n        } else if (eventName === 'down') {\r\n          // set pointer ID to given index\r\n          this._activePointers[index] = e.pointerId;\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private _handleWheelEvent(eventName: string, eventArr: WheelEvent[]) {\r\n    return (e: DOMWheelEvent) => {\r\n      // Should we prevent page scroll because of this event\r\n      if (\r\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n        (this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && e.target === this._engine.canvas)\r\n      ) {\r\n        e.preventDefault();\r\n      }\r\n      const screen = this._engine.screen.pageToScreenCoordinates(vec(e.pageX, e.pageY));\r\n      const world = this._engine.screen.screenToWorldCoordinates(screen);\r\n\r\n      // deltaX, deltaY, and deltaZ are the standard modern properties\r\n      // wheelDeltaX, wheelDeltaY, are legacy properties in webkit browsers and older IE\r\n      // e.detail is only used in opera\r\n\r\n      const deltaX = e.deltaX || e.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\r\n      const deltaY =\r\n        e.deltaY || e.wheelDeltaY * ScrollWheelNormalizationFactor || e.wheelDelta * ScrollWheelNormalizationFactor || e.detail || 0;\r\n      const deltaZ = e.deltaZ || 0;\r\n      let deltaMode = WheelDeltaMode.Pixel;\r\n\r\n      if (e.deltaMode) {\r\n        if (e.deltaMode === 1) {\r\n          deltaMode = WheelDeltaMode.Line;\r\n        } else if (e.deltaMode === 2) {\r\n          deltaMode = WheelDeltaMode.Page;\r\n        }\r\n      }\r\n\r\n      const we = new WheelEvent(world.x, world.y, e.pageX, e.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, e);\r\n\r\n      eventArr.push(we);\r\n      this.at(0).eventDispatcher.emit(eventName, we);\r\n      this.emit(eventName, we);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets the index of the pointer specified for the given pointer ID or finds the next empty pointer slot available.\r\n   * This is required because IE10/11 uses incrementing pointer IDs so we need to store a mapping of ID => idx\r\n   */\r\n  private _getPointerIndex(pointerId: number) {\r\n    let idx;\r\n    if ((idx = this._activePointers.indexOf(pointerId)) > -1) {\r\n      return idx;\r\n    }\r\n\r\n    for (let i = 0; i < this._activePointers.length; i++) {\r\n      if (this._activePointers[i] === -1) {\r\n        return i;\r\n      }\r\n    }\r\n\r\n    // ignore pointer because game isn't watching\r\n    return -1;\r\n  }\r\n\r\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\r\n    switch (s) {\r\n      case NativePointerButton.NoButton:\r\n        return PointerButton.NoButton;\r\n      case NativePointerButton.Left:\r\n        return PointerButton.Left;\r\n      case NativePointerButton.Middle:\r\n        return PointerButton.Middle;\r\n      case NativePointerButton.Right:\r\n        return PointerButton.Right;\r\n      case NativePointerButton.Unknown:\r\n        return PointerButton.Unknown;\r\n      default:\r\n        return Util.fail(s);\r\n    }\r\n  }\r\n\r\n  private _stringToPointerType(s: string) {\r\n    switch (s) {\r\n      case 'touch':\r\n        return PointerType.Touch;\r\n      case 'mouse':\r\n        return PointerType.Mouse;\r\n      case 'pen':\r\n        return PointerType.Pen;\r\n      default:\r\n        return PointerType.Unknown;\r\n    }\r\n  }\r\n}\r\n","import { Class } from './../Class';\r\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\r\n * to provide controller support for your games.\r\n */\r\nexport class Gamepads extends Class {\r\n  /**\r\n   * Whether or not to poll for Gamepad input (default: `false`)\r\n   */\r\n  public enabled = false;\r\n\r\n  /**\r\n   * Whether or not Gamepad API is supported\r\n   */\r\n  public supported = !!(<any>navigator).getGamepads;\r\n\r\n  /**\r\n   * The minimum value an axis has to move before considering it a change\r\n   */\r\n  public static MinAxisMoveThreshold = 0.05;\r\n\r\n  private _gamePadTimeStamps = [0, 0, 0, 0];\r\n  private _oldPads: Gamepad[] = [];\r\n  private _pads: Gamepad[] = [];\r\n  private _initSuccess: boolean = false;\r\n  private _navigator: NavigatorGamepads = <any>navigator;\r\n  private _minimumConfiguration: GamepadConfiguration = null;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public init() {\r\n    if (!this.supported) {\r\n      return;\r\n    }\r\n    if (this._initSuccess) {\r\n      return;\r\n    }\r\n\r\n    // In Chrome, this will return 4 undefined items until a button is pressed\r\n    // In FF, this will not return any items until a button is pressed\r\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\r\n    if (this._oldPads.length && this._oldPads[0]) {\r\n      this._initSuccess = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\r\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\r\n   * all other controllers with more axis or buttons are valid as well. If no minimum\r\n   * configuration is set all pads are valid.\r\n   */\r\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\r\n    this._enableAndUpdate(); // if config is used, implicitly enable\r\n    this._minimumConfiguration = config;\r\n  }\r\n\r\n  /**\r\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\r\n   */\r\n  private _enableAndUpdate() {\r\n    if (!this.enabled) {\r\n      this.enabled = true;\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks a navigator gamepad against the minimum configuration if present.\r\n   */\r\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\r\n    if (!this._minimumConfiguration) {\r\n      return true;\r\n    }\r\n    if (!pad) {\r\n      return false;\r\n    }\r\n    const axesLength = pad.axes.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n\r\n    const buttonLength = pad.buttons.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\r\n  }\r\n\r\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\r\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\r\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\r\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Updates Gamepad state and publishes Gamepad events\r\n   */\r\n  public update() {\r\n    if (!this.enabled || !this.supported) {\r\n      return;\r\n    }\r\n    this.init();\r\n\r\n    const gamepads = this._navigator.getGamepads();\r\n\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n      if (!gamepads[i]) {\r\n        const gamepad = this.at(i);\r\n        // If was connected, but now isn't emit the disconnect event\r\n        if (gamepad.connected) {\r\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\r\n        }\r\n        // Reset connection status\r\n        gamepad.connected = false;\r\n        continue;\r\n      } else {\r\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\r\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\r\n        }\r\n        // Set connection status\r\n        this.at(i).connected = true;\r\n      }\r\n\r\n      // Only supported in Chrome\r\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\r\n        continue;\r\n      }\r\n\r\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\r\n\r\n      // Add reference to navigator gamepad\r\n      this.at(i).navigatorGamepad = gamepads[i];\r\n\r\n      // Buttons\r\n      let b: string, bi: number, a: string, ai: number, value: number;\r\n\r\n      for (b in Buttons) {\r\n        bi = <any>Buttons[b];\r\n        if (typeof bi === 'number') {\r\n          if (gamepads[i].buttons[bi]) {\r\n            value = gamepads[i].buttons[bi].value;\r\n            if (value !== this._oldPads[i].getButton(bi)) {\r\n              if (gamepads[i].buttons[bi].pressed) {\r\n                this.at(i).updateButton(bi, value);\r\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\r\n              } else {\r\n                this.at(i).updateButton(bi, 0);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Axes\r\n      for (a in Axes) {\r\n        ai = <any>Axes[a];\r\n        if (typeof ai === 'number') {\r\n          value = gamepads[i].axes[ai];\r\n          if (value !== this._oldPads[i].getAxes(ai)) {\r\n            this.at(i).updateAxes(ai, value);\r\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\r\n          }\r\n        }\r\n      }\r\n\r\n      this._oldPads[i] = this._clonePad(gamepads[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\r\n   */\r\n  public at(index: number): Gamepad {\r\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\r\n    if (index >= this._pads.length) {\r\n      // Ensure there is a pad to retrieve\r\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\r\n        this._pads.push(new Gamepad());\r\n        this._oldPads.push(new Gamepad());\r\n      }\r\n    }\r\n\r\n    return this._pads[index];\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\r\n   */\r\n  public getValidGamepads(): Gamepad[] {\r\n    this._enableAndUpdate();\r\n    const result: Gamepad[] = [];\r\n    for (let i = 0; i < this._pads.length; i++) {\r\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\r\n        result.push(this.at(i));\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the number of connected gamepads\r\n   */\r\n  public count() {\r\n    return this._pads.filter((p) => p.connected).length;\r\n  }\r\n\r\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\r\n    const arr = [];\r\n    for (let i = 0, len = pads.length; i < len; i++) {\r\n      arr.push(this._clonePad(pads[i]));\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  /**\r\n   * Fastest way to clone a known object is to do it yourself\r\n   */\r\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\r\n    let i, len;\r\n    const clonedPad = new Gamepad();\r\n\r\n    if (!pad) {\r\n      return clonedPad;\r\n    }\r\n\r\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\r\n      if (pad.buttons[i]) {\r\n        clonedPad.updateButton(i, pad.buttons[i].value);\r\n      }\r\n    }\r\n    for (i = 0, len = pad.axes.length; i < len; i++) {\r\n      clonedPad.updateAxes(i, pad.axes[i]);\r\n    }\r\n\r\n    return clonedPad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\r\n * for more information on handling controller input.\r\n */\r\nexport class Gamepad extends Class {\r\n  public connected = false;\r\n  public navigatorGamepad: NavigatorGamepad;\r\n  private _buttons: number[] = new Array(16);\r\n  private _axes: number[] = new Array(4);\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    for (let i = 0; i < this._buttons.length; i++) {\r\n      this._buttons[i] = 0;\r\n    }\r\n    for (let i = 0; i < this._axes.length; i++) {\r\n      this._axes[i] = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given button is pressed\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Gets the given button value between 0 and 1\r\n   */\r\n  public getButton(button: Buttons) {\r\n    return this._buttons[button];\r\n  }\r\n\r\n  /**\r\n   * Gets the given axis value between -1 and 1. Values below\r\n   * [[MinAxisMoveThreshold]] are considered 0.\r\n   */\r\n  public getAxes(axes: Axes) {\r\n    const value = this._axes[axes];\r\n\r\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\r\n      return 0;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  public updateButton(buttonIndex: number, value: number) {\r\n    this._buttons[buttonIndex] = value;\r\n  }\r\n\r\n  public updateAxes(axesIndex: number, value: number) {\r\n    this._axes[axesIndex] = value;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad Buttons enumeration\r\n */\r\nexport enum Buttons {\r\n  /**\r\n   * Face 1 button (e.g. A)\r\n   */\r\n  Face1 = 0,\r\n  /**\r\n   * Face 2 button (e.g. B)\r\n   */\r\n  Face2 = 1,\r\n  /**\r\n   * Face 3 button (e.g. X)\r\n   */\r\n  Face3 = 2,\r\n  /**\r\n   * Face 4 button (e.g. Y)\r\n   */\r\n  Face4 = 3,\r\n  /**\r\n   * Left bumper button\r\n   */\r\n  LeftBumper = 4,\r\n  /**\r\n   * Right bumper button\r\n   */\r\n  RightBumper = 5,\r\n  /**\r\n   * Left trigger button\r\n   */\r\n  LeftTrigger = 6,\r\n  /**\r\n   * Right trigger button\r\n   */\r\n  RightTrigger = 7,\r\n  /**\r\n   * Select button\r\n   */\r\n  Select = 8,\r\n  /**\r\n   * Start button\r\n   */\r\n  Start = 9,\r\n  /**\r\n   * Left analog stick press (e.g. L3)\r\n   */\r\n  LeftStick = 10,\r\n  /**\r\n   * Right analog stick press (e.g. R3)\r\n   */\r\n  RightStick = 11,\r\n  /**\r\n   * D-pad up\r\n   */\r\n  DpadUp = 12,\r\n  /**\r\n   * D-pad down\r\n   */\r\n  DpadDown = 13,\r\n  /**\r\n   * D-pad left\r\n   */\r\n  DpadLeft = 14,\r\n  /**\r\n   * D-pad right\r\n   */\r\n  DpadRight = 15\r\n}\r\n\r\n/**\r\n * Gamepad Axes enumeration\r\n */\r\nexport enum Axes {\r\n  /**\r\n   * Left analogue stick X direction\r\n   */\r\n  LeftStickX = 0,\r\n  /**\r\n   * Left analogue stick Y direction\r\n   */\r\n  LeftStickY = 1,\r\n  /**\r\n   * Right analogue stick X direction\r\n   */\r\n  RightStickX = 2,\r\n  /**\r\n   * Right analogue stick Y direction\r\n   */\r\n  RightStickY = 3\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepads {\r\n  getGamepads(): NavigatorGamepad[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepad {\r\n  axes: number[];\r\n  buttons: NavigatorGamepadButton[];\r\n  connected: boolean;\r\n  id: string;\r\n  index: number;\r\n  mapping: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadButton {\r\n  pressed: boolean;\r\n  value: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadEvent {\r\n  gamepad: NavigatorGamepad;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface GamepadConfiguration {\r\n  axis: number;\r\n  buttons: number;\r\n}\r\n","export interface NativeEventable {\r\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\r\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\r\n}\r\n\r\nexport class BrowserComponent<T extends NativeEventable> {\r\n  private _paused = false;\r\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\r\n\r\n  on(eventName: string, handler: (evt: any) => void): void {\r\n    if (this._nativeHandlers[eventName]) {\r\n      this.off(eventName, this._nativeHandlers[eventName]);\r\n    }\r\n    this._nativeHandlers[eventName] = this._decorate(handler);\r\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\r\n  }\r\n  off(eventName: string, handler?: (event: any) => void): void {\r\n    if (!handler) {\r\n      handler = this._nativeHandlers[eventName];\r\n    }\r\n    this.nativeComponent.removeEventListener(eventName, handler);\r\n    this._nativeHandlers[eventName] = null;\r\n  }\r\n\r\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\r\n    return (evt: any) => {\r\n      if (!this._paused) {\r\n        handler(evt);\r\n      }\r\n    };\r\n  }\r\n\r\n  public pause() {\r\n    this._paused = true;\r\n  }\r\n\r\n  public resume() {\r\n    this._paused = false;\r\n  }\r\n\r\n  public clear() {\r\n    for (const event in this._nativeHandlers) {\r\n      this.off(event);\r\n    }\r\n  }\r\n\r\n  constructor(public nativeComponent: T) {}\r\n}\r\n\r\nexport class BrowserEvents {\r\n  private _windowComponent: BrowserComponent<Window>;\r\n  private _documentComponent: BrowserComponent<Document>;\r\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\r\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\r\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\r\n  }\r\n\r\n  public get window(): BrowserComponent<Window> {\r\n    return this._windowComponent;\r\n  }\r\n\r\n  public get document(): BrowserComponent<Document> {\r\n    return this._documentComponent;\r\n  }\r\n\r\n  public pause() {\r\n    this.window.pause();\r\n    this.document.pause();\r\n  }\r\n\r\n  public resume() {\r\n    this.window.resume();\r\n    this.document.resume();\r\n  }\r\n\r\n  public clear() {\r\n    this.window.clear();\r\n    this.document.clear();\r\n  }\r\n}\r\n","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\n\r\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\r\n  /**\r\n   * Draw a debug rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.strokeStyle = 'red';\r\n    this._ex.__ctx.strokeRect(\r\n      this._ex.snapToPixel ? ~~x : x,\r\n      this._ex.snapToPixel ? ~~y : y,\r\n      this._ex.snapToPixel ? ~~width : width,\r\n      this._ex.snapToPixel ? ~~height : height\r\n    );\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.strokeStyle = lineOptions.color.toString();\r\n    this._ex.__ctx.moveTo(this._ex.snapToPixel ? ~~start.x : start.x, this._ex.snapToPixel ? ~~start.y : start.y);\r\n    this._ex.__ctx.lineTo(this._ex.snapToPixel ? ~~end.x : end.x, this._ex.snapToPixel ? ~~end.y : end.y);\r\n    this._ex.__ctx.lineWidth = 2;\r\n    this._ex.__ctx.stroke();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\r\n    this._ex.__ctx.arc(\r\n      this._ex.snapToPixel ? ~~point.x : point.x,\r\n      this._ex.snapToPixel ? ~~point.y : point.y,\r\n      pointOptions.size,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this._ex.__ctx.fill();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._ex, text, pos);\r\n  }\r\n}\r\n\r\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n  public get width() {\r\n    return this.__ctx.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__ctx.canvas.height;\r\n  }\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  private _state = new StateStack();\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public snapToPixel: boolean = true;\r\n\r\n  public get smoothing(): boolean {\r\n    return this.__ctx.imageSmoothingEnabled;\r\n  }\r\n\r\n  public set smoothing(value: boolean) {\r\n    this.__ctx.imageSmoothingEnabled = value;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, snapToPixel, smoothing, backgroundColor } = options;\r\n    this.__ctx = canvasElement.getContext('2d', {\r\n      alpha: enableTransparency ?? true\r\n    });\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this.__ctx.resetTransform();\r\n  }\r\n\r\n  public updateViewport(): void {\r\n    // pass\r\n  }\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    this.__ctx.globalAlpha = this.opacity;\r\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\r\n      .filter((a) => a !== undefined)\r\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\r\n    this.__ctx.drawImage.apply(this.__ctx, args);\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n    GraphicsDiagnostics.DrawnImagesCount = 1;\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.strokeStyle = color.toString();\r\n    this.__ctx.moveTo(this.snapToPixel ? ~~start.x : start.x, this.snapToPixel ? ~~start.y : start.y);\r\n    this.__ctx.lineTo(this.snapToPixel ? ~~end.x : end.x, this.snapToPixel ? ~~end.y : end.y);\r\n    this.__ctx.lineWidth = thickness;\r\n    this.__ctx.stroke();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.fillRect(\r\n      this.snapToPixel ? ~~pos.x : pos.x,\r\n      this.snapToPixel ? ~~pos.y : pos.y,\r\n      this.snapToPixel ? ~~width : width,\r\n      this.snapToPixel ? ~~height : height\r\n    );\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.arc(this.snapToPixel ? ~~pos.x : pos.x, this.snapToPixel ? ~~pos.y : pos.y, radius, 0, Math.PI * 2);\r\n    this.__ctx.fill();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void {\r\n    this.__ctx.save();\r\n  }\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void {\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void {\r\n    this.__ctx.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\r\n  }\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void {\r\n    this.__ctx.rotate(angle);\r\n  }\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void {\r\n    this.__ctx.scale(x, y);\r\n  }\r\n\r\n  clear(): void {\r\n    // Clear frame\r\n    this.__ctx.clearRect(0, 0, this.width, this.height);\r\n    this.__ctx.fillStyle = this.backgroundColor.toString();\r\n    this.__ctx.fillRect(0, 0, this.width, this.height);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void {\r\n    // pass\r\n  }\r\n}\r\n","import { EX_VERSION } from './';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Vector } from './Math/vector';\r\nimport { Screen, DisplayMode, AbsolutePosition, ScreenDimension, Resolution } from './Screen';\r\nimport { ScreenElement } from './ScreenElement';\r\nimport { Actor } from './Actor';\r\nimport { Timer } from './Timer';\r\nimport { TileMap } from './TileMap';\r\nimport { Animation } from './Drawing/Animation';\r\nimport { Loader } from './Loader';\r\nimport { Detector } from './Util/Detector';\r\nimport {\r\n  VisibleEvent,\r\n  HiddenEvent,\r\n  GameStartEvent,\r\n  GameStopEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreFrameEvent,\r\n  PostFrameEvent,\r\n  GameEvent,\r\n  DeactivateEvent,\r\n  ActivateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  InitializeEvent\r\n} from './Events';\r\nimport { Logger, LogLevel } from './Util/Log';\r\nimport { Color } from './Color';\r\nimport { Scene } from './Scene';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { PostProcessor } from './PostProcessing/PostProcessor';\r\nimport { Debug, DebugStats } from './Debug/Debug';\r\nimport { Class } from './Class';\r\nimport * as Input from './Input/Index';\r\nimport * as Events from './Events';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { ExcaliburGraphicsContext, ExcaliburGraphicsContext2DCanvas, ExcaliburGraphicsContextWebGL } from './Graphics';\r\n\r\n/**\r\n * Enum representing the different mousewheel event bubble prevention\r\n */\r\nexport enum ScrollPreventionMode {\r\n  /**\r\n   * Do not prevent any page scrolling\r\n   */\r\n  None,\r\n  /**\r\n   * Prevent page scroll if mouse is over the game canvas\r\n   */\r\n  Canvas,\r\n  /**\r\n   * Prevent all page scrolling via mouse wheel\r\n   */\r\n  All\r\n}\r\n\r\n/**\r\n * Defines the available options to configure the Excalibur engine at constructor time.\r\n */\r\nexport interface EngineOptions {\r\n  /**\r\n   * Optionally configure the width of the viewport in css pixels\r\n   */\r\n  width?: number;\r\n\r\n  /**\r\n   * Optionally configure the height of the viewport in css pixels\r\n   */\r\n  height?: number;\r\n\r\n  /**\r\n   * Optionally configure the width & height of the viewport in css pixels.\r\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\r\n   */\r\n  viewport?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\r\n   * See [[Resolution]] for common presets.\r\n   */\r\n  resolution?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\r\n   */\r\n  antialiasing?: boolean;\r\n\r\n  /**\r\n   * Optionally configure the native canvas transparent backdrop\r\n   */\r\n  enableCanvasTransparency?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element to render the game in\r\n   */\r\n  canvasElementId?: string;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element directly\r\n   */\r\n  canvasElement?: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Optionally snap drawings to nearest pixel\r\n   */\r\n  snapToPixel?: boolean;\r\n\r\n  /**\r\n   * The [[DisplayMode]] of the game, by default [[DisplayMode.FitScreen]] with aspect ratio 4:3 (800x600).\r\n   * Depending on this value, [[width]] and [[height]] may be ignored.\r\n   */\r\n  displayMode?: DisplayMode;\r\n\r\n  /**\r\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\r\n   * (default) scoped will fire anywhere on the page.\r\n   */\r\n  pointerScope?: Input.PointerScope;\r\n\r\n  /**\r\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\r\n   */\r\n  suppressConsoleBootMessage?: boolean;\r\n\r\n  /**\r\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\r\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\r\n   * browsers or if there is a bug in excalibur preventing execution.\r\n   */\r\n  suppressMinimumBrowserFeatureDetection?: boolean;\r\n\r\n  /**\r\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\r\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\r\n   */\r\n  suppressHiDPIScaling?: boolean;\r\n\r\n  /**\r\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\r\n   * for certain browser features to work like web audio.\r\n   */\r\n  suppressPlayButton?: boolean;\r\n\r\n  /**\r\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\r\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\r\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\r\n   *\r\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\r\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\r\n   */\r\n  position?: string | AbsolutePosition;\r\n\r\n  /**\r\n   * Scroll prevention method.\r\n   */\r\n  scrollPreventionMode?: ScrollPreventionMode;\r\n\r\n  /**\r\n   * Optionally set the background color\r\n   */\r\n  backgroundColor?: Color;\r\n}\r\n\r\n/**\r\n * The Excalibur Engine\r\n *\r\n * The [[Engine]] is the main driver for a game. It is responsible for\r\n * starting/stopping the game, maintaining state, transmitting events,\r\n * loading resources, and managing the scene.\r\n */\r\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\r\n  /**\r\n   *\r\n   */\r\n  public browser: BrowserEvents;\r\n\r\n  /**\r\n   * Screen abstraction\r\n   */\r\n  public screen: Screen;\r\n\r\n  /**\r\n   * Direct access to the engine's canvas element\r\n   */\r\n  public canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Direct access to the engine's 2D rendering context\r\n   */\r\n  public ctx: CanvasRenderingContext2D;\r\n\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Direct access to the canvas element ID, if an ID exists\r\n   */\r\n  public canvasElementId: string;\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.screen.canvasWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.screen.halfCanvasWidth;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.screen.canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.screen.halfCanvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    return this.screen.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.screen.halfDrawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    return this.screen.drawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.screen.halfDrawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns whether excalibur detects the current screen to be HiDPI\r\n   */\r\n  public get isHiDpi(): boolean {\r\n    return this.screen.isHiDpi;\r\n  }\r\n\r\n  /**\r\n   * Access engine input like pointer, keyboard, or gamepad\r\n   */\r\n  public input: Input.EngineInput;\r\n\r\n  private _hasStarted: boolean = false;\r\n\r\n  /**\r\n   * Access Excalibur debugging functionality.\r\n   */\r\n  public debug: Debug;\r\n\r\n  /**\r\n   * Access [[stats]] that holds frame statistics.\r\n   */\r\n  public get stats(): DebugStats {\r\n    return this.debug.stats;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the list of post processors to apply at the end of drawing a frame (such as [[ColorBlindCorrector]])\r\n   */\r\n  public postProcessors: PostProcessor[] = [];\r\n\r\n  /**\r\n   * The current [[Scene]] being drawn and updated on screen\r\n   */\r\n  public currentScene: Scene;\r\n\r\n  /**\r\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\r\n   */\r\n  public readonly rootScene: Scene;\r\n\r\n  /**\r\n   * Contains all the scenes currently registered with Excalibur\r\n   */\r\n  public readonly scenes: { [key: string]: Scene } = {};\r\n\r\n  /**\r\n   * @hidden\r\n   * @deprecated\r\n   */\r\n  private _animations: AnimationNode[] = [];\r\n\r\n  /**\r\n   * Indicates whether the engine is set to fullscreen or not\r\n   */\r\n  public get isFullscreen(): boolean {\r\n    return this.screen.isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current [[DisplayMode]] of the engine.\r\n   */\r\n  public get displayMode(): DisplayMode {\r\n    return this.screen.displayMode;\r\n  }\r\n\r\n  private _suppressPlayButton: boolean = false;\r\n  /**\r\n   * Returns the calculated pixel ration for use in rendering\r\n   */\r\n  public get pixelRatio(): number {\r\n    return this.screen.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\r\n   */\r\n  public position: string | AbsolutePosition;\r\n  /**\r\n   * Indicates whether audio should be paused when the game is no longer visible.\r\n   */\r\n  public pauseAudioWhenHidden: boolean = true;\r\n\r\n  /**\r\n   * Indicates whether the engine should draw with debug information\r\n   */\r\n  private _isDebug: boolean = false;\r\n  public get isDebug(): boolean {\r\n    return this._isDebug;\r\n  }\r\n  public debugColor: Color = new Color(255, 255, 255);\r\n  /**\r\n   * Sets the background color for the engine.\r\n   */\r\n  public backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the Transparency for the engine.\r\n   */\r\n  public enableCanvasTransparency: boolean = true;\r\n\r\n  /**\r\n   * The action to take when a fatal exception is thrown\r\n   */\r\n  public onFatalException = (e: any) => {\r\n    Logger.getInstance().fatal(e);\r\n  };\r\n\r\n  /**\r\n   * The mouse wheel scroll prevention mode\r\n   */\r\n  public pageScrollPreventionMode: ScrollPreventionMode;\r\n\r\n  private _logger: Logger;\r\n\r\n  // this is a reference to the current requestAnimationFrame return value\r\n  private _requestId: number;\r\n\r\n  // this determines whether excalibur is compatible with your browser\r\n  private _compatible: boolean;\r\n\r\n  private _timescale: number = 1.0;\r\n\r\n  // loading\r\n  private _loader: Loader;\r\n  private _isLoading: boolean = false;\r\n\r\n  private _isInitialized: boolean = false;\r\n\r\n  private _deferredGoTo: string = null;\r\n\r\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\r\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\r\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\r\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\r\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Default [[EngineOptions]]\r\n   */\r\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    enableCanvasTransparency: true,\r\n    canvasElementId: '',\r\n    canvasElement: undefined,\r\n    snapToPixel: false,\r\n    pointerScope: Input.PointerScope.Canvas,\r\n    suppressConsoleBootMessage: null,\r\n    suppressMinimumBrowserFeatureDetection: null,\r\n    suppressHiDPIScaling: null,\r\n    suppressPlayButton: null,\r\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\r\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\r\n  };\r\n\r\n  /**\r\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\r\n   * the game will be rendered full screen (taking up all available browser window space).\r\n   * You can customize the game rendering through [[EngineOptions]].\r\n   *\r\n   * Example:\r\n   *\r\n   * ```js\r\n   * var game = new ex.Engine({\r\n   *   width: 0, // the width of the canvas\r\n   *   height: 0, // the height of the canvas\r\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\r\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\r\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\r\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\r\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\r\n   * });\r\n   *\r\n   * // call game.start, which is a Promise\r\n   * game.start().then(function () {\r\n   *   // ready, set, go!\r\n   * });\r\n   * ```\r\n   */\r\n  constructor(options?: EngineOptions) {\r\n    super();\r\n\r\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\r\n\r\n    Flags.freeze();\r\n\r\n    // Initialize browser events facade\r\n    this.browser = new BrowserEvents(window, document);\r\n\r\n    // Check compatibility\r\n    const detector = new Detector();\r\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\r\n      const message = document.createElement('div');\r\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\r\n      document.body.appendChild(message);\r\n\r\n      detector.failedTests.forEach(function (test) {\r\n        const testMessage = document.createElement('div');\r\n        testMessage.innerText = 'Browser feature missing ' + test;\r\n        document.body.appendChild(testMessage);\r\n      });\r\n\r\n      if (options.canvasElementId) {\r\n        const canvas = document.getElementById(options.canvasElementId);\r\n        if (canvas) {\r\n          canvas.parentElement.removeChild(canvas);\r\n        }\r\n      }\r\n\r\n      return;\r\n    } else {\r\n      this._compatible = true;\r\n    }\r\n\r\n    // Use native console API for color fun\r\n    // eslint-disable-next-line no-console\r\n    if (console.log && !options.suppressConsoleBootMessage) {\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\r\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log('\\n\\\r\n      /| ________________\\n\\\r\nO|===|* >________________>\\n\\\r\n      \\\\|');\r\n      // eslint-disable-next-line no-console\r\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\r\n    }\r\n\r\n    // Suppress play button\r\n    if (options.suppressPlayButton) {\r\n      this._suppressPlayButton = true;\r\n    }\r\n\r\n    this._logger = Logger.getInstance();\r\n\r\n    // If debug is enabled, let's log browser features to the console.\r\n    if (this._logger.defaultLevel === LogLevel.Debug) {\r\n      detector.logBrowserFeatures();\r\n    }\r\n\r\n    this._logger.debug('Building engine...');\r\n\r\n    this.canvasElementId = options.canvasElementId;\r\n\r\n    if (options.canvasElementId) {\r\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\r\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\r\n    } else if (options.canvasElement) {\r\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\r\n      this.canvas = options.canvasElement;\r\n    } else {\r\n      this._logger.debug('Using generated canvas element');\r\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    }\r\n\r\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    if ((options.width && options.height) || options.viewport) {\r\n      if (options.displayMode === undefined) {\r\n        displayMode = DisplayMode.Fixed;\r\n      }\r\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\r\n    } else if (!options.displayMode) {\r\n      this._logger.debug('Engine viewport is fit');\r\n      displayMode = DisplayMode.FitScreen;\r\n    }\r\n\r\n    if (Flags.isEnabled(Legacy.Canvas)) {\r\n      const ex2dCtx = new ExcaliburGraphicsContext2DCanvas({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel\r\n      });\r\n      this.graphicsContext = ex2dCtx;\r\n      this.ctx = ex2dCtx.__ctx;\r\n    } else {\r\n      const exWebglCtx = new ExcaliburGraphicsContextWebGL({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel\r\n      });\r\n      this.graphicsContext = exWebglCtx;\r\n      this.ctx = exWebglCtx.__ctx;\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: options.antialiasing ?? true,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      position: options.position,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : null\r\n    });\r\n\r\n    if (options.backgroundColor) {\r\n      this.backgroundColor = options.backgroundColor.clone();\r\n    }\r\n\r\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\r\n\r\n    this._loader = new Loader();\r\n    this.debug = new Debug(this);\r\n\r\n    this._initialize(options);\r\n\r\n    this.rootScene = this.currentScene = new Scene();\r\n\r\n    this.addScene('root', this.rootScene);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   */\r\n  public getWorldBounds() {\r\n    return this.screen.getWorldBounds();\r\n  }\r\n\r\n  /**\r\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\r\n   */\r\n  public get timescale() {\r\n    return this._timescale;\r\n  }\r\n\r\n  /**\r\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\r\n   * when using time-based movement.\r\n   */\r\n  public set timescale(value: number) {\r\n    if (value <= 0) {\r\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\r\n      return;\r\n    }\r\n\r\n    this._timescale = value;\r\n  }\r\n\r\n  /**\r\n   * Plays a sprite animation on the screen at the specified `x` and `y`\r\n   * (in game coordinates, not screen pixels). These animations play\r\n   * independent of actors, and will be cleaned up internally as soon\r\n   * as they are complete. Note animations that loop will never be\r\n   * cleaned up.\r\n   *\r\n   * @param animation  Animation to play\r\n   * @param x          x game coordinate to play the animation\r\n   * @param y          y game coordinate to play the animation\r\n   * @deprecated\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Actor.graphics' })\r\n  public playAnimation(animation: Animation, x: number, y: number) {\r\n    this._animations.push(new AnimationNode(animation, x, y));\r\n  }\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public addTileMap(tileMap: TileMap) {\r\n    this.currentScene.addTileMap(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public removeTileMap(tileMap: TileMap) {\r\n    this.currentScene.removeTileMap(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    return this.currentScene.addTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    return this.currentScene.removeTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   *\r\n   * @param key  The name of the scene, must be unique\r\n   * @param scene The scene to add to the engine\r\n   */\r\n  public addScene(key: string, scene: Scene) {\r\n    if (this.scenes[key]) {\r\n      this._logger.warn('Scene', key, 'already exists overwriting');\r\n    }\r\n    this.scenes[key] = scene;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Scene]] instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public removeScene(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param key  The scene key to remove\r\n   */\r\n  public removeScene(key: string): void;\r\n  /**\r\n   * @internal\r\n   */\r\n  public removeScene(entity: any): void {\r\n    if (entity instanceof Scene) {\r\n      // remove scene\r\n      for (const key in this.scenes) {\r\n        if (this.scenes.hasOwnProperty(key)) {\r\n          if (this.scenes[key] === entity) {\r\n            delete this.scenes[key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      // remove scene\r\n      delete this.scenes[entity];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param sceneKey  The key of the scene, must be unique\r\n   * @param scene     The scene to add to the engine\r\n   */\r\n  public add(sceneKey: string, scene: Scene): void;\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n  /**\r\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.add(actor)`.\r\n   *\r\n   * Actors can only be drawn if they are a member of a scene, and only\r\n   * the [[currentScene]] may be drawn or updated.\r\n   *\r\n   * @param actor  The actor to add to the [[currentScene]]\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\r\n   * ScreenElements do not participate in collisions, instead the\r\n   * remain in the same place on the screen.\r\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    if (arguments.length === 2) {\r\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\r\n      return;\r\n    }\r\n    if (this._deferredGoTo && this.scenes[this._deferredGoTo]) {\r\n      this.scenes[this._deferredGoTo].add(entity);\r\n    } else {\r\n      this.currentScene.add(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a scene instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public remove(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param sceneKey  The scene to remove\r\n   */\r\n  public remove(sceneKey: string): void;\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public remove(timer: Timer): void;\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n  /**\r\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.removeChild(actor)`.\r\n   * Actors that are removed from a scene will no longer be drawn or updated.\r\n   *\r\n   * @param actor  The actor to remove from the [[currentScene]].\r\n   */\r\n  public remove(actor: Actor): void;\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.currentScene.remove(entity);\r\n    }\r\n\r\n    if (entity instanceof Scene) {\r\n      this.removeScene(entity);\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      this.removeScene(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes the currently updating and drawing scene to a different,\r\n   * named scene. Calls the [[Scene]] lifecycle events.\r\n   * @param key  The key of the scene to transition to.\r\n   */\r\n  public goToScene(key: string): void {\r\n    // if not yet initialized defer goToScene\r\n    if (!this.isInitialized) {\r\n      this._deferredGoTo = key;\r\n      return;\r\n    }\r\n\r\n    if (this.scenes[key]) {\r\n      const oldScene = this.currentScene;\r\n      const newScene = this.scenes[key];\r\n\r\n      this._logger.debug('Going to scene:', key);\r\n\r\n      // only deactivate when initialized\r\n      if (this.currentScene.isInitialized) {\r\n        this.currentScene._deactivate.apply(this.currentScene, [oldScene, newScene]);\r\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\r\n      }\r\n\r\n      // set current scene to new one\r\n      this.currentScene = newScene;\r\n      this.screen.setCurrentCamera(newScene.camera);\r\n\r\n      // initialize the current scene if has not been already\r\n      this.currentScene._initialize(this);\r\n\r\n      this.currentScene._activate.apply(this.currentScene, [oldScene, newScene]);\r\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\r\n    } else {\r\n      this._logger.error('Scene', key, 'does not exist!');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transforms the current x, y from screen coordinates to world coordinates\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    return this.screen.screenToWorldCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Transforms a world coordinate, to a screen coordinate\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    return this.screen.worldToScreenCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\r\n   */\r\n  private _initialize(options?: EngineOptions) {\r\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\r\n\r\n    // initialize inputs\r\n    this.input = {\r\n      keyboard: new Input.Keyboard(),\r\n      pointers: new Input.Pointers(this),\r\n      gamepads: new Input.Gamepads()\r\n    };\r\n    this.input.keyboard.init();\r\n    this.input.pointers.init(options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas);\r\n    this.input.gamepads.init();\r\n\r\n    // Issue #385 make use of the visibility api\r\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\r\n\r\n    let hidden: keyof HTMLDocument, visibilityChange: string;\r\n    if (typeof document.hidden !== 'undefined') {\r\n      // Opera 12.10 and Firefox 18 and later support\r\n      hidden = 'hidden';\r\n      visibilityChange = 'visibilitychange';\r\n    } else if ('msHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'msHidden';\r\n      visibilityChange = 'msvisibilitychange';\r\n    } else if ('webkitHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'webkitHidden';\r\n      visibilityChange = 'webkitvisibilitychange';\r\n    }\r\n\r\n    this.browser.document.on(visibilityChange, () => {\r\n      if (document[hidden]) {\r\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\r\n        this._logger.debug('Window hidden');\r\n      } else {\r\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\r\n        this._logger.debug('Window visible');\r\n      }\r\n    });\r\n\r\n    if (!this.canvasElementId && !options.canvasElement) {\r\n      document.body.appendChild(this.canvas);\r\n    }\r\n  }\r\n\r\n  public onInitialize(_engine: Engine) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If supported by the browser, this will set the antialiasing flag on the\r\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\r\n   * image resources.\r\n   * @param isSmooth  Set smoothing to true or false\r\n   */\r\n  public setAntialiasing(isSmooth: boolean) {\r\n    this.screen.antialiasing = isSmooth;\r\n  }\r\n\r\n  /**\r\n   * Return the current smoothing status of the canvas\r\n   */\r\n  public getAntialiasing(): boolean {\r\n    return this.screen.antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  private _overrideInitialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n      if (this._deferredGoTo) {\r\n        this.goToScene(this._deferredGoTo);\r\n      } else {\r\n        this.goToScene('root');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the entire state of the game\r\n   * @param delta  Number of milliseconds elapsed since the last update.\r\n   */\r\n  private _update(delta: number) {\r\n    if (this._isLoading) {\r\n      // suspend updates until loading is finished\r\n      this._loader.update(this, delta);\r\n      // Update input listeners\r\n      this.input.keyboard.update();\r\n      this.input.pointers.update();\r\n      this.input.gamepads.update();\r\n      return;\r\n    }\r\n\r\n    this._overrideInitialize(this);\r\n\r\n    // Publish preupdate events\r\n    this._preupdate(delta);\r\n\r\n    // process engine level events\r\n    this.currentScene.update(this, delta);\r\n\r\n    // update animations\r\n    // TODO remove\r\n    this._animations = this._animations.filter(function (a) {\r\n      return !a.animation.isDone();\r\n    });\r\n\r\n    // Update input listeners\r\n    this.input.keyboard.update();\r\n    this.input.pointers.update();\r\n    this.input.gamepads.update();\r\n\r\n    // Publish update event\r\n    this._postupdate(delta);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _preupdate(delta: number) {\r\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\r\n    this.onPreUpdate(this, delta);\r\n  }\r\n\r\n  public onPreUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postupdate(delta: number) {\r\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\r\n    this.onPostUpdate(this, delta);\r\n  }\r\n\r\n  public onPostUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Draws the entire game\r\n   * @param delta  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  private _draw(delta: number) {\r\n    const ctx = this.ctx;\r\n    this._predraw(ctx, delta);\r\n\r\n    if (this._isLoading) {\r\n      this._loader.canvas.draw(this.graphicsContext, 0, 0);\r\n      this.graphicsContext.flush();\r\n      // Drawing nothing else while loading\r\n      return;\r\n    }\r\n\r\n    // TODO move to graphics systems?\r\n    this.graphicsContext.backgroundColor = this.backgroundColor;\r\n\r\n    this.currentScene.draw(this.ctx, delta);\r\n\r\n    // todo needs to be a better way of doing this\r\n    let a = 0;\r\n    const len = this._animations.length;\r\n    for (a; a < len; a++) {\r\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\r\n    }\r\n\r\n    // Draw debug information\r\n    // TODO don't access ctx directly\r\n    if (this.isDebug) {\r\n      this.ctx.font = 'Consolas';\r\n      this.ctx.fillStyle = this.debugColor.toString();\r\n      const keys = this.input.keyboard.getKeys();\r\n      for (let j = 0; j < keys.length; j++) {\r\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\r\n      }\r\n\r\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\r\n    }\r\n\r\n    // Post processing\r\n    for (let i = 0; i < this.postProcessors.length; i++) {\r\n      this.postProcessors[i].process(this.ctx.getImageData(0, 0, this.canvasWidth, this.canvasHeight), this.ctx);\r\n    }\r\n\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\r\n    this.onPreDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\r\n    this.onPostDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Enable or disable Excalibur debugging functionality.\r\n   * @param toggle a value that debug drawing will be changed to\r\n   */\r\n  public showDebug(toggle: boolean): void {\r\n    this._isDebug = toggle;\r\n  }\r\n\r\n  /**\r\n   * Toggle Excalibur debugging functionality.\r\n   */\r\n  public toggleDebug(): boolean {\r\n    this._isDebug = !this._isDebug;\r\n    return this._isDebug;\r\n  }\r\n\r\n  private _loadingComplete: boolean = false;\r\n  /**\r\n   * Returns true when loading is totally complete and the player has clicked start\r\n   */\r\n  public get loadingComplete() {\r\n    return this._loadingComplete;\r\n  }\r\n  /**\r\n   * Starts the internal game loop for Excalibur after loading\r\n   * any provided assets.\r\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\r\n   * custom loader.\r\n   */\r\n  public start(loader?: Loader): Promise<void> {\r\n    if (!this._compatible) {\r\n      return Promise.reject('Excalibur is incompatible with your browser');\r\n    }\r\n    let loadingComplete: Promise<void>;\r\n    // Push the current user entered resolution/viewport\r\n    this.screen.pushResolutionAndViewport();\r\n    // Configure resolution for loader\r\n    this.screen.resolution = this.screen.viewport;\r\n    this.screen.applyResolutionAndViewport();\r\n    this.graphicsContext.updateViewport();\r\n    if (loader) {\r\n      this._loader = loader;\r\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\r\n      this._loader.wireEngine(this);\r\n      loadingComplete = this.load(this._loader);\r\n    } else {\r\n      loadingComplete = Promise.resolve();\r\n    }\r\n\r\n    loadingComplete.then(() => {\r\n      this.screen.popResolutionAndViewport();\r\n      this.screen.applyResolutionAndViewport();\r\n      this.graphicsContext.updateViewport();\r\n      this.emit('start', new GameStartEvent(this));\r\n      this._loadingComplete = true;\r\n    });\r\n\r\n    if (!this._hasStarted) {\r\n      // has started is a slight misnomer, it's really mainloop started\r\n      this._hasStarted = true;\r\n      this._logger.debug('Starting game...');\r\n      this.browser.resume();\r\n      Engine.createMainLoop(this, window.requestAnimationFrame, Date.now)();\r\n      this._logger.debug('Game started');\r\n    } else {\r\n      // Game already started;\r\n    }\r\n    return loadingComplete;\r\n  }\r\n\r\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\r\n    let lastTime = nowFn();\r\n\r\n    return function mainloop() {\r\n      if (!game._hasStarted) {\r\n        return;\r\n      }\r\n      try {\r\n        game._requestId = raf(mainloop);\r\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\r\n\r\n        // Get the time to calculate time-elapsed\r\n        const now = nowFn();\r\n        let elapsed = Math.floor(now - lastTime) || 1;\r\n        // Resolves issue #138 if the game has been paused, or blurred for\r\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\r\n        // and provides more expected behavior when the engine comes back\r\n        // into focus\r\n        if (elapsed > 200) {\r\n          elapsed = 1;\r\n        }\r\n        const delta = elapsed * game.timescale;\r\n\r\n        // reset frame stats (reuse existing instances)\r\n        const frameId = game.stats.prevFrame.id + 1;\r\n        game.stats.currFrame.reset();\r\n        game.stats.currFrame.id = frameId;\r\n        game.stats.currFrame.delta = delta;\r\n        game.stats.currFrame.fps = 1.0 / (delta / 1000);\r\n\r\n        const beforeUpdate = nowFn();\r\n        game._update(delta);\r\n        const afterUpdate = nowFn();\r\n        game._draw(delta);\r\n        const afterDraw = nowFn();\r\n\r\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\r\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\r\n\r\n        lastTime = now;\r\n\r\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\r\n        game.stats.prevFrame.reset(game.stats.currFrame);\r\n      } catch (e) {\r\n        window.cancelAnimationFrame(game._requestId);\r\n        game.stop();\r\n        game.onFatalException(e);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Stops Excalibur's main loop, useful for pausing the game.\r\n   */\r\n  public stop() {\r\n    if (this._hasStarted) {\r\n      this.emit('stop', new GameStopEvent(this));\r\n      this.browser.pause();\r\n      this._hasStarted = false;\r\n      this._logger.debug('Game stopped');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\r\n   */\r\n  public isPaused(): boolean {\r\n    return !this._hasStarted;\r\n  }\r\n\r\n  /**\r\n   * Takes a screen shot of the current viewport and returns it as an\r\n   * HTML Image Element.\r\n   */\r\n  public screenshot(): HTMLImageElement {\r\n    const result = new Image();\r\n    const raw = this.canvas.toDataURL('image/png');\r\n    result.src = raw;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Another option available to you to load resources into the game.\r\n   * Immediately after calling this the game will pause and the loading screen\r\n   * will appear.\r\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\r\n   */\r\n  public load(loader: Loadable<any>): Promise<void> {\r\n    const complete = new Promise<void>((resolve) => {\r\n      this._isLoading = true;\r\n\r\n      loader.load().then(() => {\r\n        if (this._suppressPlayButton) {\r\n          setTimeout(() => {\r\n            this._isLoading = false;\r\n            resolve();\r\n            // Delay is to give the logo a chance to show, otherwise don't delay\r\n          }, 500);\r\n        } else {\r\n          this._isLoading = false;\r\n          resolve();\r\n        }\r\n      });\r\n    });\r\n\r\n    return complete;\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n * @deprecated\r\n */\r\n@obsolete({ message: 'Will be removed in excalibur v0.26.0' })\r\nclass AnimationNode {\r\n  constructor(public animation: Animation, public x: number, public y: number) {}\r\n}\r\n","import { GameEvent } from '../Events';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Actor } from '../Actor';\r\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\r\n\r\nexport class MediaEvent extends GameEvent<Sound> {\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public set bubbles(_value: boolean) {\r\n    // stubbed\r\n  }\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public get bubbles(): boolean {\r\n    return false;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected get _path(): Actor[] {\r\n    return null;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected set _path(_val: Actor[]) {\r\n    // stubbed\r\n  }\r\n\r\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public action(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Propagate event further through event path\r\n   */\r\n  public propagate(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n\r\n  public layPath(_actor: Actor): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n}\r\n\r\nexport class NativeSoundEvent extends MediaEvent {\r\n  constructor(target: Sound, public track?: WebAudioInstance) {\r\n    super(target, 'NativeSoundEvent');\r\n  }\r\n}\r\n\r\nexport class NativeSoundProcessedEvent extends MediaEvent {\r\n  public data: string | AudioBuffer;\r\n\r\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\r\n    super(target, 'NativeSoundProcessedEvent');\r\n\r\n    this.data = this._processedData;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/Index';\nimport { Color } from '../Color';\nimport { line } from '../Util/DrawUtil';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\nimport { Raster, RasterOptions } from './Raster';\n\nexport class Font extends Raster implements FontRenderer {\n  constructor(options: FontOptions & RasterOptions = {}) {\n    super(options);\n    this.family = options?.family ?? this.family;\n    this.style = options?.style ?? this.style;\n    this.bold = options?.bold ?? this.bold;\n    this.size = options?.size ?? this.size;\n    this.unit = options?.unit ?? this.unit;\n    this.textAlign = options?.textAlign ?? this.textAlign;\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\n    this.direction = options?.direction ?? this.direction;\n    this.quality = options?.quality ?? this.quality;\n    if (options?.shadow) {\n      this.shadow = {};\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\n    }\n    this.flagDirty();\n  }\n\n  public clone() {\n    return new Font({\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions(),\n      size: this.size,\n      unit: this.unit,\n      family: this.family,\n      style: this.style,\n      bold: this.bold,\n      textAlign: this.textAlign,\n      baseAlign: this.baseAlign,\n      direction: this.direction,\n      shadow: this.shadow\n        ? {\n          blur: this.shadow.blur,\n          offset: this.shadow.offset,\n          color: this.shadow.color\n        }\n        : null\n    });\n  }\n\n  /**\n   * Font quality determines the size of the underlying rastered text, higher quality means less jagged edges.\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\n   *\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\n   *\n   * (Default 4)\n   */\n  public quality = 2;\n\n  public family: string = 'sans-serif';\n  public style: FontStyle = FontStyle.Normal;\n  public bold: boolean = false;\n  public unit: FontUnit = FontUnit.Px;\n  public textAlign: TextAlign = TextAlign.Left;\n  public baseAlign: BaseAlign = BaseAlign.Alphabetic;\n  public direction: Direction = Direction.LeftToRight;\n  public size: number = 10;\n  public shadow: { blur?: number; offset?: Vector; color?: Color } = null;\n\n  public get fontString() {\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\n  }\n\n  private _text: string;\n  private _lines: string[];\n  private _textBounds: BoundingBox = new BoundingBox();\n  private _textWidth: number = 0;\n  private _textHeight: number = 0;\n\n  public get width() {\n    return this._textWidth;\n  }\n\n  public set width(value: number) {\n    this._textWidth = value;\n  }\n\n  public get height() {\n    const numLines = this._lines?.length ?? 1;\n    return this._textHeight * numLines;\n  }\n\n  public set height(value: number) {\n    const numLines = this._lines?.length ?? 1;\n    this._textHeight = value / numLines;\n  }\n\n  private get _rasterWidth() {\n    return this._bitmap.width;\n  }\n\n  private get _rasterHeight() {\n    return this._bitmap.height;\n  }\n\n  private get _halfRasterWidth() {\n    return Math.floor(this._bitmap.width / 2);\n  }\n\n  private get _halfRasterHeight() {\n    return Math.floor(this._bitmap.height / 2);\n  }\n\n  public get localBounds(): BoundingBox {\n    return this._textBounds;\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this.dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(\n      this._bitmap,\n      0,\n      0,\n      this._rasterWidth,\n      this._rasterHeight,\n      x - this._rasterWidth / this.quality / 2,\n      y - this._rasterHeight / this.quality / 2,\n      this._rasterWidth / this.quality,\n      this._rasterHeight / this.quality\n    );\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    // TODO this needs to change depending on the bounding box...\n    const origin = this.origin ?? this._textBounds.center;\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this._textBounds.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  public updateText(text: string) {\n    if (this._text !== text) {\n      this._text = text;\n      this._lines = this._text.split('\\n');\n      this._updateDimensions();\n      this.flagDirty();\n    }\n  }\n\n  private _updateDimensions() {\n    if (this._text) {\n      this._applyFont(this._ctx);\n      const maxWidthLine = this._lines.reduce((a, b) => {\n        return a.length > b.length ? a : b;\n      });\n      const metrics = this._ctx.measureText(maxWidthLine);\n      this._textWidth = Math.abs(metrics.actualBoundingBoxLeft) + Math.abs(metrics.actualBoundingBoxRight);\n      this._textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\n\n      // TODO lineheight makes the text bounds wonky\n      const lineAdjustedHeight = this._textHeight * this._lines.length;\n      // this._textHeight = lineAdjustedHeight;\n      // Changing the width and height clears the context properties\n      // We double the bitmap width to account for alignment\n      // We scale by \"quality\" so we render text without jaggies\n      this._bitmap.width = (this._textWidth + this.padding * 2) * 2 * this.quality;\n      this._bitmap.height = (lineAdjustedHeight + this.padding * 2) * 2 * this.quality;\n\n      // These bounds exist in raster bitmap space where the top left corner is the corder of the bitmap\n      const x = 0;\n      const y = 0;\n      const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\n      this._textBounds = new BoundingBox({\n        left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.padding,\n        top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.padding,\n        bottom: y + bottomBounds + this.padding,\n        right: x + Math.abs(metrics.actualBoundingBoxRight) + this.padding\n      });\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.dirty) {\n      this._updateDimensions();\n    }\n    super._preDraw(ex, x, y);\n  }\n\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      /* istanbul ignore next */\n      ex.debug.drawRect(-this._halfRasterWidth, -this._halfRasterHeight, this._rasterWidth, this._rasterHeight);\n    }\n    ex.restore();\n  }\n\n  private _applyFont(ctx: CanvasRenderingContext2D) {\n    ctx.translate(this.padding + this._halfRasterWidth, this.padding + this._halfRasterHeight);\n    ctx.scale(this.quality, this.quality);\n    ctx.textAlign = this.textAlign;\n    ctx.textBaseline = this.baseAlign;\n    ctx.font = this.fontString;\n    ctx.direction = this.direction;\n\n    if (this.shadow) {\n      ctx.shadowColor = this.shadow.color.toString();\n      ctx.shadowBlur = this.shadow.blur;\n      ctx.shadowOffsetX = this.shadow.offset.x;\n      ctx.shadowOffsetY = this.shadow.offset.y;\n    }\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this._text) {\n      // The reason we need to re-apply the font is setting raster properties (like width/height) can reset the context props\n      this._applyRasterProperites(ctx);\n      this._applyFont(ctx);\n\n      const lineHeight = this._textHeight; // TODO user specified line height\n      for (let i = 0; i < this._lines.length; i++) {\n        const line = this._lines[i];\n        if (this.color) {\n          ctx.fillText(line, 0, i * lineHeight);\n        }\n\n        if (this.strokeColor) {\n          ctx.strokeText(line, 0, i * lineHeight);\n        }\n      }\n\n      if (this.showDebug) {\n        // Horizontal line\n        /* istanbul ignore next */\n        line(ctx, Color.Red, -this._halfRasterWidth, 0, this._halfRasterWidth, 0, 2);\n        // Vertical line\n        /* istanbul ignore next */\n        line(ctx, Color.Red, 0, -this._halfRasterHeight, 0, this._halfRasterHeight, 2);\n      }\n    }\n  }\n\n  public render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number) {\n    this.updateText(text);\n    this.draw(ex, x, y);\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { SpriteFont } from './SpriteFont';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Color } from '../Color';\r\nimport { Font } from './Font';\r\nimport { watch } from '../Util/Watch';\r\n\r\nexport interface TextOptions {\r\n  text: string;\r\n  color?: Color;\r\n  font?: Font | SpriteFont;\r\n}\r\n\r\nexport class Text extends Graphic {\r\n  constructor(options: TextOptions & GraphicOptions) {\r\n    super(options);\r\n    // This order is important font, color, then text\r\n    this.font = options.font ?? new Font();\r\n    this.color = options.color ?? this.color;\r\n    this.text = options.text;\r\n  }\r\n\r\n  public clone(): Text {\r\n    return new Text({\r\n      text: this.text.slice(),\r\n      color: this.color.clone(),\r\n      font: this.font.clone()\r\n    });\r\n  }\r\n\r\n  private _text: string = '';\r\n  public get text() {\r\n    return this._text;\r\n  }\r\n\r\n  public set text(value: string) {\r\n    this._text = value;\r\n    this.font.updateText(value);\r\n  }\r\n\r\n  // TODO SpriteFont doesn't support a color yet :(\r\n  public get color() {\r\n    if (this.font instanceof Font) {\r\n      return this.font.color;\r\n    }\r\n    return Color.Black;\r\n  }\r\n\r\n  public set color(color: Color) {\r\n    if (this.font instanceof Font) {\r\n      this.font.color = color;\r\n    }\r\n  }\r\n\r\n  private _font: Font | SpriteFont;\r\n  public get font(): Font | SpriteFont {\r\n    return this._font;\r\n  }\r\n  public set font(font: Font | SpriteFont) {\r\n    if (font instanceof Font) {\r\n      this._font = watch(font, (font) => font.flagDirty());\r\n    } else {\r\n      this._font = font;\r\n    }\r\n  }\r\n\r\n  public get width() {\r\n    return this.font.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.font.height;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this.font.localBounds;\r\n  }\r\n\r\n  protected _rotate(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected _flip(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.font instanceof Font) {\r\n      this.font.color = this.color;\r\n    }\r\n    this.font.flipHorizontal = this.flipHorizontal;\r\n    this.font.flipVertical = this.flipVertical;\r\n    this.font.scale = this.scale;\r\n    this.font.rotation = this.rotation;\r\n    this.font.origin = this.origin;\r\n    this.font.opacity = this.opacity;\r\n    this.font.render(ex, this._text, x, y);\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { vec, Vector } from './Math/vector';\r\nimport { Text } from './Graphics/Text';\r\nimport { BaseAlign, FontStyle, FontUnit, TextAlign } from './Graphics/FontCommon';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { SpriteFont as LegacySpriteFont } from './Drawing/SpriteSheet';\r\nimport { ExcaliburGraphicsContext, GraphicsComponent, SpriteFont } from './Graphics';\r\nimport { Font } from './Graphics/Font';\r\nimport { Actor } from './Actor';\r\nimport { ActorArgs } from '.';\r\n\r\n/**\r\n * Option for creating a label\r\n */\r\nexport interface LabelOptions {\r\n  /**\r\n   * Specify the label text\r\n   */\r\n  text?: string;\r\n  /**\r\n   * Specify the color of the text (does not apply to SpriteFonts)\r\n   */\r\n  color?: Color;\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally specify a sprite font, will take precedence over any other [[Font]]\r\n   */\r\n  spriteFont?: SpriteFont | LegacySpriteFont;\r\n  /**\r\n   * Specify a custom font\r\n   */\r\n  font?: Font\r\n}\r\n\r\n/**\r\n * Labels are the way to draw small amounts of text to the screen. They are\r\n * actors and inherit all of the benefits and capabilities.\r\n */\r\nexport class Label extends Actor {\r\n  public font: Font = new Font();\r\n  private _text: Text = new Text({ text: '', font: this.font });\r\n\r\n  /**\r\n   * The text to draw.\r\n   */\r\n  public get text(): string {\r\n    return this._text.text;\r\n  }\r\n\r\n  public set text(text: string) {\r\n    this._text.text = text;\r\n  }\r\n\r\n  public get color(): Color {\r\n    return this._text.color;\r\n  }\r\n\r\n  public set color(color: Color) {\r\n    this._text.color = color;\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this._text.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this._text.opacity = opacity;\r\n  }\r\n\r\n  /**\r\n   * Sets or gets the bold property of the label's text, by default it's false\r\n   * @deprecated Use [[Font.bold|Label.font.bold]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.bold will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.bold'\r\n  })\r\n  public get bold(): boolean {\r\n    return this.font.bold;\r\n  }\r\n\r\n  public set bold(isBold: boolean) {\r\n    this.font.bold = isBold;\r\n  }\r\n\r\n  /**\r\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\r\n   * are supported, same as in CSS.\r\n   * @deprecated Use [[Font.family|Label.font.family]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontFamily will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.family'\r\n  })\r\n  public get fontFamily(): string {\r\n    return this.font.family;\r\n  }\r\n\r\n  public set fontFamily(family: string) {\r\n    this.font.family = family;\r\n  }\r\n\r\n  /**\r\n   * The font size in the selected units, default is 10 (default units is pixel)\r\n   * @deprecated Use [[Font.size|Label.font.size]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontSize will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.size'\r\n  })\r\n  public get fontSize(): number {\r\n    return this.font.size;\r\n  }\r\n\r\n  public set fontSize(sizeInUnit: number) {\r\n    this.font.size = sizeInUnit;\r\n  }\r\n\r\n  /**\r\n   * The font style for this label, the default is [[FontStyle.Normal]]\r\n   * @deprecated Use [[Font.style|Label.font.style]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontStyle will be removed in v0.26.0',\r\n    alternateMethod: 'Use Lable.font.style'\r\n  })\r\n  public get fontStyle(): FontStyle {\r\n    return this.font.style;\r\n  }\r\n\r\n  public set fontStyle(style: FontStyle) {\r\n    this.font.style = style;\r\n  }\r\n\r\n  /**\r\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\r\n   * @deprecated Use [[Font.unit|Label.font.unit]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontUnit will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.unit'\r\n  })\r\n  public get fontUnit(): FontUnit {\r\n    return this.font.unit;\r\n  }\r\n\r\n  public set fontUnit(unit: FontUnit) {\r\n    this.font.unit = unit;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the horizontal text alignment property for the label.\r\n   * @deprecated Use [[Font.textAlign|Label.font.textAlign]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.textAlign will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.textAlign'\r\n  })\r\n  public get textAlign(): TextAlign {\r\n    return this.font.textAlign;\r\n  }\r\n\r\n  public set textAlign(align: TextAlign) {\r\n    this.font.textAlign = align;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the baseline alignment property for the label.\r\n   * @deprecated Use [[Font.baseAlign|Label.font.baseAlign]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.baseAlign will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.baseAlign'\r\n  })\r\n  public get baseAlign(): BaseAlign {\r\n    return this.font.baseAlign;\r\n  }\r\n\r\n  public set baseAlign(align: BaseAlign) {\r\n    this.font.baseAlign = align;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the maximum width (in pixels) that the label should occupy\r\n   * @deprecated The maxWidth constraint is gone\r\n   */\r\n  public maxWidth: number;\r\n\r\n  private _legacySpriteFont: LegacySpriteFont;\r\n  private _spriteFont: SpriteFont;\r\n  /**\r\n   * The [[LegacyDrawing.SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\r\n   * @deprecated Use [[SpriteFont]]\r\n   */\r\n  @obsolete()\r\n  public get spriteFont(): LegacySpriteFont {\r\n    return this._legacySpriteFont;\r\n  }\r\n\r\n  public set spriteFont(sf: LegacySpriteFont | SpriteFont) {\r\n    if (sf) {\r\n      if (sf instanceof LegacySpriteFont) {\r\n        this._legacySpriteFont = sf;\r\n        this._spriteFont = SpriteFont.fromLegacySpriteFont(sf);\r\n        this._text.font = this._spriteFont;\r\n        return;\r\n      }\r\n      this._spriteFont = sf;\r\n      this._text.font = this._spriteFont;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\r\n   * @deprecated Use [[SpriteFont.spacing]]\r\n   */\r\n  public letterSpacing: number = 0; //px\r\n\r\n  /**\r\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\r\n   * @deprecated Use Graphics.SpriteFont.caseInsensitve\r\n   */\r\n  public caseInsensitive: boolean = true;\r\n\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Build a new label\r\n   * @param options\r\n   */\r\n  constructor(options?: LabelOptions & ActorArgs) {\r\n    super(options);\r\n    const {text, pos, x, y, spriteFont, font, color} = options;\r\n\r\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\r\n    this.text = text ?? this.text;\r\n    this.spriteFont = spriteFont ?? this.spriteFont;\r\n    this.font = font ?? this.font;\r\n    this.color = color ?? this.color;\r\n    const gfx = this.get(GraphicsComponent);\r\n    gfx.anchor = Vector.Zero;\r\n    gfx.use(this._text);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    this._graphicsContext = engine.graphicsContext;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the text in the label (in pixels);\r\n   */\r\n  public getTextWidth(): number {\r\n    return this._text.width;\r\n  }\r\n\r\n  /**\r\n   * Sets the text shadow for sprite fonts\r\n   * @param offsetX      The x offset in pixels to place the shadow\r\n   * @param offsetY      The y offset in pixels to place the shadow\r\n   * @param shadowColor  The color of the text shadow\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.setTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\r\n    this.font.shadow = { offset: vec(offsetX, offsetY), blur: 2, color: shadowColor };\r\n  }\r\n\r\n  /**\r\n   * Toggles text shadows on or off, only applies when using sprite fonts\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.useTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public useTextShadow(on: boolean) {\r\n    if (this.spriteFont) {\r\n      this.spriteFont.useTextShadow(on);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the current text shadow\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.clearTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public clearTextShadow() {\r\n    this.font.shadow = null;\r\n  }\r\n\r\n  public draw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    const exctx = this._graphicsContext;\r\n    this._text.draw(exctx, 0, 0);\r\n  }\r\n}\r\n","import { CollisionGroup } from './CollisionGroup';\r\n\r\n/**\r\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\r\n */\r\nexport class CollisionGroupManager {\r\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\r\n  private static _STARTING_BIT = 0b1 | 0;\r\n  private static _MAX_GROUPS = 32;\r\n  private static _CURRENT_GROUP = 1;\r\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\r\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\r\n\r\n  /**\r\n   * Create a new named collision group up to a max of 32.\r\n   * @param name Name for the collision group\r\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\r\n   */\r\n  public static create(name: string, mask?: number) {\r\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\r\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\r\n    }\r\n    if (this._GROUPS.get(name)) {\r\n      throw new Error(`Collision group ${name} already exists`);\r\n    }\r\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\r\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\r\n    this._CURRENT_GROUP++;\r\n    this._GROUPS.set(name, group);\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get all collision groups currently tracked by excalibur\r\n   */\r\n  public static get groups(): CollisionGroup[] {\r\n    return Array.from(this._GROUPS.values());\r\n  }\r\n\r\n  /**\r\n   * Get a collision group by it's name\r\n   * @param name\r\n   */\r\n  public static groupByName(name: string) {\r\n    return this._GROUPS.get(name);\r\n  }\r\n\r\n  /**\r\n   * Resets the managers internal group management state\r\n   */\r\n  public static reset() {\r\n    this._GROUPS = new Map<string, CollisionGroup>();\r\n    this._CURRENT_BIT = this._STARTING_BIT;\r\n    this._CURRENT_GROUP = 1;\r\n  }\r\n}\r\n","import { Color } from '../Color';\r\nimport * as Effects from './SpriteEffects';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * Creates a closed polygon drawing given a list of [[Vector]]s.\r\n *\r\n * @deprecated Use [[Polygon]]\r\n * @warning Use sparingly as Polygons are performance intensive\r\n */\r\n@obsolete({\r\n  message: 'Polygon will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.Polygon'\r\n})\r\nexport class Polygon implements Drawable {\r\n  public flipVertical: boolean;\r\n  public flipHorizontal: boolean;\r\n  public drawWidth: number;\r\n  public drawHeight: number;\r\n\r\n  public width: number;\r\n  public height: number;\r\n\r\n  /**\r\n   * The color to use for the lines of the polygon\r\n   */\r\n  public lineColor: Color;\r\n  /**\r\n   * The color to use for the interior of the polygon\r\n   */\r\n  public fillColor: Color;\r\n  /**\r\n   * The width of the lines of the polygon\r\n   */\r\n  public lineWidth: number = 5;\r\n  /**\r\n   * Indicates whether the polygon is filled or not.\r\n   */\r\n  public filled: boolean = false;\r\n\r\n  private _points: Vector[] = [];\r\n  public anchor = Vector.Zero;\r\n  public offset = Vector.Zero;\r\n  public rotation: number = 0;\r\n  public scale = Vector.One;\r\n  public opacity: number = 1;\r\n\r\n  /**\r\n   * @param points  The vectors to use to build the polygon in order\r\n   */\r\n  constructor(points: Vector[]) {\r\n    this._points = points;\r\n\r\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.min(prev, curr.x);\r\n    }, 0);\r\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.max(prev, curr.x);\r\n    }, 0);\r\n\r\n    this.drawWidth = maxX - minX;\r\n\r\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.min(prev, curr.y);\r\n    }, 0);\r\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.max(prev, curr.y);\r\n    }, 0);\r\n\r\n    this.drawHeight = maxY - minY;\r\n\r\n    this.height = this.drawHeight;\r\n    this.width = this.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public addEffect() {\r\n    // not supported on polygons\r\n  }\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect(index: number): void;\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect() {\r\n    // not supported on polygons\r\n  }\r\n\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public clearEffects() {\r\n    // not supported on polygons\r\n  }\r\n\r\n  public reset() {\r\n    //pass\r\n  }\r\n\r\n  /**\r\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the sprite with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.drawWidth,\r\n      drawHeight: options.drawHeight ?? this.drawHeight,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      offset: options.offset ?? this.offset,\r\n      opacity: (options.opacity ?? 1) * (this.opacity ?? 1)\r\n    };\r\n\r\n    const xpoint = drawWidth * anchor.x + offset.x + x;\r\n    const ypoint = drawHeight * anchor.y + offset.y + y;\r\n\r\n    ctx.save();\r\n    ctx.translate(xpoint, ypoint);\r\n    ctx.scale(this.scale.x, this.scale.y);\r\n    ctx.rotate(rotation);\r\n    ctx.beginPath();\r\n    ctx.lineWidth = this.lineWidth;\r\n\r\n    // Iterate through the supplied points and construct a 'polygon'\r\n    const firstPoint = this._points[0];\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n\r\n    let i = 0;\r\n    const len = this._points.length;\r\n\r\n    for (i; i < len; i++) {\r\n      ctx.lineTo(this._points[i].x, this._points[i].y);\r\n    }\r\n\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n\r\n    if (this.filled) {\r\n      ctx.fillStyle = this.fillColor.toString();\r\n      ctx.fill();\r\n    }\r\n\r\n    ctx.strokeStyle = this.lineColor.toString();\r\n\r\n    if (flipHorizontal) {\r\n      ctx.translate(drawWidth, 0);\r\n      ctx.scale(-1, 1);\r\n    }\r\n\r\n    if (flipVertical) {\r\n      ctx.translate(0, drawHeight);\r\n      ctx.scale(1, -1);\r\n    }\r\n\r\n    const oldAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = opacity;\r\n    ctx.stroke();\r\n    ctx.globalAlpha = oldAlpha;\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Audio } from './Audio';\r\n\r\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\r\n\r\nexport interface ExResponseTypesLookup {\r\n  [name: string]: ExResponseType;\r\n}\r\n\r\nexport class ExResponse {\r\n  public static type: ExResponseTypesLookup = {\r\n    any: '',\r\n    blob: 'blob',\r\n    json: 'json',\r\n    text: 'text',\r\n    document: 'document',\r\n    arraybuffer: 'arraybuffer'\r\n  };\r\n}\r\n\r\n/**\r\n * Represents an audio implementation like [[WebAudioInstance]]\r\n */\r\nexport interface AudioImplementation {\r\n  /**\r\n   * XHR response type\r\n   */\r\n  responseType: ExResponseType;\r\n\r\n  /**\r\n   * Processes raw data and transforms into sound data\r\n   */\r\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\r\n\r\n  /**\r\n   * Factory method that returns an instance of a played audio track\r\n   */\r\n  createInstance(data: string | AudioBuffer): Audio;\r\n}\r\n","import { Engine } from './../Engine';\r\nimport * as Events from './../Events';\r\nimport { Scene } from '../Scene';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _initialize {\r\n  _initialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n * Type guard checking for internal initialize method\r\n * @internal\r\n * @param a\r\n */\r\nexport function has_initialize(a: any): a is _initialize {\r\n  return !!a._initialize;\r\n}\r\n\r\nexport interface OnInitialize {\r\n  onInitialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnInitialize(a: any): a is OnInitialize {\r\n  return !!a.onInitialize;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _preupdate {\r\n  _preupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_preupdate(a: any): a is _preupdate {\r\n  return !!a._preupdate;\r\n}\r\n\r\nexport interface OnPreUpdate {\r\n  onPreUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\r\n  return !!a.onPreUpdate;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _postupdate {\r\n  _postupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_postupdate(a: any): a is _postupdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface OnPostUpdate {\r\n  onPostUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface CanInitialize {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onInitialize(_engine: Engine): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\r\n}\r\n\r\nexport interface CanActivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onActivate(oldScene: Scene, newScene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanDeactivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onDeactivate(oldScene: Scene, newScene: Scene): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanUpdate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnPreDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n}\r\n\r\nexport interface OnPostDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPreDraw(a: any): a is OnPreDraw {\r\n  return !!a.onPreDraw;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPostDraw(a: any): a is OnPostDraw {\r\n  return !!a.onPostDraw;\r\n}\r\n\r\nexport interface CanBeKilled {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n}\r\n","import { Audio } from '../../Interfaces/Audio';\r\nimport * as Util from '../../Util/Util';\r\nimport { AudioContextFactory } from './AudioContext';\r\n\r\n/**\r\n * Internal class representing a Web Audio AudioBufferSourceNode instance\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\r\n */\r\nexport class WebAudioInstance implements Audio {\r\n  private _volume = 1;\r\n  private _duration: number | undefined = undefined;\r\n\r\n  private _playingPromise: Promise<boolean>;\r\n  private _playingResolve: (value: boolean) => void;\r\n\r\n  private _loop = false;\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    if (this._instance) {\r\n      this._instance.loop = value;\r\n      this._wireUpOnEnded();\r\n    }\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    value = Util.clamp(value, 0, 1.0);\r\n\r\n    this._volume = value;\r\n\r\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\r\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\r\n      // This exponential ramp provides a more pleasant transition in gain\r\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\r\n    } else {\r\n      this._volumeNode.gain.value = value;\r\n    }\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  public set duration(value: number | undefined) {\r\n    this._duration = value;\r\n  }\r\n\r\n  /**\r\n   * Duration of the sound, in seconds.\r\n   */\r\n  public get duration() {\r\n    return this._duration;\r\n  }\r\n\r\n  private get _playbackRate(): number {\r\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\r\n  }\r\n\r\n  private _isPlaying = false;\r\n  private _isPaused = false;\r\n  private _instance: AudioBufferSourceNode;\r\n  private _audioContext: AudioContext = AudioContextFactory.create();\r\n  private _volumeNode = this._audioContext.createGain();\r\n  private _startTime: number;\r\n\r\n  /**\r\n   * Current playback offset (in seconds)\r\n   */\r\n  private _currentOffset = 0;\r\n\r\n  constructor(private _src: AudioBuffer) {\r\n    this._createNewBufferSource();\r\n  }\r\n\r\n  public isPlaying() {\r\n    return this._isPlaying;\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  public play(playStarted: () => any = () => {}) {\r\n    if (this._isPaused) {\r\n      this._resumePlayBack();\r\n      playStarted();\r\n    }\r\n\r\n    if (!this._isPlaying) {\r\n      this._startPlayBack();\r\n      playStarted();\r\n    }\r\n\r\n    return this._playingPromise;\r\n  }\r\n\r\n  public pause() {\r\n    if (!this._isPlaying) {\r\n      return;\r\n    }\r\n\r\n    this._isPaused = true;\r\n    this._isPlaying = false;\r\n\r\n    this._instance.stop(0);\r\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\r\n    // default is 1.0\r\n    // we need to invert it to get the time scale\r\n\r\n    this._setPauseOffset();\r\n  }\r\n\r\n  public stop() {\r\n    if (!this._isPlaying) {\r\n      return;\r\n    }\r\n\r\n    this._isPlaying = false;\r\n    this._isPaused = false;\r\n\r\n    this._currentOffset = 0;\r\n    this._instance.stop(0);\r\n\r\n    // handler will not be wired up if we were looping\r\n    if (!this._instance.onended) {\r\n      this._handleOnEnded();\r\n    }\r\n  }\r\n\r\n  private _startPlayBack() {\r\n    this._isPlaying = true;\r\n    this._isPaused = false;\r\n    this._playingPromise = new Promise<boolean>((resolve) => {\r\n      this._playingResolve = resolve;\r\n    });\r\n\r\n    if (!this._instance) {\r\n      this._createNewBufferSource();\r\n    }\r\n\r\n    this._rememberStartTime();\r\n\r\n    this._volumeNode.connect(this._audioContext.destination);\r\n    this._instance.start(0, 0);\r\n    this._currentOffset = 0;\r\n\r\n    this._wireUpOnEnded();\r\n  }\r\n\r\n  private _resumePlayBack() {\r\n    if (!this._isPaused) {\r\n      return;\r\n    }\r\n\r\n    this._isPaused = false;\r\n    this._isPlaying = true;\r\n\r\n    // a buffer source can only be started once\r\n    // so we need to dispose of the previous instance before\r\n    // \"resuming\" the next one\r\n    this._instance.onended = null; // dispose of any previous event handler\r\n    this._createNewBufferSource();\r\n\r\n    const duration = this._playbackRate * this._src.duration;\r\n    const restartTime = this._currentOffset % duration;\r\n\r\n    this._rememberStartTime(restartTime * -1000);\r\n    this._instance.start(0, restartTime);\r\n    this._wireUpOnEnded();\r\n  }\r\n\r\n  private _wireUpOnEnded() {\r\n    if (!this.loop) {\r\n      this._instance.onended = () => this._handleOnEnded();\r\n    }\r\n  }\r\n\r\n  private _handleOnEnded() {\r\n    // pausing calls stop(0) which triggers onended event\r\n    // so we don't \"resolve\" yet (when we resume we'll try again)\r\n    if (!this._isPaused) {\r\n      this._isPlaying = false;\r\n      this._playingResolve(true);\r\n    }\r\n  }\r\n\r\n  private _rememberStartTime(amend?: number) {\r\n    this._startTime = new Date().getTime() + (amend | 0);\r\n  }\r\n\r\n  private _setPauseOffset() {\r\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\r\n  }\r\n\r\n  private _createNewBufferSource() {\r\n    this._instance = this._audioContext.createBufferSource();\r\n    this._instance.buffer = this._src;\r\n    this._instance.loop = this.loop;\r\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\r\n\r\n    this._instance.connect(this._volumeNode);\r\n  }\r\n}\r\n","import { Logger } from './Log';\r\n\r\n/**\r\n * Whether or not the browser can play this file as HTML5 Audio\r\n */\r\nexport function canPlayFile(file: string): boolean {\r\n  try {\r\n    const a = new Audio();\r\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\r\n    const type = file.match(filetype)[1];\r\n    if (a.canPlayType('audio/' + type)) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  } catch (e) {\r\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\r\n    return false;\r\n  }\r\n}\r\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { Engine } from '../../Engine';\r\nimport { Resource } from '../Resource';\r\nimport { WebAudioInstance } from './WebAudioInstance';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\r\nimport { canPlayFile } from '../../Util/Sound';\r\nimport { Loadable } from '../../Interfaces/Index';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Class } from '../../Class';\r\n\r\n/**\r\n * The [[Sound]] object allows games built in Excalibur to load audio\r\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\r\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\r\n */\r\nexport class Sound extends Class implements Audio, Loadable<AudioBuffer> {\r\n  public logger: Logger = Logger.getInstance();\r\n  public data: AudioBuffer;\r\n  private _resource: Resource<ArrayBuffer>;\r\n  /**\r\n   * Indicates whether the clip should loop when complete\r\n   * @param value  Set the looping flag\r\n   */\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.loop = this._loop;\r\n    }\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    this._volume = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.volume = this._volume;\r\n    }\r\n\r\n    this.emit('volumechange', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  public get duration(): number | undefined {\r\n    return this._duration;\r\n  }\r\n\r\n  /**\r\n   * Return array of Current AudioInstances playing or being paused\r\n   */\r\n  public get instances(): Audio[] {\r\n    return this._tracks;\r\n  }\r\n\r\n  public get path() {\r\n    return this._resource.path;\r\n  }\r\n\r\n  public set path(val: string) {\r\n    this._resource.path = val;\r\n  }\r\n\r\n  private _loop = false;\r\n  private _volume = 1;\r\n  private _duration: number | undefined = undefined;\r\n  private _isStopped = false;\r\n  private _isPaused = false;\r\n  private _tracks: Audio[] = [];\r\n  private _engine: Engine;\r\n  private _wasPlayingOnHidden: boolean = false;\r\n  private _audioContext = AudioContextFactory.create();\r\n\r\n  /**\r\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\r\n   */\r\n  constructor(...paths: string[]) {\r\n    super();\r\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\r\n    /**\r\n     * Chrome : MP3, WAV, Ogg\r\n     * Firefox : WAV, Ogg,\r\n     * IE : MP3, WAV coming soon\r\n     * Safari MP3, WAV, Ogg\r\n     */\r\n    for (const path of paths) {\r\n      if (canPlayFile(path)) {\r\n        this.path = path;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!this.path) {\r\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\r\n      this.logger.warn('Attempting to use', paths[0]);\r\n      this.path = paths[0]; // select the first specified\r\n    }\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  public async load(): Promise<AudioBuffer> {\r\n    if (this.data) {\r\n      return this.data;\r\n    }\r\n    const arraybuffer = await this._resource.load();\r\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\r\n    this._duration = typeof audiobuffer === 'object' ? audiobuffer.duration : undefined;\r\n    this.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\r\n    return this.data = audiobuffer;\r\n  }\r\n\r\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\r\n    try {\r\n      return await this._audioContext.decodeAudioData(data.slice(0));\r\n    } catch (e) {\r\n      this.logger.error(\r\n        'Unable to decode ' +\r\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\r\n          'if this is an mp3 try removing id3 tags and album art from the file.'\r\n      );\r\n      return await Promise.reject();\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    if (engine) {\r\n      this._engine = engine;\r\n\r\n      this._engine.on('hidden', () => {\r\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\r\n          this._wasPlayingOnHidden = true;\r\n          this.pause();\r\n        }\r\n      });\r\n\r\n      this._engine.on('visible', () => {\r\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\r\n          this.play();\r\n          this._wasPlayingOnHidden = false;\r\n        }\r\n      });\r\n\r\n      this._engine.on('start', () => {\r\n        this._isStopped = false;\r\n      });\r\n\r\n      this._engine.on('stop', () => {\r\n        this.stop();\r\n        this._isStopped = true;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns how many instances of the sound are currently playing\r\n   */\r\n  public instanceCount(): number {\r\n    return this._tracks.length;\r\n  }\r\n\r\n  /**\r\n   * Whether or not the sound is playing right now\r\n   */\r\n  public isPlaying(): boolean {\r\n    return this._tracks.some((t) => t.isPlaying());\r\n  }\r\n\r\n  /**\r\n   * Play the sound, returns a promise that resolves when the sound is done playing\r\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\r\n   */\r\n  public play(volume?: number): Promise<boolean> {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\r\n\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    if (this._isStopped) {\r\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\r\n      return Promise.resolve(false);\r\n    }\r\n\r\n    this.volume = volume || this.volume;\r\n\r\n    if (this._isPaused) {\r\n      return this._resumePlayback();\r\n    } else {\r\n      return this._startPlayback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop the sound, and do not rewind\r\n   */\r\n  public pause() {\r\n    if (!this.isPlaying()) {\r\n      return;\r\n    }\r\n\r\n    for (const track of this._tracks) {\r\n      track.pause();\r\n    }\r\n\r\n    this._isPaused = true;\r\n\r\n    this.emit('pause', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Paused all instances of sound', this.path);\r\n  }\r\n\r\n  /**\r\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\r\n   */\r\n  public stop() {\r\n    for (const track of this._tracks) {\r\n      track.stop();\r\n    }\r\n\r\n    this.emit('stop', new NativeSoundEvent(this));\r\n\r\n    this._isPaused = false;\r\n    this._tracks.length = 0;\r\n    this.logger.debug('Stopped all instances of sound', this.path);\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Get Id of provided AudioInstance in current trackList\r\n   * @param track [[Audio]] which Id is to be given\r\n   */\r\n  public getTrackId(track: Audio): number {\r\n    return this._tracks.indexOf(track);\r\n  }\r\n\r\n  private async _resumePlayback(): Promise<boolean> {\r\n    if (this._isPaused) {\r\n      const resumed: Promise<boolean>[] = [];\r\n      // ensure we resume *current* tracks (if paused)\r\n      for (const track of this._tracks) {\r\n        resumed.push(track.play());\r\n      }\r\n\r\n      this._isPaused = false;\r\n\r\n      this.emit('resume', new NativeSoundEvent(this));\r\n\r\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\r\n      // resolve when resumed tracks are done\r\n      await Promise.all(resumed);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Starts playback, returns a promise that resolves when playback is complete\r\n   */\r\n  private async _startPlayback(): Promise<boolean> {\r\n    const track = await this._getTrackInstance(this.data);\r\n\r\n    const complete = await track.play(() => {\r\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\r\n      this.logger.debug('Playing new instance for sound', this.path);\r\n    });\r\n\r\n    // when done, remove track\r\n    this.emit('playbackend', new NativeSoundEvent(this, track));\r\n    this._tracks.splice(this.getTrackId(track), 1);\r\n\r\n    return complete;\r\n  }\r\n\r\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\r\n    const newTrack = new WebAudioInstance(data);\r\n\r\n    newTrack.loop = this.loop;\r\n    newTrack.volume = this.volume;\r\n    newTrack.duration = this.duration;\r\n\r\n    this._tracks.push(newTrack);\r\n\r\n    return newTrack;\r\n  }\r\n}\r\n","import { Resource } from './Resource';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { Color } from '../Color';\r\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\r\nimport { Animation } from '../Graphics/Animation';\r\nimport { Engine } from '../Engine';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { ImageSource } from '../Graphics/ImageSource';\r\nimport { LegacyDrawing } from '..';\r\nimport { range } from '../Util/Util';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n */\r\nexport class Gif implements Loadable<ImageSource[]> {\r\n  private _resource: Resource<ArrayBuffer>;\r\n\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n\r\n  private _stream: Stream = null;\r\n  private _gif: ParseGif = null;\r\n  private _textures: ImageSource[] = [];\r\n  private _animation: Animation = null;\r\n  private _transparentColor: Color = null;\r\n\r\n  public data: ImageSource[];\r\n\r\n  /**\r\n   * @param path       Path to the image resource\r\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\r\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\r\n    this._transparentColor = color;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<ImageSource[]> {\r\n    const arraybuffer = await this._resource.load();\r\n    this._stream = new Stream(arraybuffer);\r\n    this._gif = new ParseGif(this._stream, this._transparentColor);\r\n    const images = this._gif.images.map(i => new ImageSource(i.src, false));\r\n\r\n    // Load all textures\r\n    await Promise.all(images.map(t => t.load()));\r\n    return this.data = this._textures = images;\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a legacy sprite by index\r\n   * @deprecated\r\n   */\r\n  public toLegacySprite(id: number = 0): LegacyDrawing.Sprite {\r\n    return Sprite.toLegacySprite(this.toSprite(id));\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a legacy spritesheet\r\n   * @deprecated\r\n   * @returns\r\n   */\r\n  public toLegacySpriteSheet(): LegacyDrawing.SpriteSheet {\r\n    return SpriteSheet.toLegacySpriteSheet(this.toSpriteSheet());\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a legacy animation\r\n   * @deprecated\r\n   * @param speed\r\n   */\r\n  public toLegacyAnimation(engine: Engine, speed: number): LegacyDrawing.Animation {\r\n    return Animation.toLegacyAnimation(engine, this.toAnimation(speed));\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a sprite by id\r\n   * @param id\r\n   */\r\n  public toSprite(id: number = 0): Sprite {\r\n    const sprite = this._textures[id].toSprite();\r\n    return sprite;\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a spritesheet\r\n   */\r\n  public toSpriteSheet(): SpriteSheet {\r\n    const sprites: Sprite[] = this._textures.map((image) => {\r\n      return image.toSprite();\r\n    });\r\n    return new SpriteSheet({ sprites });\r\n  }\r\n\r\n  /**\r\n   * Transform the GIF into an animation with duration per frame\r\n   */\r\n  public toAnimation(durationPerFrameMs: number): Animation {\r\n    const spriteSheet: SpriteSheet = this.toSpriteSheet();\r\n    const length = spriteSheet.sprites.length;\r\n    this._animation = Animation.fromSpriteSheet(spriteSheet, range(0, length), durationPerFrameMs);\r\n    return this._animation;\r\n  }\r\n\r\n  public get readCheckBytes(): number[] {\r\n    return this._gif.checkBytes;\r\n  }\r\n}\r\n\r\nexport interface GifFrame {\r\n  sentinel: number;\r\n  type: string;\r\n  leftPos: number;\r\n  topPos: number;\r\n  width: number;\r\n  height: number;\r\n  lctFlag: boolean;\r\n  interlaced: boolean;\r\n  sorted: boolean;\r\n  reserved: boolean[];\r\n  lctSize: number;\r\n  lzwMinCodeSize: number;\r\n  pixels: number[];\r\n}\r\n\r\nconst bitsToNum = (ba: any) => {\r\n  return ba.reduce(function (s: number, n: number) {\r\n    return s * 2 + n;\r\n  }, 0);\r\n};\r\n\r\nconst byteToBitArr = (bite: any) => {\r\n  const a = [];\r\n  for (let i = 7; i >= 0; i--) {\r\n    a.push(!!(bite & (1 << i)));\r\n  }\r\n  return a;\r\n};\r\n\r\nexport class Stream {\r\n  data: any = null;\r\n  len: number = 0;\r\n  position: number = 0;\r\n\r\n  constructor(dataArray: ArrayBuffer) {\r\n    this.data = new Uint8Array(dataArray);\r\n    this.len = this.data.byteLength;\r\n    if (this.len === 0) {\r\n      throw new Error('No data loaded from file');\r\n    }\r\n  }\r\n\r\n  public readByte = () => {\r\n    if (this.position >= this.data.byteLength) {\r\n      throw new Error('Attempted to read past end of stream.');\r\n    }\r\n    return this.data[this.position++];\r\n  };\r\n\r\n  public readBytes = (n: number) => {\r\n    const bytes = [];\r\n    for (let i = 0; i < n; i++) {\r\n      bytes.push(this.readByte());\r\n    }\r\n    return bytes;\r\n  };\r\n\r\n  public read = (n: number) => {\r\n    let s = '';\r\n    for (let i = 0; i < n; i++) {\r\n      s += String.fromCharCode(this.readByte());\r\n    }\r\n    return s;\r\n  };\r\n\r\n  public readUnsigned = () => {\r\n    // Little-endian.\r\n    const a = this.readBytes(2);\r\n    return (a[1] << 8) + a[0];\r\n  };\r\n}\r\n\r\nconst lzwDecode = function (minCodeSize: number, data: any) {\r\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\r\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\r\n\r\n  const readCode = function (size: number) {\r\n    let code = 0;\r\n    for (let i = 0; i < size; i++) {\r\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\r\n        code |= 1 << i;\r\n      }\r\n      pos++;\r\n    }\r\n    return code;\r\n  };\r\n\r\n  const output: any[] = [];\r\n\r\n  const clearCode = 1 << minCodeSize;\r\n  const eoiCode = clearCode + 1;\r\n\r\n  let codeSize = minCodeSize + 1;\r\n\r\n  let dict: any[] = [];\r\n\r\n  const clear = function () {\r\n    dict = [];\r\n    codeSize = minCodeSize + 1;\r\n    for (let i = 0; i < clearCode; i++) {\r\n      dict[i] = [i];\r\n    }\r\n    dict[clearCode] = [];\r\n    dict[eoiCode] = null;\r\n  };\r\n\r\n  let code;\r\n  let last;\r\n\r\n  while (true) {\r\n    last = code;\r\n    code = readCode(codeSize);\r\n    if (code === clearCode) {\r\n      clear();\r\n      continue;\r\n    }\r\n    if (code === eoiCode) {\r\n      break;\r\n    }\r\n\r\n    if (code < dict.length) {\r\n      if (last !== clearCode) {\r\n        dict.push(dict[last].concat(dict[code][0]));\r\n      }\r\n    } else {\r\n      if (code !== dict.length) {\r\n        throw new Error('Invalid LZW code.');\r\n      }\r\n      dict.push(dict[last].concat(dict[last][0]));\r\n    }\r\n    output.push.apply(output, dict[code]);\r\n\r\n    if (dict.length === 1 << codeSize && codeSize < 12) {\r\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\r\n      codeSize++;\r\n    }\r\n  }\r\n\r\n  // I don't know if this is technically an error, but some GIFs do it.\r\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\r\n  return output;\r\n};\r\n\r\n// The actual parsing; returns an object with properties.\r\nexport class ParseGif {\r\n  private _st: Stream = null;\r\n  private _handler: any = {};\r\n  private _transparentColor: Color = null;\r\n  public frames: GifFrame[] = [];\r\n  public images: HTMLImageElement[] = [];\r\n  public globalColorTable: any[] = [];\r\n  public checkBytes: number[] = [];\r\n\r\n  constructor(stream: Stream, color: Color = Color.Magenta) {\r\n    this._st = stream;\r\n    this._handler = {};\r\n    this._transparentColor = color;\r\n    this.parseHeader();\r\n    this.parseBlock();\r\n  }\r\n\r\n  // LZW (GIF-specific)\r\n  parseColorTable = (entries: any) => {\r\n    // Each entry is 3 bytes, for RGB.\r\n    const ct = [];\r\n    for (let i = 0; i < entries; i++) {\r\n      const rgb: number[] = this._st.readBytes(3);\r\n      const rgba =\r\n        '#' +\r\n        rgb\r\n          .map((x: any) => {\r\n            const hex = x.toString(16);\r\n            return hex.length === 1 ? '0' + hex : hex;\r\n          })\r\n          .join('');\r\n      ct.push(rgba);\r\n    }\r\n    return ct;\r\n  };\r\n\r\n  readSubBlocks = () => {\r\n    let size, data;\r\n    data = '';\r\n    do {\r\n      size = this._st.readByte();\r\n      data += this._st.read(size);\r\n    } while (size !== 0);\r\n    return data;\r\n  };\r\n\r\n  parseHeader = () => {\r\n    const hdr: any = {\r\n      sig: null,\r\n      ver: null,\r\n      width: null,\r\n      height: null,\r\n      colorRes: null,\r\n      globalColorTableSize: null,\r\n      gctFlag: null,\r\n      sorted: null,\r\n      globalColorTable: [],\r\n      bgColor: null,\r\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n    };\r\n\r\n    hdr.sig = this._st.read(3);\r\n    hdr.ver = this._st.read(3);\r\n    if (hdr.sig !== 'GIF') {\r\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\r\n    }\r\n\r\n    hdr.width = this._st.readUnsigned();\r\n    hdr.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    hdr.gctFlag = bits.shift();\r\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\r\n    hdr.sorted = bits.shift();\r\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    hdr.bgColor = this._st.readByte();\r\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n\r\n    if (hdr.gctFlag) {\r\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\r\n      this.globalColorTable = hdr.globalColorTable;\r\n    }\r\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\r\n      this.checkBytes.push(this._handler.hdr);\r\n    }\r\n  };\r\n\r\n  parseExt = (block: any) => {\r\n    const parseGCExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 4\r\n\r\n      const bits = byteToBitArr(this._st.readByte());\r\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\r\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\r\n      block.userInput = bits.shift();\r\n      block.transparencyGiven = bits.shift();\r\n\r\n      block.delayTime = this._st.readUnsigned();\r\n\r\n      block.transparencyIndex = this._st.readByte();\r\n\r\n      block.terminator = this._st.readByte();\r\n\r\n      if (this._handler.gce && this._handler.gce(block)) {\r\n        this.checkBytes.push(this._handler.gce);\r\n      }\r\n    };\r\n\r\n    const parseComExt = (block: any) => {\r\n      block.comment = this.readSubBlocks();\r\n      if (this._handler.com && this._handler.com(block)) {\r\n        this.checkBytes.push(this._handler.com);\r\n      }\r\n    };\r\n\r\n    const parsePTExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 12\r\n      block.ptHeader = this._st.readBytes(12);\r\n      block.ptData = this.readSubBlocks();\r\n      if (this._handler.pte && this._handler.pte(block)) {\r\n        this.checkBytes.push(this._handler.pte);\r\n      }\r\n    };\r\n\r\n    const parseAppExt = (block: any) => {\r\n      const parseNetscapeExt = (block: any) => {\r\n        this.checkBytes.push(this._st.readByte()); // Always 3\r\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\r\n        block.iterations = this._st.readUnsigned();\r\n        block.terminator = this._st.readByte();\r\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\r\n          this.checkBytes.push(this._handler.app);\r\n        }\r\n      };\r\n\r\n      const parseUnknownAppExt = (block: any) => {\r\n        block.appData = this.readSubBlocks();\r\n        // FIXME: This won't work if a handler wants to match on any identifier.\r\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\r\n          this.checkBytes.push(this._handler.app[block.identifier]);\r\n        }\r\n      };\r\n\r\n      this.checkBytes.push(this._st.readByte()); // Always 11\r\n      block.identifier = this._st.read(8);\r\n      block.authCode = this._st.read(3);\r\n      switch (block.identifier) {\r\n        case 'NETSCAPE':\r\n          parseNetscapeExt(block);\r\n          break;\r\n        default:\r\n          parseUnknownAppExt(block);\r\n          break;\r\n      }\r\n    };\r\n\r\n    const parseUnknownExt = (block: any) => {\r\n      block.data = this.readSubBlocks();\r\n      if (this._handler.unknown && this._handler.unknown(block)) {\r\n        this.checkBytes.push(this._handler.unknown);\r\n      }\r\n    };\r\n\r\n    block.label = this._st.readByte();\r\n    switch (block.label) {\r\n      case 0xf9:\r\n        block.extType = 'gce';\r\n        parseGCExt(block);\r\n        break;\r\n      case 0xfe:\r\n        block.extType = 'com';\r\n        parseComExt(block);\r\n        break;\r\n      case 0x01:\r\n        block.extType = 'pte';\r\n        parsePTExt(block);\r\n        break;\r\n      case 0xff:\r\n        block.extType = 'app';\r\n        parseAppExt(block);\r\n        break;\r\n      default:\r\n        block.extType = 'unknown';\r\n        parseUnknownExt(block);\r\n        break;\r\n    }\r\n  };\r\n\r\n  parseImg = (img: any) => {\r\n    const deinterlace = (pixels: any, width: any) => {\r\n      // Of course this defeats the purpose of interlacing. And it's *probably*\r\n      // the least efficient way it's ever been implemented. But nevertheless...\r\n\r\n      const newPixels = new Array(pixels.length);\r\n      const rows = pixels.length / width;\r\n      const cpRow = (toRow: any, fromRow: any) => {\r\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\r\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\r\n      };\r\n\r\n      const offsets = [0, 4, 2, 1];\r\n      const steps = [8, 8, 4, 2];\r\n\r\n      let fromRow = 0;\r\n      for (let pass = 0; pass < 4; pass++) {\r\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\r\n          cpRow(toRow, fromRow);\r\n          fromRow++;\r\n        }\r\n      }\r\n\r\n      return newPixels;\r\n    };\r\n\r\n    img.leftPos = this._st.readUnsigned();\r\n    img.topPos = this._st.readUnsigned();\r\n    img.width = this._st.readUnsigned();\r\n    img.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    img.lctFlag = bits.shift();\r\n    img.interlaced = bits.shift();\r\n    img.sorted = bits.shift();\r\n    img.reserved = bits.splice(0, 2);\r\n    img.lctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    if (img.lctFlag) {\r\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\r\n    }\r\n\r\n    img.lzwMinCodeSize = this._st.readByte();\r\n\r\n    const lzwData = this.readSubBlocks();\r\n\r\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\r\n\r\n    if (img.interlaced) {\r\n      // Move\r\n      img.pixels = deinterlace(img.pixels, img.width);\r\n    }\r\n\r\n    this.frames.push(img);\r\n    this.arrayToImage(img);\r\n    if (this._handler.img && this._handler.img(img)) {\r\n      this.checkBytes.push(this._handler);\r\n    }\r\n  };\r\n\r\n  public parseBlock = () => {\r\n    const block = {\r\n      sentinel: this._st.readByte(),\r\n      type: ''\r\n    };\r\n    const blockChar = String.fromCharCode(block.sentinel);\r\n    switch (blockChar) {\r\n      case '!':\r\n        block.type = 'ext';\r\n        this.parseExt(block);\r\n        break;\r\n      case ',':\r\n        block.type = 'img';\r\n        this.parseImg(block);\r\n        break;\r\n      case ';':\r\n        block.type = 'eof';\r\n        if (this._handler.eof && this._handler.eof(block)) {\r\n          this.checkBytes.push(this._handler.eof);\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\r\n    }\r\n\r\n    if (block.type !== 'eof') {\r\n      this.parseBlock();\r\n    }\r\n  };\r\n\r\n  arrayToImage = (frame: GifFrame) => {\r\n    let count = 0;\r\n    const c = document.createElement('canvas');\r\n    c.id = count.toString();\r\n    c.width = frame.width;\r\n    c.height = frame.height;\r\n    count++;\r\n    const context = c.getContext('2d');\r\n    const pixSize = 1;\r\n    let y = 0;\r\n    let x = 0;\r\n    for (let i = 0; i < frame.pixels.length; i++) {\r\n      if (x % frame.width === 0) {\r\n        y++;\r\n        x = 0;\r\n      }\r\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\r\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\r\n      } else {\r\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\r\n      }\r\n\r\n      context.fillRect(x, y, pixSize, pixSize);\r\n      x++;\r\n    }\r\n    const img = new Image();\r\n    img.src = c.toDataURL();\r\n    this.images.push(img);\r\n  };\r\n}\r\n","import { Vector, vec } from '../Math/vector';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface PolygonOptions {\n  points: Vector[];\n}\n\n/**\n * A polygon [[Graphic]] for drawing arbitrary polygons to the [[ExcaliburGraphicsContext]]\n */\nexport class Polygon extends Raster {\n  private _points: Vector[];\n  public get points(): Vector[] {\n    return this._points;\n  }\n  public set points(points: Vector[]) {\n    this._points = points;\n    const min = this.minPoint;\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\n    this.flagDirty();\n  }\n\n  public get minPoint() {\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\n    return vec(minX, minY);\n  }\n\n  constructor(options: RasterOptions & PolygonOptions) {\n    super(options);\n    this.points = options.points;\n    this.rasterize();\n  }\n\n  public clone(): Polygon {\n    return new Polygon({\n      points: this.points.map((p) => p.clone()),\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.points && this.points.length) {\n      ctx.beginPath();\n      // Iterate through the supplied points and construct a 'polygon'\n      const min = this.minPoint.negate();\n      const firstPoint = this.points[0].add(min);\n      ctx.moveTo(firstPoint.x, firstPoint.y);\n      this.points.forEach((point) => {\n        ctx.lineTo(point.x + min.x, point.y + min.y);\n      });\n      ctx.lineTo(firstPoint.x, firstPoint.y);\n      ctx.closePath();\n      if (this.color) {\n        ctx.fill();\n      }\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { obsolete } from './Decorators';\r\n\r\n/**\r\n * A sorted list implementation. NOTE: this implementation is not self-balancing\r\n * @deprecated WIll be removed in v0.26.0 Use built in JS array.sort\r\n */\r\n@obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use built in JS array.sort'})\r\nexport class SortedList<T> {\r\n  private _getComparable: (item: T) => number;\r\n  private _root: BinaryTreeNode<T>;\r\n\r\n  constructor(getComparable: (item: T) => number) {\r\n    this._getComparable = getComparable;\r\n  }\r\n\r\n  public find(element: T): boolean {\r\n    return this._find(this._root, element);\r\n  }\r\n\r\n  private _find(node: BinaryTreeNode<T>, element: any): boolean {\r\n    if (node == null) {\r\n      return false;\r\n    } else if (this._getComparable(element) === node.getKey()) {\r\n      if (node.getData().indexOf(element) > -1) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    } else if (this._getComparable(element) < node.getKey()) {\r\n      return this._find(node.getLeft(), element);\r\n    } else {\r\n      return this._find(node.getRight(), element);\r\n    }\r\n  }\r\n\r\n  // returns the array of elements at a specific key value\r\n  public get(key: number): any[] {\r\n    return this._get(this._root, key);\r\n  }\r\n\r\n  private _get(node: BinaryTreeNode<T>, key: number): any[] {\r\n    if (node == null) {\r\n      return [];\r\n    } else if (key === node.getKey()) {\r\n      return node.getData();\r\n    } else if (key < node.getKey()) {\r\n      return this._get(node.getLeft(), key);\r\n    } else {\r\n      return this._get(node.getRight(), key);\r\n    }\r\n  }\r\n\r\n  public add(element: T): boolean {\r\n    if (this._root == null) {\r\n      this._root = new BinaryTreeNode(this._getComparable(element), [element], null, null);\r\n      return true;\r\n    } else {\r\n      return this._insert(this._root, element);\r\n    }\r\n  }\r\n\r\n  private _insert(node: BinaryTreeNode<T>, element: T): boolean {\r\n    if (node != null) {\r\n      if (this._getComparable(element) === node.getKey()) {\r\n        if (node.getData().indexOf(element) > -1) {\r\n          return false; // the element we're trying to insert already exists\r\n        } else {\r\n          node.getData().push(element);\r\n          return true;\r\n        }\r\n      } else if (this._getComparable(element) < node.getKey()) {\r\n        if (node.getLeft() == null) {\r\n          node.setLeft(new BinaryTreeNode(this._getComparable(element), [element], null, null));\r\n          return true;\r\n        } else {\r\n          return this._insert(node.getLeft(), element);\r\n        }\r\n      } else {\r\n        if (node.getRight() == null) {\r\n          node.setRight(new BinaryTreeNode(this._getComparable(element), [element], null, null));\r\n          return true;\r\n        } else {\r\n          return this._insert(node.getRight(), element);\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public removeByComparable(element: T): void {\r\n    this._root = this._remove(this._root, element);\r\n  }\r\n\r\n  private _remove(node: BinaryTreeNode<T>, element: T): BinaryTreeNode<T> {\r\n    if (node == null) {\r\n      return null;\r\n    } else if (this._getComparable(element) === node.getKey()) {\r\n      const elementIndex = node.getData().indexOf(element);\r\n      // if the node contains the element, remove the element\r\n      if (elementIndex > -1) {\r\n        node.getData().splice(elementIndex, 1);\r\n        // if we have removed the last element at this node, remove the node\r\n        if (node.getData().length === 0) {\r\n          // if the node is a leaf\r\n          if (node.getLeft() == null && node.getRight() == null) {\r\n            return null;\r\n          } else if (node.getLeft() == null) {\r\n            return node.getRight();\r\n          } else if (node.getRight() == null) {\r\n            return node.getLeft();\r\n          }\r\n          // if node has 2 children\r\n          const temp = this._findMinNode(node.getRight());\r\n          node.setKey(temp.getKey());\r\n          node.setData(temp.getData());\r\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\r\n          return node;\r\n        } else {\r\n          // this prevents the node from being removed since it still contains elements\r\n          return node;\r\n        }\r\n      }\r\n    } else if (this._getComparable(element) < node.getKey()) {\r\n      node.setLeft(this._remove(node.getLeft(), element));\r\n      return node;\r\n    } else {\r\n      node.setRight(this._remove(node.getRight(), element));\r\n      return node;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\r\n  private _cleanup(node: BinaryTreeNode<T>, element: BinaryTreeNode<T>): BinaryTreeNode<T> {\r\n    const comparable = element.getKey();\r\n    if (node == null) {\r\n      return null;\r\n    } else if (comparable === node.getKey()) {\r\n      // if the node is a leaf\r\n      if (node.getLeft() == null && node.getRight() == null) {\r\n        return null;\r\n      } else if (node.getLeft() == null) {\r\n        return node.getRight();\r\n      } else if (node.getRight() == null) {\r\n        return node.getLeft();\r\n      }\r\n      // if node has 2 children\r\n      const temp = this._findMinNode(node.getRight());\r\n      node.setKey(temp.getKey());\r\n      node.setData(temp.getData());\r\n\r\n      node.setRight(this._cleanup(node.getRight(), temp));\r\n      return node;\r\n    } else if (element.getKey() < node.getKey()) {\r\n      node.setLeft(this._cleanup(node.getLeft(), element));\r\n      return node;\r\n    } else {\r\n      node.setRight(this._cleanup(node.getRight(), element));\r\n      return node;\r\n    }\r\n  }\r\n\r\n  private _findMinNode(node: BinaryTreeNode<T>): BinaryTreeNode<T> {\r\n    let current = node;\r\n    while (current.getLeft() != null) {\r\n      current = current.getLeft();\r\n    }\r\n    return current;\r\n  }\r\n\r\n  public list(): Array<T> {\r\n    const results = new Array<T>();\r\n    this._list(this._root, results);\r\n    return results;\r\n  }\r\n\r\n  private _list(treeNode: BinaryTreeNode<T>, results: Array<T>): void {\r\n    if (treeNode != null) {\r\n      this._list(treeNode.getLeft(), results);\r\n      treeNode.getData().forEach((element) => {\r\n        results.push(element);\r\n      });\r\n      this._list(treeNode.getRight(), results);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * A tree node part of [[SortedList]]\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\r\nexport class BinaryTreeNode<T> {\r\n  private _key: number;\r\n  private _data: Array<T>;\r\n  private _left: BinaryTreeNode<T>;\r\n  private _right: BinaryTreeNode<T>;\r\n\r\n  constructor(key: number, data: Array<T>, left: BinaryTreeNode<T>, right: BinaryTreeNode<T>) {\r\n    this._key = key;\r\n    this._data = data;\r\n    this._left = left;\r\n    this._right = right;\r\n  }\r\n\r\n  public getKey(): number {\r\n    return this._key;\r\n  }\r\n\r\n  public setKey(key: number) {\r\n    this._key = key;\r\n  }\r\n\r\n  public getData(): T[] {\r\n    return this._data;\r\n  }\r\n\r\n  public setData(data: T[]) {\r\n    this._data = data;\r\n  }\r\n\r\n  public getLeft(): BinaryTreeNode<T> {\r\n    return this._left;\r\n  }\r\n\r\n  public setLeft(left: BinaryTreeNode<T>) {\r\n    this._left = left;\r\n  }\r\n\r\n  public getRight(): BinaryTreeNode<T> {\r\n    return this._right;\r\n  }\r\n\r\n  public setRight(right: BinaryTreeNode<T>) {\r\n    this._right = right;\r\n  }\r\n}\r\n\r\n/**\r\n * Mock element for testing\r\n *\r\n * @internal\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport class MockedElement {\r\n  private _key: number = 0;\r\n\r\n  constructor(key: number) {\r\n    this._key = key;\r\n  }\r\n\r\n  public getTheKey() {\r\n    return this._key;\r\n  }\r\n\r\n  public setKey(key: number) {\r\n    this._key = key;\r\n  }\r\n}\r\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\r\n\r\nimport { obsolete } from './Util/Decorators';\r\n\r\n/**\r\n * Valid states for a promise to be in\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport enum PromiseState {\r\n  Resolved,\r\n  Rejected,\r\n  Pending\r\n}\r\n\r\n/**\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport interface PromiseLike<T> {\r\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\r\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\r\n\r\n  //Cannot define static methods on interfaces\r\n  //wrap<T>(value?: T): IPromise<T>;\r\n\r\n  resolve(value?: T): PromiseLike<T>;\r\n  reject(value?: any): PromiseLike<T>;\r\n\r\n  state(): PromiseState;\r\n}\r\n\r\n/**\r\n * Promises are used to do asynchronous work and they are useful for\r\n * creating a chain of actions. In Excalibur they are used for loading,\r\n * sounds, animation, actions, and more.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'ex.Promises are being replaced by native browser promises in v0.26.0',\r\n  alternateMethod: 'Use browser native promises'\r\n})\r\nexport class Promise<T> implements PromiseLike<T> {\r\n  private _state: PromiseState = PromiseState.Pending;\r\n  private _value: T;\r\n  private _successCallbacks: { (value?: T): any }[] = [];\r\n  private _rejectCallback: (value?: any) => any = () => {\r\n    return;\r\n  };\r\n  private _errorCallback: (value?: any) => any;\r\n\r\n  /**\r\n   * Create and resolve a Promise with an optional value\r\n   * @param value  An optional value to wrap in a resolved promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static resolve<T>(value?: T): Promise<T> {\r\n    const promise = new Promise<T>().resolve(value);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Create and reject a Promise with an optional value\r\n   * @param value  An optional value to wrap in a rejected promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static reject<T>(value?: T): Promise<T> {\r\n    const promise = new Promise<T>().reject(value);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\r\n   * when at least 1 promise rejects.\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\r\n\r\n  /**\r\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\r\n   * when at least 1 promise rejects.\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\r\n\r\n  public static join<T>() {\r\n    let promises: Promise<T>[] = [];\r\n\r\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\r\n      for (let _i = 0; _i < arguments.length; _i++) {\r\n        promises[_i - 0] = arguments[_i];\r\n      }\r\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\r\n      promises = arguments[0];\r\n    }\r\n\r\n    const joinedPromise = new Promise<T>();\r\n    if (!promises || !promises.length) {\r\n      return joinedPromise.resolve();\r\n    }\r\n\r\n    const total = promises.length;\r\n    let successes = 0;\r\n    let rejects = 0;\r\n    const errors: any = [];\r\n\r\n    promises.forEach((p) => {\r\n      p.then(\r\n        () => {\r\n          successes += 1;\r\n          if (successes === total) {\r\n            joinedPromise.resolve();\r\n          } else if (successes + rejects + errors.length === total) {\r\n            joinedPromise.reject(errors);\r\n          }\r\n        },\r\n        () => {\r\n          rejects += 1;\r\n          if (successes + rejects + errors.length === total) {\r\n            joinedPromise.reject(errors);\r\n          }\r\n        }\r\n      ).error((e) => {\r\n        errors.push(e);\r\n        if (errors.length + successes + rejects === total) {\r\n          joinedPromise.reject(errors);\r\n        }\r\n      });\r\n    });\r\n\r\n    return joinedPromise;\r\n  }\r\n\r\n  /**\r\n   * Chain success and reject callbacks after the promise is resolved\r\n   * @param successCallback  Call on resolution of promise\r\n   * @param rejectCallback   Call on rejection of promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\r\n    if (successCallback) {\r\n      this._successCallbacks.push(successCallback);\r\n\r\n      // If the promise is already resolved call immediately\r\n      if (this.state() === PromiseState.Resolved) {\r\n        try {\r\n          successCallback.call(this, this._value);\r\n        } catch (e) {\r\n          this._handleError(e);\r\n        }\r\n      }\r\n    }\r\n    if (rejectCallback) {\r\n      this._rejectCallback = rejectCallback;\r\n\r\n      // If the promise is already rejected call immediately\r\n      if (this.state() === PromiseState.Rejected) {\r\n        try {\r\n          rejectCallback.call(this, this._value);\r\n        } catch (e) {\r\n          this._handleError(e);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Add an error callback to the promise\r\n   * @param errorCallback  Call if there was an error in a callback\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public error(errorCallback?: (value?: any) => any) {\r\n    if (errorCallback) {\r\n      this._errorCallback = errorCallback;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Resolve the promise and pass an option value to the success callbacks\r\n   * @param value  Value to pass to the success callbacks\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public resolve(value?: T): Promise<T> {\r\n    if (this._state === PromiseState.Pending) {\r\n      this._value = value;\r\n      try {\r\n        this._state = PromiseState.Resolved;\r\n        this._successCallbacks.forEach((cb) => {\r\n          cb.call(this, this._value);\r\n        });\r\n      } catch (e) {\r\n        this._handleError(e);\r\n      }\r\n    } else {\r\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Reject the promise and pass an option value to the reject callbacks\r\n   * @param value  Value to pass to the reject callbacks\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public reject(value?: any) {\r\n    if (this._state === PromiseState.Pending) {\r\n      this._value = value;\r\n      try {\r\n        this._state = PromiseState.Rejected;\r\n        this._rejectCallback.call(this, this._value);\r\n      } catch (e) {\r\n        this._handleError(e);\r\n      }\r\n    } else {\r\n      throw new Error('Cannot reject a promise that is not in a pending state!');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Inspect the current state of a promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public state(): PromiseState {\r\n    return this._state;\r\n  }\r\n\r\n  private _handleError(e: any) {\r\n    if (this._errorCallback) {\r\n      this._errorCallback.call(this, e);\r\n    } else {\r\n      // rethrow error\r\n      throw e;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * The current Excalibur version string\r\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\r\n */\r\nexport const EX_VERSION = process.env.__EX_VERSION;\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\n\r\n// This file is used as the bundle entry point and exports everything\r\n// that will be exposed as the `ex` global variable.\r\nexport * from './Flags';\r\nexport * from './Id';\r\nexport * from './Engine';\r\nexport * from './Screen';\r\nexport { Actor, ActorArgs } from './Actor';\r\nexport * from './Math/Index';\r\nexport * from './Camera';\r\nexport * from './Class';\r\nexport * from './Configurable';\r\nexport * from './Debug/index';\r\nexport * from './EventDispatcher';\r\nexport * from './Events/MediaEvents';\r\nexport * from './Events';\r\nexport * from './Label';\r\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\r\nexport * from './Loader';\r\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\r\nexport * from './Collision/Physics';\r\nexport * from './Scene';\r\nexport { TileMap, Cell, TileMapArgs, CellArgs } from './TileMap';\r\nexport * from './Timer';\r\nexport * from './Trigger';\r\nexport * from './ScreenElement';\r\n\r\nexport * from './Actions/Index';\r\nexport * from './Collision/Index';\r\n\r\n// ex.LegacyDrawing namespace\r\nimport * as legacyDrawing from './Drawing/Index';\r\nexport { legacyDrawing as LegacyDrawing };\r\nexport * from './Interfaces/Index';\r\nexport * from './PostProcessing/Index';\r\nexport * from './Resources/Index';\r\n\r\nexport * from './EntityComponentSystem/index';\r\n\r\nexport * from './Color';\r\n\r\nexport * from './Graphics/index';\r\n\r\n// ex.Events namespace\r\nimport * as events from './Events';\r\nexport { events as Events };\r\n\r\n// ex.Input namespace\r\nimport * as input from './Input/Index';\r\nexport { input as Input };\r\n\r\n// ex.Traits namespace\r\nimport * as traits from './Traits/Index';\r\nexport { traits as Traits };\r\n\r\n// ex.Util namespaces\r\nimport * as util from './Util/Index';\r\nexport { util as Util };\r\nexport {\r\n  clamp,\r\n  range,\r\n  toDegrees,\r\n  toRadians,\r\n  randomInRange,\r\n  randomIntInRange,\r\n  canonicalizeAngle\r\n} from './Util/Index';\r\n\r\nexport * from './Util/Browser';\r\nexport * from './Util/Decorators';\r\nexport * from './Util/Detector';\r\nexport * from './Util/CullingBox';\r\nexport * from './Util/EasingFunctions';\r\nexport * from './Util/Observable';\r\nexport * from './Util/Log';\r\nexport * from './Util/SortedList';\r\nexport * from './Util/Pool';\r\n\r\n// ex.Deprecated\r\nexport * from './Promises';\r\n// import * as deprecated from './Deprecated';\r\n// export { deprecated as Deprecated };\r\n// export * from './Deprecated';\r\n"],"names":["root","factory","exports","module","define","amd","self","entryUnbind","path","Object","keys","isCallable","tryToString","argument","TypeError","isObject","String","toIndexedObject","toLength","toAbsoluteIndex","createMethod","IS_INCLUDES","$this","el","fromIndex","value","O","length","index","includes","indexOf","fails","METHOD_NAME","method","call","floor","Math","mergeSort","array","comparefn","middle","insertionSort","merge","slice","element","j","i","left","right","llength","rlength","lindex","rindex","result","push","toString","it","TO_STRING_TAG_SUPPORT","classofRaw","TO_STRING_TAG","wellKnownSymbol","CORRECT_ARGUMENTS","arguments","tag","undefined","key","error","tryGet","callee","has","ownKeys","getOwnPropertyDescriptorModule","definePropertyModule","target","source","defineProperty","f","getOwnPropertyDescriptor","DESCRIPTORS","createPropertyDescriptor","object","bitmap","enumerable","configurable","writable","get","global","document","EXISTS","createElement","firefox","match","UA","test","getBuiltIn","version","userAgent","process","Deno","versions","v8","split","webkit","bind","Function","CONSTRUCTOR","METHOD","prototype","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","sham","exec","aCallable","fn","that","a","b","c","apply","FunctionPrototype","getDescriptor","PROPER","name","CONFIGURABLE","aFunction","namespace","V","P","func","check","globalThis","window","g","this","toObject","hasOwnProperty","hasOwn","classof","propertyIsEnumerable","store","functionToString","inspectSource","set","NATIVE_WEAK_MAP","objectHas","shared","sharedKey","hiddenKeys","OBJECT_ALREADY_INITIALIZED","WeakMap","state","wmget","wmhas","wmset","metadata","facade","STATE","enforce","getterFor","TYPE","type","replacement","feature","detection","data","normalize","POLYFILL","NATIVE","string","replace","toLowerCase","USE_SYMBOL_AS_UID","$Symbol","V8_VERSION","getOwnPropertySymbols","symbol","Symbol","IE8_DOM_DEFINE","anObject","toPropertyKey","$defineProperty","Attributes","propertyIsEnumerableModule","$getOwnPropertyDescriptor","internalObjectKeys","concat","getOwnPropertyNames","names","enumBugKeys","$propertyIsEnumerable","NASHORN_BUG","input","pref","val","valueOf","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","InternalStateModule","CONFIGURABLE_FUNCTION_NAME","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","join","uid","SHARED","IS_PURE","mode","copyright","toInteger","max","min","integer","IndexedObject","requireObjectCoercible","ceil","isNaN","isSymbol","getMethod","ordinaryToPrimitive","TO_PRIMITIVE","exoticToPrim","toPrimitive","id","postfix","random","NATIVE_SYMBOL","iterator","WellKnownSymbolsStore","createWellKnownSymbol","withoutSetter","$","internalSort","arrayMethodIsStrict","FF","IE_OR_EDGE","V8","WEBKIT","nativeSort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","STRICT_METHOD","STABLE_SORT","code","chr","fromCharCode","k","v","charAt","proto","itemsLength","items","arrayLength","x","y","getSortCompare","nativeKeys","___CSS_LOADER_EXPORT___","cssWithMappingToString","list","map","item","content","needLayer","modules","media","dedupe","supports","layer","alreadyImportedModules","_i","_i2","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","sourceMapping","sourceURLs","sources","sourceRoot","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","definition","o","e","obj","prop","r","toStringTag","Experiments","Legacy","LogLevel","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Flags","static","_FROZEN","_FLAGS","enable","WebGL","Canvas","LegacyDrawing","flagName","Error","createId","Logger","constructor","_appenders","defaultLevel","Info","_INSTANCE","addAppender","ConsoleAppender","appender","clearAppenders","_log","level","args","len","log","debug","Debug","info","warn","Warn","fatal","Fatal","console","consoleArgs","unshift","ScreenAppender","width","height","_messages","_canvas","innerWidth","innerHeight","style","position","_ctx","getContext","body","appendChild","message","clearRect","pos","opacity","fillStyle","toFixed","fillText","BITMASK32","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Array","Date","now","s","_index","_twist","mag01","nextInt","next","floating","bool","likelihood","pickOne","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","splice","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","Side","getOpposite","side","Top","Bottom","Left","Right","None","fromDirection","direction","directions","Vector","Up","Down","directionEnum","Number","MAX_VALUE","maxIndex","dot","TwoPI","PI","extend","extended","deep","assignExists","assign","base64Encode","inputStr","b64","outputStr","byte1","charCodeAt","byte2","byte3","enc1","enc2","enc3","enc4","nullish","nullishVal","defaultVal","clamp","randomInRange","randomIntInRange","round","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","getPosition","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","addItemToArray","removeItemFromArray","contains","getOppositeSide","getSideFromDirection","Collection","initialSize","DefaultSize","_internalArray","_endPointer","_resize","newSize","newArray","count","pop","clear","internalSize","elementAt","insert","remove","removed","removeElement","toArray","forEach","fail","from","to","_x","delay","milliseconds","setTimeout","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","isEnabled","getInstance","trace","showStackTrace","obsolete","alternateMethod","showStackTrack","property","SyntaxError","DecoratedClass","super","_y","Zero","One","Half","cos","sin","vec","Infinity","vec1","vec2","sqrt","pow","setTo","equals","vector","tolerance","abs","distance","squareDistance","magnitude","size","newLength","scale","average","add","sizeOrScale","sub","addEqual","subEqual","scaleEqual","cross","num","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","fixed","MatrixLocations","Color","parseInt","parseFloat","hex","h","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","mulitiply","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","Black","fromHex","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Vermillion","Rose","Magenta","Violet","Blue","Azure","Cyan","Viridian","Green","Chartreuse","Transparent","ExcaliburBlue","p","q","t","hue2rgb","BoundingBox","leftOrOptions","top","bottom","intersection","points","minX","minY","maxX","maxY","hasZeroDimensions","center","translate","point","getPoints","fromPoints","shifted","transform","matrix","multv","getPerimeter","results","rayCast","ray","farClipDistance","tmin","tmax","xinv","dir","yinv","tx1","tx2","ty1","ty2","rayCastTime","combine","other","dimensions","intersect","totalBoundingBox","overlapX","overlapY","intersectWithSide","bb","getSideFromIntersection","debugDraw","ctx","strokeStyle","strokeRect","draw","ex","drawRect","sign","Matrix","Float32Array","_scaleSignX","_scaleSignY","near","far","mat","identity","sx","sy","angleRadians","multm","dest","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","TransformStack","_transforms","_currentTransform","save","restore","current","StateStack","_states","_currentState","_getDefaultState","_cloneState","Shader","_gl","_vertexSource","_fragmentSource","program","uniforms","attributes","layout","compile","_createProgram","gl","vertexShader","fragmentShader","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","_compileShader","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","VERTEX_SHADER","FRAGMENT_SHADER","addUniformMatrix","location","getUniformLocation","addUniformIntegerArray","addAttribute","glType","normalized","getAttribLocation","vertexAttributeSize","vertexSize","vert","totalVertexSizeBytes","typeSize","FLOAT","getAttributeSize","use","useProgram","offset","vertexAttribPointer","enableVertexAttribArray","uniform","uniformMatrix4fv","uniform1iv","BatchCommand","_pool","commands","isFull","canAdd","cmd","dispose","GraphicsDiagnostics","DrawCallCount","DrawnImagesCount","Pool","builder","recycler","maxObjects","totalAllocations","objects","_logger","using","context","done","borrow","poolIndex","BatchRenderer","priority","_buffer","_maxCommandsPerBatch","_batches","command","_verticesPerCommand","verticesPerCommand","maxCommandsPerBatch","batchFactory","_batchPool","init","buildShader","_vertices","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","addCommand","lastBatch","newBatch","render","drawCallCount","drawnImagesCount","batch","vertexCount","buildBatchVertices","bufferSubData","renderBatch","DrawLine","start","end","LineRenderer","_contextInfo","addLine","vertexBuffer","_batch","drawArrays","LINES","DrawCommandType","DrawImageCommand","image","swidth","sheight","dx","dy","dwidth","dheight","snapToPixel","Image","view","_geom","initRect","Rectangle","initLine","thickness","Line","halfThick","startTop","startBottom","endTop","endBottom","initCircle","radius","Circle","topLeft","topRight","bottomRight","bottomLeft","applyTransform","geometry","isPowerOfTwo","ensurePowerOfTwo","nextHighestPowerOfTwo","TextureLoader","_GL","_TEXTURE_MAP","forceUpdate","tex","bindTexture","TEXTURE_2D","toPowerOfTwoImage","texImage2D","RGBA","UNSIGNED_BYTE","createTexture","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","potCanvas","_POT_CANVAS","potCtx","_POT_CTX","imageSmoothingEnabled","drawImage","Map","BatchImage","maxDraws","maxTextures","textures","_graphicMap","_isCommandFull","_isTextureFull","_wouldAddTexture","maybeAdd","texture","load","bindTextures","activeTexture","TEXTURE0","getBatchTextureId","ImageRenderer","getParameter","MAX_TEXTURE_IMAGE_UNITS","registerContext","maxGPUTextures","_transformFragmentSource","_","newSource","texturePickerBuilder","addCircle","addRectangle","addImage","graphic","TRIANGLES","vertIndex","sw","sh","potWidth","potHeight","textureId","commandColor","uvx0","uvy0","uvx1","uvy1","DrawPoint","PointRenderer","getExtension","addPoint","POINTS","Graphic","_ID","showDebug","flipHorizontal","flipVertical","rotation","origin","_width","_height","cloneGraphicOptions","localBounds","fromDimension","_preDraw","_drawImage","_postDraw","_rotate","_flip","scaleDirX","scaleDirY","watch","change","__isProxy","Proxy","watchAny","Raster","_dirty","_smoothing","_color","flagDirty","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","bitmapHeight","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperites","execute","setLineDash","getLineDash","_options","cache","EventTypes","GameEvent","_bubbles","bubbles","stopPropagation","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","delta","PostDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","engine","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","SubscribeEvent","topic","handler","UnsubscribeEvent","VisibleEvent","HiddenEvent","PreCollisionEvent","actor","PostCollisionEvent","ContactStartEvent","contact","ContactEndEvent","CollisionPreSolveEvent","CollisionPostSolveEvent","CollisionStartEvent","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","ExitTriggerEvent","EventDispatcher","_handlers","_wiredEventDispatchers","_target","emit","eventName","event","on","off","eventHandlers","once","ev","wire","eventDispatcher","unwire","Resource","responseType","bustCache","logger","events","isLoaded","_cacheBust","uri","request","XMLHttpRequest","open","addEventListener","status","response","statusText","send","Grayscale","updatePixel","imageData","firstPixel","pixel","avg","Invert","Opacity","Colorize","Lighten","fromRGB","Darken","Saturate","Desaturate","Fill","Texture","_sprite","loaded","_loadedResolve","_resource","url","blob","URL","createObjectURL","src","decode","naturalWidth","naturalHeight","asSprite","Configurable","base","props","filter","SpriteImpl","imageOrConfig","drawAroundAnchor","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","_initPixelsFromTexture","drawWidth","drawHeight","_loadPixels","_flushTexture","grayscale","addEffect","fill","colorize","effect","_applyEffects","removeEffect","param","indexToRemove","getImageData","putImageData","clearEffects","reset","xpoint","ypoint","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","anchorX","anchorY","oldAlpha","globalAlpha","Sprite","sourceView","destSize","_updateSpriteDimensions","ready","then","nativeWidth","nativeHeight","sprite","ImageSource","fromLegacyTexture","endsWith","toSprite","unload","AnimationImpl","engineOrConfig","sprites","speed","loop","currentFrame","_timeLeftInFrame","_idempotencyToken","freezeFrame","Engine","config","_engine","_setAnchor","_setRotation","_setScale","isDone","tick","elapsed","idempotencyToken","_updateValues","skip","frames","animOptions","currSprite","play","playAnimation","images","FontUnit","TextAlign","BaseAlign","FontStyle","Direction","imageOrConfigOrSprites","columns","rows","spWidth","spHeight","spacing","_sprites","_image","_columns","_rows","_spWidth","_spHeight","_spacing","loadFromImage","isWidthError","isHeightError","RangeError","getSpacingDimensions","row","col","margin","getAnimationByIndices","indices","getAnimationBetween","beginIndex","endIndex","getAnimationForAll","getSprite","getAnimationByCoords","spriteCoordinates","maxWidth","maxHeight","coord","anim","SpriteFont","alphabet","caseInsensitive","_currentColor","_currentOpacity","_spriteRecord","_textShadowOn","_textShadowDirty","_textShadowColor","_textShadowSprites","_shadowOffsetX","_shadowOffsetY","getTextSprites","lookup","char","setTextShadow","offsetX","offsetY","shadowColor","character","useTextShadow","text","_parseOptions","characterShadow","fontSize","letterSpacing","currX","textAlign","Start","End","Center","currY","baseAlign","Hanging","Ideographic","Alphabetic","Middle","charSprite","SpriteSheet","spriteIndex","legacySpriteSheet","oldSprite","fromLegacySprite","spriteSheet","toLegacySprite","grid","cols","spriteWidth","spriteHeight","originOffset","offsetDefaults","marginDefaults","_text","shadow","_updateDimensions","spriteFont","_getCharacterSprites","textToRender","toLocaleLowerCase","letterIndex","letter","letterSprite","updateText","cursor","DebugText","fontSheet","_imageSource","_spriteSheet","fromImageSource","_spriteFont","write","ExcaliburGraphicsContextWebGLDebug","_webglCtx","_debugText","rectOptions","drawLine","lineOptions","__lineRenderer","drawPoint","pointOptions","__pointRenderer","drawText","ExcaliburGraphicsContextWebGL","_transform","_state","backgroundColor","canvasElement","enableTransparency","__gl","antialias","premultipliedAlpha","alpha","depth","powerPreference","_init","canvas","checkIfResolutionSupported","dim","maxDim","MAX_TEXTURE_SIZE","supported","_ortho","ortho","viewport","clearColor","COLOR_BUFFER_BIT","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","__imageRenderer","__ctx","resetTransform","updateViewport","drawRectangle","drawCircle","flush","DisplayMode","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","Screen","_antialiasing","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullScreen","_isDisposed","_fullscreenChangeHandler","_pixelRatioChangeHandler","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","_resizeHandler","_setResolutionAndViewportByDisplayMode","_alreadyWarned","resolution","_displayMode","displayMode","Fixed","antialiasing","_browser","browser","_position","pixelRatio","_applyDisplayMode","_mediaQueryList","nativeComponent","matchMedia","_resizeObserver","disconnect","removeEventListener","isHiDpi","FillContainer","FitContainer","parentElement","_resolution","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","peekViewport","peekResolution","popResolutionAndViewport","imageRendering","isSmooth","isFullScreen","goFullScreen","requestFullscreen","exitFullScreen","exitFullscreen","pageToScreenCoordinates","newX","newY","screenHeight","screenWidth","screenToPageCoordinates","screenMarginY","screenMarginX","screenToWorldCoordinates","halfDrawWidth","halfDrawHeight","worldToScreenCoordinates","screenX","screenY","pageToWorldCoordinates","worldToPageCoordinates","getWorldBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","zoom","_computeFit","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitContainer","clientWidth","clientHeight","Position","_initializeDisplayModePosition","Window","ResizeObserver","observe","FillScreen","FitScreen","display","specifiedPosition","marginTop","marginLeft","AudioContextFactory","WebAudio","_UNLOCKED","create","unlockTimeoutTimer","resume","buffer","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","clearTimeout","Class","eventObject","line","x1","y1","x2","y2","cap","beginPath","lineCap","moveTo","lineTo","closePath","stroke","arc","roundRect","br","tl","tr","bl","defaultRadius","quadraticCurveTo","circle","Loader","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","_playButtonStyles","playButtonText","startButtonFactory","buttonElement","getElementById","textContent","addResources","_imageElement","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","head","wireEngine","addResource","loadable","showPlayButton","hidePlayButton","resizeHandler","_positionPlayButton","evt","click","promise","startButtonHandler","removeChild","update","_delta","all","finally","unlock","markResourceComplete","progress","buttonWidth","buttonHeight","playButtonPosition","fillRect","logoY","logoX","logoPosition","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","arraybuffer","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","CollisionType","CollisionResolutionStrategy","BroadphaseStrategy","Integrator","Physics","gravity","acc","collisionResolutionStrategy","Arcade","Realistic","dynamicTreeVelocityMultiplyer","dynamicTreeVelocityMultiplier","enabled","broadphaseStrategy","DynamicAABBTree","defaultMass","integrator","Euler","boundsPadding","positionIterations","velocityIterations","slop","steeringFactor","warmStart","bodiesCanSleepByDefault","surfaceEpsilon","sleepEpsilon","wakeThreshold","sleepBias","checkForFastBodies","disableMinimumSpeedForFastBody","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","Component","owner","newComponent","TagComponent","CoordPlane","TransformComponent","X","Y","createPosView","_rotation","_scale","createScaleView","coordPlane","World","z","_recalculate","getGlobalMatrix","getGlobalTransform","globalPos","globalScale","globalRotation","parentTransform","globalScaleX","globalScaleY","applyInverse","MotionComponent","vel","scaleFactor","angularVelocity","torque","inertia","CollisionGroup","category","mask","_name","_category","_mask","canCollide","collisionGroups","combinedName","combinedCategory","reduce","All","Observable","observers","subscriptions","register","observer","subscribe","unregister","unsubscribe","notifyAll","notify","cb","Pair","colliderA","colliderB","calculatePairHash","bodyA","BodyComponent","bodyB","group","collisionType","PreventCollision","active","collide","hasCollider","collider","idA","idB","Projection","overlaps","projection","getOverlap","TreeNode","bounds","isLeaf","DynamicTree","worldBounds","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","_remove","grandParent","sibling","trackCollider","node","updateCollider","untrackCollider","multdx","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","Ray","numerator","begin","getSlope","divisor","u","getLength","intersectPoint","time","getPoint","DynamicTreeCollisionProcessor","_dynamicCollisionTree","_collisions","Set","_collisionPairCache","_colliders","getColliders","track","CompositeCollider","colliders","untrack","_shouldGenerateCollisionPair","hash","broadphase","targets","seconds","potentialColliders","pair","physics","pairs","Active","updateDistance","minDimension","fastBodies","updateVec","oldPos","centerPoint","furthestPoint","getFurthestPoint","minCollider","minTranslate","hitPoint","isValid","shift","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","Collider","touching","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","axes","furthestPoints","bestPoint","maxDistance","getInertia","mass","totalInertia","otherColliders","potentialCollider","getClosestLineBetween","lines","maybeLine","minLength","minLine","minPoint","minDistance","project","projs","proj","newProjection","slope","intercept","getEdge","midpoint","flip","below","clip","sideVector","clipTime","distanceToPoint","signed","x0","y0","findVectorToPoint","aMinusP","findPoint","hasPoint","currPoint","threshold","dxc","dyc","dx1","dy1","ClosestLine","p0","q0","w0","denom","sDenom","tDenom","tClosestParallel","sClosest","tClosest","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","otherWorldPos","otherDirection","thisDirection","rayTowardsOther","rayTowardsThis","thisPoint","otherPoint","thisFace","getClosestFace","otherFace","face","PolygonEdgeClosestLine","polygon","edge","edgeLine","asLine","PolygonCircleClosestLine","circlex","circley","CircleCircleClosestLine","circleA","circleB","CircleEdgeClosestLine","circleWorlPos","EdgeEdgeClosestLine","edgeA","edgeB","edgeLineA","edgeLineB","CircleCollider","orig","discriminant","toi","toi1","toi2","positiveToi","mintoi","shape","PolygonCollider","EdgeCollider","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","bodyPos","scalars","dotProduct","newPos","CollisionContact","mtv","tangent","localPoints","_canceled","matchAwake","sleeping","sleepMotion","setSleeping","isCanceled","cancel","SeparatingAxis","polyA","polyB","bestSeparation","bestSide","bestAxis","bestSideIndex","bestOtherPoint","sides","getSides","localSides","getLocalSides","vertB","vertSeparation","separation","localSide","sideId","localPoint","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","circleAPos","circleBPos","combinedRadius","mvt","local","findCirclePolygonSeparation","samedir","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","findPolygonPolygonSeparation","separationB","incident","reference","refDir","clipRight","clipLeft","xf","FindContactSeparation","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","_getBodyPos","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","_transformedPoints","_axes","_sides","_localSides","winding","clockwiseWinding","reverse","_calculateTransformation","getTransformedPoints","currentSide","mostDirection","testRay","accum","pts","POSITIVE_INFINITY","faceIndex","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","scalar","effectiveOffset","firstPoint","Shape","Box","ColliderComponent","$colliderAdded","$colliderRemoved","_collider","flipped","onAdd","entity","precollision","postcollision","onRemove","useBoxCollider","usePolygonCollider","poly","Polygon","useCircleCollider","useEdgeCollider","Edge","useCompositeCollider","DegreeOfFreedom","dependencies","canSleep","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","oldVel","oldAcc","oldRotation","oldScale","inverseMass","updateMotion","currentMotion","bias","inverseInertia","motion","xFactor","yFactor","rx","applyImpulse","impulse","finalImpulse","Rotation","distanceFromCenter","applyLinearImpulse","applyAngularImpulse","captureOldTransform","CullingBox","_topLeft","_topRight","_bottomLeft","_bottomRight","isSpriteOffScreen","drawingWidth","currentDrawing","drawingHeight","getGlobalPos","topLeftScreen","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","rect","OffscreenCulling","cullingBox","actorBoundsOffscreen","currentScene","isOffScreen","removeComponent","addComponent","CapturePointer","enableCapturePointer","isKilled","pointers","checkAndUpdateActorUnderPointer","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","Entity","components","_componentsToRemove","_componentTypeToInstance","_componentStringToInstance","_tagsMemo","_typesMemo","componentAdded$","componentRemoved$","_parent","childrenAdded$","childrenRemoved$","_children","_isInitialized","_setName","component","kill","tags","hasTag","addTag","removeTag","force","types","_rebuildMemos","values","getComponents","_notifyAddComponent","added","_notifyRemoveComponent","children","unparent","addChild","getAncestors","removeAllChildren","getDescendants","queue","curr","newEntity","child","addTemplate","templateEntity","ctor","constuctorType","componentOrType","_removeComponentByType","delete","processComponentRemoval","isInitialized","_initialize","onInitialize","_preupdate","onPreUpdate","_postupdate","onPostUpdate","CanvasDrawComponent","hasGraphicsTick","GraphicsLayer","_graphics","graphics","hide","nameOrGraphic","gfx","getGraphic","show","copyGraphics","getNames","order","currentKeys","GraphicsLayers","_component","_layers","_layerMap","default","_maybeAddLayer","_getLayer","graphicsLayerKeys","GraphicsComponent","visible","_bounds","onPreDraw","onPostDraw","layers","graphicToSet","_radius","RotationType","EasingFunctions","easing","duration","CreateReversibleEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","ActionQueue","_actions","_completedActions","_entity","action","clearActions","_currentAction","stop","getActions","hasNext","isComplete","elapsedMs","Repeat","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","RepeatForever","MoveBy","_started","_tx","_motion","_speed","_offset","_start","_end","_distance","_dir","MoveTo","destx","desty","RotateTo","rotationType","_rotationType","ShortestPath","_currentNonCannonAngle","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","distanceTravelled","RotateBy","angleRadiansOffset","ScaleTo","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","ScaleBy","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","CallMethod","_method","_hasBeenCalled","EaseTo","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","_duration","Fade","endOpacity","_multiplier","_endOpacity","Delay","_delay","Die","ActionsComponent","Follow","entityToFollow","followDistance","_followTx","_followMotion","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","Meet","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","actorToMeetSpeed","_queue","easeTo","xOrPos","yOrSpeed","speedOrUndefined","moveBy","xOffsetOrVector","yOffsetOrSpeed","xOffset","yOffset","rotateTo","rotateBy","scaleTo","sizeXOrVector","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","scaleBy","sizeOffsetXOrVector","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","blink","fade","die","callMethod","times","repeatForever","follow","meet","asPromise","toPromise","Actor","_anchor","_handleAnchorChange","scene","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pe","pointer","lastWorldPos","_pointerDragLeaveHandler","traits","capturePointer","captureMoveEvents","captureDragEvents","_capturePointerEvents","_captureMoveEvents","_captureDragEvents","collisionGroup","defaults","Passive","actions","thePos","theVel","theAcc","theAngle","isVisible","draggable","isDraggable","_checkForPointerOptIn","_prekill","_scene","onPreKill","_postkill","onPostKill","unkill","setDrawing","addDrawing","getZIndex","newZ","setZIndex","newIndex","getGlobalScale","getGlobalRotation","recurse","geom","containment","some","within","otherCollider","me","drawing","currFrame","trait","_predraw","_postdraw","useWorld","coords","Timer","fcn","interval","repeats","numberOfRepeats","_totalTimeAlive","_running","_numberOfTicks","maxNumberOfRepeats","_complete","_MAX_ID","_callbacks","complete","newInterval","newNumberOfRepeats","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","pause","unpause","cancelTimer","Axis","TileMapImpl","xOrConfig","cellWidth","cellHeight","_token","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","_legacySpriteMap","_cols","isOffscreen","_composite","currentCol","cd","Cell","registerSpriteSheet","_updateColliders","tile","solid","prev","getCellByIndex","getCell","getCellByPoint","cell","getRows","getColumns","worldCoordsUpperLeft","worldCoordsLowerRight","xEnd","yEnd","graphicsIndex","graphicsLen","TileMap","CellImpl","_solid","pushSprite","addGraphic","removeGraphic","clearGraphics","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","limitCameraBounds","box","LimitCameraBoundsStrategy","_cam","_eng","cam","currentFocus","getFocus","focus","cameraVel","stretch","boundSizeChecked","focusX","focusY","Camera","_cameraStrategies","strategy","_z","dz","az","_posChanged","_pos","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_halfWidth","_halfHeight","_follow","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","cameraStrategy","removeStrategy","clearAllStrategies","currentRes","loadingComplete","res","newZoom","zoomEasing","lerpPoint","CreateVectorEasingFunction","moveEasing","_isDoneShaking","newCanvasWidth","newCanvasHeight","isScreenElement","triggerDefaults","opts","_dispatchAction","wp","SystemType","System","_entityAddedOrRemoved","AddedEntity","isAddedSystemEntity","RemovedEntity","isRemoveSystemEntity","EntityManager","_world","entities","_entityIndex","_entitiesToRemove","updateEntities","_context","removeEntity","findEntitiesForRemoval","queryManager","addEntity","idOrEntity","deferred","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","buildTypeKey","localeCompare","Query","_entities","T","_key","getEntities","matches","typesOrEntity","contain","QueryManager","_queries","_addQuery","entityManager","maybeRemoveQuery","queryType","createQuery","maybeExistingQuery","getQuery","SystemManager","systems","initialized","systemType","find","addSystem","system","initialize","removeSystem","updateSystems","preupdate","Scene","postupdate","systemManager","Update","entityOrSystem","clearEntities","clearSystems","EulerIntegrator","totalAcc","MotionSystem","optionalBody","integrate","CollisionSolver","solve","preSolve","solveVelocity","solvePosition","postSolve","ArcadeSolver","opposite","velAdj","ContactConstraintPoint","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","aToContactNormal","bToContactNormal","aToContactTangent","bToContactTangent","getRelativeVelocity","velA","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contactPoints","pointIndex","constraints","maxCorrection","steeringForce","restitution","impulseDelta","maxFriction","newImpulse","CollisionSystem","_realisticSolver","_arcadeSolver","_processor","_lastFrameContacts","_currentFrameContacts","_trackCollider","_untrackCollider","colliderComponent","colliderComp","getSolver","runContactStartEnd","AnimationDirection","AnimationStrategy","EmitterType","Animation","Loop","frameDuration","timeScale","_firstTick","_currentFrame","_done","_playing","_reversed","totalDuration","goToFrame","frameIndices","durationPerFrameMs","invalidIndices","_LOGGER","animation","legacySprites","Freeze","currentFrameIndex","isPlaying","Backward","Forward","canFinish","frameNumber","maybeFrame","_nextFrame","PingPong","elapsedMilliseconds","GraphicsGroup","members","_isAnimationOrGroup","member","maybeAnimation","ParticleImpl","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","ParticleEmitter","tmpColor","removeParticle","accel","Particle","_particlesToEmit","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","_og","emitterType","randomRotation","particle","emitParticles","particleCount","_createParticle","world","clearParticles","ranX","ranY","GraphicsSystem","Draw","_graphicsContext","graphicsContext","_clearScreen","entityOffscreen","_isOffscreen","_pushCameraTransform","_applyTransform","particleOpacity","_drawGraphicsComponent","_popCameraTransform","drawnImages","drawCalls","graphicsComponent","isDebug","showBounds","boundsColor","ancestors","ancestor","CanvasDrawingSystem","canvasdraw","offscreen","DebugSystem","_collisionSystem","filterSettings","entitySettings","txSettings","motionSettings","colliderSettings","physicsSettings","graphicsSettings","bodySettings","cameraSettings","useFilter","ids","nameQuery","lineHeight","showAll","showPosition","positionColor","showId","showName","showRotation","fromAngle","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","geometryColor","showOwner","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","collisionContactColor","collisionNormalColor","showFocus","focusColor","showZoom","ActionsSystem","ColorBlindness","Keys","PointerType","PointerScope","NativePointerButton","PointerButton","WheelDeltaMode","_timers","_cancelQueue","triggers","tileMaps","screenElements","onActivate","_oldScene","_newScene","onDeactivate","_initializeChildren","_activate","_deactivate","removeTimer","timer","_collectActorStats","dispatchPointerEvents","addTimer","addScreenElement","removeScreenElement","addTileMap","tileMap","removeTileMap","isTimerActive","isCurrentScene","_ui","ui","alive","ColorBlindCorrector","simulate","colorMode","Protanope","_vertexShader","_fragmentShader","_internalCanvas","preserveDrawingBuffer","_program","_getShader","_getFragmentShaderByMode","vertextShader","Deuteranope","Tritanope","_setRectangle","STATIC_DRAW","out","positionLocation","texCoordLocation","texCoordBuffer","pixelStorei","UNPACK_FLIP_Y_WEBGL","resolutionLocation","uniform2f","positionBuffer","pixelData","Uint8Array","readPixels","ColorBlindFlags","correct","colorBlindness","postProcessors","FrameStats","prevFrame","colorBlindMode","_id","_fps","_actorStats","remaining","total","_durationStats","_physicsStats","PhysicsStats","_graphicsStats","otherStats","fps","fs","_pairs","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","ps","KeyEvent","originalEvent","Keyboard","_keys","_keysUp","_keysDown","noop","keyEvent","getKeys","wasPressed","isHeld","wasReleased","Pointer","_isDown","_wasDown","_actorsUnderPointer","_actors","_actorsLastFrame","_actorsNoLongerUnderPointer","_actorSortingFcn","lastPagePos","lastScreenPos","dragTarget","_onPointerMove","_onPointerDown","_onPointerUp","isDragging","isDragStart","isDragEnd","hasActorsUnderPointer","addActorUnderPointer","isActorAliveUnderPointer","removeActorUnderPointer","getActorsUnderPointer","getActorsUnderPointerLastFrame","getActorsForEvents","checkActorUnderPointer","wasActorUnderPointer","pagePos","screenPos","_ev","PointerEvent","coordinates","pointerType","propagate","doAction","_onActionStart","_onActionEnd","_actor","PointerEventFactory","_pointerEventType","PointerDragEvent","PointerUpEvent","PointerDownEvent","PointerMoveEvent","PointerEnterEvent","PointerLeaveEvent","PointerCancelEvent","WheelEvent","pageX","pageY","deltaX","deltaY","deltaZ","deltaMode","_isCanceled","createPointerEventByName","GlobalCoordinates","yOrEngine","engineOrUndefined","ScrollWheelNormalizationFactor","Pointers","_pointerDown","_pointerUp","_pointerMove","_pointerCancel","_wheel","_pointers","_activePointers","primary","_handleTouchEvent","touchAction","_handlePointerEvent","MSPointerEvent","msTouchAction","_handleMouseEvent","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode","_handleWheelEvent","onmousewheel","triggerEvent","pointerId","eventish","preventDefault","at","_dispatchWithBubble","_dispatchPointerLeaveEvents","lastMoveEventPerPointerPerActor","pointerLeave","_dispatchPointerEnterEvents","lastMoveEventPerPointer","pointerEnter","_propagateWheelPointerEvent","wheelEvent","eventArr","fromPagePosition","Mouse","_nativeButtonToPointerButton","changedTouches","_getPointerIndex","identifier","Touch","Unknown","_stringToPointerType","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Pixel","Page","we","idx","NoButton","Pen","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_clonePads","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","timestamp","bi","ai","navigatorGamepad","Buttons","getButton","pressed","updateButton","Axes","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_buttons","isButtonPressed","buttonIndex","axesIndex","BrowserComponent","_paused","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","ExcaliburGraphicsContext2DCanvasDebug","_ex","ExcaliburGraphicsContext2DCanvas","_hasStarted","scenes","_animations","_suppressPlayButton","pauseAudioWhenHidden","_isDebug","debugColor","enableCanvasTransparency","onFatalException","_timescale","_isLoading","_deferredGoTo","_loadingComplete","_DEFAULT_ENGINE_OPTIONS","freeze","detector","suppressMinimumBrowserFeatureDetection","_compatible","innerText","testMessage","canvasElementId","suppressConsoleBootMessage","EX_VERSION","ex2dCtx","exWebglCtx","suppressHiDPIScaling","_loader","rootScene","addScene","isFullscreen","timescale","AnimationNode","removeScene","goToScene","hidden","visibilityChange","scrollPreventionMode","keyboard","pointerScope","_overrideInitialize","_update","_draw","font","toggle","toggleDebug","loader","createMainLoop","game","raf","nowFn","lastTime","mainloop","_requestId","frameId","beforeUpdate","afterUpdate","afterDraw","isPaused","screenshot","raw","MediaEvent","_value","_path","_val","layPath","NativeSoundEvent","NativeSoundProcessedEvent","_processedData","Font","quality","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textWidth","_textHeight","blur","fontString","numLines","_lines","_rasterWidth","_rasterHeight","_halfRasterWidth","_halfRasterHeight","_applyFont","maxWidthLine","metrics","measureText","actualBoundingBoxLeft","actualBoundingBoxRight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","textBaseline","shadowBlur","shadowOffsetX","shadowOffsetY","strokeText","Text","_font","isBold","fontFamily","sizeInUnit","fontStyle","fontUnit","align","_legacySpriteFont","sf","getTextWidth","clearTextShadow","exctx","CollisionGroupManager","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","_CURRENT_BIT","groups","_STARTING_BIT","filled","_points","fillColor","lineColor","ExResponse","has_initialize","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasPreDraw","hasPostDraw","any","json","WebAudioInstance","_src","_volume","_loop","_isPlaying","_isPaused","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","_instance","_wireUpOnEnded","volume","gain","setTargetAtTime","_playbackRate","playbackRate","playStarted","_resumePlayBack","_startPlayBack","_playingPromise","_setPauseOffset","_handleOnEnded","_playingResolve","_rememberStartTime","restartTime","amend","_startTime","getTime","setValueAtTime","canPlayFile","file","Audio","filetype","canPlayType","Sound","paths","_isStopped","_tracks","_wasPlayingOnHidden","instances","audiobuffer","decodeAudio","instanceCount","_resumePlayback","_startPlayback","getTrackId","resumed","_getTrackInstance","newTrack","Gif","_stream","_gif","_textures","_animation","_transparentColor","Stream","ParseGif","toLegacySpriteSheet","toSpriteSheet","toLegacyAnimation","toAnimation","fromSpriteSheet","readCheckBytes","checkBytes","bitsToNum","ba","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","readUnsigned","stream","_st","_handler","globalColorTable","parseColorTable","entries","ct","readSubBlocks","parseHeader","hdr","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","bits","parseExt","block","parseGCExt","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","authCode","parseUnknownExt","label","extType","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","output","clearCode","eoiCode","codeSize","dict","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","offsets","steps","pass","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","SortedList","getComparable","_getComparable","_find","_root","getKey","getData","getLeft","getRight","_get","BinaryTreeNode","setLeft","setRight","removeByComparable","elementIndex","_findMinNode","setKey","setData","_cleanup","comparable","_list","treeNode","_data","_left","_right","MockedElement","getTheKey","PromiseState","Pending","_successCallbacks","_rejectCallback","promises","isArray","joinedPromise","successes","rejects","errors","successCallback","rejectCallback","Resolved","_handleError","Rejected","errorCallback","_errorCallback"],"sourceRoot":""}
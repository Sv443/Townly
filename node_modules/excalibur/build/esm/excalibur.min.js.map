{"version":3,"file":"excalibur.min.js","mappings":"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j5F,EAGlB2wD,iBACT,OAAOjpD,KAAKwxF,YAGHvoC,eAAW3wD,GACpB0H,KAAKwxF,YAAcl5F,EAGViyD,kBACT,OAAOvqD,KAAKyxF,aAGHlnC,gBAAYjyD,GACrB0H,KAAKyxF,aAAen5F,IL3hBxB,SAAY8zF,GAEV,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,qBACA,+BACA,+BACA,2BAEA,6BACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,wBACA,kCACA,kCACA,8BAEA,gCAGA,oBACA,wBACA,0BACA,oBACA,sBAGA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,gBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBAGA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cAGA,wBACA,gBACA,gBACA,gBACA,kBACA,gBACA,gBACA,4BACA,wBACA,8BACA,wBAGA,eACA,mBACA,mBACA,qBACA,oBACA,wBACA,wBACA,0BAGA,gBACA,eACA,kBAhJF,CAAYA,KAAAA,GAAI,KAsJT,MAAMuF,WAAiB,GAM5B9kF,YAAmB/R,EAAkBxC,EAAuBs5F,GAC1Dx4E,QADiB,KAAAte,IAAAA,EAAkB,KAAAxC,MAAAA,EAAuB,KAAAs5F,cAAAA,GAQvD,MAAMC,WAAiBn7C,GAK5B7pC,cACEuM,QALM,KAAA04E,MAAgB,GAChB,KAAAC,QAAkB,GAClB,KAAAC,UAAoB,GAUrBp1D,GAAGF,EAAmB5B,GAC3B1hB,MAAMwjB,GAAGF,EAAW5B,GAMtB7N,KAAK9wB,GACH,IAAKA,EAC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","sources":["webpack:///../../node_modules/core-js/es/array/sort.js","webpack:///../../node_modules/core-js/es/object/keys.js","webpack:///../../node_modules/core-js/internals/a-callable.js","webpack:///../../node_modules/core-js/internals/an-object.js","webpack:///../../node_modules/core-js/internals/array-includes.js","webpack:///../../node_modules/core-js/internals/array-method-is-strict.js","webpack:///../../node_modules/core-js/internals/array-sort.js","webpack:///../../node_modules/core-js/internals/classof-raw.js","webpack:///../../node_modules/core-js/internals/classof.js","webpack:///../../node_modules/core-js/internals/copy-constructor-properties.js","webpack:///../../node_modules/core-js/internals/create-non-enumerable-property.js","webpack:///../../node_modules/core-js/internals/create-property-descriptor.js","webpack:///../../node_modules/core-js/internals/descriptors.js","webpack:///../../node_modules/core-js/internals/document-create-element.js","webpack:///../../node_modules/core-js/internals/engine-ff-version.js","webpack:///../../node_modules/core-js/internals/engine-is-ie-or-edge.js","webpack:///../../node_modules/core-js/internals/engine-user-agent.js","webpack:///../../node_modules/core-js/internals/engine-v8-version.js","webpack:///../../node_modules/core-js/internals/engine-webkit-version.js","webpack:///../../node_modules/core-js/internals/entry-unbind.js","webpack:///../../node_modules/core-js/internals/enum-bug-keys.js","webpack:///../../node_modules/core-js/internals/export.js","webpack:///../../node_modules/core-js/internals/fails.js","webpack:///../../node_modules/core-js/internals/function-bind-context.js","webpack:///../../node_modules/core-js/internals/function-name.js","webpack:///../../node_modules/core-js/internals/get-built-in.js","webpack:///../../node_modules/core-js/internals/get-method.js","webpack:///../../node_modules/core-js/internals/global.js","webpack:///../../node_modules/core-js/internals/has.js","webpack:///../../node_modules/core-js/internals/hidden-keys.js","webpack:///../../node_modules/core-js/internals/ie8-dom-define.js","webpack:///../../node_modules/core-js/internals/indexed-object.js","webpack:///../../node_modules/core-js/internals/inspect-source.js","webpack:///../../node_modules/core-js/internals/internal-state.js","webpack:///../../node_modules/core-js/internals/is-callable.js","webpack:///../../node_modules/core-js/internals/is-forced.js","webpack:///../../node_modules/core-js/internals/is-object.js","webpack:///../../node_modules/core-js/internals/is-pure.js","webpack:///../../node_modules/core-js/internals/is-symbol.js","webpack:///../../node_modules/core-js/internals/native-symbol.js","webpack:///../../node_modules/core-js/internals/native-weak-map.js","webpack:///../../node_modules/core-js/internals/object-define-property.js","webpack:///../../node_modules/core-js/internals/object-get-own-property-descriptor.js","webpack:///../../node_modules/core-js/internals/object-get-own-property-names.js","webpack:///../../node_modules/core-js/internals/object-get-own-property-symbols.js","webpack:///../../node_modules/core-js/internals/object-keys-internal.js","webpack:///../../node_modules/core-js/internals/object-keys.js","webpack:///../../node_modules/core-js/internals/object-property-is-enumerable.js","webpack:///../../node_modules/core-js/internals/ordinary-to-primitive.js","webpack:///../../node_modules/core-js/internals/own-keys.js","webpack:///../../node_modules/core-js/internals/path.js","webpack:///../../node_modules/core-js/internals/redefine.js","webpack:///../../node_modules/core-js/internals/require-object-coercible.js","webpack:///../../node_modules/core-js/internals/set-global.js","webpack:///../../node_modules/core-js/internals/shared-key.js","webpack:///../../node_modules/core-js/internals/shared-store.js","webpack:///../../node_modules/core-js/internals/shared.js","webpack:///../../node_modules/core-js/internals/to-absolute-index.js","webpack:///../../node_modules/core-js/internals/to-indexed-object.js","webpack:///../../node_modules/core-js/internals/to-integer.js","webpack:///../../node_modules/core-js/internals/to-length.js","webpack:///../../node_modules/core-js/internals/to-object.js","webpack:///../../node_modules/core-js/internals/to-primitive.js","webpack:///../../node_modules/core-js/internals/to-property-key.js","webpack:///../../node_modules/core-js/internals/to-string-tag-support.js","webpack:///../../node_modules/core-js/internals/to-string.js","webpack:///../../node_modules/core-js/internals/try-to-string.js","webpack:///../../node_modules/core-js/internals/uid.js","webpack:///../../node_modules/core-js/internals/use-symbol-as-uid.js","webpack:///../../node_modules/core-js/internals/well-known-symbol.js","webpack:///../../node_modules/core-js/modules/es.array.sort.js","webpack:///../../node_modules/core-js/modules/es.object.keys.js","webpack:///./Loader.css","webpack:///../../node_modules/css-loader/dist/runtime/api.js","webpack:///../../node_modules/css-loader/dist/runtime/sourceMaps.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./Flags.ts","webpack:///./Util/Log.ts","webpack:///./Polyfill.ts","webpack:///./Id.ts","webpack:///./Math/Random.ts","webpack:///./Collision/Side.ts","webpack:///./Util/Util.ts","webpack:///./Util/Decorators.ts","webpack:///./Math/vector.ts","webpack:///./Math/matrix.ts","webpack:///./Color.ts","webpack:///./Collision/BoundingBox.ts","webpack:///./Graphics/Context/transform-stack.ts","webpack:///./Graphics/Context/state-stack.ts","webpack:///./Graphics/Context/shader.ts","webpack:///./Graphics/Context/batch.ts","webpack:///./Graphics/GraphicsDiagnostics.ts","webpack:///./Util/Pool.ts","webpack:///./Graphics/Context/renderer.ts","webpack:///./Graphics/Context/line-renderer.ts","webpack:///./Graphics/Context/shaders/line-vertex.glsl","webpack:///./Graphics/Context/shaders/line-fragment.glsl","webpack:///./Graphics/Context/draw-image-command.ts","webpack:///./Graphics/Context/webgl-util.ts","webpack:///./Graphics/Context/texture-loader.ts","webpack:///./Graphics/Context/image-renderer.ts","webpack:///./Graphics/Context/shaders/image-vertex.glsl","webpack:///./Graphics/Context/shaders/image-fragment.glsl","webpack:///./Graphics/Context/point-renderer.ts","webpack:///./Graphics/Context/shaders/point-vertex.glsl","webpack:///./Graphics/Context/shaders/point-fragment.glsl","webpack:///./Graphics/Graphic.ts","webpack:///./Util/Watch.ts","webpack:///./Graphics/Raster.ts","webpack:///./Graphics/Canvas.ts","webpack:///./Events.ts","webpack:///./EventDispatcher.ts","webpack:///./Resources/Resource.ts","webpack:///./Drawing/SpriteEffects.ts","webpack:///./Drawing/Texture.ts","webpack:///./Configurable.ts","webpack:///./Drawing/Sprite.ts","webpack:///./Graphics/Sprite.ts","webpack:///./Graphics/ImageSource.ts","webpack:///./Drawing/Animation.ts","webpack:///./Graphics/FontCommon.ts","webpack:///./Drawing/SpriteSheet.ts","webpack:///./Graphics/SpriteSheet.ts","webpack:///./Graphics/SpriteFont.ts","webpack:///./Graphics/Context/debug-text.ts","webpack:///./Graphics/Context/debug-font.png","webpack:///./Graphics/Context/ExcaliburGraphicsContextWebGL.ts","webpack:///./Screen.ts","webpack:///./Resources/Sound/AudioContext.ts","webpack:///./Util/WebAudio.ts","webpack:///./Class.ts","webpack:///./Util/DrawUtil.ts","webpack:///./Loader.ts","webpack:///./Loader.logo.png","webpack:///./Util/Detector.ts","webpack:///./Collision/CollisionType.ts","webpack:///./Collision/Physics.ts","webpack:///./Math/vector-view.ts","webpack:///./EntityComponentSystem/Component.ts","webpack:///./EntityComponentSystem/Components/TransformComponent.ts","webpack:///./EntityComponentSystem/Components/MotionComponent.ts","webpack:///./Collision/Group/CollisionGroup.ts","webpack:///./Util/Observable.ts","webpack:///./Collision/Detection/Pair.ts","webpack:///./Math/projection.ts","webpack:///./Collision/Detection/DynamicTree.ts","webpack:///./Math/ray.ts","webpack:///./Collision/Detection/DynamicTreeCollisionProcessor.ts","webpack:///./Collision/Colliders/Collider.ts","webpack:///./Collision/Colliders/CompositeCollider.ts","webpack:///./Math/line.ts","webpack:///./Collision/Colliders/ClosestLineJumpTable.ts","webpack:///./Collision/Colliders/CircleCollider.ts","webpack:///./Collision/Detection/CollisionContact.ts","webpack:///./Collision/Colliders/SeparatingAxis.ts","webpack:///./Collision/Colliders/CollisionJumpTable.ts","webpack:///./Collision/Colliders/EdgeCollider.ts","webpack:///./Collision/Colliders/PolygonCollider.ts","webpack:///./Collision/Colliders/Shape.ts","webpack:///./Collision/ColliderComponent.ts","webpack:///./Collision/BodyComponent.ts","webpack:///./Util/CullingBox.ts","webpack:///./Traits/OffscreenCulling.ts","webpack:///./Traits/CapturePointer.ts","webpack:///./EntityComponentSystem/Entity.ts","webpack:///./Drawing/CanvasDrawComponent.ts","webpack:///./Graphics/GraphicsComponent.ts","webpack:///./Graphics/Rectangle.ts","webpack:///./Graphics/Circle.ts","webpack:///./Actions/RotationType.ts","webpack:///./Util/EasingFunctions.ts","webpack:///./Actions/ActionQueue.ts","webpack:///./Actions/Action/Repeat.ts","webpack:///./Actions/Action/RepeatForever.ts","webpack:///./Actions/Action/MoveBy.ts","webpack:///./Actions/Action/MoveTo.ts","webpack:///./Actions/Action/RotateTo.ts","webpack:///./Actions/Action/RotateBy.ts","webpack:///./Actions/Action/ScaleTo.ts","webpack:///./Actions/Action/ScaleBy.ts","webpack:///./Actions/Action/CallMethod.ts","webpack:///./Actions/Action/EaseTo.ts","webpack:///./Actions/Action/Blink.ts","webpack:///./Actions/Action/Fade.ts","webpack:///./Actions/Action/Delay.ts","webpack:///./Actions/Action/Die.ts","webpack:///./Actions/Action/Follow.ts","webpack:///./Actions/Action/Meet.ts","webpack:///./Actions/ActionContext.ts","webpack:///./Actions/ActionsComponent.ts","webpack:///./Actor.ts","webpack:///./ScreenElement.ts","webpack:///./Timer.ts","webpack:///./Camera.ts","webpack:///./TileMap.ts","webpack:///./Util/Actors.ts","webpack:///./Trigger.ts","webpack:///./EntityComponentSystem/System.ts","webpack:///./EntityComponentSystem/EntityManager.ts","webpack:///./EntityComponentSystem/Util.ts","webpack:///./EntityComponentSystem/Query.ts","webpack:///./EntityComponentSystem/QueryManager.ts","webpack:///./EntityComponentSystem/SystemManager.ts","webpack:///./EntityComponentSystem/World.ts","webpack:///./Collision/Integrator.ts","webpack:///./Collision/MotionSystem.ts","webpack:///./Collision/Solver/Solver.ts","webpack:///./Collision/Solver/ArcadeSolver.ts","webpack:///./Collision/Solver/ContactConstraintPoint.ts","webpack:///./Collision/Solver/RealisticSolver.ts","webpack:///./Collision/CollisionSystem.ts","webpack:///./Graphics/Animation.ts","webpack:///./Particles.ts","webpack:///./Graphics/GraphicsGroup.ts","webpack:///./Graphics/GraphicsSystem.ts","webpack:///./Drawing/CanvasDrawingSystem.ts","webpack:///./Debug/DebugSystem.ts","webpack:///./Actions/ActionsSystem.ts","webpack:///./PostProcessing/ColorBlindCorrector.ts","webpack:///./Input/Keyboard.ts","webpack:///./Input/Pointer.ts","webpack:///./Input/PointerEvents.ts","webpack:///./Scene.ts","webpack:///./Debug/DebugFlags.ts","webpack:///./Debug/Debug.ts","webpack:///./Math/global-coordinates.ts","webpack:///./Input/Pointers.ts","webpack:///./Input/Gamepad.ts","webpack:///./Util/Browser.ts","webpack:///./Graphics/Context/ExcaliburGraphicsContext2DCanvas.ts","webpack:///./Engine.ts","webpack:///./Events/MediaEvents.ts","webpack:///./Graphics/Font.ts","webpack:///./Graphics/Text.ts","webpack:///./Label.ts","webpack:///./Collision/Group/CollisionGroupManager.ts","webpack:///./Drawing/Polygon.ts","webpack:///./Interfaces/AudioImplementation.ts","webpack:///./Interfaces/LifecycleEvents.ts","webpack:///./Resources/Sound/WebAudioInstance.ts","webpack:///./Util/Sound.ts","webpack:///./Resources/Sound/Sound.ts","webpack:///./Resources/Gif.ts","webpack:///./Graphics/Polygon.ts","webpack:///./Util/SortedList.ts","webpack:///./Promises.ts","webpack:///./index.ts"],"sourcesContent":["require('../../modules/es.array.sort');\nvar entryUnbind = require('../../internals/entry-unbind');\n\nmodule.exports = entryUnbind('Array', 'sort');\n","require('../../modules/es.object.keys');\nvar path = require('../../internals/path');\n\nmodule.exports = path.Object.keys;\n","var isCallable = require('../internals/is-callable');\nvar tryToString = require('../internals/try-to-string');\n\n// `Assert: IsCallable(argument) is true`\nmodule.exports = function (argument) {\n  if (isCallable(argument)) return argument;\n  throw TypeError(tryToString(argument) + ' is not a function');\n};\n","var isObject = require('../internals/is-object');\n\n// `Assert: Type(argument) is Object`\nmodule.exports = function (argument) {\n  if (isObject(argument)) return argument;\n  throw TypeError(String(argument) + ' is not an object');\n};\n","var toIndexedObject = require('../internals/to-indexed-object');\nvar toLength = require('../internals/to-length');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\n\n// `Array.prototype.{ indexOf, includes }` methods implementation\nvar createMethod = function (IS_INCLUDES) {\n  return function ($this, el, fromIndex) {\n    var O = toIndexedObject($this);\n    var length = toLength(O.length);\n    var index = toAbsoluteIndex(fromIndex, length);\n    var value;\n    // Array#includes uses SameValueZero equality algorithm\n    // eslint-disable-next-line no-self-compare -- NaN check\n    if (IS_INCLUDES && el != el) while (length > index) {\n      value = O[index++];\n      // eslint-disable-next-line no-self-compare -- NaN check\n      if (value != value) return true;\n    // Array#indexOf ignores holes, Array#includes - not\n    } else for (;length > index; index++) {\n      if ((IS_INCLUDES || index in O) && O[index] === el) return IS_INCLUDES || index || 0;\n    } return !IS_INCLUDES && -1;\n  };\n};\n\nmodule.exports = {\n  // `Array.prototype.includes` method\n  // https://tc39.es/ecma262/#sec-array.prototype.includes\n  includes: createMethod(true),\n  // `Array.prototype.indexOf` method\n  // https://tc39.es/ecma262/#sec-array.prototype.indexof\n  indexOf: createMethod(false)\n};\n","'use strict';\nvar fails = require('../internals/fails');\n\nmodule.exports = function (METHOD_NAME, argument) {\n  var method = [][METHOD_NAME];\n  return !!method && fails(function () {\n    // eslint-disable-next-line no-useless-call,no-throw-literal -- required for testing\n    method.call(null, argument || function () { throw 1; }, 1);\n  });\n};\n","// TODO: use something more complex like timsort?\nvar floor = Math.floor;\n\nvar mergeSort = function (array, comparefn) {\n  var length = array.length;\n  var middle = floor(length / 2);\n  return length < 8 ? insertionSort(array, comparefn) : merge(\n    mergeSort(array.slice(0, middle), comparefn),\n    mergeSort(array.slice(middle), comparefn),\n    comparefn\n  );\n};\n\nvar insertionSort = function (array, comparefn) {\n  var length = array.length;\n  var i = 1;\n  var element, j;\n\n  while (i < length) {\n    j = i;\n    element = array[i];\n    while (j && comparefn(array[j - 1], element) > 0) {\n      array[j] = array[--j];\n    }\n    if (j !== i++) array[j] = element;\n  } return array;\n};\n\nvar merge = function (left, right, comparefn) {\n  var llength = left.length;\n  var rlength = right.length;\n  var lindex = 0;\n  var rindex = 0;\n  var result = [];\n\n  while (lindex < llength || rindex < rlength) {\n    if (lindex < llength && rindex < rlength) {\n      result.push(comparefn(left[lindex], right[rindex]) <= 0 ? left[lindex++] : right[rindex++]);\n    } else {\n      result.push(lindex < llength ? left[lindex++] : right[rindex++]);\n    }\n  } return result;\n};\n\nmodule.exports = mergeSort;\n","var toString = {}.toString;\n\nmodule.exports = function (it) {\n  return toString.call(it).slice(8, -1);\n};\n","var TO_STRING_TAG_SUPPORT = require('../internals/to-string-tag-support');\nvar isCallable = require('../internals/is-callable');\nvar classofRaw = require('../internals/classof-raw');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\n// ES3 wrong here\nvar CORRECT_ARGUMENTS = classofRaw(function () { return arguments; }()) == 'Arguments';\n\n// fallback for IE11 Script Access Denied error\nvar tryGet = function (it, key) {\n  try {\n    return it[key];\n  } catch (error) { /* empty */ }\n};\n\n// getting tag from ES6+ `Object.prototype.toString`\nmodule.exports = TO_STRING_TAG_SUPPORT ? classofRaw : function (it) {\n  var O, tag, result;\n  return it === undefined ? 'Undefined' : it === null ? 'Null'\n    // @@toStringTag case\n    : typeof (tag = tryGet(O = Object(it), TO_STRING_TAG)) == 'string' ? tag\n    // builtinTag case\n    : CORRECT_ARGUMENTS ? classofRaw(O)\n    // ES3 arguments fallback\n    : (result = classofRaw(O)) == 'Object' && isCallable(O.callee) ? 'Arguments' : result;\n};\n","var has = require('../internals/has');\nvar ownKeys = require('../internals/own-keys');\nvar getOwnPropertyDescriptorModule = require('../internals/object-get-own-property-descriptor');\nvar definePropertyModule = require('../internals/object-define-property');\n\nmodule.exports = function (target, source) {\n  var keys = ownKeys(source);\n  var defineProperty = definePropertyModule.f;\n  var getOwnPropertyDescriptor = getOwnPropertyDescriptorModule.f;\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    if (!has(target, key)) defineProperty(target, key, getOwnPropertyDescriptor(source, key));\n  }\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar definePropertyModule = require('../internals/object-define-property');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\n\nmodule.exports = DESCRIPTORS ? function (object, key, value) {\n  return definePropertyModule.f(object, key, createPropertyDescriptor(1, value));\n} : function (object, key, value) {\n  object[key] = value;\n  return object;\n};\n","module.exports = function (bitmap, value) {\n  return {\n    enumerable: !(bitmap & 1),\n    configurable: !(bitmap & 2),\n    writable: !(bitmap & 4),\n    value: value\n  };\n};\n","var fails = require('../internals/fails');\n\n// Detect IE8's incomplete defineProperty implementation\nmodule.exports = !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- required for testing\n  return Object.defineProperty({}, 1, { get: function () { return 7; } })[1] != 7;\n});\n","var global = require('../internals/global');\nvar isObject = require('../internals/is-object');\n\nvar document = global.document;\n// typeof document.createElement is 'object' in old IE\nvar EXISTS = isObject(document) && isObject(document.createElement);\n\nmodule.exports = function (it) {\n  return EXISTS ? document.createElement(it) : {};\n};\n","var userAgent = require('../internals/engine-user-agent');\n\nvar firefox = userAgent.match(/firefox\\/(\\d+)/i);\n\nmodule.exports = !!firefox && +firefox[1];\n","var UA = require('../internals/engine-user-agent');\n\nmodule.exports = /MSIE|Trident/.test(UA);\n","var getBuiltIn = require('../internals/get-built-in');\n\nmodule.exports = getBuiltIn('navigator', 'userAgent') || '';\n","var global = require('../internals/global');\nvar userAgent = require('../internals/engine-user-agent');\n\nvar process = global.process;\nvar Deno = global.Deno;\nvar versions = process && process.versions || Deno && Deno.version;\nvar v8 = versions && versions.v8;\nvar match, version;\n\nif (v8) {\n  match = v8.split('.');\n  version = match[0] < 4 ? 1 : match[0] + match[1];\n} else if (userAgent) {\n  match = userAgent.match(/Edge\\/(\\d+)/);\n  if (!match || match[1] >= 74) {\n    match = userAgent.match(/Chrome\\/(\\d+)/);\n    if (match) version = match[1];\n  }\n}\n\nmodule.exports = version && +version;\n","var userAgent = require('../internals/engine-user-agent');\n\nvar webkit = userAgent.match(/AppleWebKit\\/(\\d+)\\./);\n\nmodule.exports = !!webkit && +webkit[1];\n","var global = require('../internals/global');\nvar bind = require('../internals/function-bind-context');\n\nvar call = Function.call;\n\nmodule.exports = function (CONSTRUCTOR, METHOD, length) {\n  return bind(call, global[CONSTRUCTOR].prototype[METHOD], length);\n};\n","// IE8- don't enum bug keys\nmodule.exports = [\n  'constructor',\n  'hasOwnProperty',\n  'isPrototypeOf',\n  'propertyIsEnumerable',\n  'toLocaleString',\n  'toString',\n  'valueOf'\n];\n","var global = require('../internals/global');\nvar getOwnPropertyDescriptor = require('../internals/object-get-own-property-descriptor').f;\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar redefine = require('../internals/redefine');\nvar setGlobal = require('../internals/set-global');\nvar copyConstructorProperties = require('../internals/copy-constructor-properties');\nvar isForced = require('../internals/is-forced');\n\n/*\n  options.target      - name of the target object\n  options.global      - target is the global object\n  options.stat        - export as static methods of target\n  options.proto       - export as prototype methods of target\n  options.real        - real prototype method for the `pure` version\n  options.forced      - export even if the native feature is available\n  options.bind        - bind methods to the target, required for the `pure` version\n  options.wrap        - wrap constructors to preventing global pollution, required for the `pure` version\n  options.unsafe      - use the simple assignment of property instead of delete + defineProperty\n  options.sham        - add a flag to not completely full polyfills\n  options.enumerable  - export as enumerable property\n  options.noTargetGet - prevent calling a getter on target\n  options.name        - the .name of the function if it does not match the key\n*/\nmodule.exports = function (options, source) {\n  var TARGET = options.target;\n  var GLOBAL = options.global;\n  var STATIC = options.stat;\n  var FORCED, target, key, targetProperty, sourceProperty, descriptor;\n  if (GLOBAL) {\n    target = global;\n  } else if (STATIC) {\n    target = global[TARGET] || setGlobal(TARGET, {});\n  } else {\n    target = (global[TARGET] || {}).prototype;\n  }\n  if (target) for (key in source) {\n    sourceProperty = source[key];\n    if (options.noTargetGet) {\n      descriptor = getOwnPropertyDescriptor(target, key);\n      targetProperty = descriptor && descriptor.value;\n    } else targetProperty = target[key];\n    FORCED = isForced(GLOBAL ? key : TARGET + (STATIC ? '.' : '#') + key, options.forced);\n    // contained in target\n    if (!FORCED && targetProperty !== undefined) {\n      if (typeof sourceProperty === typeof targetProperty) continue;\n      copyConstructorProperties(sourceProperty, targetProperty);\n    }\n    // add a flag to not completely full polyfills\n    if (options.sham || (targetProperty && targetProperty.sham)) {\n      createNonEnumerableProperty(sourceProperty, 'sham', true);\n    }\n    // extend global\n    redefine(target, key, sourceProperty, options);\n  }\n};\n","module.exports = function (exec) {\n  try {\n    return !!exec();\n  } catch (error) {\n    return true;\n  }\n};\n","var aCallable = require('../internals/a-callable');\n\n// optional / simple context binding\nmodule.exports = function (fn, that, length) {\n  aCallable(fn);\n  if (that === undefined) return fn;\n  switch (length) {\n    case 0: return function () {\n      return fn.call(that);\n    };\n    case 1: return function (a) {\n      return fn.call(that, a);\n    };\n    case 2: return function (a, b) {\n      return fn.call(that, a, b);\n    };\n    case 3: return function (a, b, c) {\n      return fn.call(that, a, b, c);\n    };\n  }\n  return function (/* ...args */) {\n    return fn.apply(that, arguments);\n  };\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar has = require('../internals/has');\n\nvar FunctionPrototype = Function.prototype;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getDescriptor = DESCRIPTORS && Object.getOwnPropertyDescriptor;\n\nvar EXISTS = has(FunctionPrototype, 'name');\n// additional protection from minified / mangled / dropped function names\nvar PROPER = EXISTS && (function something() { /* empty */ }).name === 'something';\nvar CONFIGURABLE = EXISTS && (!DESCRIPTORS || (DESCRIPTORS && getDescriptor(FunctionPrototype, 'name').configurable));\n\nmodule.exports = {\n  EXISTS: EXISTS,\n  PROPER: PROPER,\n  CONFIGURABLE: CONFIGURABLE\n};\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\n\nvar aFunction = function (argument) {\n  return isCallable(argument) ? argument : undefined;\n};\n\nmodule.exports = function (namespace, method) {\n  return arguments.length < 2 ? aFunction(global[namespace]) : global[namespace] && global[namespace][method];\n};\n","var aCallable = require('../internals/a-callable');\n\n// `GetMethod` abstract operation\n// https://tc39.es/ecma262/#sec-getmethod\nmodule.exports = function (V, P) {\n  var func = V[P];\n  return func == null ? undefined : aCallable(func);\n};\n","var check = function (it) {\n  return it && it.Math == Math && it;\n};\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nmodule.exports =\n  // eslint-disable-next-line es/no-global-this -- safe\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window == 'object' && window) ||\n  // eslint-disable-next-line no-restricted-globals -- safe\n  check(typeof self == 'object' && self) ||\n  check(typeof global == 'object' && global) ||\n  // eslint-disable-next-line no-new-func -- fallback\n  (function () { return this; })() || Function('return this')();\n","var toObject = require('../internals/to-object');\n\nvar hasOwnProperty = {}.hasOwnProperty;\n\nmodule.exports = Object.hasOwn || function hasOwn(it, key) {\n  return hasOwnProperty.call(toObject(it), key);\n};\n","module.exports = {};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar fails = require('../internals/fails');\nvar createElement = require('../internals/document-create-element');\n\n// Thank's IE8 for his funny defineProperty\nmodule.exports = !DESCRIPTORS && !fails(function () {\n  // eslint-disable-next-line es/no-object-defineproperty -- requied for testing\n  return Object.defineProperty(createElement('div'), 'a', {\n    get: function () { return 7; }\n  }).a != 7;\n});\n","var fails = require('../internals/fails');\nvar classof = require('../internals/classof-raw');\n\nvar split = ''.split;\n\n// fallback for non-array-like ES3 and non-enumerable old V8 strings\nmodule.exports = fails(function () {\n  // throws an error in rhino, see https://github.com/mozilla/rhino/issues/346\n  // eslint-disable-next-line no-prototype-builtins -- safe\n  return !Object('z').propertyIsEnumerable(0);\n}) ? function (it) {\n  return classof(it) == 'String' ? split.call(it, '') : Object(it);\n} : Object;\n","var isCallable = require('../internals/is-callable');\nvar store = require('../internals/shared-store');\n\nvar functionToString = Function.toString;\n\n// this helper broken in `core-js@3.4.1-3.4.4`, so we can't use `shared` helper\nif (!isCallable(store.inspectSource)) {\n  store.inspectSource = function (it) {\n    return functionToString.call(it);\n  };\n}\n\nmodule.exports = store.inspectSource;\n","var NATIVE_WEAK_MAP = require('../internals/native-weak-map');\nvar global = require('../internals/global');\nvar isObject = require('../internals/is-object');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar objectHas = require('../internals/has');\nvar shared = require('../internals/shared-store');\nvar sharedKey = require('../internals/shared-key');\nvar hiddenKeys = require('../internals/hidden-keys');\n\nvar OBJECT_ALREADY_INITIALIZED = 'Object already initialized';\nvar WeakMap = global.WeakMap;\nvar set, get, has;\n\nvar enforce = function (it) {\n  return has(it) ? get(it) : set(it, {});\n};\n\nvar getterFor = function (TYPE) {\n  return function (it) {\n    var state;\n    if (!isObject(it) || (state = get(it)).type !== TYPE) {\n      throw TypeError('Incompatible receiver, ' + TYPE + ' required');\n    } return state;\n  };\n};\n\nif (NATIVE_WEAK_MAP || shared.state) {\n  var store = shared.state || (shared.state = new WeakMap());\n  var wmget = store.get;\n  var wmhas = store.has;\n  var wmset = store.set;\n  set = function (it, metadata) {\n    if (wmhas.call(store, it)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    wmset.call(store, it, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return wmget.call(store, it) || {};\n  };\n  has = function (it) {\n    return wmhas.call(store, it);\n  };\n} else {\n  var STATE = sharedKey('state');\n  hiddenKeys[STATE] = true;\n  set = function (it, metadata) {\n    if (objectHas(it, STATE)) throw new TypeError(OBJECT_ALREADY_INITIALIZED);\n    metadata.facade = it;\n    createNonEnumerableProperty(it, STATE, metadata);\n    return metadata;\n  };\n  get = function (it) {\n    return objectHas(it, STATE) ? it[STATE] : {};\n  };\n  has = function (it) {\n    return objectHas(it, STATE);\n  };\n}\n\nmodule.exports = {\n  set: set,\n  get: get,\n  has: has,\n  enforce: enforce,\n  getterFor: getterFor\n};\n","// `IsCallable` abstract operation\n// https://tc39.es/ecma262/#sec-iscallable\nmodule.exports = function (argument) {\n  return typeof argument === 'function';\n};\n","var fails = require('../internals/fails');\nvar isCallable = require('../internals/is-callable');\n\nvar replacement = /#|\\.prototype\\./;\n\nvar isForced = function (feature, detection) {\n  var value = data[normalize(feature)];\n  return value == POLYFILL ? true\n    : value == NATIVE ? false\n    : isCallable(detection) ? fails(detection)\n    : !!detection;\n};\n\nvar normalize = isForced.normalize = function (string) {\n  return String(string).replace(replacement, '.').toLowerCase();\n};\n\nvar data = isForced.data = {};\nvar NATIVE = isForced.NATIVE = 'N';\nvar POLYFILL = isForced.POLYFILL = 'P';\n\nmodule.exports = isForced;\n","var isCallable = require('../internals/is-callable');\n\nmodule.exports = function (it) {\n  return typeof it === 'object' ? it !== null : isCallable(it);\n};\n","module.exports = false;\n","var isCallable = require('../internals/is-callable');\nvar getBuiltIn = require('../internals/get-built-in');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nmodule.exports = USE_SYMBOL_AS_UID ? function (it) {\n  return typeof it == 'symbol';\n} : function (it) {\n  var $Symbol = getBuiltIn('Symbol');\n  return isCallable($Symbol) && Object(it) instanceof $Symbol;\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar V8_VERSION = require('../internals/engine-v8-version');\nvar fails = require('../internals/fails');\n\n// eslint-disable-next-line es/no-object-getownpropertysymbols -- required for testing\nmodule.exports = !!Object.getOwnPropertySymbols && !fails(function () {\n  var symbol = Symbol();\n  // Chrome 38 Symbol has incorrect toString conversion\n  // `get-own-property-symbols` polyfill symbols converted to object are not Symbol instances\n  return !String(symbol) || !(Object(symbol) instanceof Symbol) ||\n    // Chrome 38-40 symbols are not inherited from DOM collections prototypes to instances\n    !Symbol.sham && V8_VERSION && V8_VERSION < 41;\n});\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar inspectSource = require('../internals/inspect-source');\n\nvar WeakMap = global.WeakMap;\n\nmodule.exports = isCallable(WeakMap) && /native code/.test(inspectSource(WeakMap));\n","var DESCRIPTORS = require('../internals/descriptors');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\nvar anObject = require('../internals/an-object');\nvar toPropertyKey = require('../internals/to-property-key');\n\n// eslint-disable-next-line es/no-object-defineproperty -- safe\nvar $defineProperty = Object.defineProperty;\n\n// `Object.defineProperty` method\n// https://tc39.es/ecma262/#sec-object.defineproperty\nexports.f = DESCRIPTORS ? $defineProperty : function defineProperty(O, P, Attributes) {\n  anObject(O);\n  P = toPropertyKey(P);\n  anObject(Attributes);\n  if (IE8_DOM_DEFINE) try {\n    return $defineProperty(O, P, Attributes);\n  } catch (error) { /* empty */ }\n  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported');\n  if ('value' in Attributes) O[P] = Attributes.value;\n  return O;\n};\n","var DESCRIPTORS = require('../internals/descriptors');\nvar propertyIsEnumerableModule = require('../internals/object-property-is-enumerable');\nvar createPropertyDescriptor = require('../internals/create-property-descriptor');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar toPropertyKey = require('../internals/to-property-key');\nvar has = require('../internals/has');\nvar IE8_DOM_DEFINE = require('../internals/ie8-dom-define');\n\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar $getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// `Object.getOwnPropertyDescriptor` method\n// https://tc39.es/ecma262/#sec-object.getownpropertydescriptor\nexports.f = DESCRIPTORS ? $getOwnPropertyDescriptor : function getOwnPropertyDescriptor(O, P) {\n  O = toIndexedObject(O);\n  P = toPropertyKey(P);\n  if (IE8_DOM_DEFINE) try {\n    return $getOwnPropertyDescriptor(O, P);\n  } catch (error) { /* empty */ }\n  if (has(O, P)) return createPropertyDescriptor(!propertyIsEnumerableModule.f.call(O, P), O[P]);\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\nvar hiddenKeys = enumBugKeys.concat('length', 'prototype');\n\n// `Object.getOwnPropertyNames` method\n// https://tc39.es/ecma262/#sec-object.getownpropertynames\n// eslint-disable-next-line es/no-object-getownpropertynames -- safe\nexports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {\n  return internalObjectKeys(O, hiddenKeys);\n};\n","// eslint-disable-next-line es/no-object-getownpropertysymbols -- safe\nexports.f = Object.getOwnPropertySymbols;\n","var has = require('../internals/has');\nvar toIndexedObject = require('../internals/to-indexed-object');\nvar indexOf = require('../internals/array-includes').indexOf;\nvar hiddenKeys = require('../internals/hidden-keys');\n\nmodule.exports = function (object, names) {\n  var O = toIndexedObject(object);\n  var i = 0;\n  var result = [];\n  var key;\n  for (key in O) !has(hiddenKeys, key) && has(O, key) && result.push(key);\n  // Don't enum bug & hidden keys\n  while (names.length > i) if (has(O, key = names[i++])) {\n    ~indexOf(result, key) || result.push(key);\n  }\n  return result;\n};\n","var internalObjectKeys = require('../internals/object-keys-internal');\nvar enumBugKeys = require('../internals/enum-bug-keys');\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n// eslint-disable-next-line es/no-object-keys -- safe\nmodule.exports = Object.keys || function keys(O) {\n  return internalObjectKeys(O, enumBugKeys);\n};\n","'use strict';\nvar $propertyIsEnumerable = {}.propertyIsEnumerable;\n// eslint-disable-next-line es/no-object-getownpropertydescriptor -- safe\nvar getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\n\n// Nashorn ~ JDK8 bug\nvar NASHORN_BUG = getOwnPropertyDescriptor && !$propertyIsEnumerable.call({ 1: 2 }, 1);\n\n// `Object.prototype.propertyIsEnumerable` method implementation\n// https://tc39.es/ecma262/#sec-object.prototype.propertyisenumerable\nexports.f = NASHORN_BUG ? function propertyIsEnumerable(V) {\n  var descriptor = getOwnPropertyDescriptor(this, V);\n  return !!descriptor && descriptor.enumerable;\n} : $propertyIsEnumerable;\n","var isCallable = require('../internals/is-callable');\nvar isObject = require('../internals/is-object');\n\n// `OrdinaryToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-ordinarytoprimitive\nmodule.exports = function (input, pref) {\n  var fn, val;\n  if (pref === 'string' && isCallable(fn = input.toString) && !isObject(val = fn.call(input))) return val;\n  if (isCallable(fn = input.valueOf) && !isObject(val = fn.call(input))) return val;\n  if (pref !== 'string' && isCallable(fn = input.toString) && !isObject(val = fn.call(input))) return val;\n  throw TypeError(\"Can't convert object to primitive value\");\n};\n","var getBuiltIn = require('../internals/get-built-in');\nvar getOwnPropertyNamesModule = require('../internals/object-get-own-property-names');\nvar getOwnPropertySymbolsModule = require('../internals/object-get-own-property-symbols');\nvar anObject = require('../internals/an-object');\n\n// all object keys, includes non-enumerable and symbols\nmodule.exports = getBuiltIn('Reflect', 'ownKeys') || function ownKeys(it) {\n  var keys = getOwnPropertyNamesModule.f(anObject(it));\n  var getOwnPropertySymbols = getOwnPropertySymbolsModule.f;\n  return getOwnPropertySymbols ? keys.concat(getOwnPropertySymbols(it)) : keys;\n};\n","var global = require('../internals/global');\n\nmodule.exports = global;\n","var global = require('../internals/global');\nvar isCallable = require('../internals/is-callable');\nvar has = require('../internals/has');\nvar createNonEnumerableProperty = require('../internals/create-non-enumerable-property');\nvar setGlobal = require('../internals/set-global');\nvar inspectSource = require('../internals/inspect-source');\nvar InternalStateModule = require('../internals/internal-state');\nvar CONFIGURABLE_FUNCTION_NAME = require('../internals/function-name').CONFIGURABLE;\n\nvar getInternalState = InternalStateModule.get;\nvar enforceInternalState = InternalStateModule.enforce;\nvar TEMPLATE = String(String).split('String');\n\n(module.exports = function (O, key, value, options) {\n  var unsafe = options ? !!options.unsafe : false;\n  var simple = options ? !!options.enumerable : false;\n  var noTargetGet = options ? !!options.noTargetGet : false;\n  var name = options && options.name !== undefined ? options.name : key;\n  var state;\n  if (isCallable(value)) {\n    if (String(name).slice(0, 7) === 'Symbol(') {\n      name = '[' + String(name).replace(/^Symbol\\(([^)]*)\\)/, '$1') + ']';\n    }\n    if (!has(value, 'name') || (CONFIGURABLE_FUNCTION_NAME && value.name !== name)) {\n      createNonEnumerableProperty(value, 'name', name);\n    }\n    state = enforceInternalState(value);\n    if (!state.source) {\n      state.source = TEMPLATE.join(typeof name == 'string' ? name : '');\n    }\n  }\n  if (O === global) {\n    if (simple) O[key] = value;\n    else setGlobal(key, value);\n    return;\n  } else if (!unsafe) {\n    delete O[key];\n  } else if (!noTargetGet && O[key]) {\n    simple = true;\n  }\n  if (simple) O[key] = value;\n  else createNonEnumerableProperty(O, key, value);\n// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n})(Function.prototype, 'toString', function toString() {\n  return isCallable(this) && getInternalState(this).source || inspectSource(this);\n});\n","// `RequireObjectCoercible` abstract operation\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nmodule.exports = function (it) {\n  if (it == undefined) throw TypeError(\"Can't call method on \" + it);\n  return it;\n};\n","var global = require('../internals/global');\n\nmodule.exports = function (key, value) {\n  try {\n    // eslint-disable-next-line es/no-object-defineproperty -- safe\n    Object.defineProperty(global, key, { value: value, configurable: true, writable: true });\n  } catch (error) {\n    global[key] = value;\n  } return value;\n};\n","var shared = require('../internals/shared');\nvar uid = require('../internals/uid');\n\nvar keys = shared('keys');\n\nmodule.exports = function (key) {\n  return keys[key] || (keys[key] = uid(key));\n};\n","var global = require('../internals/global');\nvar setGlobal = require('../internals/set-global');\n\nvar SHARED = '__core-js_shared__';\nvar store = global[SHARED] || setGlobal(SHARED, {});\n\nmodule.exports = store;\n","var IS_PURE = require('../internals/is-pure');\nvar store = require('../internals/shared-store');\n\n(module.exports = function (key, value) {\n  return store[key] || (store[key] = value !== undefined ? value : {});\n})('versions', []).push({\n  version: '3.18.1',\n  mode: IS_PURE ? 'pure' : 'global',\n  copyright: '© 2021 Denis Pushkarev (zloirock.ru)'\n});\n","var toInteger = require('../internals/to-integer');\n\nvar max = Math.max;\nvar min = Math.min;\n\n// Helper for a popular repeating case of the spec:\n// Let integer be ? ToInteger(index).\n// If integer < 0, let result be max((length + integer), 0); else let result be min(integer, length).\nmodule.exports = function (index, length) {\n  var integer = toInteger(index);\n  return integer < 0 ? max(integer + length, 0) : min(integer, length);\n};\n","// toObject with fallback for non-array-like ES3 strings\nvar IndexedObject = require('../internals/indexed-object');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\n\nmodule.exports = function (it) {\n  return IndexedObject(requireObjectCoercible(it));\n};\n","var ceil = Math.ceil;\nvar floor = Math.floor;\n\n// `ToInteger` abstract operation\n// https://tc39.es/ecma262/#sec-tointeger\nmodule.exports = function (argument) {\n  return isNaN(argument = +argument) ? 0 : (argument > 0 ? floor : ceil)(argument);\n};\n","var toInteger = require('../internals/to-integer');\n\nvar min = Math.min;\n\n// `ToLength` abstract operation\n// https://tc39.es/ecma262/#sec-tolength\nmodule.exports = function (argument) {\n  return argument > 0 ? min(toInteger(argument), 0x1FFFFFFFFFFFFF) : 0; // 2 ** 53 - 1 == 9007199254740991\n};\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\n// `ToObject` abstract operation\n// https://tc39.es/ecma262/#sec-toobject\nmodule.exports = function (argument) {\n  return Object(requireObjectCoercible(argument));\n};\n","var isObject = require('../internals/is-object');\nvar isSymbol = require('../internals/is-symbol');\nvar getMethod = require('../internals/get-method');\nvar ordinaryToPrimitive = require('../internals/ordinary-to-primitive');\nvar wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_PRIMITIVE = wellKnownSymbol('toPrimitive');\n\n// `ToPrimitive` abstract operation\n// https://tc39.es/ecma262/#sec-toprimitive\nmodule.exports = function (input, pref) {\n  if (!isObject(input) || isSymbol(input)) return input;\n  var exoticToPrim = getMethod(input, TO_PRIMITIVE);\n  var result;\n  if (exoticToPrim) {\n    if (pref === undefined) pref = 'default';\n    result = exoticToPrim.call(input, pref);\n    if (!isObject(result) || isSymbol(result)) return result;\n    throw TypeError(\"Can't convert object to primitive value\");\n  }\n  if (pref === undefined) pref = 'number';\n  return ordinaryToPrimitive(input, pref);\n};\n","var toPrimitive = require('../internals/to-primitive');\nvar isSymbol = require('../internals/is-symbol');\n\n// `ToPropertyKey` abstract operation\n// https://tc39.es/ecma262/#sec-topropertykey\nmodule.exports = function (argument) {\n  var key = toPrimitive(argument, 'string');\n  return isSymbol(key) ? key : String(key);\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar TO_STRING_TAG = wellKnownSymbol('toStringTag');\nvar test = {};\n\ntest[TO_STRING_TAG] = 'z';\n\nmodule.exports = String(test) === '[object z]';\n","var classof = require('../internals/classof');\n\nmodule.exports = function (argument) {\n  if (classof(argument) === 'Symbol') throw TypeError('Cannot convert a Symbol value to a string');\n  return String(argument);\n};\n","module.exports = function (argument) {\n  try {\n    return String(argument);\n  } catch (error) {\n    return 'Object';\n  }\n};\n","var id = 0;\nvar postfix = Math.random();\n\nmodule.exports = function (key) {\n  return 'Symbol(' + String(key === undefined ? '' : key) + ')_' + (++id + postfix).toString(36);\n};\n","/* eslint-disable es/no-symbol -- required for testing */\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\n\nmodule.exports = NATIVE_SYMBOL\n  && !Symbol.sham\n  && typeof Symbol.iterator == 'symbol';\n","var global = require('../internals/global');\nvar shared = require('../internals/shared');\nvar has = require('../internals/has');\nvar uid = require('../internals/uid');\nvar NATIVE_SYMBOL = require('../internals/native-symbol');\nvar USE_SYMBOL_AS_UID = require('../internals/use-symbol-as-uid');\n\nvar WellKnownSymbolsStore = shared('wks');\nvar Symbol = global.Symbol;\nvar createWellKnownSymbol = USE_SYMBOL_AS_UID ? Symbol : Symbol && Symbol.withoutSetter || uid;\n\nmodule.exports = function (name) {\n  if (!has(WellKnownSymbolsStore, name) || !(NATIVE_SYMBOL || typeof WellKnownSymbolsStore[name] == 'string')) {\n    if (NATIVE_SYMBOL && has(Symbol, name)) {\n      WellKnownSymbolsStore[name] = Symbol[name];\n    } else {\n      WellKnownSymbolsStore[name] = createWellKnownSymbol('Symbol.' + name);\n    }\n  } return WellKnownSymbolsStore[name];\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar toString = require('../internals/to-string');\nvar fails = require('../internals/fails');\nvar internalSort = require('../internals/array-sort');\nvar arrayMethodIsStrict = require('../internals/array-method-is-strict');\nvar FF = require('../internals/engine-ff-version');\nvar IE_OR_EDGE = require('../internals/engine-is-ie-or-edge');\nvar V8 = require('../internals/engine-v8-version');\nvar WEBKIT = require('../internals/engine-webkit-version');\n\nvar test = [];\nvar nativeSort = test.sort;\n\n// IE8-\nvar FAILS_ON_UNDEFINED = fails(function () {\n  test.sort(undefined);\n});\n// V8 bug\nvar FAILS_ON_NULL = fails(function () {\n  test.sort(null);\n});\n// Old WebKit\nvar STRICT_METHOD = arrayMethodIsStrict('sort');\n\nvar STABLE_SORT = !fails(function () {\n  // feature detection can be too slow, so check engines versions\n  if (V8) return V8 < 70;\n  if (FF && FF > 3) return;\n  if (IE_OR_EDGE) return true;\n  if (WEBKIT) return WEBKIT < 603;\n\n  var result = '';\n  var code, chr, value, index;\n\n  // generate an array with more 512 elements (Chakra and old V8 fails only in this case)\n  for (code = 65; code < 76; code++) {\n    chr = String.fromCharCode(code);\n\n    switch (code) {\n      case 66: case 69: case 70: case 72: value = 3; break;\n      case 68: case 71: value = 4; break;\n      default: value = 2;\n    }\n\n    for (index = 0; index < 47; index++) {\n      test.push({ k: chr + index, v: value });\n    }\n  }\n\n  test.sort(function (a, b) { return b.v - a.v; });\n\n  for (index = 0; index < test.length; index++) {\n    chr = test[index].k.charAt(0);\n    if (result.charAt(result.length - 1) !== chr) result += chr;\n  }\n\n  return result !== 'DGBEFHACIJK';\n});\n\nvar FORCED = FAILS_ON_UNDEFINED || !FAILS_ON_NULL || !STRICT_METHOD || !STABLE_SORT;\n\nvar getSortCompare = function (comparefn) {\n  return function (x, y) {\n    if (y === undefined) return -1;\n    if (x === undefined) return 1;\n    if (comparefn !== undefined) return +comparefn(x, y) || 0;\n    return toString(x) > toString(y) ? 1 : -1;\n  };\n};\n\n// `Array.prototype.sort` method\n// https://tc39.es/ecma262/#sec-array.prototype.sort\n$({ target: 'Array', proto: true, forced: FORCED }, {\n  sort: function sort(comparefn) {\n    if (comparefn !== undefined) aCallable(comparefn);\n\n    var array = toObject(this);\n\n    if (STABLE_SORT) return comparefn === undefined ? nativeSort.call(array) : nativeSort.call(array, comparefn);\n\n    var items = [];\n    var arrayLength = toLength(array.length);\n    var itemsLength, index;\n\n    for (index = 0; index < arrayLength; index++) {\n      if (index in array) items.push(array[index]);\n    }\n\n    items = internalSort(items, getSortCompare(comparefn));\n    itemsLength = items.length;\n    index = 0;\n\n    while (index < itemsLength) array[index] = items[index++];\n    while (index < arrayLength) delete array[index++];\n\n    return array;\n  }\n});\n","var $ = require('../internals/export');\nvar toObject = require('../internals/to-object');\nvar nativeKeys = require('../internals/object-keys');\nvar fails = require('../internals/fails');\n\nvar FAILS_ON_PRIMITIVES = fails(function () { nativeKeys(1); });\n\n// `Object.keys` method\n// https://tc39.es/ecma262/#sec-object.keys\n$({ target: 'Object', stat: true, forced: FAILS_ON_PRIMITIVES }, {\n  keys: function keys(it) {\n    return nativeKeys(toObject(it));\n  }\n});\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./Loader.css\"],\"names\":[],\"mappings\":\"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF\",\"sourcesContent\":[\"/* Buttons styles start */\\r\\n\\r\\nbutton#excalibur-play {\\r\\n  display: inline-block;\\r\\n  position: relative;\\r\\n  z-index: 999;\\r\\n  border-radius: 6px;\\r\\n  border: none;\\r\\n  /*border: 3px solid;\\r\\n    border-color: white;\\r\\n    box-shadow: 0 0 10px #ccc;*/\\r\\n  padding: 1rem 1.5rem 1rem 4rem;\\r\\n  margin: 0;\\r\\n  text-decoration: none;\\r\\n  background: #00b233;\\r\\n  color: #ffffff;\\r\\n  font-family: sans-serif;\\r\\n  font-size: 2rem;\\r\\n  white-space: nowrap;\\r\\n  line-height: 1;\\r\\n  cursor: pointer;\\r\\n  text-align: center;\\r\\n  transition: background 250ms ease-in-out, transform 150ms ease;\\r\\n  -webkit-appearance: none;\\r\\n  -moz-appearance: none;\\r\\n\\r\\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\\r\\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\\r\\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\\r\\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\\r\\n  animation: excalibur-button-fadein 200ms;\\r\\n}\\r\\n\\r\\n/*\\r\\nbutton#excalibur-play {\\r\\n  display: none;\\r\\n}*/\\r\\n\\r\\nbutton#excalibur-play:after {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 8px solid;\\r\\n  border-color: transparent transparent transparent white;\\r\\n  left: 35px;\\r\\n  top: 24px;\\r\\n  width: 0;\\r\\n  height: 0;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:before {\\r\\n  position: absolute;\\r\\n  content: '';\\r\\n  border: 3px solid;\\r\\n  left: 19px;\\r\\n  top: 14px;\\r\\n  border-radius: 20px;\\r\\n  width: 30px;\\r\\n  height: 30px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:hover,\\r\\nbutton#excalibur-play:focus {\\r\\n  background: #00982c;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:focus {\\r\\n  outline: 1px solid #fff;\\r\\n  outline-offset: -4px;\\r\\n}\\r\\n\\r\\nbutton#excalibur-play:active {\\r\\n  transform: scale(0.99);\\r\\n}\\r\\n\\r\\n@keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Firefox < 16 */\\r\\n@-moz-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Safari, Chrome and Opera > 12.1 */\\r\\n@-webkit-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Internet Explorer */\\r\\n@-ms-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\\r\\n/* Opera < 12.1 */\\r\\n@-o-keyframes excalibur-button-fadein {\\r\\n  from {\\r\\n    opacity: 0;\\r\\n  }\\r\\n  to {\\r\\n    opacity: 1;\\r\\n  }\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n\n      content += cssWithMappingToString(item);\n\n      if (needLayer) {\n        content += \"}\";\n      }\n\n      if (item[2]) {\n        content += \"}\";\n      }\n\n      if (item[4]) {\n        content += \"}\";\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n\n\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var _i = 0; _i < this.length; _i++) {\n        var id = this[_i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i2 = 0; _i2 < modules.length; _i2++) {\n      var item = [].concat(modules[_i2]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\r\n/**\r\n * Features in preview\r\n */\r\nexport enum Experiments {\r\n  WebGL = 'use-webgl'\r\n}\r\n\r\n/**\r\n * Legacy features that will go away\r\n */\r\nexport enum Legacy {\r\n  Canvas = 'use-canvas-context',\r\n  LegacyDrawing = 'use-legacy-drawing'\r\n}\r\n\r\n/**\r\n * Flags is a feature flag implementation for Excalibur. They can only be operated **before [[Engine]] construction**\r\n * after which they are frozen and are read-only.\r\n *\r\n * Flags are used to enable experimental or preview features in Excalibur.\r\n */\r\nexport class Flags {\r\n  private static _FROZEN = false;\r\n  private static _FLAGS: Record<string, boolean> = {};\r\n\r\n  /**\r\n   * Freeze all flag modifications making them readonly\r\n   */\r\n  public static freeze() {\r\n    Flags._FROZEN = true;\r\n  }\r\n\r\n  /**\r\n   * Resets internal flag state, not meant to be called by users. Only used for testing.\r\n   *\r\n   * Calling this in your game is UNSUPPORTED\r\n   * @internal\r\n   */\r\n  public static _reset() {\r\n    Flags._FROZEN = false;\r\n    Flags._FLAGS = {};\r\n  }\r\n\r\n  /**\r\n   * Turn on webgl support\r\n   */\r\n  public static useWebGL() {\r\n    Flags.enable(Experiments.WebGL);\r\n  }\r\n\r\n  public static useCanvasGraphicsContext() {\r\n    Flags.enable(Legacy.Canvas);\r\n  }\r\n\r\n  /**\r\n   * @deprecated Recommended not to use legacy drawing, going away in v0.26.0\r\n   */\r\n  public static useLegacyDrawing() {\r\n    Flags.enable(Legacy.LegacyDrawing);\r\n  }\r\n\r\n  /**\r\n   * Enable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static enable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be enabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = true;\r\n  }\r\n\r\n  /**\r\n   * Disable a specific feature flag by name. **Note: can only be set before [[Engine]] constructor time**\r\n   * @param flagName\r\n   */\r\n  public static disable(flagName: string): void {\r\n    if (this._FROZEN) {\r\n      throw Error('Feature flags can only be disabled before Engine constructor time');\r\n    }\r\n    Flags._FLAGS[flagName] = false;\r\n  }\r\n\r\n  /**\r\n   * Check if a flag is enabled. If the flag is disabled or does not exist `false` is returned\r\n   * @param flagName\r\n   */\r\n  public static isEnabled(flagName: string): boolean {\r\n    return !!Flags._FLAGS[flagName];\r\n  }\r\n\r\n  /**\r\n   * Show a list of currently known flags\r\n   */\r\n  public static show(): string[] {\r\n    return Object.keys(Flags._FLAGS);\r\n  }\r\n}\r\n","/* eslint-disable no-console */\r\n/**\r\n * Logging level that Excalibur will tag\r\n */\r\nexport enum LogLevel {\r\n  Debug,\r\n  Info,\r\n  Warn,\r\n  Error,\r\n  Fatal\r\n}\r\n\r\n/**\r\n * Static singleton that represents the logging facility for Excalibur.\r\n * Excalibur comes built-in with a [[ConsoleAppender]] and [[ScreenAppender]].\r\n * Derive from [[Appender]] to create your own logging appenders.\r\n */\r\nexport class Logger {\r\n  private static _INSTANCE: Logger = null;\r\n  private _appenders: Appender[] = [];\r\n\r\n  constructor() {\r\n    if (Logger._INSTANCE) {\r\n      throw new Error('Logger is a singleton');\r\n    }\r\n    Logger._INSTANCE = this;\r\n    // Default console appender\r\n    Logger._INSTANCE.addAppender(new ConsoleAppender());\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the default logging level. Excalibur will only log\r\n   * messages if equal to or above this level. Default: [[LogLevel.Info]]\r\n   */\r\n  public defaultLevel: LogLevel = LogLevel.Info;\r\n\r\n  /**\r\n   * Gets the current static instance of Logger\r\n   */\r\n  public static getInstance(): Logger {\r\n    if (Logger._INSTANCE == null) {\r\n      Logger._INSTANCE = new Logger();\r\n    }\r\n    return Logger._INSTANCE;\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[Appender]] to the list of appenders to write to\r\n   */\r\n  public addAppender(appender: Appender): void {\r\n    this._appenders.push(appender);\r\n  }\r\n\r\n  /**\r\n   * Clears all appenders from the logger\r\n   */\r\n  public clearAppenders(): void {\r\n    this._appenders.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Logs a message at a given LogLevel\r\n   * @param level  The LogLevel`to log the message at\r\n   * @param args   An array of arguments to write to an appender\r\n   */\r\n  private _log(level: LogLevel, args: any[]): void {\r\n    if (level == null) {\r\n      level = this.defaultLevel;\r\n    }\r\n\r\n    const len = this._appenders.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (level >= this.defaultLevel) {\r\n        this._appenders[i].log(level, args);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Debug]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public debug(...args: any[]): void {\r\n    this._log(LogLevel.Debug, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Info]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public info(...args: any[]): void {\r\n    this._log(LogLevel.Info, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Warn]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public warn(...args: any[]): void {\r\n    this._log(LogLevel.Warn, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Error]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public error(...args: any[]): void {\r\n    this._log(LogLevel.Error, args);\r\n  }\r\n\r\n  /**\r\n   * Writes a log message at the [[LogLevel.Fatal]] level\r\n   * @param args  Accepts any number of arguments\r\n   */\r\n  public fatal(...args: any[]): void {\r\n    this._log(LogLevel.Fatal, args);\r\n  }\r\n}\r\n\r\n/**\r\n * Contract for any log appender (such as console/screen)\r\n */\r\nexport interface Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  log(level: LogLevel, args: any[]): void;\r\n}\r\n\r\n/**\r\n * Console appender for browsers (i.e. `console.log`)\r\n */\r\nexport class ConsoleAppender implements Appender {\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    // Check for console support\r\n    if (!console && !console.log && console.warn && console.error) {\r\n      // todo maybe do something better than nothing\r\n      return;\r\n    }\r\n\r\n    // Create a new console args array\r\n    const consoleArgs: any[] = [];\r\n    consoleArgs.unshift.apply(consoleArgs, args);\r\n    consoleArgs.unshift('[' + LogLevel[level] + '] : ');\r\n\r\n    if (level < LogLevel.Warn) {\r\n      // Call .log for Debug/Info\r\n      if (console.log.apply) {\r\n        // this is required on some older browsers that don't support apply on console.log :(\r\n        console.log.apply(console, consoleArgs);\r\n      } else {\r\n        console.log(consoleArgs.join(' '));\r\n      }\r\n    } else if (level < LogLevel.Error) {\r\n      // Call .warn for Warn\r\n      if (console.warn.apply) {\r\n        console.warn.apply(console, consoleArgs);\r\n      } else {\r\n        console.warn(consoleArgs.join(' '));\r\n      }\r\n    } else {\r\n      // Call .error for Error/Fatal\r\n      if (console.error.apply) {\r\n        console.error.apply(console, consoleArgs);\r\n      } else {\r\n        console.error(consoleArgs.join(' '));\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * On-screen (canvas) appender\r\n */\r\nexport class ScreenAppender implements Appender {\r\n  // @todo Clean this up\r\n\r\n  private _messages: string[] = [];\r\n  private _canvas: HTMLCanvasElement;\r\n  private _ctx: CanvasRenderingContext2D;\r\n\r\n  /**\r\n   * @param width   Width of the screen appender in pixels\r\n   * @param height  Height of the screen appender in pixels\r\n   */\r\n  constructor(width?: number, height?: number) {\r\n    this._canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    this._canvas.width = width || window.innerWidth;\r\n    this._canvas.height = height || window.innerHeight;\r\n    this._canvas.style.position = 'absolute';\r\n    // eslint-disable-next-line\r\n    this._ctx = <CanvasRenderingContext2D>this._canvas.getContext('2d'); // eslint-disable-line\r\n    document.body.appendChild(this._canvas);\r\n  }\r\n\r\n  /**\r\n   * Logs a message at the given [[LogLevel]]\r\n   * @param level  Level to log at\r\n   * @param args   Arguments to log\r\n   */\r\n  public log(level: LogLevel, args: any[]): void {\r\n    const message = args.join(',');\r\n\r\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\r\n\r\n    this._messages.unshift('[' + LogLevel[level] + '] : ' + message);\r\n\r\n    let pos = 10;\r\n    let opacity = 1.0;\r\n    for (let i = 0; i < this._messages.length; i++) {\r\n      this._ctx.fillStyle = 'rgba(255,255,255,' + opacity.toFixed(2) + ')';\r\n      this._ctx.fillText(this._messages[i], 200, pos);\r\n      pos += 10;\r\n      opacity = opacity > 0 ? opacity - 0.05 : 0;\r\n    }\r\n  }\r\n}\r\n","import 'core-js/es/array/sort';\r\nimport 'core-js/es/object/keys';\r\n\r\n/**\r\n * Polyfill adding function\r\n */\r\nexport function polyfill() {\r\n  /* istanbul ignore next */\r\n  if (typeof window === 'undefined') {\r\n    window = <any>{\r\n      audioContext: function () {\r\n        return;\r\n      }\r\n    };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.requestAnimationFrame) {\r\n    (<any>window).requestAnimationFrame =\r\n      (<any>window).webkitRequestAnimationFrame ||\r\n      (<any>window).mozRequestAnimationFrame ||\r\n      function (callback: Function) {\r\n        window.setInterval(callback, 1000 / 60);\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !window.cancelAnimationFrame) {\r\n    (<any>window).cancelAnimationFrame =\r\n      (<any>window).webkitCancelAnimationFrame ||\r\n      (<any>window).mozCancelAnimationFrame ||\r\n      function () {\r\n        return;\r\n      };\r\n  }\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).AudioContext) {\r\n    if ((<any>window).webkitAudioContext) {\r\n      const ctx = (<any>window).webkitAudioContext;\r\n      const replaceMe = ctx.prototype.decodeAudioData;\r\n      (<any>window).webkitAudioContext.prototype.decodeAudioData = function (arrayBuffer: ArrayBuffer) {\r\n        return new Promise((resolve, reject) => {\r\n          replaceMe.call(this, arrayBuffer, resolve, reject);\r\n        });\r\n      };\r\n    }\r\n\r\n    (<any>window).AudioContext =\r\n      (<any>window).AudioContext ||\r\n      (<any>window).webkitAudioContext ||\r\n      (<any>window).mozAudioContext ||\r\n      (<any>window).msAudioContext ||\r\n      (<any>window).oAudioContext;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  if (typeof window !== 'undefined' && !(<any>window).devicePixelRatio) {\r\n    (<any>window).devicePixelRatio = window.devicePixelRatio || 1;\r\n  }\r\n}\r\n","export type Id<T extends string> = {\r\n  type: T,\r\n  value: number\r\n};\r\n\r\n/**\r\n *\r\n */\r\nexport function createId<T extends string>(type: T, value: number): Id<T> {\r\n  return { type, value };\r\n};\r\n","/**\r\n * @module\r\n * Pseudo-Random Utility\r\n *\r\n * A pseudo-random utility to add seeded random support for help in\r\n * generating things like terrain or reproducible randomness. Uses the\r\n * [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) algorithm.\r\n */\r\n\r\n/**\r\n * 32-bit mask\r\n */\r\nconst BITMASK32: number = 0xffffffff;\r\n\r\n/**\r\n * Pseudo-random number generator following the Mersenne_Twister algorithm. Given a seed this generator will produce the same sequence\r\n * of numbers each time it is called.\r\n * See https://en.wikipedia.org/wiki/Mersenne_Twister for more details.\r\n * Uses the MT19937-32 (2002) implementation documented here http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html\r\n *\r\n * Api inspired by http://chancejs.com/# https://github.com/chancejs/chancejs\r\n */\r\nexport class Random {\r\n  // Separation point of one one word, the number of bits in the lower bitmask 0 <= r <= w-1\r\n  private _lowerMask: number = 0x7fffffff; // 31 bits same as _r\r\n  private _upperMask: number = 0x80000000; // 34 high bits\r\n\r\n  // Word size, 64 bits\r\n  private _w: number = 32;\r\n\r\n  // Degree of recurrence\r\n  private _n: number = 624;\r\n\r\n  // Middle word, an offset used in the recurrence defining the series x, 1<=m<n\r\n  private _m: number = 397;\r\n  // coefficients of teh rational normal form twist matrix\r\n  private _a: number = 0x9908b0df;\r\n\r\n  // tempering bit shifts and masks\r\n  private _u: number = 11;\r\n  private _s: number = 7;\r\n  private _b: number = 0x9d2c5680;\r\n  private _t: number = 15;\r\n  private _c: number = 0xefc60000;\r\n  private _l: number = 18;\r\n  private _f: number = 1812433253;\r\n\r\n  private _mt: number[];\r\n\r\n  private _index: number;\r\n\r\n  /**\r\n   * If no seed is specified, the Date.now() is used\r\n   */\r\n  constructor(public seed?: number) {\r\n    this._mt = new Array<number>(this._n);\r\n    // need to mask to support higher bit machines\r\n    this._mt[0] = (seed || Date.now()) >>> 0;\r\n\r\n    for (let i = 1; i < this._n; i++) {\r\n      const s = this._mt[i - 1] ^ (this._mt[i - 1] >>> (this._w - 2));\r\n      // numbers are bigger than the JS max safe int, add in 16-bit chunks to prevent IEEE rounding errors on high bits\r\n      this._mt[i] = (((this._f * ((s & 0xffff0000) >>> 16)) << 16) + this._f * (s & 0xffff) + i) >>> 0;\r\n    }\r\n    this._index = this._n;\r\n  }\r\n\r\n  /**\r\n   * Apply the twist\r\n   */\r\n  private _twist(): void {\r\n    const mag01 = [0x0, this._a];\r\n    let y = 0,\r\n      i = 0;\r\n    for (; i < this._n - this._m; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + this._m] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    for (; i < this._n - 1; i++) {\r\n      y = (this._mt[i] & this._upperMask) | (this._mt[i + 1] & this._lowerMask);\r\n      this._mt[i] = this._mt[i + (this._m - this._n)] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n    }\r\n    y = (this._mt[this._n - 1] & this._upperMask) | (this._mt[0] & this._lowerMask);\r\n    this._mt[this._n - 1] = this._mt[this._m - 1] ^ (y >>> 1) ^ (mag01[y & 0x1] & BITMASK32);\r\n\r\n    this._index = 0;\r\n  }\r\n\r\n  /**\r\n   * Return next 32 bit integer number in sequence\r\n   */\r\n  public nextInt(): number {\r\n    if (this._index >= this._n) {\r\n      this._twist();\r\n    }\r\n\r\n    let y = this._mt[this._index++];\r\n\r\n    y ^= y >>> this._u;\r\n    y ^= (y << this._s) & this._b;\r\n    y ^= (y << this._t) & this._c;\r\n    y ^= y >>> this._l;\r\n\r\n    return y >>> 0;\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point number between [0, 1)\r\n   */\r\n  public next(): number {\r\n    return this.nextInt() * (1.0 / 4294967296.0); // divided by 2^32\r\n  }\r\n\r\n  /**\r\n   * Return a random floating point in range [min, max) min is included, max is not included\r\n   */\r\n  public floating(min: number, max: number): number {\r\n    return (max - min) * this.next() + min;\r\n  }\r\n\r\n  /**\r\n   * Return a random integer in range [min, max] min is included, max is included.\r\n   * Implemented with rejection sampling, see https://medium.com/@betable/tifu-by-using-math-random-f1c308c4fd9d#.i13tdiu5a\r\n   */\r\n  public integer(min: number, max: number): number {\r\n    return Math.floor((max - min + 1) * this.next() + min);\r\n  }\r\n\r\n  /**\r\n   * Returns true or false randomly with 50/50 odds by default.\r\n   * By default the likelihood of returning a true is .5 (50%).\r\n   * @param likelihood takes values between [0, 1]\r\n   */\r\n  public bool(likelihood: number = 0.5): boolean {\r\n    return this.next() <= likelihood;\r\n  }\r\n\r\n  /**\r\n   * Returns one element from an array at random\r\n   */\r\n  public pickOne<T>(array: Array<T>): T {\r\n    return array[this.integer(0, array.length - 1)];\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original\r\n   * @param array Original array to pick from\r\n   * @param numPicks can be any positive number\r\n   * @param allowDuplicates indicates whether the returned set is allowed duplicates (it does not mean there will always be duplicates\r\n   * just that it is possible)\r\n   */\r\n  public pickSet<T>(array: Array<T>, numPicks: number, allowDuplicates: boolean = false): Array<T> {\r\n    if (allowDuplicates) {\r\n      return this._pickSetWithDuplicates(array, numPicks);\r\n    } else {\r\n      return this._pickSetWithoutDuplicates(array, numPicks);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a new array randomly picking elements in the original (not reused)\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks must be less than or equal to the number of elements in the array.\r\n   */\r\n  private _pickSetWithoutDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    if (numPicks > array.length || numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 < n <= length');\r\n    }\r\n    if (numPicks === array.length) {\r\n      return array;\r\n    }\r\n\r\n    const result: Array<T> = new Array<T>(numPicks);\r\n    let currentPick = 0;\r\n    const tempArray = array.slice(0);\r\n    while (currentPick < numPicks) {\r\n      const index = this.integer(0, tempArray.length - 1);\r\n      result[currentPick++] = tempArray[index];\r\n      tempArray.splice(index, 1);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array random picking elements from the original allowing duplicates\r\n   * @param array Array to pick elements out of\r\n   * @param numPicks can be any positive number\r\n   */\r\n  private _pickSetWithDuplicates<T>(array: Array<T>, numPicks: number): Array<T> {\r\n    // Typescript numbers are all floating point, so do we add check for int? (or floor the input?)\r\n    if (numPicks < 0) {\r\n      throw new Error('Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT');\r\n    }\r\n    const result = new Array<T>(numPicks);\r\n    for (let i = 0; i < numPicks; i++) {\r\n      result[i] = this.pickOne(array);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns a new array that has its elements shuffled. Using the Fisher/Yates method\r\n   * https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\r\n   */\r\n  public shuffle<T>(array: Array<T>): Array<T> {\r\n    const tempArray = array.slice(0);\r\n    let swap: T = null;\r\n    for (let i = 0; i < tempArray.length - 2; i++) {\r\n      const randomIndex = this.integer(i, tempArray.length - 1);\r\n      swap = tempArray[i];\r\n      tempArray[i] = tempArray[randomIndex];\r\n      tempArray[randomIndex] = swap;\r\n    }\r\n\r\n    return tempArray;\r\n  }\r\n\r\n  /**\r\n   * Generate a list of random integer numbers\r\n   * @param length the length of the final array\r\n   * @param min the minimum integer number to generate inclusive\r\n   * @param max the maximum integer number to generate inclusive\r\n   */\r\n  public range(length: number, min: number, max: number): Array<number> {\r\n    const result: Array<number> = new Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n      result[i] = this.integer(min, max);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d4 dice roll\r\n   */\r\n  public d4() {\r\n    return this.integer(1, 4);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d6 dice roll\r\n   */\r\n  public d6() {\r\n    return this.integer(1, 6);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d8 dice roll\r\n   */\r\n  public d8() {\r\n    return this.integer(1, 8);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d10 dice roll\r\n   */\r\n  public d10() {\r\n    return this.integer(1, 10);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d12 dice roll\r\n   */\r\n  public d12() {\r\n    return this.integer(1, 12);\r\n  }\r\n\r\n  /**\r\n   * Returns the result of a d20 dice roll\r\n   */\r\n  public d20() {\r\n    return this.integer(1, 20);\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\n\r\n/**\r\n * An enum that describes the sides of an axis aligned box for collision\r\n */\r\nexport enum Side {\r\n  None = 'None',\r\n  Top = 'Top',\r\n  Bottom = 'Bottom',\r\n  Left = 'Left',\r\n  Right = 'Right'\r\n}\r\n\r\nexport module Side {\r\n  /**\r\n   * Returns the opposite side from the current\r\n   */\r\n  export function getOpposite(side: Side): Side {\r\n    if (side === Side.Top) {\r\n      return Side.Bottom;\r\n    }\r\n    if (side === Side.Bottom) {\r\n      return Side.Top;\r\n    }\r\n    if (side === Side.Left) {\r\n      return Side.Right;\r\n    }\r\n    if (side === Side.Right) {\r\n      return Side.Left;\r\n    }\r\n\r\n    return Side.None;\r\n  }\r\n\r\n  /**\r\n   * Given a vector, return the Side most in that direction (via dot product)\r\n   */\r\n  export function fromDirection(direction: Vector): Side {\r\n    const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n    const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n    let max = -Number.MAX_VALUE;\r\n    let maxIndex = -1;\r\n    for (let i = 0; i < directions.length; i++) {\r\n      if (directions[i].dot(direction) > max) {\r\n        max = directions[i].dot(direction);\r\n        maxIndex = i;\r\n      }\r\n    }\r\n    return directionEnum[maxIndex];\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { Random } from '../Math/Random';\r\nimport { Side } from '../Collision/Side';\r\n\r\n/**\r\n * Two PI constant\r\n */\r\nexport const TwoPI: number = Math.PI * 2;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param deep Whether or not to do a deep clone\r\n * @param target The target object to attach properties on\r\n * @param objects The objects whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend(deep: boolean, target: any, ...objects: any[]): any;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param object2 The second object whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend<T1, T2>(target: T1, object2: T2): T1 & T2;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param object2 The second object whose properties to merge\r\n * @param object3 The third object whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend<T1, T2, T3>(target: T1, object2: T2, object3: T3): T1 & T2 & T3;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @param target The target object to attach properties on\r\n * @param objects The objects whose properties to merge\r\n * @returns Merged object with properties from other objects\r\n */\r\nexport function extend(target: any, ...objects: any[]): any;\r\n\r\n/**\r\n * Merges one or more objects into a single target object\r\n *\r\n * @returns Merged object with properties from other objects\r\n * @credit https://gomakethings.com/vanilla-javascript-version-of-jquery-extend/\r\n */\r\nexport function extend() {\r\n  const extended: { [key: string]: any } = {};\r\n  let deep = false;\r\n  let i = 0;\r\n  const length = arguments.length;\r\n\r\n  // Check if a deep merge\r\n  if (Object.prototype.toString.call(arguments[0]) === '[object Boolean]') {\r\n    deep = arguments[0];\r\n    i++;\r\n  }\r\n\r\n  // Merge the object into the extended object\r\n  const assignExists = typeof (<any>Object).assign === 'function';\r\n  let merge = null;\r\n  if (!assignExists) {\r\n    merge = function (obj: any) {\r\n      for (const prop in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, prop)) {\r\n          // If deep merge and property is an object, merge properties\r\n          if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') {\r\n            extended[prop] = extend(true, extended[prop], obj[prop]);\r\n          } else {\r\n            extended[prop] = obj[prop];\r\n          }\r\n        }\r\n      }\r\n    };\r\n  } else {\r\n    merge = (<any>Object).assign;\r\n  }\r\n\r\n  // Loop through each object and conduct a merge\r\n  for (; i < length; i++) {\r\n    const obj = arguments[i];\r\n    if (!assignExists) {\r\n      merge(obj);\r\n    } else {\r\n      merge(extended, obj);\r\n    }\r\n  }\r\n\r\n  return extended;\r\n}\r\n\r\n/**\r\n * Encode a string in base64\r\n * @deprecated This will be removed in v0.26.0\r\n */\r\nexport function base64Encode(inputStr: string) {\r\n  const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\n  let outputStr = '';\r\n  let i = 0;\r\n\r\n  while (i < inputStr.length) {\r\n    //all three \"& 0xff\" added below are there to fix a known bug\r\n    //with bytes returned by xhr.responseText\r\n    const byte1 = inputStr.charCodeAt(i++) & 0xff;\r\n    const byte2 = inputStr.charCodeAt(i++) & 0xff;\r\n    const byte3 = inputStr.charCodeAt(i++) & 0xff;\r\n\r\n    const enc1 = byte1 >> 2;\r\n    const enc2 = ((byte1 & 3) << 4) | (byte2 >> 4);\r\n\r\n    let enc3, enc4;\r\n    if (isNaN(byte2)) {\r\n      enc3 = enc4 = 64;\r\n    } else {\r\n      enc3 = ((byte2 & 15) << 2) | (byte3 >> 6);\r\n      if (isNaN(byte3)) {\r\n        enc4 = 64;\r\n      } else {\r\n        enc4 = byte3 & 63;\r\n      }\r\n    }\r\n\r\n    outputStr += b64.charAt(enc1) + b64.charAt(enc2) + b64.charAt(enc3) + b64.charAt(enc4);\r\n  }\r\n\r\n  return outputStr;\r\n}\r\n\r\n/**\r\n * Sugar that will use `nullishVal` if it's not null or undefined. Simulates the `??` operator\r\n * @param nullishVal\r\n * @param defaultVal\r\n */\r\nexport function nullish<T>(nullishVal: T | undefined | null, defaultVal: T): T {\r\n  return nullishVal !== null && nullishVal !== undefined ? nullishVal : defaultVal;\r\n}\r\n\r\n/**\r\n * Clamps a value between a min and max inclusive\r\n */\r\nexport function clamp(val: number, min: number, max: number) {\r\n  return Math.min(Math.max(min, val), max);\r\n}\r\n\r\n/**\r\n * Find a random floating point number in range\r\n */\r\nexport function randomInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.floating(min, max) : min + Math.random() * (max - min);\r\n}\r\n\r\n/**\r\n * Find a random integer in a range\r\n */\r\nexport function randomIntInRange(min: number, max: number, random: Random = new Random()): number {\r\n  return random ? random.integer(min, max) : Math.round(randomInRange(min, max));\r\n}\r\n\r\n/**\r\n * Convert an angle to be the equivalent in the range [0, 2PI]\r\n */\r\nexport function canonicalizeAngle(angle: number): number {\r\n  let tmpAngle = angle;\r\n  if (angle > TwoPI) {\r\n    while (tmpAngle > TwoPI) {\r\n      tmpAngle -= TwoPI;\r\n    }\r\n  }\r\n\r\n  if (angle < 0) {\r\n    while (tmpAngle < 0) {\r\n      tmpAngle += TwoPI;\r\n    }\r\n  }\r\n  return tmpAngle;\r\n}\r\n\r\n/**\r\n * Convert radians to degrees\r\n */\r\nexport function toDegrees(radians: number): number {\r\n  return (180 / Math.PI) * radians;\r\n}\r\n\r\n/**\r\n * Convert degrees to radians\r\n */\r\nexport function toRadians(degrees: number): number {\r\n  return (degrees / 180) * Math.PI;\r\n}\r\n\r\n/**\r\n * Find the screen position of an HTML element\r\n */\r\nexport function getPosition(el: HTMLElement): Vector {\r\n  let oLeft: number = 0,\r\n    oTop: number = 0;\r\n\r\n  const calcOffsetLeft = (parent: HTMLElement) => {\r\n    oLeft += parent.offsetLeft;\r\n\r\n    if (parent.offsetParent) {\r\n      calcOffsetLeft(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n  const calcOffsetTop = (parent: HTMLElement) => {\r\n    oTop += parent.offsetTop;\r\n    if (parent.offsetParent) {\r\n      calcOffsetTop(<HTMLElement>parent.offsetParent);\r\n    }\r\n  };\r\n\r\n  calcOffsetLeft(el);\r\n  calcOffsetTop(el);\r\n\r\n  return new Vector(oLeft, oTop);\r\n}\r\n\r\n/**\r\n * Add an item to an array list if it doesn't already exist. Returns true if added, false if not and already exists in the array.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function addItemToArray<T>(item: T, array: T[]): boolean {\r\n  if (array.indexOf(item) === -1) {\r\n    array.push(item);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Remove an item from an list\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function removeItemFromArray<T>(item: T, array: T[]): boolean {\r\n  let index = -1;\r\n  if ((index = array.indexOf(item)) > -1) {\r\n    array.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * See if an array contains something\r\n */\r\nexport function contains(array: Array<any>, obj: any): boolean {\r\n  for (let i = 0; i < array.length; i++) {\r\n    if (array[i] === obj) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Get the opposit side\r\n * TODO: Move to Side type\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport function getOppositeSide(side: Side) {\r\n  if (side === Side.Top) {\r\n    return Side.Bottom;\r\n  }\r\n  if (side === Side.Bottom) {\r\n    return Side.Top;\r\n  }\r\n  if (side === Side.Left) {\r\n    return Side.Right;\r\n  }\r\n  if (side === Side.Right) {\r\n    return Side.Left;\r\n  }\r\n\r\n  return Side.None;\r\n}\r\n\r\n/**\r\n * Returns the side in the direction of the vector supplied\r\n * @param direction Vector to check\r\n * @deprecated\r\n * TODO: Move to Side type\r\n */\r\nexport function getSideFromDirection(direction: Vector) {\r\n  const directions = [Vector.Left, Vector.Right, Vector.Up, Vector.Down];\r\n  const directionEnum = [Side.Left, Side.Right, Side.Top, Side.Bottom];\r\n\r\n  let max = -Number.MAX_VALUE;\r\n  let maxIndex = -1;\r\n  for (let i = 0; i < directions.length; i++) {\r\n    if (directions[i].dot(direction) > max) {\r\n      max = directions[i].dot(direction);\r\n      maxIndex = i;\r\n    }\r\n  }\r\n  return directionEnum[maxIndex];\r\n}\r\n\r\n/**\r\n * Excalibur's dynamically resizing collection\r\n * @deprecated Will be removed v0.26.0\r\n */\r\nexport class Collection<T> {\r\n  /**\r\n   * Default collection size\r\n   */\r\n  public static DefaultSize = 200;\r\n  private _internalArray: T[] = null;\r\n  private _endPointer: number = 0;\r\n\r\n  /**\r\n   * @param initialSize  Initial size of the internal backing array\r\n   */\r\n  constructor(initialSize: number = Collection.DefaultSize) {\r\n    this._internalArray = new Array<T>(initialSize);\r\n  }\r\n\r\n  private _resize() {\r\n    const newSize = this._internalArray.length * 2;\r\n    const newArray = new Array<T>(newSize);\r\n    const count = this.count();\r\n    for (let i = 0; i < count; i++) {\r\n      newArray[i] = this._internalArray[i];\r\n    }\r\n\r\n    delete this._internalArray;\r\n    this._internalArray = newArray;\r\n  }\r\n\r\n  /**\r\n   * Push elements to the end of the collection\r\n   */\r\n  public push(element: T): T {\r\n    if (this._endPointer === this._internalArray.length) {\r\n      this._resize();\r\n    }\r\n    return (this._internalArray[this._endPointer++] = element);\r\n  }\r\n\r\n  /**\r\n   * Removes elements from the end of the collection\r\n   */\r\n  public pop(): T {\r\n    this._endPointer = this._endPointer - 1 < 0 ? 0 : this._endPointer - 1;\r\n    return this._internalArray[this._endPointer];\r\n  }\r\n\r\n  /**\r\n   * Returns the count of the collection\r\n   */\r\n  public count(): number {\r\n    return this._endPointer;\r\n  }\r\n\r\n  /**\r\n   * Empties the collection\r\n   */\r\n  public clear() {\r\n    this._endPointer = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns the size of the internal backing array\r\n   */\r\n  public internalSize(): number {\r\n    return this._internalArray.length;\r\n  }\r\n\r\n  /**\r\n   * Returns an element at a specific index\r\n   * @param index  Index of element to retrieve\r\n   */\r\n  public elementAt(index: number): T {\r\n    if (index >= this.count()) {\r\n      //Logger.getInstance().error('Invalid parameter: ' + index);\r\n      throw new Error('Invalid index ' + index);\r\n    }\r\n    return this._internalArray[index];\r\n  }\r\n\r\n  /**\r\n   * Inserts an element at a specific index\r\n   * @param index  Index to insert the element\r\n   * @param value  Element to insert\r\n   */\r\n  public insert(index: number, value: T): T {\r\n    if (index >= this.count()) {\r\n      this._resize();\r\n    }\r\n    return (this._internalArray[index] = value);\r\n  }\r\n\r\n  /**\r\n   * Removes an element at a specific index\r\n   * @param index  Index of element to remove\r\n   */\r\n  public remove(index: number): T {\r\n    const count = this.count();\r\n    if (count === 0) {\r\n      //Logger.getInstance().error('Invalid parameter: ' + index);\r\n      throw new Error('Invalid parameter ' + index);\r\n    }\r\n    // O(n) Shift\r\n    const removed = this._internalArray[index];\r\n    for (let i = index; i < count; i++) {\r\n      this._internalArray[i] = this._internalArray[i + 1];\r\n    }\r\n    this._endPointer--;\r\n    return removed;\r\n  }\r\n\r\n  /**\r\n   * Removes an element by reference\r\n   * @param element  Element to retrieve\r\n   */\r\n  public removeElement(element: T) {\r\n    const index = this._internalArray.indexOf(element);\r\n    this.remove(index);\r\n  }\r\n\r\n  /**\r\n   * Returns a array representing the collection\r\n   */\r\n  public toArray(): T[] {\r\n    return this._internalArray.slice(0, this._endPointer);\r\n  }\r\n\r\n  /**\r\n   * Iterate over every element in the collection\r\n   * @param func  Callback to call for each element passing a reference to the element and its index, returned values are ignored\r\n   */\r\n  public forEach(func: (element: T, index: number) => any) {\r\n    let i = 0;\r\n    const count = this.count();\r\n    for (i; i < count; i++) {\r\n      func.call(this, this._internalArray[i], i);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mutate every element in the collection\r\n   * @param func  Callback to call for each element passing a reference to the element and its index, any values returned mutate\r\n   * the collection\r\n   */\r\n  public map(func: (element: T, index: number) => any) {\r\n    const count = this.count();\r\n    for (let i = 0; i < count; i++) {\r\n      this._internalArray[i] = func.call(this, this._internalArray[i], i);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Used for exhaustive checks at compile time\r\n */\r\nexport function fail(message: never): never {\r\n  throw new Error(message);\r\n}\r\n\r\n/**\r\n * Generate a range of numbers\r\n * For example: range(0, 5) -> [0, 1, 2, 3, 4, 5]\r\n * @param from inclusive\r\n * @param to inclusive\r\n */\r\nexport const range = (from: number, to: number) => Array.from(new Array(to - from + 1), (_x, i) => i + from);\r\n\r\n/**\r\n * Create a promise that resolves after a certain number of milliseconds\r\n * @param milliseconds\r\n */\r\nexport function delay(milliseconds: number): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    setTimeout(() => {\r\n      resolve();\r\n    }, milliseconds);\r\n  });\r\n}\r\n","import { Flags } from '../Flags';\r\nimport { Logger } from './Log';\r\nimport { extend } from './Util';\r\n\r\n/**\r\n * Obsolete decorator options\r\n */\r\nexport interface ObsoleteOptions {\r\n  // Optionally specify a custom message\r\n  message?: string;\r\n  // Optionally indicate that an alternate method to the obsolete one exists\r\n  alternateMethod?: string;\r\n  // Optional show stack trace, by default off\r\n  showStackTrace?: boolean;\r\n}\r\n\r\nexport const maxMessages = 5;\r\nconst obsoleteMessage: { [messageCount: string]: number } = {};\r\nexport const resetObsoleteCounter = () => {\r\n  for (const message in obsoleteMessage) {\r\n    obsoleteMessage[message] = 0;\r\n  }\r\n};\r\n\r\nconst logMessage = (message: string, options: ObsoleteOptions) => {\r\n  const suppressObsoleteMessages = Flags.isEnabled('suppress-obsolete-message');\r\n  if (obsoleteMessage[message] < maxMessages && !suppressObsoleteMessages) {\r\n    Logger.getInstance().warn(message);\r\n\r\n    // tslint:disable-next-line: no-console\r\n    if (console.trace && options.showStackTrace) {\r\n      // tslint:disable-next-line: no-console\r\n      console.trace();\r\n    }\r\n  }\r\n  obsoleteMessage[message]++;\r\n};\r\n\r\n/**\r\n * Obsolete decorator for marking Excalibur methods obsolete, you can optionally specify a custom message and/or alternate replacement\r\n * method do the deprecated one. Inspired by https://github.com/jayphelps/core-decorators.js\r\n */\r\nexport function obsolete(options?: ObsoleteOptions): any {\r\n  options = extend(\r\n    {},\r\n    {\r\n      message: 'This feature will be removed in future versions of Excalibur.',\r\n      alternateMethod: null,\r\n      showStackTrack: false\r\n    },\r\n    options\r\n  );\r\n\r\n  return function (target: any, property: string, descriptor: PropertyDescriptor): any {\r\n    if (\r\n      descriptor &&\r\n      !(typeof descriptor.value === 'function' || typeof descriptor.get === 'function' || typeof descriptor.set === 'function')\r\n    ) {\r\n      throw new SyntaxError('Only classes/functions/getters/setters can be marked as obsolete');\r\n    }\r\n    const methodSignature = `${target.name || ''}${target.name && property ? '.' : ''}${property ? property : ''}`;\r\n\r\n    const message =\r\n      `${methodSignature} is marked obsolete: ${options.message}` +\r\n      (options.alternateMethod ? ` Use ${options.alternateMethod} instead` : '');\r\n\r\n    if (!obsoleteMessage[message]) {\r\n      obsoleteMessage[message] = 0;\r\n    }\r\n\r\n    // If descriptor is null it is a class\r\n    const method = descriptor ? { ...descriptor } : target;\r\n    if (!descriptor) {\r\n      // with es2015 classes we need to change our decoration tactic\r\n      class DecoratedClass extends method {\r\n        constructor(...args: any) {\r\n          logMessage(message, options);\r\n          super(...args);\r\n        }\r\n      }\r\n      return DecoratedClass;\r\n    }\r\n\r\n    if (descriptor && descriptor.value) {\r\n      method.value = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.value.apply(this, arguments);\r\n      };\r\n      return method;\r\n    }\r\n\r\n    if (descriptor && descriptor.get) {\r\n      method.get = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.get.apply(this, arguments);\r\n      };\r\n    }\r\n\r\n    if (descriptor && descriptor.set) {\r\n      method.set = function (this: any) {\r\n        logMessage(message, options);\r\n        return descriptor.set.apply(this, arguments);\r\n      };\r\n    }\r\n    return method;\r\n  };\r\n}\r\n","import { Clonable } from '../Interfaces/Clonable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * A 2D vector on a plane.\r\n */\r\n\r\nexport class Vector implements Clonable<Vector> {\r\n  /**\r\n   * A (0, 0) vector\r\n   */\r\n  public static get Zero() {\r\n    return new Vector(0, 0);\r\n  }\r\n\r\n  /**\r\n   * A (1, 1) vector\r\n   */\r\n  public static get One() {\r\n    return new Vector(1, 1);\r\n  }\r\n\r\n  /**\r\n   * A (0.5, 0.5) vector\r\n   */\r\n  public static get Half() {\r\n    return new Vector(0.5, 0.5);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing up (0, -1)\r\n   */\r\n  public static get Up() {\r\n    return new Vector(0, -1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing down (0, 1)\r\n   */\r\n  public static get Down() {\r\n    return new Vector(0, 1);\r\n  }\r\n\r\n  /**\r\n   * A unit vector pointing left (-1, 0)\r\n   */\r\n  public static get Left() {\r\n    return new Vector(-1, 0);\r\n  }\r\n  /**\r\n   * A unit vector pointing right (1, 0)\r\n   */\r\n  public static get Right() {\r\n    return new Vector(1, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns a vector of unit length in the direction of the specified angle in Radians.\r\n   * @param angle The angle to generate the vector\r\n   */\r\n  public static fromAngle(angle: number) {\r\n    return new Vector(Math.cos(angle), Math.sin(angle));\r\n  }\r\n\r\n  /**\r\n   * Checks if vector is not null, undefined, or if any of its components are NaN or Infinity.\r\n   */\r\n  public static isValid(vec: Vector) {\r\n    if (vec === null || vec === undefined) {\r\n      return false;\r\n    }\r\n    if (isNaN(vec.x) || isNaN(vec.y)) {\r\n      return false;\r\n    }\r\n\r\n    if (vec.x === Infinity || vec.y === Infinity || vec.x === -Infinity || vec.y === -Infinity) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Calculates distance between two Vectors\r\n   * @param vec1\r\n   * @param vec2\r\n   */\r\n  public static distance(vec1: Vector, vec2: Vector) {\r\n    return Math.sqrt(Math.pow(vec1.x - vec2.x, 2) + Math.pow(vec1.y - vec2.y, 2));\r\n  }\r\n\r\n  /**\r\n   * @param x  X component of the Vector\r\n   * @param y  Y component of the Vector\r\n   */\r\n  constructor(x: number, y: number) {\r\n    this._x = x;\r\n    this._y = y;\r\n  }\r\n\r\n  protected _x = 0;\r\n  /**\r\n   * Get the x component of the vector\r\n   */\r\n  public get x(): number {\r\n    return this._x;\r\n  }\r\n\r\n  /**\r\n   * Set the x component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set x(val: number) {\r\n    this._x = val;\r\n  }\r\n\r\n  protected _y = 0;\r\n  /**\r\n   * Get the y component of the vector\r\n   */\r\n  public get y(): number {\r\n    return this._y;\r\n  }\r\n\r\n  /**\r\n   * Set the y component, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   * @warning **Be very careful setting components on shared vectors, mutating shared vectors can cause hard to find bugs**\r\n   */\r\n  public set y(val: number) {\r\n    this._y = val;\r\n  }\r\n\r\n  /**\r\n   * Sets the x and y components at once, THIS MUTATES the current vector. It is usually better to create a new vector.\r\n   *\r\n   * @warning **Be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  setTo(x: number, y: number) {\r\n    (this.x as number) = x;\r\n    (this.y as number) = y;\r\n  }\r\n\r\n  /**\r\n   * Compares this point against another and tests for equality\r\n   * @param vector The other point to compare to\r\n   * @param tolerance Amount of euclidean distance off we are willing to tolerate\r\n   */\r\n  public equals(vector: Vector, tolerance: number = 0.001): boolean {\r\n    return Math.abs(this.x - vector.x) <= tolerance && Math.abs(this.y - vector.y) <= tolerance;\r\n  }\r\n\r\n  /**\r\n   * The distance to another vector. If no other Vector is specified, this will return the [[magnitude]].\r\n   * @param v  The other vector. Leave blank to use origin vector.\r\n   */\r\n  public distance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    return Math.sqrt(Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2));\r\n  }\r\n\r\n  public squareDistance(v?: Vector): number {\r\n    if (!v) {\r\n      v = Vector.Zero;\r\n    }\r\n    return Math.pow(this.x - v.x, 2) + Math.pow(this.y - v.y, 2);\r\n  }\r\n\r\n  /**\r\n   * The magnitude (size) of the Vector\r\n   * @deprecated magnitude will be removed in favour of '.size' in version 0.25.0\r\n   */\r\n  @obsolete({ message: 'will be removed in favour of `.size` in version 0.25.0' })\r\n  public magnitude(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * The size (magnitude) of the Vector\r\n   */\r\n  public get size(): number {\r\n    return this.distance();\r\n  }\r\n\r\n  /**\r\n   * Setting the size mutates the current vector\r\n   *\r\n   * @warning Can be used to set the size of the vector, **be very careful using this, mutating vectors can cause hard to find bugs**\r\n   */\r\n  public set size(newLength: number) {\r\n    const v = this.normalize().scale(newLength);\r\n    this.setTo(v.x, v.y);\r\n  }\r\n\r\n  /**\r\n   * Normalizes a vector to have a magnitude of 1.\r\n   */\r\n  public normalize(): Vector {\r\n    const d = this.distance();\r\n    if (d > 0) {\r\n      return new Vector(this.x / d, this.y / d);\r\n    } else {\r\n      return new Vector(0, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the average (midpoint) between the current point and the specified\r\n   */\r\n  public average(vec: Vector): Vector {\r\n    return this.add(vec).scale(0.5);\r\n  }\r\n\r\n  /**\r\n   * Scales a vector's by a factor of size\r\n   * @param size  The factor to scale the magnitude by\r\n   */\r\n  public scale(scale: Vector): Vector;\r\n  public scale(size: number): Vector;\r\n  public scale(sizeOrScale: number | Vector): Vector {\r\n    if (sizeOrScale instanceof Vector) {\r\n      return new Vector(this.x * sizeOrScale.x, this.y * sizeOrScale.y);\r\n    } else {\r\n      return new Vector(this.x * sizeOrScale, this.y * sizeOrScale);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to another\r\n   * @param v The vector to add\r\n   */\r\n  public add(v: Vector): Vector {\r\n    return new Vector(this.x + v.x, this.y + v.y);\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from another, if you subtract vector `B.sub(A)` the resulting vector points from A -> B\r\n   * @param v The vector to subtract\r\n   */\r\n  public sub(v: Vector): Vector {\r\n    return new Vector(this.x - v.x, this.y - v.y);\r\n  }\r\n\r\n  /**\r\n   * Adds one vector to this one modifying the original\r\n   * @param v The vector to add\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public addEqual(v: Vector): Vector {\r\n    this.setTo(this.x + v.x, this.y + v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Subtracts a vector from this one modifying the original\r\n   * @param v The vector to subtract\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public subEqual(v: Vector): Vector {\r\n    this.setTo(this.x - v.x, this.y - v.y);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Scales this vector by a factor of size and modifies the original\r\n   * @warning Be very careful using this, mutating vectors can cause hard to find bugs\r\n   */\r\n  public scaleEqual(size: number): Vector {\r\n    this.setTo(this.x * size, this.y * size);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Performs a dot product with another vector\r\n   * @param v  The vector to dot\r\n   */\r\n  public dot(v: Vector): number {\r\n    return this.x * v.x + this.y * v.y;\r\n  }\r\n\r\n  /**\r\n   * Performs a 2D cross product with scalar. 2D cross products with a scalar return a vector.\r\n   * @param v  The scalar to cross\r\n   */\r\n  public cross(v: number): Vector;\r\n  /**\r\n   * Performs a 2D cross product with another vector. 2D cross products return a scalar value not a vector.\r\n   * @param v  The vector to cross\r\n   */\r\n  public cross(v: Vector): number;\r\n  public cross(v: any): any {\r\n    if (v instanceof Vector) {\r\n      return this.x * v.y - this.y * v.x;\r\n    } else if (typeof v === 'number') {\r\n      return new Vector(v * this.y, -v * this.x);\r\n    }\r\n  }\r\n\r\n  static cross(num: number, vec: Vector): Vector {\r\n    return new Vector(-num * vec.y, num * vec.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the perpendicular vector to this one\r\n   */\r\n  public perpendicular(): Vector {\r\n    return new Vector(this.y, -this.x);\r\n  }\r\n\r\n  /**\r\n   * Returns the normal vector to this one, same as the perpendicular of length 1\r\n   */\r\n  public normal(): Vector {\r\n    return this.perpendicular().normalize();\r\n  }\r\n\r\n  /**\r\n   * Negate the current vector\r\n   */\r\n  public negate(): Vector {\r\n    return this.scale(-1);\r\n  }\r\n\r\n  /**\r\n   * Returns the angle of this vector.\r\n   */\r\n  public toAngle(): number {\r\n    return Math.atan2(this.y, this.x);\r\n  }\r\n\r\n  /**\r\n   * Rotates the current vector around a point by a certain number of\r\n   * degrees in radians\r\n   */\r\n  public rotate(angle: number, anchor?: Vector): Vector {\r\n    if (!anchor) {\r\n      anchor = new Vector(0, 0);\r\n    }\r\n    const sinAngle = Math.sin(angle);\r\n    const cosAngle = Math.cos(angle);\r\n    const x = cosAngle * (this.x - anchor.x) - sinAngle * (this.y - anchor.y) + anchor.x;\r\n    const y = sinAngle * (this.x - anchor.x) + cosAngle * (this.y - anchor.y) + anchor.y;\r\n    return new Vector(x, y);\r\n  }\r\n\r\n  /**\r\n   * Creates new vector that has the same values as the previous.\r\n   */\r\n  public clone(): Vector {\r\n    return new Vector(this.x, this.y);\r\n  }\r\n\r\n  /**\r\n   * Returns a string representation of the vector.\r\n   */\r\n  public toString(fixed?: number): string {\r\n    if (fixed) {\r\n      return `(${this.x.toFixed(fixed)}, ${this.y.toFixed(fixed)})`;\r\n    }\r\n    return `(${this.x}, ${this.y})`;\r\n  }\r\n}\r\n\r\n/**\r\n * Shorthand for creating new Vectors - returns a new Vector instance with the\r\n * provided X and Y components.\r\n *\r\n * @param x  X component of the Vector\r\n * @param y  Y component of the Vector\r\n */\r\nexport function vec(x: number, y: number): Vector {\r\n  return new Vector(x, y);\r\n}\r\n","import { vec } from '..';\nimport { Vector } from './vector';\nimport { canonicalizeAngle } from '../Util/Util';\n\nexport enum MatrixLocations {\n  X = 12,\n  Y = 13\n}\n\nconst sign = (val: number) => {\n  if (val === 0) {\n    return 0;\n  }\n  return val < 0 ? -1 : 1;\n};\n\n// const multMatch = (a: number, b: number) => {\n//   if (sign(a) < 0 && sign(b) < 0) {\n//     return -Math.abs(a * b);\n//   }\n//   return a * b;\n// }\n\n// const epsilon = (val: number) => {\n//   if (val * val < .0001) {\n//     return 0;\n//   }\n//   return val;\n// }\n\n/**\n * Excalibur Matrix helper for 4x4 matrices\n *\n * Useful for webgl 4x4 matrices\n */\nexport class Matrix {\n  /**\n   *  4x4 matrix in column major order\n   *\n   * |         |         |          |          |\n   * | ------- | ------- | -------- |          |\n   * | data[0] | data[4] | data[8]  | data[12] |\n   * | data[1] | data[5] | data[9]  | data[13] |\n   * | data[2] | data[6] | data[10] | data[14] |\n   * | data[3] | data[7] | data[11] | data[15] |\n   *\n   */\n  public data: Float32Array = new Float32Array(16);\n\n  /**\n   * Creates an orthographic (flat non-perspective) projection\n   * https://en.wikipedia.org/wiki/Orthographic_projection\n   * @param left\n   * @param right\n   * @param bottom\n   * @param top\n   * @param near\n   * @param far\n   */\n  public static ortho(left: number, right: number, bottom: number, top: number, near: number, far: number): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 2 / (right - left);\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 2 / (top - bottom);\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = -2 / (far - near);\n    mat.data[11] = 0;\n\n    mat.data[12] = -(right + left) / (right - left);\n    mat.data[13] = -(top + bottom) / (top - bottom);\n    mat.data[14] = -(far + near) / (far - near);\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a new Matrix with the same data as the current 4x4\n   */\n  public clone(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = this.data[0];\n    mat.data[1] = this.data[1];\n    mat.data[2] = this.data[2];\n    mat.data[3] = this.data[3];\n\n    mat.data[4] = this.data[4];\n    mat.data[5] = this.data[5];\n    mat.data[6] = this.data[6];\n    mat.data[7] = this.data[7];\n\n    mat.data[8] = this.data[8];\n    mat.data[9] = this.data[9];\n    mat.data[10] = this.data[10];\n    mat.data[11] = this.data[11];\n\n    mat.data[12] = this.data[12];\n    mat.data[13] = this.data[13];\n    mat.data[14] = this.data[14];\n    mat.data[15] = this.data[15];\n    return mat;\n  }\n\n  /**\n   * Creates a new identity matrix (a matrix that when applied does nothing)\n   */\n  public static identity(): Matrix {\n    const mat = new Matrix();\n    mat.data[0] = 1;\n    mat.data[1] = 0;\n    mat.data[2] = 0;\n    mat.data[3] = 0;\n\n    mat.data[4] = 0;\n    mat.data[5] = 1;\n    mat.data[6] = 0;\n    mat.data[7] = 0;\n\n    mat.data[8] = 0;\n    mat.data[9] = 0;\n    mat.data[10] = 1;\n    mat.data[11] = 0;\n\n    mat.data[12] = 0;\n    mat.data[13] = 0;\n    mat.data[14] = 0;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new translation matrix at the specified 3d point\n   * @param x\n   * @param y\n   */\n  public static translation(x: number, y: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[12] = x;\n    mat.data[13] = y;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new scaling matrix with the specified scaling factor\n   * @param sx\n   * @param sy\n   */\n  public static scale(sx: number, sy: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = sx;\n    mat.data[5] = sy;\n    mat.data[10] = 1;\n    mat.data[15] = 1;\n    return mat;\n  }\n\n  /**\n   * Creates a brand new rotation matrix with the specified angle\n   * @param angleRadians\n   */\n  public static rotation(angleRadians: number): Matrix {\n    const mat = Matrix.identity();\n    mat.data[0] = Math.cos(angleRadians);\n    mat.data[4] = -Math.sin(angleRadians);\n    mat.data[1] = Math.sin(angleRadians);\n    mat.data[5] = Math.cos(angleRadians);\n    return mat;\n  }\n\n  /**\n   * Multiplies the current matrix by a vector and returns the resulting vector\n   * @param other\n   */\n  multv(other: [number, number]): [number, number];\n  multv(other: Vector): Vector;\n  multv(other: [number, number] | Vector): [number, number] | Vector {\n    const z = 0;\n    if (other instanceof Vector) {\n      return new Vector(\n        other.x * this.data[0] + other.y * this.data[4] + z * this.data[6] + 1 * this.data[12],\n        other.x * this.data[1] + other.y * this.data[5] + z * this.data[9] + 1 * this.data[13]\n      );\n    } else {\n      const dest: [number, number] = [\n        other[0] * this.data[0] + other[1] * this.data[4] + z * this.data[6] + 1 * this.data[12],\n\n        other[0] * this.data[1] + other[1] * this.data[5] + z * this.data[9] + 1 * this.data[13]\n      ];\n      return dest;\n    }\n  }\n\n  /**\n   * Multiplies the current matrix by another and returns the resulting matrix\n   * @param other\n   */\n  multm(other: Matrix): Matrix {\n    const dest = new Matrix();\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    const b11 = other.data[0];\n    const b21 = other.data[1];\n    const b31 = other.data[2];\n    const b41 = other.data[3];\n\n    const b12 = other.data[4];\n    const b22 = other.data[5];\n    const b32 = other.data[6];\n    const b42 = other.data[7];\n\n    const b13 = other.data[8];\n    const b23 = other.data[9];\n    const b33 = other.data[10];\n    const b43 = other.data[11];\n\n    const b14 = other.data[12];\n    const b24 = other.data[13];\n    const b34 = other.data[14];\n    const b44 = other.data[15];\n\n    dest.data[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n    dest.data[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n    dest.data[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n    dest.data[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n\n    dest.data[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n    dest.data[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n    dest.data[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n    dest.data[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n\n    dest.data[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n    dest.data[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n    dest.data[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n    dest.data[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n\n    dest.data[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n    dest.data[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n    dest.data[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n    dest.data[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n\n    const s = this.getScale();\n    dest._scaleSignX = sign(s.x) * sign(dest._scaleSignX);\n    dest._scaleSignY = sign(s.y) * sign(dest._scaleSignY);\n\n    return dest;\n  }\n\n  /**\n   * Applies translation to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  translate(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const a13 = this.data[8];\n    const a23 = this.data[9];\n    const a33 = this.data[10];\n    const a43 = this.data[11];\n\n    const a14 = this.data[12];\n    const a24 = this.data[13];\n    const a34 = this.data[14];\n    const a44 = this.data[15];\n\n    // Doesn't change z\n    const z = 0;\n    const w = 1;\n    this.data[12] = a11 * x + a12 * y + a13 * z + a14 * w;\n    this.data[13] = a21 * x + a22 * y + a23 * z + a24 * w;\n    this.data[14] = a31 * x + a32 * y + a33 * z + a34 * w;\n    this.data[15] = a41 * x + a42 * y + a43 * z + a44 * w;\n\n    return this;\n  }\n\n  public setPosition(x: number, y: number) {\n    this.data[12] = x;\n    this.data[13] = y;\n  }\n\n  public getPosition(): Vector {\n    return vec(this.data[12], this.data[13]);\n  }\n\n  /**\n   * Applies rotation to the current matrix mutating it\n   * @param angle in Radians\n   */\n  rotate(angle: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * a11 + sine * a12;\n    this.data[1] = cosine * a21 + sine * a22;\n    this.data[2] = cosine * a31 + sine * a32;\n    this.data[3] = cosine * a41 + sine * a42;\n\n    this.data[4] = cosine * a12 - sine * a11;\n    this.data[5] = cosine * a22 - sine * a21;\n    this.data[6] = cosine * a32 - sine * a31;\n    this.data[7] = cosine * a42 - sine * a41;\n\n    return this;\n  }\n\n  /**\n   * Applies scaling to the current matrix mutating it\n   * @param x\n   * @param y\n   */\n  scale(x: number, y: number) {\n    const a11 = this.data[0];\n    const a21 = this.data[1];\n    const a31 = this.data[2];\n    const a41 = this.data[3];\n\n    const a12 = this.data[4];\n    const a22 = this.data[5];\n    const a32 = this.data[6];\n    const a42 = this.data[7];\n\n    this.data[0] = a11 * x;\n    this.data[1] = a21 * x;\n    this.data[2] = a31 * x;\n    this.data[3] = a41 * x;\n\n    this.data[4] = a12 * y;\n    this.data[5] = a22 * y;\n    this.data[6] = a32 * y;\n    this.data[7] = a42 * y;\n\n    return this;\n  }\n\n  public setRotation(angle: number) {\n    const currentScale = this.getScale();\n    const sine = Math.sin(angle);\n    const cosine = Math.cos(angle);\n\n    this.data[0] = cosine * currentScale.x;\n    this.data[1] = sine * currentScale.y;\n    this.data[4] = -sine * currentScale.x;\n    this.data[5] = cosine * currentScale.y;\n  }\n\n  public getRotation(): number {\n    const angle = Math.atan2(this.data[1] / this.getScaleY(), this.data[0] / this.getScaleX());\n    return canonicalizeAngle(angle);\n  }\n\n  public getScaleX(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const xscale = vec(this.data[0], this.data[4]).size;\n    return this._scaleSignX * xscale;\n  }\n\n  public getScaleY(): number {\n    // absolute scale of the matrix (we lose sign so need to add it back)\n    const yscale = vec(this.data[1], this.data[5]).size;\n    return this._scaleSignY * yscale;\n  }\n\n  /**\n   * Get the scale of the matrix\n   */\n  public getScale(): Vector {\n    return vec(this.getScaleX(), this.getScaleY());\n  }\n\n  private _scaleSignX = 1;\n  public setScaleX(val: number) {\n    this._scaleSignX = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const xscale = vec(this.data[0] * this._scaleSignX, this.data[4] * this._scaleSignX).normalize();\n    this.data[0] = xscale.x * val;\n    this.data[4] = xscale.y * val;\n  }\n\n  private _scaleSignY = 1;\n  public setScaleY(val: number) {\n    this._scaleSignY = sign(val);\n    // negative scale acts like a 180 rotation, so flip\n    const yscale = vec(this.data[1] * this._scaleSignY, this.data[5] * this._scaleSignY).normalize();\n    this.data[1] = yscale.x * val;\n    this.data[5] = yscale.y * val;\n  }\n\n  public setScale(scale: Vector) {\n    this.setScaleX(scale.x);\n    this.setScaleY(scale.y);\n  }\n\n  /**\n   * Determinant of the upper left 2x2 matrix\n   */\n  public getBasisDeterminant() {\n    return this.data[0] * this.data[5] - this.data[1] * this.data[4];\n  }\n\n  public getAffineInverse(): Matrix {\n    // See http://negativeprobability.blogspot.com/2011/11/affine-transformations-and-their.html\n    // See https://www.mathsisfun.com/algebra/matrix-inverse.html\n    // Since we are actually only doing 2D transformations we can use this hack\n    // We don't actually use the 3rd or 4th dimension\n\n    const det = this.getBasisDeterminant();\n    const inverseDet = 1 / det; // todo zero check\n    const a = this.data[0];\n    const b = this.data[4];\n    const c = this.data[1];\n    const d = this.data[5];\n\n    const m = Matrix.identity();\n    // inverts rotation and scale\n    m.data[0] = d * inverseDet;\n    m.data[1] = -c * inverseDet;\n    m.data[4] = -b * inverseDet;\n    m.data[5] = a * inverseDet;\n\n    const tx = this.data[12];\n    const ty = this.data[13];\n    // invert translation\n    // transform translation into the matrix basis created by rot/scale\n    m.data[12] = -(tx * m.data[0] + ty * m.data[4]);\n    m.data[13] = -(tx * m.data[1] + ty * m.data[5]);\n\n    return m;\n  }\n\n  public isIdentity(): boolean {\n    return (\n      this.data[0] === 1 &&\n      this.data[1] === 0 &&\n      this.data[2] === 0 &&\n      this.data[3] === 0 &&\n      this.data[4] === 0 &&\n      this.data[5] === 1 &&\n      this.data[6] === 0 &&\n      this.data[7] === 0 &&\n      this.data[8] === 0 &&\n      this.data[9] === 0 &&\n      this.data[10] === 1 &&\n      this.data[11] === 0 &&\n      this.data[12] === 0 &&\n      this.data[13] === 0 &&\n      this.data[14] === 0 &&\n      this.data[15] === 1\n    );\n  }\n\n  public toString() {\n    return `\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`;\n  }\n}\n","import { obsolete } from './Util/Decorators';\r\n\r\n/**\r\n * Provides standard colors (e.g. [[Color.Black]])\r\n * but you can also create custom colors using RGB, HSL, or Hex. Also provides\r\n * useful color operations like [[Color.lighten]], [[Color.darken]], and more.\r\n */\r\nexport class Color {\r\n  /**\r\n   * Red channel\r\n   */\r\n  public r: number;\r\n  /**\r\n   * Green channel\r\n   */\r\n  public g: number;\r\n  /**\r\n   * Blue channel\r\n   */\r\n  public b: number;\r\n  /**\r\n   * Alpha channel (between 0 and 1)\r\n   */\r\n  public a: number;\r\n\r\n  /**\r\n   * Hue\r\n   */\r\n  public h: number;\r\n  /**\r\n   * Saturation\r\n   */\r\n  public s: number;\r\n  /**\r\n   * Lightness\r\n   */\r\n  public l: number;\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  constructor(r: number, g: number, b: number, a?: number) {\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a != null ? a : 1;\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from an r, g, b, a\r\n   *\r\n   * @param r  The red component of color (0-255)\r\n   * @param g  The green component of color (0-255)\r\n   * @param b  The blue component of color (0-255)\r\n   * @param a  The alpha component of color (0-1.0)\r\n   */\r\n  public static fromRGB(r: number, g: number, b: number, a?: number): Color {\r\n    return new Color(r, g, b, a);\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a rgb string\r\n   *\r\n   * @param string  CSS color string of the form rgba(255, 255, 255, 1) or rgb(255, 255, 255)\r\n   */\r\n  public static fromRGBString(string: string): Color {\r\n    const rgbaRegEx: RegExp = /^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+(?:\\.\\d+)?))?\\)/i;\r\n    let match = null;\r\n    if ((match = string.match(rgbaRegEx))) {\r\n      const r = parseInt(match[1], 10);\r\n      const g = parseInt(match[2], 10);\r\n      const b = parseInt(match[3], 10);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseFloat(match[4]);\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid rgb/a string: ' + string);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from a hex string\r\n   *\r\n   * @param hex  CSS color string of the form #ffffff, the alpha component is optional\r\n   */\r\n  public static fromHex(hex: string): Color {\r\n    const hexRegEx: RegExp = /^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;\r\n    let match = null;\r\n    if ((match = hex.match(hexRegEx))) {\r\n      const r = parseInt(match[1], 16);\r\n      const g = parseInt(match[2], 16);\r\n      const b = parseInt(match[3], 16);\r\n      let a = 1;\r\n      if (match[4]) {\r\n        a = parseInt(match[4], 16) / 255;\r\n      }\r\n      return new Color(r, g, b, a);\r\n    } else {\r\n      throw new Error('Invalid hex string: ' + hex);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a new instance of Color from hsla values\r\n   *\r\n   * @param h  Hue is represented [0-1]\r\n   * @param s  Saturation is represented [0-1]\r\n   * @param l  Luminance is represented [0-1]\r\n   * @param a  Alpha is represented [0-1]\r\n   */\r\n  public static fromHSL(h: number, s: number, l: number, a: number = 1.0): Color {\r\n    const temp = new HSLColor(h, s, l, a);\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Lightens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to lighten by [0-1]\r\n   */\r\n  public lighten(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l += (1 - temp.l) * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Darkens the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to darken by [0-1]\r\n   */\r\n  public darken(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.l -= temp.l * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Saturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to saturate by [0-1]\r\n   */\r\n  public saturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s += temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Desaturates the current color by a specified amount\r\n   *\r\n   * @param factor  The amount to desaturate by [0-1]\r\n   */\r\n  public desaturate(factor: number = 0.1): Color {\r\n    const temp = HSLColor.fromRGBA(this.r, this.g, this.b, this.a);\r\n    temp.s -= temp.s * factor;\r\n    return temp.toRGBA();\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public multiply(color: Color): Color {\r\n    const newR = (((color.r / 255) * this.r) / 255) * 255;\r\n    const newG = (((color.g / 255) * this.g) / 255) * 255;\r\n    const newB = (((color.b / 255) * this.b) / 255) * 255;\r\n    const newA = color.a * this.a;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  /**\r\n   * Multiplies a color by another, results in a darker color\r\n   * @param color\r\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\r\n   */\r\n  @obsolete({ message: 'Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0' })\r\n  public mulitiply(color: Color): Color {\r\n    return this.multiply(color);\r\n  }\r\n\r\n  /**\r\n   * Screens a color by another, results in a lighter color\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public screen(color: Color): Color {\r\n    const color1 = color.invert();\r\n    const color2 = color.invert();\r\n    return color1.multiply(color2).invert();\r\n  }\r\n\r\n  /**\r\n   * Inverts the current color\r\n   */\r\n  public invert(): Color {\r\n    return new Color(255 - this.r, 255 - this.g, 255 - this.b, 1.0 - this.a);\r\n  }\r\n\r\n  /**\r\n   * Averages the current color with another\r\n   *\r\n   * @param color  The other color\r\n   */\r\n  public average(color: Color): Color {\r\n    const newR = (color.r + this.r) / 2;\r\n    const newG = (color.g + this.g) / 2;\r\n    const newB = (color.b + this.b) / 2;\r\n    const newA = (color.a + this.a) / 2;\r\n    return new Color(newR, newG, newB, newA);\r\n  }\r\n\r\n  public equal(color: Color): boolean {\r\n    return this.toString() === color.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   *\r\n   * @param format Color representation, accepts: rgb, hsl, or hex\r\n   */\r\n  public toString(format: 'rgb' | 'hsl' | 'hex' = 'rgb') {\r\n    switch (format) {\r\n      case 'rgb':\r\n        return this.toRGBA();\r\n      case 'hsl':\r\n        return this.toHSLA();\r\n      case 'hex':\r\n        return this.toHex();\r\n      default:\r\n        throw new Error('Invalid Color format');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns Hex Value of a color component\r\n   * @param c color component\r\n   * @see https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\r\n   */\r\n  private _componentToHex(c: number) {\r\n    const hex = c.toString(16);\r\n    return hex.length === 1 ? '0' + hex : hex;\r\n  }\r\n\r\n  /**\r\n   * Return Hex representation of a color.\r\n   */\r\n  public toHex() {\r\n    return '#' + this._componentToHex(this.r) + this._componentToHex(this.g) + this._componentToHex(this.b);\r\n  }\r\n\r\n  /**\r\n   * Return RGBA representation of a color.\r\n   */\r\n  public toRGBA() {\r\n    const result = String(this.r.toFixed(0)) + ', ' + String(this.g.toFixed(0)) + ', ' + String(this.b.toFixed(0));\r\n    if (this.a !== undefined || this.a !== null) {\r\n      return 'rgba(' + result + ', ' + String(this.a) + ')';\r\n    }\r\n    return 'rgb(' + result + ')';\r\n  }\r\n\r\n  /**\r\n   * Return HSLA representation of a color.\r\n   */\r\n  public toHSLA() {\r\n    return HSLColor.fromRGBA(this.r, this.g, this.b, this.a).toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a CSS string representation of a color.\r\n   */\r\n  public fillStyle() {\r\n    return this.toString();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of the current color.\r\n   */\r\n  public clone(): Color {\r\n    return new Color(this.r, this.g, this.b, this.a);\r\n  }\r\n\r\n  /**\r\n   * Black (#000000)\r\n   */\r\n  public static get Black(): Color {\r\n    return Color.fromHex('#000000');\r\n  }\r\n\r\n  /**\r\n   * White (#FFFFFF)\r\n   */\r\n  public static get White(): Color {\r\n    return Color.fromHex('#FFFFFF');\r\n  }\r\n\r\n  /**\r\n   * Gray (#808080)\r\n   */\r\n  public static get Gray(): Color {\r\n    return Color.fromHex('#808080');\r\n  }\r\n\r\n  /**\r\n   * Light gray (#D3D3D3)\r\n   */\r\n  public static get LightGray(): Color {\r\n    return Color.fromHex('#D3D3D3');\r\n  }\r\n\r\n  /**\r\n   * Dark gray (#A9A9A9)\r\n   */\r\n  public static get DarkGray(): Color {\r\n    return Color.fromHex('#A9A9A9');\r\n  }\r\n\r\n  /**\r\n   * Yellow (#FFFF00)\r\n   */\r\n  public static get Yellow(): Color {\r\n    return Color.fromHex('#FFFF00');\r\n  }\r\n\r\n  /**\r\n   * Orange (#FFA500)\r\n   */\r\n  public static get Orange(): Color {\r\n    return Color.fromHex('#FFA500');\r\n  }\r\n\r\n  /**\r\n   * Red (#FF0000)\r\n   */\r\n  public static get Red(): Color {\r\n    return Color.fromHex('#FF0000');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   */\r\n  public static get Vermilion(): Color {\r\n    return Color.fromHex('#FF5B31');\r\n  }\r\n\r\n  /**\r\n   * Vermilion (#FF5B31)\r\n   * @deprecated Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0\r\n   */\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions',\r\n    alternateMethod: 'Vermilion'\r\n  })\r\n  public static get Vermillion(): Color {\r\n    return Color.Vermilion;\r\n  }\r\n\r\n  /**\r\n   * Rose (#FF007F)\r\n   */\r\n  public static get Rose(): Color {\r\n    return Color.fromHex('#FF007F');\r\n  }\r\n\r\n  /**\r\n   * Magenta (#FF00FF)\r\n   */\r\n  public static get Magenta(): Color {\r\n    return Color.fromHex('#FF00FF');\r\n  }\r\n\r\n  /**\r\n   * Violet (#7F00FF)\r\n   */\r\n  public static get Violet(): Color {\r\n    return Color.fromHex('#7F00FF');\r\n  }\r\n\r\n  /**\r\n   * Blue (#0000FF)\r\n   */\r\n  public static get Blue(): Color {\r\n    return Color.fromHex('#0000FF');\r\n  }\r\n\r\n  /**\r\n   * Azure (#007FFF)\r\n   */\r\n  public static get Azure(): Color {\r\n    return Color.fromHex('#007FFF');\r\n  }\r\n\r\n  /**\r\n   * Cyan (#00FFFF)\r\n   */\r\n  public static get Cyan(): Color {\r\n    return Color.fromHex('#00FFFF');\r\n  }\r\n\r\n  /**\r\n   * Viridian (#59978F)\r\n   */\r\n  public static get Viridian(): Color {\r\n    return Color.fromHex('#59978F');\r\n  }\r\n\r\n  /**\r\n   * Green (#00FF00)\r\n   */\r\n  public static get Green(): Color {\r\n    return Color.fromHex('#00FF00');\r\n  }\r\n\r\n  /**\r\n   * Chartreuse (#7FFF00)\r\n   */\r\n  public static get Chartreuse(): Color {\r\n    return Color.fromHex('#7FFF00');\r\n  }\r\n\r\n  /**\r\n   * Transparent (#FFFFFF00)\r\n   */\r\n  public static get Transparent(): Color {\r\n    return Color.fromHex('#FFFFFF00');\r\n  }\r\n\r\n  /**\r\n   * ExcaliburBlue (#176BAA)\r\n   */\r\n  public static get ExcaliburBlue(): Color {\r\n    return Color.fromHex('#176BAA');\r\n  }\r\n}\r\n\r\n/**\r\n * Internal HSL Color representation\r\n *\r\n * http://en.wikipedia.org/wiki/HSL_and_HSV\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n */\r\nclass HSLColor {\r\n  constructor(public h: number, public s: number, public l: number, public a: number) {}\r\n\r\n  public static hue2rgb(p: number, q: number, t: number): number {\r\n    if (t < 0) {\r\n      t += 1;\r\n    }\r\n    if (t > 1) {\r\n      t -= 1;\r\n    }\r\n    if (t < 1 / 6) {\r\n      return p + (q - p) * 6 * t;\r\n    }\r\n    if (t < 1 / 2) {\r\n      return q;\r\n    }\r\n    if (t < 2 / 3) {\r\n      return p + (q - p) * (2 / 3 - t) * 6;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public static fromRGBA(r: number, g: number, b: number, a: number): HSLColor {\r\n    r /= 255;\r\n    g /= 255;\r\n    b /= 255;\r\n    const max = Math.max(r, g, b),\r\n      min = Math.min(r, g, b);\r\n    let h, s;\r\n    const l = (max + min) / 2;\r\n\r\n    if (max === min) {\r\n      h = s = 0; // achromatic\r\n    } else {\r\n      const d = max - min;\r\n      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n      switch (max) {\r\n        case r:\r\n          h = (g - b) / d + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          h = (b - r) / d + 2;\r\n          break;\r\n        case b:\r\n          h = (r - g) / d + 4;\r\n          break;\r\n      }\r\n      h /= 6;\r\n    }\r\n\r\n    return new HSLColor(h, s, l, a);\r\n  }\r\n\r\n  public toRGBA(): Color {\r\n    let r: number, g: number, b: number;\r\n\r\n    if (this.s === 0) {\r\n      r = g = b = this.l; // achromatic\r\n    } else {\r\n      const q = this.l < 0.5 ? this.l * (1 + this.s) : this.l + this.s - this.l * this.s;\r\n      const p = 2 * this.l - q;\r\n      r = HSLColor.hue2rgb(p, q, this.h + 1 / 3);\r\n      g = HSLColor.hue2rgb(p, q, this.h);\r\n      b = HSLColor.hue2rgb(p, q, this.h - 1 / 3);\r\n    }\r\n\r\n    return new Color(r * 255, g * 255, b * 255, this.a);\r\n  }\r\n\r\n  public toString(): string {\r\n    const h = this.h.toFixed(0),\r\n      s = this.s.toFixed(0),\r\n      l = this.l.toFixed(0),\r\n      a = this.a.toFixed(0);\r\n    return `hsla(${h}, ${s}, ${l}, ${a})`;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { Ray } from '../Math/ray';\nimport { Color } from '../Color';\nimport { Side } from './Side';\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\nimport { Matrix } from '../Math/matrix';\n\nexport interface BoundingBoxOptions {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\n\n/**\n * Axis Aligned collision primitive for Excalibur.\n */\nexport class BoundingBox {\n  public top: number;\n  public right: number;\n  public bottom: number;\n  public left: number;\n\n  /**\n   * Constructor allows passing of either an object with all coordinate components,\n   * or the coordinate components passed separately.\n   * @param leftOrOptions    Either x coordinate of the left edge or an options object\n   * containing the four coordinate components.\n   * @param top     y coordinate of the top edge\n   * @param right   x coordinate of the right edge\n   * @param bottom  y coordinate of the bottom edge\n   */\n  constructor(leftOrOptions: number | BoundingBoxOptions = 0, top: number = 0, right: number = 0, bottom: number = 0) {\n    if (typeof leftOrOptions === 'object') {\n      this.left = leftOrOptions.left;\n      this.top = leftOrOptions.top;\n      this.right = leftOrOptions.right;\n      this.bottom = leftOrOptions.bottom;\n    } else if (typeof leftOrOptions === 'number') {\n      this.left = leftOrOptions;\n      this.top = top;\n      this.right = right;\n      this.bottom = bottom;\n    }\n  }\n\n  /**\n   * Given bounding box A & B, returns the side relative to A when intersection is performed.\n   * @param intersection Intersection vector between 2 bounding boxes\n   */\n  public static getSideFromIntersection(intersection: Vector): Side {\n    if (!intersection) {\n      return Side.None;\n    }\n    if (intersection) {\n      if (Math.abs(intersection.x) > Math.abs(intersection.y)) {\n        if (intersection.x < 0) {\n          return Side.Right;\n        }\n        return Side.Left;\n      } else {\n        if (intersection.y < 0) {\n          return Side.Bottom;\n        }\n        return Side.Top;\n      }\n    }\n    return Side.None;\n  }\n\n  public static fromPoints(points: Vector[]): BoundingBox {\n    let minX = Infinity;\n    let minY = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < minX) {\n        minX = points[i].x;\n      }\n      if (points[i].x > maxX) {\n        maxX = points[i].x;\n      }\n      if (points[i].y < minY) {\n        minY = points[i].y;\n      }\n      if (points[i].y > maxY) {\n        maxY = points[i].y;\n      }\n    }\n    return new BoundingBox(minX, minY, maxX, maxY);\n  }\n\n  public static fromDimension(width: number, height: number, anchor: Vector = Vector.Half, pos: Vector = Vector.Zero) {\n    return new BoundingBox(\n      -width * anchor.x + pos.x,\n      -height * anchor.y + pos.y,\n      width - width * anchor.x + pos.x,\n      height - height * anchor.y + pos.y\n    );\n  }\n\n  /**\n   * Returns the calculated width of the bounding box\n   */\n  public get width() {\n    return this.right - this.left;\n  }\n\n  /**\n   * Returns the calculated height of the bounding box\n   */\n  public get height() {\n    return this.bottom - this.top;\n  }\n\n  /**\n   * Return whether the bounding box has zero dimensions in height,width or both\n   */\n  public hasZeroDimensions() {\n    return this.width === 0 || this.height === 0;\n  }\n\n  /**\n   * Returns the center of the bounding box\n   */\n  public get center(): Vector {\n    return new Vector((this.left + this.right) / 2, (this.top + this.bottom) / 2);\n  }\n\n  public translate(pos: Vector): BoundingBox {\n    return new BoundingBox(this.left + pos.x, this.top + pos.y, this.right + pos.x, this.bottom + pos.y);\n  }\n\n  /**\n   * Rotates a bounding box by and angle and around a point, if no point is specified (0, 0) is used by default. The resulting bounding\n   * box is also axis-align. This is useful when a new axis-aligned bounding box is needed for rotated geometry.\n   */\n  public rotate(angle: number, point: Vector = Vector.Zero): BoundingBox {\n    const points = this.getPoints().map((p) => p.rotate(angle, point));\n    return BoundingBox.fromPoints(points);\n  }\n\n  public scale(scale: Vector, point: Vector = Vector.Zero): BoundingBox {\n    const shifted = this.translate(point);\n    return new BoundingBox(shifted.left * scale.x, shifted.top * scale.y, shifted.right * scale.x, shifted.bottom * scale.y);\n  }\n\n  public transform(matrix: Matrix) {\n    const points = this.getPoints().map((p) => matrix.multv(p));\n    return BoundingBox.fromPoints(points);\n  }\n\n  /**\n   * Returns the perimeter of the bounding box\n   */\n  public getPerimeter(): number {\n    const wx = this.width;\n    const wy = this.height;\n    return 2 * (wx + wy);\n  }\n\n  public getPoints(): Vector[] {\n    const results = [];\n    results.push(new Vector(this.left, this.top));\n    results.push(new Vector(this.right, this.top));\n    results.push(new Vector(this.right, this.bottom));\n    results.push(new Vector(this.left, this.bottom));\n    return results;\n  }\n\n  /**\n   * Determines whether a ray intersects with a bounding box\n   */\n  public rayCast(ray: Ray, farClipDistance = Infinity): boolean {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    return tmax >= Math.max(0, tmin) && tmin < farClipDistance;\n  }\n\n  public rayCastTime(ray: Ray, farClipDistance = Infinity): number {\n    // algorithm from https://tavianator.com/fast-branchless-raybounding-box-intersections/\n    let tmin = -Infinity;\n    let tmax = +Infinity;\n\n    const xinv = ray.dir.x === 0 ? Number.MAX_VALUE : 1 / ray.dir.x;\n    const yinv = ray.dir.y === 0 ? Number.MAX_VALUE : 1 / ray.dir.y;\n\n    const tx1 = (this.left - ray.pos.x) * xinv;\n    const tx2 = (this.right - ray.pos.x) * xinv;\n    tmin = Math.min(tx1, tx2);\n    tmax = Math.max(tx1, tx2);\n\n    const ty1 = (this.top - ray.pos.y) * yinv;\n    const ty2 = (this.bottom - ray.pos.y) * yinv;\n    tmin = Math.max(tmin, Math.min(ty1, ty2));\n    tmax = Math.min(tmax, Math.max(ty1, ty2));\n\n    if (tmax >= Math.max(0, tmin) && tmin < farClipDistance) {\n      return tmin;\n    }\n    return -1;\n  }\n\n  /**\n   * Tests whether a point is contained within the bounding box\n   * @param p  The point to test\n   */\n  public contains(p: Vector): boolean;\n\n  /**\n   * Tests whether another bounding box is totally contained in this one\n   * @param bb  The bounding box to test\n   */\n  public contains(bb: BoundingBox): boolean;\n  public contains(val: any): boolean {\n    if (val instanceof Vector) {\n      return this.left <= val.x && this.top <= val.y && this.bottom >= val.y && this.right >= val.x;\n    } else if (val instanceof BoundingBox) {\n      if (this.left < val.left && this.top < val.top && val.bottom < this.bottom && val.right < this.right) {\n        return true;\n      }\n      return false;\n    }\n    return false;\n  }\n\n  /**\n   * Combines this bounding box and another together returning a new bounding box\n   * @param other  The bounding box to combine\n   */\n  public combine(other: BoundingBox): BoundingBox {\n    const compositeBB = new BoundingBox(\n      Math.min(this.left, other.left),\n      Math.min(this.top, other.top),\n      Math.max(this.right, other.right),\n      Math.max(this.bottom, other.bottom)\n    );\n    return compositeBB;\n  }\n\n  public get dimensions(): Vector {\n    return new Vector(this.width, this.height);\n  }\n\n  /**\n   * Test wether this bounding box intersects with another returning\n   * the intersection vector that can be used to resolve the collision. If there\n   * is no intersection null is returned.\n   *\n   * @param other  Other [[BoundingBox]] to test intersection with\n   * @returns A Vector in the direction of the current BoundingBox, this <- other\n   */\n  public intersect(other: BoundingBox): Vector {\n    const totalBoundingBox = this.combine(other);\n\n    // If the total bounding box is less than or equal the sum of the 2 bounds then there is collision\n    if (\n      totalBoundingBox.width < other.width + this.width &&\n      totalBoundingBox.height < other.height + this.height &&\n      !totalBoundingBox.dimensions.equals(other.dimensions) &&\n      !totalBoundingBox.dimensions.equals(this.dimensions)\n    ) {\n      // collision\n      let overlapX = 0;\n      // right edge is between the other's left and right edge\n      /**\n       *     +-this-+\n       *     |      |\n       *     |    +-other-+\n       *     +----|-+     |\n       *          |       |\n       *          +-------+\n       *         <---\n       *          ^ overlap\n       */\n      if (this.right >= other.left && this.right <= other.right) {\n        overlapX = other.left - this.right;\n        // right edge is past the other's right edge\n        /**\n         *     +-other-+\n         *     |       |\n         *     |    +-this-+\n         *     +----|--+   |\n         *          |      |\n         *          +------+\n         *          --->\n         *          ^ overlap\n         */\n      } else {\n        overlapX = other.right - this.left;\n      }\n\n      let overlapY = 0;\n      // top edge is between the other's top and bottom edge\n      /**\n       *     +-other-+\n       *     |       |\n       *     |    +-this-+   | <- overlap\n       *     +----|--+   |   |\n       *          |      |  \\ /\n       *          +------+   '\n       */\n      if (this.top <= other.bottom && this.top >= other.top) {\n        overlapY = other.bottom - this.top;\n        // top edge is above the other top edge\n        /**\n         *     +-this-+         .\n         *     |      |        / \\\n         *     |    +-other-+   | <- overlap\n         *     +----|-+     |   |\n         *          |       |\n         *          +-------+\n         */\n      } else {\n        overlapY = other.top - this.bottom;\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n      // Case of total containment of one bounding box by another\n    } else if (totalBoundingBox.dimensions.equals(other.dimensions) || totalBoundingBox.dimensions.equals(this.dimensions)) {\n      let overlapX = 0;\n      // this is wider than the other\n      if (this.width - other.width >= 0) {\n        // This right edge is closest to the others right edge\n        if (this.right - other.right <= other.left - this.left) {\n          overlapX = other.left - this.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = other.right - this.left;\n        }\n        // other is wider than this\n      } else {\n        // This right edge is closest to the others right edge\n        if (other.right - this.right <= this.left - other.left) {\n          overlapX = this.left - other.right;\n          // This left edge is closest to the others left edge\n        } else {\n          overlapX = this.right - other.left;\n        }\n      }\n\n      let overlapY = 0;\n      // this is taller than other\n      if (this.height - other.height >= 0) {\n        // The bottom edge is closest to the others bottom edge\n        if (this.bottom - other.bottom <= other.top - this.top) {\n          overlapY = other.top - this.bottom;\n        } else {\n          overlapY = other.bottom - this.top;\n        }\n        // other is taller than this\n      } else {\n        // The bottom edge is closest to the others bottom edge\n        if (other.bottom - this.bottom <= this.top - other.top) {\n          overlapY = this.top - other.bottom;\n        } else {\n          overlapY = this.bottom - other.top;\n        }\n      }\n\n      if (Math.abs(overlapX) < Math.abs(overlapY)) {\n        return new Vector(overlapX, 0);\n      } else {\n        return new Vector(0, overlapY);\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Test whether the bounding box has intersected with another bounding box, returns the side of the current bb that intersected.\n   * @param bb The other actor to test\n   */\n  public intersectWithSide(bb: BoundingBox): Side {\n    const intersect = this.intersect(bb);\n    return BoundingBox.getSideFromIntersection(intersect);\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Yellow) {\n    ctx.strokeStyle = color.toString();\n    ctx.strokeRect(this.left, this.top, this.width, this.height);\n  }\n\n  /**\n   * Draw a debug bounding box\n   * @param ex\n   * @param color\n   */\n  public draw(ex: ExcaliburGraphicsContext, color: Color = Color.Yellow) {\n    ex.debug.drawRect(this.left, this.top, this.width, this.height, { color });\n  }\n}\n","import { Matrix } from '../../Math/matrix';\r\n\r\nexport class TransformStack {\r\n  private _transforms: Matrix[] = [];\r\n  private _currentTransform: Matrix = Matrix.identity();\r\n\r\n  public save(): void {\r\n    this._transforms.push(this._currentTransform);\r\n    this._currentTransform = this._currentTransform.clone();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentTransform = this._transforms.pop();\r\n  }\r\n\r\n  public translate(x: number, y: number): Matrix {\r\n    return this._currentTransform.translate(x, y);\r\n  }\r\n\r\n  public rotate(angle: number): Matrix {\r\n    return this._currentTransform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): Matrix {\r\n    return this._currentTransform.scale(x, y);\r\n  }\r\n\r\n  public set current(matrix: Matrix) {\r\n    this._currentTransform = matrix;\r\n  }\r\n\r\n  public get current(): Matrix {\r\n    return this._currentTransform;\r\n  }\r\n}\r\n","import { ExcaliburGraphicsContextState } from './ExcaliburGraphicsContext';\r\n\r\nexport class StateStack {\r\n  private _states: ExcaliburGraphicsContextState[] = [];\r\n  private _currentState: ExcaliburGraphicsContextState = this._getDefaultState();\r\n\r\n  private _getDefaultState() {\r\n    return {\r\n      opacity: 1\r\n    };\r\n  }\r\n\r\n  private _cloneState() {\r\n    return {\r\n      opacity: this._currentState.opacity\r\n    };\r\n  }\r\n\r\n  public save(): void {\r\n    this._states.push(this._currentState);\r\n    this._currentState = this._cloneState();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._currentState = this._states.pop();\r\n  }\r\n\r\n  public get current(): ExcaliburGraphicsContextState {\r\n    return this._currentState;\r\n  }\r\n}\r\n","export interface VertexAttributeDefinition {\r\n  name: string;\r\n  size: number;\r\n  glType: number;\r\n  normalized: boolean;\r\n  location: number;\r\n}\r\n\r\nexport interface UniformDefinition {\r\n  name: string;\r\n  location: WebGLUniformLocation;\r\n  type: string;\r\n  data: any;\r\n}\r\n\r\n/**\r\n * Create a shader program for the Excalibur WebGL Graphics Context\r\n */\r\nexport class Shader {\r\n  public program: WebGLProgram | null = null;\r\n\r\n  public uniforms: { [variableName: string]: UniformDefinition } = {};\r\n  public attributes: { [variableName: string]: VertexAttributeDefinition } = {};\r\n  public layout: VertexAttributeDefinition[] = [];\r\n\r\n  /**\r\n   * Create a shader program in excalibur\r\n   * @param _gl WebGL graphics context\r\n   * @param _vertexSource Vertex shader source as a string\r\n   * @param _fragmentSource Fragment shader source as a string\r\n   */\r\n  constructor(private _gl: WebGLRenderingContext, private _vertexSource: string, private _fragmentSource: string) {\r\n    this.compile(_gl);\r\n  }\r\n\r\n  private _createProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n    const program = gl.createProgram();\r\n    if (program === null) {\r\n      throw Error('Could not create graphics shader program');\r\n    }\r\n\r\n    // attach the shaders.\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    // link the program.\r\n    gl.linkProgram(program);\r\n\r\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not link the program: [${gl.getProgramInfoLog(program)}]`);\r\n    }\r\n\r\n    return program;\r\n  }\r\n\r\n  private _compileShader(gl: WebGLRenderingContext, source: string, type: number): WebGLShader {\r\n    const shader = gl.createShader(type);\r\n    if (shader === null) {\r\n      throw Error(`Could not build shader: [${source}]`);\r\n    }\r\n\r\n    gl.shaderSource(shader, source);\r\n    gl.compileShader(shader);\r\n\r\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n      throw Error(`Could not compile shader [${gl.getShaderInfoLog(shader)}]`);\r\n    }\r\n    return shader;\r\n  }\r\n\r\n  /**\r\n   * Compile the current shader against a webgl context\r\n   * @param gl WebGL context\r\n   */\r\n  compile(gl: WebGLRenderingContext): WebGLProgram {\r\n    const vertexShader = this._compileShader(gl, this._vertexSource, gl.VERTEX_SHADER);\r\n    const fragmentShader = this._compileShader(gl, this._fragmentSource, gl.FRAGMENT_SHADER);\r\n    const program = this._createProgram(gl, vertexShader, fragmentShader);\r\n    return (this.program = program);\r\n  }\r\n\r\n  /**\r\n   * Add a uniform [[Matrix]] to the shader\r\n   * @param name Name of the uniform in the shader source\r\n   * @param data (4x4) matrix in column major order\r\n   */\r\n  public addUniformMatrix(name: string, data: Float32Array) {\r\n    if (!data) {\r\n      throw Error(`Shader Uniform Matrix '${name}' was set to null or undefined`);\r\n    }\r\n    const gl = this._gl;\r\n    this.uniforms[name] = {\r\n      name,\r\n      type: 'matrix',\r\n      location: gl.getUniformLocation(this.program, name),\r\n      data: data\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add a uniform array of numbers to the shader\r\n   * @param name Name of the uniform in the shader source\r\n   * @param data List of numbers\r\n   */\r\n  public addUniformIntegerArray(name: string, data: number[]) {\r\n    if (!data) {\r\n      throw Error(`Shader Uniform Integery Array '${name}' was set to null or undefined`);\r\n    }\r\n    const gl = this._gl;\r\n    this.uniforms[name] = {\r\n      name,\r\n      type: 'numbers',\r\n      location: gl.getUniformLocation(this.program, name),\r\n      data: data\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add attributes in the order they appear in the VBO\r\n   * @param name Name of the attribute in the shader source\r\n   * @param size The size of the attribute in gl.Type units, for example `vec2 a_pos` would be 2 gl.FLOAT\r\n   * @param glType The gl.Type of the attribute\r\n   */\r\n  public addAttribute(name: string, size: number, glType: number, normalized = false) {\r\n    const gl = this._gl;\r\n    // TODO needs to be compiled first\r\n    const location = gl.getAttribLocation(this.program, name);\r\n    this.attributes[name] = {\r\n      name,\r\n      size,\r\n      glType,\r\n      normalized,\r\n      location\r\n    };\r\n    this.layout.push(this.attributes[name]);\r\n  }\r\n\r\n  /**\r\n   * Number of javascript floats a vertex will take up\r\n   */\r\n  public get vertexAttributeSize(): number {\r\n    let vertexSize = 0;\r\n    for (const vert of this.layout) {\r\n      vertexSize += vert.size;\r\n    }\r\n    return vertexSize;\r\n  }\r\n\r\n  /**\r\n   * Total number of bytes that the vertex will take up\r\n   */\r\n  public get totalVertexSizeBytes(): number {\r\n    let vertexSize = 0;\r\n    for (const vert of this.layout) {\r\n      let typeSize = 1;\r\n      switch (vert.glType) {\r\n        case this._gl.FLOAT: {\r\n          typeSize = 4;\r\n          break;\r\n        }\r\n        default: {\r\n          typeSize = 1;\r\n        }\r\n      }\r\n      vertexSize += typeSize * vert.size;\r\n    }\r\n\r\n    return vertexSize;\r\n  }\r\n\r\n  /**\r\n   * Get a previously defined attribute size in bytes\r\n   * @param name\r\n   */\r\n  public getAttributeSize(name: string) {\r\n    let typeSize = 1;\r\n    switch (this.attributes[name].glType) {\r\n      case this._gl.FLOAT: {\r\n        typeSize = 4;\r\n        break;\r\n      }\r\n      default: {\r\n        typeSize = 1;\r\n      }\r\n    }\r\n    return typeSize * this.attributes[name].size;\r\n  }\r\n\r\n  /**\r\n   * Sets this shader program as the current in the underlying webgl context\r\n   *\r\n   * **Must** specify all attributes and uniforms before calling this\r\n   */\r\n  public use() {\r\n    const gl = this._gl;\r\n    gl.useProgram(this.program);\r\n    let offset = 0;\r\n    for (const vert of this.layout) {\r\n      gl.vertexAttribPointer(vert.location, vert.size, vert.glType, vert.normalized, this.totalVertexSizeBytes, offset);\r\n      gl.enableVertexAttribArray(vert.location);\r\n      offset += this.getAttributeSize(vert.name);\r\n    }\r\n\r\n    for (const key in this.uniforms) {\r\n      const uniform = this.uniforms[key];\r\n      switch (uniform.type) {\r\n        case 'matrix': {\r\n          gl.uniformMatrix4fv(uniform.location, false, uniform.data);\r\n          break;\r\n        }\r\n        case 'numbers': {\r\n          gl.uniform1iv(uniform.location, uniform.data);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport class BatchCommand<T> implements Poolable {\r\n  _pool: Pool<this> = undefined;\r\n  public commands: T[] = [];\r\n  constructor(public max: number) {}\r\n\r\n  isFull() {\r\n    if (this.commands.length >= this.max) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  canAdd() {\r\n    return !this.isFull();\r\n  }\r\n\r\n  add(cmd: T) {\r\n    this.commands.push(cmd);\r\n  }\r\n\r\n  dispose() {\r\n    this.commands.length = 0;\r\n    return this;\r\n  }\r\n}\r\n","export class GraphicsDiagnostics {\r\n  public static DrawCallCount: number = 0;\r\n  public static DrawnImagesCount: number = 0;\r\n  public static clear(): void {\r\n    GraphicsDiagnostics.DrawCallCount = 0;\r\n    GraphicsDiagnostics.DrawnImagesCount = 0;\r\n  }\r\n}\r\n","import { Logger } from '..';\r\n\r\nexport interface Poolable {\r\n  /**\r\n   * Any type that is a member of a an object pool will have a reference to teh pool\r\n   * @internal\r\n   */\r\n  _pool?: Pool<this>;\r\n  dispose(): this;\r\n}\r\n\r\nexport class Pool<Type extends Poolable> {\r\n  public totalAllocations = 0;\r\n  public index = 0;\r\n  public objects: Type[] = [];\r\n  private _logger = Logger.getInstance();\r\n\r\n  constructor(\r\n    public builder: (...args: any[]) => Type,\r\n    public recycler: (instance: Type, ...args: any[]) => Type,\r\n    public maxObjects: number = 100\r\n  ) {}\r\n\r\n  /**\r\n   * Use many instances out of the in the context and return all to the pool.\r\n   *\r\n   * By returning values out of the contex they will be un-hooked from the pool and are free to be passed to consumers\r\n   * @param context\r\n   */\r\n  using(context: (pool: Pool<Type>) => Type[] | void) {\r\n    const result = context(this);\r\n    if (result) {\r\n      return this.done(...result);\r\n    }\r\n    return this.done();\r\n  }\r\n\r\n  /**\r\n   * Use a single instance out of th pool and immediately return it to the pool\r\n   * @param context\r\n   */\r\n  borrow(context: (object: Type) => void) {\r\n    const object = this.get();\r\n    context(object);\r\n    this.index--;\r\n  }\r\n\r\n  /**\r\n   * Retrieve a value from the pool, will allocate a new instance if necessary or recycle from the pool\r\n   * @param args\r\n   */\r\n  get(...args: any[]): Type {\r\n    if (this.index === this.maxObjects) {\r\n      // TODO implement hard or soft cap\r\n      this._logger.warn('Max pooled objects reached, possible memory leak? Doubling');\r\n      this.maxObjects = this.maxObjects * 2;\r\n      // throw new Error('Max pooled objects reached, possible memory leak?');\r\n    }\r\n\r\n    if (this.objects[this.index]) {\r\n      // Pool has an available object already constructed\r\n      return this.recycler(this.objects[this.index++], ...args);\r\n    } else {\r\n      // New allocation\r\n      this.totalAllocations++;\r\n      const object = (this.objects[this.index++] = this.builder(...args));\r\n      object._pool = this;\r\n      return object;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Signals we are done with the pool objects for now, Reclaims all objects in the pool.\r\n   *\r\n   * If a list of pooled objects is passed to done they are un-hooked from the pool and are free\r\n   * to be passed to consumers\r\n   * @param objects A list of object to separate from the pool\r\n   */\r\n  done(...objects: Type[]): Type[];\r\n  done(): void;\r\n  done(...objects: Type[]): Type[] | void {\r\n    // All objects in pool now considered \"free\"\r\n    this.index = 0;\r\n    for (const object of objects) {\r\n      const poolIndex = this.objects.indexOf(object);\r\n      // Build a new object to take the pool place\r\n      this.objects[poolIndex] = (this as any).builder(); // TODO problematic 0-arg only support\r\n      this.objects[poolIndex]._pool = this;\r\n      this.totalAllocations++;\r\n      // Unhook object from the pool\r\n      object._pool = undefined;\r\n    }\r\n    return objects;\r\n  }\r\n}\r\n","import { BatchCommand } from './batch';\r\nimport { Shader } from './shader';\r\n// import { Pool, Poolable } from './pool';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport interface Renderer {\r\n  render(): void;\r\n}\r\n\r\nexport interface Ctor<T> {\r\n  new (): T;\r\n}\r\n\r\nexport interface BatchRendererOptions<T extends Poolable> {\r\n  gl: WebGLRenderingContext;\r\n  /**\r\n   * Draw command constructor\r\n   */\r\n  command: Ctor<T>;\r\n  /**\r\n   * Number of vertices that are generated per draw command\r\n   */\r\n  verticesPerCommand?: number;\r\n  /**\r\n   * Maximum commands to batch before drawing\r\n   */\r\n  maxCommandsPerBatch?: number;\r\n  /**\r\n   * Override the built in command batching mechanism\r\n   */\r\n  batchFactory?: () => BatchCommand<T>;\r\n}\r\n\r\nexport abstract class BatchRenderer<T extends Poolable> implements Renderer {\r\n  priority = 0;\r\n  private _gl: WebGLRenderingContext;\r\n  private _vertices: Float32Array;\r\n  private _verticesPerCommand: number;\r\n  private _buffer: WebGLBuffer | null = null;\r\n  private _maxCommandsPerBatch: number = 2000;\r\n\r\n  public shader: Shader;\r\n\r\n  public commands: Pool<T>;\r\n  private _batchPool: Pool<BatchCommand<T>>;\r\n  private _batches: BatchCommand<T>[] = [];\r\n  constructor(options: BatchRendererOptions<T>) {\r\n    this._gl = options.gl;\r\n    const command = options.command;\r\n    this._verticesPerCommand = options?.verticesPerCommand ?? 1;\r\n    this._maxCommandsPerBatch = options?.maxCommandsPerBatch ?? this._maxCommandsPerBatch;\r\n    const batchFactory = options?.batchFactory ?? (() => new BatchCommand<T>(this._maxCommandsPerBatch));\r\n\r\n    this.commands = new Pool<T>(\r\n      () => new command(),\r\n      (c) => c.dispose(),\r\n      this._maxCommandsPerBatch\r\n    );\r\n    this._batchPool = new Pool<BatchCommand<T>>(batchFactory, (b) => b.dispose(), 100);\r\n  }\r\n\r\n  /**\r\n   * Initialize render, builds shader and initialized webgl buffers\r\n   */\r\n  public init() {\r\n    const gl = this._gl;\r\n    this.shader = this.buildShader(gl);\r\n    // Initialize VBO\r\n    // https://groups.google.com/forum/#!topic/webgl-dev-list/vMNXSNRAg8M\r\n    this._vertices = new Float32Array(this.shader.vertexAttributeSize * this._verticesPerCommand * this._maxCommandsPerBatch);\r\n    this._buffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._buffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, this._vertices, gl.DYNAMIC_DRAW);\r\n  }\r\n\r\n  public get vertexSize(): number {\r\n    return this.shader.vertexAttributeSize;\r\n  }\r\n\r\n  public addCommand(cmd: T) {\r\n    if (this._batches.length === 0) {\r\n      this._batches.push(this._batchPool.get());\r\n    }\r\n\r\n    const lastBatch = this._batches[this._batches.length - 1];\r\n    if (lastBatch.canAdd()) {\r\n      lastBatch.add(cmd);\r\n    } else {\r\n      const newBatch = this._batchPool.get();\r\n      newBatch.add(cmd);\r\n      this._batches.push(newBatch);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Construct or return the Shader to be used in this batch renderer\r\n   * @param gl\r\n   */\r\n  abstract buildShader(gl: WebGLRenderingContext): Shader;\r\n\r\n  /**\r\n   * Implement populating the vertex buffer, return the number of vertices added to the buffer\r\n   * @param vertices\r\n   * @param batch\r\n   */\r\n  abstract buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<T>): number;\r\n\r\n  /**\r\n   * Implement gl draw call to render batch. The vertextBuffer from buildBatchVertices is already bound and the data has been updated.\r\n   */\r\n  abstract renderBatch(gl: WebGLRenderingContext, batch: BatchCommand<T>, vertexCount: number): void;\r\n\r\n  /**\r\n   * Build batch geometry, submit to the gpu, and issue draw command to underlying webgl\r\n   */\r\n  public render(): void {\r\n    const gl = this._gl;\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this._buffer);\r\n    this.shader.use();\r\n    let drawCallCount = 0;\r\n    let drawnImagesCount = 0;\r\n    for (const batch of this._batches) {\r\n      // Build all geometry and ship to GPU\r\n      // interleave VBOs https://goharsha.com/lwjgl-tutorial-series/interleaving-buffer-objects/\r\n      const vertexCount = this.buildBatchVertices(this._vertices, batch);\r\n      gl.bufferSubData(gl.ARRAY_BUFFER, 0, this._vertices);\r\n\r\n      this.renderBatch(gl, batch, vertexCount);\r\n      drawnImagesCount += batch.commands.length;\r\n      drawCallCount++;\r\n    }\r\n    this.commands.done();\r\n    this._batchPool.done();\r\n    this._batches.length = 0;\r\n    GraphicsDiagnostics.DrawCallCount += drawCallCount;\r\n    GraphicsDiagnostics.DrawnImagesCount += drawnImagesCount;\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { Shader } from './shader';\r\nimport lineVertexSource from './shaders/line-vertex.glsl';\r\nimport lineFragmentSource from './shaders/line-fragment.glsl';\r\nimport { BatchRenderer } from './renderer';\r\nimport { BatchCommand } from './batch';\r\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\n\r\nexport class DrawLine implements Poolable {\r\n  _pool?: Pool<this>;\r\n  public color: Color = Color.Black;\r\n  public start: Vector = Vector.Zero;\r\n  public end: Vector = Vector.Zero;\r\n  public dispose() {\r\n    this.color.r = 0;\r\n    this.color.g = 0;\r\n    this.color.b = 0;\r\n    this.color.a = 1;\r\n    this.start.setTo(0, 0);\r\n    this.end.setTo(0, 0);\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class LineRenderer extends BatchRenderer<DrawLine> {\r\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\r\n    super({ gl, command: DrawLine, verticesPerCommand: 2 });\r\n    this.init();\r\n  }\r\n\r\n  buildShader(gl: WebGLRenderingContext) {\r\n    const shader = new Shader(gl, lineVertexSource, lineFragmentSource);\r\n\r\n    shader.addAttribute('a_position', 2, gl.FLOAT);\r\n    shader.addAttribute('a_color', 4, gl.FLOAT);\r\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\r\n    return shader;\r\n  }\r\n\r\n  addLine(start: Vector, end: Vector, color: Color) {\r\n    const cmd = this.commands.get();\r\n    cmd.start = this._contextInfo.transform.current.multv(start);\r\n    cmd.end = this._contextInfo.transform.current.multv(end);\r\n    cmd.color.r = color.r;\r\n    cmd.color.g = color.g;\r\n    cmd.color.b = color.b;\r\n    cmd.color.a = cmd.color.a * this._contextInfo.state.current.opacity;\r\n    this.addCommand(cmd);\r\n  }\r\n\r\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<DrawLine>): number {\r\n    let index = 0;\r\n    for (const command of batch.commands) {\r\n      // Start\r\n      vertexBuffer[index++] = command.start.x;\r\n      vertexBuffer[index++] = command.start.y;\r\n      vertexBuffer[index++] = command.color.r / 255;\r\n      vertexBuffer[index++] = command.color.g / 255;\r\n      vertexBuffer[index++] = command.color.b / 255;\r\n      vertexBuffer[index++] = command.color.a;\r\n\r\n      // End\r\n      vertexBuffer[index++] = command.end.x;\r\n      vertexBuffer[index++] = command.end.y;\r\n      vertexBuffer[index++] = command.color.r / 255;\r\n      vertexBuffer[index++] = command.color.g / 255;\r\n      vertexBuffer[index++] = command.color.b / 255;\r\n      vertexBuffer[index++] = command.color.a;\r\n    }\r\n    return index / this.vertexSize;\r\n  }\r\n\r\n  renderBatch(gl: WebGLRenderingContext, _batch: BatchCommand<DrawLine>, vertexCount: number) {\r\n    gl.drawArrays(gl.LINES, 0, vertexCount);\r\n  }\r\n}\r\n","export default \"attribute vec4 a_position;\\r\\nattribute vec4 a_color;\\r\\n\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * a_position;\\r\\n\\r\\n   // Passthrough the color\\r\\n   v_color = a_color;\\r\\n}\";","export default \"precision mediump float;\\r\\n\\r\\n// Color\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n  gl_FragColor = v_color;\\r\\n}\";","import { Matrix } from '../../Math/matrix';\r\nimport { BoundingBox } from '../../Collision/Index';\r\nimport { Color } from '../../Color';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../../Math/vector';\r\n\r\nexport enum DrawCommandType {\r\n  Image = 'image',\r\n  Line = 'line',\r\n  Rectangle = 'rectangle',\r\n  Circle = 'circle'\r\n}\r\n\r\nexport class DrawImageCommand implements Poolable {\r\n  _pool: Pool<this> = undefined;\r\n\r\n  public snapToPixel: boolean = true;\r\n  public image: HTMLImageSource;\r\n  public color: Color;\r\n  public type = DrawCommandType.Image;\r\n  public opacity: number = 1;\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n  public dest: [number, number] = [0, 0]; // x, y\r\n  public view: [number, number, number, number] = [0, 0, 0, 0]; // sx, sy, sw, sh\r\n  private _geom: [number, number][] = [\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0],\r\n    [0, 0]\r\n  ];\r\n  constructor();\r\n  constructor(image: HTMLImageSource, x: number, y: number);\r\n  constructor(image: HTMLImageSource, x: number, y: number, width?: number, height?: number);\r\n  constructor(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  );\r\n  constructor(\r\n    image?: HTMLImageSource,\r\n    sx?: number,\r\n    sy?: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    this.init(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n  }\r\n\r\n  public init(\r\n    image?: HTMLImageSource,\r\n    sx?: number,\r\n    sy?: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    this.type = DrawCommandType.Image;\r\n    this.image = image;\r\n    this.width = image?.width || swidth || 0;\r\n    this.height = image?.height || sheight || 0;\r\n    this.view = [0, 0, swidth ?? image?.width, sheight ?? image?.height];\r\n    this.dest = [sx, sy];\r\n    // If destination is specified, update view and dest\r\n    if (dx !== undefined && dy !== undefined && dwidth !== undefined && dheight !== undefined) {\r\n      this.view = [sx, sy, swidth ?? image?.width, sheight ?? image?.height];\r\n      this.dest = [dx, dy];\r\n      this.width = dwidth;\r\n      this.height = dheight;\r\n    }\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [this.dest[0], this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1] + this.height];\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initRect(color: Color, start: Vector, width: number, height: number) {\r\n    this.type = DrawCommandType.Rectangle;\r\n    this.color = color;\r\n    this.width = width;\r\n    this.height = height;\r\n    let index = 0;\r\n    this._geom[index++] = [start.x, start.y];\r\n    this._geom[index++] = [start.x, start.y + this.height];\r\n    this._geom[index++] = [start.x + this.width, start.y];\r\n    this._geom[index++] = [start.x + this.width, start.y];\r\n    this._geom[index++] = [start.x, start.y + this.height];\r\n    this._geom[index++] = [start.x + this.width, start.y + this.height];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initLine(color: Color, start: Vector, end: Vector, thickness: number) {\r\n    this.type = DrawCommandType.Line;\r\n    this.color = color;\r\n    const dir = end.sub(start).normalize();\r\n    const normal = dir.perpendicular();\r\n    const halfThick = thickness / 2;\r\n    const startTop = normal.scale(halfThick).add(start);\r\n    const startBottom = normal.scale(-halfThick).add(start);\r\n    const endTop = normal.scale(halfThick).add(end);\r\n    const endBottom = normal.scale(-halfThick).add(end);\r\n\r\n    /**\r\n     *    +---------------------^----------------------+\r\n     *    |                     | (normal)             |\r\n     *   (startx, starty)------------------>(endx, endy)\r\n     *    |                                            |\r\n     *    + -------------------------------------------+\r\n     */\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [startTop.x, startTop.y];\r\n    this._geom[index++] = [endTop.x, endTop.y];\r\n    this._geom[index++] = [startBottom.x, startBottom.y];\r\n    this._geom[index++] = [startBottom.x, startBottom.y];\r\n    this._geom[index++] = [endTop.x, endTop.y];\r\n    this._geom[index++] = [endBottom.x, endBottom.y];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public initCircle(pos: Vector, radius: number, color: Color) {\r\n    this.type = DrawCommandType.Circle;\r\n    this.color = color;\r\n    const topLeft = pos.add(vec(-radius, -radius));\r\n    const topRight = pos.add(vec(radius, -radius));\r\n    const bottomRight = pos.add(vec(radius, radius));\r\n    const bottomLeft = pos.add(vec(-radius, radius));\r\n    let index = 0;\r\n    this._geom[index++] = [topLeft.x, topLeft.y];\r\n    this._geom[index++] = [topRight.x, topRight.y];\r\n    this._geom[index++] = [bottomLeft.x, bottomLeft.y];\r\n    this._geom[index++] = [bottomLeft.x, bottomLeft.y];\r\n    this._geom[index++] = [topRight.x, topRight.y];\r\n    this._geom[index++] = [bottomRight.x, bottomRight.y];\r\n\r\n    if (this.snapToPixel) {\r\n      for (const point of this._geom) {\r\n        point[0] = ~~point[0];\r\n        point[1] = ~~point[1];\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  public dispose() {\r\n    this.image = null;\r\n    this.width = 0;\r\n    this.height = 0;\r\n    this.view = [0, 0, 0, 0];\r\n    this.dest = [0, 0];\r\n\r\n    let index = 0;\r\n    this._geom[index++] = [this.dest[0], this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1]];\r\n    this._geom[index++] = [this.dest[0], this.dest[1] + this.height];\r\n    this._geom[index++] = [this.dest[0] + this.width, this.dest[1] + this.height];\r\n    return this;\r\n  }\r\n\r\n  // todo weird\r\n  applyTransform(transform: Matrix, opacity: number): void {\r\n    if (transform) {\r\n      for (let i = 0; i < this._geom.length; i++) {\r\n        this._geom[i] = transform.multv(this._geom[i]);\r\n        if (this.snapToPixel) {\r\n          this._geom[i] = [~~this._geom[i][0], ~~this._geom[i][1]];\r\n        }\r\n      }\r\n    }\r\n    this.opacity = opacity;\r\n  }\r\n\r\n  public get geometry() {\r\n    return this._geom;\r\n  }\r\n}\r\n\r\nexport class DrawRectCommand {\r\n  public dest: [number, number] = [0, 0];\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n  constructor(x: number, y: number, width: number, height: number) {\r\n    this.dest = [x, y];\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n}\r\n\r\nexport class DrawDebugRectCommand {\r\n  constructor(public bounds: BoundingBox, public color: Color) {}\r\n}\r\n","/**\r\n * Checks if the current number is a power of two\r\n */\r\nexport function isPowerOfTwo(x: number): boolean {\r\n  return (x & (x - 1)) === 0;\r\n}\r\n\r\n/**\r\n * Returns the next highest power of two\r\n */\r\nexport function nextHighestPowerOfTwo(x: number): number {\r\n  --x;\r\n  for (let i = 1; i < 32; i <<= 1) {\r\n    x = x | (x >> i);\r\n  }\r\n  return x + 1;\r\n}\r\n\r\n/**\r\n * Returns the input number if a power of two, otherwise the next highest power of two\r\n */\r\nexport function ensurePowerOfTwo(x: number): number {\r\n  if (!isPowerOfTwo(x)) {\r\n    return nextHighestPowerOfTwo(x);\r\n  }\r\n  return x;\r\n}\r\n","import { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { ensurePowerOfTwo, isPowerOfTwo } from './webgl-util';\r\n\r\n/**\r\n * Manages loading image sources into webgl textures, a unique id is associated with all sources\r\n */\r\nexport class TextureLoader {\r\n  private static _POT_CANVAS = document.createElement('canvas');\r\n  private static _POT_CTX = TextureLoader._POT_CANVAS.getContext('2d');\r\n\r\n  private static _GL: WebGLRenderingContext;\r\n\r\n  private static _TEXTURE_MAP = new Map<HTMLImageSource, WebGLTexture>();\r\n\r\n  public static registerContext(context: WebGLRenderingContext): void {\r\n    TextureLoader._GL = context;\r\n  }\r\n\r\n  /**\r\n   * Get the WebGL Texture from a source image\r\n   * @param image\r\n   */\r\n  public static get(image: HTMLImageSource): WebGLTexture {\r\n    return TextureLoader._TEXTURE_MAP.get(image);\r\n  }\r\n\r\n  /**\r\n   * Returns whether a source image has been loaded as a texture\r\n   * @param image\r\n   */\r\n  public static has(image: HTMLImageSource): boolean {\r\n    return TextureLoader._TEXTURE_MAP.has(image);\r\n  }\r\n\r\n  /**\r\n   * Loads a graphic into webgl and returns it's texture info, a webgl context must be previously registered\r\n   * @param image Source graphic\r\n   * @param forceUpdate Optionally force a texture to be reloaded, useful if the source graphic has changed\r\n   */\r\n  public static load(image: HTMLImageSource, forceUpdate = false): WebGLTexture {\r\n    // Ignore loading if webgl is not registered\r\n    const gl = TextureLoader._GL;\r\n    if (!gl) {\r\n      return null;\r\n    }\r\n\r\n    let tex: WebGLTexture = null;\r\n    // If reuse the texture if it's from the same source\r\n    if (TextureLoader.has(image)) {\r\n      tex = TextureLoader.get(image);\r\n    }\r\n\r\n    // Update existing webgl texture and return early\r\n    if (tex) {\r\n      if (forceUpdate) {\r\n        gl.bindTexture(gl.TEXTURE_2D, tex);\r\n        const source = TextureLoader.toPowerOfTwoImage(image);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n      }\r\n      return tex;\r\n    }\r\n\r\n    // No texture exists create a new one\r\n    tex = gl.createTexture();\r\n    const source = TextureLoader.toPowerOfTwoImage(image);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tex);\r\n\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n    // NEAREST for pixels\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\r\n\r\n    TextureLoader._TEXTURE_MAP.set(image, tex);\r\n    return tex;\r\n  }\r\n\r\n  /**\r\n   * Converts source images into power of two images, WebGL only supports POT images\r\n   * https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support\r\n   * @param image\r\n   */\r\n  public static toPowerOfTwoImage(image: HTMLImageSource): HTMLImageSource {\r\n    const potCanvas = TextureLoader._POT_CANVAS;\r\n    const potCtx = TextureLoader._POT_CTX;\r\n    if (!isPowerOfTwo(image.width) || !isPowerOfTwo(image.height)) {\r\n      // Scale up the texture to the next highest power of two dimensions.\r\n\r\n      potCanvas.width = ensurePowerOfTwo(image.width);\r\n      potCanvas.height = ensurePowerOfTwo(image.height);\r\n      potCtx.imageSmoothingEnabled = false;\r\n      potCtx.clearRect(0, 0, potCanvas.width, potCanvas.height);\r\n      potCtx.drawImage(image, 0, 0, image.width, image.height);\r\n      image = potCanvas;\r\n    }\r\n    return image;\r\n  }\r\n}\r\n","import { Shader } from './shader';\r\nimport imageVertexSource from './shaders/image-vertex.glsl';\r\nimport imageFragmentSource from './shaders/image-fragment.glsl';\r\nimport { BatchCommand } from './batch';\r\nimport { DrawCommandType, DrawImageCommand } from './draw-image-command';\r\nimport { Graphic } from '../Graphic';\r\nimport { ensurePowerOfTwo } from './webgl-util';\r\nimport { BatchRenderer } from './renderer';\r\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\r\nimport { TextureLoader } from './texture-loader';\r\nimport { HTMLImageSource } from './ExcaliburGraphicsContext';\r\nimport { Color } from '../../Color';\r\nimport { Vector } from '../..';\r\n\r\nexport class BatchImage extends BatchCommand<DrawImageCommand> {\r\n  public textures: WebGLTexture[] = [];\r\n  public commands: DrawImageCommand[] = [];\r\n  private _graphicMap: { [id: string]: Graphic } = {};\r\n\r\n  constructor(public maxDraws: number, public maxTextures: number) {\r\n    super(maxDraws);\r\n  }\r\n\r\n  isFull() {\r\n    if (this.commands.length >= this.maxDraws) {\r\n      return true;\r\n    }\r\n    if (this.textures.length >= this.maxTextures) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  canAdd() {\r\n    if (this.commands.length >= this.maxDraws) {\r\n      return false;\r\n    }\r\n\r\n    if (this.textures.length < this.maxTextures) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  private _isCommandFull() {\r\n    return this.commands.length >= this.maxDraws;\r\n  }\r\n\r\n  private _isTextureFull() {\r\n    return this.textures.length >= this.maxTextures;\r\n  }\r\n\r\n  private _wouldAddTexture(command: DrawImageCommand) {\r\n    return !this._graphicMap[command.image.id];\r\n  }\r\n\r\n  maybeAdd(command: DrawImageCommand): boolean {\r\n    if ((this._isCommandFull() || this._isTextureFull()) && this._wouldAddTexture(command)) {\r\n      return false;\r\n    }\r\n\r\n    this.add(command);\r\n    return true;\r\n  }\r\n\r\n  add(command: DrawImageCommand) {\r\n    if (command.type === DrawCommandType.Image) {\r\n      const texture = TextureLoader.load(command.image);\r\n      if (this.textures.indexOf(texture) === -1) {\r\n        this.textures.push(texture);\r\n      }\r\n    }\r\n\r\n    this.commands.push(command);\r\n  }\r\n\r\n  bindTextures(gl: WebGLRenderingContext) {\r\n    // Bind textures in the correct order\r\n    for (let i = 0; i < this.maxTextures; i++) {\r\n      gl.activeTexture(gl.TEXTURE0 + i);\r\n      gl.bindTexture(gl.TEXTURE_2D, this.textures[i] || this.textures[0]);\r\n    }\r\n  }\r\n\r\n  getBatchTextureId(command: DrawImageCommand) {\r\n    if (command.image) {\r\n      return this.textures.indexOf(TextureLoader.get(command.image));\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  dispose() {\r\n    this.clear();\r\n    return this;\r\n  }\r\n\r\n  clear() {\r\n    this.commands.length = 0;\r\n    this.textures.length = 0;\r\n    this._graphicMap = {};\r\n  }\r\n}\r\n\r\nexport class ImageRenderer extends BatchRenderer<DrawImageCommand> {\r\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\r\n    super({\r\n      gl,\r\n      command: DrawImageCommand,\r\n      // 6 verts per quad\r\n      verticesPerCommand: 6,\r\n      maxCommandsPerBatch: 2000,\r\n      batchFactory: () => new BatchImage(2000, gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS))\r\n    });\r\n    TextureLoader.registerContext(gl);\r\n    this.init();\r\n  }\r\n\r\n  buildShader(gl: WebGLRenderingContext): Shader {\r\n    // Initialilze default batch rendering shader\r\n    const maxGPUTextures = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n    const shader = new Shader(gl, imageVertexSource, this._transformFragmentSource(imageFragmentSource, maxGPUTextures));\r\n    shader.addAttribute('a_position', 3, gl.FLOAT);\r\n    shader.addAttribute('a_texcoord', 2, gl.FLOAT);\r\n    shader.addAttribute('a_textureIndex', 1, gl.FLOAT);\r\n    shader.addAttribute('a_opacity', 1, gl.FLOAT);\r\n    shader.addAttribute('a_color', 4, gl.FLOAT);\r\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\r\n    // Initialize texture slots to [0, 1, 2, 3, 4, .... maxGPUTextures]\r\n    shader.addUniformIntegerArray(\r\n      'u_textures',\r\n      [...Array(maxGPUTextures)].map((_, i) => i)\r\n    );\r\n    return shader;\r\n  }\r\n\r\n  private _transformFragmentSource(source: string, maxTextures: number): string {\r\n    let newSource = source.replace('%%count%%', maxTextures.toString());\r\n    let texturePickerBuilder = '';\r\n    for (let i = 0; i < maxTextures; i++) {\r\n      if (i === 0) {\r\n        texturePickerBuilder += `if (v_textureIndex <= ${i}.5) {\\n`;\r\n      } else {\r\n        texturePickerBuilder += `   else if (v_textureIndex <= ${i}.5) {\\n`;\r\n      }\r\n      texturePickerBuilder += `      color = texture2D(u_textures[${i}], v_texcoord);\\n`;\r\n      texturePickerBuilder += `   }\\n`;\r\n    }\r\n    newSource = newSource.replace('%%texture_picker%%', texturePickerBuilder);\r\n    return newSource;\r\n  }\r\n\r\n  public addCircle(pos: Vector, radius: number, color: Color) {\r\n    const command = this.commands.get().initCircle(pos, radius, color);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addRectangle(color: Color, pos: Vector, width: number, height: number) {\r\n    const command = this.commands.get().initRect(color, pos, width, height);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addLine(color: Color, start: Vector, end: Vector, thickness = 1) {\r\n    const command = this.commands.get().initLine(color, start, end, thickness);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public addImage(\r\n    graphic: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ) {\r\n    const command = this.commands.get().init(graphic, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n    command.applyTransform(this._contextInfo.transform.current, this._contextInfo.state.current.opacity);\r\n    this.addCommand(command);\r\n  }\r\n\r\n  public renderBatch(gl: WebGLRenderingContext, batch: BatchImage, vertexCount: number) {\r\n    // Bind textures in the correct order\r\n    batch.bindTextures(gl);\r\n    // draw the quads\r\n    gl.drawArrays(gl.TRIANGLES, 0, vertexCount);\r\n  }\r\n\r\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchImage): number {\r\n    let vertIndex = 0;\r\n    let sx: number = 0;\r\n    let sy: number = 0;\r\n    let sw: number = 0;\r\n    let sh: number = 0;\r\n    let potWidth: number = 1;\r\n    let potHeight: number = 1;\r\n    let textureId = 0;\r\n    let commandColor = Color.Transparent;\r\n    for (const command of batch.commands) {\r\n      sx = command.view[0];\r\n      sy = command.view[1];\r\n      sw = command.view[2];\r\n      sh = command.view[3];\r\n\r\n      potWidth = ensurePowerOfTwo(command.image?.width || command.width);\r\n      potHeight = ensurePowerOfTwo(command.image?.height || command.height);\r\n\r\n      textureId = batch.getBatchTextureId(command);\r\n      if (command.type === DrawCommandType.Line || command.type === DrawCommandType.Rectangle) {\r\n        textureId = -1; // sentinel for no image rect\r\n        commandColor = command.color;\r\n      }\r\n      if (command.type === DrawCommandType.Circle) {\r\n        textureId = -2; // sentinel for circle\r\n        commandColor = command.color;\r\n      }\r\n\r\n      // potential optimization when divding by 2 (bitshift)\r\n      // Modifying the images to poweroftwo images warp the UV coordinates\r\n      let uvx0 = sx / potWidth;\r\n      let uvy0 = sy / potHeight;\r\n      let uvx1 = (sx + sw) / potWidth;\r\n      let uvy1 = (sy + sh) / potHeight;\r\n      if (textureId === -2) {\r\n        uvx0 = 0;\r\n        uvy0 = 0;\r\n        uvx1 = 1;\r\n        uvy1 = 1;\r\n      }\r\n\r\n      // Quad update\r\n      // (0, 0, z) z-index doesn't work in batch rendering between batches\r\n      vertexBuffer[vertIndex++] = command.geometry[0][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[0][1]; //y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy0; // 0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (0, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[1][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[1][1]; // y + 1 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 0)\r\n      vertexBuffer[vertIndex++] = command.geometry[2][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[2][1]; // y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; //1;\r\n      vertexBuffer[vertIndex++] = uvy0; //0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 0)\r\n      vertexBuffer[vertIndex++] = command.geometry[3][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[3][1]; // y + 0 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; //1;\r\n      vertexBuffer[vertIndex++] = uvy0; //0;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (0, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[4][0]; // x + 0 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[4][1]; // y + 1 * height\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx0; // 0;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n\r\n      // (1, 1)\r\n      vertexBuffer[vertIndex++] = command.geometry[5][0]; // x + 1 * width;\r\n      vertexBuffer[vertIndex++] = command.geometry[5][1]; // y + 1 * height;\r\n      vertexBuffer[vertIndex++] = 0;\r\n\r\n      // UV coords\r\n      vertexBuffer[vertIndex++] = uvx1; // 1;\r\n      vertexBuffer[vertIndex++] = uvy1; // 1;\r\n      // texture id\r\n      vertexBuffer[vertIndex++] = textureId;\r\n      // opacity\r\n      vertexBuffer[vertIndex++] = command.opacity;\r\n      // color\r\n      vertexBuffer[vertIndex++] = commandColor.r / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.g / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.b / 255;\r\n      vertexBuffer[vertIndex++] = commandColor.a;\r\n    }\r\n\r\n    return vertIndex / this.vertexSize;\r\n  }\r\n}\r\n","export default \"attribute vec4 a_position;\\r\\n\\r\\n// Opacity \\r\\nattribute float a_opacity;\\r\\nvarying float v_opacity;\\r\\n\\r\\nattribute vec4 a_color;\\r\\nvarying vec4 v_color;\\r\\n\\r\\n// UV coordinate\\r\\nattribute vec2 a_texcoord;\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// Texture number\\r\\nattribute lowp float a_textureIndex;\\r\\nvarying lowp float v_textureIndex;\\r\\n\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\n\\r\\nvoid main() {\\r\\n   // Set the vertex position using the ortho transform matrix\\r\\n   gl_Position = u_matrix * a_position;\\r\\n\\r\\n   // Pass through the Opacity to the fragment shader\\r\\n   v_opacity = a_opacity;\\r\\n   // Pass through the UV coord to the fragment shader\\r\\n   v_texcoord = a_texcoord;\\r\\n   // Pass through the texture number to the fragment shader\\r\\n   v_textureIndex = a_textureIndex;\\r\\n   // Pass through the color to the fragment shader\\r\\n   v_color = a_color;\\r\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\n#endif\\r\\nprecision mediump float;\\r\\n\\r\\n// UV coord\\r\\nvarying vec2 v_texcoord;\\r\\n\\r\\n// Texture index\\r\\nvarying lowp float v_textureIndex;\\r\\n\\r\\n// Color coord to blend with image\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\n// Opacity\\r\\nvarying float v_opacity;\\r\\n\\r\\nuniform sampler2D u_textures[%%count%%];\\r\\n\\r\\nfloat circle(in vec2 st, in float radius) {\\r\\n  vec2 dist = st - vec2(0.5);\\r\\n  float r = dot(dist, dist) * 4.0;\\r\\n  float delta = fwidth(r);\\r\\n  return 1.0 - smoothstep(radius - delta, radius + delta, r);\\r\\n}\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n   // In order to support the most efficient sprite batching, we have multiple\\r\\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\\r\\n   // that do not apply to a particular sprite.\\r\\n\\r\\n   vec4 color;\\r\\n   // -1 If there is no texture to sample we are drawing a solid geometry (rectangles)\\r\\n   if (v_textureIndex == -1.0) {\\r\\n     color = v_color;\\r\\n     color.w = color.w * v_opacity;\\r\\n   // -2 If there is no texture we are drawing a circle\\r\\n   } else if (v_textureIndex == -2.0) {\\r\\n     color = v_color;\\r\\n     color.a = color.a * circle(v_texcoord, .95);\\r\\n   } else {\\r\\n     // GLSL is templated out to pick the right texture and set the vec4 color\\r\\n      %%texture_picker%%\\r\\n   }\\r\\n   color.w = color.w * v_opacity;\\r\\n   gl_FragColor = color;\\r\\n}\";","import { Shader } from './shader';\r\nimport pointVertexSource from './shaders/point-vertex.glsl';\r\nimport pointFragmentSource from './shaders/point-fragment.glsl';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { BatchRenderer } from './renderer';\r\nimport { BatchCommand } from './batch';\r\nimport { WebGLGraphicsContextInfo } from './ExcaliburGraphicsContextWebGL';\r\nimport { Pool, Poolable } from '../../Util/Pool';\r\n// import { Random } from '../../Math/Index';\r\n\r\nexport class DrawPoint implements Poolable {\r\n  _pool?: Pool<this>;\r\n  public point: Vector = Vector.Zero;\r\n  public color: Color = Color.Black;\r\n  public size: number = 1;\r\n  public dispose() {\r\n    this.point.setTo(0, 0);\r\n    this.color.r = 0;\r\n    this.color.g = 0;\r\n    this.color.b = 0;\r\n    this.color.a = 1;\r\n    this.size = 1;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport class PointRenderer extends BatchRenderer<DrawPoint> {\r\n  constructor(gl: WebGLRenderingContext, private _contextInfo: WebGLGraphicsContextInfo) {\r\n    super({ gl, command: DrawPoint, verticesPerCommand: 1 });\r\n    this.init();\r\n  }\r\n\r\n  buildShader(gl: WebGLRenderingContext): Shader {\r\n    gl.getExtension('OES_standard_derivatives');\r\n    const shader = new Shader(gl, pointVertexSource, pointFragmentSource);\r\n    shader.addAttribute('a_position', 2, gl.FLOAT);\r\n    shader.addAttribute('a_color', 4, gl.FLOAT);\r\n    shader.addAttribute('a_size', 1, gl.FLOAT);\r\n    shader.addUniformMatrix('u_matrix', this._contextInfo.matrix.data);\r\n    return shader;\r\n  }\r\n\r\n  addPoint(point: Vector, color: Color, size: number) {\r\n    const cmd = this.commands.get();\r\n    cmd.point = this._contextInfo.transform.current.multv(point);\r\n    cmd.color.r = color.r;\r\n    cmd.color.g = color.g;\r\n    cmd.color.b = color.b;\r\n    cmd.color.a = color.a * this._contextInfo.state.current.opacity;\r\n    cmd.size = size * Math.max(this._contextInfo.transform.current.getScaleX(), this._contextInfo.transform.current.getScaleY());\r\n    this.addCommand(cmd);\r\n  }\r\n\r\n  buildBatchVertices(vertexBuffer: Float32Array, batch: BatchCommand<DrawPoint>): number {\r\n    let index = 0;\r\n    for (const command of batch.commands) {\r\n      vertexBuffer[index++] = command.point.x;\r\n      vertexBuffer[index++] = command.point.y;\r\n      // normalize to [0, 1] for webgl\r\n      vertexBuffer[index++] = command.color.r / 255;\r\n      vertexBuffer[index++] = command.color.g / 255;\r\n      vertexBuffer[index++] = command.color.b / 255;\r\n      vertexBuffer[index++] = command.color.a;\r\n\r\n      vertexBuffer[index++] = command.size;\r\n    }\r\n    return index / this.vertexSize;\r\n  }\r\n\r\n  renderBatch(gl: WebGLRenderingContext, _batch: BatchCommand<DrawPoint>, vertexCount: number): void {\r\n    gl.drawArrays(gl.POINTS, 0, vertexCount);\r\n  }\r\n}\r\n","export default \"attribute vec4 a_position;\\r\\nattribute vec4 a_color;\\r\\nattribute float a_size;\\r\\nvarying lowp vec4 v_color;\\r\\nuniform mat4 u_matrix;\\r\\n\\r\\nvoid main() {\\r\\n  gl_Position = u_matrix * a_position;\\r\\n  gl_PointSize = a_size * 2.0;\\r\\n  v_color = a_color;\\r\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\r\\n#extension GL_OES_standard_derivatives : enable\\r\\n#endif\\r\\n\\r\\nprecision mediump float;\\r\\nvarying lowp vec4 v_color;\\r\\n\\r\\nvoid main() {\\r\\n  float r = 0.0, delta = 0.0, alpha = 1.0;\\r\\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\\r\\n  r = dot(cxy, cxy);\\r\\n  \\r\\n#ifdef GL_OES_standard_derivatives\\r\\n  delta = fwidth(r);\\r\\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\\r\\n#else\\r\\n  if (r > 1.0) {\\r\\n    discard;\\r\\n  }\\r\\n#endif\\r\\n  gl_FragColor = vec4(v_color.rgb, v_color.a * alpha);\\r\\n}\";","import { Vector, vec } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/BoundingBox';\n\nexport interface GraphicOptions {\n  /**\n   * The width of the graphic\n   */\n  width?: number;\n  /**\n   * The height of the graphic\n   */\n  height?: number;\n  /**\n   * SHould the graphic be flipped horizontally\n   */\n  flipHorizontal?: boolean;\n  /**\n   * Should the graphic be flipped vertically\n   */\n  flipVertical?: boolean;\n  /**\n   * The rotation of the graphic\n   */\n  rotation?: number;\n  /**\n   * The scale of the graphic\n   */\n  scale?: Vector;\n  /**\n   * The opacity of the graphic\n   */\n  opacity?: number;\n  /**\n   * The origin of the drawing in pixels to use when applying transforms, by default it will be the center of the image\n   */\n  origin?: Vector;\n}\n\n/**\n * A Graphic is the base Excalibur primitive for something that can be drawn to the [[ExcaliburGraphicsContext]].\n * [[Sprite]], [[Animation]], [[GraphicsGroup]], [[Canvas]], [[Rectangle]], [[Circle]], and [[Polygon]] all derive from the\n * [[Graphic]] abstract class.\n *\n * Implementors of a Graphic must override the abstract [[Graphic._drawImage]] method to render an image to the graphics context. Graphic\n * handles all the position, rotation, and scale transformations in [[Graphic._preDraw]] and [[Graphic._postDraw]]\n */\nexport abstract class Graphic {\n  private static _ID: number = 0;\n  readonly id = Graphic._ID++;\n\n  /**\n   * Gets or sets wether to show debug information about the graphic\n   */\n  public showDebug: boolean = false;\n\n  /**\n   * Gets or sets the flipHorizontal, which will flip the graphic horizontally (across the y axis)\n   */\n  public flipHorizontal: boolean = false;\n\n  /**\n   * Gets or sets the flipVertical, which will flip the graphic vertically (across the x axis)\n   */\n  public flipVertical: boolean = false;\n\n  /**\n   * Gets or sets the rotation of the graphic\n   */\n  public rotation: number = 0;\n\n  /**\n   * Gets or sets the opacity of the graphic, 0 is transparent, 1 is solid (opaque).\n   */\n  public opacity: number = 1;\n\n  /**\n   * Gets or sets the scale of the graphic, this affects the width and\n   */\n  public scale = Vector.One;\n\n  /**\n   * Gets or sets the origin of the graphic, if not set the center of the graphic is the origin\n   */\n  public origin: Vector | null = null;\n\n  constructor(options?: GraphicOptions) {\n    if (options) {\n      this.origin = options.origin ?? this.origin;\n      this.flipHorizontal = options.flipHorizontal ?? this.flipHorizontal;\n      this.flipVertical = options.flipVertical ?? this.flipVertical;\n      this.rotation = options.rotation ?? this.rotation;\n      this.opacity = options.opacity ?? this.opacity;\n      this.scale = options.scale ?? this.scale;\n    }\n  }\n\n  public cloneGraphicOptions(): GraphicOptions {\n    return {\n      origin: this.origin ? this.origin.clone() : null,\n      flipHorizontal: this.flipHorizontal,\n      flipVertical: this.flipVertical,\n      rotation: this.rotation,\n      opacity: this.opacity,\n      scale: this.scale ? this.scale.clone() : null\n    };\n  }\n\n  private _width: number = 0;\n\n  /**\n   * Gets or sets the width of the graphic (always positive)\n   */\n  public get width() {\n    return Math.abs(this._width * this.scale.x);\n  }\n\n  private _height: number = 0;\n\n  /**\n   * Gets or sets the height of the graphic (always positive)\n   */\n  public get height() {\n    return Math.abs(this._height * this.scale.y);\n  }\n\n  public set width(value: number) {\n    this._width = value;\n  }\n\n  public set height(value: number) {\n    this._height = value;\n  }\n\n  /**\n   * Gets a copy of the bounds in pixels occupied by the graphic on the the screen. This includes scale.\n   */\n  public get localBounds(): BoundingBox {\n    return BoundingBox.fromDimension(this.width, this.height, Vector.Zero);\n  }\n\n  /**\n   * Draw the whole graphic to the context including transform\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  public draw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._preDraw(ex, x, y);\n    this._drawImage(ex, 0, 0);\n    this._postDraw(ex);\n  }\n\n  /**\n   * Meant to be overriden by the graphic implementation to draw the underlying image (HTMLCanvasElement or HTMLImageElement)\n   * to the graphics context without transform. Transformations like position, rotation, and scale are handled by [[Graphic._preDraw]]\n   * and [[Graphic._postDraw]]\n   * @param ex The excalibur graphics context\n   * @param x\n   * @param y\n   */\n  protected abstract _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void;\n\n  /**\n   * Apply affine transformations to the graphics context to manipulate the graphic before [[Graphic._drawImage]]\n   * @param ex\n   * @param x\n   * @param y\n   */\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    ex.save();\n    ex.translate(x, y);\n    ex.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\n    this._rotate(ex);\n    this._flip(ex);\n    // it is important to multiply alphas so graphics respect the current context\n    ex.opacity = ex.opacity * this.opacity;\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\n    const origin = this.origin ?? vec(this.width / 2, this.height / 2);\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\n    ex.scale(scaleDirX, scaleDirY);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, this.height / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  /**\n   * Apply any addtional work after [[Graphic._drawImage]] and restore the context state.\n   * @param ex\n   */\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      ex.debug.drawRect(0, 0, this.width, this.height);\n    }\n    ex.restore();\n  }\n\n  /**\n   * Returns a new instance of the graphic that has the same properties\n   */\n  abstract clone(): Graphic;\n}\n","/**\r\n * Watch an object with a proxy, only fires if property value is different\r\n */\r\nexport function watch<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        if ((obj as any)[prop] !== value) {\r\n          (obj as any)[prop] = value;\r\n          // Avoid watching private junk\r\n          if (typeof prop === 'string') {\r\n            if (prop[0] !== '_') {\r\n              change(obj);\r\n            }\r\n          }\r\n        }\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n\r\n/**\r\n * Watch an object with a proxy, fires change on any property value change\r\n */\r\nexport function watchAny<T extends object>(type: T, change: (type: T) => any): T {\r\n  if (!type) {\r\n    return type;\r\n  }\r\n  if ((type as any).__isProxy === undefined) {\r\n    // expando hack to mark a proxy\r\n    return new Proxy(type, {\r\n      set: (obj, prop, value) => {\r\n        // The default behavior to store the value\r\n        (obj as any)[prop] = value;\r\n        // Avoid watching private junk\r\n        if (typeof prop === 'string') {\r\n          if (prop[0] !== '_') {\r\n            change(obj);\r\n          }\r\n        }\r\n\r\n        // Indicate success\r\n        return true;\r\n      },\r\n      get: (obj, prop) => {\r\n        if (prop !== '__isProxy') {\r\n          return (obj as any)[prop];\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n  return type;\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { Color } from '../Color';\nimport { ensurePowerOfTwo } from './Context/webgl-util';\nimport { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/BoundingBox';\nimport { watch } from '../Util/Watch';\nimport { TextureLoader } from './Context/texture-loader';\n\nexport interface RasterOptions {\n  smoothing?: boolean;\n  color?: Color;\n  strokeColor?: Color;\n  lineWidth?: number;\n  lineDash?: number[];\n  padding?: number;\n}\n\n/**\n * A Raster is a Graphic that needs to be first painted to a HTMLCanvasElement before it can be drawn to the\n * [[ExcaliburGraphicsContext]]. This is useful for generating custom images using the 2D canvas api.\n *\n * Implementors must implemenet the [[Raster.execute]] method to rasterize their drawing.\n */\nexport abstract class Raster extends Graphic {\n  public _bitmap: HTMLCanvasElement;\n  protected _ctx: CanvasRenderingContext2D;\n  private _dirty: boolean = true;\n\n  constructor(options?: GraphicOptions & RasterOptions) {\n    super(options);\n    if (options) {\n      this.color = options.color ?? Color.Black;\n      this.strokeColor = options?.strokeColor;\n      this.smoothing = options.smoothing ?? this.smoothing;\n      this.lineWidth = options.lineWidth ?? this.lineWidth;\n      this.lineDash = options.lineDash ?? this.lineDash;\n      this.padding = options.padding ?? this.padding;\n    }\n\n    this._bitmap = document.createElement('canvas');\n    // get the default canvas width/height as a fallback\n    const bitmapWidth = options?.width ?? this._bitmap.width;\n    const bitmapHeight = options?.height ?? this._bitmap.height;\n    // Rasters use power of two images as an optimization for webgl\n    this.width = ensurePowerOfTwo(bitmapWidth);\n    this.height = ensurePowerOfTwo(bitmapHeight);\n    const maybeCtx = this._bitmap.getContext('2d');\n    if (!maybeCtx) {\n      /* istanbul ignore next */\n      throw new Error('Browser does not support 2d canvas drawing, cannot create Raster graphic');\n    } else {\n      this._ctx = maybeCtx;\n    }\n  }\n\n  public cloneRasterOptions(): RasterOptions {\n    return {\n      color: this.color ? this.color.clone() : null,\n      strokeColor: this.strokeColor ? this.strokeColor.clone() : null,\n      smoothing: this.smoothing,\n      lineWidth: this.lineWidth,\n      lineDash: this.lineDash,\n      padding: this.padding\n    };\n  }\n\n  /**\n   * Gets whether the graphic is dirty, this means there are changes that haven't been re-rasterized\n   */\n  public get dirty() {\n    return this._dirty;\n  }\n\n  /**\n   * Flags the graphic as dirty, meaning it must be re-rasterized before draw.\n   * This should be called any time the graphics state changes such that it affects the outputed drawing\n   */\n  public flagDirty() {\n    this._dirty = true;\n  }\n\n  private _originalWidth: number;\n  /**\n   * Gets or sets the current width of the Raster graphic. Setting the width will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding`s set will be factored into the width\n   */\n  public get width() {\n    return this._getTotalWidth();\n  }\n  public set width(value: number) {\n    this._bitmap.width = value;\n    this._originalWidth = value;\n    this.flagDirty();\n  }\n\n  private _originalHeight: number;\n  /**\n   * Gets or sets the current height of the Raster graphic. Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   *\n   * Any `padding` set will be factored into the height\n   */\n  public get height() {\n    return this._getTotalHeight();\n  }\n\n  public set height(value: number) {\n    this._bitmap.height = value;\n    this._originalHeight = value;\n    this.flagDirty();\n  }\n\n  private _getTotalWidth() {\n    return (this._originalWidth ?? this._bitmap.width) + this.padding * 2;\n  }\n\n  private _getTotalHeight() {\n    return (this._originalHeight ?? this._bitmap.height) + this.padding * 2;\n  }\n\n  /**\n   * Returns the local bounds of the Raster including the padding\n   */\n  public get localBounds() {\n    return BoundingBox.fromDimension(this._getTotalWidth() * this.scale.x, this._getTotalHeight() * this.scale.y, Vector.Zero);\n  }\n\n  private _smoothing: boolean = false;\n  /**\n   * Gets or sets the smoothing (anti-aliasing of the graphic). Setting the height will cause the raster\n   * to be flagged dirty causing a re-raster on the next draw.\n   */\n  public get smoothing() {\n    return this._smoothing;\n  }\n  public set smoothing(value: boolean) {\n    this._smoothing = value;\n    this.flagDirty();\n  }\n\n  private _color: Color = watch(Color.Black, () => this.flagDirty());\n  /**\n   * Gets or sets the fillStyle of the Raster graphic. Setting the fillStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get color() {\n    return this._color;\n  }\n  public set color(value) {\n    if (!this._color?.equal(value)) {\n      this.flagDirty();\n    }\n    this._color = watch(value, () => this.flagDirty());\n  }\n\n  private _strokeColor: Color;\n  /**\n   * Gets or sets the strokeStyle of the Raster graphic. Setting the strokeStyle will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get strokeColor() {\n    return this._strokeColor;\n  }\n  public set strokeColor(value) {\n    if (!this._strokeColor?.equal(value)) {\n      this.flagDirty();\n    }\n    this._strokeColor = watch(value, () => this.flagDirty());\n  }\n\n  private _lineWidth: number = 1;\n  /**\n   * Gets or sets the line width of the Raster graphic. Setting the lineWidth will cause the raster to be\n   * flagged dirty causing a re-raster on the next draw.\n   */\n  public get lineWidth() {\n    return this._lineWidth;\n  }\n  public set lineWidth(value) {\n    this._lineWidth = value;\n    this.flagDirty();\n  }\n\n  private _lineDash: number[] = [];\n  public get lineDash() {\n    return this._lineDash;\n  }\n\n  public set lineDash(value) {\n    this._lineDash = value;\n    this.flagDirty();\n  }\n\n  private _padding: number = 0;\n  public get padding() {\n    return this._padding;\n  }\n\n  public set padding(value: number) {\n    this._padding = value;\n    this.flagDirty();\n  }\n\n  /**\n   * Rasterize the graphic to a bitmap making it usuable as in excalibur. Rasterize is called automatically if\n   * the graphic is [[Raster.dirty]] on the next [[Graphic.draw]] call\n   */\n  public rasterize(): void {\n    this._dirty = false;\n    this._ctx.clearRect(0, 0, this._getTotalWidth(), this._getTotalHeight());\n    this._ctx.save();\n    this._applyRasterProperites(this._ctx);\n    this.execute(this._ctx);\n    this._ctx.restore();\n    // The webgl texture needs to be updated if it exists after a raster cycle\n    TextureLoader.load(this._bitmap, true);\n  }\n\n  protected _applyRasterProperites(ctx: CanvasRenderingContext2D) {\n    this._bitmap.width = this._getTotalWidth();\n    this._bitmap.height = this._getTotalHeight();\n    ctx.translate(this.padding, this.padding);\n    ctx.imageSmoothingEnabled = this.smoothing;\n    ctx.lineWidth = this.lineWidth;\n    ctx.setLineDash(this.lineDash ?? ctx.getLineDash());\n    ctx.strokeStyle = this.strokeColor?.toString();\n    ctx.fillStyle = this.color?.toString();\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this._dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(this._bitmap, x, y);\n  }\n\n  /**\n   * Executes drawing implemenation of the graphic, this is where the specific drawing code for the graphic\n   * should be implemented. Once `rasterize()` the graphic can be drawn to the [[ExcaliburGraphicsContext]] via `draw(...)`\n   * @param ctx Canvas to draw the graphic to\n   */\n  abstract execute(ctx: CanvasRenderingContext2D): void;\n}\n","import { GraphicOptions } from './Graphic';\r\nimport { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CanvasOptions {\r\n  draw?: (ctx: CanvasRenderingContext2D) => void;\r\n  cache?: boolean;\r\n}\r\n\r\n/**\r\n * A canvas [[Graphic]] to provide an adapter between the 2D Canvas API and the [[ExcaliburGraphicsContext]].\r\n *\r\n * The [[Canvas]] works by re-rastering a draw handler to a HTMLCanvasElement for every draw which is then passed\r\n * to the [[ExcaliburGraphicsContext]] implementation as a rendered image.\r\n *\r\n * **Low performance API**\r\n */\r\nexport class Canvas extends Raster {\r\n  /**\r\n   * Return the 2D graphics context of this canvas\r\n   */\r\n  public get ctx() {\r\n    return this._ctx;\r\n  }\r\n\r\n  constructor(private _options: GraphicOptions & RasterOptions & CanvasOptions) {\r\n    super(_options);\r\n  }\r\n\r\n  public clone(): Canvas {\r\n    return new Canvas({\r\n      ...this._options,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this._options?.draw) {\r\n      this._options?.draw(ctx);\r\n    }\r\n    if (!this._options.cache) {\r\n      this.flagDirty();\r\n    }\r\n  }\r\n}\r\n","import { Scene } from './Scene';\nimport { Vector } from './Math/vector';\nimport { Actor } from './Actor';\nimport { Trigger } from './Trigger';\nimport { FrameStats } from './Debug';\nimport { Engine } from './Engine';\nimport { TileMap } from './TileMap';\nimport { Side } from './Collision/Side';\nimport * as Input from './Input/Index';\nimport { CollisionContact } from './Collision/Detection/CollisionContact';\nimport { Collider } from './Collision/Colliders/Collider';\nimport { Entity } from './EntityComponentSystem/Entity';\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from './Interfaces/LifecycleEvents';\nimport { BodyComponent } from './Collision/BodyComponent';\n\nexport enum EventTypes {\n  Kill = 'kill',\n  PreKill = 'prekill',\n  PostKill = 'postkill',\n\n  PreDraw = 'predraw',\n  PostDraw = 'postdraw',\n\n  PreDebugDraw = 'predebugdraw',\n  PostDebugDraw = 'postdebugdraw',\n\n  PreUpdate = 'preupdate',\n  PostUpdate = 'postupdate',\n\n  PreFrame = 'preframe',\n  PostFrame = 'postframe',\n\n  PreCollision = 'precollision',\n  CollisionStart = 'collisionstart',\n  CollisionEnd = 'collisionend',\n  PostCollision = 'postcollision',\n\n  Initialize = 'initialize',\n  Activate = 'activate',\n  Deactivate = 'deactivate',\n\n  ExitViewport = 'exitviewport',\n  EnterViewport = 'enterviewport',\n\n  ExitTrigger = 'exit',\n  EnterTrigger = 'enter',\n\n  Connect = 'connect',\n  Disconnect = 'disconnect',\n  Button = 'button',\n  Axis = 'axis',\n\n  Subscribe = 'subscribe',\n  Unsubscribe = 'unsubscribe',\n\n  Visible = 'visible',\n  Hidden = 'hidden',\n  Start = 'start',\n  Stop = 'stop',\n\n  PointerUp = 'pointerup',\n  PointerDown = 'pointerdown',\n  PointerMove = 'pointermove',\n  PointerEnter = 'pointerenter',\n  PointerLeave = 'pointerleave',\n  PointerCancel = 'pointercancel',\n  PointerWheel = 'pointerwheel',\n\n  Up = 'up',\n  Down = 'down',\n  Move = 'move',\n  Enter = 'enter',\n  Leave = 'leave',\n  Cancel = 'cancel',\n  Wheel = 'wheel',\n\n  Press = 'press',\n  Release = 'release',\n  Hold = 'hold',\n\n  PointerDragStart = 'pointerdragstart',\n  PointerDragEnd = 'pointerdragend',\n  PointerDragEnter = 'pointerdragenter',\n  PointerDragLeave = 'pointerdragleave',\n  PointerDragMove = 'pointerdragmove'\n}\n\n/* istanbul ignore next */\n/* compiler only: these are internal to lib */\nexport type kill = 'kill';\nexport type prekill = 'prekill';\nexport type postkill = 'postkill';\n\nexport type predraw = 'predraw';\nexport type postdraw = 'postdraw';\n\nexport type predebugdraw = 'predebugdraw';\nexport type postdebugdraw = 'postdebugdraw';\n\nexport type preupdate = 'preupdate';\nexport type postupdate = 'postupdate';\n\nexport type preframe = 'preframe';\nexport type postframe = 'postframe';\n\nexport type precollision = 'precollision';\nexport type collisionstart = 'collisionstart';\nexport type collisionend = 'collisionend';\nexport type postcollision = 'postcollision';\n\nexport type initialize = 'initialize';\nexport type activate = 'activate';\nexport type deactivate = 'deactivate';\n\nexport type exitviewport = 'exitviewport';\nexport type enterviewport = 'enterviewport';\n\nexport type exittrigger = 'exit';\nexport type entertrigger = 'enter';\n\nexport type connect = 'connect';\nexport type disconnect = 'disconnect';\nexport type button = 'button';\nexport type axis = 'axis';\n\nexport type subscribe = 'subscribe';\nexport type unsubscribe = 'unsubscribe';\n\nexport type visible = 'visible';\nexport type hidden = 'hidden';\nexport type start = 'start';\nexport type stop = 'stop';\n\nexport type pointerup = 'pointerup';\nexport type pointerdown = 'pointerdown';\nexport type pointermove = 'pointermove';\nexport type pointerenter = 'pointerenter';\nexport type pointerleave = 'pointerleave';\nexport type pointercancel = 'pointercancel';\nexport type pointerwheel = 'pointerwheel';\n\nexport type up = 'up';\nexport type down = 'down';\nexport type move = 'move';\nexport type enter = 'enter';\nexport type leave = 'leave';\nexport type cancel = 'cancel';\nexport type wheel = 'wheel';\n\nexport type press = 'press';\nexport type release = 'release';\nexport type hold = 'hold';\n\nexport type pointerdragstart = 'pointerdragstart';\nexport type pointerdragend = 'pointerdragend';\nexport type pointerdragenter = 'pointerdragenter';\nexport type pointerdragleave = 'pointerdragleave';\nexport type pointerdragmove = 'pointerdragmove';\n\n/**\n * Base event type in Excalibur that all other event types derive from. Not all event types are thrown on all Excalibur game objects,\n * some events are unique to a type, others are not.\n *\n */\nexport class GameEvent<T, U = T> {\n  /**\n   * Target object for this event.\n   */\n  public target: T;\n\n  /**\n   * Other target object for this event\n   */\n  public other: U | null;\n\n  /**\n   * If set to false, prevents event from propagating to other actors. If true it will be propagated\n   * to all actors that apply.\n   */\n  public get bubbles(): boolean {\n    return this._bubbles;\n  }\n\n  public set bubbles(value: boolean) {\n    this._bubbles = value;\n  }\n\n  private _bubbles: boolean = true;\n  /**\n   * Prevents event from bubbling\n   */\n  public stopPropagation() {\n    this.bubbles = false;\n  }\n}\n\n/**\n * The 'kill' event is emitted on actors when it is killed. The target is the actor that was killed.\n */\nexport class KillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'prekill' event is emitted directly before an actor is killed.\n */\nexport class PreKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'postkill' event is emitted directly after the actor is killed.\n */\nexport class PostKillEvent extends GameEvent<Actor> {\n  constructor(public target: Actor) {\n    super();\n  }\n}\n\n/**\n * The 'start' event is emitted on engine when has started and is ready for interaction.\n */\nexport class GameStartEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'stop' event is emitted on engine when has been stopped and will no longer take input, update or draw.\n */\nexport class GameStopEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * The 'predraw' event is emitted on actors, scenes, and engine before drawing starts. Actors' predraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PreDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'postdraw' event is emitted on actors, scenes, and engine after drawing finishes. Actors' postdraw happens inside their graphics\n * transform so that all drawing takes place with the actor as the origin.\n *\n */\nexport class PostDrawEvent extends GameEvent<Entity | Scene | Engine | TileMap> {\n  constructor(public ctx: CanvasRenderingContext2D, public delta: number, public target: Entity | Scene | Engine | TileMap) {\n    super();\n  }\n}\n\n/**\n * The 'predebugdraw' event is emitted on actors, scenes, and engine before debug drawing starts.\n */\nexport class PreDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'postdebugdraw' event is emitted on actors, scenes, and engine after debug drawing starts.\n */\nexport class PostDebugDrawEvent extends GameEvent<Entity | Actor | Scene | Engine> {\n  constructor(public ctx: CanvasRenderingContext2D, public target: Entity | Actor | Scene | Engine) {\n    super();\n  }\n}\n\n/**\n * The 'preupdate' event is emitted on actors, scenes, camera, and engine before the update starts.\n */\nexport class PreUpdateEvent<T extends OnPreUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'postupdate' event is emitted on actors, scenes, camera, and engine after the update ends.\n */\nexport class PostUpdateEvent<T extends OnPostUpdate = Entity> extends GameEvent<T> {\n  constructor(public engine: Engine, public delta: number, public target: T) {\n    super();\n  }\n}\n\n/**\n * The 'preframe' event is emitted on the engine, before the frame begins.\n */\nexport class PreFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public prevStats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * The 'postframe' event is emitted on the engine, after a frame ends.\n */\nexport class PostFrameEvent extends GameEvent<Engine> {\n  constructor(public engine: Engine, public stats: FrameStats) {\n    super();\n    this.target = engine;\n  }\n}\n\n/**\n * Event received when a gamepad is connected to Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadConnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Event received when a gamepad is disconnected from Excalibur. [[Gamepads]] receives this event.\n */\nexport class GamepadDisconnectEvent extends GameEvent<Input.Gamepad> {\n  constructor(public index: number, public gamepad: Input.Gamepad) {\n    super();\n    this.target = gamepad;\n  }\n}\n\n/**\n * Gamepad button event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadButtonEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param button  The Gamepad button\n   * @param value   A numeric value between 0 and 1\n   */\n  constructor(public button: Input.Buttons, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Gamepad axis event. See [[Gamepads]] for information on responding to controller input. [[Gamepad]] instances receive this event;\n */\nexport class GamepadAxisEvent extends GameEvent<Input.Gamepad> {\n  /**\n   * @param axis  The Gamepad axis\n   * @param value A numeric value between -1 and 1\n   */\n  constructor(public axis: Input.Axes, public value: number, public target: Input.Gamepad) {\n    super();\n  }\n}\n\n/**\n * Subscribe event thrown when handlers for events other than subscribe are added. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class SubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Unsubscribe event thrown when handlers for events other than unsubscribe are removed. Meta event that is received by\n * [[EventDispatcher|event dispatchers]].\n */\nexport class UnsubscribeEvent<T> extends GameEvent<T> {\n  constructor(public topic: string, public handler: (event: GameEvent<T>) => void) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is visible on a screen.\n */\nexport class VisibleEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event received by the [[Engine]] when the browser window is hidden from all screens.\n */\nexport class HiddenEvent extends GameEvent<Engine> {\n  constructor(public target: Engine) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision will occur this frame if it resolves\n */\nexport class PreCollisionEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that will collided with the current actor\n   * @param side          The side that will be collided with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor|actor]] when a collision has been resolved (body reacted) this frame\n */\nexport class PostCollisionEvent<T extends Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   * @param actor         The actor the event was thrown on\n   * @param other         The actor that did collide with the current actor\n   * @param side          The side that did collide with the current actor\n   * @param intersection  Intersection vector\n   */\n  constructor(actor: T, public other: T, public side: Side, public intersection: Vector) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\nexport class ContactStartEvent<T> {\n  constructor(public target: T, public other: T, public contact: CollisionContact) {}\n}\n\nexport class ContactEndEvent<T> {\n  constructor(public target: T, public other: T) {}\n}\n\nexport class CollisionPreSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\nexport class CollisionPostSolveEvent<T> {\n  constructor(public target: T, public other: T, public side: Side, public intersection: Vector, public contact: CollisionContact) {}\n}\n\n/**\n * Event thrown the first time an [[Actor|actor]] collides with another, after an actor is in contact normal collision events are fired.\n */\nexport class CollisionStartEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   * @param actor\n   * @param other\n   * @param contact\n   */\n  constructor(actor: T, public other: T, public contact: CollisionContact) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown when the [[Actor|actor]] is no longer colliding with another\n */\nexport class CollisionEndEvent<T extends BodyComponent | Collider | Entity = Actor> extends GameEvent<T> {\n  /**\n   *\n   */\n  constructor(actor: T, public other: T) {\n    super();\n    this.target = actor;\n  }\n\n  public get actor() {\n    return this.target;\n  }\n\n  public set actor(actor: T) {\n    this.target = actor;\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] and a [[Scene]] only once before the first update call\n */\nexport class InitializeEvent<T extends OnInitialize = Entity> extends GameEvent<T> {\n  /**\n   * @param engine  The reference to the current engine\n   */\n  constructor(public engine: Engine, public target: T) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on activation\n */\nexport class ActivateEvent extends GameEvent<Scene> {\n  /**\n   * @param oldScene  The reference to the old scene\n   */\n  constructor(public oldScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on a [[Scene]] on deactivation\n */\nexport class DeactivateEvent extends GameEvent<Scene> {\n  /**\n   * @param newScene  The reference to the new scene\n   */\n  constructor(public newScene: Scene, public target: Scene) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class ExitViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\n/**\n * Event thrown on an [[Actor]] when it completely leaves the screen.\n */\nexport class EnterViewPortEvent extends GameEvent<Entity> {\n  constructor(public target: Entity) {\n    super();\n  }\n}\n\nexport class EnterTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n\nexport class ExitTriggerEvent extends GameEvent<Actor> {\n  constructor(public target: Trigger, public actor: Actor) {\n    super();\n  }\n}\n","import { GameEvent, SubscribeEvent, UnsubscribeEvent } from './Events';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\nexport class EventDispatcher<T = any> implements Eventable {\r\n  private _handlers: { [key: string]: { (event: GameEvent<T>): void }[] } = {};\r\n  private _wiredEventDispatchers: Eventable[] = [];\r\n\r\n  private _target: T;\r\n\r\n  /**\r\n   * @param target  The object that will be the recipient of events from this event dispatcher\r\n   */\r\n  constructor(target: T) {\r\n    this._target = target;\r\n  }\r\n\r\n  /**\r\n   * Clears any existing handlers or wired event dispatchers on this event dispatcher\r\n   */\r\n  public clear() {\r\n    this._handlers = {};\r\n    this._wiredEventDispatchers = [];\r\n  }\r\n\r\n  /**\r\n   * Emits an event for target\r\n   * @param eventName  The name of the event to publish\r\n   * @param event      Optionally pass an event data object to the handler\r\n   */\r\n  public emit(eventName: string, event: GameEvent<T>) {\r\n    if (!eventName) {\r\n      // key not mapped\r\n      return;\r\n    }\r\n    eventName = eventName.toLowerCase();\r\n    const target = this._target;\r\n    if (!event) {\r\n      event = new GameEvent();\r\n    }\r\n    try {\r\n      if (!event.target) {\r\n        event.target = target;\r\n      }\r\n    } catch {\r\n      // pass\r\n    }\r\n    let i: number, len: number;\r\n\r\n    if (this._handlers[eventName]) {\r\n      i = 0;\r\n      len = this._handlers[eventName].length;\r\n\r\n      for (i; i < len; i++) {\r\n        this._handlers[eventName][i].call(target, event);\r\n      }\r\n    }\r\n\r\n    i = 0;\r\n    len = this._wiredEventDispatchers.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this._wiredEventDispatchers[i].emit(eventName, event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe an event handler to a particular event name, multiple handlers per event name are allowed.\r\n   * @param eventName  The name of the event to subscribe to\r\n   * @param handler    The handler callback to fire on this event\r\n   */\r\n  public on(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    if (!this._handlers[eventName]) {\r\n      this._handlers[eventName] = [];\r\n    }\r\n    this._handlers[eventName].push(handler);\r\n\r\n    // meta event handlers\r\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\r\n      this.emit('subscribe', new SubscribeEvent(eventName, handler));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe an event handler(s) from an event. If a specific handler\r\n   * is specified for an event, only that handler will be unsubscribed.\r\n   * Otherwise all handlers will be unsubscribed for that event.\r\n   *\r\n   * @param eventName  The name of the event to unsubscribe\r\n   * @param handler    Optionally the specific handler to unsubscribe\r\n   */\r\n  public off(eventName: string, handler?: (event: GameEvent<T>) => void) {\r\n    eventName = eventName.toLowerCase();\r\n    const eventHandlers = this._handlers[eventName];\r\n\r\n    if (eventHandlers) {\r\n      // if no explicit handler is give with the event name clear all handlers\r\n      if (!handler) {\r\n        this._handlers[eventName].length = 0;\r\n      } else {\r\n        const index = eventHandlers.indexOf(handler);\r\n        this._handlers[eventName].splice(index, 1);\r\n      }\r\n    }\r\n    // meta event handlers\r\n    if (eventName !== 'unsubscribe' && eventName !== 'subscribe') {\r\n      this.emit('unsubscribe', new UnsubscribeEvent(eventName, handler));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: GameEvent<T>) => void) {\r\n    const metaHandler = (event: GameEvent<T>) => {\r\n      const ev = event || new GameEvent();\r\n      try {\r\n        ev.target = ev.target || this._target;\r\n      } catch {\r\n        // pass\r\n      }\r\n\r\n      this.off(eventName, handler);\r\n      handler.call(ev.target, ev);\r\n    };\r\n\r\n    this.on(eventName, metaHandler);\r\n  }\r\n\r\n  /**\r\n   * Wires this event dispatcher to also receive events from another\r\n   */\r\n  public wire(eventDispatcher: EventDispatcher): void {\r\n    eventDispatcher._wiredEventDispatchers.push(this);\r\n  }\r\n\r\n  /**\r\n   * Unwires this event dispatcher from another\r\n   */\r\n  public unwire(eventDispatcher: EventDispatcher): void {\r\n    const index = eventDispatcher._wiredEventDispatchers.indexOf(this);\r\n    if (index > -1) {\r\n      eventDispatcher._wiredEventDispatchers.splice(index, 1);\r\n    }\r\n  }\r\n}\r\n","import { Loadable } from '../Interfaces/Loadable';\r\nimport { Logger } from '../Util/Log';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\n\r\n/**\r\n * The [[Resource]] type allows games built in Excalibur to load generic resources.\r\n * For any type of remote resource it is recommended to use [[Resource]] for preloading.\r\n */\r\nexport class Resource<T> implements Loadable<T> {\r\n  public data: T = null;\r\n  public logger: Logger = Logger.getInstance();\r\n  public events: EventDispatcher = new EventDispatcher(this);\r\n\r\n  /**\r\n   * @param path          Path to the remote resource\r\n   * @param responseType  The type to expect as a response: \"\" | \"arraybuffer\" | \"blob\" | \"document\" | \"json\" | \"text\";\r\n   * @param bustCache     Whether or not to cache-bust requests\r\n   */\r\n  constructor(\r\n    public path: string,\r\n    public responseType: '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text',\r\n    public bustCache: boolean = true\r\n  ) {}\r\n\r\n  /**\r\n   * Returns true if the Resource is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return this.data !== null;\r\n  }\r\n\r\n\r\n  private _cacheBust(uri: string): string {\r\n    const query: RegExp = /\\?\\w*=\\w*/;\r\n    if (query.test(uri)) {\r\n      uri += '&__=' + Date.now();\r\n    } else {\r\n      uri += '?__=' + Date.now();\r\n    }\r\n    return uri;\r\n  }\r\n  /**\r\n   * Begin loading the resource and returns a promise to be resolved on completion\r\n   */\r\n  public load(): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      // Exit early if we already have data\r\n      if (this.data !== null) {\r\n        this.logger.debug('Already have data for resource', this.path);\r\n        this.events.emit('complete', this.data as any);\r\n        resolve(this.data);\r\n        return;\r\n      }\r\n\r\n      const request = new XMLHttpRequest();\r\n      request.open('GET', this.bustCache ? this._cacheBust(this.path) : this.path, true);\r\n      request.responseType = this.responseType;\r\n      request.addEventListener('loadstart', (e) => this.events.emit('loadstart', e as any));\r\n      request.addEventListener('progress', (e) => this.events.emit('progress', e as any));\r\n      request.addEventListener('error', (e) => this.events.emit('error', e as any));\r\n      request.addEventListener('load', (e) => this.events.emit('load', e as any));\r\n      request.addEventListener('load', () => {\r\n        // XHR on file:// success status is 0, such as with PhantomJS\r\n        if (request.status !== 0 && request.status !== 200) {\r\n          this.logger.error('Failed to load resource ', this.path, ' server responded with error code', request.status);\r\n          this.events.emit('error', request.response);\r\n          reject(new Error(request.statusText));\r\n          return;\r\n        }\r\n\r\n        this.data = request.response;\r\n        this.events.emit('complete', this.data as any);\r\n        this.logger.debug('Completed loading resource', this.path);\r\n        resolve(this.data);\r\n      });\r\n      request.send();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @module\r\n * @deprecated\r\n * These effects can be applied to any bitmap image but are mainly used\r\n * for [[Sprite]] effects or [[Animation]] effects.\r\n */\r\n\r\n/**\r\n * @typedoc\r\n */\r\n\r\nimport { obsolete } from '../Util/Decorators';\r\nimport { Color } from '../Color';\r\n\r\n/**\r\n * The interface that all sprite effects must implement\r\n * @deprecated SpriteEffect will be removed in v0.26.0\r\n */\r\nexport interface SpriteEffect {\r\n  /**\r\n   * Should update individual pixels values\r\n   * @param x          The pixel's x coordinate\r\n   * @param y          The pixel's y coordinate\r\n   * @param imageData  The sprite's raw pixel data\r\n   */\r\n  updatePixel(x: number, y: number, imageData: ImageData): void;\r\n}\r\n\r\n/**\r\n * Applies the \"Grayscale\" effect to a sprite, removing color information.\r\n * @deprecated [[Grayscale]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Grayscale will be removed in v0.26.0'\r\n})\r\nexport class Grayscale implements SpriteEffect {\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const avg = (pixel[firstPixel + 0] + pixel[firstPixel + 1] + pixel[firstPixel + 2]) / 3;\r\n    pixel[firstPixel + 0] = avg;\r\n    pixel[firstPixel + 1] = avg;\r\n    pixel[firstPixel + 2] = avg;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Invert\" effect to a sprite, inverting the pixel colors.\r\n * @deprecated [[Invert]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Invert will be removed in v0.26.0'\r\n})\r\nexport class Invert implements SpriteEffect {\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    pixel[firstPixel + 0] = 255 - pixel[firstPixel + 0];\r\n    pixel[firstPixel + 1] = 255 - pixel[firstPixel + 1];\r\n    pixel[firstPixel + 2] = 255 - pixel[firstPixel + 2];\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Opacity\" effect to a sprite, setting the alpha of all pixels to a given value.\r\n * @deprecated [[Opacity]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Opacity will be removed in v0.26.0'\r\n})\r\nexport class Opacity implements SpriteEffect {\r\n  /**\r\n   * @param opacity  The new opacity of the sprite from 0-1.0\r\n   */\r\n  constructor(public opacity: number) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 3] = Math.round(this.opacity * pixel[firstPixel + 3]);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Colorize\" effect to a sprite, changing the color channels of all the pixels to an\r\n * average of the original color and the provided color\r\n * @deprecated [[Colorize]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Colorize will be removed in v0.26.0'\r\n})\r\nexport class Colorize implements SpriteEffect {\r\n  /**\r\n   * @param color  The color to apply to the sprite\r\n   */\r\n  constructor(public color: Color) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 0] = (pixel[firstPixel + 0] + this.color.r) / 2;\r\n      pixel[firstPixel + 1] = (pixel[firstPixel + 1] + this.color.g) / 2;\r\n      pixel[firstPixel + 2] = (pixel[firstPixel + 2] + this.color.b) / 2;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Lighten\" effect to a sprite, changes the lightness of the color according to HSL\r\n * @deprecated [[Lighten]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Lighten will be removed in v0.26.0'\r\n})\r\nexport class Lighten implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).lighten(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Darken\" effect to a sprite, changes the darkness of the color according to HSL\r\n * @deprecated [[Darken]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Darken will be removed v0.26.0'\r\n})\r\nexport class Darken implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).darken(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Saturate\" effect to a sprite, saturates the color according to HSL\r\n * @deprecated [[Saturate]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Saturate will be removed in v0.26.0'\r\n})\r\nexport class Saturate implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).saturate(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Desaturate\" effect to a sprite, desaturates the color according to HSL\r\n * @deprecated [[Desaturate]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Desaturate will be removed in v0.26.0'\r\n})\r\nexport class Desaturate implements SpriteEffect {\r\n  /**\r\n   * @param factor  The factor of the effect between 0-1\r\n   */\r\n  constructor(public factor: number = 0.1) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    const color = Color.fromRGB(pixel[firstPixel + 0], pixel[firstPixel + 1], pixel[firstPixel + 2], pixel[firstPixel + 3]).desaturate(\r\n      this.factor\r\n    );\r\n    pixel[firstPixel + 0] = color.r;\r\n    pixel[firstPixel + 1] = color.g;\r\n    pixel[firstPixel + 2] = color.b;\r\n    pixel[firstPixel + 3] = color.a;\r\n  }\r\n}\r\n\r\n/**\r\n * Applies the \"Fill\" effect to a sprite, changing the color channels of all non-transparent pixels to match\r\n * a given color\r\n * @deprecated [[Fill]] will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'Fill will be removed in v0.26.0'\r\n})\r\nexport class Fill implements SpriteEffect {\r\n  /**\r\n   * @param color  The color to apply to the sprite\r\n   */\r\n  constructor(public color: Color) {}\r\n  updatePixel(x: number, y: number, imageData: ImageData): void {\r\n    const firstPixel = (x + y * imageData.width) * 4;\r\n    const pixel = imageData.data;\r\n    if (pixel[firstPixel + 3] !== 0) {\r\n      pixel[firstPixel + 0] = this.color.r;\r\n      pixel[firstPixel + 1] = this.color.g;\r\n      pixel[firstPixel + 2] = this.color.b;\r\n    }\r\n  }\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n * @deprecated\r\n */\r\nexport class Texture implements Loadable<HTMLImageElement> {\r\n  private _resource: Resource<Blob>;\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n  private _sprite: Sprite = null;\r\n\r\n  /**\r\n   * Populated once loading is complete\r\n   */\r\n  public data: HTMLImageElement;\r\n  public get image() {\r\n    return this.data;\r\n  }\r\n\r\n  private _loadedResolve: (image: HTMLImageElement) => any;\r\n  public loaded = new Promise<HTMLImageElement>(resolve => {\r\n    this._loadedResolve = resolve;\r\n  });\r\n\r\n  /**\r\n   * @param path       Path to the image resource or a base64 string representing an image \"data:image/png;base64,iVB...\"\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public bustCache = true) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    this._sprite = new Sprite(this, 0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<HTMLImageElement> {\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      image.src = url;\r\n      await image.decode();\r\n\r\n      // Set results\r\n      this.data = image;\r\n      this.width = this._sprite.width = image.naturalWidth;\r\n      this.height = this._sprite.height = image.naturalHeight;\r\n      this._sprite = new Sprite(this, 0, 0, this.width, this.height);\r\n    } catch {\r\n      await Promise.reject('Error loading texture');\r\n    }\r\n    // todo emit complete\r\n    this._loadedResolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  public asSprite(): Sprite {\r\n    return this._sprite;\r\n  }\r\n}\r\n","export type Constructor<T> = {\r\n  new (...args: any[]): T;\r\n};\r\n/**\r\n * Configurable helper extends base type and makes all properties available as option bag arguments\r\n * @internal\r\n * @param base\r\n */\r\nexport function Configurable<T extends Constructor<{}>>(base: T): T {\r\n  return class extends base {\r\n    public assign(props: Partial<T>) {\r\n      //set the value of every property that was passed in,\r\n      //if the constructor previously set this value, it will be overridden here\r\n      for (const k in props) {\r\n        // eslint-disable-next-line\r\n        if (typeof (<any>this)[k] !== 'function') {\r\n          // eslint-disable-next-line\r\n          (<any>this)[k] = (<any>props)[k];\r\n        }\r\n      }\r\n    }\r\n\r\n    constructor(...args: any[]) {\r\n      super(...args);\r\n      //get the number of arguments that aren't undefined. TS passes a value to all parameters\r\n      //of whatever ctor is the implementation, so args.length doesn't work here.\r\n      const size = args.filter(function(value) {\r\n        return value !== undefined;\r\n      }).length;\r\n      if (size === 1 && args[0] && typeof args[0] === 'object' && !(args[0] instanceof Array)) {\r\n        this.assign(args[0]);\r\n      }\r\n    }\r\n  };\r\n}\r\n","import * as Effects from './SpriteEffects';\r\nimport { Color } from '../Color';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Texture } from './Texture';\r\nimport { Vector } from '../Math/vector';\r\nimport { Logger } from '../Util/Log';\r\nimport { clamp } from '../Util/Util';\r\nimport { Configurable } from '../Configurable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * @hidden\r\n * @deprecated Use [[Sprite]]\r\n */\r\nexport class SpriteImpl implements Drawable {\r\n  public texture: Texture;\r\n\r\n  public x: number = 0;\r\n  public y: number = 0;\r\n\r\n  public get drawWidth(): number {\r\n    return Math.abs(this.width * this.scale.x);\r\n  }\r\n\r\n  public get drawHeight(): number {\r\n    return Math.abs(this.height * this.scale.y);\r\n  }\r\n\r\n  public rotation: number = 0.0;\r\n  public anchor: Vector = Vector.Half;\r\n  public offset: Vector = Vector.Zero;\r\n  public scale: Vector = Vector.One;\r\n  /**\r\n   * Default: false, should the sprite be drawn around the anchor or from the top left.\r\n   * Sprite rotations/scaling still happen around the anchor regardless of this setting.\r\n   */\r\n  public drawAroundAnchor = false;\r\n\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * Draws the sprite flipped vertically\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * Draws the sprite flipped horizontally\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  public effects: Effects.SpriteEffect[] = [];\r\n\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n\r\n  private _spriteCanvas: HTMLCanvasElement = null;\r\n  private _spriteCtx: CanvasRenderingContext2D = null;\r\n  private _pixelData: ImageData = null;\r\n  private _pixelsLoaded: boolean = false;\r\n  private _dirtyEffect: boolean = true;\r\n\r\n  /**\r\n   * @param imageOrConfig  The backing image texture to build the Sprite, or Sprite option bag\r\n   * @param x      The x position of the sprite\r\n   * @param y      The y position of the sprite\r\n   * @param width  The width of the sprite in pixels\r\n   * @param height The height of the sprite in pixels\r\n   */\r\n  constructor(imageOrConfig: Texture | SpriteArgs, x: number, y: number, width: number, height: number) {\r\n    let image = imageOrConfig;\r\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\r\n      x = imageOrConfig.x | 0;\r\n      y = imageOrConfig.y | 0;\r\n      width = imageOrConfig.width | 0;\r\n      height = imageOrConfig.height | 0;\r\n      image = imageOrConfig.image;\r\n      if (!image) {\r\n        const message = 'An image texture is required to construct a sprite';\r\n        throw new Error(message);\r\n      }\r\n    }\r\n\r\n    this.x = x || 0;\r\n    this.y = y || 0;\r\n\r\n    this.texture = image as Texture;\r\n    this._spriteCanvas = document.createElement('canvas');\r\n    this._spriteCanvas.width = width;\r\n    this._spriteCanvas.height = height;\r\n    this._spriteCtx = this._spriteCanvas.getContext('2d');\r\n    this._initPixelsFromTexture();\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n  }\r\n\r\n  private async _initPixelsFromTexture() {\r\n    try {\r\n      const image = await this.texture.loaded;\r\n      this.width = this.width || image.naturalWidth;\r\n      this.height = this.height || image.naturalHeight;\r\n      this._spriteCanvas.width = this._spriteCanvas.width || image.naturalWidth;\r\n      this._spriteCanvas.height = this._spriteCanvas.height || image.naturalHeight;\r\n      this._loadPixels();\r\n      this._dirtyEffect = true;\r\n    } catch (e) {\r\n      this.logger.error('Error loading texture ', this.texture.path, e);\r\n    }\r\n  }\r\n\r\n  private _loadPixels() {\r\n    if (this.texture.isLoaded() && !this._pixelsLoaded) {\r\n      const naturalWidth = this.texture.image.naturalWidth || 0;\r\n      const naturalHeight = this.texture.image.naturalHeight || 0;\r\n\r\n      if (this.width > naturalWidth) {\r\n        this.logger.warn(`The sprite width ${this.width} exceeds the width \r\n                              ${naturalWidth} of the backing texture ${this.texture.path}`);\r\n      }\r\n\r\n      if (this.width <= 0 || naturalWidth <= 0) {\r\n        throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${naturalWidth}`);\r\n      }\r\n\r\n      if (this.height > naturalHeight) {\r\n        this.logger.warn(`The sprite height ${this.height} exceeds the height \r\n                              ${naturalHeight} of the backing texture ${this.texture.path}`);\r\n      }\r\n\r\n      if (this.height <= 0 || naturalHeight <= 0) {\r\n        throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${naturalHeight}`);\r\n      }\r\n\r\n      this._flushTexture();\r\n\r\n      this._pixelsLoaded = true;\r\n    }\r\n  }\r\n\r\n  private _flushTexture() {\r\n    const naturalWidth = this.texture.image.naturalWidth || 0;\r\n    const naturalHeight = this.texture.image.naturalHeight || 0;\r\n\r\n    this._spriteCtx.clearRect(0, 0, this.width, this.height);\r\n    this._spriteCtx.drawImage(\r\n      this.texture.image,\r\n      clamp(this.x, 0, naturalWidth),\r\n      clamp(this.y, 0, naturalHeight),\r\n      clamp(this.width, 0, naturalWidth),\r\n      clamp(this.height, 0, naturalHeight),\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    );\r\n  }\r\n\r\n  private _opacity: number = 1;\r\n  /**\r\n   * Applies the [[Opacity]] effect to a sprite, setting the alpha of all pixels to a given value\r\n   */\r\n  public opacity(value: number) {\r\n    this._opacity = value;\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Grayscale]] effect to a sprite, removing color information.\r\n   */\r\n  public grayscale() {\r\n    this.addEffect(new Effects.Grayscale());\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Invert]] effect to a sprite, inverting the pixel colors.\r\n   */\r\n  public invert() {\r\n    this.addEffect(new Effects.Invert());\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Fill]] effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\r\n   */\r\n  public fill(color: Color) {\r\n    this.addEffect(new Effects.Fill(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Colorize]] effect to a sprite, changing the color channels of all pixels to be the average of the original color\r\n   * and the provided color.\r\n   */\r\n  public colorize(color: Color) {\r\n    this.addEffect(new Effects.Colorize(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Lighten]] effect to a sprite, changes the lightness of the color according to HSL\r\n   */\r\n  public lighten(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Lighten(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Darken]] effect to a sprite, changes the darkness of the color according to HSL\r\n   */\r\n  public darken(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Darken(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Saturate]] effect to a sprite, saturates the color according to HSL\r\n   */\r\n  public saturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Saturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the [[Desaturate]] effect to a sprite, desaturates the color according to HSL\r\n   */\r\n  public desaturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Desaturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Adds a new [[SpriteEffect]] to this drawing.\r\n   * @param effect  Effect to add to the this drawing\r\n   */\r\n  public addEffect(effect: Effects.SpriteEffect) {\r\n    this.effects.push(effect);\r\n    // We must check if the texture and the backing sprite pixels are loaded as well before\r\n    // an effect can be applied\r\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\r\n      this._dirtyEffect = true;\r\n    } else {\r\n      this._applyEffects();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[SpriteEffect]] from this sprite.\r\n   * @param effect  Effect to remove from this sprite\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n\r\n  /**\r\n   * Removes an effect given the index from this sprite.\r\n   * @param index  Index of the effect to remove from this sprite\r\n   */\r\n  public removeEffect(index: number): void;\r\n  public removeEffect(param: any) {\r\n    let indexToRemove = -1;\r\n    if (typeof param === 'number') {\r\n      indexToRemove = param;\r\n    } else {\r\n      indexToRemove = this.effects.indexOf(param);\r\n    }\r\n\r\n    // bounds check\r\n    if (indexToRemove < 0 || indexToRemove >= this.effects.length) {\r\n      return;\r\n    }\r\n\r\n    this.effects.splice(indexToRemove, 1);\r\n\r\n    // We must check if the texture and the backing sprite pixels are loaded as well before\r\n    // an effect can be applied\r\n    if (!this.texture.isLoaded() || !this._pixelsLoaded) {\r\n      this._dirtyEffect = true;\r\n    } else {\r\n      this._applyEffects();\r\n    }\r\n  }\r\n\r\n  private _applyEffects() {\r\n    this._flushTexture();\r\n\r\n    if (this.effects.length > 0) {\r\n      this._pixelData = this._spriteCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n      const len = this.effects.length;\r\n      for (let i = 0; i < len; i++) {\r\n        for (let y = 0; y < this.height; y++) {\r\n          for (let x = 0; x < this.width; x++) {\r\n            this.effects[i].updatePixel(x, y, this._pixelData);\r\n          }\r\n        }\r\n      }\r\n      this._spriteCtx.clearRect(0, 0, this.width, this.height);\r\n      this._spriteCtx.putImageData(this._pixelData, 0, 0);\r\n    }\r\n\r\n    this._dirtyEffect = false;\r\n  }\r\n\r\n  /**\r\n   * Clears all effects from the drawing and return it to its original state.\r\n   */\r\n  public clearEffects() {\r\n    this.effects.length = 0;\r\n    this._applyEffects();\r\n  }\r\n\r\n  /**\r\n   * Resets the internal state of the drawing (if any)\r\n   */\r\n  public reset() {\r\n    // do nothing\r\n  }\r\n\r\n  public debugDraw(ctx: CanvasRenderingContext2D, x: number, y: number) {\r\n    ctx.save();\r\n    ctx.translate(x, y);\r\n    ctx.rotate(this.rotation);\r\n    const xpoint = this.drawWidth * this.anchor.x;\r\n    const ypoint = this.drawHeight * this.anchor.y;\r\n\r\n    ctx.strokeStyle = Color.Black.toString();\r\n    ctx.strokeRect(-xpoint, -ypoint, this.drawWidth, this.drawHeight);\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the sprite with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.width,\r\n      drawHeight: options.drawHeight ?? this.height,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      offset: options.offset ?? this.offset,\r\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\r\n    };\r\n\r\n    if (this._dirtyEffect) {\r\n      this._applyEffects();\r\n    }\r\n    // calculating current dimensions\r\n    const anchorX = drawWidth * anchor.x + offset.x;\r\n    const anchorY = drawHeight * anchor.y + offset.y;\r\n    const scaleDirX = this.scale.x > 0 ? 1 : -1;\r\n    const scaleDirY = this.scale.y > 0 ? 1 : -1;\r\n\r\n    ctx.save();\r\n    // Move the draw point of origin\r\n    ctx.translate(x, y);\r\n\r\n    // Rotate and scale around anchor point\r\n    // This requires a bit of explaination, scale coordinates first positive flipping or rotating\r\n    ctx.scale(Math.abs(this.scale.x), Math.abs(this.scale.y));\r\n\r\n    if (this.drawAroundAnchor) {\r\n      // In the case where you want the anchor to match with the point of draw\r\n      // Otherwise sprites are always drawn from top-left\r\n      ctx.translate(-anchorX, -anchorY);\r\n    }\r\n\r\n    ctx.translate(anchorX, anchorY);\r\n    ctx.rotate(rotation);\r\n    // This is for handling direction changes 1 or -1, that way we don't have mismatched translates()\r\n    ctx.scale(scaleDirX, scaleDirY);\r\n    ctx.translate(-anchorX, -anchorY);\r\n\r\n    if (flipHorizontal) {\r\n      ctx.translate(drawWidth, 0);\r\n      ctx.scale(-1, 1);\r\n    }\r\n\r\n    if (flipVertical) {\r\n      ctx.translate(0, drawHeight);\r\n      ctx.scale(1, -1);\r\n    }\r\n    const oldAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = opacity;\r\n    // Context is already rotated and scaled\r\n    ctx.drawImage(\r\n      this._spriteCanvas,\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height, // source\r\n      0,\r\n      0,\r\n      this.width,\r\n      this.height\r\n    ); // dest\r\n    ctx.globalAlpha = oldAlpha;\r\n    ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Produces a copy of the current sprite\r\n   */\r\n  public clone(): SpriteImpl {\r\n    const result = new Sprite(this.texture, this.x, this.y, this.width, this.height);\r\n    result.anchor = this.anchor.clone();\r\n    result.scale = this.scale.clone();\r\n    result.rotation = this.rotation;\r\n    result.flipHorizontal = this.flipHorizontal;\r\n    result.flipVertical = this.flipVertical;\r\n\r\n    const len = this.effects.length;\r\n    for (let i = 0; i < len; i++) {\r\n      result.addEffect(this.effects[i]);\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use [[Sprite]]\r\n */\r\nexport interface SpriteArgs extends Partial<SpriteImpl> {\r\n  image?: Texture;\r\n  x?: number;\r\n  width?: number;\r\n  height?: number;\r\n  rotation?: number;\r\n  anchor?: Vector;\r\n  scale?: Vector;\r\n  flipVertical?: boolean;\r\n  flipHorizontal?: boolean;\r\n}\r\n\r\n/**\r\n * A [[LegacyDrawing.Sprite]] is one of the main drawing primitives. It is responsible for drawing\r\n * images or parts of images from a [[LegacyDrawing.Texture]] resource to the screen.\r\n * @deprecated Use [[Sprite]]\r\n */\r\n@obsolete({\r\n  message: 'Label.clearTextShadow will be removed in v0.26.0',\r\n  alternateMethod: 'Use Label.font.shadow'\r\n})\r\nexport class Sprite extends Configurable(SpriteImpl) {\r\n  constructor(config: SpriteArgs);\r\n  constructor(image: Texture, x: number, y: number, width: number, height: number);\r\n  constructor(imageOrConfig: Texture | SpriteArgs, x?: number, y?: number, width?: number, height?: number) {\r\n    super(imageOrConfig, x, y, width, height);\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { ImageSource } from './ImageSource';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\n\r\nimport { Sprite as LegacySprite } from '../Drawing/Sprite';\r\nimport { Texture } from '../Drawing/Texture';\r\n\r\nexport type SourceView = { x: number; y: number; width: number; height: number };\r\nexport type DestinationSize = { width: number; height: number };\r\n\r\nexport interface SpriteOptions {\r\n  /**\r\n   * Image to create a sprite from\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * By default the source is the entire dimension of the [[ImageSource]]\r\n   */\r\n  sourceView?: { x: number; y: number; width: number; height: number };\r\n  /**\r\n   * By default the size of the final sprite is the size of the [[ImageSource]]\r\n   */\r\n  destSize?: { width: number; height: number };\r\n}\r\n\r\nexport class Sprite extends Graphic {\r\n  public image: ImageSource;\r\n  public sourceView: SourceView;\r\n  public destSize: DestinationSize;\r\n\r\n  public static from(image: ImageSource): Sprite {\r\n    return new Sprite({\r\n      image: image\r\n    });\r\n  }\r\n\r\n  constructor(options: GraphicOptions & SpriteOptions) {\r\n    super(options);\r\n    this.image = options.image;\r\n    const { width, height } = options;\r\n    this.sourceView = options.sourceView ?? { x: 0, y: 0, width: width ?? 0, height: height ?? 0 };\r\n    this.destSize = options.destSize ?? { width: width ?? 0, height: height ?? 0 };\r\n    this._updateSpriteDimensions();\r\n    this.image.ready.then(() => {\r\n      this._updateSpriteDimensions();\r\n    });\r\n  }\r\n\r\n  private _updateSpriteDimensions() {\r\n    const { width: nativeWidth, height: nativeHeight } = this.image;\r\n    // This code uses || to avoid 0's\r\n    // If the source is not specified, use the native dimension\r\n    this.sourceView.width = this.sourceView?.width || nativeWidth;\r\n    this.sourceView.height = this.sourceView?.height || nativeHeight;\r\n\r\n    // If the destination is not specified, use the source if specified, then native\r\n    this.destSize.width = this.destSize?.width || this.sourceView?.width || nativeWidth;\r\n    this.destSize.height = this.destSize?.height || this.sourceView?.height || nativeHeight;\r\n\r\n    this.width = Math.ceil(this.destSize.width);\r\n    this.height = Math.ceil(this.destSize.height);\r\n  }\r\n\r\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      this._updateSpriteDimensions();\r\n    }\r\n    super._preDraw(ex, x, y);\r\n  }\r\n\r\n  public _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\r\n    if (this.image.isLoaded()) {\r\n      this._updateSpriteDimensions();\r\n      ex.drawImage(\r\n        this.image.image,\r\n        this.sourceView.x,\r\n        this.sourceView.y,\r\n        this.sourceView.width,\r\n        this.sourceView.height,\r\n        x,\r\n        y,\r\n        this.destSize.width,\r\n        this.destSize.height\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a ImageSource from legacy texture\r\n   * @param sprite\r\n   */\r\n  public static fromLegacySprite(sprite: LegacySprite): Sprite {\r\n    const tex = sprite.texture;\r\n    const image = ImageSource.fromLegacyTexture(tex);\r\n    return new Sprite({\r\n      image,\r\n      sourceView: {\r\n        x: sprite.x,\r\n        y: sprite.y,\r\n        width: sprite.width,\r\n        height: sprite.height\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Converts a sprite to a Legacy sprite\r\n   * @deprecated\r\n   * @param sprite\r\n   * @returns LegacyDrawing.Sprite\r\n   */\r\n  public static toLegacySprite(sprite: Sprite): LegacySprite {\r\n    const image = sprite.image;\r\n    const tex = new Texture(image.path);\r\n    tex.data = image.image;\r\n\r\n    return new LegacySprite(tex, sprite.sourceView.x, sprite.sourceView.y, sprite.sourceView.width, sprite.sourceView.height);\r\n  }\r\n\r\n  public clone(): Sprite {\r\n    return new Sprite({\r\n      image: this.image,\r\n      sourceView: { ...this.sourceView },\r\n      destSize: { ...this.destSize },\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n}\r\n","import { Resource } from '../Resources/Resource';\r\nimport { Texture } from '../Drawing/Texture';\r\nimport { Sprite } from './Sprite';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { Logger } from '../Util/Log';\r\n\r\nexport class ImageSource implements Loadable<HTMLImageElement> {\r\n  private _logger = Logger.getInstance();\r\n  private _resource: Resource<Blob>;\r\n\r\n  /**\r\n   * The original size of the source image in pixels\r\n   */\r\n  public get width() {\r\n    return this.image.naturalWidth;\r\n  }\r\n\r\n  /**\r\n   * The original height of the source image in pixels\r\n   */\r\n  public get height() {\r\n    return this.image.naturalHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the Texture is completely loaded and is ready\r\n   * to be drawn.\r\n   */\r\n  public isLoaded(): boolean {\r\n    return !!this.data.src;\r\n  }\r\n\r\n  /**\r\n   * Access to the underlying html image elmeent\r\n   */\r\n  public data: HTMLImageElement = new Image();\r\n  public get image(): HTMLImageElement {\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Promise the resolves when the image is loaded and ready for use, does not initiate loading\r\n   */\r\n  public ready: Promise<HTMLImageElement>;\r\n  private _loadedResolve: (value?: HTMLImageElement | PromiseLike<HTMLImageElement>) => void;\r\n\r\n  /**\r\n   * The path to the image, can also be a data url like 'data:image/'\r\n   * @param path\r\n   */\r\n  constructor(public readonly path: string, bustCache: boolean = false) {\r\n    this._resource = new Resource(path, 'blob', bustCache);\r\n    if (path.endsWith('.svg') || path.endsWith('.gif')) {\r\n      this._logger.warn(`Image type is not fully supported, you may have mixed results ${path}. Fully supported: jpg, bmp, and png`);\r\n    }\r\n    this.ready = new Promise<HTMLImageElement>((resolve) => {\r\n      this._loadedResolve = resolve;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Begins loading the image and returns a promise that resolves when the image is loaded\r\n   */\r\n  async load(): Promise<HTMLImageElement> {\r\n    if (this.isLoaded()) {\r\n      return this.data;\r\n    }\r\n    try {\r\n      // Load base64 or blob if needed\r\n      let url: string;\r\n      if (!this.path.includes('data:image/')) {\r\n        const blob = await this._resource.load();\r\n        url = URL.createObjectURL(blob);\r\n      } else {\r\n        url = this.path;\r\n      }\r\n\r\n      // Decode the image\r\n      const image = new Image();\r\n      image.src = url;\r\n      await image.decode();\r\n\r\n      // Set results\r\n      this.data = image;\r\n    } catch (error) {\r\n      throw `Error loading ImageSource from path '${this.path}' with error [${error.message}]`;\r\n    }\r\n    // todo emit complete\r\n    this._loadedResolve(this.data);\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Build a sprite from this ImageSource\r\n   */\r\n  public toSprite(): Sprite {\r\n    return Sprite.from(this);\r\n  }\r\n\r\n  /**\r\n   * Create a ImageSource from legacy texture\r\n   * @param tex\r\n   */\r\n  public static fromLegacyTexture(tex: Texture): ImageSource {\r\n    const image = new ImageSource(tex.path);\r\n    if (tex.isLoaded()) {\r\n      image.data = tex.data;\r\n    } else {\r\n      tex.loaded.then(() => {\r\n        image.data = tex.data;\r\n      });\r\n    }\r\n    return image;\r\n  }\r\n\r\n  /**\r\n   * Unload images from memory\r\n   */\r\n  unload(): void {\r\n    this.data = new Image();\r\n  }\r\n}\r\n","import { Sprite } from './Sprite';\r\nimport * as Effects from './SpriteEffects';\r\nimport { Color } from '../Color';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Vector } from '../Math/vector';\r\nimport { Engine } from '../Engine';\r\nimport * as Util from '../Util/Util';\r\nimport { Configurable } from '../Configurable';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * @deprecated Use [[HasTick]]\r\n */\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\n/**\r\n * @hidden\r\n * @deprecated Use [[Animation]]\r\n */\r\nexport class AnimationImpl implements Drawable, HasTick {\r\n  /**\r\n   * The sprite frames to play, in order. See [[SpriteSheet.getAnimationForAll]] to quickly\r\n   * generate an [[Animation]].\r\n   */\r\n  public sprites: Sprite[] = [];\r\n\r\n  /**\r\n   * Duration to show each frame (in milliseconds)\r\n   */\r\n  public speed: number;\r\n\r\n  /**\r\n   * Current frame index being shown\r\n   */\r\n  public currentFrame: number = 0;\r\n\r\n  private _timeLeftInFrame: number = 0;\r\n  private _idempotencyToken: number = -1;\r\n\r\n  public anchor: Vector = Vector.Zero;\r\n  public rotation: number = 0.0;\r\n  public scale: Vector = Vector.One;\r\n\r\n  /**\r\n   * Indicates whether the animation should loop after it is completed\r\n   */\r\n  public loop: boolean = true;\r\n\r\n  /**\r\n   * Indicates the frame index the animation should freeze on for a non-looping\r\n   * animation. By default it is the last frame.\r\n   */\r\n  public freezeFrame: number = -1;\r\n\r\n  private _engine: Engine;\r\n\r\n  /**\r\n   * Flip each frame vertically. Sets [[Sprite.flipVertical]].\r\n   */\r\n  public flipVertical: boolean = false;\r\n\r\n  /**\r\n   * Flip each frame horizontally. Sets [[Sprite.flipHorizontal]].\r\n   */\r\n  public flipHorizontal: boolean = false;\r\n\r\n  public drawWidth: number = 0;\r\n  public drawHeight: number = 0;\r\n  public width: number = 0;\r\n  public height: number = 0;\r\n\r\n  private _opacity = 1;\r\n\r\n  /**\r\n   * Typically you will use a [[SpriteSheet]] to generate an [[Animation]].\r\n   *\r\n   * @param engineOrConfig  Reference to the current game engine\r\n   * @param sprites  An array of sprites to create the frames for the animation\r\n   * @param speed   The number in milliseconds to display each frame in the animation\r\n   * @param loop    Indicates whether the animation should loop after it is completed\r\n   */\r\n  constructor(engineOrConfig: Engine | AnimationArgs, sprites: Sprite[], speed: number, loop?: boolean) {\r\n    let engine = engineOrConfig;\r\n    if (engineOrConfig && !(engineOrConfig instanceof Engine)) {\r\n      const config = engineOrConfig;\r\n      engine = config.engine;\r\n      sprites = config.sprites;\r\n      speed = config.speed;\r\n      loop = config.loop;\r\n    }\r\n\r\n    this.sprites = sprites;\r\n    this.speed = speed;\r\n    this._engine = <Engine>engine;\r\n    this._timeLeftInFrame = this.speed;\r\n\r\n    if (loop != null) {\r\n      this.loop = loop;\r\n    }\r\n\r\n    if (sprites && sprites[0]) {\r\n      this.drawHeight = sprites[0] ? sprites[0].drawHeight : 0;\r\n      this.drawWidth = sprites[0] ? sprites[0].drawWidth : 0;\r\n\r\n      this.width = sprites[0] ? sprites[0].width : 0;\r\n      this.height = sprites[0] ? sprites[0].height : 0;\r\n\r\n      this.freezeFrame = sprites.length - 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the opacity effect to a sprite, setting the alpha of all pixels to a given value\r\n   */\r\n  public opacity(value: number) {\r\n    this._opacity = value;\r\n  }\r\n\r\n  /**\r\n   * Applies the grayscale effect to a sprite, removing color information.\r\n   */\r\n  public grayscale() {\r\n    this.addEffect(new Effects.Grayscale());\r\n  }\r\n\r\n  /**\r\n   * Applies the invert effect to a sprite, inverting the pixel colors.\r\n   */\r\n  public invert() {\r\n    this.addEffect(new Effects.Invert());\r\n  }\r\n\r\n  /**\r\n   * Applies the fill effect to a sprite, changing the color channels of all non-transparent pixels to match a given color\r\n   */\r\n  public fill(color: Color) {\r\n    this.addEffect(new Effects.Fill(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the colorize effect to a sprite, changing the color channels of all pixels to be the average of the original color and the\r\n   * provided color.\r\n   */\r\n  public colorize(color: Color) {\r\n    this.addEffect(new Effects.Colorize(color));\r\n  }\r\n\r\n  /**\r\n   * Applies the lighten effect to a sprite, changes the lightness of the color according to hsl\r\n   */\r\n  public lighten(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Lighten(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the darken effect to a sprite, changes the darkness of the color according to hsl\r\n   */\r\n  public darken(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Darken(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the saturate effect to a sprite, saturates the color according to hsl\r\n   */\r\n  public saturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Saturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Applies the desaturate effect to a sprite, desaturates the color according to hsl\r\n   */\r\n  public desaturate(factor: number = 0.1) {\r\n    this.addEffect(new Effects.Desaturate(factor));\r\n  }\r\n\r\n  /**\r\n   * Add a [[SpriteEffect]] manually\r\n   */\r\n  public addEffect(effect: Effects.SpriteEffect) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].addEffect(effect);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an [[SpriteEffect]] from this animation.\r\n   * @param effect Effect to remove from this animation\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n\r\n  /**\r\n   * Removes an effect given the index from this animation.\r\n   * @param index  Index of the effect to remove from this animation\r\n   */\r\n  public removeEffect(index: number): void;\r\n  public removeEffect(param: any) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].removeEffect(param);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all sprite effects\r\n   */\r\n  public clearEffects() {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].clearEffects();\r\n    }\r\n  }\r\n\r\n  private _setAnchor(point: Vector) {\r\n    //if (!this.anchor.equals(point)) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].anchor.setTo(point.x, point.y);\r\n    }\r\n    //}\r\n  }\r\n\r\n  private _setRotation(radians: number) {\r\n    //if (this.rotation !== radians) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].rotation = radians;\r\n    }\r\n    //}\r\n  }\r\n\r\n  private _setScale(scale: Vector) {\r\n    //if (!this.scale.equals(scale)) {\r\n    for (const i in this.sprites) {\r\n      this.sprites[i].scale = scale;\r\n    }\r\n    //}\r\n  }\r\n\r\n  /**\r\n   * Resets the animation to first frame.\r\n   */\r\n  public reset() {\r\n    this.currentFrame = 0;\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the animation is complete, animations that loop are never complete.\r\n   */\r\n  public isDone() {\r\n    return !this.loop && this.currentFrame >= this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Not meant to be called by game developers. Ticks the animation forward internally and\r\n   * calculates whether to change to the frame.\r\n   * @internal\r\n   */\r\n  public tick(elapsed: number, idempotencyToken?: number) {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    this._timeLeftInFrame -= elapsed;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.currentFrame = this.loop ? (this.currentFrame + 1) % this.sprites.length : this.currentFrame + 1;\r\n      this._timeLeftInFrame = this.speed;\r\n    }\r\n\r\n    this._updateValues();\r\n    const current = this.sprites[this.currentFrame];\r\n    if (current) {\r\n      this.width = current.width;\r\n      this.height = current.height;\r\n      this.drawWidth = current.drawWidth;\r\n      this.drawHeight = current.drawHeight;\r\n    }\r\n  }\r\n\r\n  private _updateValues(): void {\r\n    this._setAnchor(this.anchor);\r\n    this._setRotation(this.rotation);\r\n    this._setScale(this.scale);\r\n  }\r\n\r\n  /**\r\n   * Skips ahead a specified number of frames in the animation\r\n   * @param frames  Frames to skip ahead\r\n   */\r\n  public skip(frames: number) {\r\n    this.currentFrame = (this.currentFrame + frames) % this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Draws the animation appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the animation with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number) {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const animOptions = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.drawWidth,\r\n      drawHeight: options.drawHeight ?? this.drawHeight,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      opacity: (options.opacity ?? 1) * (this._opacity ?? 1)\r\n    };\r\n\r\n    this._updateValues();\r\n    let currSprite: Sprite;\r\n    if (this.currentFrame < this.sprites.length) {\r\n      currSprite = this.sprites[this.currentFrame];\r\n      currSprite.draw(animOptions);\r\n    }\r\n\r\n    if (this.freezeFrame !== -1 && this.currentFrame >= this.sprites.length) {\r\n      currSprite = this.sprites[Util.clamp(this.freezeFrame, 0, this.sprites.length - 1)];\r\n      currSprite.draw(animOptions);\r\n    }\r\n\r\n    // add the calculated width\r\n    if (currSprite) {\r\n      this.drawWidth = currSprite.drawWidth;\r\n      this.drawHeight = currSprite.drawHeight;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Plays an animation at an arbitrary location in the game.\r\n   * @param x  The x position in the game to play\r\n   * @param y  The y position in the game to play\r\n   */\r\n  public play(x: number, y: number) {\r\n    this.reset();\r\n    this._engine.playAnimation(this, x, y);\r\n  }\r\n}\r\n\r\n/**\r\n * @deprecated Use [[Animation]]\r\n */\r\nexport interface AnimationArgs extends Partial<AnimationImpl> {\r\n  engine: Engine;\r\n  sprites: Sprite[];\r\n  speed: number;\r\n  loop?: boolean;\r\n  anchor?: Vector;\r\n  rotation?: number;\r\n  scale?: Vector;\r\n  flipVertical?: boolean;\r\n  flipHorizontal?: boolean;\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\n/**\r\n * Animations allow you to display a series of images one after another,\r\n * creating the illusion of change. Generally these images will come from a [[SpriteSheet]] source.\r\n * @deprecated Use [[Animation]]\r\n */\r\n@obsolete({\r\n  message: 'Animation will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.Animation'\r\n})\r\nexport class Animation extends Configurable(AnimationImpl) {\r\n  constructor(config: AnimationArgs);\r\n  constructor(engine: Engine, images: Sprite[], speed: number, loop?: boolean);\r\n  constructor(engineOrConfig: Engine | AnimationArgs, images?: Sprite[], speed?: number, loop?: boolean) {\r\n    super(engineOrConfig, images, speed, loop);\r\n  }\r\n}\r\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\n\n/**\n * Enum representing the different font size units\n * https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n */\nexport enum FontUnit {\n  /**\n   * Em is a scalable unit, 1 em is equal to the current font size of the current element, parent elements can effect em values\n   */\n  Em = 'em',\n  /**\n   * Rem is similar to the Em, it is a scalable unit. 1 rem is equal to the font size of the root element\n   */\n  Rem = 'rem',\n  /**\n   * Pixel is a unit of length in screen pixels\n   */\n  Px = 'px',\n  /**\n   * Point is a physical unit length (1/72 of an inch)\n   */\n  Pt = 'pt',\n  /**\n   * Percent is a scalable unit similar to Em, the only difference is the Em units scale faster when Text-Size stuff\n   */\n  Percent = '%'\n}\n\n/**\n * Enum representing the different horizontal text alignments\n */\nexport enum TextAlign {\n  /**\n   * The text is left-aligned.\n   */\n  Left = 'left',\n  /**\n   * The text is right-aligned.\n   */\n  Right = 'right',\n  /**\n   * The text is centered.\n   */\n  Center = 'center',\n  /**\n   * The text is aligned at the normal start of the line (left-aligned for left-to-right locales,\n   * right-aligned for right-to-left locales).\n   */\n  Start = 'start',\n  /**\n   * The text is aligned at the normal end of the line (right-aligned for left-to-right locales,\n   * left-aligned for right-to-left locales).\n   */\n  End = 'end'\n}\n\n/**\n * Enum representing the different baseline text alignments\n */\nexport enum BaseAlign {\n  /**\n   * The text baseline is the top of the em square.\n   */\n  Top = 'top',\n  /**\n   * The text baseline is the hanging baseline.  Currently unsupported; this will act like\n   * alphabetic.\n   */\n  Hanging = 'hanging',\n  /**\n   * The text baseline is the middle of the em square.\n   */\n  Middle = 'middle',\n  /**\n   * The text baseline is the normal alphabetic baseline.\n   */\n  Alphabetic = 'alphabetic',\n  /**\n   * The text baseline is the ideographic baseline; this is the bottom of\n   * the body of the characters, if the main body of characters protrudes\n   * beneath the alphabetic baseline.  Currently unsupported; this will\n   * act like alphabetic.\n   */\n  Ideographic = 'ideographic',\n  /**\n   * The text baseline is the bottom of the bounding box.  This differs\n   * from the ideographic baseline in that the ideographic baseline\n   * doesn't consider descenders.\n   */\n  Bottom = 'bottom'\n}\n\n/**\n * Enum representing the different possible font styles\n */\nexport enum FontStyle {\n  Normal = 'normal',\n  Italic = 'italic',\n  Oblique = 'oblique'\n}\n\nexport enum Direction {\n  LeftToRight = 'ltr',\n  RightToLeft = 'rtl'\n}\n\nexport interface FontOptions {\n  size?: number;\n  unit?: FontUnit;\n  lineHeight?: number;\n  family?: string;\n  style?: FontStyle;\n  bold?: boolean;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  direction?: Direction;\n  quality?: number;\n  shadow?: {\n    blur?: number;\n    offset?: Vector;\n    color?: Color;\n  };\n}\n\nexport interface FontRenderer {\n  render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number): void;\n}\n","import { Sprite, SpriteArgs } from './Sprite';\nimport { Animation } from './Animation';\nimport { Color } from '../Color';\nimport * as Effects from './SpriteEffects';\n\nimport { Texture } from './Texture';\nimport { Engine } from '../Engine';\nimport { Logger } from '../Util/Log';\nimport { BaseAlign, TextAlign } from '../Graphics/FontCommon';\nimport { obsolete } from '../Util/Decorators';\nimport { vec } from '../Math/vector';\n\nexport interface SpriteSheetArgs {\n  image: Texture;\n  sprites?: Sprite[];\n  spWidth: number;\n  spHeight: number;\n  rows: number;\n  columns: number;\n  spacing?: number | SpriteSheetSpacingDimensions;\n}\n\nexport interface SpriteSheetSpacingDimensions {\n  top?: number;\n  left?: number;\n  margin?: number;\n}\n\n/**\n * Sprite sheets are a useful mechanism for slicing up image resources into\n * separate sprites or for generating in game animations. [[Sprite|Sprites]] are organized\n * in row major order in the [[SpriteSheet]].\n * @deprecated Will be removed in v0.26.0\n */\nexport class SpriteSheet {\n  private _sprites: Sprite[] = [];\n  private _image: Texture | null = null;\n  private _columns: number = 0;\n  private _rows: number = 0;\n  private _spWidth: number = 0;\n  private _spHeight: number = 0;\n  private _spacing: number | SpriteSheetSpacingDimensions = 0;\n\n  /**\n   * @param config    The configuration of the SpriteSheet\n   */\n  constructor(config: SpriteSheetArgs);\n\n  /**\n   * @param sprites   The backing sprite array to use, if already available\n   */\n  constructor(sprites: Sprite[]);\n\n  /**\n   * @param image     The backing image texture to build the SpriteSheet\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    image: Texture,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfigOrSprites The backing image texture to build the SpriteSheet, option bag, or sprite list\n   * @param columns   The number of columns in the image texture\n   * @param rows      The number of rows in the image texture\n   * @param spWidth   The width of each individual sprite in pixels\n   * @param spHeight  The height of each individual sprite in pixels\n   * @param spacing   The spacing between every sprite in a spritesheet\n   */\n  constructor(\n    imageOrConfigOrSprites: Texture | SpriteSheetArgs | Sprite[],\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    let loadFromImage: boolean = false;\n    if (imageOrConfigOrSprites instanceof Array) {\n      this._sprites = imageOrConfigOrSprites;\n    } else {\n      if (imageOrConfigOrSprites && !(imageOrConfigOrSprites instanceof Texture)) {\n        this._columns = imageOrConfigOrSprites.columns;\n        this._rows = imageOrConfigOrSprites.rows;\n        this._spWidth = imageOrConfigOrSprites.spWidth;\n        this._spHeight = imageOrConfigOrSprites.spHeight;\n        this._image = imageOrConfigOrSprites.image;\n        this._spacing = imageOrConfigOrSprites.spacing || 0;\n      } else {\n        this._image = <Texture>imageOrConfigOrSprites;\n        this._columns = columns;\n        this._rows = rows;\n        this._spWidth = spWidth;\n        this._spHeight = spHeight;\n        this._spacing = spacing || 0;\n      }\n      this._sprites = new Array(this._columns * this._rows);\n      loadFromImage = true;\n    }\n\n    // Inspect actual image dimensions with preloading\n    if (this.image instanceof Texture) {\n      let isWidthError: boolean = false;\n      let isHeightError: boolean = false;\n      if (this.image.isLoaded()) {\n        isWidthError = this.spWidth * this.columns > this.image.image.naturalWidth;\n        isHeightError = this.spHeight * this.rows > this.image.image.naturalHeight;\n        if (isWidthError) {\n          throw new RangeError(\n            `SpriteSheet specified is wider, ` +\n              `${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} ` +\n              `pixels than image width`\n          );\n        }\n        if (isHeightError) {\n          throw new RangeError(\n            `SpriteSheet specified is taller, ` +\n              `${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} ` +\n              `pixels than image height`\n          );\n        }\n      }\n    }\n\n    if (loadFromImage) {\n      const spacing = this.getSpacingDimensions();\n\n      for (let row = 0; row < this.rows; row++) {\n        for (let col = 0; col < this.columns; col++) {\n          this._sprites[col + row * this.columns] = new Sprite(\n            this.image,\n            col * this.spWidth + spacing.margin * col + spacing.left,\n            row * this.spHeight + spacing.margin * row + spacing.top,\n            this.spWidth,\n            this.spHeight\n          );\n        }\n      }\n    }\n  }\n\n  /**\n   * Gets the raw spacing dimensions for the sprites in the sheet, which can be a fixed number or custom dimensions.\n   */\n  public get spacing() {\n    return this._spacing;\n  }\n\n  /**\n   * Get a copy of the backing sprite array\n   */\n  public get sprites() {\n    return [...this._sprites];\n  }\n\n  /**\n   * The backing texture used for the sprite sheet\n   */\n  public get image() {\n    return this._image;\n  }\n\n  /**\n   * The number of columns in the sheet\n   */\n  public get columns() {\n    return this._columns;\n  }\n\n  /**\n   * The number of rows in the sheet\n   */\n  public get rows() {\n    return this._rows;\n  }\n\n  /**\n   * The width of the individual sprites\n   */\n  public get spWidth() {\n    return this._spWidth;\n  }\n\n  /**\n   * The height of the individual sprites\n   */\n  public get spHeight() {\n    return this._spHeight;\n  }\n\n  /**\n   * Gets the calculated spacing dimensions based on whether spacing\n   * is a fixed number or has different values for each dimension\n   */\n  public getSpacingDimensions(): SpriteSheetSpacingDimensions {\n    if (typeof this.spacing === 'number') {\n      return {\n        left: this.spacing,\n        top: this.spacing,\n        margin: this.spacing\n      };\n    } else {\n      return {\n        left: this.spacing.left ?? 0,\n        top: this.spacing.top ?? 0,\n        margin: this.spacing.margin ?? 0\n      };\n    }\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by listing out the\n   * sprite indices. Sprites are organized in row major order in the SpriteSheet.\n   * @param engine   Reference to the current game [[Engine]]\n   * @param indices  An array of sprite indices to use in the animation\n   * @param speed    The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationByIndices(engine: Engine, indices: number[], speed: number) {\n    let images: Sprite[] = indices.map((index) => {\n      return this.sprites[index];\n    });\n\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Create an animation from the this SpriteSheet by specifying the range of\n   * images with the beginning (inclusive) and ending (exclusive) index\n   * For example `getAnimationBetween(engine, 0, 5, 200)` returns an animation with 5 frames.\n   * @param engine      Reference to the current game Engine\n   * @param beginIndex  The index to start taking frames (inclusive)\n   * @param endIndex    The index to stop taking frames (exclusive)\n   * @param speed       The number in milliseconds to display each frame in the animation\n   */\n  public getAnimationBetween(engine: Engine, beginIndex: number, endIndex: number, speed: number) {\n    let images = this.sprites.slice(beginIndex, endIndex);\n    images = images.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, images, speed);\n  }\n\n  /**\n   * Treat the entire SpriteSheet as one animation, organizing the frames in\n   * row major order.\n   * @param engine  Reference to the current game [[Engine]]\n   * @param speed   The number in milliseconds to display each frame the animation\n   */\n  public getAnimationForAll(engine: Engine, speed: number) {\n    const sprites = this.sprites.map(function (i) {\n      return i.clone();\n    });\n    return new Animation(engine, sprites, speed);\n  }\n\n  /**\n   * Retrieve a specific sprite from the SpriteSheet by its index. Sprites are organized\n   * in row major order in the SpriteSheet.\n   * @param index  The index of the sprite\n   */\n  public getSprite(index: number): Sprite {\n    if (index >= 0 && index < this.sprites.length) {\n      return this.sprites[index];\n    } else {\n      throw new Error('Invalid index: ' + index);\n    }\n  }\n\n  /**\n   * Get an animation with bespoke sprite coordinates. This is useful if the SpriteSheet is\n   * packed and not a uniform width or height. The resulting [[Animation]] will have the height and width of the\n   * largest dimension (width, height) from among the sprite coordinates\n   * @param engine\n   * @param spriteCoordinates\n   * @param speed\n   */\n  public getAnimationByCoords(engine: Engine, spriteCoordinates: SpriteArgs[], speed: number): Animation {\n    let maxWidth: number = 0;\n    let maxHeight: number = 0;\n    const sprites: Sprite[] = new Array(spriteCoordinates.length);\n    for (let i = 0; i < spriteCoordinates.length; i++) {\n      const coord = spriteCoordinates[i];\n      // no need to pass image again if using a spritesheet\n      coord.image = coord.image || this.image;\n      maxWidth = Math.max(maxWidth, coord.drawWidth);\n      maxHeight = Math.max(maxHeight, coord.drawHeight);\n      sprites[i] = new Sprite(coord);\n    }\n\n    const anim = new Animation(engine, sprites, speed);\n\n    anim.drawWidth = maxWidth;\n    anim.drawHeight = maxHeight;\n    return anim;\n  }\n}\n\n/**\n * Specify various font attributes for sprite fonts\n */\nexport interface SpriteFontOptions {\n  color?: Color;\n  opacity?: number;\n  fontSize?: number;\n  letterSpacing?: number;\n  textAlign?: TextAlign;\n  baseAlign?: BaseAlign;\n  maxWidth?: number;\n}\n\nexport interface SpriteFontArgs extends SpriteSheetArgs {\n  alphabet: string;\n  caseInsensitive: boolean;\n}\n\n/**\n * Sprite fonts are a used in conjunction with a [[Label]] to specify\n * a particular bitmap as a font. Note that some font features are not\n * supported by Sprite fonts.\n * @deprecated Will be removed into v0.26.0\n */\n@obsolete({\n  message: 'SpriteSheet will be removed in v0.26.0',\n  alternateMethod: 'Use Graphics.SpriteSheet'\n})\nexport class SpriteFont extends SpriteSheet {\n  private _currentColor: Color = Color.Black;\n  private _currentOpacity: Number = 1.0;\n  private _spriteRecord: Record<string, Sprite> = {};\n\n  // text shadow\n  private _textShadowOn: boolean = false;\n  private _textShadowDirty: boolean = true;\n  private _textShadowColor: Color = Color.Black;\n  private _textShadowSprites: { [key: string]: Sprite } = {};\n  private _shadowOffsetX: number = 5;\n  private _shadowOffsetY: number = 5;\n  public readonly alphabet: string;\n  public readonly caseInsensitive: boolean;\n\n  constructor(config: SpriteFontArgs);\n\n  constructor(\n    image: Texture,\n    alphabet: string,\n    caseInsensitive: boolean,\n    columns: number,\n    rows: number,\n    spWidth: number,\n    spHeight: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  );\n\n  /**\n   * @param imageOrConfig   The backing image texture to build the SpriteFont or the sprite font option bag\n   * @param alphabet        A string representing all the characters in the image, in row major order.\n   * @param caseInsensitive  Indicate whether this font takes case into account\n   * @param columns         The number of columns of characters in the image\n   * @param rows            The number of rows of characters in the image\n   * @param spWidth         The width of each character in pixels\n   * @param spHeight        The height of each character in pixels\n   */\n  constructor(\n    imageOrConfig: Texture | SpriteFontArgs,\n    alphabet?: string,\n    caseInsensitive?: boolean,\n    columns?: number,\n    rows?: number,\n    spWidth?: number,\n    spHeight?: number,\n    spacing?: number | SpriteSheetSpacingDimensions\n  ) {\n    super(\n      imageOrConfig instanceof Texture\n        ? {\n          image: imageOrConfig,\n          spWidth: spWidth,\n          spHeight: spHeight,\n          rows: rows,\n          columns: columns,\n          spacing: spacing || 0\n        }\n        : imageOrConfig\n    );\n\n    if (imageOrConfig && !(imageOrConfig instanceof Texture)) {\n      alphabet = imageOrConfig.alphabet;\n      caseInsensitive = imageOrConfig.caseInsensitive;\n    }\n\n    this.alphabet = alphabet;\n    this.caseInsensitive = caseInsensitive;\n    this._spriteRecord = this.getTextSprites();\n  }\n\n  /**\n   * Returns a dictionary that maps each character in the alphabet to the appropriate [[Sprite]].\n   */\n  public getTextSprites(): { [key: string]: Sprite } {\n    const lookup: { [key: string]: Sprite } = {};\n    for (let i = 0; i < this.alphabet.length; i++) {\n      let char = this.alphabet[i];\n      if (this.caseInsensitive) {\n        char = char.toLowerCase();\n      }\n      lookup[char] = this.sprites[i].clone();\n    }\n    return lookup;\n  }\n\n  /**\n   * Sets the text shadow for sprite fonts\n   * @param offsetX      The x offset in pixels to place the shadow\n   * @param offsetY      The y offset in pixels to place the shadow\n   * @param shadowColor  The color of the text shadow\n   */\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\n    this._textShadowOn = true;\n    this._shadowOffsetX = offsetX;\n    this._shadowOffsetY = offsetY;\n    this._textShadowColor = shadowColor.clone();\n    this._textShadowDirty = true;\n    for (const character in this._spriteRecord) {\n      this._textShadowSprites[character] = this._spriteRecord[character].clone();\n    }\n  }\n\n  /**\n   * Toggles text shadows on or off\n   */\n  public useTextShadow(on: boolean) {\n    this._textShadowOn = on;\n    if (on) {\n      this.setTextShadow(5, 5, this._textShadowColor);\n    }\n  }\n\n  /**\n   * Draws the current sprite font\n   */\n  public draw(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, options: SpriteFontOptions) {\n    options = this._parseOptions(options);\n\n    if (this._currentColor.toString() !== options.color.toString() || this._currentOpacity !== options.opacity) {\n      this._currentOpacity = options.opacity;\n      this._currentColor = options.color;\n      for (const char in this._spriteRecord) {\n        this._spriteRecord[char].clearEffects();\n        this._spriteRecord[char].fill(options.color);\n        this._spriteRecord[char].opacity(options.opacity);\n      }\n    }\n\n    if (this._textShadowOn && this._textShadowDirty && this._textShadowColor) {\n      for (const characterShadow in this._textShadowSprites) {\n        this._textShadowSprites[characterShadow].clearEffects();\n        this._textShadowSprites[characterShadow].addEffect(new Effects.Fill(this._textShadowColor.clone()));\n      }\n      this._textShadowDirty = false;\n    }\n\n    // find the current length of text in pixels\n    const sprite = this.sprites[0];\n\n    // find the current height fo the text in pixels\n    const height = sprite.height;\n\n    // calculate appropriate scale for font size\n    const scale = options.fontSize / height;\n\n    const length = text.length * sprite.width * scale + text.length * options.letterSpacing;\n\n    let currX = x;\n    if (options.textAlign === TextAlign.Left || options.textAlign === TextAlign.Start) {\n      currX = x;\n    } else if (options.textAlign === TextAlign.Right || options.textAlign === TextAlign.End) {\n      currX = x - length;\n    } else if (options.textAlign === TextAlign.Center) {\n      currX = x - length / 2;\n    }\n\n    let currY = y - height * scale;\n    if (options.baseAlign === BaseAlign.Top || options.baseAlign === BaseAlign.Hanging) {\n      currY = y;\n    } else if (\n      options.baseAlign === BaseAlign.Ideographic ||\n      options.baseAlign === BaseAlign.Bottom ||\n      options.baseAlign === BaseAlign.Alphabetic\n    ) {\n      currY = y - height * scale;\n    } else if (options.baseAlign === BaseAlign.Middle) {\n      currY = y - (height * scale) / 2;\n    }\n\n    for (let i = 0; i < text.length; i++) {\n      let character = text[i];\n      if (this.caseInsensitive) {\n        character = character.toLowerCase();\n      }\n      try {\n        // if text shadow\n        if (this._textShadowOn) {\n          this._textShadowSprites[character].drawAroundAnchor = false;\n          this._textShadowSprites[character].scale = vec(scale, scale);\n          this._textShadowSprites[character].draw(ctx, currX + this._shadowOffsetX, currY + this._shadowOffsetY);\n        }\n\n        const charSprite = this._spriteRecord[character];\n        charSprite.drawAroundAnchor = false;\n        charSprite.scale = vec(scale, scale);\n        charSprite.draw(ctx, currX, currY);\n        currX += charSprite.drawWidth + options.letterSpacing;\n      } catch (e) {\n        Logger.getInstance().error(`SpriteFont Error drawing char ${character}`);\n      }\n    }\n  }\n\n  private _parseOptions(options: SpriteFontOptions): SpriteFontOptions {\n    return {\n      fontSize: options.fontSize || 10,\n      letterSpacing: options.letterSpacing || 0,\n      color: options.color || Color.Black,\n      textAlign: typeof options.textAlign === undefined ? TextAlign.Left : options.textAlign,\n      baseAlign: typeof options.baseAlign === undefined ? BaseAlign.Bottom : options.baseAlign,\n      maxWidth: options.maxWidth || -1,\n      opacity: options.opacity || 0\n    };\n  }\n}\n","import { ImageSource } from './ImageSource';\r\nimport { Sprite } from './Sprite';\r\nimport { SpriteSheet as LegacySpriteSheet } from '../Drawing/SpriteSheet';\r\nimport { Logger } from '..';\r\n\r\n\r\n/**\r\n * Specify sprite sheet spacing options, useful if your sprites are not tightly packed\r\n * and have space between them.\r\n */\r\nexport interface SpriteSheetSpacingDimensions {\r\n  /**\r\n   * The starting point to offset and start slicing the sprite sheet from the top left of the image.\r\n   * Default is (0, 0)\r\n   */\r\n  originOffset?: { x?: number, y?: number };\r\n\r\n  /**\r\n   * The margin between sprites.\r\n   * Default is (0, 0)\r\n   */\r\n  margin?: {x?: number, y?: number};\r\n}\r\n\r\n/**\r\n * Sprite sheet options for slicing up images\r\n */\r\nexport interface SpriteSheetGridOptions {\r\n  /**\r\n   * Source image to use for each sprite\r\n   */\r\n  image: ImageSource;\r\n  /**\r\n   * Grid definition for the sprite sheet\r\n   */\r\n  grid: {\r\n    /**\r\n     * Number of rows in the sprite sheet\r\n     */\r\n    rows: number;\r\n    /**\r\n     * Number of columns in the sprite sheet\r\n     */\r\n    columns: number;\r\n    /**\r\n     * Width of each individual sprite\r\n     */\r\n    spriteWidth: number;\r\n    /**\r\n     * Height of each individual sprite\r\n     */\r\n    spriteHeight: number;\r\n  };\r\n  /**\r\n   * Optionally specifiy any spacing information between sprites\r\n   */\r\n  spacing?: SpriteSheetSpacingDimensions;\r\n}\r\n\r\nexport interface SpriteSheetOptions {\r\n  /**\r\n   * Source sprites for the sprite sheet\r\n   */\r\n  sprites: Sprite[];\r\n  /**\r\n   * Optionally specify the number of rows in a sprite sheet (default 1 row)\r\n   */\r\n  rows?: number;\r\n  /**\r\n   * Optionally specify the number of columns in a sprite sheet (default sprites.length)\r\n   */\r\n  columns?: number;\r\n}\r\n\r\n/**\r\n * Represents a collection of sprites from a source image with some organization in a grid\r\n */\r\nexport class SpriteSheet {\r\n  private _logger = Logger.getInstance();\r\n  public readonly sprites: Sprite[] = [];\r\n  public readonly rows: number;\r\n  public readonly columns: number;\r\n\r\n  /**\r\n   * Build a new sprite sheet from a list of sprites\r\n   *\r\n   * Use [[SpriteSheet.fromImageSource]] to create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   * @param options\r\n   */\r\n  constructor(options: SpriteSheetOptions) {\r\n    const { sprites, rows, columns } = options;\r\n    this.sprites = sprites;\r\n    this.rows = rows ?? 1;\r\n    this.columns = columns ?? this.sprites.length;\r\n  }\r\n\r\n  /**\r\n   * Find a sprite by their x/y position in the SpriteSheet, for example `getSprite(0, 0)` is the [[Sprite]] in the top-left\r\n   * @param x\r\n   * @param y\r\n   */\r\n  public getSprite(x: number, y: number): Sprite | null {\r\n    if (x >= this.columns || x < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), x: ${x} should be between 0 and ${this.columns - 1}`);\r\n      return null;\r\n    }\r\n    if (y >= this.rows || y < 0) {\r\n      this._logger.warn(`No sprite exists in the SpriteSheet at (${x}, ${y}), y: ${y} should be between 0 and ${this.rows - 1}`);\r\n      return null;\r\n    }\r\n    const spriteIndex = x + y * this.columns;\r\n    return this.sprites[spriteIndex];\r\n  }\r\n\r\n  /**\r\n   * To a graphics sprite sheet from a legacy sprite sheet\r\n   */\r\n  public static fromLegacySpriteSheet(legacySpriteSheet: LegacySpriteSheet): SpriteSheet {\r\n    const sprites = legacySpriteSheet.sprites.map(oldSprite => Sprite.fromLegacySprite(oldSprite));\r\n    return new SpriteSheet({\r\n      sprites\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @deprecated\r\n   * @param spriteSheet\r\n   * @returns\r\n   */\r\n  public static toLegacySpriteSheet(spriteSheet: SpriteSheet): LegacySpriteSheet {\r\n    const sprites = spriteSheet.sprites.map(sprite => Sprite.toLegacySprite(sprite));\r\n    return new LegacySpriteSheet(sprites);\r\n  }\r\n\r\n  /**\r\n   * Create a SpriteSheet from an [[ImageSource]] organized in a grid\r\n   *\r\n   * Example:\r\n   * ```\r\n   * const spriteSheet = SpriteSheet.fromImageSource({\r\n   *   image: imageSource,\r\n   *   grid: {\r\n   *     rows: 5,\r\n   *     columns: 2,\r\n   *     spriteWidth: 32, // pixels\r\n   *     spriteHeight: 32 // pixels\r\n   *   },\r\n   *   // Optionally specify spacing\r\n   *   spacing: {\r\n   *     // pixels from the top left to start the sprite parsing\r\n   *     originOffset: {\r\n   *       x: 5,\r\n   *       y: 5\r\n   *     },\r\n   *     // pixels between each sprite while parsing\r\n   *     margin: {\r\n   *       x: 1,\r\n   *       y: 1\r\n   *     }\r\n   *   }\r\n   * })\r\n   * ```\r\n   *\r\n   * @param options\r\n   */\r\n  public static fromImageSource(options: SpriteSheetGridOptions): SpriteSheet {\r\n    const sprites: Sprite[] = [];\r\n    options.spacing = options.spacing ?? {};\r\n    const {\r\n      image,\r\n      grid: { rows, columns: cols, spriteWidth, spriteHeight },\r\n      spacing: { originOffset, margin }\r\n    } = options;\r\n    const offsetDefaults = { x: 0, y: 0, ...originOffset};\r\n    const marginDefaults = { x: 0, y: 0, ...margin};\r\n    for (let x = 0; x < cols; x++) {\r\n      for (let y = 0; y < rows; y++) {\r\n        sprites[x + y * cols] = new Sprite({\r\n          image: image,\r\n          sourceView: {\r\n            x: x * spriteWidth + marginDefaults.x * x + offsetDefaults.x,\r\n            y: y * spriteHeight + marginDefaults.y * y + offsetDefaults.y,\r\n            width: spriteWidth,\r\n            height: spriteHeight\r\n          },\r\n          destSize: { height: spriteHeight, width: spriteWidth }\r\n        });\r\n      }\r\n    }\r\n    return new SpriteSheet({\r\n      sprites: sprites,\r\n      rows: rows,\r\n      columns: cols\r\n    });\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { SpriteFont as LegacySpriteFont } from '../Drawing/Index';\nimport { Logger } from '../Util/Log';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { FontRenderer } from './FontCommon';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Sprite } from './Sprite';\nimport { SpriteSheet } from './SpriteSheet';\n\nexport interface SpriteFontOptions {\n  /**\n   * Alphabet string in spritsheet order (default is row column order)\n   * example: 'abcdefghijklmnopqrstuvwxyz'\n   */\n  alphabet: string;\n  /**\n   * [[SpriteSheet]] to source character sprites from\n   */\n  spriteSheet: SpriteSheet;\n  /**\n   * Optionally ignore case in the supplied text;\n   */\n  caseInsensitive?: boolean;\n  /**\n   * Optionally adjust the spacing between character sprites\n   */\n  spacing?: number;\n  /**\n   * Optionally specify a \"shadow\"\n   */\n  shadow?: { offset: Vector };\n}\n\nexport class SpriteFont extends Graphic implements FontRenderer {\n  private _text = '';\n  private _dirty = true;\n  public alphabet: string = '';\n  public spriteSheet: SpriteSheet;\n\n  public shadow: { offset: Vector } = null;\n  public caseInsensitive = false;\n  public spacing: number = 0;\n\n  private _logger = Logger.getInstance();\n\n  static fromLegacySpriteFont(spriteFont: LegacySpriteFont): SpriteFont {\n    const sprites = spriteFont.sprites.map(Sprite.fromLegacySprite);\n    return new SpriteFont({\n      alphabet: spriteFont.alphabet,\n      spacing: 0,\n      caseInsensitive: spriteFont.caseInsensitive,\n      spriteSheet: new SpriteSheet({\n        sprites\n      })\n    });\n  }\n\n  constructor(options: SpriteFontOptions & GraphicOptions) {\n    super(options);\n    const { alphabet, spriteSheet, caseInsensitive, spacing, shadow } = options;\n    this.alphabet = alphabet;\n    this.spriteSheet = spriteSheet;\n    this.caseInsensitive = caseInsensitive ?? this.caseInsensitive;\n    this.spacing = spacing ?? this.spacing;\n    this.shadow = shadow ?? this.shadow;\n\n    this.spriteSheet.sprites[0].image.ready.then(() => {\n      this._updateDimensions();\n    });\n  }\n\n  private _sprites: Sprite[] = [];\n  private _getCharacterSprites(text: string): Sprite[] {\n    if (!this._dirty) {\n      return this._sprites;\n    }\n\n    const results: Sprite[] = [];\n    // handle case insenstive\n    const textToRender = this.caseInsensitive ? text.toLocaleLowerCase() : text;\n    const alphabet = this.caseInsensitive ? this.alphabet.toLocaleLowerCase() : this.alphabet;\n\n    // for each letter in text\n    for (let letterIndex = 0; letterIndex < textToRender.length; letterIndex++) {\n      // find the sprite index in alphabet , if there is an error pick the first\n      const letter = textToRender[letterIndex];\n      let spriteIndex = alphabet.indexOf(letter);\n      if (spriteIndex === -1) {\n        spriteIndex = 0;\n        this._logger.warn(`SpriteFont - Cannot find letter '${letter}' in configured alphabet '${alphabet}'`);\n      }\n\n      const letterSprite = this.spriteSheet.sprites[spriteIndex];\n      if (letterSprite) {\n        results.push(letterSprite);\n      } else {\n        this._logger.warn(`SpriteFont - Cannot find sprite for '${letter}' at index '${spriteIndex}' in configured SpriteSheet`);\n      }\n    }\n    this._dirty = false;\n    return (this._sprites = results);\n  }\n\n  private _updateDimensions() {\n    const sprites = this._getCharacterSprites(this._text);\n    let width = 0;\n    let height = 0;\n    for (const sprite of sprites) {\n      width += sprite.width + this.spacing;\n      height = Math.max(height, sprite.height);\n    }\n    this.width = width;\n    this.height = height;\n  }\n\n  public updateText(text: string) {\n    if (this._text !== text) {\n      this._dirty = true;\n      this._text = text;\n      this._updateDimensions();\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    let cursor = 0;\n    for (const sprite of this._getCharacterSprites(this._text)) {\n      // draw it in the right spot and increase the cursor by sprite width\n      sprite.draw(ex, x + cursor, y);\n      cursor += sprite.width + this.spacing;\n    }\n  }\n\n  render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number) {\n    if (this._text !== text) {\n      this._dirty = true;\n      this._text = text;\n    }\n\n    if (this.shadow) {\n      ex.save();\n      ex.translate(this.shadow.offset.x, this.shadow.offset.y);\n      this.draw(ex, x, y);\n      ex.restore();\n    }\n\n    this.draw(ex, x, y);\n  }\n\n  clone(): SpriteFont {\n    return new SpriteFont({\n      alphabet: this.alphabet,\n      spriteSheet: this.spriteSheet,\n      spacing: this.spacing\n    });\n  }\n}\n","import { ExcaliburGraphicsContext, ImageSource, SpriteFont, SpriteSheet } from '..';\r\nimport { Vector } from '../..';\r\nimport debugFont from './debug-font.png';\r\n\r\n/**\r\n * Internal debugtext helper\r\n */\r\nexport class DebugText {\r\n  constructor() {\r\n    this.load();\r\n  }\r\n\r\n  /**\r\n   * base64 font\r\n   */\r\n  public readonly fontSheet = debugFont;\r\n  public size: number = 16;\r\n  private _imageSource: ImageSource;\r\n  private _spriteSheet: SpriteSheet;\r\n  private _spriteFont: SpriteFont;\r\n  public load() {\r\n    this._imageSource = new ImageSource(this.fontSheet);\r\n    return this._imageSource.load().then(() => {\r\n      this._spriteSheet = SpriteSheet.fromImageSource({\r\n        image: this._imageSource,\r\n        grid: {\r\n          rows: 3,\r\n          columns: 16,\r\n          spriteWidth: 16,\r\n          spriteHeight: 16\r\n        }\r\n      });\r\n      this._spriteFont = new SpriteFont({\r\n        alphabet: '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!\\'&.\"?-()+ ',\r\n        caseInsensitive: true,\r\n        spriteSheet: this._spriteSheet,\r\n        spacing: -6\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Writes debug text using the built in sprint font\r\n   * @param ctx\r\n   * @param text\r\n   * @param pos\r\n   */\r\n  public write(ctx: ExcaliburGraphicsContext, text: string, pos: Vector) {\r\n    if (this._imageSource.isLoaded()) {\r\n      this._spriteFont.render(ctx, text, pos.x, pos.y);\r\n    }\r\n  }\r\n}\r\n","export default \"data:image/png;base64,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\"","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  RectGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\n\r\nimport { Matrix } from '../../Math/matrix';\r\nimport { TransformStack } from './transform-stack';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { Logger } from '../../Util/Log';\r\nimport { LineRenderer } from './line-renderer';\r\nimport { ImageRenderer } from './image-renderer';\r\nimport { PointRenderer } from './point-renderer';\r\nimport { Canvas } from '../Canvas';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\nimport { ScreenDimension } from '../../Screen';\r\n\r\nclass ExcaliburGraphicsContextWebGLDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _webglCtx: ExcaliburGraphicsContextWebGL) {}\r\n\r\n  /**\r\n   * Draw a debugging rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number, rectOptions: RectGraphicsOptions = { color: Color.Black }): void {\r\n    this.drawLine(vec(x, y), vec(x + width, y), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y), vec(x + width, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x + width, y + height), vec(x, y + height), { ...rectOptions });\r\n    this.drawLine(vec(x, y + height), vec(x, y), { ...rectOptions });\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging line to the context\r\n   * @param start\r\n   * @param end\r\n   * @param lineOptions\r\n   */\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._webglCtx.__lineRenderer.addLine(start, end, lineOptions.color);\r\n  }\r\n\r\n  /**\r\n   * Draw a debugging point to the context\r\n   * @param point\r\n   * @param pointOptions\r\n   */\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._webglCtx.__pointRenderer.addPoint(point, pointOptions.color, pointOptions.size);\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._webglCtx, text, pos);\r\n  }\r\n}\r\n\r\nexport interface WebGLGraphicsContextInfo {\r\n  transform: TransformStack;\r\n  state: StateStack;\r\n  matrix: Matrix;\r\n}\r\n\r\nexport class ExcaliburGraphicsContextWebGL implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __gl: WebGLRenderingContext;\r\n\r\n  /**\r\n   * Holds the 2d context shim\r\n   */\r\n  private _canvas: Canvas; // Configure z for shim?\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n\r\n  private _transform = new TransformStack();\r\n  private _state = new StateStack();\r\n  private _ortho!: Matrix;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __pointRenderer: PointRenderer;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __lineRenderer: LineRenderer;\r\n\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __imageRenderer: ImageRenderer;\r\n\r\n  public snapToPixel: boolean = true;\r\n\r\n  public smoothing: boolean = false;\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public get width() {\r\n    return this.__gl.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__gl.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Checks the underlying webgl implementation if the requested internal resolution is supported\r\n   * @param dim\r\n   */\r\n  public checkIfResolutionSupported(dim: ScreenDimension): boolean {\r\n    // Slight hack based on this thread https://groups.google.com/g/webgl-dev-list/c/AHONvz3oQTo\r\n    const gl = this.__gl;\r\n    // If any dimension is greater than max texture size (divide by 4 bytes per pixel)\r\n    const maxDim = gl.getParameter(gl.MAX_TEXTURE_SIZE) / 4;\r\n    let supported = true;\r\n    if (dim.width > maxDim ||dim.height > maxDim) {\r\n      supported = false;\r\n    }\r\n    return supported;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, smoothing, snapToPixel, backgroundColor } = options;\r\n    this.__gl = canvasElement.getContext('webgl', {\r\n      antialias: smoothing ?? this.smoothing,\r\n      premultipliedAlpha: false,\r\n      alpha: enableTransparency ?? true,\r\n      depth: true,\r\n      powerPreference: 'high-performance'\r\n    });\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this._init();\r\n  }\r\n\r\n  private _init() {\r\n    const gl = this.__gl;\r\n    // Setup viewport and view matrix\r\n    this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    // Clear background\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    // Enable alpha blending\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    this.__pointRenderer = new PointRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n    this.__lineRenderer = new LineRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n    this.__imageRenderer = new ImageRenderer(gl, { matrix: this._ortho, transform: this._transform, state: this._state });\r\n\r\n    // 2D ctx shim\r\n    this._canvas = new Canvas({\r\n      width: gl.canvas.width,\r\n      height: gl.canvas.height\r\n    });\r\n    this.__ctx = this._canvas.ctx;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this._transform.current = Matrix.identity();\r\n  }\r\n\r\n  public updateViewport(): void {\r\n    const gl = this.__gl;\r\n    this._ortho = this._ortho = Matrix.ortho(0, gl.canvas.width, gl.canvas.height, 0, 400, -400);\r\n    this.__pointRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n    this.__lineRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n    this.__imageRenderer.shader.addUniformMatrix('u_matrix', this._ortho.data);\r\n\r\n    // 2D ctx shim\r\n    this._canvas.width = gl.canvas.width;\r\n    this._canvas.height = gl.canvas.height;\r\n  }\r\n\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    if (!image) {\r\n      Logger.getInstance().warn('Cannot draw a null or undefined image');\r\n      // tslint:disable-next-line: no-console\r\n      if (console.trace) {\r\n        // tslint:disable-next-line: no-console\r\n        console.trace();\r\n      }\r\n      return;\r\n    }\r\n    this.__imageRenderer.addImage(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__imageRenderer.addLine(color, start, end, thickness);\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__imageRenderer.addRectangle(color, pos, width, height);\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color) {\r\n    this.__imageRenderer.addCircle(pos, radius, color);\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContextWebGLDebug(this);\r\n\r\n  public save(): void {\r\n    this._transform.save();\r\n    this._state.save();\r\n  }\r\n\r\n  public restore(): void {\r\n    this._transform.restore();\r\n    this._state.restore();\r\n  }\r\n\r\n  public translate(x: number, y: number): void {\r\n    this._transform.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\r\n  }\r\n\r\n  public rotate(angle: number): void {\r\n    this._transform.rotate(angle);\r\n  }\r\n\r\n  public scale(x: number, y: number): void {\r\n    this._transform.scale(x, y);\r\n  }\r\n\r\n  public transform(matrix: Matrix) {\r\n    this._transform.current = matrix;\r\n  }\r\n\r\n  clear() {\r\n    const gl = this.__gl;\r\n    gl.clearColor(this.backgroundColor.r / 255, this.backgroundColor.g / 255, this.backgroundColor.b / 255, this.backgroundColor.a);\r\n    // Clear the context with the newly set color. This is\r\n    // the function call that actually does the drawing.\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes all batched rendering to the screen\r\n   */\r\n  flush() {\r\n    const gl = this.__gl;\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    this.__imageRenderer.render();\r\n    this.__lineRenderer.render();\r\n    this.__pointRenderer.render();\r\n  }\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { Camera } from './Camera';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { BoundingBox } from './Collision/Index';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { getPosition } from './Util/Util';\r\nimport { ExcaliburGraphicsContextWebGL } from './Graphics/Context/ExcaliburGraphicsContextWebGL';\r\n\r\n/**\r\n * Enum representing the different display modes available to Excalibur.\r\n */\r\nexport enum DisplayMode {\r\n  /**\r\n   * Default, use a specified resolution for the game. Like 800x600 pixels for example.\r\n   */\r\n  Fixed = 'Fixed',\r\n\r\n  /**\r\n   * Fit to screen using as much space as possible while maintaining aspect ratio and resolution.\r\n   * This is not the same as [[Screen.goFullScreen]] but behaves in a similar way maintaining aspect ratio.\r\n   *\r\n   * You may want to center your game here is an example\r\n   * ```html\r\n   * <!-- html -->\r\n   * <body>\r\n   * <main>\r\n   *   <canvas id=\"game\"></canvas>\r\n   * </main>\r\n   * </body>\r\n   * ```\r\n   *\r\n   * ```css\r\n   * // css\r\n   * main {\r\n   *   display: flex;\r\n   *   align-items: center;\r\n   *   justify-content: center;\r\n   *   height: 100%;\r\n   *   width: 100%;\r\n   * }\r\n   * ```\r\n   *\r\n   */\r\n  FitScreen = 'FitScreen',\r\n\r\n  /**\r\n   * Fill the entire screen's css width/height for the game resolution dynamically. This means the resolution of the game will\r\n   * change dynamically as the window is resized. This is not the same as [[Screen.goFullScreen]]\r\n   */\r\n  FillScreen = 'FillScreen',\r\n\r\n  /**\r\n   * Fit to parent element width/height using as much space as possible while maintaining aspect ratio and resolution.\r\n   */\r\n  FitContainer = 'FitContainer',\r\n\r\n  /**\r\n   * Use the parent DOM container's css width/height for the game resolution dynamically\r\n   */\r\n  FillContainer = 'FillContainer',\r\n\r\n  /**\r\n   * Allow the game to be positioned with the [[EngineOptions.position]] option\r\n   * @deprecated Use CSS to position the game canvas, will be removed in v0.26.0\r\n   */\r\n  Position = 'Position'\r\n}\r\n\r\n/**\r\n * Convenience class for quick resolutions\r\n * Mostly sourced from https://emulation.gametechwiki.com/index.php/Resolution\r\n */\r\nexport class Resolution {\r\n  /* istanbul ignore next */\r\n  public static get SVGA(): ScreenDimension {\r\n    return { width: 800, height: 600 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Standard(): ScreenDimension {\r\n    return { width: 1920, height: 1080 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get Atari2600(): ScreenDimension {\r\n    return { width: 160, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoy(): ScreenDimension {\r\n    return { width: 160, height: 144 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get GameBoyAdvance(): ScreenDimension {\r\n    return { width: 240, height: 160 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NintendoDS(): ScreenDimension {\r\n    return { width: 256, height: 192 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get NES(): ScreenDimension {\r\n    return { width: 256, height: 224 };\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public static get SNES(): ScreenDimension {\r\n    return { width: 256, height: 244 };\r\n  }\r\n}\r\n\r\n/**\r\n * Interface describing the absolute CSS position of the game window. For use when [[DisplayMode.Position]]\r\n * is specified and when the user wants to define exact pixel spacing of the window.\r\n * When a number is given, the value is interpreted as pixels\r\n */\r\nexport interface AbsolutePosition {\r\n  top?: number | string;\r\n  left?: number | string;\r\n  right?: number | string;\r\n  bottom?: number | string;\r\n}\r\n\r\nexport type CanvasPosition = string | AbsolutePosition;\r\n\r\nexport interface ScreenDimension {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ScreenOptions {\r\n  /**\r\n   * Canvas element to build a screen on\r\n   */\r\n  canvas: HTMLCanvasElement;\r\n  /**\r\n   * Graphics context for the screen\r\n   */\r\n  context: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Browser abstraction\r\n   */\r\n  browser: BrowserEvents;\r\n  /**\r\n   * Optionally set antialiasing, defaults to true. If set to true, images will be smoothed\r\n   */\r\n  antialiasing?: boolean;\r\n  /**\r\n   * Optionally override the pixel ratio to use for the screen, otherwise calculated automatically from the browser\r\n   */\r\n  pixelRatio?: number;\r\n  /**\r\n   * Optionally specify the actual pixel resolution in width/height pixels (also known as logical resolution), by default the\r\n   * resolution will be the same as the viewport. Resolution will be overridden by [[DisplayMode.FillContainer]] and\r\n   * [[DisplayMode.FillScreen]].\r\n   */\r\n  resolution?: ScreenDimension;\r\n  /**\r\n   * Visual viewport size in css pixel, if resolution is not specified it will be the same as the viewport\r\n   */\r\n  viewport: ScreenDimension;\r\n  /**\r\n   * Set the display mode of the screen, by default DisplayMode.Fixed.\r\n   */\r\n  displayMode?: DisplayMode;\r\n  /**\r\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\r\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\r\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\r\n   *\r\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\r\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\r\n   */\r\n  position?: CanvasPosition;\r\n}\r\n\r\n/**\r\n * The Screen handles all aspects of interacting with the screen for Excalibur.\r\n */\r\nexport class Screen {\r\n  private _canvas: HTMLCanvasElement;\r\n  private _ctx: ExcaliburGraphicsContext;\r\n  private _antialiasing: boolean = true;\r\n  private _browser: BrowserEvents;\r\n  private _camera: Camera;\r\n  private _resolution: ScreenDimension;\r\n  private _resolutionStack: ScreenDimension[] = [];\r\n  private _viewport: ScreenDimension;\r\n  private _viewportStack: ScreenDimension[] = [];\r\n  private _pixelRatioOverride: number | null = null;\r\n  private _position: CanvasPosition;\r\n  private _displayMode: DisplayMode;\r\n  private _isFullScreen = false;\r\n  private _mediaQueryList: MediaQueryList;\r\n  private _isDisposed = false;\r\n  private _logger = Logger.getInstance();\r\n  private _resizeObserver: ResizeObserver;\r\n\r\n  constructor(options: ScreenOptions) {\r\n    this.viewport = options.viewport;\r\n    this.resolution = options.resolution ?? { ...this.viewport };\r\n    this._displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    this._canvas = options.canvas;\r\n    this._ctx = options.context;\r\n    this._antialiasing = options.antialiasing ?? this._antialiasing;\r\n    this._browser = options.browser;\r\n    this._position = options.position;\r\n    this._pixelRatioOverride = options.pixelRatio;\r\n    this._applyDisplayMode();\r\n\r\n    this._mediaQueryList = this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);\r\n    this._mediaQueryList.addEventListener('change', this._pixelRatioChangeHandler);\r\n\r\n    this._canvas.addEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    this.applyResolutionAndViewport();\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (!this._isDisposed) {\r\n      // Clean up handlers\r\n      this._isDisposed = true;\r\n      this._browser.window.off('resize', this._resizeHandler);\r\n      if (this._resizeObserver) {\r\n        this._resizeObserver.disconnect();\r\n      }\r\n      this.parent.removeEventListener('resize', this._resizeHandler);\r\n      this._mediaQueryList.removeEventListener('change', this._pixelRatioChangeHandler);\r\n      this._canvas.removeEventListener('fullscreenchange', this._fullscreenChangeHandler);\r\n    }\r\n  }\r\n\r\n  private _fullscreenChangeHandler = () => {\r\n    this._isFullScreen = !this._isFullScreen;\r\n    this._logger.debug('Fullscreen Change', this._isFullScreen);\r\n  };\r\n\r\n  private _pixelRatioChangeHandler = () => {\r\n    this._logger.debug('Pixel Ratio Change', window.devicePixelRatio);\r\n    this._devicePixelRatio = this._calculateDevicePixelRatio();\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _resizeHandler = () => {\r\n    const parent = this.parent;\r\n    this._logger.debug('View port resized');\r\n    this._setResolutionAndViewportByDisplayMode(parent);\r\n    this.applyResolutionAndViewport();\r\n  };\r\n\r\n  private _calculateDevicePixelRatio() {\r\n    if (window.devicePixelRatio < 1) {\r\n      return 1;\r\n    }\r\n\r\n    const devicePixelRatio = window.devicePixelRatio || 1;\r\n\r\n    return devicePixelRatio;\r\n  }\r\n\r\n  // Asking the window.devicePixelRatio is expensive we do it once\r\n  private _devicePixelRatio = this._calculateDevicePixelRatio();\r\n\r\n  public get pixelRatio(): number {\r\n    if (this._pixelRatioOverride) {\r\n      return this._pixelRatioOverride;\r\n    }\r\n\r\n    return this._devicePixelRatio;\r\n  }\r\n\r\n  public get isHiDpi() {\r\n    return this.pixelRatio !== 1;\r\n  }\r\n\r\n  public get displayMode(): DisplayMode {\r\n    return this._displayMode;\r\n  }\r\n\r\n  public get canvas(): HTMLCanvasElement {\r\n    return this._canvas;\r\n  }\r\n\r\n  public get parent(): HTMLElement | Window {\r\n    return <HTMLElement | Window>(\r\n      (this.displayMode === DisplayMode.FillContainer || this.displayMode === DisplayMode.FitContainer\r\n        ? this.canvas.parentElement || document.body\r\n        : window)\r\n    );\r\n  }\r\n\r\n  public get resolution(): ScreenDimension {\r\n    return this._resolution;\r\n  }\r\n\r\n  public set resolution(resolution: ScreenDimension) {\r\n    this._resolution = resolution;\r\n  }\r\n\r\n  public get viewport(): ScreenDimension {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n    return this._resolution;\r\n  }\r\n\r\n  public set viewport(viewport: ScreenDimension) {\r\n    this._viewport = viewport;\r\n  }\r\n\r\n  public get aspectRatio() {\r\n    return this._resolution.width / this._resolution.height;\r\n  }\r\n\r\n  public get scaledWidth() {\r\n    return this._resolution.width * this.pixelRatio;\r\n  }\r\n\r\n  public get scaledHeight() {\r\n    return this._resolution.height * this.pixelRatio;\r\n  }\r\n\r\n  public setCurrentCamera(camera: Camera) {\r\n    this._camera = camera;\r\n  }\r\n\r\n  public pushResolutionAndViewport() {\r\n    this._resolutionStack.push(this.resolution);\r\n    this._viewportStack.push(this.viewport);\r\n\r\n    this.resolution = { ...this.resolution };\r\n    this.viewport = { ...this.viewport };\r\n  }\r\n\r\n  public peekViewport(): ScreenDimension {\r\n    return this._viewportStack[this._viewportStack.length - 1];\r\n  }\r\n\r\n  public peekResolution(): ScreenDimension {\r\n    return this._resolutionStack[this._resolutionStack.length - 1];\r\n  }\r\n\r\n  public popResolutionAndViewport() {\r\n    this.resolution = this._resolutionStack.pop();\r\n    this.viewport = this._viewportStack.pop();\r\n  }\r\n\r\n  private _alreadyWarned = false;\r\n  public applyResolutionAndViewport() {\r\n    this._canvas.width = this.scaledWidth;\r\n    this._canvas.height = this.scaledHeight;\r\n\r\n    if (this._ctx instanceof ExcaliburGraphicsContextWebGL) {\r\n      const supported = this._ctx.checkIfResolutionSupported({\r\n        width: this.scaledWidth,\r\n        height: this.scaledHeight\r\n      });\r\n      if (!supported && !this._alreadyWarned) {\r\n        this._alreadyWarned = true; // warn once\r\n        this._logger.warn(\r\n          `The currently configured resolution (${this.resolution.width}x${this.resolution.height})` +\r\n          ' is too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly.' +\r\n          ' Try reducing the resolution or disabling Hi DPI scaling to avoid this' +\r\n          ' (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).');\r\n      }\r\n    }\r\n\r\n    if (this._antialiasing) {\r\n      this._canvas.style.imageRendering = 'auto';\r\n    } else {\r\n      this._canvas.style.imageRendering = 'pixelated';\r\n      // Fall back to 'crisp-edges' if 'pixelated' is not supported\r\n      // Currently for firefox https://developer.mozilla.org/en-US/docs/Web/CSS/image-rendering\r\n      if (this._canvas.style.imageRendering === '') {\r\n        this._canvas.style.imageRendering = 'crisp-edges';\r\n      }\r\n    }\r\n    this._canvas.style.width = this.viewport.width + 'px';\r\n    this._canvas.style.height = this.viewport.height + 'px';\r\n\r\n    // After messing with the canvas width/height the graphics context is invalidated and needs to have some properties reset\r\n    this._ctx.updateViewport();\r\n    this._ctx.resetTransform();\r\n    this._ctx.scale(this.pixelRatio, this.pixelRatio);\r\n    this._ctx.smoothing = this._antialiasing;\r\n  }\r\n\r\n  public get antialiasing() {\r\n    return this._antialiasing;\r\n  }\r\n\r\n  public set antialiasing(isSmooth: boolean) {\r\n    this._antialiasing = isSmooth;\r\n    this._ctx.smoothing = this._antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Returns true if excalibur is fullscreened using the browser fullscreen api\r\n   */\r\n  public get isFullScreen() {\r\n    return this._isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Requests to go fullscreen using the browser fullscreen api, requires user interaction to be successful.\r\n   * For example, wire this to a user click handler.\r\n   */\r\n  public goFullScreen(): Promise<void> {\r\n    return this._canvas.requestFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Requests to exit fullscreen using the browser fullscreen api\r\n   */\r\n  public exitFullScreen(): Promise<void> {\r\n    return document.exitFullscreen();\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in normal html page space, for example from a pointer move event, and translates it to\r\n   * Excalibur screen space.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public pageToScreenCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    if (!this._isFullScreen) {\r\n      newX -= getPosition(this._canvas).x;\r\n      newY -= getPosition(this._canvas).y;\r\n    }\r\n\r\n    // if fullscreen api on it centers with black bars\r\n    // we need to adjust the screen to world coordinates in this case\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = ((newY - screenMarginY) / screenHeight) * this.viewport.height;\r\n        newX = (newX / window.innerWidth) * this.viewport.width;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = ((newX - screenMarginX) / screenWidth) * this.viewport.width;\r\n        newY = (newY / window.innerHeight) * this.viewport.height;\r\n      }\r\n    }\r\n\r\n    newX = (newX / this.viewport.width) * this.resolution.width;\r\n    newY = (newY / this.viewport.height) * this.resolution.height;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to normal html page space. For example,\r\n   * this is where html elements might live if you want to position them relative to Excalibur.\r\n   *\r\n   * Excalibur screen space starts at the top left (0, 0) corner of the viewport, and extends to the\r\n   * bottom right corner (resolutionX, resolutionY)\r\n   * @param point\r\n   */\r\n  public screenToPageCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    newX = (newX / this.resolution.width) * this.viewport.width;\r\n    newY = (newY / this.resolution.height) * this.viewport.height;\r\n\r\n    if (this._isFullScreen) {\r\n      if (window.innerWidth / this.aspectRatio < window.innerHeight) {\r\n        const screenHeight = window.innerWidth / this.aspectRatio;\r\n        const screenMarginY = (window.innerHeight - screenHeight) / 2;\r\n        newY = (newY / this.viewport.height) * screenHeight + screenMarginY;\r\n        newX = (newX / this.viewport.width) * window.innerWidth;\r\n      } else {\r\n        const screenWidth = window.innerHeight * this.aspectRatio;\r\n        const screenMarginX = (window.innerWidth - screenWidth) / 2;\r\n        newX = (newX / this.viewport.width) * screenWidth + screenMarginX;\r\n        newY = (newY / this.viewport.height) * window.innerHeight;\r\n      }\r\n    }\r\n\r\n    if (!this._isFullScreen) {\r\n      newX += getPosition(this._canvas).x;\r\n      newY += getPosition(this._canvas).y;\r\n    }\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur screen space, and translates it to Excalibur world space.\r\n   *\r\n   * World space is where [[Entity|entities]] in Excalibur live by default [[CoordPlane.World]]\r\n   * and extends infinitely out relative from the [[Camera]].\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    let newX = point.x;\r\n    let newY = point.y;\r\n\r\n    // transform back to world space\r\n    newX = (newX / this.resolution.width) * this.drawWidth;\r\n    newY = (newY / this.resolution.height) * this.drawHeight;\r\n\r\n    // transform based on zoom\r\n    newX = newX - this.halfDrawWidth;\r\n    newY = newY - this.halfDrawHeight;\r\n\r\n    // shift by camera focus\r\n    newX += this._camera?.x ?? 0;\r\n    newY += this._camera?.y ?? 0;\r\n\r\n    return new Vector(newX, newY);\r\n  }\r\n\r\n  /**\r\n   * Takes a coordinate in Excalibur world space, and translates it to Excalibur screen space.\r\n   *\r\n   * Screen space is where [[ScreenElement|screen elements]] and [[Entity|entities]] with [[CoordPlane.Screen]] live.\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    let screenX = point.x;\r\n    let screenY = point.y;\r\n\r\n    // shift by camera focus\r\n    screenX -= this._camera?.x ?? 0;\r\n    screenY -= this._camera?.y ?? 0;\r\n\r\n    // transform back on zoom\r\n    screenX = screenX + this.halfDrawWidth;\r\n    screenY = screenY + this.halfDrawHeight;\r\n\r\n    // transform back to screen space\r\n    screenX = (screenX / this.drawWidth) * this.resolution.width;\r\n    screenY = (screenY / this.drawHeight) * this.resolution.height;\r\n\r\n    return new Vector(screenX, screenY);\r\n  }\r\n\r\n  public pageToWorldCoordinates(point: Vector): Vector {\r\n    const screen = this.pageToScreenCoordinates(point);\r\n    return this.screenToWorldCoordinates(screen);\r\n  }\r\n\r\n  public worldToPageCoordinates(point: Vector): Vector {\r\n    const screen = this.worldToScreenCoordinates(point);\r\n    return this.screenToPageCoordinates(screen);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   *\r\n   * World bounds are in world coordinates, useful for culling objects offscreen\r\n   */\r\n  public getWorldBounds(): BoundingBox {\r\n    const left = this.screenToWorldCoordinates(Vector.Zero).x;\r\n    const top = this.screenToWorldCoordinates(Vector.Zero).y;\r\n    const right = left + this.drawWidth;\r\n    const bottom = top + this.drawHeight;\r\n\r\n    return new BoundingBox(left, top, right, bottom);\r\n  }\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.canvas.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.canvas.width / 2;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.canvas.height / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    if (this._camera) {\r\n      return this.resolution.width / this._camera.zoom;\r\n    }\r\n    return this.resolution.width;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.drawWidth / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    if (this._camera) {\r\n      return this.resolution.height / this._camera.zoom;\r\n    }\r\n    return this.resolution.height;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.drawHeight / 2;\r\n  }\r\n\r\n  /**\r\n   * Returns screen center coordinates including zoom and device pixel ratio.\r\n   */\r\n  public get center(): Vector {\r\n    return vec(this.halfDrawWidth, this.halfDrawHeight);\r\n  }\r\n\r\n  private _computeFit() {\r\n    document.body.style.margin = '0px';\r\n    document.body.style.overflow = 'hidden';\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    if (window.innerWidth / aspect < window.innerHeight) {\r\n      adjustedWidth = window.innerWidth;\r\n      adjustedHeight = window.innerWidth / aspect;\r\n    } else {\r\n      adjustedWidth = window.innerHeight * aspect;\r\n      adjustedHeight = window.innerHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n  }\r\n\r\n  private _computeFitContainer() {\r\n    const aspect = this.aspectRatio;\r\n    let adjustedWidth = 0;\r\n    let adjustedHeight = 0;\r\n    const parent = this.canvas.parentElement;\r\n    if (parent.clientWidth / aspect < parent.clientHeight) {\r\n      adjustedWidth = parent.clientWidth;\r\n      adjustedHeight = parent.clientWidth / aspect;\r\n    } else {\r\n      adjustedWidth = parent.clientHeight * aspect;\r\n      adjustedHeight = parent.clientHeight;\r\n    }\r\n\r\n    this.viewport = {\r\n      width: adjustedWidth,\r\n      height: adjustedHeight\r\n    };\r\n  }\r\n\r\n  private _applyDisplayMode() {\r\n    if (this.displayMode === DisplayMode.Position) {\r\n      this._initializeDisplayModePosition(this._position);\r\n    } else {\r\n      this._setResolutionAndViewportByDisplayMode(this.parent);\r\n\r\n      // watch resizing\r\n      if (this.parent instanceof Window) {\r\n        this._browser.window.on('resize', this._resizeHandler);\r\n      } else {\r\n        this._resizeObserver = new ResizeObserver(() => {\r\n          this._resizeHandler();\r\n        });\r\n        this._resizeObserver.observe(this.parent);\r\n      }\r\n      this.parent.addEventListener('resize', this._resizeHandler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the resoultion and viewport based on the selected display mode.\r\n   */\r\n  private _setResolutionAndViewportByDisplayMode(parent: HTMLElement | Window) {\r\n    if (this.displayMode === DisplayMode.FillContainer) {\r\n      this.resolution = {\r\n        width: (<HTMLElement>parent).clientWidth,\r\n        height: (<HTMLElement>parent).clientHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FillScreen) {\r\n      document.body.style.margin = '0px';\r\n      document.body.style.overflow = 'hidden';\r\n      this.resolution = {\r\n        width: (<Window>parent).innerWidth,\r\n        height: (<Window>parent).innerHeight\r\n      };\r\n\r\n      this.viewport = this.resolution;\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitScreen) {\r\n      this._computeFit();\r\n    }\r\n\r\n    if (this.displayMode === DisplayMode.FitContainer) {\r\n      this._computeFitContainer();\r\n    }\r\n  }\r\n\r\n  private _initializeDisplayModePosition(position: CanvasPosition) {\r\n    if (!position) {\r\n      throw new Error('DisplayMode of Position was selected but no position option was given');\r\n    } else {\r\n      this.canvas.style.display = 'block';\r\n      this.canvas.style.position = 'absolute';\r\n\r\n      if (typeof position === 'string') {\r\n        const specifiedPosition = position.split(' ');\r\n\r\n        switch (specifiedPosition[0]) {\r\n          case 'top':\r\n            this.canvas.style.top = '0px';\r\n            break;\r\n          case 'bottom':\r\n            this.canvas.style.bottom = '0px';\r\n            break;\r\n          case 'middle':\r\n            this.canvas.style.top = '50%';\r\n            const offsetY = -this.halfDrawHeight;\r\n            this.canvas.style.marginTop = offsetY.toString();\r\n            break;\r\n          default:\r\n            throw new Error('Invalid Position Given');\r\n        }\r\n\r\n        if (specifiedPosition[1]) {\r\n          switch (specifiedPosition[1]) {\r\n            case 'left':\r\n              this.canvas.style.left = '0px';\r\n              break;\r\n            case 'right':\r\n              this.canvas.style.right = '0px';\r\n              break;\r\n            case 'center':\r\n              this.canvas.style.left = '50%';\r\n              const offsetX = -this.halfDrawWidth;\r\n              this.canvas.style.marginLeft = offsetX.toString();\r\n              break;\r\n            default:\r\n              throw new Error('Invalid Position Given');\r\n          }\r\n        }\r\n      } else {\r\n        if (position.top) {\r\n          typeof position.top === 'number'\r\n            ? (this.canvas.style.top = position.top.toString() + 'px')\r\n            : (this.canvas.style.top = position.top);\r\n        }\r\n        if (position.right) {\r\n          typeof position.right === 'number'\r\n            ? (this.canvas.style.right = position.right.toString() + 'px')\r\n            : (this.canvas.style.right = position.right);\r\n        }\r\n        if (position.bottom) {\r\n          typeof position.bottom === 'number'\r\n            ? (this.canvas.style.bottom = position.bottom.toString() + 'px')\r\n            : (this.canvas.style.bottom = position.bottom);\r\n        }\r\n        if (position.left) {\r\n          typeof position.left === 'number'\r\n            ? (this.canvas.style.left = position.left.toString() + 'px')\r\n            : (this.canvas.style.left = position.left);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Internal class used to build instances of AudioContext\r\n */\r\n/* istanbul ignore next */\r\nexport class AudioContextFactory {\r\n  private static _INSTANCE: AudioContext = null;\r\n\r\n  public static create(): AudioContext {\r\n    if (!this._INSTANCE) {\r\n      if ((<any>window).AudioContext || (<any>window).webkitAudioContext) {\r\n        this._INSTANCE = new AudioContext();\r\n      }\r\n    }\r\n\r\n    return this._INSTANCE;\r\n  }\r\n}\r\n","import { AudioContextFactory } from '../Resources/Sound/AudioContext';\r\nimport { Logger } from './Log';\r\n\r\nexport interface LegacyWebAudioSource {\r\n  playbackState: string;\r\n  PLAYING_STATE: 'playing';\r\n  FINISHED_STATE: 'finished';\r\n}\r\n\r\n/**\r\n * Patch for detecting legacy web audio in browsers\r\n * @internal\r\n * @param source\r\n */\r\nfunction isLegacyWebAudioSource(source: any): source is LegacyWebAudioSource {\r\n  return !!source.playbackState;\r\n}\r\n\r\nexport class WebAudio {\r\n  private static _UNLOCKED: boolean = false;\r\n\r\n  /**\r\n   * Play an empty sound to unlock Safari WebAudio context. Call this function\r\n   * right after a user interaction event.\r\n   * @source https://paulbakaus.com/tutorials/html5/web-audio-on-ios/\r\n   */\r\n  static unlock(): Promise<boolean> {\r\n    const promise = new Promise<boolean>((resolve, reject) => {\r\n      if (WebAudio._UNLOCKED || !AudioContextFactory.create()) {\r\n        return resolve(true);\r\n      }\r\n      const unlockTimeoutTimer = setTimeout(() => {\r\n        Logger.getInstance().warn('Excalibur was unable to unlock the audio context, audio probably will not play in this browser.');\r\n        resolve(false);\r\n      }, 200);\r\n\r\n      const audioContext = AudioContextFactory.create();\r\n      audioContext.resume().then(\r\n        () => {\r\n          // create empty buffer and play it\r\n          const buffer = audioContext.createBuffer(1, 1, 22050);\r\n          const source = audioContext.createBufferSource();\r\n          let ended = false;\r\n\r\n          source.buffer = buffer;\r\n          source.connect(audioContext.destination);\r\n          source.onended = () => (ended = true);\r\n\r\n          source.start(0);\r\n\r\n          // by checking the play state after some time, we know if we're really unlocked\r\n          setTimeout(() => {\r\n            if (isLegacyWebAudioSource(source)) {\r\n              if (source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            } else {\r\n              if (audioContext.currentTime > 0 || ended) {\r\n                WebAudio._UNLOCKED = true;\r\n              }\r\n            }\r\n          }, 0);\r\n\r\n          clearTimeout(unlockTimeoutTimer);\r\n          resolve(true);\r\n        },\r\n        () => {\r\n          reject();\r\n        }\r\n      );\r\n    });\r\n\r\n\r\n    return promise;\r\n  }\r\n\r\n  static isUnlocked() {\r\n    return this._UNLOCKED;\r\n  }\r\n}\r\n","import { GameEvent } from './Events';\r\nimport { EventDispatcher } from './EventDispatcher';\r\nimport { Eventable } from './Interfaces/Evented';\r\n\r\n/**\r\n * Excalibur base class that provides basic functionality such as [[EventDispatcher]]\r\n * and extending abilities for vanilla Javascript projects\r\n */\r\nexport class Class implements Eventable {\r\n  /**\r\n   * Direct access to the game object event dispatcher.\r\n   */\r\n  public eventDispatcher: EventDispatcher;\r\n\r\n  constructor() {\r\n    this.eventDispatcher = new EventDispatcher(this);\r\n  }\r\n\r\n  /**\r\n   * Alias for `addEventListener`. You can listen for a variety of\r\n   * events off of the engine; see the events section below for a complete list.\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Alias for `removeEventListener`. If only the eventName is specified\r\n   * it will remove all handlers registered for that specific event. If the eventName\r\n   * and the handler instance are specified only that handler will be removed.\r\n   *\r\n   * @param eventName  Name of the event to listen for\r\n   * @param handler    Event handler for the thrown event\r\n   */\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Emits a new event\r\n   * @param eventName   Name of the event to emit\r\n   * @param eventObject Data associated with this event\r\n   */\r\n  public emit(eventName: string, eventObject: GameEvent<any>) {\r\n    this.eventDispatcher.emit(eventName, eventObject);\r\n  }\r\n\r\n  /**\r\n   * Once listens to an event one time, then unsubscribes from that event\r\n   *\r\n   * @param eventName The name of the event to subscribe to once\r\n   * @param handler   The handler of the event that will be auto unsubscribed\r\n   */\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void) {\r\n    this.eventDispatcher.once(eventName, handler);\r\n  }\r\n}\r\n","import { Color } from '../Color';\nimport { Vector } from '../Math/vector';\n\n/**\n * A canvas linecap style. \"butt\" is the default flush style, \"round\" is a semi-circle cap with a radius half the width of\n * the line, and \"square\" is a rectangle that is an equal width and half height cap.\n */\nexport type LineCapStyle = 'butt' | 'round' | 'square';\n\n/* istanbul ignore next */\n/**\n * Draw a line on canvas context\n *\n * @param ctx The canvas context\n * @param color The color of the line\n * @param x1 The start x coordinate\n * @param y1 The start y coordinate\n * @param x2 The ending x coordinate\n * @param y2 The ending y coordinate\n * @param thickness The line thickness\n * @param cap The [[LineCapStyle]] (butt, round, or square)\n */\nexport function line(\n  ctx: CanvasRenderingContext2D,\n  color: Color = Color.Red,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n  thickness: number = 1,\n  cap: LineCapStyle = 'butt'\n) {\n  ctx.beginPath();\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color.toString();\n  ctx.moveTo(x1, y1);\n  ctx.lineTo(x2, y2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/* istanbul ignore next */\n/**\n * Draw the vector as a point onto the canvas.\n */\nexport function point(ctx: CanvasRenderingContext2D, color: Color = Color.Red, point: Vector): void {\n  ctx.beginPath();\n  ctx.strokeStyle = color.toString();\n  ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Draw the vector as a line onto the canvas starting a origin point.\n */\n/* istanbul ignore next */\n/**\n *\n */\nexport function vector(ctx: CanvasRenderingContext2D, color: Color, origin: Vector, vector: Vector, scale: number = 1.0): void {\n  const c = color ? color.toString() : 'blue';\n  const v = vector.scale(scale);\n  ctx.beginPath();\n  ctx.strokeStyle = c;\n  ctx.moveTo(origin.x, origin.y);\n  ctx.lineTo(origin.x + v.x, origin.y + v.y);\n  ctx.closePath();\n  ctx.stroke();\n}\n\n/**\n * Represents border radius values\n */\nexport interface BorderRadius {\n  /**\n   * Top-left\n   */\n  tl: number;\n  /**\n   * Top-right\n   */\n  tr: number;\n  /**\n   * Bottom-right\n   */\n  br: number;\n  /**\n   * Bottom-left\n   */\n  bl: number;\n}\n\n/**\n * Draw a round rectangle on a canvas context\n *\n * @param ctx The canvas context\n * @param x The top-left x coordinate\n * @param y The top-left y coordinate\n * @param width The width of the rectangle\n * @param height The height of the rectangle\n * @param radius The border radius of the rectangle\n * @param stroke The [[Color]] to stroke rectangle with\n * @param fill The [[Color]] to fill rectangle with\n */\nexport function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: number | BorderRadius = 5,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  let br: BorderRadius;\n\n  if (typeof radius === 'number') {\n    br = { tl: radius, tr: radius, br: radius, bl: radius };\n  } else {\n    const defaultRadius: BorderRadius = { tl: 0, tr: 0, br: 0, bl: 0 };\n\n    for (const prop in defaultRadius) {\n      if (defaultRadius.hasOwnProperty(prop)) {\n        const side = <keyof BorderRadius>prop;\n        br[side] = radius[side] || defaultRadius[side];\n      }\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + br.tl, y);\n  ctx.lineTo(x + width - br.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + br.tr);\n  ctx.lineTo(x + width, y + height - br.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - br.br, y + height);\n  ctx.lineTo(x + br.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - br.bl);\n  ctx.lineTo(x, y + br.tl);\n  ctx.quadraticCurveTo(x, y, x + br.tl, y);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n\n/**\n *\n */\nexport function circle(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  stroke: Color = Color.White,\n  fill: Color = null\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.closePath();\n\n  if (fill) {\n    ctx.fillStyle = fill.toString();\n    ctx.fill();\n  }\n\n  if (stroke) {\n    ctx.strokeStyle = stroke.toString();\n    ctx.stroke();\n  }\n}\n","import { Color } from './Color';\r\nimport { WebAudio } from './Util/WebAudio';\r\nimport { Engine } from './Engine';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Class } from './Class';\r\nimport * as DrawUtil from './Util/DrawUtil';\r\n\r\nimport logoImg from './Loader.logo.png';\r\nimport loaderCss from './Loader.css';\r\nimport { Canvas } from './Graphics/Canvas';\r\nimport { Vector } from './Math/vector';\r\nimport { clamp, delay } from './Util/Util';\r\n\r\n/**\r\n * Pre-loading assets\r\n *\r\n * The loader provides a mechanism to preload multiple resources at\r\n * one time. The loader must be passed to the engine in order to\r\n * trigger the loading progress bar.\r\n *\r\n * The [[Loader]] itself implements [[Loadable]] so you can load loaders.\r\n *\r\n * ## Example: Pre-loading resources for a game\r\n *\r\n * ```js\r\n * // create a loader\r\n * var loader = new ex.Loader();\r\n *\r\n * // create a resource dictionary (best practice is to keep a separate file)\r\n * var resources = {\r\n *   TextureGround: new ex.Texture(\"/images/textures/ground.png\"),\r\n *   SoundDeath: new ex.Sound(\"/sound/death.wav\", \"/sound/death.mp3\")\r\n * };\r\n *\r\n * // loop through dictionary and add to loader\r\n * for (var loadable in resources) {\r\n *   if (resources.hasOwnProperty(loadable)) {\r\n *     loader.addResource(resources[loadable]);\r\n *   }\r\n * }\r\n *\r\n * // start game\r\n * game.start(loader).then(function () {\r\n *   console.log(\"Game started!\");\r\n * });\r\n * ```\r\n *\r\n * ## Customize the Loader\r\n *\r\n * The loader can be customized to show different, text, logo, background color, and button.\r\n *\r\n * ```typescript\r\n * const loader = new ex.Loader([playerTexture]);\r\n *\r\n * // The loaders button text can simply modified using this\r\n * loader.playButtonText = 'Start the best game ever';\r\n *\r\n * // The logo can be changed by inserting a base64 image string here\r\n *\r\n * loader.logo = 'data:image/png;base64,iVBORw...';\r\n * loader.logoWidth = 15;\r\n * loader.logoHeight = 14;\r\n *\r\n * // The background color can be changed like so by supplying a valid CSS color string\r\n *\r\n * loader.backgroundColor = 'red'\r\n * loader.backgroundColor = '#176BAA'\r\n *\r\n * // To build a completely new button\r\n * loader.startButtonFactory = () => {\r\n *     let myButton = document.createElement('button');\r\n *     myButton.textContent = 'The best button';\r\n *     return myButton;\r\n * };\r\n *\r\n * engine.start(loader).then(() => {});\r\n * ```\r\n */\r\nexport class Loader extends Class implements Loadable<Loadable<any>[]> {\r\n  public canvas: Canvas = new Canvas({\r\n    smoothing: true,\r\n    draw: this.draw.bind(this)\r\n  });\r\n  private _resourceList: Loadable<any>[] = [];\r\n  private _index = 0;\r\n\r\n  private _playButtonShown: boolean = false;\r\n  private _resourceCount: number = 0;\r\n  private _numLoaded: number = 0;\r\n  private _progressCounts: { [key: string]: number } = {};\r\n  private _totalCounts: { [key: string]: number } = {};\r\n  private _engine: Engine;\r\n\r\n  // logo drawing stuff\r\n\r\n  // base64 string encoding of the excalibur logo (logo-white.png)\r\n  public logo = logoImg;\r\n  public logoWidth = 468;\r\n  public logoHeight = 118;\r\n  /**\r\n   * Positions the top left corner of the logo image\r\n   * If not set, the loader automatically positions the logo\r\n   */\r\n  public logoPosition: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the play button.\r\n   * If not set, the loader automatically positions the play button\r\n   */\r\n  public playButtonPosition: Vector | null;\r\n  /**\r\n   * Positions the top left corner of the loading bar\r\n   * If not set, the loader automatically positions the loading bar\r\n   */\r\n  public loadingBarPosition: Vector | null;\r\n\r\n  /**\r\n   * Gets or sets the color of the loading bar, default is [[Color.White]]\r\n   */\r\n  public loadingBarColor: Color = Color.White;\r\n\r\n  /**\r\n   * Gets or sets the background color of the loader as a hex string\r\n   */\r\n  public backgroundColor: string = '#176BAA';\r\n\r\n  protected _imageElement: HTMLImageElement;\r\n  protected get _image() {\r\n    if (!this._imageElement) {\r\n      this._imageElement = new Image();\r\n      this._imageElement.src = this.logo;\r\n    }\r\n\r\n    return this._imageElement;\r\n  }\r\n\r\n  public suppressPlayButton: boolean = false;\r\n  public get playButtonRootElement(): HTMLElement | null {\r\n    return this._playButtonRootElement;\r\n  }\r\n  public get playButtonElement(): HTMLButtonElement | null {\r\n    return this._playButtonElement;\r\n  }\r\n  protected _playButtonRootElement: HTMLElement;\r\n  protected _playButtonElement: HTMLButtonElement;\r\n  protected _styleBlock: HTMLStyleElement;\r\n  /** Loads the css from Loader.css */\r\n  protected _playButtonStyles: string = loaderCss.toString();\r\n  protected get _playButton() {\r\n    const existingRoot = document.getElementById('excalibur-play-root');\r\n    if (existingRoot) {\r\n      this._playButtonRootElement = existingRoot;\r\n    }\r\n    if (!this._playButtonRootElement) {\r\n      this._playButtonRootElement = document.createElement('div');\r\n      this._playButtonRootElement.id = 'excalibur-play-root';\r\n      this._playButtonRootElement.style.position = 'absolute';\r\n      document.body.appendChild(this._playButtonRootElement);\r\n    }\r\n    if (!this._styleBlock) {\r\n      this._styleBlock = document.createElement('style');\r\n      this._styleBlock.textContent = this._playButtonStyles;\r\n      document.head.appendChild(this._styleBlock);\r\n    }\r\n    if (!this._playButtonElement) {\r\n      this._playButtonElement = this.startButtonFactory();\r\n      this._playButtonRootElement.appendChild(this._playButtonElement);\r\n    }\r\n    return this._playButtonElement;\r\n  }\r\n\r\n  /**\r\n   * Get/set play button text\r\n   */\r\n  public playButtonText: string = 'Play game';\r\n\r\n  /**\r\n   * Return a html button element for excalibur to use as a play button\r\n   */\r\n  public startButtonFactory = () => {\r\n    let buttonElement: HTMLButtonElement = document.getElementById('excalibur-play') as HTMLButtonElement;\r\n    if (!buttonElement) {\r\n      buttonElement = document.createElement('button');\r\n    }\r\n\r\n    buttonElement.id = 'excalibur-play';\r\n    buttonElement.textContent = this.playButtonText;\r\n    buttonElement.style.display = 'none';\r\n    return buttonElement;\r\n  };\r\n\r\n  /**\r\n   * @param loadables  Optionally provide the list of resources you want to load at constructor time\r\n   */\r\n  constructor(loadables?: Loadable<any>[]) {\r\n    super();\r\n\r\n    if (loadables) {\r\n      this.addResources(loadables);\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    this._engine = engine;\r\n    this.canvas.width = this._engine.canvas.width;\r\n    this.canvas.height = this._engine.canvas.height;\r\n  }\r\n\r\n  /**\r\n   * Add a resource to the loader to load\r\n   * @param loadable  Resource to add\r\n   */\r\n  public addResource(loadable: Loadable<any>) {\r\n    const key = this._index++;\r\n    this._resourceList.push(loadable);\r\n    this._progressCounts[key] = 0;\r\n    this._totalCounts[key] = 1;\r\n    this._resourceCount++;\r\n  }\r\n\r\n  /**\r\n   * Add a list of resources to the loader to load\r\n   * @param loadables  The list of resources to load\r\n   */\r\n  public addResources(loadables: Loadable<any>[]) {\r\n    let i = 0;\r\n    const len = loadables.length;\r\n\r\n    for (i; i < len; i++) {\r\n      this.addResource(loadables[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns true if the loader has completely loaded all resources\r\n   */\r\n  public isLoaded() {\r\n    return this._numLoaded === this._resourceCount;\r\n  }\r\n\r\n  /**\r\n   * Shows the play button and returns a promise that resolves when clicked\r\n   */\r\n  public showPlayButton(): Promise<void> {\r\n    if (this.suppressPlayButton) {\r\n      this.hidePlayButton();\r\n      return Promise.resolve();\r\n    } else {\r\n      const resizeHandler = () => {\r\n        this._positionPlayButton();\r\n      };\r\n      if (this._engine?.browser) {\r\n        this._engine.browser.window.on('resize', resizeHandler);\r\n      }\r\n      this._playButtonShown = true;\r\n      this._playButton.style.display = 'block';\r\n      document.body.addEventListener('keyup', (evt: KeyboardEvent) => {\r\n        if (evt.key === 'Enter') {\r\n          this._playButton.click();\r\n        }\r\n      });\r\n      const promise = new Promise<void>((resolve) => {\r\n        const startButtonHandler = (e: Event) => {\r\n          // We want to stop propogation to keep bubbling to the engine pointer handlers\r\n          e.stopPropagation();\r\n          // Hide Button after click\r\n          this.hidePlayButton();\r\n          if (this._engine?.browser) {\r\n            this._engine.browser.window.off('resize', resizeHandler);\r\n          }\r\n          resolve();\r\n        };\r\n        this._playButton.addEventListener('click', startButtonHandler);\r\n        this._playButton.addEventListener('touchend', startButtonHandler);\r\n        this._playButton.addEventListener('pointerup', startButtonHandler);\r\n      });\r\n\r\n      return promise;\r\n    }\r\n  }\r\n\r\n  public hidePlayButton() {\r\n    this._playButtonShown = false;\r\n    this._playButton.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Clean up generated elements for the loader\r\n   */\r\n  public dispose() {\r\n    if (this._playButtonRootElement.parentElement) {\r\n      this._playButtonRootElement.removeChild(this._playButtonElement);\r\n      document.body.removeChild(this._playButtonRootElement);\r\n      document.head.removeChild(this._styleBlock);\r\n      this._playButtonRootElement = null;\r\n      this._playButtonElement = null;\r\n      this._styleBlock = null;\r\n    }\r\n  }\r\n\r\n  update(_engine: Engine, _delta: number): void {\r\n    // override me\r\n  }\r\n\r\n  data: Loadable<any>[];\r\n\r\n  /**\r\n   * Begin loading all of the supplied resources, returning a promise\r\n   * that resolves when loading of all is complete\r\n   */\r\n  public async load(): Promise<Loadable<any>[]> {\r\n    await Promise.all(\r\n      this._resourceList.map((r) =>\r\n        r.load().finally(() => {\r\n          // capture progress\r\n          this._numLoaded++;\r\n        })\r\n      )\r\n    );\r\n\r\n    // short delay in showing the button for aesthetics\r\n    await delay(200);\r\n    await this.showPlayButton();\r\n    // Unlock browser AudioContext in after user gesture\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/262\r\n    // See: https://github.com/excaliburjs/Excalibur/issues/1031\r\n    await WebAudio.unlock();\r\n\r\n    return (this.data = this._resourceList);\r\n  }\r\n\r\n  public markResourceComplete(): void {\r\n    this._numLoaded++;\r\n  }\r\n\r\n  /**\r\n   * Returns the progess of the loader as a number between [0, 1] inclusive.\r\n   */\r\n  public get progress(): number {\r\n    return this._resourceCount > 0 ? clamp(this._numLoaded, 0, this._resourceCount) / this._resourceCount : 1;\r\n  }\r\n\r\n  private _positionPlayButton() {\r\n    const screenHeight = this._engine.screen.viewport.height;\r\n    const screenWidth = this._engine.screen.viewport.width;\r\n    if (this._playButtonRootElement) {\r\n      const left = this._engine.canvas.offsetLeft;\r\n      const top = this._engine.canvas.offsetTop;\r\n      const buttonWidth = this._playButton.clientWidth;\r\n      const buttonHeight = this._playButton.clientHeight;\r\n      if (this.playButtonPosition) {\r\n        this._playButtonRootElement.style.left = `${this.playButtonPosition.x}px`;\r\n        this._playButtonRootElement.style.top = `${this.playButtonPosition.y}px`;\r\n      } else {\r\n        this._playButtonRootElement.style.left = `${left + screenWidth / 2 - buttonWidth / 2}px`;\r\n        this._playButtonRootElement.style.top = `${top + screenHeight / 2 - buttonHeight / 2 + 100}px`;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loader draw function. Draws the default Excalibur loading screen.\r\n   * Override `logo`, `logoWidth`, `logoHeight` and `backgroundColor` properties\r\n   * to customize the drawing, or just override entire method.\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    const canvasHeight = this._engine.canvasHeight / this._engine.pixelRatio;\r\n    const canvasWidth = this._engine.canvasWidth / this._engine.pixelRatio;\r\n\r\n    this._positionPlayButton();\r\n\r\n    ctx.fillStyle = this.backgroundColor;\r\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n\r\n    let logoY = canvasHeight / 2;\r\n    const width = Math.min(this.logoWidth, canvasWidth * 0.75);\r\n    let logoX = canvasWidth / 2 - width / 2;\r\n\r\n    if (this.logoPosition) {\r\n      logoX = this.logoPosition.x;\r\n      logoY = this.logoPosition.y;\r\n    }\r\n\r\n    const imageHeight = Math.floor(width * (this.logoHeight / this.logoWidth)); // OG height/width factor\r\n    const oldAntialias = this._engine.getAntialiasing();\r\n    this._engine.setAntialiasing(true);\r\n    if (!this.logoPosition) {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY - imageHeight - 20, width, imageHeight);\r\n    } else {\r\n      ctx.drawImage(this._image, 0, 0, this.logoWidth, this.logoHeight, logoX, logoY, width, imageHeight);\r\n    }\r\n\r\n    // loading box\r\n    if (!this.suppressPlayButton && this._playButtonShown) {\r\n      this._engine.setAntialiasing(oldAntialias);\r\n      return;\r\n    }\r\n\r\n    let loadingX = logoX;\r\n    let loadingY = logoY;\r\n    if (this.loadingBarPosition) {\r\n      loadingX = this.loadingBarPosition.x;\r\n      loadingY = this.loadingBarPosition.y;\r\n    }\r\n\r\n    ctx.lineWidth = 2;\r\n    DrawUtil.roundRect(ctx, loadingX, loadingY, width, 20, 10, this.loadingBarColor);\r\n    const progress = width * this.progress;\r\n    const margin = 5;\r\n    const progressWidth = progress - margin * 2;\r\n    const height = 20 - margin * 2;\r\n    DrawUtil.roundRect(\r\n      ctx,\r\n      loadingX + margin,\r\n      loadingY + margin,\r\n      progressWidth > 10 ? progressWidth : 10,\r\n      height,\r\n      5,\r\n      null,\r\n      this.loadingBarColor\r\n    );\r\n    this._engine.setAntialiasing(oldAntialias);\r\n  }\r\n}\r\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=\"","import { Logger } from './Log';\r\n/**\r\n * This is the list of features that will be used to log the supported\r\n * features to the console when Detector.logBrowserFeatures() is called.\r\n */\r\n\r\nconst REPORTED_FEATURES: { [key: string]: string } = {\r\n  webgl: 'WebGL',\r\n  webaudio: 'WebAudio',\r\n  gamepadapi: 'Gamepad API'\r\n};\r\n\r\n/**\r\n * Interface for detected browser features matrix\r\n */\r\nexport interface DetectedFeatures {\r\n  readonly canvas: boolean;\r\n  readonly arraybuffer: boolean;\r\n  readonly dataurl: boolean;\r\n  readonly objecturl: boolean;\r\n  readonly rgba: boolean;\r\n  readonly webaudio: boolean;\r\n  readonly webgl: boolean;\r\n  readonly gamepadapi: boolean;\r\n}\r\n\r\ninterface CriticalTests {\r\n  canvasSupport(): boolean;\r\n  arrayBufferSupport(): boolean;\r\n  dataUrlSupport(): boolean;\r\n  objectUrlSupport(): boolean;\r\n  rgbaSupport(): boolean;\r\n}\r\n\r\ninterface WarningTests {\r\n  webAudioSupport(): boolean;\r\n  webglSupport(): boolean;\r\n}\r\n\r\n/**\r\n * Excalibur internal feature detection helper class\r\n */\r\nexport class Detector {\r\n  private _features: DetectedFeatures = null;\r\n\r\n  public failedTests: string[] = [];\r\n\r\n  public constructor() {\r\n    this._features = this._loadBrowserFeatures();\r\n  }\r\n\r\n  /**\r\n   * Returns a map of currently supported browser features. This method\r\n   * treats the features as a singleton and will only calculate feature\r\n   * support if it has not previously been done.\r\n   */\r\n  public getBrowserFeatures(): DetectedFeatures {\r\n    if (this._features === null) {\r\n      this._features = this._loadBrowserFeatures();\r\n    }\r\n    return this._features;\r\n  }\r\n\r\n  /**\r\n   * Report on non-critical browser support for debugging purposes.\r\n   * Use native browser console colors for visibility.\r\n   */\r\n  public logBrowserFeatures(): void {\r\n    let msg = '%cSUPPORTED BROWSER FEATURES\\n==========================%c\\n';\r\n    const args = ['font-weight: bold; color: navy', 'font-weight: normal; color: inherit'];\r\n\r\n    const supported: any = this.getBrowserFeatures();\r\n    for (const feature of Object.keys(REPORTED_FEATURES)) {\r\n      if (supported[feature]) {\r\n        msg += '(%c\\u2713%c)'; // (✓)\r\n        args.push('font-weight: bold; color: green');\r\n        args.push('font-weight: normal; color: inherit');\r\n      } else {\r\n        msg += '(%c\\u2717%c)'; // (✗)\r\n        args.push('font-weight: bold; color: red');\r\n        args.push('font-weight: normal; color: inherit');\r\n      }\r\n\r\n      msg += ' ' + REPORTED_FEATURES[feature] + '\\n';\r\n    }\r\n\r\n    args.unshift(msg);\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, args);\r\n  }\r\n\r\n  /**\r\n   * Executes several IIFE's to get a constant reference to supported\r\n   * features within the current execution context.\r\n   */\r\n  private _loadBrowserFeatures(): DetectedFeatures {\r\n    return {\r\n      // IIFE to check canvas support\r\n      canvas: (() => {\r\n        return this._criticalTests.canvasSupport();\r\n      })(),\r\n\r\n      // IIFE to check arraybuffer support\r\n      arraybuffer: (() => {\r\n        return this._criticalTests.arrayBufferSupport();\r\n      })(),\r\n\r\n      // IIFE to check dataurl support\r\n      dataurl: (() => {\r\n        return this._criticalTests.dataUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check objecturl support\r\n      objecturl: (() => {\r\n        return this._criticalTests.objectUrlSupport();\r\n      })(),\r\n\r\n      // IIFE to check rgba support\r\n      rgba: (() => {\r\n        return this._criticalTests.rgbaSupport();\r\n      })(),\r\n\r\n      // IIFE to check webaudio support\r\n      webaudio: (() => {\r\n        return this._warningTest.webAudioSupport();\r\n      })(),\r\n\r\n      // IIFE to check webgl support\r\n      webgl: (() => {\r\n        return this._warningTest.webglSupport();\r\n      })(),\r\n\r\n      // IIFE to check gamepadapi support\r\n      gamepadapi: (() => {\r\n        return !!(<any>navigator).getGamepads;\r\n      })()\r\n    };\r\n  }\r\n\r\n  // critical browser features required for ex to run\r\n  private _criticalTests: CriticalTests = {\r\n    // Test canvas/2d context support\r\n    canvasSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('2d'));\r\n    },\r\n\r\n    // Test array buffer support ex uses for downloading binary data\r\n    arrayBufferSupport: function() {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.open('GET', '/');\r\n      try {\r\n        xhr.responseType = 'arraybuffer';\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n      return xhr.responseType === 'arraybuffer';\r\n    },\r\n\r\n    // Test data urls ex uses for sprites\r\n    dataUrlSupport: function() {\r\n      const canvas = document.createElement('canvas');\r\n      return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\r\n    },\r\n\r\n    // Test object url support for loading\r\n    objectUrlSupport: function() {\r\n      return 'URL' in window && 'revokeObjectURL' in URL && 'createObjectURL' in URL;\r\n    },\r\n\r\n    // RGBA support for colors\r\n    rgbaSupport: function() {\r\n      const style = document.createElement('a').style;\r\n      style.cssText = 'background-color:rgba(150,255,150,.5)';\r\n      return ('' + style.backgroundColor).indexOf('rgba') > -1;\r\n    }\r\n  };\r\n\r\n  // warnings excalibur performance will be degraded\r\n  private _warningTest: WarningTests = {\r\n    webAudioSupport: function() {\r\n      return !!(\r\n        (<any>window).AudioContext ||\r\n        (<any>window).webkitAudioContext ||\r\n        (<any>window).mozAudioContext ||\r\n        (<any>window).msAudioContext ||\r\n        (<any>window).oAudioContext\r\n      );\r\n    },\r\n    webglSupport: function() {\r\n      const elem = document.createElement('canvas');\r\n      return !!(elem.getContext && elem.getContext('webgl'));\r\n    }\r\n  };\r\n\r\n  public test(): boolean {\r\n    // Critical test will for ex not to run\r\n    let failedCritical = false;\r\n    for (const test in this._criticalTests) {\r\n      if (!this._criticalTests[<keyof CriticalTests>test].call(this)) {\r\n        this.failedTests.push(test);\r\n        Logger.getInstance().error('Critical browser feature missing, Excalibur requires:', test);\r\n        failedCritical = true;\r\n      }\r\n    }\r\n    if (failedCritical) {\r\n      return false;\r\n    }\r\n\r\n    // Warning tests do not for ex to return false to compatibility\r\n    for (const warning in this._warningTest) {\r\n      if (!this._warningTest[<keyof WarningTests>warning]()) {\r\n        Logger.getInstance().warn('Warning browser feature missing, Excalibur will have reduced performance:', warning);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/**\r\n * An enum that describes the types of collisions bodies can participate in\r\n */\r\nexport enum CollisionType {\r\n  /**\r\n   * Bodies with the `PreventCollision` setting do not participate in any\r\n   * collisions and do not raise collision events.\r\n   */\r\n  PreventCollision = 'PreventCollision',\r\n  /**\r\n   * Bodies with the `Passive` setting only raise collision events, but are not\r\n   * influenced or moved by other bodies and do not influence or move other bodies.\r\n   * This is useful for use in trigger type behavior.\r\n   */\r\n  Passive = 'Passive',\r\n  /**\r\n   * Bodies with the `Active` setting raise collision events and participate\r\n   * in collisions with other bodies and will be push or moved by bodies sharing\r\n   * the `Active` or `Fixed` setting.\r\n   */\r\n  Active = 'Active',\r\n  /**\r\n   * Bodies with the `Fixed` setting raise collision events and participate in\r\n   * collisions with other bodies. Actors with the `Fixed` setting will not be\r\n   * pushed or moved by other bodies sharing the `Fixed`. Think of Fixed\r\n   * bodies as \"immovable/unstoppable\" objects. If two `Fixed` bodies meet they will\r\n   * not be pushed or moved by each other, they will not interact except to throw\r\n   * collision events.\r\n   */\r\n  Fixed = 'Fixed'\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n\r\n/**\r\n * Possible collision resolution strategies\r\n *\r\n * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics. This is useful for things\r\n * like platformers or top down games.\r\n *\r\n * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n * simulated physical interactions.\r\n */\r\nexport enum CollisionResolutionStrategy {\r\n  Arcade = 'arcade',\r\n  Realistic = 'realistic'\r\n}\r\n\r\n/**\r\n * Possible broadphase collision pair identification strategies\r\n *\r\n * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n * potential collision pairs which is O(nlog(n)) faster.\r\n */\r\nexport enum BroadphaseStrategy {\r\n  DynamicAABBTree\r\n}\r\n\r\n/**\r\n * Possible numerical integrators for position and velocity\r\n */\r\nexport enum Integrator {\r\n  Euler\r\n}\r\n\r\n/**\r\n * The [[Physics]] object is the global configuration object for all Excalibur physics.\r\n */\r\n/* istanbul ignore next */\r\nexport class Physics {\r\n  /**\r\n   * Global acceleration that is applied to all vanilla actors that have a [[CollisionType.Active|active]] collision type.\r\n   * Global acceleration won't effect [[Label|labels]], [[ScreenElement|ui actors]], or [[Trigger|triggers]] in Excalibur.\r\n   *\r\n   * This is a great way to globally simulate effects like gravity.\r\n   */\r\n  public static acc = new Vector(0, 0);\r\n  public static get gravity() {\r\n    return Physics.acc;\r\n  }\r\n  public static set gravity(v: Vector) {\r\n    Physics.acc = v;\r\n  }\r\n\r\n  /**\r\n   * Globally switches all Excalibur physics behavior on or off.\r\n   */\r\n  public static enabled = true;\r\n\r\n  /**\r\n   * Gets or sets the broadphase pair identification strategy.\r\n   *\r\n   * The default strategy is [[BroadphaseStrategy.DynamicAABBTree]] which uses a binary tree of axis-aligned bounding boxes to identify\r\n   * potential collision pairs which is O(nlog(n)) faster.\r\n   */\r\n  public static broadphaseStrategy: BroadphaseStrategy = BroadphaseStrategy.DynamicAABBTree;\r\n\r\n  /**\r\n   * Gets or sets the global collision resolution strategy (narrowphase).\r\n   *\r\n   * The default is [[CollisionResolutionStrategy.Arcade]] which performs simple axis aligned arcade style physics.\r\n   *\r\n   * More advanced rigid body physics are enabled by setting [[CollisionResolutionStrategy.Realistic]] which allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static collisionResolutionStrategy: CollisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  /**\r\n   * The default mass to use if none is specified\r\n   */\r\n  public static defaultMass: number = 10;\r\n  /**\r\n   * Gets or sets the position and velocity positional integrator, currently only Euler is supported.\r\n   */\r\n  public static integrator: Integrator = Integrator.Euler;\r\n\r\n  /**\r\n   * Configures Excalibur to use \"arcade\" physics. Arcade physics which performs simple axis aligned arcade style physics.\r\n   */\r\n  public static useArcadePhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Arcade;\r\n  }\r\n\r\n  /**\r\n   * Configures Excalibur to use rigid body physics. Rigid body physics allows for complicated\r\n   * simulated physical interactions.\r\n   */\r\n  public static useRealisticPhysics(): void {\r\n    Physics.collisionResolutionStrategy = CollisionResolutionStrategy.Realistic;\r\n  }\r\n\r\n  /**\r\n   * Factor to add to the RigidBody BoundingBox, bounding box (dimensions += vel * dynamicTreeVelocityMultiplier);\r\n   */\r\n  public static dynamicTreeVelocityMultiplier = 2;\r\n\r\n  @obsolete({\r\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\r\n    alternateMethod: 'dynamicTreeVelocityMultiplier'\r\n  })\r\n  public static get dynamicTreeVelocityMultiplyer() {\r\n    return Physics.dynamicTreeVelocityMultiplier;\r\n  }\r\n\r\n  public static set dynamicTreeVelocityMultiplyer(value: number) {\r\n    Physics.dynamicTreeVelocityMultiplier = value;\r\n  }\r\n\r\n  /**\r\n   * Pad RigidBody BoundingBox by a constant amount\r\n   */\r\n  public static boundsPadding = 5;\r\n\r\n  /**\r\n   * Number of position iterations (overlap) to run in the solver\r\n   */\r\n  public static positionIterations = 3;\r\n\r\n  /**\r\n   * Number of velocity iteration (response) to run in the solver\r\n   */\r\n  public static velocityIterations = 8;\r\n\r\n  /**\r\n   * Amount of overlap to tolerate in pixels\r\n   */\r\n  public static slop = 1;\r\n\r\n  /**\r\n   * Amount of positional overlap correction to apply each position iteration of the solver\r\n   * O - meaning no correction, 1 - meaning correct all overlap\r\n   */\r\n  public static steeringFactor = 0.2;\r\n\r\n  /**\r\n   * Warm start set to true re-uses impulses from previous frames back in the solver\r\n   */\r\n  public static warmStart = true;\r\n\r\n  /**\r\n   * By default bodies do not sleep\r\n   */\r\n  public static bodiesCanSleepByDefault = false;\r\n\r\n  /**\r\n   * Surface epsilon is used to help deal with surface penetration\r\n   */\r\n  public static surfaceEpsilon = 0.1;\r\n\r\n  public static sleepEpsilon = 0.07;\r\n\r\n  public static wakeThreshold = Physics.sleepEpsilon * 3;\r\n\r\n  public static sleepBias = 0.9;\r\n\r\n  /**\r\n   * Enable fast moving body checking, this enables checking for collision pairs via raycast for fast moving objects to prevent\r\n   * bodies from tunneling through one another.\r\n   */\r\n  public static checkForFastBodies = true;\r\n\r\n  /**\r\n   * Disable minimum fast moving body raycast, by default if ex.Physics.checkForFastBodies = true Excalibur will only check if the\r\n   * body is moving at least half of its minimum dimension in an update. If ex.Physics.disableMinimumSpeedForFastBody is set to true,\r\n   * Excalibur will always perform the fast body raycast regardless of speed.\r\n   */\r\n  public static disableMinimumSpeedForFastBody = false;\r\n}\r\n","import { Vector } from './vector';\r\n\r\nexport interface VectorViewOptions {\r\n  getX: () => number;\r\n  getY: () => number;\r\n  setX: (x: number) => void;\r\n  setY: (y: number) => void;\r\n}\r\nexport class VectorView extends Vector {\r\n  private _getX: () => number;\r\n  private _getY: () => number;\r\n  private _setX: (x: number) => void;\r\n  private _setY: (y: number) => void;\r\n  constructor(options: VectorViewOptions) {\r\n    super(0, 0);\r\n    this._getX = options.getX;\r\n    this._getY = options.getY;\r\n    this._setX = options.setX;\r\n    this._setY = options.setY;\r\n  }\r\n  public get x() {\r\n    return (this._x = this._getX());\r\n  }\r\n\r\n  public set x(val) {\r\n    this._setX(val);\r\n    this._x = val;\r\n  }\r\n\r\n  public get y() {\r\n    return (this._y = this._getY());\r\n  }\r\n  public set y(val) {\r\n    this._setY(val);\r\n    this._y = val;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\n\r\n/**\r\n * Component Contructor Types\r\n */\r\nexport declare type ComponentCtor<T extends Component = Component> = new (...args:any[]) => T;\r\n\r\n/**\r\n * Type guard to check if a component implements clone\r\n * @param x\r\n */\r\nfunction hasClone(x: any): x is { clone(): any } {\r\n  return !!x?.clone;\r\n}\r\n\r\nexport type ComponentType<ComponentToParse> = ComponentToParse extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * Plucks the string type out of a component type\r\n */\r\nexport type ComponentStringType<T> = T extends Component<infer R> ? R : string;\r\n\r\n/**\r\n * Components are containers for state in Excalibur, the are meant to convey capabilities that an Entity posesses\r\n *\r\n * Implementations of Component must have a zero-arg constructor to support dependecies\r\n *\r\n * ```typescript\r\n * class MyComponent extends ex.Component<'my'> {\r\n *   public readonly type = 'my';\r\n *   // zero arg support required if you want to use component dependencies\r\n *   constructor(public optionalPos?: ex.Vector) {}\r\n * }\r\n * ```\r\n */\r\nexport abstract class Component<TypeName extends string = string> {\r\n  /**\r\n   * Optionally list any component types this component depends on\r\n   * If the owner entity does not have these components, new components will be added to the entity\r\n   *\r\n   * Only components with zero-arg constructors are supported as automatic component dependencies\r\n   */\r\n  readonly dependencies?: ComponentCtor[];\r\n\r\n  // todo implement optional\r\n  readonly optional?: ComponentCtor[];\r\n\r\n  /**\r\n   * Type of this component, must be a unique type among component types in you game.\r\n   */\r\n  abstract readonly type: TypeName;\r\n\r\n  /**\r\n   * Current owning [[Entity]], if any, of this component. Null if not added to any [[Entity]]\r\n   */\r\n  owner?: Entity = null;\r\n\r\n  /**\r\n   * Clones any properties on this component, if that property value has a `clone()` method it will be called\r\n   */\r\n  clone(): this {\r\n    const newComponent = new (this.constructor as any)();\r\n    for (const prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        const val = this[prop];\r\n        if (hasClone(val) && prop !== 'owner' && prop !== 'clone') {\r\n          newComponent[prop] = val.clone();\r\n        } else {\r\n          newComponent[prop] = val;\r\n        }\r\n      }\r\n    }\r\n    return newComponent;\r\n  }\r\n\r\n  /**\r\n   * Optional callback called when a component is added to an entity\r\n   */\r\n  onAdd?(owner: Entity): void;\r\n\r\n  /**\r\n   * Opitonal callback called when acomponent is added to an entity\r\n   */\r\n  onRemove?(previousOwner: Entity): void;\r\n}\r\n\r\n/**\r\n * Tag components are a way of tagging a component with label and a simple value\r\n *\r\n * For example:\r\n *\r\n * ```typescript\r\n * const isOffscreen = new TagComponent('offscreen');\r\n * entity.addComponent(isOffscreen);\r\n * entity.tags.includes\r\n * ```\r\n */\r\nexport class TagComponent<TypeName extends string, MaybeValueType extends string | symbol | number | boolean = never> extends Component<\r\nTypeName\r\n> {\r\n  constructor(public readonly type: TypeName, public readonly value?: MaybeValueType) {\r\n    super();\r\n  }\r\n}\r\n","import { Matrix, MatrixLocations } from '../../Math/matrix';\r\nimport { VectorView } from '../../Math/vector-view';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Component } from '../Component';\r\n\r\nexport interface Transform {\r\n  /**\r\n   * The [[CoordPlane|coordinate plane]] for this transform for the entity.\r\n   */\r\n  coordPlane: CoordPlane;\r\n\r\n  /**\r\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\r\n   *\r\n   * If the entity has a parent this position is relative to the parent entity.\r\n   */\r\n  pos: Vector;\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  z: number;\r\n\r\n  /**\r\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\r\n   *\r\n   * If the entity has a parent this rotation is relative to the parent.\r\n   */\r\n  rotation: number;\r\n\r\n  /**\r\n   * The scale of the entity. If the entity has a parent this scale is relative to the parent.\r\n   */\r\n  scale: Vector;\r\n}\r\n\r\nconst createPosView = (matrix: Matrix) => {\r\n  const source = matrix;\r\n  return new VectorView({\r\n    setX: (x) => {\r\n      source.data[MatrixLocations.X] = x;\r\n    },\r\n    setY: (y) => {\r\n      source.data[MatrixLocations.Y] = y;\r\n    },\r\n    getX: () => {\r\n      return source.data[MatrixLocations.X];\r\n    },\r\n    getY: () => {\r\n      return source.data[MatrixLocations.Y];\r\n    }\r\n  });\r\n};\r\n\r\nconst createScaleView = (matrix: Matrix) => {\r\n  const source = matrix;\r\n  return new VectorView({\r\n    setX: (x) => {\r\n      source.setScaleX(x);\r\n    },\r\n    setY: (y) => {\r\n      source.setScaleY(y);\r\n    },\r\n    getX: () => {\r\n      return source.getScaleX();\r\n    },\r\n    getY: () => {\r\n      return source.getScaleY();\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Enum representing the coordinate plane for the position 2D vector in the [[TransformComponent]]\r\n */\r\nexport enum CoordPlane {\r\n  /**\r\n   * The world coordinate plane (default) represents world space, any entities drawn with world\r\n   * space move when the camera moves.\r\n   */\r\n  World = 'world',\r\n  /**\r\n   * The screen coordinate plane represents screen space, entities drawn in screen space are pinned\r\n   * to screen coordinates ignoring the camera.\r\n   */\r\n  Screen = 'screen'\r\n}\r\n\r\nexport class TransformComponent extends Component<'ex.transform'> implements Transform {\r\n  public readonly type = 'ex.transform';\r\n\r\n  private _dirty = false;\r\n\r\n  public readonly matrix = Matrix.identity().translate(0, 0).rotate(0).scale(1, 1);\r\n  private _position = createPosView(this.matrix);\r\n  private _rotation = 0;\r\n  private _scale = createScaleView(this.matrix);\r\n\r\n  private _recalculate() {\r\n    this._rotation = this.matrix.getRotation();\r\n    this._dirty = false;\r\n  }\r\n\r\n  public getGlobalMatrix(): Matrix {\r\n    if (!this.parent) {\r\n      return this.matrix;\r\n    } else {\r\n      return this.parent.getGlobalMatrix().multm(this.matrix);\r\n    }\r\n  }\r\n\r\n  public getGlobalTransform(): Transform {\r\n    return {\r\n      pos: this.globalPos,\r\n      scale: this.globalScale,\r\n      rotation: this.globalRotation,\r\n      z: this.z,\r\n      coordPlane: this.coordPlane\r\n    };\r\n  }\r\n\r\n  public get parent(): TransformComponent | null {\r\n    return this?.owner?.parent?.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * The [[CoordPlane|coordinate plane|]] for this transform for the entity.\r\n   */\r\n  public coordPlane = CoordPlane.World;\r\n\r\n  /**\r\n   * The current position of the entity in world space or in screen space depending on the the [[CoordPlane|coordinate plane]].\r\n   *\r\n   * If a parent entity exists coordinates are local to the parent.\r\n   */\r\n  public get pos(): Vector {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._position;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.matrix.setPosition(val.x, val.y);\r\n    this._dirty = true;\r\n  }\r\n\r\n  // Dirty flag check up the chain\r\n  public get dirty(): boolean {\r\n    if (this?.owner?.parent) {\r\n      const parent = this.parent;\r\n      return parent.dirty || this._dirty;\r\n    }\r\n    return this._dirty;\r\n  }\r\n\r\n  /**\r\n   * The current world position calculated\r\n   */\r\n  public get globalPos(): Vector {\r\n    const source = this.getGlobalMatrix();\r\n    return new VectorView({\r\n      getX: () => source.data[MatrixLocations.X],\r\n      getY: () => source.data[MatrixLocations.Y],\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const [newX] = this.parent?.getGlobalMatrix().getAffineInverse().multv([x, source.data[MatrixLocations.Y]]);\r\n          this.matrix.data[MatrixLocations.X] = newX;\r\n        } else {\r\n          this.matrix.data[MatrixLocations.X] = x;\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const [, newY] = this.parent?.getGlobalMatrix().getAffineInverse().multv([source.data[MatrixLocations.X], y]);\r\n          this.matrix.data[MatrixLocations.Y] = newY;\r\n        } else {\r\n          this.matrix.data[MatrixLocations.Y] = y;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public set globalPos(val: Vector) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.pos = val;\r\n    } else {\r\n      this.pos = parentTransform.getGlobalMatrix().getAffineInverse().multv(val);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The z-index ordering of the entity, a higher values are drawn on top of lower values.\r\n   * For example z=99 would be drawn on top of z=0.\r\n   */\r\n  public z: number = 0;\r\n\r\n  /**\r\n   * The rotation of the entity in radians. For example `Math.PI` radians is the same as 180 degrees.\r\n   */\r\n  public get rotation(): number {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._rotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.matrix.setRotation(val);\r\n    this._dirty = true;\r\n  }\r\n\r\n  public get globalRotation(): number {\r\n    return this.getGlobalMatrix().getRotation();\r\n  }\r\n\r\n  public set globalRotation(val: number) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.rotation = val;\r\n    } else {\r\n      this.rotation = val - parentTransform.globalRotation;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The scale of the entity.\r\n   */\r\n  public get scale(): Vector {\r\n    if (this._dirty) {\r\n      this._recalculate();\r\n    }\r\n    return this._scale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.matrix.setScale(val);\r\n    this._dirty = true;\r\n  }\r\n\r\n  public get globalScale(): Vector {\r\n    const source = this.getGlobalMatrix();\r\n    return new VectorView({\r\n      getX: () => source.getScaleX(),\r\n      getY: () => source.getScaleY(),\r\n      setX: (x) => {\r\n        if (this.parent) {\r\n          const globalScaleX = this.parent.globalScale.x;\r\n          this.matrix.setScaleX(x / globalScaleX);\r\n        } else {\r\n          this.matrix.setScaleX(x);\r\n        }\r\n      },\r\n      setY: (y) => {\r\n        if (this.parent) {\r\n          const globalScaleY = this.parent.globalScale.y;\r\n          this.matrix.setScaleY(y / globalScaleY);\r\n        } else {\r\n          this.matrix.setScaleY(y);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public set globalScale(val: Vector) {\r\n    const parentTransform = this.parent;\r\n    if (!parentTransform) {\r\n      this.scale = val;\r\n    } else {\r\n      this.scale = vec(val.x / parentTransform.globalScale.x, val.y / parentTransform.globalScale.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply the transform to a point\r\n   * @param point\r\n   */\r\n  public apply(point: Vector): Vector {\r\n    return this.matrix.multv(point);\r\n  }\r\n\r\n  /**\r\n   * Apply the inverse transform to a point\r\n   * @param point\r\n   */\r\n  public applyInverse(point: Vector): Vector {\r\n    return this.matrix.getAffineInverse().multv(point);\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { Component } from '../Component';\n\nexport interface Motion {\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  vel: Vector;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  acc: Vector;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  scaleFactor: Vector;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  angularVelocity: number;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  torque: number;\n\n  /**\n   * Inerita can be thought of as the resistance to motion\n   */\n  inertia: number;\n}\n\nexport class MotionComponent extends Component<'ex.motion'> {\n  public readonly type = 'ex.motion';\n\n  /**\n   * The velocity of an entity in pixels per second\n   */\n  public vel: Vector = Vector.Zero;\n\n  /**\n   * The acceleration of entity in pixels per second^2\n   */\n  public acc: Vector = Vector.Zero;\n\n  /**\n   * The scale rate of change in scale units per second\n   */\n  public scaleFactor: Vector = Vector.Zero;\n\n  /**\n   * The angular velocity which is how quickly the entity is rotating in radians per second\n   */\n  public angularVelocity = 0;\n\n  /**\n   * The amount of torque applied to the entity, angular acceleration is torque * inertia\n   */\n  public torque: number = 0;\n\n  /**\n   * Inerita can be thought of as the resistance to motion\n   */\n  public inertia: number = 1;\n}\n","/**\r\n * CollisionGroups indicate like members that do not collide with each other. Use [[CollisionGroupManager]] to create [[CollisionGroup]]s\r\n *\r\n * For example:\r\n *\r\n * Players have collision group \"player\"\r\n *\r\n * ![Player Collision Group](/assets/images/docs/CollisionGroupsPlayer.png)\r\n *\r\n * Enemies have collision group \"enemy\"\r\n *\r\n * ![Enemy Collision Group](/assets/images/docs/CollisionGroupsEnemy.png)\r\n *\r\n * Blocks have collision group \"ground\"\r\n *\r\n * ![Ground collision group](/assets/images/docs/CollisionGroupsGround.png)\r\n *\r\n * Players don't collide with each other, but enemies and blocks. Likewise, enemies don't collide with each other but collide\r\n * with players and blocks.\r\n *\r\n * This is done with bitmasking, see the following pseudo-code\r\n *\r\n * PlayerGroup = `0b001`\r\n * PlayerGroupMask = `0b110`\r\n *\r\n * EnemyGroup = `0b010`\r\n * EnemyGroupMask = `0b101`\r\n *\r\n * BlockGroup = `0b100`\r\n * BlockGroupMask = `0b011`\r\n *\r\n * Should Players collide? No because the bitwise mask evaluates to 0\r\n * `(player1.group & player2.mask) === 0`\r\n * `(0b001 & 0b110) === 0`\r\n *\r\n * Should Players and Enemies collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & enemy1.mask) === 1`\r\n * `(0b001 & 0b101) === 1`\r\n *\r\n * Should Players and Blocks collide? Yes because the bitwise mask is non-zero\r\n * `(player1.group & blocks1.mask) === 1`\r\n * `(0b001 & 0b011) === 1`\r\n */\r\nexport class CollisionGroup {\r\n  /**\r\n   * The `All` [[CollisionGroup]] is a special group that collides with all other groups including itself,\r\n   * it is the default collision group on colliders.\r\n   */\r\n  public static All = new CollisionGroup('Collide with all groups', -1, -1);\r\n\r\n  private _name: string;\r\n  private _category: number;\r\n  private _mask: number;\r\n\r\n  /**\r\n   * STOP!!** It is preferred that [[CollisionGroupManager.create]] is used to create collision groups\r\n   *  unless you know how to construct the proper bitmasks. See https://github.com/excaliburjs/Excalibur/issues/1091 for more info.\r\n   * @param name Name of the collision group\r\n   * @param category 32 bit category for the group, should be a unique power of 2. For example `0b001` or `0b010`\r\n   * @param mask 32 bit mask of category, or `~category` generally. For a category of `0b001`, the mask would be `0b110`\r\n   */\r\n  constructor(name: string, category: number, mask: number) {\r\n    this._name = name;\r\n    this._category = category;\r\n    this._mask = mask;\r\n  }\r\n\r\n  /**\r\n   * Get the name of the collision group\r\n   */\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /**\r\n   * Get the category of the collision group, a 32 bit number which should be a unique power of 2\r\n   */\r\n  public get category() {\r\n    return this._category;\r\n  }\r\n\r\n  /**\r\n   * Get the mask for this collision group\r\n   */\r\n  public get mask() {\r\n    return this._mask;\r\n  }\r\n\r\n  /**\r\n   * Evaluates whether 2 collision groups can collide\r\n   * @param other  CollisionGroup\r\n   */\r\n  public canCollide(other: CollisionGroup): boolean {\r\n    return (this.category & other.mask) !== 0 && (other.category & this.mask) !== 0;\r\n  }\r\n\r\n  /**\r\n   * Inverts the collision group. For example, if before the group specified \"players\",\r\n   * inverting would specify all groups except players\r\n   * @returns CollisionGroup\r\n   */\r\n  public invert(): CollisionGroup {\r\n    return new CollisionGroup('~(' + this.name + ')', ~this.category, ~this.mask);\r\n  }\r\n\r\n  /**\r\n   * Combine collision groups with each other. The new group includes all of the previous groups.\r\n   *\r\n   * @param collisionGroups\r\n   * @returns\r\n   */\r\n  public static combine(collisionGroups: CollisionGroup[]) {\r\n    const combinedName = collisionGroups.map((c) => c.name).join('+');\r\n    const combinedCategory = collisionGroups.reduce((current, g) => g.category | current, 0b0);\r\n    const combinedMask = ~combinedCategory;\r\n\r\n    return new CollisionGroup(combinedName, combinedCategory, combinedMask);\r\n  }\r\n\r\n  /**\r\n   * Creates a collision group that collides with the listed groups\r\n   * @param collisionGroups\r\n   */\r\n  public static collidesWith(collisionGroups: CollisionGroup[]) {\r\n    return CollisionGroup.combine(collisionGroups).invert();\r\n  }\r\n}\r\n","/**\r\n * Defines a generic message that can contain any data\r\n * @template T is the typescript Type of the data\r\n */\r\nexport interface Message<T> {\r\n  type: string;\r\n  data: T;\r\n}\r\n\r\n/**\r\n * Defines an interface for an observer to receive a message via a notify() method\r\n */\r\nexport interface Observer<T> {\r\n  notify(message: T): void;\r\n}\r\n\r\n/**\r\n * Defines an interface for something that might be an observer if a notify() is present\r\n */\r\nexport type MaybeObserver<T> = Partial<Observer<T>>;\r\n\r\n/**\r\n * Simple Observable implemenation\r\n * @template T is the typescript Type that defines the data being observed\r\n */\r\nexport class Observable<T> {\r\n  public observers: Observer<T>[] = [];\r\n  public subscriptions: ((val: T) => any)[] = [];\r\n\r\n  /**\r\n   * Register an observer to listen to this observable\r\n   * @param observer\r\n   */\r\n  register(observer: Observer<T>) {\r\n    this.observers.push(observer);\r\n  }\r\n\r\n  /**\r\n   * Register a callback to listen to this observable\r\n   * @param func\r\n   */\r\n  subscribe(func: (val: T) => any) {\r\n    this.subscriptions.push(func);\r\n  }\r\n\r\n  /**\r\n   * Remove an observer from the observable\r\n   * @param observer\r\n   */\r\n  unregister(observer: Observer<T>) {\r\n    const i = this.observers.indexOf(observer);\r\n    if (i !== -1) {\r\n      this.observers.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove a callback that is listening to this observable\r\n   * @param func\r\n   */\r\n  unsubscribe(func: (val: T) => any) {\r\n    const i = this.subscriptions.indexOf(func);\r\n    if (i !== -1) {\r\n      this.subscriptions.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Broadcasts a message to all observers and callbacks\r\n   * @param message\r\n   */\r\n  notifyAll(message: T) {\r\n    this.observers.forEach((o) => o.notify(message));\r\n    this.subscriptions.forEach(cb => cb(message));\r\n  }\r\n\r\n  /**\r\n   * Removes all observers and callbacks\r\n   */\r\n  clear() {\r\n    this.observers.length = 0;\r\n    this.subscriptions.length = 0;\r\n  }\r\n}\r\n","import { CollisionContact } from './CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Id } from '../../Id';\r\nimport { Collider } from '../Colliders/Collider';\r\n\r\n/**\r\n * Models a potential collision between 2 colliders\r\n */\r\nexport class Pair {\r\n  public id: string = null;\r\n  constructor(public colliderA: Collider, public colliderB: Collider) {\r\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n  }\r\n\r\n  public static canCollide(colliderA: Collider, colliderB: Collider) {\r\n    const bodyA = colliderA?.owner?.get(BodyComponent);\r\n    const bodyB = colliderB?.owner?.get(BodyComponent);\r\n\r\n    // Body's needed for collision in the current state\r\n    // TODO can we collide without a body?\r\n    if (!bodyA || !bodyB) {\r\n      return false;\r\n    }\r\n\r\n    // If both are in the same collision group short circuit\r\n    if (!bodyA.group.canCollide(bodyB.group)) {\r\n      return false;\r\n    }\r\n\r\n    // if both are fixed short circuit\r\n    if (bodyA.collisionType === CollisionType.Fixed && bodyB.collisionType === CollisionType.Fixed) {\r\n      return false;\r\n    }\r\n\r\n    // if the either is prevent collision short circuit\r\n    if (bodyB.collisionType === CollisionType.PreventCollision || bodyA.collisionType === CollisionType.PreventCollision) {\r\n      return false;\r\n    }\r\n\r\n    // if either is dead short circuit\r\n    if (!bodyA.active || !bodyB.active) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not it is possible for the pairs to collide\r\n   */\r\n  public get canCollide(): boolean {\r\n    const colliderA = this.colliderA;\r\n    const colliderB = this.colliderB;\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Runs the collision intersection logic on the members of this pair\r\n   */\r\n  public collide(): CollisionContact[] {\r\n    return this.colliderA.collide(this.colliderB);\r\n  }\r\n\r\n  /**\r\n   * Check if the collider is part of the pair\r\n   * @param collider\r\n   * @returns\r\n   */\r\n  public hasCollider(collider: Collider) {\r\n    return collider === this.colliderA || collider === this.colliderB;\r\n  }\r\n\r\n  /**\r\n   * Calculates the unique pair hash id for this collision pair (owning id)\r\n   */\r\n  public static calculatePairHash(idA: Id<'collider'>, idB: Id<'collider'>): string {\r\n    if (idA.value < idB.value) {\r\n      return `#${idA.value}+${idB.value}`;\r\n    } else {\r\n      return `#${idB.value}+${idA.value}`;\r\n    }\r\n  }\r\n}\r\n","/**\n * A 1 dimensional projection on an axis, used to test overlaps\n */\n\nexport class Projection {\n  constructor(public min: number, public max: number) {}\n  public overlaps(projection: Projection): boolean {\n    return this.max > projection.min && projection.max > this.min;\n  }\n\n  public getOverlap(projection: Projection): number {\n    if (this.overlaps(projection)) {\n      if (this.max > projection.max) {\n        return projection.max - this.min;\n      } else {\n        return this.max - projection.min;\n      }\n    }\n    return 0;\n  }\n}\n","import { Physics } from '../Physics';\r\nimport { BoundingBox } from '../BoundingBox';\r\n\r\nimport { Ray } from '../../Math/ray';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Id } from '../../Id';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { Color, ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Dynamic Tree Node used for tracking bounds within the tree\r\n */\r\nexport class TreeNode<T> {\r\n  public left: TreeNode<T>;\r\n  public right: TreeNode<T>;\r\n  public bounds: BoundingBox;\r\n  public height: number;\r\n  public data: T;\r\n  constructor(public parent?: TreeNode<T>) {\r\n    this.parent = parent || null;\r\n    this.data = null;\r\n    this.bounds = new BoundingBox();\r\n    this.left = null;\r\n    this.right = null;\r\n    this.height = 0;\r\n  }\r\n\r\n  public isLeaf(): boolean {\r\n    return !this.left && !this.right;\r\n  }\r\n}\r\n\r\nexport interface ColliderProxy<T> {\r\n  id: Id<'collider'>;\r\n  owner: T;\r\n  bounds: BoundingBox;\r\n}\r\n\r\n/**\r\n * The DynamicTrees provides a spatial partitioning data structure for quickly querying for overlapping bounding boxes for\r\n * all tracked bodies. The worst case performance of this is O(n*log(n)) where n is the number of bodies in the tree.\r\n *\r\n * Internally the bounding boxes are organized as a balanced binary tree of bounding boxes, where the leaf nodes are tracked bodies.\r\n * Every non-leaf node is a bounding box that contains child bounding boxes.\r\n */\r\nexport class DynamicTree<T extends ColliderProxy<Entity>> {\r\n  public root: TreeNode<T>;\r\n  public nodes: { [key: number]: TreeNode<T> };\r\n  constructor(public worldBounds: BoundingBox = new BoundingBox(-Number.MAX_VALUE, -Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)) {\r\n    this.root = null;\r\n    this.nodes = {};\r\n  }\r\n\r\n  /**\r\n   * Inserts a node into the dynamic tree\r\n   */\r\n  private _insert(leaf: TreeNode<T>): void {\r\n    // If there are no nodes in the tree, make this the root leaf\r\n    if (this.root === null) {\r\n      this.root = leaf;\r\n      this.root.parent = null;\r\n      return;\r\n    }\r\n\r\n    // Search the tree for a node that is not a leaf and find the best place to insert\r\n    const leafAABB = leaf.bounds;\r\n    let currentRoot = this.root;\r\n    while (!currentRoot.isLeaf()) {\r\n      const left = currentRoot.left;\r\n      const right = currentRoot.right;\r\n\r\n      const area = currentRoot.bounds.getPerimeter();\r\n      const combinedAABB = currentRoot.bounds.combine(leafAABB);\r\n      const combinedArea = combinedAABB.getPerimeter();\r\n\r\n      // Calculate cost heuristic for creating a new parent and leaf\r\n      const cost = 2 * combinedArea;\r\n\r\n      // Minimum cost of pushing the leaf down the tree\r\n      const inheritanceCost = 2 * (combinedArea - area);\r\n\r\n      // Cost of descending\r\n      let leftCost = 0;\r\n      const leftCombined = leafAABB.combine(left.bounds);\r\n      let newArea;\r\n      let oldArea;\r\n      if (left.isLeaf()) {\r\n        leftCost = leftCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = left.bounds.getPerimeter();\r\n        newArea = leftCombined.getPerimeter();\r\n        leftCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      let rightCost = 0;\r\n      const rightCombined = leafAABB.combine(right.bounds);\r\n      if (right.isLeaf()) {\r\n        rightCost = rightCombined.getPerimeter() + inheritanceCost;\r\n      } else {\r\n        oldArea = right.bounds.getPerimeter();\r\n        newArea = rightCombined.getPerimeter();\r\n        rightCost = newArea - oldArea + inheritanceCost;\r\n      }\r\n\r\n      // cost is acceptable\r\n      if (cost < leftCost && cost < rightCost) {\r\n        break;\r\n      }\r\n\r\n      // Descend to the depths\r\n      if (leftCost < rightCost) {\r\n        currentRoot = left;\r\n      } else {\r\n        currentRoot = right;\r\n      }\r\n    }\r\n\r\n    // Create the new parent node and insert into the tree\r\n    const oldParent = currentRoot.parent;\r\n    const newParent = new TreeNode(oldParent);\r\n    newParent.bounds = leafAABB.combine(currentRoot.bounds);\r\n    newParent.height = currentRoot.height + 1;\r\n\r\n    if (oldParent !== null) {\r\n      // The sibling node was not the root\r\n      if (oldParent.left === currentRoot) {\r\n        oldParent.left = newParent;\r\n      } else {\r\n        oldParent.right = newParent;\r\n      }\r\n\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n    } else {\r\n      // The sibling node was the root\r\n      newParent.left = currentRoot;\r\n      newParent.right = leaf;\r\n\r\n      currentRoot.parent = newParent;\r\n      leaf.parent = newParent;\r\n      this.root = newParent;\r\n    }\r\n\r\n    // Walk up the tree fixing heights and AABBs\r\n    let currentNode = leaf.parent;\r\n    while (currentNode) {\r\n      currentNode = this._balance(currentNode);\r\n\r\n      if (!currentNode.left) {\r\n        throw new Error('Parent of current leaf cannot have a null left child' + currentNode);\r\n      }\r\n      if (!currentNode.right) {\r\n        throw new Error('Parent of current leaf cannot have a null right child' + currentNode);\r\n      }\r\n\r\n      currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n      currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n\r\n      currentNode = currentNode.parent;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a node from the dynamic tree\r\n   */\r\n  private _remove(leaf: TreeNode<T>) {\r\n    if (leaf === this.root) {\r\n      this.root = null;\r\n      return;\r\n    }\r\n\r\n    const parent = leaf.parent;\r\n    const grandParent = parent.parent;\r\n    let sibling: TreeNode<T>;\r\n    if (parent.left === leaf) {\r\n      sibling = parent.right;\r\n    } else {\r\n      sibling = parent.left;\r\n    }\r\n\r\n    if (grandParent) {\r\n      if (grandParent.left === parent) {\r\n        grandParent.left = sibling;\r\n      } else {\r\n        grandParent.right = sibling;\r\n      }\r\n      sibling.parent = grandParent;\r\n\r\n      let currentNode = grandParent;\r\n      while (currentNode) {\r\n        currentNode = this._balance(currentNode);\r\n        currentNode.bounds = currentNode.left.bounds.combine(currentNode.right.bounds);\r\n        currentNode.height = 1 + Math.max(currentNode.left.height, currentNode.right.height);\r\n\r\n        currentNode = currentNode.parent;\r\n      }\r\n    } else {\r\n      this.root = sibling;\r\n      sibling.parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tracks a body in the dynamic tree\r\n   */\r\n  public trackCollider(collider: T) {\r\n    const node = new TreeNode<T>();\r\n    node.data = collider;\r\n    node.bounds = collider.bounds;\r\n    node.bounds.left -= 2;\r\n    node.bounds.top -= 2;\r\n    node.bounds.right += 2;\r\n    node.bounds.bottom += 2;\r\n    this.nodes[collider.id.value] = node;\r\n    this._insert(node);\r\n  }\r\n\r\n  /**\r\n   * Updates the dynamic tree given the current bounds of each body being tracked\r\n   */\r\n  public updateCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return false;\r\n    }\r\n    const b = collider.bounds;\r\n\r\n    // if the body is outside the world no longer update it\r\n    if (!this.worldBounds.contains(b)) {\r\n      Logger.getInstance().warn(\r\n        'Collider with id ' + collider.id.value + ' is outside the world bounds and will no longer be tracked for physics'\r\n      );\r\n      this.untrackCollider(collider);\r\n      return false;\r\n    }\r\n\r\n    if (node.bounds.contains(b)) {\r\n      return false;\r\n    }\r\n\r\n    this._remove(node);\r\n    b.left -= Physics.boundsPadding;\r\n    b.top -= Physics.boundsPadding;\r\n    b.right += Physics.boundsPadding;\r\n    b.bottom += Physics.boundsPadding;\r\n\r\n    // THIS IS CAUSING UNECESSARY CHECKS\r\n    if (collider.owner) {\r\n      const body = collider.owner?.get(BodyComponent);\r\n      if (body) {\r\n        const multdx = ((body.vel.x * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n        const multdy = ((body.vel.y * 32) / 1000) * Physics.dynamicTreeVelocityMultiplier;\r\n\r\n        if (multdx < 0) {\r\n          b.left += multdx;\r\n        } else {\r\n          b.right += multdx;\r\n        }\r\n\r\n        if (multdy < 0) {\r\n          b.top += multdy;\r\n        } else {\r\n          b.bottom += multdy;\r\n        }\r\n      }\r\n    }\r\n\r\n    node.bounds = b;\r\n    this._insert(node);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Untracks a body from the dynamic tree\r\n   */\r\n  public untrackCollider(collider: T) {\r\n    const node = this.nodes[collider.id.value];\r\n    if (!node) {\r\n      return;\r\n    }\r\n    this._remove(node);\r\n    this.nodes[collider.id.value] = null;\r\n    delete this.nodes[collider.id.value];\r\n  }\r\n\r\n  /**\r\n   * Balances the tree about a node\r\n   */\r\n  private _balance(node: TreeNode<T>) {\r\n    if (node === null) {\r\n      throw new Error('Cannot balance at null node');\r\n    }\r\n\r\n    if (node.isLeaf() || node.height < 2) {\r\n      return node;\r\n    }\r\n\r\n    const left = node.left;\r\n    const right = node.right;\r\n\r\n    const a = node;\r\n    const b = left;\r\n    const c = right;\r\n    const d = left.left;\r\n    const e = left.right;\r\n    const f = right.left;\r\n    const g = right.right;\r\n\r\n    const balance = c.height - b.height;\r\n    // Rotate c node up\r\n    if (balance > 1) {\r\n      // Swap the right node with it's parent\r\n      c.left = a;\r\n      c.parent = a.parent;\r\n      a.parent = c;\r\n\r\n      // The original node's old parent should point to the right node\r\n      // this is mega confusing\r\n      if (c.parent) {\r\n        if (c.parent.left === a) {\r\n          c.parent.left = c;\r\n        } else {\r\n          c.parent.right = c;\r\n        }\r\n      } else {\r\n        this.root = c;\r\n      }\r\n\r\n      // Rotate\r\n      if (f.height > g.height) {\r\n        c.right = f;\r\n        a.right = g;\r\n        g.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(g.bounds);\r\n        c.bounds = a.bounds.combine(f.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, g.height);\r\n        c.height = 1 + Math.max(a.height, f.height);\r\n      } else {\r\n        c.right = g;\r\n        a.right = f;\r\n        f.parent = a;\r\n\r\n        a.bounds = b.bounds.combine(f.bounds);\r\n        c.bounds = a.bounds.combine(g.bounds);\r\n\r\n        a.height = 1 + Math.max(b.height, f.height);\r\n        c.height = 1 + Math.max(a.height, g.height);\r\n      }\r\n\r\n      return c;\r\n    }\r\n    // Rotate left node up\r\n    if (balance < -1) {\r\n      // swap\r\n      b.left = a;\r\n      b.parent = a.parent;\r\n      a.parent = b;\r\n\r\n      // node's old parent should point to b\r\n      if (b.parent) {\r\n        if (b.parent.left === a) {\r\n          b.parent.left = b;\r\n        } else {\r\n          if (b.parent.right !== a) {\r\n            throw 'Error rotating Dynamic Tree';\r\n          }\r\n          b.parent.right = b;\r\n        }\r\n      } else {\r\n        this.root = b;\r\n      }\r\n\r\n      // rotate\r\n      if (d.height > e.height) {\r\n        b.right = d;\r\n        a.left = e;\r\n        e.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(e.bounds);\r\n        b.bounds = a.bounds.combine(d.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, e.height);\r\n        b.height = 1 + Math.max(a.height, d.height);\r\n      } else {\r\n        b.right = e;\r\n        a.left = d;\r\n        d.parent = a;\r\n\r\n        a.bounds = c.bounds.combine(d.bounds);\r\n        b.bounds = a.bounds.combine(e.bounds);\r\n\r\n        a.height = 1 + Math.max(c.height, d.height);\r\n        b.height = 1 + Math.max(a.height, e.height);\r\n      }\r\n      return b;\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal height of the tree, shorter trees are better. Performance drops as the tree grows\r\n   */\r\n  public getHeight(): number {\r\n    if (this.root === null) {\r\n      return 0;\r\n    }\r\n    return this.root.height;\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be colliding with the provided body.\r\n   *\r\n   * In the query callback, it will be passed a potential collider. Returning true from this callback indicates\r\n   * that you are complete with your query and you do not want to continue. Returning false will continue searching\r\n   * the tree until all possible colliders have been returned.\r\n   */\r\n  public query(collider: T, callback: (other: T) => boolean): void {\r\n    const bounds = collider.bounds;\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.intersect(bounds)) {\r\n        if (currentNode.isLeaf() && currentNode.data !== collider) {\r\n          if (callback.call(collider, currentNode.data)) {\r\n            return true;\r\n          }\r\n        } else {\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  /**\r\n   * Queries the Dynamic Axis Aligned Tree for bodies that could be intersecting. By default the raycast query uses an infinitely\r\n   * long ray to test the tree specified by `max`.\r\n   *\r\n   * In the query callback, it will be passed a potential body that intersects with the raycast. Returning true from this\r\n   * callback indicates that your are complete with your query and do not want to continue. Return false will continue searching\r\n   * the tree until all possible bodies that would intersect with the ray have been returned.\r\n   */\r\n  public rayCastQuery(ray: Ray, max: number = Infinity, callback: (other: T) => boolean): void {\r\n    const helper = (currentNode: TreeNode<T>): boolean => {\r\n      if (currentNode && currentNode.bounds.rayCast(ray, max)) {\r\n        if (currentNode.isLeaf()) {\r\n          if (callback.call(ray, currentNode.data)) {\r\n            // ray hit a leaf! return the body\r\n            return true;\r\n          }\r\n        } else {\r\n          // ray hit but not at a leaf, recurse deeper\r\n          return helper(currentNode.left) || helper(currentNode.right);\r\n        }\r\n      }\r\n      return false; // ray missed\r\n    };\r\n    helper(this.root);\r\n  }\r\n\r\n  public getNodes(): TreeNode<T>[] {\r\n    const helper = (currentNode: TreeNode<T>): TreeNode<T>[] => {\r\n      if (currentNode) {\r\n        return [currentNode].concat(helper(currentNode.left), helper(currentNode.right));\r\n      } else {\r\n        return [];\r\n      }\r\n    };\r\n    return helper(this.root);\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    // draw all the nodes in the Dynamic Tree\r\n    const helper = (currentNode: TreeNode<T>) => {\r\n      if (currentNode) {\r\n        if (currentNode.isLeaf()) {\r\n          currentNode.bounds.draw(ex, Color.Green);\r\n        } else {\r\n          currentNode.bounds.draw(ex, Color.White);\r\n        }\r\n\r\n        if (currentNode.left) {\r\n          helper(currentNode.left);\r\n        }\r\n        if (currentNode.right) {\r\n          helper(currentNode.right);\r\n        }\r\n      }\r\n    };\r\n\r\n    helper(this.root);\r\n  }\r\n}\r\n","import { Line } from './line';\nimport { Vector } from './vector';\n\n/**\n * A 2D ray that can be cast into the scene to do collision detection\n */\n\nexport class Ray {\n  public pos: Vector;\n  public dir: Vector;\n\n  /**\n   * @param pos The starting position for the ray\n   * @param dir The vector indicating the direction of the ray\n   */\n  constructor(pos: Vector, dir: Vector) {\n    this.pos = pos;\n    this.dir = dir.normalize();\n  }\n\n  /**\n   * Tests a whether this ray intersects with a line segment. Returns a number greater than or equal to 0 on success.\n   * This number indicates the mathematical intersection time.\n   * @param line  The line to test\n   */\n  public intersect(line: Line): number {\n    const numerator = line.begin.sub(this.pos);\n\n    // Test is line and ray are parallel and non intersecting\n    if (this.dir.cross(line.getSlope()) === 0 && numerator.cross(this.dir) !== 0) {\n      return -1;\n    }\n\n    // Lines are parallel\n    const divisor = this.dir.cross(line.getSlope());\n    if (divisor === 0) {\n      return -1;\n    }\n\n    const t = numerator.cross(line.getSlope()) / divisor;\n\n    if (t >= 0) {\n      const u = numerator.cross(this.dir) / divisor / line.getLength();\n      if (u >= 0 && u <= 1) {\n        return t;\n      }\n    }\n    return -1;\n  }\n\n  public intersectPoint(line: Line): Vector {\n    const time = this.intersect(line);\n    if (time < 0) {\n      return null;\n    }\n    return this.getPoint(time);\n  }\n\n  /**\n   * Returns the point of intersection given the intersection time\n   */\n  public getPoint(time: number): Vector {\n    return this.pos.add(this.dir.scale(time));\n  }\n}\n","import { Physics } from '../Physics';\r\nimport { CollisionProcessor } from './CollisionProcessor';\r\nimport { DynamicTree } from './DynamicTree';\r\nimport { Pair } from './Pair';\r\n\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { FrameStats } from '../../Debug';\r\nimport { Logger } from '../../Util/Log';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Collider } from '../Colliders/Collider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CompositeCollider } from '../Colliders/CompositeCollider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\n/**\r\n * Responsible for performing the collision broadphase (locating potential colllisions) and\r\n * the narrowphase (actual collision contacts)\r\n */\r\nexport class DynamicTreeCollisionProcessor implements CollisionProcessor {\r\n  private _dynamicCollisionTree = new DynamicTree<Collider>();\r\n  private _collisions = new Set<string>();\r\n\r\n  private _collisionPairCache: Pair[] = [];\r\n  private _colliders: Collider[] = [];\r\n\r\n  public getColliders(): readonly Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  /**\r\n   * Tracks a physics body for collisions\r\n   */\r\n  public track(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot track null collider');\r\n      return;\r\n    }\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        c.owner = target.owner;\r\n        this._colliders.push(c);\r\n        this._dynamicCollisionTree.trackCollider(c);\r\n      }\r\n    } else {\r\n      this._colliders.push(target);\r\n      this._dynamicCollisionTree.trackCollider(target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Untracks a physics body\r\n   */\r\n  public untrack(target: Collider): void {\r\n    if (!target) {\r\n      Logger.getInstance().warn('Cannot untrack a null collider');\r\n      return;\r\n    }\r\n\r\n    if (target instanceof CompositeCollider) {\r\n      const colliders = target.getColliders();\r\n      for (const c of colliders) {\r\n        const index = this._colliders.indexOf(c);\r\n        if (index !== -1) {\r\n          this._colliders.splice(index, 1);\r\n        }\r\n        this._dynamicCollisionTree.untrackCollider(c);\r\n      }\r\n    } else {\r\n      const index = this._colliders.indexOf(target);\r\n      if (index !== -1) {\r\n        this._colliders.splice(index, 1);\r\n      }\r\n      this._dynamicCollisionTree.untrackCollider(target);\r\n    }\r\n  }\r\n\r\n  private _shouldGenerateCollisionPair(colliderA: Collider, colliderB: Collider) {\r\n    // if the collision pair must be 2 separate colliders\r\n    // Also separate owners for composite colliders\r\n    if (\r\n      (colliderA.id !== null &&\r\n      colliderB.id !== null &&\r\n      colliderA.id === colliderB.id) ||\r\n      (colliderA.owner !== null &&\r\n       colliderB.owner !== null &&\r\n       colliderA.owner === colliderB.owner)) {\r\n      return false;\r\n    }\r\n\r\n    // if the collision pair has been calculated already short circuit\r\n    const hash = Pair.calculatePairHash(colliderA.id, colliderB.id);\r\n    if (this._collisions.has(hash)) {\r\n      return false; // pair exists easy exit return false\r\n    }\r\n\r\n    // if the pair has a member with zero dimension\r\n    if (colliderA.localBounds.hasZeroDimensions() || colliderB.localBounds.hasZeroDimensions()) {\r\n      return false;\r\n    }\r\n\r\n    return Pair.canCollide(colliderA, colliderB);\r\n  }\r\n\r\n  /**\r\n   * Detects potential collision pairs in a broadphase approach with the dynamic aabb tree strategy\r\n   */\r\n  public broadphase(targets: Collider[], delta: number, stats?: FrameStats): Pair[] {\r\n    const seconds = delta / 1000;\r\n\r\n    // Retrieve the list of potential colliders, exclude killed, prevented, and self\r\n    const potentialColliders = targets.filter((other) => {\r\n      const body = other.owner?.get(BodyComponent);\r\n      return other.owner?.active && body.collisionType !== CollisionType.PreventCollision;\r\n    });\r\n\r\n    // clear old list of collision pairs\r\n    this._collisionPairCache = [];\r\n    this._collisions.clear();\r\n\r\n    // check for normal collision pairs\r\n    let collider: Collider;\r\n    for (let j = 0, l = potentialColliders.length; j < l; j++) {\r\n      collider = potentialColliders[j];\r\n      // Query the collision tree for potential colliders\r\n      this._dynamicCollisionTree.query(collider, (other: Collider) => {\r\n        if (this._shouldGenerateCollisionPair(collider, other)) {\r\n          const pair = new Pair(collider, other);\r\n          this._collisions.add(pair.id);\r\n          this._collisionPairCache.push(pair);\r\n        }\r\n        // Always return false, to query whole tree. Returning true in the query method stops searching\r\n        return false;\r\n      });\r\n    }\r\n    if (stats) {\r\n      stats.physics.pairs = this._collisionPairCache.length;\r\n    }\r\n\r\n    // Check dynamic tree for fast moving objects\r\n    // Fast moving objects are those moving at least there smallest bound per frame\r\n    if (Physics.checkForFastBodies) {\r\n      for (const collider of potentialColliders) {\r\n        const body = collider.owner.get(BodyComponent);\r\n        // Skip non-active objects. Does not make sense on other collision types\r\n        if (body.collisionType !== CollisionType.Active) {\r\n          continue;\r\n        }\r\n\r\n        // Maximum travel distance next frame\r\n        const updateDistance =\r\n          body.vel.size * seconds + // velocity term\r\n          body.acc.size * 0.5 * seconds * seconds; // acc term\r\n\r\n        // Find the minimum dimension\r\n        const minDimension = Math.min(collider.bounds.height, collider.bounds.width);\r\n        if (Physics.disableMinimumSpeedForFastBody || updateDistance > minDimension / 2) {\r\n          if (stats) {\r\n            stats.physics.fastBodies++;\r\n          }\r\n\r\n          // start with the oldPos because the integration for actors has already happened\r\n          // objects resting on a surface may be slightly penetrating in the current position\r\n          const updateVec = body.pos.sub(body.oldPos);\r\n          const centerPoint = collider.center;\r\n          const furthestPoint = collider.getFurthestPoint(body.vel);\r\n          const origin: Vector = furthestPoint.sub(updateVec);\r\n\r\n          const ray: Ray = new Ray(origin, body.vel);\r\n\r\n          // back the ray up by -2x surfaceEpsilon to account for fast moving objects starting on the surface\r\n          ray.pos = ray.pos.add(ray.dir.scale(-2 * Physics.surfaceEpsilon));\r\n          let minCollider: Collider;\r\n          let minTranslate: Vector = new Vector(Infinity, Infinity);\r\n          this._dynamicCollisionTree.rayCastQuery(ray, updateDistance + Physics.surfaceEpsilon * 2, (other: Collider) => {\r\n            if (collider !== other && Pair.canCollide(collider, other)) {\r\n              const hitPoint = other.rayCast(ray, updateDistance + Physics.surfaceEpsilon * 10);\r\n              if (hitPoint) {\r\n                const translate = hitPoint.sub(origin);\r\n                if (translate.size < minTranslate.size) {\r\n                  minTranslate = translate;\r\n                  minCollider = other;\r\n                }\r\n              }\r\n            }\r\n            return false;\r\n          });\r\n\r\n          if (minCollider && Vector.isValid(minTranslate)) {\r\n            const pair = new Pair(collider, minCollider);\r\n            if (!this._collisions.has(pair.id)) {\r\n              this._collisions.add(pair.id);\r\n              this._collisionPairCache.push(pair);\r\n            }\r\n            // move the fast moving object to the other body\r\n            // need to push into the surface by ex.Physics.surfaceEpsilon\r\n            const shift = centerPoint.sub(furthestPoint);\r\n            body.pos = origin\r\n              .add(shift)\r\n              .add(minTranslate)\r\n              .add(ray.dir.scale(10 * Physics.surfaceEpsilon)); // needed to push the shape slightly into contact\r\n            collider.update(body.transform);\r\n\r\n            if (stats) {\r\n              stats.physics.fastBodyCollisions++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // return cache\r\n    return this._collisionPairCache;\r\n  }\r\n\r\n  /**\r\n   * Applies narrow phase on collision pairs to find actual area intersections\r\n   * Adds actual colliding pairs to stats' Frame data\r\n   */\r\n  public narrowphase(pairs: Pair[], stats?: FrameStats): CollisionContact[] {\r\n    let contacts: CollisionContact[] = [];\r\n    for (let i = 0; i < pairs.length; i++) {\r\n      const newContacts = pairs[i].collide();\r\n      contacts = contacts.concat(newContacts);\r\n      if (stats && newContacts.length > 0) {\r\n        for (const c of newContacts) {\r\n          stats.physics.contacts.set(c.id, c);\r\n        }\r\n      }\r\n    }\r\n    if (stats) {\r\n      stats.physics.collisions += contacts.length;\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  /**\r\n   * Update the dynamic tree positions\r\n   */\r\n  public update(targets: Collider[]): number {\r\n    let updated = 0;\r\n    const len = targets.length;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n      if (this._dynamicCollisionTree.updateCollider(targets[i])) {\r\n        updated++;\r\n      }\r\n    }\r\n    return updated;\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext) {\r\n    this._dynamicCollisionTree.debug(ex);\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Clonable } from '../../Interfaces/Clonable';\r\nimport { Entity, Transform } from '../../EntityComponentSystem';\r\nimport { createId, Id } from '../../Id';\r\nimport { EventDispatcher } from '../../EventDispatcher';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\n/**\r\n * A collision collider specifies the geometry that can detect when other collision colliders intersect\r\n * for the purposes of colliding 2 objects in excalibur.\r\n */\r\nexport abstract class Collider implements Clonable<Collider> {\r\n  private static _ID = 0;\r\n  public readonly id: Id<'collider'> = createId('collider', Collider._ID++);\r\n  public events: EventDispatcher<Collider> = new EventDispatcher<Collider>(this);\r\n\r\n  /**\r\n   * Returns a boolean indicating whether this body collided with\r\n   * or was in stationary contact with\r\n   * the body of the other [[Collider]]\r\n   */\r\n  public touching(other: Collider): boolean {\r\n    const contact = this.collide(other);\r\n\r\n    if (contact) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public owner: Entity;\r\n\r\n  /**\r\n   * Pixel offset of the collision collider relative to the collider, by default (0, 0) meaning the collider is positioned\r\n   * on top of the collider.\r\n   */\r\n  offset: Vector;\r\n\r\n  /**\r\n   * Position of the collision collider in world coordinates\r\n   */\r\n  abstract get worldPos(): Vector;\r\n\r\n  /**\r\n   * The center point of the collision collider, for example if the collider is a circle it would be the center.\r\n   */\r\n  abstract get center(): Vector;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in world coordinates\r\n   */\r\n  abstract get bounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axis-aligned bounding box of the collision collider in local coordinates\r\n   */\r\n  abstract get localBounds(): BoundingBox;\r\n\r\n  /**\r\n   * Return the axes of this particular collider\r\n   */\r\n  abstract get axes(): Vector[];\r\n  /**\r\n   * Find the furthest point on the convex hull of this particular collider in a certain direction.\r\n   */\r\n  abstract getFurthestPoint(direction: Vector): Vector;\r\n\r\n  abstract getInertia(mass: number): number;\r\n\r\n  // All new CollisionShape need to do the following\r\n  // Create a new collision function in the CollisionJumpTable against all the primitives\r\n  // Currently there are 3 primitive collision collider 3! = 6 jump functions\r\n  abstract collide(collider: Collider): CollisionContact[];\r\n\r\n  /**\r\n   * Returns the closest line between the surfaces this collider and another\r\n   * @param collider\r\n   */\r\n  abstract getClosestLineBetween(collider: Collider): Line;\r\n\r\n  /**\r\n   * Return wether the collider contains a point inclusive to it's border\r\n   */\r\n  abstract contains(point: Vector): boolean;\r\n\r\n  /**\r\n   * Return the point on the border of the collision collider that intersects with a ray (if any).\r\n   */\r\n  abstract rayCast(ray: Ray, max?: number): Vector;\r\n\r\n  /**\r\n   * Create a projection of this collider along an axis. Think of this as casting a \"shadow\" along an axis\r\n   */\r\n  abstract project(axis: Vector): Projection;\r\n\r\n  /**\r\n   * Updates collider world space geometry\r\n   */\r\n  abstract update(transform: Transform): void;\r\n\r\n  /**\r\n   * Draw the collider\r\n   * @deprecated Will be removed in 0.26.0\r\n   * @param ctx\r\n   * @param color\r\n   */\r\n  abstract draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void;\r\n\r\n  abstract debug(ex: ExcaliburGraphicsContext, color: Color): void;\r\n  /**\r\n   * Draw any debug information\r\n   * @deprecated Will be removed in 0.26.0\r\n   */\r\n  abstract debugDraw(ctx: CanvasRenderingContext2D, color: Color): void;\r\n\r\n  abstract clone(): Collider;\r\n}\r\n","import { Util } from '../..';\r\nimport { Pair } from '../Detection/Pair';\r\nimport { Color } from '../../Color';\r\nimport { Transform } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { Line } from '../../Math/line';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Vector } from '../../Math/vector';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { DynamicTree } from '../Detection/DynamicTree';\r\nimport { DynamicTreeCollisionProcessor } from '../Detection/DynamicTreeCollisionProcessor';\r\nimport { Collider } from './Collider';\r\n\r\nexport class CompositeCollider extends Collider {\r\n  private _transform: Transform;\r\n  private _collisionProcessor = new DynamicTreeCollisionProcessor();\r\n  private _dynamicAABBTree = new DynamicTree();\r\n  private _colliders: Collider[] = [];\r\n\r\n  constructor(colliders: Collider[]) {\r\n    super();\r\n    for (const c of colliders) {\r\n      this.addCollider(c);\r\n    }\r\n  }\r\n\r\n  clearColliders() {\r\n    this._colliders = [];\r\n  }\r\n\r\n  addCollider(collider: Collider) {\r\n    this.events.wire(collider.events);\r\n    this._colliders.push(collider);\r\n    this._collisionProcessor.track(collider);\r\n    this._dynamicAABBTree.trackCollider(collider);\r\n  }\r\n\r\n  removeCollider(collider: Collider) {\r\n    this.events.unwire(collider.events);\r\n    Util.removeItemFromArray(collider, this._colliders);\r\n    this._collisionProcessor.untrack(collider);\r\n    this._dynamicAABBTree.untrackCollider(collider);\r\n  }\r\n\r\n  getColliders(): Collider[] {\r\n    return this._colliders;\r\n  }\r\n\r\n  get worldPos(): Vector {\r\n    // TODO transform component world pos\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get center(): Vector {\r\n    return this._transform?.pos ?? Vector.Zero;\r\n  }\r\n\r\n  get bounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce(\r\n      (acc, collider) => acc.combine(collider.bounds),\r\n      colliders[0]?.bounds ?? new BoundingBox().translate(this.worldPos)\r\n    );\r\n\r\n    return results;\r\n  }\r\n\r\n  get localBounds(): BoundingBox {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    const results = colliders.reduce((acc, collider) => acc.combine(collider.localBounds), colliders[0]?.localBounds ?? new BoundingBox());\r\n\r\n    return results;\r\n  }\r\n\r\n  get axes(): Vector[] {\r\n    // TODO cache this\r\n    const colliders = this.getColliders();\r\n    let axes: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      axes = axes.concat(collider.axes);\r\n    }\r\n    return axes;\r\n  }\r\n\r\n  getFurthestPoint(direction: Vector): Vector {\r\n    const colliders = this.getColliders();\r\n    const furthestPoints: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      furthestPoints.push(collider.getFurthestPoint(direction));\r\n    }\r\n    // Pick best point from all colliders\r\n    let bestPoint = furthestPoints[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (const point of furthestPoints) {\r\n      const distance = point.dot(direction);\r\n      if (distance > maxDistance) {\r\n        bestPoint = point;\r\n        maxDistance = distance;\r\n      }\r\n    }\r\n    return bestPoint;\r\n  }\r\n\r\n  getInertia(mass: number): number {\r\n    const colliders = this.getColliders();\r\n    let totalInertia = 0;\r\n    for (const collider of colliders) {\r\n      totalInertia += collider.getInertia(mass);\r\n    }\r\n    return totalInertia;\r\n  }\r\n\r\n  collide(other: Collider): CollisionContact[] {\r\n    let otherColliders = [other];\r\n    if (other instanceof CompositeCollider) {\r\n      otherColliders = other.getColliders();\r\n    }\r\n\r\n    const pairs: Pair[] = [];\r\n    for (const c of otherColliders) {\r\n      this._dynamicAABBTree.query(c, (potentialCollider: Collider) => {\r\n        pairs.push(new Pair(c, potentialCollider));\r\n        return false;\r\n      });\r\n    }\r\n\r\n    let contacts: CollisionContact[] = [];\r\n    for (const p of pairs) {\r\n      contacts = contacts.concat(p.collide());\r\n    }\r\n    return contacts;\r\n  }\r\n\r\n  getClosestLineBetween(other: Collider): Line {\r\n    const colliders = this.getColliders();\r\n    const lines: Line[] = [];\r\n    if (other instanceof CompositeCollider) {\r\n      const otherColliders = other.getColliders();\r\n      for (const colliderA of colliders) {\r\n        for (const colliderB of otherColliders) {\r\n          const maybeLine = colliderA.getClosestLineBetween(colliderB);\r\n          if (maybeLine) {\r\n            lines.push(maybeLine);\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      for (const collider of colliders) {\r\n        const maybeLine = other.getClosestLineBetween(collider);\r\n        if (maybeLine) {\r\n          lines.push(maybeLine);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (lines.length) {\r\n      let minLength = lines[0].getLength();\r\n      let minLine = lines[0];\r\n      for (const line of lines) {\r\n        const length = line.getLength();\r\n        if (length < minLength) {\r\n          minLength = length;\r\n          minLine = line;\r\n        }\r\n      }\r\n      return minLine;\r\n    }\r\n    return null;\r\n  }\r\n  contains(point: Vector): boolean {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      if (collider.contains(point)) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  rayCast(ray: Ray, max?: number): Vector {\r\n    const colliders = this.getColliders();\r\n    const points: Vector[] = [];\r\n    for (const collider of colliders) {\r\n      const vec = collider.rayCast(ray, max);\r\n      if (vec) {\r\n        points.push(vec);\r\n      }\r\n    }\r\n    if (points.length) {\r\n      let minPoint = points[0];\r\n      let minDistance = minPoint.dot(ray.dir);\r\n      for (const point of points) {\r\n        const distance = ray.dir.dot(point);\r\n        if (distance < minDistance) {\r\n          minPoint = point;\r\n          minDistance = distance;\r\n        }\r\n      }\r\n      return minPoint;\r\n    }\r\n    return null;\r\n  }\r\n  project(axis: Vector): Projection {\r\n    const colliders = this.getColliders();\r\n    const projs: Projection[] = [];\r\n    for (const collider of colliders) {\r\n      const proj = collider.project(axis);\r\n      if (proj) {\r\n        projs.push(proj);\r\n      }\r\n    }\r\n    // Merge all proj's on the same axis\r\n    if (projs.length) {\r\n      const newProjection = new Projection(projs[0].min, projs[0].max);\r\n      for (const proj of projs) {\r\n        newProjection.min = Math.min(proj.min, newProjection.min);\r\n        newProjection.max = Math.max(proj.max, newProjection.max);\r\n      }\r\n      return newProjection;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  update(transform: Transform): void {\r\n    if (transform) {\r\n      const colliders = this.getColliders();\r\n      for (const collider of colliders) {\r\n        collider.owner = this.owner;\r\n        collider.update(transform);\r\n      }\r\n    }\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D, color?: Color, pos?: Vector): void {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.draw(ctx, color, pos);\r\n    }\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.debug(ex, color);\r\n    }\r\n  }\r\n\r\n  debugDraw(ctx: CanvasRenderingContext2D, color: Color): void {\r\n    const colliders = this.getColliders();\r\n    for (const collider of colliders) {\r\n      collider.draw(ctx, color);\r\n    }\r\n  }\r\n  clone(): Collider {\r\n    return new CompositeCollider(this._colliders.map((c) => c.clone()));\r\n  }\r\n}\r\n","import { Vector } from './vector';\n\n/**\n * A 2D line segment\n */\n\nexport class Line {\n  /**\n   * @param begin  The starting point of the line segment\n   * @param end  The ending point of the line segment\n   */\n  constructor(public begin: Vector, public end: Vector) {}\n\n  /**\n   * Gets the raw slope (m) of the line. Will return (+/-)Infinity for vertical lines.\n   */\n  public get slope() {\n    return (this.end.y - this.begin.y) / (this.end.x - this.begin.x);\n  }\n\n  /**\n   * Gets the Y-intercept (b) of the line. Will return (+/-)Infinity if there is no intercept.\n   */\n  public get intercept() {\n    return this.begin.y - this.slope * this.begin.x;\n  }\n\n  /**\n   * Gets the normal of the line\n   */\n  public normal(): Vector {\n    return this.end.sub(this.begin).normal();\n  }\n\n  public dir(): Vector {\n    return this.end.sub(this.begin);\n  }\n\n  public getPoints(): Vector[] {\n    return [this.begin, this.end];\n  }\n\n  /**\n   * Returns the slope of the line in the form of a vector of length 1\n   */\n  public getSlope(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return end.sub(begin).scale(1 / distance);\n  }\n\n  /**\n   * Returns the edge of the line as vector, the length of the vector is the length of the edge\n   */\n  public getEdge(): Vector {\n    const begin = this.begin;\n    const end = this.end;\n    return end.sub(begin);\n  }\n\n  /**\n   * Returns the length of the line segment in pixels\n   */\n  public getLength(): number {\n    const begin = this.begin;\n    const end = this.end;\n    const distance = begin.distance(end);\n    return distance;\n  }\n\n  /**\n   * Returns the midpoint of the edge\n   */\n  public get midpoint(): Vector {\n    return this.begin.add(this.end).scale(0.5);\n  }\n\n  /**\n   * Flips the direction of the line segment\n   */\n  public flip(): Line {\n    return new Line(this.end, this.begin);\n  }\n\n  /**\n   * Tests if a given point is below the line, points in the normal direction above the line are considered above.\n   * @param point\n   */\n  public below(point: Vector): boolean {\n    const above2 = (this.end.x - this.begin.x) * (point.y - this.begin.y) - (this.end.y - this.begin.y) * (point.x - this.begin.x);\n    return above2 >= 0;\n  }\n\n  /**\n   * Returns the clip point\n   * @param sideVector Vector that traces the line\n   * @param length Length to clip along side\n   */\n  public clip(sideVector: Vector, length: number): Line {\n    let dir = sideVector;\n    dir = dir.normalize();\n\n    const near = dir.dot(this.begin) - length;\n    const far = dir.dot(this.end) - length;\n\n    const results = [];\n    if (near <= 0) {\n      results.push(this.begin);\n    }\n    if (far <= 0) {\n      results.push(this.end);\n    }\n\n    if (near * far < 0) {\n      const clipTime = near / (near - far);\n      results.push(this.begin.add(this.end.sub(this.begin).scale(clipTime)));\n    }\n    if (results.length !== 2) {\n      return null;\n    }\n\n    return new Line(results[0], results[1]);\n  }\n\n  /**\n   * Find the perpendicular distance from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * @param point\n   */\n  public distanceToPoint(point: Vector, signed: boolean = false) {\n    const x0 = point.x;\n    const y0 = point.y;\n\n    const l = this.getLength();\n\n    const dy = this.end.y - this.begin.y;\n    const dx = this.end.x - this.begin.x;\n    const distance = (dy * x0 - dx * y0 + this.end.x * this.begin.y - this.end.y * this.begin.x) / l;\n    return signed ? distance : Math.abs(distance);\n  }\n\n  /**\n   * Find the perpendicular line from the line to a point\n   * https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n   * (a - p) - ((a - p) * n)n\n   * a is a point on the line\n   * p is the arbitrary point above the line\n   * n is a unit vector in direction of the line\n   * @param point\n   */\n  public findVectorToPoint(point: Vector): Vector {\n    const aMinusP = this.begin.sub(point);\n    const n = this.getSlope();\n\n    return aMinusP.sub(n.scale(aMinusP.dot(n)));\n  }\n\n  /**\n   * Finds a point on the line given only an X or a Y value. Given an X value, the function returns\n   * a new point with the calculated Y value and vice-versa.\n   *\n   * @param x The known X value of the target point\n   * @param y The known Y value of the target point\n   * @returns A new point with the other calculated axis value\n   */\n  public findPoint(x: number = null, y: number = null): Vector {\n    const m = this.slope;\n    const b = this.intercept;\n\n    if (x !== null) {\n      return new Vector(x, m * x + b);\n    } else if (y !== null) {\n      return new Vector((y - b) / m, y);\n    } else {\n      throw new Error('You must provide an X or a Y value');\n    }\n  }\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(x: number, y: number, threshold?: number): boolean;\n\n  /**\n   * Whether or not the given point lies on this line. This method is precise by default\n   * meaning the point must lie exactly on the line. Adjust threshold to\n   * loosen the strictness of the check for floating-point calculations.\n   */\n  public hasPoint(v: Vector, threshold?: number): boolean;\n\n  /**\n   * @see http://stackoverflow.com/a/11908158/109458\n   */\n  public hasPoint(): boolean {\n    let currPoint: Vector;\n    let threshold = 0;\n\n    if (typeof arguments[0] === 'number' && typeof arguments[1] === 'number') {\n      currPoint = new Vector(arguments[0], arguments[1]);\n      threshold = arguments[2] || 0;\n    } else if (arguments[0] instanceof Vector) {\n      currPoint = arguments[0];\n      threshold = arguments[1] || 0;\n    } else {\n      throw 'Could not determine the arguments for Vector.hasPoint';\n    }\n\n    const dxc = currPoint.x - this.begin.x;\n    const dyc = currPoint.y - this.begin.y;\n\n    const dx1 = this.end.x - this.begin.x;\n    const dy1 = this.end.y - this.begin.y;\n\n    const cross = dxc * dy1 - dyc * dx1;\n\n    // check whether point lines on the line\n    if (Math.abs(cross) > threshold) {\n      return false;\n    }\n\n    // check whether point lies in-between start and end\n    if (Math.abs(dx1) >= Math.abs(dy1)) {\n      return dx1 > 0 ? this.begin.x <= currPoint.x && currPoint.x <= this.end.x : this.end.x <= currPoint.x && currPoint.x <= this.begin.x;\n    } else {\n      return dy1 > 0 ? this.begin.y <= currPoint.y && currPoint.y <= this.end.y : this.end.y <= currPoint.y && currPoint.y <= this.begin.y;\n    }\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Ray } from '../../Math/ray';\nimport { PolygonCollider } from './PolygonCollider';\nimport { EdgeCollider } from './EdgeCollider';\nimport { CircleCollider } from './CircleCollider';\n\n/**\n * Finds the closes line between 2 line segments, were the magnitude of u, v are the lengths of each segment\n * L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n * L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n * @param p0 Point where L1 begins\n * @param u Direction and length of L1\n * @param q0 Point were L2 begins\n * @param v Direction and length of L2\n */\nexport function ClosestLine(p0: Vector, u: Vector, q0: Vector, v: Vector) {\n  // Distance between 2 lines http://geomalgorithms.com/a07-_distance.html\n\n  // w(s, t) = P(s) - Q(t)\n  // The w(s, t) that has the minimum distance we will say is w(sClosest, tClosest) = wClosest\n  //\n  // wClosest is the vector that is uniquely perpendicular to the 2 line directions u & v.\n  // wClosest = w0 + sClosest * u - tClosest * v, where w0 is p0 - q0\n  //\n  // The closest point between 2 lines then satisfies this pair of equations\n  // 1: u * wClosest = 0\n  // 2: v * wClosest = 0\n  //\n  // Substituting wClosest into the equations we get\n  //\n  // 1: (u * u) * sClosest - (u * v) tClosest = -u * w0\n  // 2: (v * u) * sClosest - (v * v) tClosest = -v * w0\n\n  // simplify w0\n  const w0 = p0.sub(q0);\n\n  // simplify (u * u);\n  const a = u.dot(u);\n  // simplify (u * v);\n  const b = u.dot(v);\n  // simplify (v * v)\n  const c = v.dot(v);\n  // simplify (u * w0)\n  const d = u.dot(w0);\n  // simplify (v * w0)\n  const e = v.dot(w0);\n\n  // denominator ac - b^2\n  const denom = a * c - b * b;\n  let sDenom = denom;\n  let tDenom = denom;\n  // if denom is 0 they are parallel, use any point from either as the start in this case p0\n  if (denom === 0 || denom <= 0.01) {\n    const tClosestParallel = d / b;\n    return new Line(p0, q0.add(v.scale(tClosestParallel)));\n  }\n\n  // Solve for sClosest for infinite line\n  let sClosest = b * e - c * d; // / denom;\n\n  // Solve for tClosest for infinite line\n  let tClosest = a * e - b * d; // / denom;\n\n  // Solve for segments candidate edges, if sClosest and tClosest are outside their segments\n  if (sClosest < 0) {\n    sClosest = 0;\n    tClosest = e;\n    tDenom = c;\n  } else if (sClosest > sDenom) {\n    sClosest = sDenom;\n    tClosest = e + b;\n    tDenom = c;\n  }\n\n  if (tClosest < 0) {\n    tClosest = 0;\n    if (-d < 0) {\n      sClosest = 0;\n    } else if (-d > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d;\n      sDenom = a;\n    }\n  } else if (tClosest > tDenom) {\n    tClosest = tDenom;\n    if (-d + b < 0) {\n      sClosest = 0;\n    } else if (-d + b > a) {\n      sClosest = sDenom;\n    } else {\n      sClosest = -d + b;\n      sDenom = a;\n    }\n  }\n  sClosest = Math.abs(sClosest) < 0.001 ? 0 : sClosest / sDenom;\n  tClosest = Math.abs(tClosest) < 0.001 ? 0 : tClosest / tDenom;\n\n  return new Line(p0.add(u.scale(sClosest)), q0.add(v.scale(tClosest)));\n}\n\nexport const ClosestLineJumpTable = {\n  PolygonPolygonClosestLine(polygonA: PolygonCollider, polygonB: PolygonCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = polygonB.worldPos;\n    const otherDirection = otherWorldPos.sub(polygonA.worldPos);\n    const thisDirection = otherDirection.negate();\n\n    const rayTowardsOther = new Ray(polygonA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(otherWorldPos, thisDirection);\n\n    const thisPoint = polygonA.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n    const otherPoint = polygonB.rayCast(rayTowardsThis).add(rayTowardsThis.dir.scale(0.1));\n\n    const thisFace = polygonA.getClosestFace(thisPoint);\n    const otherFace = polygonB.getClosestFace(otherPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const q0 = otherFace.face.begin;\n    const v = otherFace.face.getEdge();\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonEdgeClosestLine(polygon: PolygonCollider, edge: EdgeCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = edge.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection);\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const q0 = edgeStart;\n    const v = edgeVector;\n\n    return ClosestLine(p0, u, q0, v);\n  },\n\n  PolygonCircleClosestLine(polygon: PolygonCollider, circle: CircleCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circle.worldPos;\n    const otherDirection = otherWorldPos.sub(polygon.worldPos);\n\n    const rayTowardsOther = new Ray(polygon.worldPos, otherDirection.normalize());\n\n    const thisPoint = polygon.rayCast(rayTowardsOther).add(rayTowardsOther.dir.scale(0.1));\n\n    const thisFace = polygon.getClosestFace(thisPoint);\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const p0 = thisFace.face.begin;\n    const u = thisFace.face.getEdge();\n\n    // Time of minimum distance\n    let t = (u.x * (otherWorldPos.x - p0.x) + u.y * (otherWorldPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - otherWorldPos.x, 2) + Math.pow(p0.y + u.y * t - otherWorldPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - otherWorldPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - otherWorldPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(otherWorldPos.x + circlex, otherWorldPos.y + circley));\n  },\n\n  CircleCircleClosestLine(circleA: CircleCollider, circleB: CircleCollider) {\n    // Find the 2 closest faces on each polygon\n    const otherWorldPos = circleB.worldPos;\n    const otherDirection = otherWorldPos.sub(circleA.worldPos);\n\n    const thisWorldPos = circleA.worldPos;\n    const thisDirection = thisWorldPos.sub(circleB.worldPos);\n\n    const rayTowardsOther = new Ray(circleA.worldPos, otherDirection);\n    const rayTowardsThis = new Ray(circleB.worldPos, thisDirection);\n\n    const thisPoint = circleA.rayCast(rayTowardsOther);\n    const otherPoint = circleB.rayCast(rayTowardsThis);\n\n    return new Line(thisPoint, otherPoint);\n  },\n\n  CircleEdgeClosestLine(circle: CircleCollider, edge: EdgeCollider) {\n    // https://math.stackexchange.com/questions/1919177/how-to-find-point-on-line-closest-to-sphere\n    const circleWorlPos = circle.worldPos;\n\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLine = edge.asLine();\n    const edgeStart = edgeLine.begin;\n    const edgeVector = edgeLine.getEdge();\n    const p0 = edgeStart;\n    const u = edgeVector;\n\n    // Time of minimum distance\n    let t = (u.x * (circleWorlPos.x - p0.x) + u.y * (circleWorlPos.y - p0.y)) / (u.x * u.x + u.y * u.y);\n\n    // If time of minimum is past the edge clamp to edge\n    if (t > 1) {\n      t = 1;\n    } else if (t < 0) {\n      t = 0;\n    }\n\n    // Minimum distance\n    const d = Math.sqrt(Math.pow(p0.x + u.x * t - circleWorlPos.x, 2) + Math.pow(p0.y + u.y * t - circleWorlPos.y, 2)) - circle.radius;\n\n    const circlex = ((p0.x + u.x * t - circleWorlPos.x) * circle.radius) / (circle.radius + d);\n    const circley = ((p0.y + u.y * t - circleWorlPos.y) * circle.radius) / (circle.radius + d);\n    return new Line(u.scale(t).add(p0), new Vector(circleWorlPos.x + circlex, circleWorlPos.y + circley));\n  },\n\n  EdgeEdgeClosestLine(edgeA: EdgeCollider, edgeB: EdgeCollider) {\n    // L1 = P(s) = p0 + s * u, where s is time and p0 is the start of the line\n    const edgeLineA = edgeA.asLine();\n    const edgeStartA = edgeLineA.begin;\n    const edgeVectorA = edgeLineA.getEdge();\n    const p0 = edgeStartA;\n    const u = edgeVectorA;\n\n    // L2 = Q(t) = q0 + t * v, where t is time and q0 is the start of the line\n    const edgeLineB = edgeB.asLine();\n    const edgeStartB = edgeLineB.begin;\n    const edgeVectorB = edgeLineB.getEdge();\n    const q0 = edgeStartB;\n    const v = edgeVectorB;\n\n    return ClosestLine(p0, u, q0, v);\n  }\n};\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\n\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\nexport interface CircleColliderOptions {\r\n  /**\r\n   * Optional pixel offset to shift the circle relative to the collider, by default (0, 0).\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Required radius of the circle\r\n   */\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * This is a circle collider for the excalibur rigid body physics simulation\r\n */\r\nexport class CircleCollider extends Collider {\r\n  /**\r\n   * Position of the circle relative to the collider, by default (0, 0).\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  public get worldPos(): Vector {\r\n    return this.offset.add(this._transform?.pos ?? Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * This is the radius of the circle\r\n   */\r\n  public radius: number;\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: CircleColliderOptions) {\r\n    super();\r\n    this.offset = options.offset || Vector.Zero;\r\n    this.radius = options.radius || 0;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this shape, not associated with any collider\r\n   */\r\n  public clone(): CircleCollider {\r\n    return new CircleCollider({\r\n      offset: this.offset.clone(),\r\n      radius: this.radius\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.offset.add(this._transform?.pos ?? Vector.Zero);\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    const pos = this._transform?.pos ?? this.offset;\r\n    const distance = pos.distance(point);\r\n    if (distance <= this.radius) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Casts a ray at the Circle collider and returns the nearest point of collision\r\n   * @param ray\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    //https://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\r\n    const c = this.center;\r\n    const dir = ray.dir;\r\n    const orig = ray.pos;\r\n\r\n    const discriminant = Math.sqrt(Math.pow(dir.dot(orig.sub(c)), 2) - Math.pow(orig.sub(c).distance(), 2) + Math.pow(this.radius, 2));\r\n\r\n    if (discriminant < 0) {\r\n      // no intersection\r\n      return null;\r\n    } else {\r\n      let toi = 0;\r\n      if (discriminant === 0) {\r\n        toi = -dir.dot(orig.sub(c));\r\n        if (toi > 0 && toi < max) {\r\n          return ray.getPoint(toi);\r\n        }\r\n        return null;\r\n      } else {\r\n        const toi1 = -dir.dot(orig.sub(c)) + discriminant;\r\n        const toi2 = -dir.dot(orig.sub(c)) - discriminant;\r\n\r\n        const positiveToi: number[] = [];\r\n        if (toi1 >= 0) {\r\n          positiveToi.push(toi1);\r\n        }\r\n\r\n        if (toi2 >= 0) {\r\n          positiveToi.push(toi2);\r\n        }\r\n\r\n        const mintoi = Math.min(...positiveToi);\r\n        if (mintoi <= max) {\r\n          return ray.getPoint(mintoi);\r\n        }\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  public getClosestLineBetween(shape: Collider): Line {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleCircleClosestLine(this, shape);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(this, shape).flip();\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleCircle(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Circle could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    return this.center.add(direction.normalize().scale(this.radius));\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the shape in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const dir = direction.normalize();\r\n    return dir.scale(this.radius);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform as TransformComponent;\r\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\r\n    return new BoundingBox(\r\n      this.offset.x + bodyPos.x - this.radius,\r\n      this.offset.y + bodyPos.y - this.radius,\r\n      this.offset.x + bodyPos.x + this.radius,\r\n      this.offset.y + bodyPos.y + this.radius\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the circle collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return new BoundingBox(\r\n      this.offset.x - this.radius,\r\n      this.offset.y - this.radius,\r\n      this.offset.x + this.radius,\r\n      this.offset.y + this.radius\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get axis not implemented on circles, since there are infinite axis in a circle\r\n   */\r\n  public get axes(): Vector[] {\r\n    return [];\r\n  }\r\n\r\n  /**\r\n   * Returns the moment of inertia of a circle given it's mass\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    return (mass * this.radius * this.radius) / 2;\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n  }\r\n\r\n  /**\r\n   * Project the circle along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n    const point = this.center;\r\n    const dotProduct = point.dot(axis);\r\n    scalars.push(dotProduct);\r\n    scalars.push(dotProduct + this.radius);\r\n    scalars.push(dotProduct - this.radius);\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const newPos = pos.add(this.offset);\r\n    ctx.beginPath();\r\n    ctx.fillStyle = color.toString();\r\n    ctx.arc(newPos.x, newPos.y, this.radius, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const tx = this._transform as TransformComponent;\r\n    const pos = tx?.globalPos ? tx?.globalPos.add(this.offset) : this.offset;\r\n    ex.drawCircle(pos, this.radius, color);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Green) {\r\n    const transform = this._transform;\r\n    const pos = transform ? transform.pos.add(this.offset) : this.offset;\r\n    const rotation = transform ? transform.rotation : 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.arc(pos.x, pos.y, this.radius, 0, Math.PI * 2);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n    ctx.beginPath();\r\n    ctx.moveTo(pos.x, pos.y);\r\n    ctx.lineTo(Math.cos(rotation) * this.radius + pos.x, Math.sin(rotation) * this.radius + pos.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { Physics } from '../Physics';\nimport { Collider } from '../Colliders/Collider';\nimport { CollisionType } from '../CollisionType';\nimport { Pair } from './Pair';\nimport { SeparationInfo } from '../Colliders/SeparatingAxis';\nimport { BodyComponent } from '../BodyComponent';\n\n/**\n * Collision contacts are used internally by Excalibur to resolve collision between colliders. This\n * Pair prevents collisions from being evaluated more than one time\n */\nexport class CollisionContact {\n  private _canceled = false;\n\n  /**\n   * Currently the ids between colliders\n   */\n  readonly id: string;\n\n  /**\n   * The first collider in the collision\n   */\n  colliderA: Collider;\n\n  /**\n   * The second collider in the collision\n   */\n  colliderB: Collider;\n\n  /**\n   * The minimum translation vector to resolve overlap, pointing away from colliderA\n   */\n  mtv: Vector;\n\n  /**\n   * World space contact points between colliderA and colliderB\n   */\n  points: Vector[];\n\n  /**\n   * Local space contact points between colliderA and colliderB\n   */\n  localPoints: Vector[];\n\n  /**\n   * The collision normal, pointing away from colliderA\n   */\n  normal: Vector;\n\n  /**\n   * The collision tangent\n   */\n  tangent: Vector;\n\n  /**\n   * Information about the specifics of the collision contact separation\n   */\n  info: SeparationInfo;\n\n  constructor(\n    colliderA: Collider,\n    colliderB: Collider,\n    mtv: Vector,\n    normal: Vector,\n    tangent: Vector,\n    points: Vector[],\n    localPoints: Vector[],\n    info: SeparationInfo\n  ) {\n    this.colliderA = colliderA;\n    this.colliderB = colliderB;\n    this.mtv = mtv;\n    this.normal = normal;\n    this.tangent = tangent;\n    this.points = points;\n    this.localPoints = localPoints;\n    this.info = info;\n    this.id = Pair.calculatePairHash(colliderA.id, colliderB.id);\n  }\n\n  /**\n   * Match contact awake state, except if body's are Fixed\n   */\n  public matchAwake(): void {\n    const bodyA = this.colliderA.owner.get(BodyComponent);\n    const bodyB = this.colliderB.owner.get(BodyComponent);\n    if (bodyA && bodyB) {\n      if (bodyA.sleeping !== bodyB.sleeping) {\n        if (bodyA.sleeping && bodyA.collisionType !== CollisionType.Fixed && bodyB.sleepMotion >= Physics.wakeThreshold) {\n          bodyA.setSleeping(false);\n        }\n        if (bodyB.sleeping && bodyB.collisionType !== CollisionType.Fixed && bodyA.sleepMotion >= Physics.wakeThreshold) {\n          bodyB.setSleeping(false);\n        }\n      }\n    }\n  }\n\n  public isCanceled() {\n    return this._canceled;\n  }\n\n  public cancel(): void {\n    this._canceled = true;\n  }\n}\n","import { Line } from '../../Math/line';\nimport { Vector } from '../../Math/vector';\nimport { Collider } from './Collider';\nimport { CircleCollider } from './CircleCollider';\nimport { PolygonCollider } from './PolygonCollider';\n\n/**\n * Specific information about a contact and it's separation\n */\nexport interface SeparationInfo {\n  /**\n   * Collider A\n   */\n  collider: Collider;\n\n  /**\n   * Signed value (negative means overlap, positive no overlap)\n   */\n  separation: number;\n\n  /**\n   * Axis of separation from the collider's perpective\n   */\n  axis: Vector;\n\n  /**\n   * Side of separation (reference) from the collider's perpsective\n   */\n\n  side?: Line;\n\n  /**\n   * Local side of separation (reference) from the collider's perspective\n   */\n  localSide?: Line;\n\n  /**\n   * Index of the separation side (reference) from the collider's perspective\n   */\n  sideId?: number;\n\n  /**\n   * Point on collider B (incident point)\n   */\n  point: Vector;\n\n  /**\n   * Local point on collider B (incident point)\n   */\n  localPoint?: Vector;\n}\n\nexport class SeparatingAxis {\n  static findPolygonPolygonSeparation(polyA: PolygonCollider, polyB: PolygonCollider): SeparationInfo {\n    let bestSeparation = -Number.MAX_VALUE;\n    let bestSide: Line | null = null;\n    let bestAxis: Vector | null = null;\n    let bestSideIndex: number = -1;\n    let bestOtherPoint: Vector | null = null;\n    const sides = polyA.getSides();\n    const localSides = polyA.getLocalSides();\n    for (let i = 0; i < sides.length; i++) {\n      const side = sides[i];\n      const axis = side.normal();\n      const vertB = polyB.getFurthestPoint(axis.negate());\n      // Separation on side i's axis\n      // We are looking for the largest separation between poly A's sides\n      const vertSeparation = side.distanceToPoint(vertB, true);\n      if (vertSeparation > bestSeparation) {\n        bestSeparation = vertSeparation;\n        bestSide = side;\n        bestAxis = axis;\n        bestSideIndex = i;\n        bestOtherPoint = vertB;\n      }\n    }\n\n    return {\n      collider: polyA,\n      separation: bestAxis ? bestSeparation : 99,\n      axis: bestAxis as Vector,\n      side: bestSide,\n      localSide: localSides[bestSideIndex],\n      sideId: bestSideIndex,\n      point: bestOtherPoint as Vector,\n      localPoint: bestAxis ? polyB.getFurthestLocalPoint(bestAxis!.negate()) : null\n    };\n  }\n\n  static findCirclePolygonSeparation(circle: CircleCollider, polygon: PolygonCollider): Vector | null {\n    const axes = polygon.axes;\n    const pc = polygon.center;\n    // Special SAT with circles\n    const polyDir = pc.sub(circle.worldPos);\n    const closestPointOnPoly = polygon.getFurthestPoint(polyDir.negate());\n    axes.push(closestPointOnPoly.sub(circle.worldPos).normalize());\n\n    let minOverlap = Number.MAX_VALUE;\n    let minAxis = null;\n    let minIndex = -1;\n    for (let i = 0; i < axes.length; i++) {\n      const proj1 = polygon.project(axes[i]);\n      const proj2 = circle.project(axes[i]);\n      const overlap = proj1.getOverlap(proj2);\n      if (overlap <= 0) {\n        return null;\n      } else {\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          minAxis = axes[i];\n          minIndex = i;\n        }\n      }\n    }\n    if (minIndex < 0) {\n      return null;\n    }\n    return minAxis.normalize().scale(minOverlap);\n  }\n}\n","import { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { PolygonCollider } from './PolygonCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { SeparatingAxis, SeparationInfo } from './SeparatingAxis';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { TransformComponent } from '../../EntityComponentSystem';\r\nimport { Pair } from '../Detection/Pair';\r\n\r\nexport const CollisionJumpTable = {\r\n  CollideCircleCircle(circleA: CircleCollider, circleB: CircleCollider): CollisionContact[] {\r\n    const circleAPos = circleA.worldPos;\r\n    const circleBPos = circleB.worldPos;\r\n    const combinedRadius = circleA.radius + circleB.radius;\r\n    const distance = circleAPos.distance(circleBPos);\r\n\r\n    if (distance > combinedRadius) {\r\n      return [];\r\n    }\r\n\r\n    // negative means overlap\r\n    const separation = combinedRadius - distance;\r\n\r\n    // Normal points from A -> B\r\n    const normal = circleBPos.sub(circleAPos).normalize();\r\n    const tangent = normal.perpendicular();\r\n    const mvt = normal.scale(separation);\r\n\r\n    const point = circleA.getFurthestPoint(normal);\r\n    const local = circleA.getFurthestLocalPoint(normal);\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circleA,\r\n      separation,\r\n      axis: normal,\r\n      point: point\r\n    };\r\n\r\n    return [new CollisionContact(circleA, circleB, mvt, normal, tangent, [point], [local], info)];\r\n  },\r\n\r\n  CollideCirclePolygon(circle: CircleCollider, polygon: PolygonCollider): CollisionContact[] {\r\n    let minAxis = SeparatingAxis.findCirclePolygonSeparation(circle, polygon);\r\n    if (!minAxis) {\r\n      return [];\r\n    }\r\n\r\n    // make sure that the minAxis is pointing away from circle\r\n    const samedir = minAxis.dot(polygon.center.sub(circle.center));\r\n    minAxis = samedir < 0 ? minAxis.negate() : minAxis;\r\n\r\n    const point = circle.getFurthestPoint(minAxis);\r\n    const xf = circle.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const local = xf.applyInverse(point);\r\n    const normal = minAxis.normalize();\r\n\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: -minAxis.size,\r\n      axis: normal,\r\n      point: point,\r\n      localPoint: local,\r\n      side: polygon.findSide(normal.negate()),\r\n      localSide: polygon.findLocalSide(normal.negate())\r\n    };\r\n\r\n    return [new CollisionContact(circle, polygon, minAxis, normal, normal.perpendicular(), [point], [local], info)];\r\n  },\r\n\r\n  CollideCircleEdge(circle: CircleCollider, edge: EdgeCollider): CollisionContact[] {\r\n    // TODO not sure this actually abides by local/world collisions\r\n    // Are edge.begin and edge.end local space or world space? I think they should be local\r\n\r\n    // center of the circle in world pos\r\n    const cc = circle.center;\r\n    // vector in the direction of the edge\r\n    const edgeWorld = edge.asLine();\r\n    const e = edgeWorld.end.sub(edgeWorld.begin);\r\n\r\n    // amount of overlap with the circle's center along the edge direction\r\n    const u = e.dot(edgeWorld.end.sub(cc));\r\n    const v = e.dot(cc.sub(edgeWorld.begin));\r\n    const side = edge.asLine();\r\n    const localSide = edge.asLocalLine();\r\n\r\n    // Potential region A collision (circle is on the left side of the edge, before the beginning)\r\n    if (v <= 0) {\r\n      const da = edgeWorld.begin.sub(cc);\r\n      const dda = da.dot(da); // quick and dirty way of calc'n distance in r^2 terms saves some sqrts\r\n      // save some sqrts\r\n      if (dda > circle.radius * circle.radius) {\r\n        return []; // no collision\r\n      }\r\n\r\n      const normal = da.normalize();\r\n      const separation = circle.radius - Math.sqrt(dda);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.begin,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.begin], [localSide.begin], info)\r\n      ];\r\n    }\r\n\r\n    // Potential region B collision (circle is on the right side of the edge, after the end)\r\n    if (u <= 0) {\r\n      const db = edgeWorld.end.sub(cc);\r\n      const ddb = db.dot(db);\r\n      if (ddb > circle.radius * circle.radius) {\r\n        return [];\r\n      }\r\n\r\n      const normal = db.normalize();\r\n      const separation = circle.radius - Math.sqrt(ddb);\r\n\r\n      const info: SeparationInfo = {\r\n        collider: circle,\r\n        separation: separation,\r\n        axis: normal,\r\n        point: side.end,\r\n        side: side,\r\n        localSide: localSide\r\n      };\r\n\r\n      return [\r\n        new CollisionContact(circle, edge, normal.scale(separation), normal, normal.perpendicular(), [side.end], [localSide.end], info)\r\n      ];\r\n    }\r\n\r\n    // Otherwise potential region AB collision (circle is in the middle of the edge between the beginning and end)\r\n    const den = e.dot(e);\r\n    const pointOnEdge = edgeWorld.begin\r\n      .scale(u)\r\n      .add(edgeWorld.end.scale(v))\r\n      .scale(1 / den);\r\n    const d = cc.sub(pointOnEdge);\r\n\r\n    const dd = d.dot(d);\r\n    if (dd > circle.radius * circle.radius) {\r\n      return []; // no collision\r\n    }\r\n\r\n    let normal = e.perpendicular();\r\n    // flip correct direction\r\n    if (normal.dot(cc.sub(edgeWorld.begin)) < 0) {\r\n      normal.x = -normal.x;\r\n      normal.y = -normal.y;\r\n    }\r\n\r\n    normal = normal.normalize();\r\n    const separation = circle.radius - Math.sqrt(dd);\r\n\r\n    const mvt = normal.scale(separation);\r\n    const info: SeparationInfo = {\r\n      collider: circle,\r\n      separation: separation,\r\n      axis: normal,\r\n      point: pointOnEdge,\r\n      side: side,\r\n      localSide: localSide\r\n    };\r\n\r\n    return [\r\n      new CollisionContact(\r\n        circle,\r\n        edge,\r\n        mvt,\r\n        normal.negate(),\r\n        normal.negate().perpendicular(),\r\n        [pointOnEdge],\r\n        [pointOnEdge.sub(edge.worldPos)],\r\n        info\r\n      )\r\n    ];\r\n  },\r\n\r\n  CollideEdgeEdge(): CollisionContact[] {\r\n    // Edge-edge collision doesn't make sense\r\n    return [];\r\n  },\r\n\r\n  CollidePolygonEdge(polygon: PolygonCollider, edge: EdgeCollider): CollisionContact[] {\r\n    const pc = polygon.center;\r\n    const ec = edge.center;\r\n    const dir = ec.sub(pc).normalize();\r\n\r\n    // build a temporary polygon from the edge to use SAT\r\n    const linePoly = new PolygonCollider({\r\n      points: [edge.begin, edge.end, edge.end.add(dir.scale(100)), edge.begin.add(dir.scale(100))],\r\n      offset: edge.offset\r\n    });\r\n    linePoly.owner = edge.owner;\r\n    const tx = edge.owner?.get(TransformComponent);\r\n    if (tx) {\r\n      linePoly.update(edge.owner.get(TransformComponent));\r\n    }\r\n    // Gross hack but poly-poly works well\r\n    const contact = this.CollidePolygonPolygon(polygon, linePoly);\r\n    if (contact.length) {\r\n      // Fudge the contact back to edge\r\n      contact[0].colliderB = edge;\r\n      (contact[0].id as any) = Pair.calculatePairHash(polygon.id, edge.id);\r\n      // contact[0].info.collider\r\n    }\r\n    return contact;\r\n  },\r\n\r\n  CollidePolygonPolygon(polyA: PolygonCollider, polyB: PolygonCollider): CollisionContact[] {\r\n    // Multi contact from SAT\r\n    // https://gamedev.stackexchange.com/questions/111390/multiple-contacts-for-sat-collision-detection\r\n    // do a SAT test to find a min axis if it exists\r\n    const separationA = SeparatingAxis.findPolygonPolygonSeparation(polyA, polyB);\r\n    // If there is no overlap from boxA's perspective we can end early\r\n    if (separationA.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    const separationB = SeparatingAxis.findPolygonPolygonSeparation(polyB, polyA);\r\n    // If there is no overlap from boxB's perspective exit now\r\n    if (separationB.separation > 0) {\r\n      return [];\r\n    }\r\n\r\n    // Separations are both negative, we want to pick the least negative (minimal movement)\r\n    const separation = separationA.separation > separationB.separation ? separationA : separationB;\r\n\r\n    // The incident side is the most opposite from the axes of collision on the other collider\r\n    const other = separation.collider === polyA ? polyB : polyA;\r\n    const incident = other.findSide(separation.axis.negate()) as Line;\r\n\r\n    // Clip incident side by the perpendicular lines at each end of the reference side\r\n    // https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm\r\n    const reference = separation.side;\r\n    const refDir = reference.dir().normalize();\r\n\r\n    // Find our contact points by clipping the incident by the collision side\r\n    const clipRight = incident.clip(refDir.negate(), -refDir.dot(reference.begin));\r\n    let clipLeft: Line | null = null;\r\n    if (clipRight) {\r\n      clipLeft = clipRight.clip(refDir, refDir.dot(reference.end));\r\n    }\r\n\r\n    // If there is no left there is no collision\r\n    if (clipLeft) {\r\n      // We only want clip points below the reference edge, discard the others\r\n      const points = clipLeft.getPoints().filter((p) => {\r\n        return reference.below(p);\r\n      });\r\n\r\n      let normal = separation.axis;\r\n      let tangent = normal.perpendicular();\r\n      // Point Contact A -> B\r\n      if (polyB.worldPos.sub(polyA.worldPos).dot(normal) < 0) {\r\n        normal = normal.negate();\r\n        tangent = normal.perpendicular();\r\n      }\r\n      // Points are clipped from incident which is the other collider\r\n      // Store those as locals\r\n      let localPoints: Vector[] = [];\r\n      if (separation.collider === polyA) {\r\n        const xf = polyB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      } else {\r\n        const xf = polyA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n        localPoints = points.map((p) => xf.applyInverse(p));\r\n      }\r\n      return [new CollisionContact(polyA, polyB, normal.scale(-separation.separation), normal, tangent, points, localPoints, separation)];\r\n    }\r\n    return [];\r\n  },\r\n\r\n  FindContactSeparation(contact: CollisionContact, localPoint: Vector) {\r\n    const shapeA = contact.colliderA;\r\n    const txA = contact.colliderA.owner?.get(TransformComponent) ?? new TransformComponent();\r\n    const shapeB = contact.colliderB;\r\n    const txB = contact.colliderB.owner?.get(TransformComponent) ?? new TransformComponent();\r\n\r\n    // both are circles\r\n    if (shapeA instanceof CircleCollider && shapeB instanceof CircleCollider) {\r\n      const combinedRadius = shapeA.radius + shapeB.radius;\r\n      const distance = txA.pos.distance(txB.pos);\r\n      const separation = combinedRadius - distance;\r\n      return -separation;\r\n    }\r\n\r\n    // both are polygons\r\n    if (shapeA instanceof PolygonCollider && shapeB instanceof PolygonCollider) {\r\n      if (contact.info.localSide) {\r\n        let side: Line;\r\n        let worldPoint: Vector;\r\n        if (contact.info.collider === shapeA) {\r\n          side = new Line(txA.apply(contact.info.localSide.begin), txA.apply(contact.info.localSide.end));\r\n          worldPoint = txB.apply(localPoint);\r\n        } else {\r\n          side = new Line(txB.apply(contact.info.localSide.begin), txB.apply(contact.info.localSide.end));\r\n          worldPoint = txA.apply(localPoint);\r\n        }\r\n\r\n        return side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v circle\r\n    if (\r\n      (shapeA instanceof PolygonCollider && shapeB instanceof CircleCollider) ||\r\n      (shapeB instanceof PolygonCollider && shapeA instanceof CircleCollider)\r\n    ) {\r\n      const worldPoint = txA.apply(localPoint);\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // polygon v edge\r\n    if (\r\n      (shapeA instanceof EdgeCollider && shapeB instanceof PolygonCollider) ||\r\n      (shapeB instanceof EdgeCollider && shapeA instanceof PolygonCollider)\r\n    ) {\r\n      let worldPoint: Vector;\r\n      if (contact.info.collider === shapeA) {\r\n        worldPoint = txB.apply(localPoint);\r\n      } else {\r\n        worldPoint = txA.apply(localPoint);\r\n      }\r\n      if (contact.info.side) {\r\n        return contact.info.side.distanceToPoint(worldPoint, true);\r\n      }\r\n    }\r\n\r\n    // circle v edge\r\n    if (\r\n      (shapeA instanceof CircleCollider && shapeB instanceof EdgeCollider) ||\r\n      (shapeB instanceof CircleCollider && shapeA instanceof EdgeCollider)\r\n    ) {\r\n      // Local point is always on the edge which is always shapeB\r\n      const worldPoint = txB.apply(localPoint);\r\n\r\n      let circlePoint: Vector;\r\n      if (shapeA instanceof CircleCollider) {\r\n        circlePoint = shapeA.getFurthestPoint(contact.normal);\r\n      }\r\n\r\n      const dist = worldPoint.distance(circlePoint);\r\n\r\n      if (contact.info.side) {\r\n        return dist > 0 ? -dist : 0;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n};\r\n","import { BoundingBox } from '../BoundingBox';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { PolygonCollider } from './PolygonCollider';\r\n\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { Color } from '../../Color';\r\nimport { Collider } from './Collider';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { ExcaliburGraphicsContext } from '../../Graphics/Context/ExcaliburGraphicsContext';\r\n\r\nexport interface EdgeColliderOptions {\r\n  /**\r\n   * The beginning of the edge defined in local coordinates to the collider\r\n   */\r\n  begin: Vector;\r\n  /**\r\n   * The ending of the edge defined in local coordinates to the collider\r\n   */\r\n  end: Vector;\r\n  /**\r\n   * Optionall specify an offset\r\n   */\r\n  offset?: Vector;\r\n}\r\n\r\n/**\r\n * Edge is a single line collider to create collisions with a single line.\r\n */\r\nexport class EdgeCollider extends Collider {\r\n  offset: Vector;\r\n  begin: Vector;\r\n  end: Vector;\r\n\r\n  private _transform: Transform;\r\n\r\n  constructor(options: EdgeColliderOptions) {\r\n    super();\r\n    this.begin = options.begin || Vector.Zero;\r\n    this.end = options.end || Vector.Zero;\r\n    this.offset = options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this Edge, not associated with any collider\r\n   */\r\n  public clone(): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: this.begin.clone(),\r\n      end: this.end.clone()\r\n    });\r\n  }\r\n\r\n  public get worldPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    return tx?.globalPos.add(this.offset) ?? this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collision area in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    const pos = this.begin.average(this.end).add(this._getBodyPos());\r\n    return pos;\r\n  }\r\n\r\n  private _getBodyPos(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const bodyPos = tx?.globalPos ?? Vector.Zero;\r\n    return bodyPos;\r\n  }\r\n\r\n  private _getTransformedBegin(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const angle = tx ? tx.globalRotation : 0;\r\n    return this.begin.rotate(angle).add(this._getBodyPos());\r\n  }\r\n\r\n  private _getTransformedEnd(): Vector {\r\n    const tx = this._transform as TransformComponent;\r\n    const angle = tx ? tx.globalRotation : 0;\r\n    return this.end.rotate(angle).add(this._getBodyPos());\r\n  }\r\n\r\n  /**\r\n   * Returns the slope of the line in the form of a vector\r\n   */\r\n  public getSlope(): Vector {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return end.sub(begin).scale(1 / distance);\r\n  }\r\n\r\n  /**\r\n   * Returns the length of the line segment in pixels\r\n   */\r\n  public getLength(): number {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    const distance = begin.distance(end);\r\n    return distance;\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collision area\r\n   */\r\n  public contains(): boolean {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity): Vector {\r\n    const numerator = this._getTransformedBegin().sub(ray.pos);\r\n\r\n    // Test is line and ray are parallel and non intersecting\r\n    if (ray.dir.cross(this.getSlope()) === 0 && numerator.cross(ray.dir) !== 0) {\r\n      return null;\r\n    }\r\n\r\n    // Lines are parallel\r\n    const divisor = ray.dir.cross(this.getSlope());\r\n    if (divisor === 0) {\r\n      return null;\r\n    }\r\n\r\n    const t = numerator.cross(this.getSlope()) / divisor;\r\n\r\n    if (t >= 0 && t <= max) {\r\n      const u = numerator.cross(ray.dir) / divisor / this.getLength();\r\n      if (u >= 0 && u <= 1) {\r\n        return ray.getPoint(t);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the closes line between this and another collider, from this -> collider\r\n   * @param shape\r\n   */\r\n  public getClosestLineBetween(shape: Collider): Line {\r\n    if (shape instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.CircleEdgeClosestLine(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(shape, this).flip();\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.EdgeEdgeClosestLine(this, shape);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public collide(shape: Collider): CollisionContact[] {\r\n    if (shape instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCircleEdge(shape, this);\r\n    } else if (shape instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(shape, this);\r\n    } else if (shape instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollideEdgeEdge();\r\n    } else {\r\n      throw new Error(`Edge could not collide with unknown CollisionShape ${typeof shape}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    if (direction.dot(transformedBegin) > 0) {\r\n      return transformedBegin;\r\n    } else {\r\n      return transformedEnd;\r\n    }\r\n  }\r\n\r\n  private _boundsFromBeginEnd(begin: Vector, end: Vector, padding = 10) {\r\n    // A perfectly vertical or horizontal edge would have a bounds 0 width or height\r\n    // this causes problems for the collision system so we give them some padding\r\n    return new BoundingBox(\r\n      Math.min(begin.x, end.x) - padding,\r\n      Math.min(begin.y, end.y) - padding,\r\n      Math.max(begin.x, end.x) + padding,\r\n      Math.max(begin.y, end.y) + padding\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in world space\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const transformedBegin = this._getTransformedBegin();\r\n    const transformedEnd = this._getTransformedEnd();\r\n    return this._boundsFromBeginEnd(transformedBegin, transformedEnd);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the edge collider in local space\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return this._boundsFromBeginEnd(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Returns this edge represented as a line in world coordinates\r\n   */\r\n  public asLine(): Line {\r\n    return new Line(this._getTransformedBegin(), this._getTransformedEnd());\r\n  }\r\n\r\n  /**\r\n   * Return this edge as a line in local line coordinates (relative to the position)\r\n   */\r\n  public asLocalLine(): Line {\r\n    return new Line(this.begin, this.end);\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the edge\r\n   */\r\n  public get axes(): Vector[] {\r\n    const e = this._getTransformedEnd().sub(this._getTransformedBegin());\r\n    const edgeNormal = e.normal();\r\n\r\n    const axes = [];\r\n    axes.push(edgeNormal);\r\n    axes.push(edgeNormal.negate());\r\n    axes.push(edgeNormal.normal());\r\n    axes.push(edgeNormal.normal().negate());\r\n    return axes;\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an edge\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    const length = this.end.sub(this.begin).distance() / 2;\r\n    return mass * length * length;\r\n  }\r\n\r\n  /**\r\n   * @inheritdoc\r\n   */\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n  }\r\n\r\n  /**\r\n   * Project the edge along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const scalars = [];\r\n\r\n    const points = [this._getTransformedBegin(), this._getTransformedEnd()];\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      scalars.push(points[i].dot(axis));\r\n    }\r\n\r\n    return new Projection(Math.min.apply(Math, scalars), Math.max.apply(Math, scalars));\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const begin = this.begin.add(pos);\r\n    const end = this.end.add(pos);\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.beginPath();\r\n    ctx.moveTo(begin.x, begin.y);\r\n    ctx.lineTo(end.x, end.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ex.drawLine(begin, end, color, 2);\r\n    ex.drawCircle(begin, 2, color);\r\n    ex.drawCircle(end, 2, color);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\r\n    const begin = this._getTransformedBegin();\r\n    const end = this._getTransformedEnd();\r\n    ctx.strokeStyle = color.toString();\r\n    ctx.beginPath();\r\n    ctx.moveTo(begin.x, begin.y);\r\n    ctx.lineTo(end.x, end.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { Color } from '../../Color';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { CollisionJumpTable } from './CollisionJumpTable';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { Projection } from '../../Math/projection';\r\nimport { Line } from '../../Math/line';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Ray } from '../../Math/ray';\r\nimport { ClosestLineJumpTable } from './ClosestLineJumpTable';\r\nimport { Transform, TransformComponent } from '../../EntityComponentSystem';\r\nimport { Collider } from './Collider';\r\nimport { ExcaliburGraphicsContext } from '../..';\r\n\r\nexport interface PolygonColliderOptions {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  offset?: Vector;\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  points: Vector[];\r\n  /**\r\n   * Whether points are specified in clockwise or counter clockwise order, default counter-clockwise\r\n   */\r\n  clockwiseWinding?: boolean;\r\n}\r\n\r\n/**\r\n * Polygon collider for detecting collisions\r\n */\r\nexport class PolygonCollider extends Collider {\r\n  /**\r\n   * Pixel offset relative to a collider's body transform position.\r\n   */\r\n  public offset: Vector;\r\n\r\n  /**\r\n   * Points in the polygon in order around the perimeter in local coordinates. These are relative from the body transform position.\r\n   */\r\n  public points: Vector[];\r\n\r\n  private _transform: Transform;\r\n\r\n  private _transformedPoints: Vector[] = [];\r\n  private _axes: Vector[] = [];\r\n  private _sides: Line[] = [];\r\n  private _localSides: Line[] = [];\r\n\r\n  constructor(options: PolygonColliderOptions) {\r\n    super();\r\n    this.offset = options.offset ?? Vector.Zero;\r\n    const winding = !!options.clockwiseWinding;\r\n    this.points = (winding ? options.points.reverse() : options.points) || [];\r\n\r\n    // calculate initial transformation\r\n    this._calculateTransformation();\r\n  }\r\n\r\n  /**\r\n   * Returns a clone of this ConvexPolygon, not associated with any collider\r\n   */\r\n  public clone(): PolygonCollider {\r\n    return new PolygonCollider({\r\n      offset: this.offset.clone(),\r\n      points: this.points.map((p) => p.clone())\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the world position of the collider, which is the current body transform plus any defined offset\r\n   */\r\n  public get worldPos(): Vector {\r\n    if (this._transform) {\r\n      return this._transform.pos.add(this.offset);\r\n    }\r\n    return this.offset;\r\n  }\r\n\r\n  /**\r\n   * Get the center of the collider in world coordinates\r\n   */\r\n  public get center(): Vector {\r\n    return this.bounds.center;\r\n  }\r\n\r\n  /**\r\n   * Calculates the underlying transformation from the body relative space to world space\r\n   */\r\n  private _calculateTransformation() {\r\n    const transform = this._transform as TransformComponent;\r\n\r\n    const pos = transform ? transform.globalPos.add(this.offset) : this.offset;\r\n    const angle = transform ? transform.globalRotation : 0;\r\n    const scale = transform ? transform.globalScale : Vector.One;\r\n\r\n    const len = this.points.length;\r\n    this._transformedPoints.length = 0; // clear out old transform\r\n    for (let i = 0; i < len; i++) {\r\n      this._transformedPoints[i] = this.points[i].scale(scale).rotate(angle).add(pos);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the points that make up the polygon in world space, from actor relative space (if specified)\r\n   */\r\n  public getTransformedPoints(): Vector[] {\r\n    this._calculateTransformation();\r\n    return this._transformedPoints;\r\n  }\r\n\r\n  /**\r\n   * Gets the sides of the polygon in world space\r\n   */\r\n  public getSides(): Line[] {\r\n    if (this._sides.length) {\r\n      return this._sides;\r\n    }\r\n    const lines = [];\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      // This winding is important\r\n      lines.push(new Line(points[i], points[(i + 1) % len]));\r\n    }\r\n    this._sides = lines;\r\n    return this._sides;\r\n  }\r\n\r\n  /**\r\n   * Returns the local coordinate space sides\r\n   */\r\n  public getLocalSides(): Line[] {\r\n    if (this._localSides.length) {\r\n      return this._localSides;\r\n    }\r\n    const lines = [];\r\n    const points = this.points;\r\n    const len = points.length;\r\n    for (let i = 0; i < len; i++) {\r\n      // This winding is important\r\n      lines.push(new Line(points[i], points[(i + 1) % len]));\r\n    }\r\n    this._localSides = lines;\r\n    return this._localSides;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the world space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findSide(direction: Vector): Line {\r\n    const sides = this.getSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Given a direction vector find the local space side that is most in that direction\r\n   * @param direction\r\n   */\r\n  public findLocalSide(direction: Vector): Line {\r\n    const sides = this.getLocalSides();\r\n    let bestSide = sides[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let side = 0; side < sides.length; side++) {\r\n      const currentSide = sides[side];\r\n      const sideNormal = currentSide.normal();\r\n      const mostDirection = sideNormal.dot(direction);\r\n      if (mostDirection > maxDistance) {\r\n        bestSide = currentSide;\r\n        maxDistance = mostDirection;\r\n      }\r\n    }\r\n    return bestSide;\r\n  }\r\n\r\n  /**\r\n   * Get the axis associated with the convex polygon\r\n   */\r\n  public get axes(): Vector[] {\r\n    if (this._axes.length) {\r\n      return this._axes;\r\n    }\r\n    const axes = this.getSides().map((s) => s.normal());\r\n    this._axes = axes;\r\n    return this._axes;\r\n  }\r\n\r\n  public update(transform: Transform): void {\r\n    this._transform = transform;\r\n    this._sides.length = 0;\r\n    this._localSides.length = 0;\r\n    this._axes.length = 0;\r\n    this._transformedPoints.length = 0;\r\n    this.getTransformedPoints();\r\n    this.getSides();\r\n    this.getLocalSides();\r\n  }\r\n\r\n  /**\r\n   * Tests if a point is contained in this collider in world space\r\n   */\r\n  public contains(point: Vector): boolean {\r\n    // Always cast to the right, as long as we cast in a consistent fixed direction we\r\n    // will be fine\r\n    const testRay = new Ray(point, new Vector(1, 0));\r\n    const intersectCount = this.getSides().reduce(function (accum, side) {\r\n      if (testRay.intersect(side) >= 0) {\r\n        return accum + 1;\r\n      }\r\n      return accum;\r\n    }, 0);\r\n\r\n    if (intersectCount % 2 === 0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public getClosestLineBetween(collider: Collider): Line {\r\n    if (collider instanceof CircleCollider) {\r\n      return ClosestLineJumpTable.PolygonCircleClosestLine(this, collider);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return ClosestLineJumpTable.PolygonPolygonClosestLine(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return ClosestLineJumpTable.PolygonEdgeClosestLine(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a collision contact if the 2 colliders collide, otherwise collide will\r\n   * return null.\r\n   * @param collider\r\n   */\r\n  public collide(collider: Collider): CollisionContact[] {\r\n    if (collider instanceof CircleCollider) {\r\n      return CollisionJumpTable.CollideCirclePolygon(collider, this);\r\n    } else if (collider instanceof PolygonCollider) {\r\n      return CollisionJumpTable.CollidePolygonPolygon(this, collider);\r\n    } else if (collider instanceof EdgeCollider) {\r\n      return CollisionJumpTable.CollidePolygonEdge(this, collider);\r\n    } else {\r\n      throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof collider}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the point on the collider furthest in the direction specified\r\n   */\r\n  public getFurthestPoint(direction: Vector): Vector {\r\n    const pts = this.getTransformedPoints();\r\n    let furthestPoint = null;\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Find the local point on the collider furthest in the direction specified\r\n   * @param direction\r\n   */\r\n  public getFurthestLocalPoint(direction: Vector): Vector {\r\n    const pts = this.points;\r\n    let furthestPoint = pts[0];\r\n    let maxDistance = -Number.MAX_VALUE;\r\n    for (let i = 0; i < pts.length; i++) {\r\n      const distance = direction.dot(pts[i]);\r\n      if (distance > maxDistance) {\r\n        maxDistance = distance;\r\n        furthestPoint = pts[i];\r\n      }\r\n    }\r\n    return furthestPoint;\r\n  }\r\n\r\n  /**\r\n   * Finds the closes face to the point using perpendicular distance\r\n   * @param point point to test against polygon\r\n   */\r\n  public getClosestFace(point: Vector): { distance: Vector; face: Line } {\r\n    const sides = this.getSides();\r\n    let min = Number.POSITIVE_INFINITY;\r\n    let faceIndex = -1;\r\n    let distance = -1;\r\n    for (let i = 0; i < sides.length; i++) {\r\n      const dist = sides[i].distanceToPoint(point);\r\n      if (dist < min) {\r\n        min = dist;\r\n        faceIndex = i;\r\n        distance = dist;\r\n      }\r\n    }\r\n\r\n    if (faceIndex !== -1) {\r\n      return {\r\n        distance: sides[faceIndex].normal().scale(distance),\r\n        face: sides[faceIndex]\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in world coordinates\r\n   */\r\n  public get bounds(): BoundingBox {\r\n    const tx = this._transform as TransformComponent;\r\n    const scale = tx?.globalScale ?? Vector.One;\r\n    const rotation = tx?.globalRotation ?? 0;\r\n    const pos = (tx?.globalPos ?? Vector.Zero).add(this.offset);\r\n    return this.localBounds.scale(scale).rotate(rotation).translate(pos);\r\n  }\r\n\r\n  /**\r\n   * Get the axis aligned bounding box for the polygon collider in local coordinates\r\n   */\r\n  public get localBounds(): BoundingBox {\r\n    return BoundingBox.fromPoints(this.points);\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia for an arbitrary polygon\r\n   * https://en.wikipedia.org/wiki/List_of_moments_of_inertia\r\n   */\r\n  public getInertia(mass: number): number {\r\n    let numerator = 0;\r\n    let denominator = 0;\r\n    for (let i = 0; i < this.points.length; i++) {\r\n      const iplusone = (i + 1) % this.points.length;\r\n      const crossTerm = this.points[iplusone].cross(this.points[i]);\r\n      numerator +=\r\n        crossTerm *\r\n        (this.points[i].dot(this.points[i]) + this.points[i].dot(this.points[iplusone]) + this.points[iplusone].dot(this.points[iplusone]));\r\n      denominator += crossTerm;\r\n    }\r\n    return (mass / 6) * (numerator / denominator);\r\n  }\r\n\r\n  /**\r\n   * Casts a ray into the polygon and returns a vector representing the point of contact (in world space) or null if no collision.\r\n   */\r\n  public rayCast(ray: Ray, max: number = Infinity) {\r\n    // find the minimum contact time greater than 0\r\n    // contact times less than 0 are behind the ray and we don't want those\r\n    const sides = this.getSides();\r\n    const len = sides.length;\r\n    let minContactTime = Number.MAX_VALUE;\r\n    let contactIndex = -1;\r\n    for (let i = 0; i < len; i++) {\r\n      const contactTime = ray.intersect(sides[i]);\r\n      if (contactTime >= 0 && contactTime < minContactTime && contactTime <= max) {\r\n        minContactTime = contactTime;\r\n        contactIndex = i;\r\n      }\r\n    }\r\n\r\n    // contact was found\r\n    if (contactIndex >= 0) {\r\n      return ray.getPoint(minContactTime);\r\n    }\r\n\r\n    // no contact found\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Project the edges of the polygon along a specified axis\r\n   */\r\n  public project(axis: Vector): Projection {\r\n    const points = this.getTransformedPoints();\r\n    const len = points.length;\r\n    let min = Number.MAX_VALUE;\r\n    let max = -Number.MAX_VALUE;\r\n    for (let i = 0; i < len; i++) {\r\n      const scalar = points[i].dot(axis);\r\n      min = Math.min(min, scalar);\r\n      max = Math.max(max, scalar);\r\n    }\r\n\r\n    return new Projection(min, max);\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D, color: Color = Color.Green, pos: Vector = Vector.Zero) {\r\n    const effectiveOffset = pos.add(this.offset);\r\n    ctx.beginPath();\r\n    ctx.fillStyle = color.toString();\r\n\r\n    const firstPoint = this.points[0].add(effectiveOffset);\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n\r\n    // Points are relative\r\n    this.points\r\n      .map((p) => p.add(effectiveOffset))\r\n      .forEach(function (point) {\r\n        ctx.lineTo(point.x, point.y);\r\n      });\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n  }\r\n  public debug(ex: ExcaliburGraphicsContext, color: Color) {\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    const points = [firstPoint, ...this.getTransformedPoints(), firstPoint];\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n      ex.drawLine(points[i], points[i + 1], color, 2);\r\n      ex.drawCircle(points[i], 2, color);\r\n      ex.drawCircle(points[i + 1], 2, color);\r\n    }\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D, color: Color = Color.Red) {\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = color.toString();\r\n    // Iterate through the supplied points and construct a 'polygon'\r\n    const firstPoint = this.getTransformedPoints()[0];\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n    this.getTransformedPoints().forEach(function (point) {\r\n      ctx.lineTo(point.x, point.y);\r\n    });\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n  }\r\n}\r\n","import { PolygonCollider } from './PolygonCollider';\r\nimport { CircleCollider } from './CircleCollider';\r\nimport { EdgeCollider } from './EdgeCollider';\r\nimport { BoundingBox } from '../BoundingBox';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { CompositeCollider } from './CompositeCollider';\r\nimport { Logger } from '../..';\r\n\r\n/**\r\n * Excalibur helper for defining colliders quickly\r\n */\r\nexport class Shape {\r\n  /**\r\n   * Creates a box collider, under the hood defines a [[PolygonCollider]] collider\r\n   * @param width Width of the box\r\n   * @param height Height of the box\r\n   * @param anchor Anchor of the box (default (.5, .5)) which positions the box relative to the center of the collider's position\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Box(width: number, height: number, anchor: Vector = Vector.Half, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: new BoundingBox(-width * anchor.x, -height * anchor.y, width - width * anchor.x, height - height * anchor.y).getPoints(),\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[PolygonCollider|arbitrary polygon]] collider\r\n   *\r\n   * PolygonColliders are useful for creating convex polygon shapes\r\n   * @param points Points specified in counter clockwise\r\n   * @param clockwiseWinding Optionally changed the winding of points, by default false meaning counter-clockwise winding.\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Polygon(points: Vector[], clockwiseWinding: boolean = false, offset: Vector = Vector.Zero): PolygonCollider {\r\n    return new PolygonCollider({\r\n      points: points,\r\n      offset: offset,\r\n      clockwiseWinding: clockwiseWinding\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[CircleCollider|circle]] collider\r\n   *\r\n   * Circle colliders are useful for balls, or to make collisions more forgiving on sharp edges\r\n   * @param radius Radius of the circle collider\r\n   * @param offset Optional offset relative to the collider in local coordinates\r\n   */\r\n  static Circle(radius: number, offset: Vector = Vector.Zero): CircleCollider {\r\n    return new CircleCollider({\r\n      radius: radius,\r\n      offset: offset\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new [[EdgeCollider|edge]] collider\r\n   *\r\n   * Edge colliders are useful for  floors, walls, and other barriers\r\n   * @param begin Beginning of the edge in local coordinates to the collider\r\n   * @param end Ending of the edge in local coordinates to the collider\r\n   */\r\n  static Edge(begin: Vector, end: Vector): EdgeCollider {\r\n    return new EdgeCollider({\r\n      begin: begin,\r\n      end: end\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates a new capsule shaped [[CompositeCollider]] using 2 circles and a box\r\n   *\r\n   * Capsule colliders are useful for platformers with incline or jagged floors to have a smooth\r\n   * player experience.\r\n   *\r\n   * @param width\r\n   * @param height\r\n   * @param offset Optional offset\r\n   */\r\n  static Capsule(width: number, height: number, offset = Vector.Zero): CompositeCollider {\r\n    const logger = Logger.getInstance();\r\n    if (width === height) {\r\n      logger.warn('A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider');\r\n    }\r\n\r\n    const vertical = height >= width;\r\n\r\n    if (vertical) {\r\n      // height > width, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(width / 2, vec(0, -height / 2 + width / 2).add(offset)),\r\n        Shape.Box(width, height - width, Vector.Half, offset),\r\n        Shape.Circle(width / 2, vec(0, height / 2 - width / 2).add(offset))\r\n      ]);\r\n      return capsule;\r\n    } else {\r\n      // width > height, if equal maybe use a circle\r\n      const capsule = new CompositeCollider([\r\n        Shape.Circle(height / 2, vec(-width / 2 + height / 2, 0).add(offset)),\r\n        Shape.Box(width - height, height, Vector.Half, offset),\r\n        Shape.Circle(height / 2, vec(width / 2 - height / 2, 0).add(offset))\r\n      ]);\r\n      return capsule;\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { TransformComponent } from '../EntityComponentSystem';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { CollisionEndEvent, CollisionStartEvent, PostCollisionEvent, PreCollisionEvent } from '../Events';\r\nimport { Observable } from '../Util/Observable';\r\nimport { BoundingBox } from './BoundingBox';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { CircleCollider } from './Colliders/CircleCollider';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { PolygonCollider } from './Colliders/PolygonCollider';\r\nimport { EdgeCollider } from './Colliders/EdgeCollider';\r\nimport { Shape } from './Colliders/Shape';\r\n\r\nexport class ColliderComponent extends Component<'ex.collider'> {\r\n  public readonly type = 'ex.collider';\r\n\r\n  public events = new EventDispatcher(this);\r\n  /**\r\n   * Observable that notifies when a collider is added to the body\r\n   */\r\n  public $colliderAdded = new Observable<Collider>();\r\n\r\n  /**\r\n   * Observable that notifies when a collider is removed from the body\r\n   */\r\n  public $colliderRemoved = new Observable<Collider>();\r\n\r\n  constructor(collider?: Collider) {\r\n    super();\r\n    this.set(collider);\r\n  }\r\n\r\n  private _collider: Collider;\r\n  /**\r\n   * Get the current collider geometry\r\n   * @returns\r\n   */\r\n  public get() {\r\n    return this._collider;\r\n  }\r\n\r\n  /**\r\n   * Set the collider geometry\r\n   * @param collider\r\n   * @returns the collider you set\r\n   */\r\n  public set<T extends Collider>(collider: T): T {\r\n    this.clear();\r\n    if (collider) {\r\n      this._collider = collider;\r\n      this._collider.owner = this.owner;\r\n      this.events.wire(collider.events);\r\n      this.$colliderAdded.notifyAll(collider);\r\n      this.update();\r\n    }\r\n    return collider;\r\n  }\r\n\r\n  /**\r\n   * Remove collider geometry from collider component\r\n   */\r\n  public clear() {\r\n    if (this._collider) {\r\n      this.events.unwire(this._collider.events);\r\n      this.$colliderRemoved.notifyAll(this._collider);\r\n      this._collider.owner = null;\r\n      this._collider = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return world space bounds\r\n   */\r\n  public get bounds() {\r\n    return this._collider?.bounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Return local space bounds\r\n   */\r\n  public get localBounds() {\r\n    return this._collider?.localBounds ?? new BoundingBox();\r\n  }\r\n\r\n  /**\r\n   * Update the collider's transformed geometry\r\n   */\r\n  public update() {\r\n    const tx = this.owner?.get(TransformComponent);\r\n    if (this._collider) {\r\n      this._collider.owner = this.owner;\r\n      if (tx) {\r\n        this._collider.update(tx);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collide component with another\r\n   * @param other\r\n   * @returns\r\n   */\r\n  collide(other: ColliderComponent): CollisionContact[] {\r\n    let colliderA = this._collider;\r\n    let colliderB = other._collider;\r\n    if (!colliderA || !colliderB) {\r\n      return [];\r\n    }\r\n\r\n    // If we have a composite lefthand side :(\r\n    // Might bite us, but to avoid updating all the handlers make composite always left side\r\n    let flipped = false;\r\n    if (colliderB instanceof CompositeCollider) {\r\n      colliderA = colliderB;\r\n      colliderB = this._collider;\r\n      flipped = true;\r\n    }\r\n\r\n    if (this._collider) {\r\n      const contacts = colliderA.collide(colliderB);\r\n      if (contacts) {\r\n        if (flipped) {\r\n          contacts.forEach((contact) => {\r\n            contact.mtv = contact.mtv.negate();\r\n            contact.normal = contact.normal.negate();\r\n            contact.tangent = contact.normal.perpendicular();\r\n            contact.colliderA = this._collider;\r\n            contact.colliderB = other._collider;\r\n          });\r\n        }\r\n        return contacts;\r\n      }\r\n      return [];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  onAdd(entity: Entity) {\r\n    if (this._collider) {\r\n      this.update();\r\n    }\r\n    // Wire up the collider events to the owning entity\r\n    this.events.on('precollision', (evt: any) => {\r\n      const precollision = evt as PreCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(precollision.target.owner, precollision.other.owner, precollision.side, precollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('postcollision', (evt: any) => {\r\n      const postcollision = evt as PostCollisionEvent<Collider>;\r\n      entity.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(postcollision.target.owner, postcollision.other.owner, postcollision.side, postcollision.intersection)\r\n      );\r\n    });\r\n    this.events.on('collisionstart', (evt: any) => {\r\n      const start = evt as CollisionStartEvent<Collider>;\r\n      entity.events.emit('collisionstart', new CollisionStartEvent(start.target.owner, start.other.owner, start.contact));\r\n    });\r\n    this.events.on('collisionend', (evt: any) => {\r\n      const end = evt as CollisionEndEvent<Collider>;\r\n      entity.events.emit('collisionend', new CollisionEndEvent(end.target.owner, end.other.owner));\r\n    });\r\n  }\r\n\r\n  onRemove() {\r\n    this.events.clear();\r\n    this.$colliderRemoved.notifyAll(this._collider);\r\n  }\r\n\r\n  /**\r\n   * Sets up a box geometry based on the current bounds of the associated actor of this physics body.\r\n   *\r\n   * If no width/height are specified the body will attempt to use the associated actor's width/height.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useBoxCollider(width: number, height: number, anchor: Vector = Vector.Half, center: Vector = Vector.Zero): PolygonCollider {\r\n    const collider = Shape.Box(width, height, anchor, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[PolygonCollider|polygon]] collision geometry based on a list of of points relative\r\n   *  to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * Only [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon) definitions are supported.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  usePolygonCollider(points: Vector[], center: Vector = Vector.Zero): PolygonCollider {\r\n    const poly = Shape.Polygon(points, false, center);\r\n    return (this.set(poly));\r\n  }\r\n\r\n  /**\r\n   * Sets up a [[Circle|circle collision geometry]] as the only collider with a specified radius in pixels.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useCircleCollider(radius: number, center: Vector = Vector.Zero): CircleCollider {\r\n    const collider = Shape.Circle(radius, center);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Sets up an [[Edge|edge collision geometry]] with a start point and an end point relative to the anchor of the associated actor\r\n   * of this physics body.\r\n   *\r\n   * By default, the box is center is at (0, 0) which means it is centered around the actors anchor.\r\n   */\r\n  useEdgeCollider(begin: Vector, end: Vector): EdgeCollider {\r\n    const collider = Shape.Edge(begin, end);\r\n    return (this.set(collider));\r\n  }\r\n\r\n  /**\r\n   * Setups up a [[CompositeCollider]] which can define any arbitrary set of excalibur colliders\r\n   * @param colliders\r\n   * @returns\r\n   */\r\n  useCompositeCollider(colliders: Collider[]): CompositeCollider {\r\n    return (this.set(new CompositeCollider(colliders)));\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\r\nimport { CollisionType } from './CollisionType';\r\nimport { Physics } from './Physics';\r\nimport { Clonable } from '../Interfaces/Clonable';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { CollisionGroup } from './Group/CollisionGroup';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { createId, Id } from '../Id';\r\nimport { clamp } from '../Util/Util';\r\nimport { ColliderComponent } from './ColliderComponent';\r\n\r\nexport interface BodyComponentOptions {\r\n  type?: CollisionType;\r\n  group?: CollisionGroup;\r\n  useGravity?: boolean;\r\n}\r\n\r\nexport enum DegreeOfFreedom {\r\n  Rotation = 'rotation',\r\n  X = 'x',\r\n  Y = 'y'\r\n}\r\n\r\n/**\r\n * Body describes all the physical properties pos, vel, acc, rotation, angular velocity for the purpose of\r\n * of physics simulation.\r\n */\r\nexport class BodyComponent extends Component<'ex.body'> implements Clonable<BodyComponent> {\r\n  public readonly type = 'ex.body';\r\n  public dependencies = [TransformComponent, MotionComponent];\r\n  public static _ID = 0;\r\n  public readonly id: Id<'body'> = createId('body', BodyComponent._ID++);\r\n  public events = new EventDispatcher(this);\r\n\r\n  constructor(options?: BodyComponentOptions) {\r\n    super();\r\n    if (options) {\r\n      this.collisionType = options.type ?? this.collisionType;\r\n      this.group = options.group ?? this.group;\r\n      this.useGravity = options.useGravity ?? this.useGravity;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collision type for the rigidbody physics simulation, by default [[CollisionType.PreventCollision]]\r\n   */\r\n  public collisionType: CollisionType = CollisionType.PreventCollision;\r\n\r\n  /**\r\n   * The collision group for the body's colliders, by default body colliders collide with everything\r\n   */\r\n  public group: CollisionGroup = CollisionGroup.All;\r\n\r\n  /**\r\n   * The amount of mass the body has\r\n   */\r\n  public mass: number = Physics.defaultMass;\r\n\r\n  /**\r\n   * The inverse mass (1/mass) of the body. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseMass(): number {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.mass;\r\n  }\r\n\r\n  /**\r\n   * Amount of \"motion\" the body has before sleeping. If below [[Physics.sleepEpsilon]] it goes to \"sleep\"\r\n   */\r\n  public sleepMotion: number = Physics.sleepEpsilon * 5;\r\n\r\n  /**\r\n   * Can this body sleep, by default bodies do not sleep\r\n   */\r\n  public canSleep: boolean = Physics.bodiesCanSleepByDefault;\r\n\r\n  private _sleeping = false;\r\n  /**\r\n   * Whether this body is sleeping or not\r\n   */\r\n  public get sleeping(): boolean {\r\n    return this._sleeping;\r\n  }\r\n\r\n  /**\r\n   * Set the sleep state of the body\r\n   * @param sleeping\r\n   */\r\n  public setSleeping(sleeping: boolean) {\r\n    this._sleeping = sleeping;\r\n    if (!sleeping) {\r\n      // Give it a kick to keep it from falling asleep immediately\r\n      this.sleepMotion = Physics.sleepEpsilon * 5;\r\n    } else {\r\n      this.vel = Vector.Zero;\r\n      this.acc = Vector.Zero;\r\n      this.angularVelocity = 0;\r\n      this.sleepMotion = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update body's [[BodyComponent.sleepMotion]] for the purpose of sleeping\r\n   */\r\n  public updateMotion() {\r\n    if (this._sleeping) {\r\n      this.setSleeping(true);\r\n    }\r\n    const currentMotion = this.vel.size * this.vel.size + Math.abs(this.angularVelocity * this.angularVelocity);\r\n    const bias = Physics.sleepBias;\r\n    this.sleepMotion = bias * this.sleepMotion + (1 - bias) * currentMotion;\r\n    this.sleepMotion = clamp(this.sleepMotion, 0, 10 * Physics.sleepEpsilon);\r\n    if (this.canSleep && this.sleepMotion < Physics.sleepEpsilon) {\r\n      this.setSleeping(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the moment of inertia from the [[ColliderComponent]]\r\n   */\r\n  public get inertia() {\r\n    // Inertia is a property of the geometry, so this is a little goofy but seems to be okay?\r\n    const collider = this.owner.get(ColliderComponent);\r\n    if (collider?.get()) {\r\n      return collider.get().getInertia(this.mass);\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Get the inverse moment of inertial from the [[ColliderComponent]]. If [[CollisionType.Fixed]] this is 0, meaning \"infinite\" mass\r\n   */\r\n  public get inverseInertia() {\r\n    return this.collisionType === CollisionType.Fixed ? 0 : 1 / this.inertia;\r\n  }\r\n\r\n  /**\r\n   * The also known as coefficient of restitution of this actor, represents the amount of energy preserved after collision or the\r\n   * bounciness. If 1, it is 100% bouncy, 0 it completely absorbs.\r\n   */\r\n  public bounciness: number = 0.2;\r\n\r\n  /**\r\n   * The coefficient of friction on this actor\r\n   */\r\n  public friction: number = 0.99;\r\n\r\n  /**\r\n   * Should use global gravity [[Physics.gravity]] in it's physics simulation, default is true\r\n   */\r\n  public useGravity: boolean = true;\r\n\r\n  /**\r\n   * Degrees of freedom to limit\r\n   */\r\n  public limitDegreeOfFreedom: DegreeOfFreedom[] = [];\r\n\r\n  /**\r\n   * Returns if the owner is active\r\n   */\r\n  public get active() {\r\n    return !!this.owner?.active;\r\n  }\r\n\r\n  public get center() {\r\n    return this.pos;\r\n  }\r\n\r\n  public get transform(): TransformComponent {\r\n    return this.owner?.get(TransformComponent);\r\n  }\r\n\r\n  public get motion(): MotionComponent {\r\n    return this.owner?.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * The (x, y) position of the actor this will be in the middle of the actor if the\r\n   * [[Actor.anchor]] is set to (0.5, 0.5) which is default.\r\n   * If you want the (x, y) position to be the top left of the actor specify an anchor of (0, 0).\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.globalPos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this.transform.globalPos = val;\r\n  }\r\n\r\n  /**\r\n   * The position of the actor last frame (x, y) in pixels\r\n   */\r\n  public oldPos: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current velocity vector (vx, vy) of the actor in pixels/second\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this.motion.vel = val;\r\n  }\r\n\r\n  /**\r\n   * The velocity of the actor last frame (vx, vy) in pixels/second\r\n   */\r\n  public oldVel: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * The current acceleration vector (ax, ay) of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may\r\n   * be useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  public set acc(val: Vector) {\r\n    this.motion.acc = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public oldAcc: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * The current torque applied to the actor\r\n   */\r\n  public get torque(): number {\r\n    return this.motion.torque;\r\n  }\r\n\r\n  public set torque(val: number) {\r\n    this.motion.torque = val;\r\n  }\r\n\r\n  /**\r\n   * Gets/sets the rotation of the body from the last frame.\r\n   */\r\n  public oldRotation: number = 0; // radians\r\n\r\n  /**\r\n   * The rotation of the body in radians\r\n   */\r\n  public get rotation() {\r\n    return this.transform.globalRotation;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    this.transform.globalRotation = val;\r\n  }\r\n\r\n  /**\r\n   * The scale vector of the actor\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0, Use ex.Transform.scale\r\n   */\r\n  public get scale(): Vector {\r\n    return this.transform.globalScale;\r\n  }\r\n\r\n  public set scale(val: Vector) {\r\n    this.transform.globalScale = val;\r\n  }\r\n\r\n  /**\r\n   * The scale of the actor last frame\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public oldScale: Vector = Vector.One;\r\n\r\n  /**\r\n   * The x scalar velocity of the actor in scale/second\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public get sx(): number {\r\n    return this.motion.scaleFactor.x;\r\n  }\r\n\r\n  public set sx(xFactor: number) {\r\n    this.motion.scaleFactor.x = xFactor;\r\n  }\r\n\r\n  /**\r\n   * The y scalar velocity of the actor in scale/second\r\n   * @deprecated ex.Body.scale will be removed in v0.25.0\r\n   */\r\n  public get sy(): number {\r\n    return this.motion.scaleFactor.y;\r\n  }\r\n\r\n  public set sy(yFactor: number) {\r\n    this.motion.scaleFactor.y = yFactor;\r\n  }\r\n\r\n  /**\r\n   * The rotational velocity of the actor in radians/second\r\n   * @deprecated\r\n   */\r\n  public get rx(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * The rotational velocity of the actor in radians/second\r\n   * @deprecated\r\n   */\r\n  public set rx(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Get the angular velocity in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Set the angular velocity in radians/second\r\n   */\r\n  public set angularVelocity(value: number) {\r\n    this.motion.angularVelocity = value;\r\n  }\r\n\r\n  /**\r\n   * Apply a specific impulse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel.addEqual(finalImpulse);\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.pos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply only linear impulse to the body\r\n   * @param impulse\r\n   */\r\n  public applyLinearImpulse(impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    const finalImpulse = impulse.scale(this.inverseMass);\r\n\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.X)) {\r\n      finalImpulse.x = 0;\r\n    }\r\n    if (this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Y)) {\r\n      finalImpulse.y = 0;\r\n    }\r\n\r\n    this.vel = this.vel.add(finalImpulse);\r\n  }\r\n\r\n  /**\r\n   * Apply only angular impuse to the body\r\n   * @param point\r\n   * @param impulse\r\n   */\r\n  public applyAngularImpulse(point: Vector, impulse: Vector) {\r\n    if (this.collisionType !== CollisionType.Active) {\r\n      return; // only active objects participate in the simulation\r\n    }\r\n\r\n    if (!this.limitDegreeOfFreedom.includes(DegreeOfFreedom.Rotation)) {\r\n      const distanceFromCenter = point.sub(this.pos);\r\n      this.angularVelocity += this.inverseInertia * distanceFromCenter.cross(impulse);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the old versions of pos, vel, acc, and scale.\r\n   */\r\n  public captureOldTransform() {\r\n    // Capture old values before integration step updates them\r\n    this.oldVel.setTo(this.vel.x, this.vel.y);\r\n    this.oldPos.setTo(this.pos.x, this.pos.y);\r\n    this.oldAcc.setTo(this.acc.x, this.acc.y);\r\n    this.oldScale.setTo(this.scale.x, this.scale.y);\r\n    this.oldRotation = this.rotation;\r\n  }\r\n\r\n  debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { Color } from '../Color';\n\n/**\n * @deprecated Will be removed in 0.26.0\n */\nexport class CullingBox {\n  private _topLeft: Vector = new Vector(0, 0);\n  private _topRight: Vector = new Vector(0, 0);\n  private _bottomLeft: Vector = new Vector(0, 0);\n  private _bottomRight: Vector = new Vector(0, 0);\n\n  private _xCoords: Array<number>;\n  private _yCoords: Array<number>;\n  private _xMin: number;\n  private _yMin: number;\n  private _xMax: number;\n  private _yMax: number;\n\n  private _xMinWorld: number;\n  private _yMinWorld: number;\n  private _xMaxWorld: number;\n  private _yMaxWorld: number;\n\n  public isSpriteOffScreen(actor: Actor, engine: Engine): boolean {\n    const drawingWidth = actor.currentDrawing.drawWidth;\n    const drawingHeight = actor.currentDrawing.drawHeight;\n    const rotation = actor.rotation;\n    const anchor = actor.center;\n    const worldPos = actor.getGlobalPos();\n\n    this._topLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topLeft = this._topLeft.rotate(rotation, anchor);\n\n    this._topRight = vec(worldPos.x + drawingWidth / 2, worldPos.y - drawingHeight / 2);\n    this._topRight = this._topRight.rotate(rotation, anchor);\n\n    this._bottomLeft = vec(worldPos.x - drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomLeft = this._bottomLeft.rotate(rotation, anchor);\n\n    this._bottomRight = vec(worldPos.x + drawingWidth / 2, worldPos.y + drawingHeight / 2);\n    this._bottomRight = this._bottomRight.rotate(rotation, anchor);\n\n    const topLeftScreen = engine.worldToScreenCoordinates(this._topLeft);\n    const topRightScreen = engine.worldToScreenCoordinates(this._topRight);\n    const bottomLeftScreen = engine.worldToScreenCoordinates(this._bottomLeft);\n    const bottomRightScreen = engine.worldToScreenCoordinates(this._bottomRight);\n    this._xCoords = [];\n    this._yCoords = [];\n\n    this._xCoords.push(topLeftScreen.x, topRightScreen.x, bottomLeftScreen.x, bottomRightScreen.x);\n    this._yCoords.push(topLeftScreen.y, topRightScreen.y, bottomLeftScreen.y, bottomRightScreen.y);\n\n    this._xMin = Math.min.apply(null, this._xCoords);\n    this._yMin = Math.min.apply(null, this._yCoords);\n    this._xMax = Math.max.apply(null, this._xCoords);\n    this._yMax = Math.max.apply(null, this._yCoords);\n\n    const minWorld = engine.screenToWorldCoordinates(new Vector(this._xMin, this._yMin));\n    const maxWorld = engine.screenToWorldCoordinates(new Vector(this._xMax, this._yMax));\n    this._xMinWorld = minWorld.x;\n    this._yMinWorld = minWorld.y;\n    this._xMaxWorld = maxWorld.x;\n    this._yMaxWorld = maxWorld.y;\n\n    const boundingPoints = [\n      new Vector(this._xMin, this._yMin), // top left\n      new Vector(this._xMax, this._yMin), // top right\n      new Vector(this._xMin, this._yMax), // bottom left\n      new Vector(this._xMax, this._yMax) // bottom right\n    ];\n\n    // sprite can be wider than canvas screen (and still visible within canvas)\n    // top or bottom of sprite must be within canvas\n    if (\n      boundingPoints[0].x < 0 &&\n      boundingPoints[1].x > engine.canvas.clientWidth &&\n      (boundingPoints[0].y > 0 || boundingPoints[2].y < engine.canvas.clientHeight)\n    ) {\n      return false;\n    }\n\n    // sprite can be taller than canvas screen (and still visible within canvas)\n    // left or right of sprite must be within canvas\n    if (\n      boundingPoints[0].y < 0 &&\n      boundingPoints[2].y > engine.canvas.clientHeight &&\n      (boundingPoints[1].x > 0 || boundingPoints[0].x < engine.canvas.clientWidth)\n    ) {\n      return false;\n    }\n\n    // otherwise if any corner is visible, we're not offscreen\n    for (let i = 0; i < boundingPoints.length; i++) {\n      if (\n        boundingPoints[i].x > 0 &&\n        boundingPoints[i].y > 0 &&\n        boundingPoints[i].x < engine.canvas.clientWidth &&\n        boundingPoints[i].y < engine.canvas.clientHeight\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    // bounding rectangle\n    ctx.beginPath();\n    ctx.strokeStyle = Color.White.toString();\n    ctx.rect(this._xMinWorld, this._yMinWorld, this._xMaxWorld - this._xMinWorld, this._yMaxWorld - this._yMinWorld);\n    ctx.stroke();\n\n    ctx.fillStyle = Color.Red.toString();\n    ctx.beginPath();\n    ctx.arc(this._topLeft.x, this._topLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Green.toString();\n    ctx.beginPath();\n    ctx.arc(this._topRight.x, this._topRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Blue.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomLeft.x, this._bottomLeft.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = Color.Magenta.toString();\n    ctx.beginPath();\n    ctx.arc(this._bottomRight.x, this._bottomRight.y, 5, 0, Math.PI * 2);\n    ctx.closePath();\n    ctx.fill();\n  }\n}\n","import { CullingBox } from './../Util/CullingBox';\nimport { Trait } from '../Interfaces/Trait';\nimport { Actor } from '../Actor';\nimport { Engine } from '../Engine';\nimport { ExitViewPortEvent, EnterViewPortEvent } from '../Events';\nimport { TagComponent } from '../EntityComponentSystem';\n\n/**\n * @deprecated will be removed in 0.26.0\n */\nexport class OffscreenCulling implements Trait {\n  public cullingBox: CullingBox = new CullingBox();\n\n  public update(actor: Actor, engine: Engine) {\n    const events = actor.eventDispatcher;\n\n    let isSpriteOffScreen = true;\n    if (actor.currentDrawing != null) {\n      isSpriteOffScreen = this.cullingBox.isSpriteOffScreen(actor, engine);\n    }\n\n    let actorBoundsOffscreen = false;\n    if (engine && engine.currentScene && engine.currentScene.camera && engine.currentScene.camera.viewport && !actor.parent) {\n      actorBoundsOffscreen = !engine.currentScene.camera.viewport.intersect(actor.collider.bounds);\n    }\n\n    if (!actor.isOffScreen) {\n      if (actorBoundsOffscreen && isSpriteOffScreen) {\n        events.emit('exitviewport', new ExitViewPortEvent(actor));\n        actor.addComponent(new TagComponent('offscreen'));\n      }\n    } else {\n      if (!actorBoundsOffscreen || !isSpriteOffScreen) {\n        events.emit('enterviewport', new EnterViewPortEvent(actor));\n        actor.removeComponent('offscreen');\n      }\n    }\n  }\n}\n","import { Trait } from '../Interfaces/Trait';\r\nimport { Actor } from '../Actor';\r\nimport { Engine } from '../Engine';\r\n\r\n/**\r\n * Revises pointer events path accordingly to the actor\r\n * @deprecated Will be removed in 0.26.0\r\n */\r\nexport class CapturePointer implements Trait {\r\n  public update(actor: Actor, engine: Engine) {\r\n    if (!actor.enableCapturePointer) {\r\n      return;\r\n    }\r\n    if (actor.isKilled()) {\r\n      return;\r\n    }\r\n\r\n    engine.input.pointers.checkAndUpdateActorUnderPointer(actor);\r\n  }\r\n}\r\n","import { Component, ComponentCtor, TagComponent } from './Component';\r\n\r\nimport { Observable, Message } from '../Util/Observable';\r\nimport { Class } from '../Class';\r\nimport { OnInitialize, OnPreUpdate, OnPostUpdate } from '../Interfaces/LifecycleEvents';\r\nimport { Engine } from '../Engine';\r\nimport { InitializeEvent, PreUpdateEvent, PostUpdateEvent } from '../Events';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { Util } from '..';\r\n\r\n/**\r\n * Interface holding an entity component pair\r\n */\r\nexport interface EntityComponent {\r\n  component: Component;\r\n  entity: Entity;\r\n}\r\n\r\n/**\r\n * AddedComponent message\r\n */\r\nexport class AddedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Added' = 'Component Added';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is f an Added Component\r\n */\r\nexport function isAddedComponent(x: Message<EntityComponent>): x is AddedComponent {\r\n  return !!x && x.type === 'Component Added';\r\n}\r\n\r\n/**\r\n * RemovedComponent message\r\n */\r\nexport class RemovedComponent implements Message<EntityComponent> {\r\n  readonly type: 'Component Removed' = 'Component Removed';\r\n  constructor(public data: EntityComponent) {}\r\n}\r\n\r\n/**\r\n * Type guard to know if message is for a Removed Component\r\n */\r\nexport function isRemovedComponent(x: Message<EntityComponent>): x is RemovedComponent {\r\n  return !!x && x.type === 'Component Removed';\r\n}\r\n\r\n/**\r\n * An Entity is the base type of anything that can have behavior in Excalibur, they are part of the built in entity component system\r\n *\r\n * Entities can be strongly typed with the components they contain\r\n *\r\n * ```typescript\r\n * const entity = new Entity<ComponentA | ComponentB>();\r\n * entity.components.a; // Type ComponentA\r\n * entity.components.b; // Type ComponentB\r\n * ```\r\n */\r\nexport class Entity extends Class implements OnInitialize, OnPreUpdate, OnPostUpdate {\r\n  private static _ID = 0;\r\n\r\n  constructor(components?: Component[], name?: string) {\r\n    super();\r\n    this._setName(name);\r\n    if (components) {\r\n      for (const component of components) {\r\n        this.addComponent(component);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The unique identifier for the entity\r\n   */\r\n  public id: number = Entity._ID++;\r\n\r\n  private _name: string = 'anonymous';\r\n  protected _setName(name: string) {\r\n    if (name) {\r\n      this._name = name;\r\n    }\r\n  }\r\n  public get name(): string {\r\n    return this._name;\r\n  }\r\n\r\n  public get events(): EventDispatcher {\r\n    return this.eventDispatcher;\r\n  }\r\n\r\n  /**\r\n   * Whether this entity is active, if set to false it will be reclaimed\r\n   */\r\n  public active: boolean = true;\r\n\r\n  /**\r\n   * Kill the entity, means it will no longer be updated. Kills are deferred to the end of the update.\r\n   */\r\n  public kill() {\r\n    this.active = false;\r\n  }\r\n\r\n  public isKilled() {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Specifically get the tags on the entity from [[TagComponent]]\r\n   */\r\n  public get tags(): readonly string[] {\r\n    return this._tagsMemo;\r\n  }\r\n\r\n  /**\r\n   * Check if a tag exists on the entity\r\n   * @param tag name to check for\r\n   */\r\n  public hasTag(tag: string): boolean {\r\n    return this.tags.includes(tag);\r\n  }\r\n\r\n  /**\r\n   * Adds a tag to an entity\r\n   * @param tag\r\n   * @returns Entity\r\n   */\r\n  public addTag(tag: string) {\r\n    return this.addComponent(new TagComponent(tag));\r\n  }\r\n\r\n  /**\r\n   * Removes a tag on the entity\r\n   *\r\n   * Removals are deferred until the end of update\r\n   * @param tag\r\n   * @param force Remove component immediately, no deferred\r\n   */\r\n  public removeTag(tag: string, force = false) {\r\n    return this.removeComponent(tag, force);\r\n  }\r\n\r\n  /**\r\n   * The types of the components on the Entity\r\n   */\r\n  public get types(): string[] {\r\n    return this._typesMemo;\r\n  }\r\n\r\n  /**\r\n   * Bucket to hold on to deferred removals\r\n   */\r\n  private _componentsToRemove: (Component | string)[] = [];\r\n  private _componentTypeToInstance = new Map<ComponentCtor, Component>();\r\n  private _componentStringToInstance = new Map<string, Component>();\r\n\r\n  private _tagsMemo: string[] = [];\r\n  private _typesMemo: string[] = [];\r\n  private _rebuildMemos() {\r\n    this._tagsMemo = Array.from(this._componentStringToInstance.values())\r\n      .filter((c) => c instanceof TagComponent)\r\n      .map((c) => c.type);\r\n    this._typesMemo = Array.from(this._componentStringToInstance.keys());\r\n  }\r\n\r\n  public getComponents(): Component[] {\r\n    return Array.from(this._componentStringToInstance.values());\r\n  }\r\n\r\n  /**\r\n   * Observable that keeps track of component add or remove changes on the entity\r\n   */\r\n  public componentAdded$ = new Observable<AddedComponent>();\r\n  private _notifyAddComponent(component: Component) {\r\n    this._rebuildMemos();\r\n    const added = new AddedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentAdded$.notifyAll(added);\r\n  }\r\n\r\n  public componentRemoved$ = new Observable<RemovedComponent>();\r\n  private _notifyRemoveComponent(component: Component) {\r\n    const removed = new RemovedComponent({\r\n      component,\r\n      entity: this\r\n    });\r\n    this.componentRemoved$.notifyAll(removed);\r\n    this._rebuildMemos();\r\n  }\r\n\r\n  private _parent: Entity = null;\r\n  public get parent(): Entity {\r\n    return this._parent;\r\n  }\r\n\r\n  public childrenAdded$ = new Observable<Entity>();\r\n  public childrenRemoved$ = new Observable<Entity>();\r\n\r\n  private _children: Entity[] = [];\r\n  /**\r\n   * Get the direct children of this entity\r\n   */\r\n  public get children(): readonly Entity[] {\r\n    return this._children;\r\n  }\r\n\r\n  /**\r\n   * Unparents this entity, if there is a parent. Otherwise it does nothing.\r\n   */\r\n  public unparent() {\r\n    if (this._parent) {\r\n      this._parent.removeChild(this);\r\n      this._parent = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be a child of this entity\r\n   * @param entity\r\n   */\r\n  public addChild(entity: Entity): Entity {\r\n    if (entity.parent === null) {\r\n      if (this.getAncestors().includes(entity)) {\r\n        throw new Error('Cycle detected, cannot add entity');\r\n      }\r\n      this._children.push(entity);\r\n      entity._parent = this;\r\n      this.childrenAdded$.notifyAll(entity);\r\n    } else {\r\n      throw new Error('Entity already has a parent, cannot add without unparenting');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from children if it exists\r\n   * @param entity\r\n   */\r\n  public removeChild(entity: Entity): Entity {\r\n    if (entity.parent === this) {\r\n      Util.removeItemFromArray(entity, this._children);\r\n      entity._parent = null;\r\n      this.childrenRemoved$.notifyAll(entity);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes all children from this entity\r\n   */\r\n  public removeAllChildren(): Entity {\r\n    this.children.forEach((c) => {\r\n      this.removeChild(c);\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a list of parent entities starting with the topmost parent. Includes the current entity.\r\n   */\r\n  public getAncestors(): Entity[] {\r\n    const result: Entity[] = [this];\r\n    let current = this.parent;\r\n    while (current) {\r\n      result.push(current);\r\n      current = current.parent;\r\n    }\r\n    return result.reverse();\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all the entities that descend from this entity. Includes the current entity.\r\n   */\r\n  public getDescendants(): Entity[] {\r\n    let result: Entity[] = [this];\r\n    let queue: Entity[] = [this];\r\n    while (queue.length > 0) {\r\n      const curr = queue.pop();\r\n      queue = queue.concat(curr.children);\r\n      result = result.concat(curr.children);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Creates a deep copy of the entity and a copy of all its components\r\n   */\r\n  public clone(): Entity {\r\n    const newEntity = new Entity();\r\n    for (const c of this.types) {\r\n      newEntity.addComponent(this.get(c).clone());\r\n    }\r\n    for (const child of this.children) {\r\n      newEntity.addChild(child.clone());\r\n    }\r\n    return newEntity;\r\n  }\r\n\r\n  /**\r\n   * Adds a copy of all the components from another template entity as a \"prefab\"\r\n   * @param templateEntity Entity to use as a template\r\n   * @param force Force component replacement if it aleady exists on the target entity\r\n   */\r\n  public addTemplate(templateEntity: Entity, force: boolean = false): Entity {\r\n    for (const c of templateEntity.getComponents()) {\r\n      this.addComponent(c.clone(), force);\r\n    }\r\n    for (const child of templateEntity.children) {\r\n      this.addChild(child.clone().addTemplate(child));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a component to the entity\r\n   * @param component Component or Entity to add copy of components from\r\n   * @param force Optionally overwrite any existing components of the same type\r\n   */\r\n  public addComponent<T extends Component>(component: T, force: boolean = false): Entity {\r\n    // if component already exists, skip if not forced\r\n    if (this.has(component.type)) {\r\n      if (force) {\r\n        // Remove existing component type if exists when forced\r\n        this.removeComponent(component);\r\n      } else {\r\n        // early exit component exiss\r\n        return this;\r\n      }\r\n    }\r\n\r\n    // TODO circular dependencies will be a problem\r\n    if (component.dependencies && component.dependencies.length) {\r\n      for (const ctor of component.dependencies) {\r\n        this.addComponent(new ctor());\r\n      }\r\n    }\r\n\r\n    component.owner = this;\r\n    const constuctorType = component.constructor as ComponentCtor<T>;\r\n    this._componentTypeToInstance.set(constuctorType, component);\r\n    this._componentStringToInstance.set(component.type, component);\r\n    if (component.onAdd) {\r\n      component.onAdd(this);\r\n    }\r\n    this._notifyAddComponent(component);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Removes a component from the entity, by default removals are deferred to the end of entity update to avoid consistency issues\r\n   *\r\n   * Components can be force removed with the `force` flag, the removal is not deferred and happens immediately\r\n   * @param componentOrType\r\n   * @param force\r\n   */\r\n  public removeComponent<ComponentOrType extends string | Component>(componentOrType: ComponentOrType, force = false): Entity {\r\n    if (force) {\r\n      if (typeof componentOrType === 'string') {\r\n        this._removeComponentByType(componentOrType);\r\n      } else if (componentOrType instanceof Component) {\r\n        this._removeComponentByType(componentOrType.type);\r\n      }\r\n    } else {\r\n      this._componentsToRemove.push(componentOrType);\r\n    }\r\n\r\n    return this as any;\r\n  }\r\n\r\n  private _removeComponentByType(type: string) {\r\n    if (this.has(type)) {\r\n      const component = this.get(type);\r\n      component.owner = null;\r\n      if (component.onRemove) {\r\n        component.onRemove(this);\r\n      }\r\n      const ctor = component.constructor as ComponentCtor;\r\n      this._componentTypeToInstance.delete(ctor);\r\n      this._componentStringToInstance.delete(component.type);\r\n      this._notifyRemoveComponent(component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @hidden\r\n   * @internal\r\n   */\r\n  public processComponentRemoval() {\r\n    for (const componentOrType of this._componentsToRemove) {\r\n      const type = typeof componentOrType === 'string' ? componentOrType : componentOrType.type;\r\n      this._removeComponentByType(type);\r\n    }\r\n    this._componentsToRemove.length = 0;\r\n  }\r\n\r\n  /**\r\n   * Check if a component type exists\r\n   * @param type\r\n   */\r\n  public has<T extends Component>(type: ComponentCtor<T>): boolean;\r\n  public has(type: string): boolean;\r\n  public has<T extends Component>(type: ComponentCtor<T> | string): boolean {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.has(type);\r\n    } else {\r\n      return this._componentTypeToInstance.has(type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a component by type with typecheck\r\n   *\r\n   * (Does not work on tag components, use .hasTag(\"mytag\") instead)\r\n   * @param type\r\n   */\r\n  public get<T extends Component>(type: ComponentCtor<T>): T | null;\r\n  public get<T extends Component>(type: string): T | null;\r\n  public get<T extends Component>(type: ComponentCtor<T> | string): T | null {\r\n    if (typeof type === 'string') {\r\n      return this._componentStringToInstance.get(type) as T;\r\n    } else {\r\n      return this._componentTypeToInstance.get(type) as T;\r\n    }\r\n  }\r\n\r\n  private _isInitialized = false;\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * Initializes this entity, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overriden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the entity. This method is meant to be\r\n   * overridden.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an entity is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an entity is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   *\r\n   * Entity update lifecycle, called internally\r\n   *\r\n   * @internal\r\n   * @param engine\r\n   * @param delta\r\n   */\r\n  public update(engine: Engine, delta: number): void {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n    for (const child of this.children) {\r\n      child.update(engine, delta);\r\n    }\r\n    this._postupdate(engine, delta);\r\n  }\r\n}\r\n","import { Component } from '../EntityComponentSystem';\r\n\r\n/**\r\n * Shim to draw to the canvas when in LegacyDrawing mode\r\n * @deprecated\r\n */\r\nexport class CanvasDrawComponent extends Component<'ex.canvas'> {\r\n  public readonly type = 'ex.canvas';\r\n\r\n  constructor(public draw?: (ctx: CanvasRenderingContext2D, delta: number) => void) {\r\n    super();\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    this.draw = this.draw ?? (() => {});\r\n  }\r\n}\r\n","import { Vector, vec } from '../Math/vector';\r\nimport { Graphic } from './Graphic';\r\nimport { HasTick } from './Animation';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Logger } from '../Util/Log';\r\nimport { BoundingBox } from '../Collision/Index';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\n\r\n/**\r\n * Type guard for checking if a Graphic HasTick (used for graphics that change over time like animations)\r\n * @param graphic\r\n */\r\nexport function hasGraphicsTick(graphic: Graphic): graphic is Graphic & HasTick {\r\n  return !!(graphic as unknown as HasTick).tick;\r\n}\r\nexport interface GraphicsShowOptions {\r\n  offset?: Vector;\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsComponentOptions {\r\n  onPostDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n  onPreDraw?: (ex: ExcaliburGraphicsContext, elapsed: number) => void;\r\n\r\n  /**\r\n   * Name of current graphic to use\r\n   */\r\n  current?: string;\r\n\r\n  /**\r\n   * Optionally copy instances of graphics by calling .clone(), you may set this to false to avoid sharing graphics when added to the\r\n   * component for performance reasons. By default graphics are not copied and are shared when added to the component.\r\n   */\r\n  copyGraphics?: boolean;\r\n\r\n  /**\r\n   * Optional visible flag, if the graphics component is not visible it will not be displayed\r\n   */\r\n  visible?: boolean;\r\n\r\n  /**\r\n   * Optional opacity\r\n   */\r\n  opacity?: number;\r\n\r\n  /**\r\n   * List of graphics\r\n   */\r\n  graphics?: { [graphicName: string]: Graphic };\r\n\r\n  /**\r\n   * Optional offset in absolute pixels to shift all graphics in this component from each graphic's anchor (default is top left corner)\r\n   */\r\n  offset?: Vector;\r\n\r\n  /**\r\n   * Optional anchor\r\n   */\r\n  anchor?: Vector;\r\n}\r\n\r\nexport interface GraphicsLayerOptions {\r\n  /**\r\n   * Name of the layer required, for example 'background'\r\n   */\r\n  name: string;\r\n  /**\r\n   * Order of the layer, a layer with order -1 will be below a layer with order of 1\r\n   */\r\n  order: number;\r\n  /**\r\n   * Offset to shift the entire layer\r\n   */\r\n  offset?: Vector;\r\n}\r\nexport class GraphicsLayer {\r\n  public graphics: { graphic: Graphic; options: GraphicsShowOptions }[] = [];\r\n  constructor(private _options: GraphicsLayerOptions, private _graphics: GraphicsComponent) {}\r\n  public get name(): string {\r\n    return this._options.name;\r\n  }\r\n\r\n  /**\r\n   * Remove any instance(s) of a graphic currently being shown in this layer\r\n   */\r\n  public hide(nameOrGraphic: string | Graphic): void;\r\n  /**\r\n   * Remove all currently shown graphics in this layer\r\n   */\r\n  public hide(): void;\r\n  public hide(nameOrGraphic?: string | Graphic): void {\r\n    if (!nameOrGraphic) {\r\n      this.graphics.length = 0;\r\n    } else {\r\n      let gfx: Graphic = null;\r\n      if (nameOrGraphic instanceof Graphic) {\r\n        gfx = nameOrGraphic;\r\n      } else {\r\n        gfx = this._graphics.getGraphic(nameOrGraphic);\r\n      }\r\n      this.graphics = this.graphics.filter((g) => g.graphic !== gfx);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show a graphic by name or instance at an offset, graphics are shown in the order in which `show()` is called.\r\n   *\r\n   * If `show()` is called multiple times for the same graphic it will be shown multiple times.\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    options = { ...options };\r\n    let gfx: Graphic;\r\n    if (nameOrGraphic instanceof Graphic) {\r\n      gfx = this._graphics.copyGraphics ? nameOrGraphic.clone() : nameOrGraphic;\r\n    } else {\r\n      gfx = this._graphics.getGraphic(nameOrGraphic);\r\n      if (!gfx) {\r\n        Logger.getInstance().error(\r\n          `No such graphic added to component named ${nameOrGraphic}. These named graphics are available: `,\r\n          this._graphics.getNames()\r\n        );\r\n      }\r\n    }\r\n    if (gfx) {\r\n      this.graphics.push({ graphic: gfx, options });\r\n      return gfx as T;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Use a specific graphic, swap out any current graphics being shown\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    options = { ...options };\r\n    this.hide();\r\n    return this.show<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Current order of the layer, higher numbers are on top, lower numbers are on the bottom.\r\n   *\r\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\r\n   */\r\n  public get order(): number {\r\n    return this._options.order;\r\n  }\r\n\r\n  /**\r\n   * Set the order of the layer, higher numbers are on top, lower numbers are on the bottom.\r\n   *\r\n   * For example a layer with `order = -1` would be under a layer of `order = 1`\r\n   */\r\n  public set order(order: number) {\r\n    this._options.order = order;\r\n  }\r\n\r\n  /**\r\n   * Get or set the pixel offset from the layer anchor for all graphics in the layer\r\n   */\r\n  public get offset(): Vector {\r\n    return this._options.offset ?? Vector.Zero;\r\n  }\r\n\r\n  public set offset(value: Vector) {\r\n    this._options.offset = value;\r\n  }\r\n\r\n  public get currentKeys(): string {\r\n    return this.name ?? 'anonymous';\r\n  }\r\n}\r\n\r\nexport class GraphicsLayers {\r\n  private _layers: GraphicsLayer[] = [];\r\n  private _layerMap: { [layerName: string]: GraphicsLayer } = {};\r\n  public default: GraphicsLayer;\r\n  constructor(private _component: GraphicsComponent) {\r\n    this.default = new GraphicsLayer({ name: 'default', order: 0 }, _component);\r\n    this._maybeAddLayer(this.default);\r\n  }\r\n  public create(options: GraphicsLayerOptions): GraphicsLayer {\r\n    const layer = new GraphicsLayer(options, this._component);\r\n    return this._maybeAddLayer(layer);\r\n  }\r\n\r\n  /**\r\n   * Retrieve a single layer by name\r\n   * @param name\r\n   */\r\n  public get(name: string): GraphicsLayer;\r\n  /**\r\n   * Retrieve all layers\r\n   */\r\n  public get(): readonly GraphicsLayer[];\r\n  public get(name?: string): GraphicsLayer | readonly GraphicsLayer[] {\r\n    if (name) {\r\n      return this._getLayer(name);\r\n    }\r\n    return this._layers;\r\n  }\r\n\r\n  public currentKeys() {\r\n    const graphicsLayerKeys = [];\r\n    for (const layer of this._layers) {\r\n      graphicsLayerKeys.push(layer.currentKeys);\r\n    }\r\n    return graphicsLayerKeys;\r\n  }\r\n\r\n  public has(name: string): boolean {\r\n    return name in this._layerMap;\r\n  }\r\n\r\n  private _maybeAddLayer(layer: GraphicsLayer) {\r\n    if (this._layerMap[layer.name]) {\r\n      // todo log warning\r\n      return this._layerMap[layer.name];\r\n    }\r\n    this._layerMap[layer.name] = layer;\r\n    this._layers.push(layer);\r\n    this._layers.sort((a, b) => a.order - b.order);\r\n    return layer;\r\n  }\r\n\r\n  private _getLayer(name: string): GraphicsLayer | undefined {\r\n    return this._layerMap[name];\r\n  }\r\n}\r\n\r\n/**\r\n * Component to manage drawings, using with the position component\r\n */\r\nexport class GraphicsComponent extends Component<'ex.graphics'> {\r\n  readonly type = 'ex.graphics';\r\n\r\n  private _graphics: { [graphicName: string]: Graphic } = {};\r\n\r\n  public layers: GraphicsLayers;\r\n\r\n  public getGraphic(name: string): Graphic | undefined {\r\n    return this._graphics[name];\r\n  }\r\n\r\n  /**\r\n   * Get registered graphics names\r\n   */\r\n  public getNames(): string[] {\r\n    return Object.keys(this._graphics);\r\n  }\r\n\r\n  /**\r\n   * Draws after the entity transform has bene applied, but before graphics component graphics have been drawn\r\n   */\r\n  public onPreDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\r\n\r\n  /**\r\n   * Draws after the entity transform has been applied, and after graphics component graphics has been drawn\r\n   */\r\n  public onPostDraw: (ctx: ExcaliburGraphicsContext, elapsedMilliseconds: number) => void;\r\n\r\n  /**\r\n   * Sets or gets wether any drawing should be visible in this component\r\n   */\r\n  public visible: boolean = true;\r\n\r\n  /**\r\n   * Sets or gets wither all drawings should have an opacity applied\r\n   */\r\n  public opacity: number = 1;\r\n\r\n  /**\r\n   * Offset to apply to graphics by default\r\n   */\r\n  public offset: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * Anchor to apply to graphics by default\r\n   */\r\n  public anchor: Vector = Vector.Half;\r\n\r\n  /**\r\n   * If set to true graphics added to the component will be copied. This can affect performance\r\n   */\r\n  public copyGraphics: boolean = false;\r\n\r\n  constructor(options?: GraphicsComponentOptions) {\r\n    super();\r\n    // Defaults\r\n    options = {\r\n      visible: this.visible,\r\n      ...options\r\n    };\r\n\r\n    const { current, anchor, opacity, visible, graphics, offset, copyGraphics, onPreDraw, onPostDraw } = options;\r\n\r\n    this._graphics = graphics || {};\r\n    this.offset = offset ?? this.offset;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.anchor = anchor ?? this.anchor;\r\n    this.copyGraphics = copyGraphics ?? this.copyGraphics;\r\n    this.onPreDraw = onPreDraw ?? this.onPreDraw;\r\n    this.onPostDraw = onPostDraw ?? this.onPostDraw;\r\n    this.visible = !!visible;\r\n\r\n    this.layers = new GraphicsLayers(this);\r\n    if (current && this._graphics[current]) {\r\n      this.show(this._graphics[current]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed graphics and their offsets, empty array if hidden\r\n   */\r\n  public get current(): { graphic: Graphic; options: GraphicsShowOptions }[] {\r\n    return this.layers.default.graphics;\r\n  }\r\n\r\n  /**\r\n   * Returns all graphics associated with this component\r\n   */\r\n  public get graphics(): { [graphicName: string]: Graphic } {\r\n    return this._graphics;\r\n  }\r\n\r\n  /**\r\n   * Adds a named graphic to this component, if the name is \"default\" or not specified, it will be shown by default without needing to call\r\n   * `show(\"default\")`\r\n   * @param graphic\r\n   */\r\n  public add(graphic: Graphic): Graphic;\r\n  public add(name: string, graphic: Graphic): Graphic;\r\n  public add(nameOrGraphic: string | Graphic, graphic?: Graphic): Graphic {\r\n    let name = 'default';\r\n    let graphicToSet: Graphic = null;\r\n    if (typeof nameOrGraphic === 'string') {\r\n      name = nameOrGraphic;\r\n      graphicToSet = graphic;\r\n    } else {\r\n      graphicToSet = nameOrGraphic;\r\n    }\r\n\r\n    this._graphics[name] = this.copyGraphics ? graphicToSet.clone() : graphicToSet;\r\n    if (name === 'default') {\r\n      this.show('default');\r\n    }\r\n    return graphicToSet;\r\n  }\r\n\r\n  /**\r\n   * Show a graphic by name on the **default** layer, returns the new [[Graphic]]\r\n   */\r\n  public show<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    return this.layers.default.show<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Use a graphic only, swap out any graphics on the **default** layer, returns the new [[Graphic]]\r\n   * @param nameOrGraphic\r\n   * @param options\r\n   */\r\n  public use<T extends Graphic = Graphic>(nameOrGraphic: string | T, options?: GraphicsShowOptions): T {\r\n    return this.layers.default.use<T>(nameOrGraphic, options);\r\n  }\r\n\r\n  /**\r\n   * Remove any instance(s) of a graphic currently being shown in the **default** layer\r\n   */\r\n  public hide(nameOrGraphic: string | Graphic): void;\r\n  /**\r\n   * Remove all currently shown graphics in the **default** layer\r\n   */\r\n  public hide(): void;\r\n  public hide(nameOrGraphic?: string | Graphic): void {\r\n    this.layers.default.hide(nameOrGraphic);\r\n  }\r\n\r\n  private _bounds: BoundingBox = null;\r\n  public set localBounds(bounds: BoundingBox) {\r\n    this._bounds = bounds;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    if (this._bounds) {\r\n      return this._bounds;\r\n    }\r\n    let bb = new BoundingBox();\r\n    for (const layer of this.layers.get()) {\r\n      for (const { graphic, options } of layer.graphics) {\r\n        let anchor = this.anchor;\r\n        let offset = this.offset;\r\n        if (options?.anchor) {\r\n          anchor = options.anchor;\r\n        }\r\n        if (options?.offset) {\r\n          offset = options.offset;\r\n        }\r\n        const bounds = graphic.localBounds;\r\n        const offsetX = -bounds.width * graphic.scale.x * anchor.x + offset.x;\r\n        const offsetY = -bounds.height * graphic.scale.y * anchor.y + offset.y;\r\n        bb = graphic?.localBounds.translate(vec(offsetX + layer.offset.x, offsetY + layer.offset.y)).combine(bb);\r\n      }\r\n    }\r\n    return bb;\r\n  }\r\n\r\n  /**\r\n   * Update underlying graphics if necesary, called internally\r\n   * @param elapsed\r\n   * @internal\r\n   */\r\n  public update(elapsed: number, idempotencyToken: number = 0) {\r\n    for (const layer of this.layers.get()) {\r\n      for (const { graphic } of layer.graphics) {\r\n        if (hasGraphicsTick(graphic)) {\r\n          graphic?.tick(elapsed, idempotencyToken);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface RectangleOptions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n/**\r\n * A Rectangle [[Graphic]] for drawing rectangles to the [[ExcaliburGraphicsContext]]\r\n */\r\nexport class Rectangle extends Raster {\r\n  constructor(options: RasterOptions & RectangleOptions) {\r\n    super(options);\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Rectangle {\r\n    return new Rectangle({\r\n      width: this.width,\r\n      height: this.height,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.color) {\r\n      ctx.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    if (this.strokeColor) {\r\n      ctx.strokeRect(0, 0, this.width, this.height);\r\n    }\r\n  }\r\n}\r\n","import { Raster, RasterOptions } from './Raster';\r\n\r\nexport interface CircleOptions {\r\n  radius: number;\r\n}\r\n\r\n/**\r\n * A circle [[Graphic]] for drawing circles to the [[ExcaliburGraphicsContext]]\r\n */\r\nexport class Circle extends Raster {\r\n  private _radius: number = 0;\r\n  public get radius() {\r\n    return this._radius;\r\n  }\r\n  public set radius(value: number) {\r\n    this._radius = value;\r\n    this.width = this._radius * 2;\r\n    this.height = this._radius * 2;\r\n    this.flagDirty();\r\n  }\r\n  constructor(options: RasterOptions & CircleOptions) {\r\n    super(options);\r\n    this.padding = options.padding ?? 2; // default 2 padding for circles looks nice\r\n    this.radius = options.radius;\r\n    this.rasterize();\r\n  }\r\n\r\n  public clone(): Circle {\r\n    return new Circle({\r\n      radius: this.radius,\r\n      ...this.cloneGraphicOptions(),\r\n      ...this.cloneRasterOptions()\r\n    });\r\n  }\r\n\r\n  execute(ctx: CanvasRenderingContext2D): void {\r\n    if (this.radius > 0) {\r\n      ctx.beginPath();\r\n      ctx.arc(this.radius, this.radius, this.radius, 0, Math.PI * 2);\r\n\r\n      if (this.color) {\r\n        ctx.fill();\r\n      }\r\n\r\n      if (this.strokeColor) {\r\n        ctx.stroke();\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * An enum that describes the strategies that rotation actions can use\r\n */\r\nexport enum RotationType {\r\n  /**\r\n   * Rotation via `ShortestPath` will use the smallest angle\r\n   * between the starting and ending points. This strategy is the default behavior.\r\n   */\r\n  ShortestPath = 0,\r\n  /**\r\n   * Rotation via `LongestPath` will use the largest angle\r\n   * between the starting and ending points.\r\n   */\r\n  LongestPath = 1,\r\n  /**\r\n   * Rotation via `Clockwise` will travel in a clockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  Clockwise = 2,\r\n  /**\r\n   * Rotation via `CounterClockwise` will travel in a counterclockwise direction,\r\n   * regardless of the starting and ending points.\r\n   */\r\n  CounterClockwise = 3\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { obsolete } from '../Util/Decorators';\n\n/**\n * A definition of an EasingFunction. See [[EasingFunctions]].\n */\n// tslint:disable-next-line\nexport interface EasingFunction {\n  (currentTime: number, startValue: number, endValue: number, duration: number): number;\n}\n\n/**\n * Standard easing functions for motion in Excalibur, defined on a domain of [0, duration] and a range from [+startValue,+endValue]\n * Given a time, the function will return a value from positive startValue to positive endValue.\n *\n * ```js\n * function Linear (t) {\n *    return t * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInQuad (t) {\n *    return t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutQuad (t) {\n *    return t * (2 - t);\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutQuad (t) {\n *    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n * }\n *\n * // accelerating from zero velocity\n * function EaseInCubic (t) {\n *    return t * t * t;\n * }\n *\n * // decelerating to zero velocity\n * function EaseOutCubic (t) {\n *    return (--t) * t * t + 1;\n * }\n *\n * // acceleration until halfway, then deceleration\n * function EaseInOutCubic (t) {\n *    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n * }\n * ```\n */\nexport class EasingFunctions {\n  public static CreateReversibleEasingFunction(easing: EasingFunction) {\n    return (time: number, start: number, end: number, duration: number) => {\n      if (end < start) {\n        return start - (easing(time, end, start, duration) - end);\n      } else {\n        return easing(time, start, end, duration);\n      }\n    };\n  }\n\n  @obsolete({\n    message: 'Alias for incorrect spelling used in older versions, will be removed in v0.25.0',\n    alternateMethod: 'CreateReversibleEasingFunction'\n  })\n  public static CreateReversableEasingFunction(easing: EasingFunction) {\n    return EasingFunctions.CreateReversibleEasingFunction(easing);\n  }\n\n  public static CreateVectorEasingFunction(easing: EasingFunction) {\n    return (time: number, start: Vector, end: Vector, duration: number) => {\n      return new Vector(easing(time, start.x, end.x, duration), easing(time, start.y, end.y, duration));\n    };\n  }\n\n  public static Linear: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      return (endValue * currentTime) / duration + startValue;\n    }\n  );\n\n  public static EaseInQuad = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n\n      return endValue * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return -endValue * currentTime * (currentTime - 2) + startValue;\n    }\n  );\n\n  public static EaseInOutQuad: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime + startValue;\n      }\n      currentTime--;\n\n      return (-endValue / 2) * (currentTime * (currentTime - 2) - 1) + startValue;\n    }\n  );\n\n  public static EaseInCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      return endValue * currentTime * currentTime * currentTime + startValue;\n    }\n  );\n\n  public static EaseOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration;\n      currentTime--;\n      return endValue * (currentTime * currentTime * currentTime + 1) + startValue;\n    }\n  );\n\n  public static EaseInOutCubic: EasingFunction = EasingFunctions.CreateReversibleEasingFunction(\n    (currentTime: number, startValue: number, endValue: number, duration: number) => {\n      endValue = endValue - startValue;\n      currentTime /= duration / 2;\n      if (currentTime < 1) {\n        return (endValue / 2) * currentTime * currentTime * currentTime + startValue;\n      }\n      currentTime -= 2;\n      return (endValue / 2) * (currentTime * currentTime * currentTime + 2) + startValue;\n    }\n  );\n}\n","import { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Action } from './Action';\r\n\r\n/**\r\n * Action Queues represent an ordered sequence of actions\r\n *\r\n * Action queues are part of the [[ActionContext|Action API]] and\r\n * store the list of actions to be executed for an [[Actor]].\r\n *\r\n * Actors implement [[Actor.actions]] which can be manipulated by\r\n * advanced users to adjust the actions currently being executed in the\r\n * queue.\r\n */\r\nexport class ActionQueue {\r\n  private _entity: Entity;\r\n  private _actions: Action[] = [];\r\n  private _currentAction: Action;\r\n  private _completedActions: Action[] = [];\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  /**\r\n   * Add an action to the sequence\r\n   * @param action\r\n   */\r\n  public add(action: Action) {\r\n    this._actions.push(action);\r\n  }\r\n\r\n  /**\r\n   * Remove an action by reference from the sequence\r\n   * @param action\r\n   */\r\n  public remove(action: Action) {\r\n    const index = this._actions.indexOf(action);\r\n    this._actions.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Removes all actions from this sequence\r\n   */\r\n  public clearActions(): void {\r\n    this._actions.length = 0;\r\n    this._completedActions.length = 0;\r\n    if (this._currentAction) {\r\n      this._currentAction.stop();\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns The total list of actions in this sequence complete or not\r\n   */\r\n  public getActions(): Action[] {\r\n    return this._actions.concat(this._completedActions);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns `true` if there are more actions to process in the sequence\r\n   */\r\n  public hasNext(): boolean {\r\n    return this._actions.length > 0;\r\n  }\r\n\r\n  /**\r\n   * @returns `true` if the current sequence of actions is done\r\n   */\r\n  public isComplete(): boolean {\r\n    return this._actions.length === 0;\r\n  }\r\n\r\n  /**\r\n   * Resets the sequence of actions, this is used to restart a sequence from the beginning\r\n   */\r\n  public reset(): void {\r\n    this._actions = this.getActions();\r\n\r\n    const len = this._actions.length;\r\n    for (let i = 0; i < len; i++) {\r\n      this._actions[i].reset();\r\n    }\r\n    this._completedActions = [];\r\n  }\r\n\r\n  /**\r\n   * Update the queue which updates actions and handles completing actions\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number) {\r\n    if (this._actions.length > 0) {\r\n      this._currentAction = this._actions[0];\r\n      this._currentAction.update(elapsedMs);\r\n\r\n      if (this._currentAction.isComplete(this._entity)) {\r\n        this._completedActions.push(this._actions.shift());\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\nexport class Repeat implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _repeat: number;\r\n  private _originalRepeat: number;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any, repeat: number) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeat = repeat;\r\n    this._originalRepeat = repeat;\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n    this._repeat--; // current execution is the first repeat\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n      this._repeat--;\r\n    }\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || (this._repeat <= 0 && this._actionQueue.isComplete());\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._repeat = this._originalRepeat;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionContext } from '../ActionContext';\r\nimport { ActionQueue } from '../ActionQueue';\r\n\r\n/**\r\n * RepeatForever Action implementation, it is recommended you use the fluent action\r\n * context API.\r\n *\r\n *\r\n */\r\nexport class RepeatForever implements Action {\r\n  private _actionQueue: ActionQueue;\r\n  private _stopped: boolean = false;\r\n  private _repeatContext: ActionContext;\r\n  private _repeatBuilder: (repeatContext: ActionContext) => any;\r\n  constructor(entity: Entity, repeatBuilder: (repeatContext: ActionContext) => any) {\r\n    this._repeatBuilder = repeatBuilder;\r\n    this._repeatContext = new ActionContext(entity);\r\n    this._actionQueue = this._repeatContext.getQueue();\r\n\r\n    this._repeatBuilder(this._repeatContext);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (this._stopped) {\r\n      return;\r\n    }\r\n\r\n    if (this._actionQueue.isComplete()) {\r\n      this._actionQueue.clearActions();\r\n      this._repeatBuilder(this._repeatContext);\r\n    }\r\n\r\n    this._actionQueue.update(delta);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n    this._actionQueue.clearActions();\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class MoveBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _entity: Entity;\r\n  public x: number;\r\n  public y: number;\r\n  private _distance: number;\r\n  private _speed: number;\r\n\r\n  private _start: Vector;\r\n  private _offset: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, offsetX: number, offsetY: number, speed: number) {\r\n    this._entity = entity;\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = new Vector(offsetX, offsetY);\r\n    if (speed <= 0) {\r\n      Logger.getInstance().error('Attempted to moveBy with speed less than or equal to zero : ' + speed);\r\n      throw new Error('Speed must be greater than 0 pixels per second');\r\n    }\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._end = this._start.add(this._offset);\r\n      this._distance = this._offset.size;\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n\r\n    if (this.isComplete(this._entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    } else {\r\n      this._motion.vel = this._dir.scale(this._speed);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || tx.pos.distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class MoveTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _distance: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(public entity: Entity, destx: number, desty: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = new Vector(destx, desty);\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n      this._distance = this._start.distance(this._end);\r\n      this._dir = this._end.sub(this._start).normalize();\r\n    }\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete(this.entity)) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(entity: Entity): boolean {\r\n    const tx = entity.get(TransformComponent);\r\n    return this._stopped || new Vector(tx.pos.x, tx.pos.y).distance(this._start) >= this._distance;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport * as Util from '../../Util/Util';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\n\r\nexport class RotateTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadians: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._end = angleRadians;\r\n    this._speed = speed;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = Util.TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (!this._shortestPathIsPositive) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\nimport { RotationType } from '../RotationType';\r\nimport * as Util from '../../Util/Util';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\n\r\nexport class RotateBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _start: number;\r\n  private _end: number;\r\n  private _speed: number;\r\n  private _offset: number;\r\n\r\n  private _rotationType: RotationType;\r\n  private _direction: number;\r\n  private _distance: number;\r\n  private _shortDistance: number;\r\n  private _longDistance: number;\r\n  private _shortestPathIsPositive: boolean;\r\n  private _currentNonCannonAngle: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, angleRadiansOffset: number, speed: number, rotationType?: RotationType) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._speed = speed;\r\n    this._offset = angleRadiansOffset;\r\n    this._rotationType = rotationType || RotationType.ShortestPath;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._start = this._tx.rotation;\r\n      this._currentNonCannonAngle = this._tx.rotation;\r\n      this._end = this._start + this._offset;\r\n\r\n      const distance1 = Math.abs(this._end - this._start);\r\n      const distance2 = Util.TwoPI - distance1;\r\n      if (distance1 > distance2) {\r\n        this._shortDistance = distance2;\r\n        this._longDistance = distance1;\r\n      } else {\r\n        this._shortDistance = distance1;\r\n        this._longDistance = distance2;\r\n      }\r\n\r\n      this._shortestPathIsPositive = (this._start - this._end + Util.TwoPI) % Util.TwoPI >= Math.PI;\r\n\r\n      switch (this._rotationType) {\r\n        case RotationType.ShortestPath:\r\n          this._distance = this._shortDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = 1;\r\n          } else {\r\n            this._direction = -1;\r\n          }\r\n          break;\r\n        case RotationType.LongestPath:\r\n          this._distance = this._longDistance;\r\n          if (this._shortestPathIsPositive) {\r\n            this._direction = -1;\r\n          } else {\r\n            this._direction = 1;\r\n          }\r\n          break;\r\n        case RotationType.Clockwise:\r\n          this._direction = 1;\r\n          if (this._shortDistance >= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n        case RotationType.CounterClockwise:\r\n          this._direction = -1;\r\n          if (this._shortDistance <= 0) {\r\n            this._distance = this._shortDistance;\r\n          } else {\r\n            this._distance = this._longDistance;\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    this._motion.angularVelocity = this._direction * this._speed;\r\n    this._currentNonCannonAngle += this._direction * this._speed * (_delta / 1000);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.rotation = this._end;\r\n      this._motion.angularVelocity = 0;\r\n      this._stopped = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    const distanceTravelled = Math.abs(this._currentNonCannonAngle - this._start);\r\n    return this._stopped || distanceTravelled >= Math.abs(this._distance);\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.angularVelocity = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { vec } from '../../Math/vector';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action } from '../Action';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\n\r\nexport class ScaleTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _startX: number;\r\n  private _startY: number;\r\n  private _endX: number;\r\n  private _endY: number;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  private _distanceX: number;\r\n  private _distanceY: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  constructor(entity: Entity, scaleX: number, scaleY: number, speedX: number, speedY: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._endX = scaleX;\r\n    this._endY = scaleY;\r\n    this._speedX = speedX;\r\n    this._speedY = speedY;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startX = this._tx.scale.x;\r\n      this._startY = this._tx.scale.y;\r\n      this._distanceX = Math.abs(this._endX - this._startX);\r\n      this._distanceY = Math.abs(this._endY - this._startY);\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.x - this._startX) >= this._distanceX)) {\r\n      const directionX = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.x = this._speedX * directionX;\r\n    } else {\r\n      this._motion.scaleFactor.x = 0;\r\n    }\r\n\r\n    if (!(Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)) {\r\n      const directionY = this._endY < this._startY ? -1 : 1;\r\n      this._motion.scaleFactor.y = this._speedY * directionY;\r\n    } else {\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = vec(this._endX, this._endY);\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.y - this._startX) >= this._distanceX && Math.abs(this._tx.scale.y - this._startY) >= this._distanceY)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Action } from '../Action';\r\n\r\nexport class ScaleBy implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _startScale: Vector;\r\n  private _endScale: Vector;\r\n  private _offset: Vector;\r\n  private _distanceX: number;\r\n  private _distanceY: number;\r\n  private _directionX: number;\r\n  private _directionY: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedX: number;\r\n  private _speedY: number;\r\n  constructor(entity: Entity, scaleOffsetX: number, scaleOffsetY: number, speed: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._offset = new Vector(scaleOffsetX, scaleOffsetY);\r\n    this._speedX = this._speedY = speed;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._startScale = this._tx.scale.clone();\r\n      this._endScale = this._startScale.add(this._offset);\r\n      this._distanceX = Math.abs(this._endScale.x - this._startScale.x);\r\n      this._distanceY = Math.abs(this._endScale.y - this._startScale.y);\r\n      this._directionX = this._endScale.x < this._startScale.x ? -1 : 1;\r\n      this._directionY = this._endScale.y < this._startScale.y ? -1 : 1;\r\n    }\r\n\r\n    this._motion.scaleFactor.x = this._speedX * this._directionX;\r\n    this._motion.scaleFactor.y = this._speedY * this._directionY;\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.scale = this._endScale;\r\n      this._motion.scaleFactor.x = 0;\r\n      this._motion.scaleFactor.y = 0;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return (\r\n      this._stopped ||\r\n      (Math.abs(this._tx.scale.x - this._startScale.x) >= this._distanceX &&\r\n        Math.abs(this._tx.scale.y - this._startScale.y) >= this._distanceY)\r\n    );\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.scaleFactor.x = 0;\r\n    this._motion.scaleFactor.y = 0;\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\n\r\nexport class CallMethod implements Action {\r\n  private _method: () => any = null;\r\n  private _hasBeenCalled: boolean = false;\r\n  constructor(method: () => any) {\r\n    this._method = method;\r\n  }\r\n\r\n  public update(_delta: number) {\r\n    this._method();\r\n    this._hasBeenCalled = true;\r\n  }\r\n  public isComplete() {\r\n    return this._hasBeenCalled;\r\n  }\r\n  public reset() {\r\n    this._hasBeenCalled = false;\r\n  }\r\n  public stop() {\r\n    this._hasBeenCalled = true;\r\n  }\r\n}\r\n","import { Entity} from '../../EntityComponentSystem/Entity';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { Actor } from '../../Actor';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class EaseTo implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1 * 1000; // 1 second\r\n  private _lerpStart: Vector = new Vector(0, 0);\r\n  private _lerpEnd: Vector = new Vector(0, 0);\r\n  private _initialized: boolean = false;\r\n  private _stopped: boolean = false;\r\n  private _distance: number = 0;\r\n  constructor(\r\n    entity: Entity,\r\n    x: number,\r\n    y: number,\r\n    duration: number,\r\n    public easingFcn: (currentTime: number, startValue: number, endValue: number, duration: number) => number\r\n  ) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = new Vector(x, y);\r\n  }\r\n  private _initialize() {\r\n    this._lerpStart = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._currentLerpTime = 0;\r\n    this._distance = this._lerpStart.distance(this._lerpEnd);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._initialized) {\r\n      this._initialize();\r\n      this._initialized = true;\r\n    }\r\n\r\n    // Need to update lerp time first, otherwise the first update will always be zero\r\n    this._currentLerpTime += delta;\r\n    let newX = this._tx.pos.x;\r\n    let newY = this._tx.pos.y;\r\n    if (this._currentLerpTime < this._lerpDuration) {\r\n      if (this._lerpEnd.x < this._lerpStart.x) {\r\n        newX =\r\n          this._lerpStart.x -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.x, this._lerpStart.x, this._lerpDuration) - this._lerpEnd.x);\r\n      } else {\r\n        newX = this.easingFcn(this._currentLerpTime, this._lerpStart.x, this._lerpEnd.x, this._lerpDuration);\r\n      }\r\n\r\n      if (this._lerpEnd.y < this._lerpStart.y) {\r\n        newY =\r\n          this._lerpStart.y -\r\n          (this.easingFcn(this._currentLerpTime, this._lerpEnd.y, this._lerpStart.y, this._lerpDuration) - this._lerpEnd.y);\r\n      } else {\r\n        newY = this.easingFcn(this._currentLerpTime, this._lerpStart.y, this._lerpEnd.y, this._lerpDuration);\r\n      }\r\n      // Given the lerp position figure out the velocity in pixels per second\r\n      this._motion.vel = vec((newX - this._tx.pos.x) / (delta / 1000), (newY - this._tx.pos.y) / (delta / 1000));\r\n    } else {\r\n      this._tx.pos = vec(this._lerpEnd.x, this._lerpEnd.y);\r\n      this._motion.vel = Vector.Zero;\r\n    }\r\n  }\r\n  public isComplete(actor: Actor): boolean {\r\n    return this._stopped || new Vector(actor.pos.x, actor.pos.y).distance(this._lerpStart) >= this._distance;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._initialized = false;\r\n  }\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n}\r\n","import { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\n\r\nexport class Blink implements Action {\r\n  private _graphics: GraphicsComponent;\r\n  private _timeVisible: number = 0;\r\n  private _timeNotVisible: number = 0;\r\n  private _elapsedTime: number = 0;\r\n  private _totalTime: number = 0;\r\n  private _duration: number;\r\n  private _stopped: boolean = false;\r\n  private _started: boolean = false;\r\n  constructor(entity: Entity, timeVisible: number, timeNotVisible: number, numBlinks: number = 1) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._timeVisible = timeVisible;\r\n    this._timeNotVisible = timeNotVisible;\r\n    this._duration = (timeVisible + timeNotVisible) * numBlinks;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n    this._totalTime += delta;\r\n    if (this._graphics.visible && this._elapsedTime >= this._timeVisible) {\r\n      this._graphics.visible = false;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (!this._graphics.visible && this._elapsedTime >= this._timeNotVisible) {\r\n      this._graphics.visible = true;\r\n      this._elapsedTime = 0;\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.visible = true;\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._totalTime >= this._duration;\r\n  }\r\n\r\n  public stop(): void {\r\n    if (this._graphics) {\r\n      this._graphics.visible = true;\r\n    }\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset() {\r\n    this._started = false;\r\n    this._elapsedTime = 0;\r\n    this._totalTime = 0;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { GraphicsComponent } from '../../Graphics/GraphicsComponent';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Action } from '../Action';\r\n\r\nexport class Fade implements Action {\r\n  private _graphics: GraphicsComponent;\r\n  public x: number;\r\n  public y: number;\r\n\r\n  private _endOpacity: number;\r\n  private _speed: number;\r\n  private _multiplier: number = 1;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, endOpacity: number, speed: number) {\r\n    this._graphics = entity.get(GraphicsComponent);\r\n    this._endOpacity = endOpacity;\r\n    this._speed = speed;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._graphics) {\r\n      return;\r\n    }\r\n\r\n    if (!this._started) {\r\n      this._started = true;\r\n\r\n      // determine direction when we start\r\n      if (this._endOpacity < this._graphics.opacity) {\r\n        this._multiplier = -1;\r\n      } else {\r\n        this._multiplier = 1;\r\n      }\r\n    }\r\n\r\n    if (this._speed > 0) {\r\n      this._graphics.opacity += (this._multiplier *\r\n        (Math.abs(this._graphics.opacity - this._endOpacity) * delta)) / this._speed;\r\n    }\r\n\r\n    this._speed -= delta;\r\n\r\n    if (this.isComplete()) {\r\n      this._graphics.opacity = this._endOpacity;\r\n    }\r\n\r\n    Logger.getInstance().debug('[Action fade] Actor opacity:', this._graphics.opacity);\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || Math.abs(this._graphics.opacity - this._endOpacity) < 0.05;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Action } from '../Action';\r\n\r\nexport class Delay implements Action {\r\n  private _elapsedTime: number = 0;\r\n  private _delay: number;\r\n  private _started: boolean = false;\r\n  private _stopped = false;\r\n  constructor(delay: number) {\r\n    this._delay = delay;\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n    }\r\n\r\n    this._elapsedTime += delta;\r\n  }\r\n\r\n  isComplete(): boolean {\r\n    return this._stopped || this._elapsedTime >= this._delay;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._stopped = true;\r\n  }\r\n\r\n  reset(): void {\r\n    this._elapsedTime = 0;\r\n    this._started = false;\r\n  }\r\n}\r\n","import { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Action } from '../Action';\r\nimport { ActionsComponent } from '../ActionsComponent';\r\n\r\nexport class Die implements Action {\r\n  private _entity: Entity;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    this._entity.get(ActionsComponent).clearActions();\r\n    this._entity.kill();\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped;\r\n  }\r\n\r\n  public stop(): void {\r\n    return;\r\n  }\r\n\r\n  public reset(): void {\r\n    return;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { vec, Vector } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class Follow implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _followTx: TransformComponent;\r\n  private _followMotion: MotionComponent;\r\n\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _maximumDistance: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n\r\n  constructor(entity: Entity, entityToFollow: Entity, followDistance?: number) {\r\n    this._tx = entity.get(TransformComponent);\r\n    this._motion = entity.get(MotionComponent);\r\n    this._followTx = entityToFollow.get(TransformComponent);\r\n    this._followMotion = entityToFollow.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._maximumDistance = followDistance !== undefined ? followDistance : this._current.distance(this._end);\r\n    this._speed = 0;\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToFollowSpeed = Math.sqrt(Math.pow(this._followMotion.vel.x, 2) + Math.pow(this._followMotion.vel.y, 2));\r\n    if (actorToFollowSpeed !== 0) {\r\n      this._speed = actorToFollowSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._followTx.pos.x, this._followTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    if (this._distanceBetween >= this._maximumDistance) {\r\n      const m = this._dir.scale(this._speed);\r\n      this._motion.vel = vec(m.x, m.y);\r\n    } else {\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    // the actor following should never stop unless specified to do so\r\n    return this._stopped;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { MotionComponent } from '../../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../../EntityComponentSystem/Entity';\r\nimport { Vector, vec } from '../../Math/vector';\r\nimport { Action } from '../Action';\r\n\r\nexport class Meet implements Action {\r\n  private _tx: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _meetTx: TransformComponent;\r\n  private _meetMotion: MotionComponent;\r\n  public x: number;\r\n  public y: number;\r\n  private _current: Vector;\r\n  private _end: Vector;\r\n  private _dir: Vector;\r\n  private _speed: number;\r\n  private _distanceBetween: number;\r\n  private _started = false;\r\n  private _stopped = false;\r\n  private _speedWasSpecified = false;\r\n\r\n  constructor(actor: Entity, actorToMeet: Entity, speed?: number) {\r\n    this._tx = actor.get(TransformComponent);\r\n    this._motion = actor.get(MotionComponent);\r\n    this._meetTx = actorToMeet.get(TransformComponent);\r\n    this._meetMotion = actorToMeet.get(MotionComponent);\r\n    this._current = new Vector(this._tx.pos.x, this._tx.pos.y);\r\n    this._end = new Vector(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._speed = speed || 0;\r\n\r\n    if (speed !== undefined) {\r\n      this._speedWasSpecified = true;\r\n    }\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    if (!this._started) {\r\n      this._started = true;\r\n      this._distanceBetween = this._current.distance(this._end);\r\n      this._dir = this._end.sub(this._current).normalize();\r\n    }\r\n\r\n    const actorToMeetSpeed = Math.sqrt(Math.pow(this._meetMotion.vel.x, 2) + Math.pow(this._meetMotion.vel.y, 2));\r\n    if (actorToMeetSpeed !== 0 && !this._speedWasSpecified) {\r\n      this._speed = actorToMeetSpeed;\r\n    }\r\n    this._current = vec(this._tx.pos.x, this._tx.pos.y);\r\n\r\n    this._end = vec(this._meetTx.pos.x, this._meetTx.pos.y);\r\n    this._distanceBetween = this._current.distance(this._end);\r\n    this._dir = this._end.sub(this._current).normalize();\r\n\r\n    const m = this._dir.scale(this._speed);\r\n    this._motion.vel = vec(m.x, m.y);\r\n\r\n    if (this.isComplete()) {\r\n      this._tx.pos = vec(this._end.x, this._end.y);\r\n      this._motion.vel = vec(0, 0);\r\n    }\r\n  }\r\n\r\n  public isComplete(): boolean {\r\n    return this._stopped || this._distanceBetween <= 1;\r\n  }\r\n\r\n  public stop(): void {\r\n    this._motion.vel = vec(0, 0);\r\n    this._stopped = true;\r\n  }\r\n\r\n  public reset(): void {\r\n    this._started = false;\r\n  }\r\n}\r\n","import { RotationType } from './RotationType';\r\n\r\nimport { EasingFunction, EasingFunctions } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { Repeat } from './Action/Repeat';\r\nimport { RepeatForever } from './Action/RepeatForever';\r\nimport { MoveBy } from './Action/MoveBy';\r\nimport { MoveTo } from './Action/MoveTo';\r\nimport { RotateTo } from './Action/RotateTo';\r\nimport { RotateBy } from './Action/RotateBy';\r\nimport { ScaleTo } from './Action/ScaleTo';\r\nimport { ScaleBy } from './Action/ScaleBy';\r\nimport { CallMethod } from './Action/CallMethod';\r\nimport { EaseTo } from './Action/EaseTo';\r\nimport { Blink } from './Action/Blink';\r\nimport { Fade } from './Action/Fade';\r\nimport { Delay } from './Action/Delay';\r\nimport { Die } from './Action/Die';\r\nimport { Follow } from './Action/Follow';\r\nimport { Meet } from './Action/Meet';\r\nimport { Vector } from '../Math/vector';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\n\r\n/**\r\n * The fluent Action API allows you to perform \"actions\" on\r\n * [[Actor|Actors]] such as following, moving, rotating, and\r\n * more. You can implement your own actions by implementing\r\n * the [[Action]] interface.\r\n */\r\nexport class ActionContext {\r\n  private _entity: Entity;\r\n  private _queue: ActionQueue;\r\n\r\n  constructor(entity: Entity) {\r\n    this._entity = entity;\r\n    this._queue = new ActionQueue(entity);\r\n  }\r\n\r\n  public getQueue(): ActionQueue {\r\n    return this._queue;\r\n  }\r\n\r\n  public update(elapsedMs: number) {\r\n    this._queue.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._queue.clearActions();\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext\r\n  public easeTo(...args: any[]): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let duration = 0;\r\n    let easingFcn = EasingFunctions.Linear;\r\n    if (args[0] instanceof Vector) {\r\n      x = args[0].x;\r\n      y = args[0].y;\r\n      duration = args[1];\r\n      easingFcn = args[2] ?? easingFcn;\r\n    } else {\r\n      x = args[0];\r\n      y = args[1];\r\n      duration = args[2];\r\n      easingFcn = args[3] ?? easingFcn;\r\n    }\r\n\r\n    this._queue.add(new EaseTo(this._entity, x, y, duration, easingFcn));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let x = 0;\r\n    let y = 0;\r\n    let speed = 0;\r\n    if (xOrPos instanceof Vector) {\r\n      x = xOrPos.x;\r\n      y = xOrPos.y;\r\n      speed = yOrSpeed;\r\n    } else {\r\n      x = xOrPos;\r\n      y = yOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveTo(this._entity, x, y, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number | undefined): ActionContext {\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    let speed = 0;\r\n    if (xOffsetOrVector instanceof Vector) {\r\n      xOffset = xOffsetOrVector.x;\r\n      yOffset = xOffsetOrVector.y;\r\n      speed = yOffsetOrSpeed;\r\n    } else {\r\n      xOffset = xOffsetOrVector;\r\n      yOffset = yOffsetOrSpeed;\r\n      speed = speedOrUndefined;\r\n    }\r\n    this._queue.add(new MoveBy(this._entity, xOffset, yOffset, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateTo(this._entity, angleRadians, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    this._queue.add(new RotateBy(this._entity, angleRadiansOffset, speed, rotationType));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number | undefined,\r\n    speedYOrUndefined?: number | undefined): ActionContext {\r\n\r\n    let sizeX = 1;\r\n    let sizeY = 1;\r\n    let speedX = 0;\r\n    let speedY = 0;\r\n\r\n    if (sizeXOrVector instanceof Vector && sizeYOrSpeed instanceof Vector) {\r\n      sizeX = sizeXOrVector.x;\r\n      sizeY = sizeXOrVector.y;\r\n\r\n      speedX = sizeYOrSpeed.x;\r\n      speedY = sizeYOrSpeed.y;\r\n    }\r\n    if (typeof sizeXOrVector === 'number' && typeof sizeYOrSpeed === 'number') {\r\n      sizeX = sizeXOrVector;\r\n      sizeY = sizeYOrSpeed;\r\n\r\n      speedX = speedXOrUndefined;\r\n      speedY = speedYOrUndefined;\r\n    }\r\n\r\n    this._queue.add(new ScaleTo(this._entity, sizeX, sizeY, speedX, speedY));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number | undefined): ActionContext {\r\n    let sizeOffsetX = 1;\r\n    let sizeOffsetY = 1;\r\n\r\n    if (sizeOffsetXOrVector instanceof Vector) {\r\n      sizeOffsetX = sizeOffsetXOrVector.x;\r\n      sizeOffsetY = sizeOffsetXOrVector.y;\r\n\r\n      speed = sizeOffsetYOrSpeed;\r\n    }\r\n    if (typeof sizeOffsetXOrVector === 'number' && typeof sizeOffsetYOrSpeed === 'number') {\r\n      sizeOffsetX = sizeOffsetXOrVector;\r\n      sizeOffsetY = sizeOffsetYOrSpeed;\r\n    }\r\n\r\n    this._queue.add(new ScaleBy(this._entity, sizeOffsetX, sizeOffsetY, speed));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks: number = 1): ActionContext {\r\n    this._queue.add(new Blink(this._entity, timeVisible, timeNotVisible, numBlinks));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    this._queue.add(new Fade(this._entity, opacity, time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    this._queue.add(new Delay(time));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    this._queue.add(new Die(this._entity));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    this._queue.add(new CallMethod(method));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    if (!times) {\r\n      this.repeatForever(repeatBuilder);\r\n      return this;\r\n    }\r\n    this._queue.add(new Repeat(this._entity, repeatBuilder, times));\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    this._queue.add(new RepeatForever(this._entity, repeatBuilder));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Entity, followDistance?: number): ActionContext {\r\n    if (followDistance === undefined) {\r\n      this._queue.add(new Follow(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Follow(this._entity, entity, followDistance));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Entity, speed?: number): ActionContext {\r\n    if (speed === undefined) {\r\n      this._queue.add(new Meet(this._entity, entity));\r\n    } else {\r\n      this._queue.add(new Meet(this._entity, entity, speed));\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\r\n   */\r\n  public asPromise(): Promise<void> {\r\n    return this.toPromise();\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    const temp = new Promise<void>((resolve) => {\r\n      this._queue.add(\r\n        new CallMethod(() => {\r\n          resolve();\r\n        })\r\n      );\r\n    });\r\n    return temp;\r\n  }\r\n}\r\n","import { ActionContext } from './ActionContext';\r\nimport { Component } from '../EntityComponentSystem/Component';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Actor } from '../Actor';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Vector } from '../Math/vector';\r\nimport { EasingFunction } from '../Util/EasingFunctions';\r\nimport { ActionQueue } from './ActionQueue';\r\nimport { RotationType } from './RotationType';\r\n\r\nexport interface ActionContextMethods extends Pick<ActionContext, keyof ActionContext> { };\r\n\r\nexport class ActionsComponent extends Component<'ex.actions'> implements ActionContextMethods {\r\n  public readonly type = 'ex.actions';\r\n  dependencies = [TransformComponent, MotionComponent]\r\n  private _ctx: ActionContext;\r\n\r\n  onAdd(entity: Entity) {\r\n    this._ctx = new ActionContext(entity);\r\n  }\r\n\r\n  onRemove() {\r\n    this._ctx = null;\r\n  }\r\n\r\n  /**\r\n   * Returns the internal action queue\r\n   * @returns action queu\r\n   */\r\n  public getQueue(): ActionQueue {\r\n    return this._ctx?.getQueue();\r\n  }\r\n\r\n  /**\r\n   * Updates the internal action context, performing action and moving through the internal queue\r\n   * @param elapsedMs\r\n   */\r\n  public update(elapsedMs: number): void {\r\n    return this._ctx?.update(elapsedMs);\r\n  }\r\n\r\n  /**\r\n   * Clears all queued actions from the Actor\r\n   */\r\n  public clearActions(): void {\r\n    this._ctx?.clearActions();\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos       The x,y vector location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(pos: Vector, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified `x` and `y` position over the\r\n   * specified duration using a given [[EasingFunctions]] and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x         The x location to move the actor to\r\n   * @param y         The y location to move the actor to\r\n   * @param duration  The time it should take the actor to move to the new location in milliseconds\r\n   * @param easingFcn Use [[EasingFunctions]] or a custom function to use to calculate position, Default is [[EasingFunctions.Linear]]\r\n   */\r\n  public easeTo(x: number, y: number, duration: number, easingFcn?: EasingFunction): ActionContext;\r\n  public easeTo(...args: any[]): ActionContext {\r\n    return this._ctx.easeTo.apply(this._ctx, args);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param pos    The x,y vector location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(pos: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor to the specified x and y position at the\r\n   * speed specified (in pixels per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param x      The x location to move the actor to\r\n   * @param y      The y location to move the actor to\r\n   * @param speed  The speed in pixels per second to move\r\n   */\r\n  public moveTo(x: number, y: number, speed: number): ActionContext;\r\n  public moveTo(xOrPos: number | Vector, yOrSpeed: number, speedOrUndefined?: number): ActionContext {\r\n    return this._ctx.moveTo.apply(this._ctx, [xOrPos, yOrSpeed, speedOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param offset The (x, y) offset to apply to this actor\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will move an actor by the specified x offset and y offset from its current position, at a certain speed.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param xOffset     The x offset to apply to this actor\r\n   * @param yOffset     The y location to move the actor to\r\n   * @param speed  The speed in pixels per second the actor should move\r\n   */\r\n  public moveBy(xOffset: number, yOffset: number, speed: number): ActionContext;\r\n  public moveBy(xOffsetOrVector: number | Vector, yOffsetOrSpeed: number, speedOrUndefined?: number): ActionContext {\r\n    return this._ctx.moveBy.apply(this._ctx, [xOffsetOrVector, yOffsetOrSpeed, speedOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor to the specified angle at the speed\r\n   * specified (in radians per second) and return back the actor. This\r\n   * method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadians  The angle to rotate to in radians\r\n   * @param speed         The angular velocity of the rotation specified in radians per second\r\n   * @param rotationType  The [[RotationType]] to use for this rotation\r\n   */\r\n  public rotateTo(angleRadians: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    return this._ctx.rotateTo(angleRadians, speed, rotationType);\r\n  }\r\n\r\n  /**\r\n   * This method will rotate an actor by the specified angle offset, from it's current rotation given a certain speed\r\n   * in radians/sec and return back the actor. This method is part\r\n   * of the actor 'Action' fluent API allowing action chaining.\r\n   * @param angleRadiansOffset  The angle to rotate to in radians relative to the current rotation\r\n   * @param speed          The speed in radians/sec the actor should rotate at\r\n   * @param rotationType  The [[RotationType]] to use for this rotation, default is shortest path\r\n   */\r\n  public rotateBy(angleRadiansOffset: number, speed: number, rotationType?: RotationType): ActionContext {\r\n    return this._ctx.rotateBy(angleRadiansOffset, speed, rotationType);\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param size    The scale to adjust the actor to over time\r\n   * @param speed   The speed of scaling specified in magnitude increase per second\r\n   */\r\n  public scaleTo(size: Vector, speed: Vector): ActionContext;\r\n  /**\r\n   * This method will scale an actor to the specified size at the speed\r\n   * specified (in magnitude increase per second) and return back the\r\n   * actor. This method is part of the actor 'Action' fluent API allowing\r\n   * action chaining.\r\n   * @param sizeX   The scaling factor to apply on X axis\r\n   * @param sizeY   The scaling factor to apply on Y axis\r\n   * @param speedX  The speed of scaling specified in magnitude increase per second on X axis\r\n   * @param speedY  The speed of scaling specified in magnitude increase per second on Y axis\r\n   */\r\n  public scaleTo(sizeX: number, sizeY: number, speedX: number, speedY: number): ActionContext;\r\n  public scaleTo(\r\n    sizeXOrVector: number | Vector,\r\n    sizeYOrSpeed: number | Vector,\r\n    speedXOrUndefined?: number,\r\n    speedYOrUndefined?: number): ActionContext {\r\n    return this._ctx.scaleTo.apply(this._ctx, [sizeXOrVector, sizeYOrSpeed, speedXOrUndefined, speedYOrUndefined]);\r\n  }\r\n\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param offset   The scaling factor to apply to the actor\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(offset: Vector, speed: number): ActionContext;\r\n  /**\r\n   * This method will scale an actor by an amount relative to the current scale at a certain speed in scale units/sec\r\n   * and return back the actor. This method is part of the\r\n   * actor 'Action' fluent API allowing action chaining.\r\n   * @param sizeOffsetX   The scaling factor to apply on X axis\r\n   * @param sizeOffsetY   The scaling factor to apply on Y axis\r\n   * @param speed    The speed to scale at in scale units/sec\r\n   */\r\n  public scaleBy(sizeOffsetX: number, sizeOffsetY: number, speed: number): ActionContext;\r\n  public scaleBy(sizeOffsetXOrVector: number | Vector, sizeOffsetYOrSpeed: number, speed?: number): ActionContext {\r\n    return this._ctx.scaleBy.apply(this._ctx, [sizeOffsetXOrVector, sizeOffsetYOrSpeed, speed]);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor to blink (become visible and not\r\n   * visible). Optionally, you may specify the number of blinks. Specify the amount of time\r\n   * the actor should be visible per blink, and the amount of time not visible.\r\n   * This method is part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param timeVisible     The amount of time to stay visible per blink in milliseconds\r\n   * @param timeNotVisible  The amount of time to stay not visible per blink in milliseconds\r\n   * @param numBlinks       The number of times to blink\r\n   */\r\n  public blink(timeVisible: number, timeNotVisible: number, numBlinks?: number): ActionContext {\r\n    return this._ctx.blink(timeVisible, timeNotVisible, numBlinks);\r\n  }\r\n\r\n  /**\r\n   * This method will cause an actor's opacity to change from its current value\r\n   * to the provided value by a specified time (in milliseconds). This method is\r\n   * part of the actor 'Action' fluent API allowing action chaining.\r\n   * @param opacity  The ending opacity\r\n   * @param time     The time it should take to fade the actor (in milliseconds)\r\n   */\r\n  public fade(opacity: number, time: number): ActionContext {\r\n    return this._ctx.fade(opacity, time);\r\n  }\r\n\r\n  /**\r\n   * This method will delay the next action from executing for a certain\r\n   * amount of time (in milliseconds). This method is part of the actor\r\n   * 'Action' fluent API allowing action chaining.\r\n   * @param time  The amount of time to delay the next action in the queue from executing in milliseconds\r\n   */\r\n  public delay(time: number): ActionContext {\r\n    return this._ctx.delay(time);\r\n  }\r\n\r\n  /**\r\n   * This method will add an action to the queue that will remove the actor from the\r\n   * scene once it has completed its previous  Any actions on the\r\n   * action queue after this action will not be executed.\r\n   */\r\n  public die(): ActionContext {\r\n    return this._ctx.die();\r\n  }\r\n\r\n  /**\r\n   * This method allows you to call an arbitrary method as the next action in the\r\n   * action queue. This is useful if you want to execute code in after a specific\r\n   * action, i.e An actor arrives at a destination after traversing a path\r\n   */\r\n  public callMethod(method: () => any): ActionContext {\r\n    return this._ctx.callMethod(method);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   * @param times  The number of times to repeat all the previous actions in the action queue. If nothing is specified the actions\r\n   * will repeat forever\r\n   */\r\n  public repeat(repeatBuilder: (repeatContext: ActionContext) => any, times?: number): ActionContext {\r\n    return this._ctx.repeat(repeatBuilder, times);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the actor to repeat all of the actions built in\r\n   * the `repeatBuilder` callback. If the number of repeats\r\n   * is not specified it will repeat forever. This method is part of\r\n   * the actor 'Action' fluent API allowing action chaining\r\n   *\r\n   * ```typescript\r\n   * // Move up in a zig-zag by repeated moveBy's\r\n   * actor.actions.repeat(repeatCtx => {\r\n   *  repeatCtx.moveBy(10, 0, 10);\r\n   *  repeatCtx.moveBy(0, 10, 10);\r\n   * }, 5);\r\n   * ```\r\n   *\r\n   * @param repeatBuilder The builder to specify the repeatable list of actions\r\n   */\r\n  public repeatForever(repeatBuilder: (repeatContext: ActionContext) => any): ActionContext {\r\n    return this._ctx.repeatForever(repeatBuilder);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to follow another at a specified distance\r\n   * @param entity           The entity to follow\r\n   * @param followDistance  The distance to maintain when following, if not specified the actor will follow at the current distance.\r\n   */\r\n  public follow(entity: Actor, followDistance?: number): ActionContext {\r\n    return this._ctx.follow(entity, followDistance);\r\n  }\r\n\r\n  /**\r\n   * This method will cause the entity to move towards another until they\r\n   * collide \"meet\" at a specified speed.\r\n   * @param entity  The entity to meet\r\n   * @param speed  The speed in pixels per second to move, if not specified it will match the speed of the other actor\r\n   */\r\n  public meet(entity: Actor, speed?: number): ActionContext {\r\n    return this._ctx.meet(entity, speed);\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   * @deprecated Use `toPromise()` will be removed in v0.26.0\r\n   */\r\n  public asPromise(): Promise<void> {\r\n    return this.toPromise();\r\n  }\r\n\r\n  /**\r\n   * Returns a promise that resolves when the current action queue up to now\r\n   * is finished.\r\n   */\r\n  public toPromise(): Promise<void> {\r\n    return this._ctx.toPromise();\r\n  }\r\n}","import { Texture } from './Drawing/Texture';\r\nimport {\r\n  InitializeEvent,\r\n  KillEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  PostCollisionEvent,\r\n  PreCollisionEvent,\r\n  CollisionStartEvent,\r\n  CollisionEndEvent,\r\n  PostKillEvent,\r\n  PreKillEvent,\r\n  GameEvent,\r\n  ExitTriggerEvent,\r\n  EnterTriggerEvent,\r\n  EnterViewPortEvent,\r\n  ExitViewPortEvent\r\n} from './Events';\r\nimport { PointerEvent, WheelEvent, PointerDragEvent, PointerEventName } from './Input/PointerEvents';\r\nimport { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { Sprite } from './Drawing/Sprite';\r\nimport { Animation } from './Drawing/Animation';\r\nimport { Trait } from './Interfaces/Trait';\r\nimport { Drawable } from './Interfaces/Drawable';\r\nimport { CanInitialize, CanUpdate, CanDraw, CanBeKilled } from './Interfaces/LifecycleEvents';\r\nimport { Scene } from './Scene';\r\nimport { Logger } from './Util/Log';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { Eventable } from './Interfaces/Evented';\r\nimport * as Traits from './Traits/Index';\r\nimport * as Events from './Events';\r\nimport { PointerEvents } from './Interfaces/PointerEventHandlers';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { CanvasDrawComponent } from './Drawing/CanvasDrawComponent';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Rectangle } from './Graphics/Rectangle';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { watch } from './Util/Watch';\r\nimport { Collider, CollisionGroup } from './Collision/Index';\r\nimport { Circle } from './Graphics/Circle';\r\nimport { CapturePointerConfig } from './Input/CapturePointerConfig';\r\nimport { ActionsComponent } from './Actions/ActionsComponent';\r\n\r\n/**\r\n * Type guard for checking if something is an Actor\r\n * @param x\r\n */\r\nexport function isActor(x: any): x is Actor {\r\n  return x instanceof Actor;\r\n}\r\n\r\n/**\r\n * Actor contructor options\r\n */\r\nexport interface ActorArgs {\r\n  /**\r\n   * Optionally set the name of the actor, default is 'anonymous'\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Optionally set the x position of the actor, default is 0\r\n   */\r\n  x?: number;\r\n  /**\r\n   * Optionally set the y position of the actor, default is 0\r\n   */\r\n  y?: number;\r\n  /**\r\n   * Optionaly set the (x, y) position of the actor as a vector, default is (0, 0)\r\n   */\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally set the width of a box collider for the actor\r\n   */\r\n  width?: number;\r\n  /**\r\n   * Optionally set the height of a box collider for the actor\r\n   */\r\n  height?: number;\r\n  /**\r\n   * Optionally set the radius of the circle collider for the actor\r\n   */\r\n  radius?: number;\r\n  /**\r\n   * Optionally set the velocity of the actor in pixels/sec\r\n   */\r\n  vel?: Vector;\r\n  /**\r\n   * Optionally set the acceleration of the actor in pixels/sec^2\r\n   */\r\n  acc?: Vector;\r\n  /**\r\n   * Optionally se the rotation in radians (180 degrees = Math.PI radians)\r\n   */\r\n  rotation?: number;\r\n  /**\r\n   * Optionally set the angular velocity of the actor in radians/sec (180 degrees = Math.PI radians)\r\n   */\r\n  angularVelocity?: number;\r\n  /**\r\n   * Optionally set the scale of the actor's transform\r\n   */\r\n  scale?: Vector;\r\n  /**\r\n   * Optionally set the z index of the actor, default is 0\r\n   */\r\n  z?: number;\r\n  /**\r\n   * Optionally set the color of an actor, only used if no graphics are present\r\n   * If a width/height or a radius was set a default graphic will be added\r\n   */\r\n  color?: Color;\r\n  /**\r\n   * Optionally set the visibility of the actor\r\n   */\r\n  visible?: boolean;\r\n  /**\r\n   * Optionally set the anchor for graphics in the actor\r\n   */\r\n  anchor?: Vector;\r\n  /**\r\n   * Optionally set the collision type\r\n   */\r\n  collisionType?: CollisionType;\r\n  /**\r\n   * Optionally supply a collider for an actor, if supplied ignores any supplied width/height\r\n   */\r\n  collider?: Collider;\r\n  /**\r\n   * Optionally suppy a [[CollisionGroup]]\r\n   */\r\n  collisionGroup?: CollisionGroup;\r\n}\r\n\r\n/**\r\n * The most important primitive in Excalibur is an `Actor`. Anything that\r\n * can move on the screen, collide with another `Actor`, respond to events,\r\n * or interact with the current scene, must be an actor. An `Actor` **must**\r\n * be part of a [[Scene]] for it to be drawn to the screen.\r\n */\r\nexport class Actor extends Entity implements Eventable, PointerEvents, CanInitialize, CanUpdate, CanDraw, CanBeKilled {\r\n  // #region Properties\r\n\r\n  /**\r\n   * Set defaults for all Actors\r\n   */\r\n  public static defaults = {\r\n    anchor: Vector.Half\r\n  };\r\n\r\n  /**\r\n   * The physics body the is associated with this actor. The body is the container for all physical properties, like position, velocity,\r\n   * acceleration, mass, inertia, etc.\r\n   */\r\n  public get body(): BodyComponent {\r\n    return this.get(BodyComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[TransformComponent]]\r\n   */\r\n  public get transform(): TransformComponent {\r\n    return this.get(TransformComponent);\r\n  }\r\n\r\n  /**\r\n   * Access the Actor's built in [[MotionComponent]]\r\n   */\r\n  public get motion(): MotionComponent {\r\n    return this.get(MotionComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[GraphicsComponent]]\r\n   */\r\n  public get graphics(): GraphicsComponent {\r\n    return this.get(GraphicsComponent);\r\n  }\r\n\r\n  /**\r\n   * Access to the Actor's built in [[ColliderComponent]]\r\n   */\r\n  public get collider(): ColliderComponent {\r\n    return this.get(ColliderComponent);\r\n  }\r\n\r\n  /**\r\n   * Useful for quickly scripting actor behavior, like moving to a place, patroling back and forth, blinking, etc.\r\n   *\r\n   *  Access to the Actor's built in [[ActionsComponent]] which forwards to the\r\n   * [[ActionContext|Action context]] of the actor.\r\n   */\r\n  public get actions(): ActionsComponent {\r\n    return this.get(ActionsComponent);\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor in pixels\r\n   */\r\n  public get pos(): Vector {\r\n    return this.transform.pos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in pixels\r\n   */\r\n  public set pos(thePos: Vector) {\r\n    this.transform.pos = thePos.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the position vector of the actor from the last frame\r\n   */\r\n  public get oldPos(): Vector {\r\n    return this.body.oldPos;\r\n  }\r\n\r\n  /**\r\n   * Sets the position vector of the actor in the last frame\r\n   */\r\n  public set oldPos(thePos: Vector) {\r\n    this.body.oldPos.setTo(thePos.x, thePos.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public get vel(): Vector {\r\n    return this.motion.vel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor in pixels/sec\r\n   */\r\n  public set vel(theVel: Vector) {\r\n    this.motion.vel = theVel.clone();\r\n  }\r\n\r\n  /**\r\n   * Gets the velocity vector of the actor from the last frame\r\n   */\r\n  public get oldVel(): Vector {\r\n    return this.body.oldVel;\r\n  }\r\n\r\n  /**\r\n   * Sets the velocity vector of the actor from the last frame\r\n   */\r\n  public set oldVel(theVel: Vector) {\r\n    this.body.oldVel.setTo(theVel.x, theVel.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration vector of the actor in pixels/second/second. An acceleration pointing down such as (0, 100) may be\r\n   * useful to simulate a gravitational effect.\r\n   */\r\n  public get acc(): Vector {\r\n    return this.motion.acc;\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration vector of teh actor in pixels/second/second\r\n   */\r\n  public set acc(theAcc: Vector) {\r\n    this.motion.acc = theAcc.clone();\r\n  }\r\n\r\n  /**\r\n   * Sets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public set oldAcc(theAcc: Vector) {\r\n    this.body.oldAcc.setTo(theAcc.x, theAcc.y);\r\n  }\r\n\r\n  /**\r\n   * Gets the acceleration of the actor from the last frame. This does not include the global acc [[Physics.acc]].\r\n   */\r\n  public get oldAcc(): Vector {\r\n    return this.body.oldAcc;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public get rotation(): number {\r\n    return this.transform.rotation;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotation of the actor in radians. 1 radian = 180/PI Degrees.\r\n   */\r\n  public set rotation(theAngle: number) {\r\n    this.transform.rotation = theAngle;\r\n  }\r\n\r\n  /**\r\n   * Gets the rotational velocity of the actor in radians/second\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.motion.angularVelocity;\r\n  }\r\n\r\n  /**\r\n   * Sets the rotational velocity of the actor in radians/sec\r\n   */\r\n  public set angularVelocity(angularVelocity: number) {\r\n    this.motion.angularVelocity = angularVelocity;\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this.get(TransformComponent).scale;\r\n  }\r\n\r\n  public set scale(scale: Vector) {\r\n    this.get(TransformComponent).scale = scale;\r\n  }\r\n\r\n  /**\r\n   * The anchor to apply all actor related transformations like rotation,\r\n   * translation, and scaling. By default the anchor is in the center of\r\n   * the actor. By default it is set to the center of the actor (.5, .5)\r\n   *\r\n   * An anchor of (.5, .5) will ensure that drawings are centered.\r\n   *\r\n   * Use `anchor.setTo` to set the anchor to a different point using\r\n   * values between 0 and 1. For example, anchoring to the top-left would be\r\n   * `Actor.anchor.setTo(0, 0)` and top-right would be `Actor.anchor.setTo(0, 1)`.\r\n   */\r\n  private _anchor: Vector = watch(Vector.Half, (v) => this._handleAnchorChange(v));\r\n  public get anchor(): Vector {\r\n    return this._anchor;\r\n  }\r\n\r\n  public set anchor(vec: Vector) {\r\n    this._anchor = watch(vec, (v) => this._handleAnchorChange(v));\r\n    this._handleAnchorChange(vec);\r\n  }\r\n\r\n  private _handleAnchorChange(v: Vector) {\r\n    if (this.graphics) {\r\n      this.graphics.anchor = v;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Indicates whether the actor is physically in the viewport\r\n   */\r\n  public get isOffScreen(): boolean {\r\n    return this.hasTag('offscreen');\r\n  }\r\n  /**\r\n   * The visibility of an actor\r\n   * @deprecated Use [[GraphicsComponent.visible|Actor.graphics.visible]], will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Actor.visible will be removed in v0.26.0', alternateMethod: 'Use Actor.graphics.visible' })\r\n  public get visible(): boolean {\r\n    return this.graphics.visible;\r\n  }\r\n\r\n  public set visible(isVisible: boolean) {\r\n    this.graphics.visible = isVisible;\r\n  }\r\n\r\n  /**\r\n   * The opacity of an actor.\r\n   *\r\n   * @deprecated Actor.opacity will be removed in v0.26.0, use [[GraphicsComponent.opacity|Actor.graphics.opacity]].\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.opacity will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.opacity'\r\n  })\r\n  public get opacity(): number {\r\n    return this.graphics.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this.graphics.opacity = opacity;\r\n  }\r\n\r\n  /**\r\n   * Convenience reference to the global logger\r\n   */\r\n  public logger: Logger = Logger.getInstance();\r\n\r\n  /**\r\n   * The scene that the actor is in\r\n   */\r\n  public scene: Scene = null;\r\n\r\n  public frames: { [key: string]: Drawable } = {};\r\n\r\n  /**\r\n   * Access to the current drawing for the actor, this can be\r\n   * an [[Animation]], [[Sprite]], or [[Polygon]].\r\n   * Set drawings with [[setDrawing]].\r\n   * @deprecated\r\n   */\r\n  public currentDrawing: Drawable = null;\r\n\r\n  /**\r\n   * Draggable helper\r\n   */\r\n  private _draggable: boolean = false;\r\n  private _dragging: boolean = false;\r\n\r\n  private _pointerDragStartHandler = () => {\r\n    this._dragging = true;\r\n  };\r\n\r\n  private _pointerDragEndHandler = () => {\r\n    this._dragging = false;\r\n  };\r\n\r\n  private _pointerDragMoveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.pointer.lastWorldPos;\r\n    }\r\n  };\r\n\r\n  private _pointerDragLeaveHandler = (pe: PointerEvent) => {\r\n    if (this._dragging) {\r\n      this.pos = pe.pointer.lastWorldPos;\r\n    }\r\n  };\r\n\r\n  public get draggable(): boolean {\r\n    return this._draggable;\r\n  }\r\n\r\n  public set draggable(isDraggable: boolean) {\r\n    if (isDraggable) {\r\n      if (isDraggable && !this._draggable) {\r\n        this.on('pointerdragstart', this._pointerDragStartHandler);\r\n        this.on('pointerdragend', this._pointerDragEndHandler);\r\n        this.on('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.on('pointerdragleave', this._pointerDragLeaveHandler);\r\n      } else if (!isDraggable && this._draggable) {\r\n        this.off('pointerdragstart', this._pointerDragStartHandler);\r\n        this.off('pointerdragend', this._pointerDragEndHandler);\r\n        this.off('pointerdragmove', this._pointerDragMoveHandler);\r\n        this.off('pointerdragleave', this._pointerDragLeaveHandler);\r\n      }\r\n\r\n      this._draggable = isDraggable;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Modify the current actor update pipeline.\r\n   */\r\n  public traits: Trait[] = [];\r\n\r\n  /**\r\n   * Sets the color of the actor. A rectangle of this color will be\r\n   * drawn if no [[Drawable]] is specified as the actors drawing.\r\n   *\r\n   * The default is `null` which prevents a rectangle from being drawn.\r\n   */\r\n  public get color(): Color {\r\n    return this._color;\r\n  }\r\n  public set color(v: Color) {\r\n    this._color = v.clone();\r\n  }\r\n  private _color: Color;\r\n\r\n  /**\r\n   * Whether or not to enable the [[Traits.CapturePointer]] trait that propagates\r\n   * pointer events to this actor\r\n   */\r\n  public enableCapturePointer: boolean = false;\r\n\r\n  /**\r\n   * Configuration for [[Traits.CapturePointer]] trait\r\n   */\r\n  public capturePointer: CapturePointerConfig = {\r\n    captureMoveEvents: false,\r\n    captureDragEvents: false\r\n  };\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   *\r\n   * @param config\r\n   */\r\n  constructor(config?: ActorArgs) {\r\n    super();\r\n\r\n    const {\r\n      name,\r\n      x,\r\n      y,\r\n      pos,\r\n      scale,\r\n      width,\r\n      height,\r\n      radius,\r\n      collider,\r\n      vel,\r\n      acc,\r\n      rotation,\r\n      angularVelocity,\r\n      z,\r\n      color,\r\n      visible,\r\n      anchor,\r\n      collisionType,\r\n      collisionGroup\r\n    } = {\r\n      ...config\r\n    };\r\n\r\n    this._setName(name);\r\n    this.anchor = anchor ?? Actor.defaults.anchor.clone();\r\n\r\n    this.addComponent(new TransformComponent());\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.rotation = rotation ?? 0;\r\n    this.scale = scale ?? vec(1, 1);\r\n    this.z = z ?? 0;\r\n\r\n    this.addComponent(new GraphicsComponent());\r\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\r\n    this.addComponent(new MotionComponent());\r\n    this.vel = vel ?? Vector.Zero;\r\n    this.acc = acc ?? Vector.Zero;\r\n    this.angularVelocity = angularVelocity ?? 0;\r\n\r\n    this.addComponent(new ActionsComponent());\r\n\r\n    this.addComponent(new BodyComponent());\r\n    this.body.collisionType = collisionType ?? CollisionType.Passive;\r\n    if (collisionGroup) {\r\n      this.body.group = collisionGroup;\r\n    }\r\n\r\n    if (collider) {\r\n      this.addComponent(new ColliderComponent(collider));\r\n    } else if (radius) {\r\n      this.addComponent(new ColliderComponent(Shape.Circle(radius, this.anchor)));\r\n    } else {\r\n      if (width > 0 && height > 0) {\r\n        this.addComponent(new ColliderComponent(Shape.Box(width, height, this.anchor)));\r\n      } else {\r\n        this.addComponent(new ColliderComponent()); // no collider\r\n      }\r\n    }\r\n\r\n    this.graphics.visible = visible ?? true;\r\n\r\n    if (color) {\r\n      this.color = color;\r\n      if (width && height) {\r\n        this.graphics.add(\r\n          new Rectangle({\r\n            color: color,\r\n            width,\r\n            height\r\n          })\r\n        );\r\n      } else if (radius) {\r\n        this.graphics.add(\r\n          new Circle({\r\n            color: color,\r\n            radius\r\n          })\r\n        );\r\n      }\r\n    }\r\n\r\n    // Build default pipeline\r\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\r\n      // TODO remove offscreen trait after legacy drawing removed\r\n      this.traits.push(new Traits.OffscreenCulling());\r\n    }\r\n    this.traits.push(new Traits.CapturePointer());\r\n\r\n  }\r\n\r\n  /**\r\n   * `onInitialize` is called before the first update of the actor. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   *\r\n   * Synonymous with the event handler `.on('initialize', (evt) => {...})`\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Initializes this actor and all it's child actors, meant to be called by the Scene before first update not by users of Excalibur.\r\n   *\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    for (const child of this.children) {\r\n      child._initialize(engine);\r\n    }\r\n  }\r\n\r\n  // #region Events\r\n\r\n  private _capturePointerEvents: PointerEventName[] = [\r\n    'pointerup',\r\n    'pointerdown',\r\n    'pointermove',\r\n    'pointerenter',\r\n    'pointerleave',\r\n    'pointerdragstart',\r\n    'pointerdragend',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _captureMoveEvents: PointerEventName[] = [\r\n    'pointermove',\r\n    'pointerenter',\r\n    'pointerleave',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _captureDragEvents: PointerEventName[] = [\r\n    'pointerdragstart',\r\n    'pointerdragend',\r\n    'pointerdragmove',\r\n    'pointerdragenter',\r\n    'pointerdragleave'\r\n  ];\r\n\r\n  private _checkForPointerOptIn(eventName: string) {\r\n    if (eventName) {\r\n      const normalized = <PointerEventName>eventName.toLowerCase();\r\n\r\n      if (this._capturePointerEvents.indexOf(normalized) !== -1) {\r\n        this.enableCapturePointer = true;\r\n\r\n        if (this._captureMoveEvents.indexOf(normalized) !== -1) {\r\n          this.capturePointer.captureMoveEvents = true;\r\n        }\r\n\r\n        if (this._captureDragEvents.indexOf(normalized) !== -1) {\r\n          this.capturePointer.captureDragEvents = true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public on(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public on(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touched a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public on(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public on(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public on(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public on(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public on(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public on(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public on(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public on(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\r\n  public on(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public on(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    this._checkForPointerOptIn(eventName);\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.exittrigger, handler: (event: ExitTriggerEvent) => void): void;\r\n  public once(eventName: Events.entertrigger, handler: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public once(eventName: Events.collisionstart, handler: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public once(eventName: Events.collisionend, handler: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public once(eventName: Events.precollision, handler: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public once(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public once(eventName: Events.kill, handler: (event: KillEvent) => void): void;\r\n  public once(eventName: Events.postkill, handler: (event: PostKillEvent) => void): void;\r\n  public once(eventName: Events.prekill, handler: (event: PreKillEvent) => void): void;\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Actor>) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Actor>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.pointerup, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerdown, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerenter, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerleave, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointermove, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointercancel, handler: (event: PointerEvent) => void): void;\r\n  public once(eventName: Events.pointerwheel, handler: (event: WheelEvent) => void): void;\r\n  public once(eventName: Events.pointerdragstart, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragend, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragenter, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragleave, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.pointerdragmove, handler: (event: PointerDragEvent) => void): void;\r\n  public once(eventName: Events.enterviewport, handler: (event: EnterViewPortEvent) => void): void;\r\n  public once(eventName: Events.exitviewport, handler: (event: ExitViewPortEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Actor>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    this._checkForPointerOptIn(eventName);\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.exittrigger, handler?: (event: ExitTriggerEvent) => void): void;\r\n  public off(eventName: Events.entertrigger, handler?: (event: EnterTriggerEvent) => void): void;\r\n  /**\r\n   * The **collisionstart** event is fired when a [[BodyComponent|physics body]], usually attached to an actor,\r\n   *  first starts colliding with another [[BodyComponent|body]], and will not fire again while in contact until\r\n   *  the the pair separates and collides again.\r\n   * Use cases for the **collisionstart** event may be detecting when an actor has touch a surface\r\n   * (like landing) or if a item has been touched and needs to be picked up.\r\n   */\r\n  public off(eventName: Events.collisionstart, handler?: (event: CollisionStartEvent) => void): void;\r\n  /**\r\n   * The **collisionend** event is fired when two [[BodyComponent|physics bodies]] are no longer in contact.\r\n   * This event will not fire again until another collision and separation.\r\n   *\r\n   * Use cases for the **collisionend** event might be to detect when an actor has left a surface\r\n   * (like jumping) or has left an area.\r\n   */\r\n  public off(eventName: Events.collisionend, handler?: (event: CollisionEndEvent) => void): void;\r\n  /**\r\n   * The **precollision** event is fired **every frame** where a collision pair is found and two\r\n   * bodies are intersecting.\r\n   *\r\n   * This event is useful for building in custom collision resolution logic in Passive-Passive or\r\n   * Active-Passive scenarios. For example in a breakout game you may want to tweak the angle of\r\n   * ricochet of the ball depending on which side of the paddle you hit.\r\n   */\r\n  public off(eventName: Events.precollision, handler?: (event: PreCollisionEvent) => void): void;\r\n  /**\r\n   * The **postcollision** event is fired for **every frame** where collision resolution was performed.\r\n   * Collision resolution is when two bodies influence each other and cause a response like bouncing\r\n   * off one another. It is only possible to have *postcollision* event in Active-Active and Active-Fixed\r\n   * type collision pairs.\r\n   *\r\n   * Post collision would be useful if you need to know that collision resolution is happening or need to\r\n   * tweak the default resolution.\r\n   */\r\n  public off(eventName: Events.postcollision, handler: (event: PostCollisionEvent) => void): void;\r\n  public off(eventName: Events.pointerup, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerdown, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerenter, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerleave, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointermove, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointercancel, handler?: (event: PointerEvent) => void): void;\r\n  public off(eventName: Events.pointerwheel, handler?: (event: WheelEvent) => void): void;\r\n  public off(eventName: Events.pointerdragstart, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragend, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragenter, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragleave, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.pointerdragmove, handler?: (event: PointerDragEvent) => void): void;\r\n  public off(eventName: Events.prekill, handler?: (event: PreKillEvent) => void): void;\r\n  public off(eventName: Events.postkill, handler?: (event: PostKillEvent) => void): void;\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<Actor>) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  public off(eventName: Events.enterviewport, handler?: (event: EnterViewPortEvent) => void): void;\r\n  public off(eventName: Events.exitviewport, handler?: (event: ExitViewPortEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<Actor>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPreKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _prekill(_scene: Scene) {\r\n    super.emit('prekill', new PreKillEvent(this));\r\n    this.onPreKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreKill lifecycle event handler. Synonymous with `.on('prekill', (evt) =>{...})`\r\n   *\r\n   * `onPreKill` is called directly before an actor is killed and removed from its current [[Scene]].\r\n   */\r\n  public onPreKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _prekill handler for [[onPostKill]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postkill(_scene: Scene) {\r\n    super.emit('postkill', new PostKillEvent(this));\r\n    this.onPostKill(_scene);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostKill lifecycle event handler. Synonymous with `.on('postkill', (evt) => {...})`\r\n   *\r\n   * `onPostKill` is called directly after an actor is killed and remove from its current [[Scene]].\r\n   */\r\n  public onPostKill(_scene: Scene) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If the current actor is a member of the scene, this will remove\r\n   * it from the scene graph. It will no longer be drawn or updated.\r\n   */\r\n  public kill() {\r\n    if (this.scene) {\r\n      this._prekill(this.scene);\r\n      this.emit('kill', new KillEvent(this));\r\n      super.kill();\r\n      this._postkill(this.scene);\r\n    } else {\r\n      this.logger.warn('Cannot kill actor, it was never added to the Scene');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the current actor is killed, it will now not be killed.\r\n   */\r\n  public unkill() {\r\n    this.active = true;\r\n  }\r\n\r\n  /**\r\n   * Indicates wether the actor has been killed.\r\n   */\r\n  public isKilled(): boolean {\r\n    return !this.active;\r\n  }\r\n\r\n  /**\r\n   * Sets the current drawing of the actor to the drawing corresponding to\r\n   * the key.\r\n   * @param key The key of the drawing\r\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\r\n   */\r\n  public setDrawing(key: string): void;\r\n  /**\r\n   * Sets the current drawing of the actor to the drawing corresponding to\r\n   * an `enum` key (e.g. `Animations.Left`)\r\n   * @param key The `enum` key of the drawing\r\n   * @deprecated Use [[GraphicsComponent.show|Actor.graphics.show]] or [[GraphicsComponent.use|Actor.graphics.use]]\r\n   */\r\n  public setDrawing(key: number): void;\r\n  @obsolete({\r\n    message: 'Actor.setDrawing will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.show() or Actor.graphics.use()'\r\n  })\r\n  public setDrawing(key: any): void {\r\n    key = key.toString();\r\n    if (this.currentDrawing !== this.frames[<string>key]) {\r\n      if (this.frames[key] != null) {\r\n        this.frames[key].reset();\r\n        this.currentDrawing = this.frames[key];\r\n      } else {\r\n        Logger.getInstance().error(`the specified drawing key ${key} does not exist`);\r\n      }\r\n    }\r\n    if (this.currentDrawing && this.currentDrawing instanceof Animation) {\r\n      this.currentDrawing.tick(0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a whole texture as the \"default\" drawing. Set a drawing using [[setDrawing]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(texture: Texture): void;\r\n  /**\r\n   * Adds a whole sprite as the \"default\" drawing. Set a drawing using [[setDrawing]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(sprite: Sprite): void;\r\n  /**\r\n   * Adds a drawing to the list of available drawings for an actor. Set a drawing using [[setDrawing]].\r\n   * @param key     The key to associate with a drawing for this actor\r\n   * @param drawing This can be an [[Animation]], [[Sprite]], or [[Polygon]].\r\n   * @deprecated Use [[GraphicsComponent.add|Actor.graphics.add]]\r\n   */\r\n  public addDrawing(key: any, drawing: Drawable): void;\r\n  @obsolete({\r\n    message: 'Actor.addDrawing will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.graphics.add()'\r\n  })\r\n  public addDrawing(): void {\r\n    if (arguments.length === 2) {\r\n      this.frames[<string>arguments[0]] = arguments[1];\r\n      if (!this.currentDrawing) {\r\n        this.currentDrawing = arguments[1];\r\n      }\r\n    } else {\r\n      if (arguments[0] instanceof Sprite) {\r\n        this.addDrawing('default', arguments[0]);\r\n      }\r\n      if (arguments[0] instanceof Texture) {\r\n        this.addDrawing('default', arguments[0].asSprite());\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the z-index of an actor. The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   */\r\n  public get z(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use [[Actor.z]]\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.getZIndex will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\r\n  })\r\n  public getZIndex(): number {\r\n    return this.get(TransformComponent).z;\r\n  }\r\n\r\n  /**\r\n   * Sets the z-index of an actor and updates it in the drawing list for the scene.\r\n   * The z-index determines the relative order an actor is drawn in.\r\n   * Actors with a higher z-index are drawn on top of actors with a lower z-index\r\n   * @param newZ new z-index to assign\r\n   */\r\n  public set z(newZ: number) {\r\n    this.get(TransformComponent).z = newZ;\r\n  }\r\n\r\n  /**\r\n   * @param newIndex new z-index to assign\r\n   * @deprecated Use [[Actor.z]]\r\n   */\r\n  @obsolete({\r\n    message: 'Actor.setZIndex will be removed in v0.26.0',\r\n    alternateMethod: 'Use Actor.transform.z or Actor.z'\r\n  })\r\n  public setZIndex(newIndex: number) {\r\n    this.get(TransformComponent).z = newIndex;\r\n  }\r\n\r\n  /**\r\n   * Get the center point of an actor\r\n   */\r\n  public get center(): Vector {\r\n    return new Vector(this.pos.x + this.width / 2 - this.anchor.x * this.width, this.pos.y + this.height / 2 - this.anchor.y * this.height);\r\n  }\r\n\r\n  public get width() {\r\n    return this.collider.localBounds.width * this.getGlobalScale().x;\r\n  }\r\n\r\n  public get height() {\r\n    return this.collider.localBounds.height * this.getGlobalScale().y;\r\n  }\r\n\r\n  /**\r\n   * Gets this actor's rotation taking into account any parent relationships\r\n   *\r\n   * @returns Rotation angle in radians\r\n   */\r\n  public getGlobalRotation(): number {\r\n    return this.get(TransformComponent).globalRotation;\r\n  }\r\n\r\n  /**\r\n   * Gets an actor's world position taking into account parent relationships, scaling, rotation, and translation\r\n   *\r\n   * @returns Position in world coordinates\r\n   */\r\n  public getGlobalPos(): Vector {\r\n    return this.get(TransformComponent).globalPos;\r\n  }\r\n\r\n  /**\r\n   * Gets the global scale of the Actor\r\n   */\r\n  public getGlobalScale(): Vector {\r\n    return this.get(TransformComponent).globalScale;\r\n  }\r\n\r\n  // #region Collision\r\n\r\n  /**\r\n   * Tests whether the x/y specified are contained in the actor\r\n   * @param x  X coordinate to test (in world coordinates)\r\n   * @param y  Y coordinate to test (in world coordinates)\r\n   * @param recurse checks whether the x/y are contained in any child actors (if they exist).\r\n   */\r\n  public contains(x: number, y: number, recurse: boolean = false): boolean {\r\n    const point = vec(x, y);\r\n    const collider = this.get(ColliderComponent);\r\n    collider.update();\r\n    const geom = collider.get();\r\n    if (!geom) {\r\n      return false;\r\n    }\r\n    const containment = geom.contains(point);\r\n\r\n    if (recurse) {\r\n      return (\r\n        containment ||\r\n        this.children.some((child: Actor) => {\r\n          return child.contains(x, y, true);\r\n        })\r\n      );\r\n    }\r\n\r\n    return containment;\r\n  }\r\n\r\n  /**\r\n   * Returns true if the two actor.collider's surfaces are less than or equal to the distance specified from each other\r\n   * @param actor     Actor to test\r\n   * @param distance  Distance in pixels to test\r\n   */\r\n  public within(actor: Actor, distance: number): boolean {\r\n    const collider = this.get(ColliderComponent);\r\n    const otherCollider = actor.get(ColliderComponent);\r\n    const me = collider.get();\r\n    const other = otherCollider.get();\r\n    if (me && other) {\r\n      return me.getClosestLineBetween(other).getLength() <= distance;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Update\r\n\r\n  /**\r\n   * Called by the Engine, updates the state of the actor\r\n   * @internal\r\n   * @param engine The reference to the current game engine\r\n   * @param delta  The time elapsed since the last update in milliseconds\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._initialize(engine);\r\n    this._preupdate(engine, delta);\r\n\r\n    // Tick animations\r\n    const drawing = this.currentDrawing;\r\n    if (drawing && drawing instanceof Animation) {\r\n      drawing.tick(delta, engine.stats.currFrame.id);\r\n    }\r\n\r\n    // Update actor pipeline (movement, collision detection, event propagation, offscreen culling)\r\n    for (const trait of this.traits) {\r\n      trait.update(this, engine, delta);\r\n    }\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before an actor is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('postupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after an actor is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  // endregion\r\n\r\n  // #region Drawing\r\n  /**\r\n   * Called by the Engine, draws the actor to the screen\r\n   * @param ctx   The rendering context\r\n   * @param delta The time since the last draw in milliseconds\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics, will be removed in v0.26.0\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n    // translate canvas by anchor offset\r\n    ctx.save();\r\n\r\n    if (this.currentDrawing) {\r\n      ctx.translate(-(this.width * this.anchor.x), -(this.height * this.anchor.y));\r\n\r\n      this._predraw(ctx, delta);\r\n      const drawing = this.currentDrawing;\r\n      // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n      const offsetX = (this.width - drawing.width * drawing.scale.x) * this.anchor.x;\r\n      const offsetY = (this.height - drawing.height * drawing.scale.y) * this.anchor.y;\r\n\r\n      this.currentDrawing.draw({ ctx, x: offsetX, y: offsetY, opacity: this.graphics.opacity });\r\n    } else {\r\n      this._predraw(ctx, delta);\r\n      if (this.color && this.collider) {\r\n        // update collider geometry based on transform\r\n        const collider = this.get(ColliderComponent);\r\n        collider.update();\r\n        if (collider && !collider.bounds.hasZeroDimensions()) {\r\n          // Colliders are already shifted by anchor, unshift\r\n          ctx.globalAlpha = this.graphics.opacity;\r\n          collider.get()?.draw(ctx, this.color, vec(0, 0));\r\n        }\r\n      }\r\n    }\r\n    ctx.restore();\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('predraw', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before an actor is drawn, but after local transforms are made.\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   */\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('postdraw', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after an actor is drawn, and before local transforms are removed.\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   */\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPreDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  public _predraw(ctx: CanvasRenderingContext2D, delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(ctx, delta, this));\r\n    this.onPreDraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  public _postdraw(ctx: CanvasRenderingContext2D, delta: number): void {\r\n    this.emit('postdraw', new PreDrawEvent(ctx, delta, this));\r\n    this.onPostDraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Called by the Engine, draws the actors debugging to the screen\r\n   * @param ctx The rendering context\r\n   *\r\n   *\r\n   * **Warning** only works with Flags.useLegacyDrawing() enabled\r\n   * @deprecated Use Actor.graphics.onPostDraw, will be removed in v0.26.0\r\n   * @internal\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n  // #endregion\r\n}\r\n","import { Vector, vec } from './Math/vector';\r\nimport { Engine } from './Engine';\r\nimport { Actor, ActorArgs } from './Actor';\r\nimport * as Traits from './Traits/Index';\r\nimport { CoordPlane, TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\n\r\n/**\r\n * Helper [[Actor]] primitive for drawing UI's, optimized for UI drawing. Does\r\n * not participate in collisions. Drawn on top of all other actors.\r\n */\r\nexport class ScreenElement extends Actor {\r\n  protected _engine: Engine;\r\n\r\n  constructor();\r\n  constructor(config?: ActorArgs);\r\n\r\n  constructor(config?: ActorArgs) {\r\n    super({ ...config });\r\n    this.get(TransformComponent).coordPlane = CoordPlane.Screen;\r\n    this.traits = [];\r\n    this.traits.push(new Traits.CapturePointer());\r\n    this.anchor = vec(0, 0);\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n    this.collider.useBoxCollider(this.width, this.height, this.anchor);\r\n    this.enableCapturePointer = true;\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    this._engine = engine;\r\n    super._initialize(engine);\r\n  }\r\n\r\n  public contains(x: number, y: number, useWorld: boolean = true) {\r\n    if (useWorld) {\r\n      return super.contains(x, y);\r\n    }\r\n\r\n    const coords = this._engine.worldToScreenCoordinates(new Vector(x, y));\r\n    return super.contains(coords.x, coords.y);\r\n  }\r\n}\r\n","import { Scene } from './Scene';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { Logger } from './Util/Log';\r\n\r\nexport interface TimerOptions {\r\n  repeats?: boolean;\r\n  numberOfRepeats?: number;\r\n  fcn?: () => void;\r\n  interval: number;\r\n}\r\n\r\n/**\r\n * The Excalibur timer hooks into the internal timer and fires callbacks,\r\n * after a certain interval, optionally repeating.\r\n */\r\nexport class Timer {\r\n  private _logger = Logger.getInstance();\r\n  private static _MAX_ID: number = 0;\r\n  public id: number = 0;\r\n\r\n  private _elapsedTime: number = 0;\r\n  private _totalTimeAlive: number = 0;\r\n\r\n  private _running = false;\r\n\r\n  private _numberOfTicks: number = 0;\r\n  private _callbacks: Array<() => void>;\r\n\r\n  public interval: number = 10;\r\n  public repeats: boolean = false;\r\n  public maxNumberOfRepeats: number = -1;\r\n\r\n  private _complete = false;\r\n  public get complete() {\r\n    return this._complete;\r\n  }\r\n  public scene: Scene = null;\r\n\r\n  /**\r\n   * @param options    Options - repeats, numberOfRepeats, fcn, interval\r\n   * @param repeats    Indicates whether this call back should be fired only once, or repeat after every interval as completed.\r\n   * @param numberOfRepeats Specifies a maximum number of times that this timer will execute.\r\n   * @param fcn        The callback to be fired after the interval is complete.\r\n   */\r\n  constructor(options: TimerOptions);\r\n  constructor(fcn: TimerOptions | (() => void), interval?: number, repeats?: boolean, numberOfRepeats?: number) {\r\n    if (typeof fcn !== 'function') {\r\n      const options = fcn;\r\n      fcn = options.fcn;\r\n      interval = options.interval;\r\n      repeats = options.repeats;\r\n      numberOfRepeats = options.numberOfRepeats;\r\n    }\r\n\r\n    if (!!numberOfRepeats && numberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = numberOfRepeats;\r\n      if (!repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this.id = Timer._MAX_ID++;\r\n    this.interval = interval || this.interval;\r\n    this.repeats = repeats || this.repeats;\r\n\r\n    this._callbacks = [];\r\n\r\n    if (fcn) {\r\n      this.on(fcn);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a new callback to be fired after the interval is complete\r\n   * @param fcn The callback to be added to the callback list, to be fired after the interval is complete.\r\n   */\r\n  public on(fcn: () => void) {\r\n    this._callbacks.push(fcn);\r\n  }\r\n\r\n  /**\r\n   * Removes a callback from the callback list to be fired after the interval is complete.\r\n   * @param fcn The callback to be removed from the callback list, to be fired after the interval is complete.\r\n   */\r\n  public off(fcn: () => void) {\r\n    const index = this._callbacks.indexOf(fcn);\r\n    this._callbacks.splice(index, 1);\r\n  }\r\n\r\n  /**\r\n   * Updates the timer after a certain number of milliseconds have elapsed. This is used internally by the engine.\r\n   * @param delta  Number of elapsed milliseconds since the last update.\r\n   */\r\n  public update(delta: number) {\r\n    if (this._running) {\r\n      this._totalTimeAlive += delta;\r\n      this._elapsedTime += delta;\r\n\r\n      if (this.maxNumberOfRepeats > -1 && this._numberOfTicks >= this.maxNumberOfRepeats) {\r\n        this._complete = true;\r\n        this._running = false;\r\n        this._elapsedTime = 0;\r\n      }\r\n\r\n      if (!this.complete && this._elapsedTime >= this.interval) {\r\n        this._callbacks.forEach((c) => {\r\n          c.call(this);\r\n        });\r\n\r\n        this._numberOfTicks++;\r\n        if (this.repeats) {\r\n          this._elapsedTime = 0;\r\n        } else {\r\n          this._complete = true;\r\n          this._running = false;\r\n          this._elapsedTime = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the timer so that it can be reused, and optionally reconfigure the timers interval.\r\n   *\r\n   * Warning** you may need to call `timer.start()` again if the timer had completed\r\n   * @param newInterval If specified, sets a new non-negative interval in milliseconds to refire the callback\r\n   * @param newNumberOfRepeats If specified, sets a new non-negative upper limit to the number of time this timer executes\r\n   */\r\n  public reset(newInterval?: number, newNumberOfRepeats?: number) {\r\n    if (!!newInterval && newInterval >= 0) {\r\n      this.interval = newInterval;\r\n    }\r\n\r\n    if (!!this.maxNumberOfRepeats && this.maxNumberOfRepeats >= 0) {\r\n      this.maxNumberOfRepeats = newNumberOfRepeats;\r\n      if (!this.repeats) {\r\n        throw new Error('repeats must be set to true if numberOfRepeats is set');\r\n      }\r\n    }\r\n\r\n    this._complete = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n  }\r\n\r\n  public get timesRepeated(): number {\r\n    return this._numberOfTicks;\r\n  }\r\n\r\n  public getTimeRunning(): number {\r\n    return this._totalTimeAlive;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds until the next action callback, if complete will return 0\r\n   */\r\n  public get timeToNextAction() {\r\n    if (this.complete) {\r\n      return 0;\r\n    }\r\n    return this.interval - this._elapsedTime;\r\n  }\r\n\r\n  /**\r\n   * @returns milliseconds elapsed toward the next action\r\n   */\r\n  public get timeElapsedTowardNextAction() {\r\n    return this._elapsedTime;\r\n  }\r\n\r\n  public get isRunning() {\r\n    return this._running;\r\n  }\r\n\r\n  /**\r\n   * Pauses the timer, time will no longer increment towards the next call\r\n   */\r\n  public pause(): Timer {\r\n    this._running = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Unpauses the timer. Time will now increment towards the next call\r\n   * @deprecated Will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'Use Timer.resume()' })\r\n  public unpause() {\r\n    this._running = true;\r\n  }\r\n\r\n  /**\r\n   * Resumes the timer, time will now increment towards the next call.\r\n   */\r\n  public resume(): Timer {\r\n    this._running = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Starts the timer, if the timer was complete it will restart the timer and reset the elapsed time counter\r\n   */\r\n  public start(): Timer {\r\n    if (!this.scene) {\r\n      this._logger.warn('Cannot start a timer not part of a scene, timer wont start until added');\r\n    }\r\n\r\n    this._running = true;\r\n    if (this.complete) {\r\n      this._complete = false;\r\n      this._elapsedTime = 0;\r\n      this._numberOfTicks = 0;\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Stops the timer and resets the elapsed time counter towards the next action invocation\r\n   */\r\n  public stop(): Timer {\r\n    this._running = false;\r\n    this._elapsedTime = 0;\r\n    this._numberOfTicks = 0;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Cancels the timer, preventing any further executions.\r\n   */\r\n  public cancel() {\r\n    this.pause();\r\n    if (this.scene) {\r\n      this.scene.cancelTimer(this);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { EasingFunction, EasingFunctions } from './Util/EasingFunctions';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Actor } from './Actor';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { CanUpdate, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { PreUpdateEvent, PostUpdateEvent, GameEvent, InitializeEvent } from './Events';\r\nimport { Class } from './Class';\r\nimport { BoundingBox } from './Collision/BoundingBox';\r\nimport { Logger } from './Util/Log';\r\nimport { ExcaliburGraphicsContext } from './Graphics/Context/ExcaliburGraphicsContext';\r\nimport { watchAny } from './Util/Watch';\r\n\r\n/**\r\n * Interface that describes a custom camera strategy for tracking targets\r\n */\r\nexport interface CameraStrategy<T> {\r\n  /**\r\n   * Target of the camera strategy that will be passed to the action\r\n   */\r\n  target: T;\r\n\r\n  /**\r\n   * Camera strategies perform an action to calculate a new focus returned out of the strategy\r\n   * @param target The target object to apply this camera strategy (if any)\r\n   * @param camera The current camera implementation in excalibur running the game\r\n   * @param engine The current engine running the game\r\n   * @param delta The elapsed time in milliseconds since the last frame\r\n   */\r\n  action: (target: T, camera: Camera, engine: Engine, delta: number) => Vector;\r\n}\r\n\r\n/**\r\n * Container to house convenience strategy methods\r\n * @internal\r\n */\r\nexport class StrategyContainer {\r\n  constructor(public camera: Camera) {}\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorStrategy]] on the current camera.\r\n   * @param actor The actor to lock the camera to\r\n   */\r\n  public lockToActor(actor: Actor) {\r\n    this.camera.addStrategy(new LockCameraToActorStrategy(actor));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LockCameraToActorAxisStrategy]] on the current camera\r\n   * @param actor The actor to lock the camera to\r\n   * @param axis The axis to follow the actor on\r\n   */\r\n  public lockToActorAxis(actor: Actor, axis: Axis) {\r\n    this.camera.addStrategy(new LockCameraToActorAxisStrategy(actor, axis));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[ElasticToActorStrategy]] on the current camera\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param actor Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  public elasticToActor(actor: Actor, cameraElasticity: number, cameraFriction: number) {\r\n    this.camera.addStrategy(new ElasticToActorStrategy(actor, cameraElasticity, cameraFriction));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[RadiusAroundActorStrategy]] on the current camera\r\n   * @param actor Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  public radiusAroundActor(actor: Actor, radius: number) {\r\n    this.camera.addStrategy(new RadiusAroundActorStrategy(actor, radius));\r\n  }\r\n\r\n  /**\r\n   * Creates and adds the [[LimitCameraBoundsStrategy]] on the current camera\r\n   * @param box The bounding box to limit the camera to.\r\n   */\r\n  public limitCameraBounds(box: BoundingBox) {\r\n    this.camera.addStrategy(new LimitCameraBoundsStrategy(box));\r\n  }\r\n}\r\n\r\n/**\r\n * Camera axis enum\r\n */\r\nexport enum Axis {\r\n  X,\r\n  Y\r\n}\r\n\r\n/**\r\n * Lock a camera to the exact x/y position of an actor.\r\n */\r\nexport class LockCameraToActorStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor) {}\r\n  public action = (target: Actor, _cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    return center;\r\n  };\r\n}\r\n\r\n/**\r\n * Lock a camera to a specific axis around an actor.\r\n */\r\nexport class LockCameraToActorAxisStrategy implements CameraStrategy<Actor> {\r\n  constructor(public target: Actor, public axis: Axis) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const center = target.center;\r\n    const currentFocus = cam.getFocus();\r\n    if (this.axis === Axis.X) {\r\n      return new Vector(center.x, currentFocus.y);\r\n    } else {\r\n      return new Vector(currentFocus.x, center.y);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Using [Hook's law](https://en.wikipedia.org/wiki/Hooke's_law), elastically move the camera towards the target actor.\r\n */\r\nexport class ElasticToActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   * If cameraElasticity < cameraFriction < 1.0, the behavior will be a dampened spring that will slowly end at the target without bouncing\r\n   * If cameraFriction < cameraElasticity < 1.0, the behavior will be an oscillating spring that will over\r\n   * correct and bounce around the target\r\n   *\r\n   * @param target Target actor to elastically follow\r\n   * @param cameraElasticity [0 - 1.0] The higher the elasticity the more force that will drive the camera towards the target\r\n   * @param cameraFriction [0 - 1.0] The higher the friction the more that the camera will resist motion towards the target\r\n   */\r\n  constructor(public target: Actor, public cameraElasticity: number, public cameraFriction: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    let focus = cam.getFocus();\r\n    let cameraVel = cam.vel.clone();\r\n\r\n    // Calculate the stretch vector, using the spring equation\r\n    // F = kX\r\n    // https://en.wikipedia.org/wiki/Hooke's_law\r\n    // Apply to the current camera velocity\r\n    const stretch = position.sub(focus).scale(this.cameraElasticity); // stretch is X\r\n    cameraVel = cameraVel.add(stretch);\r\n\r\n    // Calculate the friction (-1 to apply a force in the opposition of motion)\r\n    // Apply to the current camera velocity\r\n    const friction = cameraVel.scale(-1).scale(this.cameraFriction);\r\n    cameraVel = cameraVel.add(friction);\r\n\r\n    // Update position by velocity deltas\r\n    focus = focus.add(cameraVel);\r\n\r\n    return focus;\r\n  };\r\n}\r\n\r\nexport class RadiusAroundActorStrategy implements CameraStrategy<Actor> {\r\n  /**\r\n   *\r\n   * @param target Target actor to follow when it is \"radius\" pixels away\r\n   * @param radius Number of pixels away before the camera will follow\r\n   */\r\n  constructor(public target: Actor, public radius: number) {}\r\n  public action = (target: Actor, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const position = target.center;\r\n    const focus = cam.getFocus();\r\n\r\n    const direction = position.sub(focus);\r\n    const distance = direction.size;\r\n    if (distance >= this.radius) {\r\n      const offset = distance - this.radius;\r\n      return focus.add(direction.normalize().scale(offset));\r\n    }\r\n    return focus;\r\n  };\r\n}\r\n\r\n/**\r\n * Prevent a camera from going beyond the given camera dimensions.\r\n */\r\nexport class LimitCameraBoundsStrategy implements CameraStrategy<BoundingBox> {\r\n  /**\r\n   * Useful for limiting the camera to a [[TileMap]]'s dimensions, or a specific area inside the map.\r\n   *\r\n   * Note that this strategy does not perform any movement by itself.\r\n   * It only sets the camera position to within the given bounds when the camera has gone beyond them.\r\n   * Thus, it is a good idea to combine it with other camera strategies and set this strategy as the last one.\r\n   *\r\n   * Make sure that the camera bounds are at least as large as the viewport size.\r\n   *\r\n   * @param target The bounding box to limit the camera to\r\n   */\r\n\r\n  boundSizeChecked: boolean = false; // Check and warn only once\r\n\r\n  constructor(public target: BoundingBox) {}\r\n\r\n  public action = (target: BoundingBox, cam: Camera, _eng: Engine, _delta: number) => {\r\n    const focus = cam.getFocus();\r\n\r\n    if (!this.boundSizeChecked) {\r\n      if (target.bottom - target.top < _eng.drawHeight || target.right - target.left < _eng.drawWidth) {\r\n        Logger.getInstance().warn('Camera bounds should not be smaller than the engine viewport');\r\n      }\r\n      this.boundSizeChecked = true;\r\n    }\r\n\r\n    let focusX = focus.x;\r\n    let focusY = focus.y;\r\n    if (focus.x < target.left + _eng.halfDrawWidth) {\r\n      focusX = target.left + _eng.halfDrawWidth;\r\n    } else if (focus.x > target.right - _eng.halfDrawWidth) {\r\n      focusX = target.right - _eng.halfDrawWidth;\r\n    }\r\n\r\n    if (focus.y < target.top + _eng.halfDrawHeight) {\r\n      focusY = target.top + _eng.halfDrawHeight;\r\n    } else if (focus.y > target.bottom - _eng.halfDrawHeight) {\r\n      focusY = target.bottom - _eng.halfDrawHeight;\r\n    }\r\n\r\n    return vec(focusX, focusY);\r\n  };\r\n}\r\n\r\n/**\r\n * Cameras\r\n *\r\n * [[Camera]] is the base class for all Excalibur cameras. Cameras are used\r\n * to move around your game and set focus. They are used to determine\r\n * what is \"off screen\" and can be used to scale the game.\r\n *\r\n */\r\nexport class Camera extends Class implements CanUpdate, CanInitialize {\r\n  protected _follow: Actor;\r\n\r\n  private _cameraStrategies: CameraStrategy<any>[] = [];\r\n\r\n  public strategy: StrategyContainer = new StrategyContainer(this);\r\n\r\n  /**\r\n   * Get or set current zoom of the camera, defaults to 1\r\n   */\r\n  private _z = 1;\r\n  public get zoom(): number {\r\n    return this._z;\r\n  }\r\n\r\n  public set zoom(val: number) {\r\n    this._z = val;\r\n    if (this._engine) {\r\n      this._halfWidth = this._engine.halfDrawWidth;\r\n      this._halfHeight = this._engine.halfDrawHeight;\r\n    }\r\n  }\r\n  /**\r\n   * Get or set rate of change in zoom, defaults to 0\r\n   */\r\n  public dz: number = 0;\r\n  /**\r\n   * Get or set zoom acceleration\r\n   */\r\n  public az: number = 0;\r\n\r\n  /**\r\n   * Current rotation of the camera\r\n   */\r\n  public rotation: number = 0;\r\n\r\n  /**\r\n   * Current angular velocity\r\n   */\r\n  public rx: number = 0;\r\n\r\n  /**\r\n   * Get or set the camera's angular velocity\r\n   */\r\n  public get angularVelocity(): number {\r\n    return this.rx;\r\n  }\r\n\r\n  public set angularVelocity(value: number) {\r\n    this.rx = value;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's position\r\n   */\r\n  private _posChanged = false;\r\n  private _pos: Vector = watchAny(Vector.Zero, () => (this._posChanged = true));\r\n  public get pos(): Vector {\r\n    return this._pos;\r\n  }\r\n  public set pos(vec: Vector) {\r\n    this._pos = watchAny(vec, () => (this._posChanged = true));\r\n    this._posChanged = true;\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's velocity\r\n   */\r\n  public vel: Vector = Vector.Zero;\r\n\r\n  /**\r\n   * GEt or set the camera's acceleration\r\n   */\r\n  public acc: Vector = Vector.Zero;\r\n\r\n  private _cameraMoving: boolean = false;\r\n  private _currentLerpTime: number = 0;\r\n  private _lerpDuration: number = 1000; // 1 second\r\n  private _lerpStart: Vector = null;\r\n  private _lerpEnd: Vector = null;\r\n  private _lerpResolve: (value: Vector) => void;\r\n  private _lerpPromise: Promise<Vector>;\r\n\r\n  //camera effects\r\n  protected _isShaking: boolean = false;\r\n  private _shakeMagnitudeX: number = 0;\r\n  private _shakeMagnitudeY: number = 0;\r\n  private _shakeDuration: number = 0;\r\n  private _elapsedShakeTime: number = 0;\r\n  private _xShake: number = 0;\r\n  private _yShake: number = 0;\r\n\r\n  protected _isZooming: boolean = false;\r\n  private _zoomStart: number = 1;\r\n  private _zoomEnd: number = 1;\r\n  private _currentZoomTime: number = 0;\r\n  private _zoomDuration: number = 0;\r\n\r\n  private _zoomResolve: (val: boolean) => void;\r\n  private _zoomPromise: Promise<boolean>;\r\n  private _zoomEasing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n  private _easing: EasingFunction = EasingFunctions.EaseInOutCubic;\r\n\r\n  private _halfWidth: number = 0;\r\n  private _halfHeight: number = 0;\r\n\r\n  /**\r\n   * Get the camera's x position\r\n   */\r\n  public get x() {\r\n    return this.pos.x;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's x position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set x(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(value, this.pos.y);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the camera's y position\r\n   */\r\n  public get y() {\r\n    return this.pos.y;\r\n  }\r\n\r\n  /**\r\n   * Set the camera's y position (cannot be set when following an [[Actor]] or when moving)\r\n   */\r\n  public set y(value: number) {\r\n    if (!this._follow && !this._cameraMoving) {\r\n      this.pos = vec(this.pos.x, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x velocity\r\n   */\r\n  public get dx() {\r\n    return this.vel.x;\r\n  }\r\n\r\n  public set dx(value: number) {\r\n    this.vel = vec(value, this.vel.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y velocity\r\n   */\r\n  public get dy() {\r\n    return this.vel.y;\r\n  }\r\n\r\n  public set dy(value: number) {\r\n    this.vel = vec(this.vel.x, value);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's x acceleration\r\n   */\r\n  public get ax() {\r\n    return this.acc.x;\r\n  }\r\n\r\n  public set ax(value: number) {\r\n    this.acc = vec(value, this.acc.y);\r\n  }\r\n\r\n  /**\r\n   * Get or set the camera's y acceleration\r\n   */\r\n  public get ay() {\r\n    return this.acc.y;\r\n  }\r\n\r\n  public set ay(value: number) {\r\n    this.acc = vec(this.acc.x, value);\r\n  }\r\n\r\n  /**\r\n   * Returns the focal point of the camera, a new point giving the x and y position of the camera\r\n   */\r\n  public getFocus() {\r\n    return this.pos;\r\n  }\r\n\r\n  /**\r\n   * This moves the camera focal point to the specified position using specified easing function. Cannot move when following an Actor.\r\n   *\r\n   * @param pos The target position to move to\r\n   * @param duration The duration in milliseconds the move should last\r\n   * @param [easingFn] An optional easing function ([[ex.EasingFunctions.EaseInOutCubic]] by default)\r\n   * @returns A [[Promise]] that resolves when movement is finished, including if it's interrupted.\r\n   *          The [[Promise]] value is the [[Vector]] of the target position. It will be rejected if a move cannot be made.\r\n   */\r\n  public move(pos: Vector, duration: number, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<Vector> {\r\n    if (typeof easingFn !== 'function') {\r\n      throw 'Please specify an EasingFunction';\r\n    }\r\n\r\n    // cannot move when following an actor\r\n    if (this._follow) {\r\n      return Promise.reject(pos);\r\n    }\r\n\r\n    // resolve existing promise, if any\r\n    if (this._lerpPromise && this._lerpResolve) {\r\n      this._lerpResolve(pos);\r\n    }\r\n\r\n    this._lerpPromise = new Promise<Vector>((resolve) => {\r\n      this._lerpResolve = resolve;\r\n    });\r\n    this._lerpStart = this.getFocus().clone();\r\n    this._lerpDuration = duration;\r\n    this._lerpEnd = pos;\r\n    this._currentLerpTime = 0;\r\n    this._cameraMoving = true;\r\n    this._easing = easingFn;\r\n\r\n    return this._lerpPromise;\r\n  }\r\n\r\n  /**\r\n   * Sets the camera to shake at the specified magnitudes for the specified duration\r\n   * @param magnitudeX  The x magnitude of the shake\r\n   * @param magnitudeY  The y magnitude of the shake\r\n   * @param duration    The duration of the shake in milliseconds\r\n   */\r\n  public shake(magnitudeX: number, magnitudeY: number, duration: number) {\r\n    this._isShaking = true;\r\n    this._shakeMagnitudeX = magnitudeX;\r\n    this._shakeMagnitudeY = magnitudeY;\r\n    this._shakeDuration = duration;\r\n  }\r\n\r\n  /**\r\n   * Zooms the camera in or out by the specified scale over the specified duration.\r\n   * If no duration is specified, it take effect immediately.\r\n   * @param scale    The scale of the zoom\r\n   * @param duration The duration of the zoom in milliseconds\r\n   */\r\n  public zoomOverTime(scale: number, duration: number = 0, easingFn: EasingFunction = EasingFunctions.EaseInOutCubic): Promise<boolean> {\r\n    this._zoomPromise = new Promise<boolean>((resolve) => {\r\n      this._zoomResolve = resolve;\r\n    });\r\n\r\n    if (duration) {\r\n      this._isZooming = true;\r\n      this._zoomEasing = easingFn;\r\n      this._currentZoomTime = 0;\r\n      this._zoomDuration = duration;\r\n      this._zoomStart = this.zoom;\r\n      this._zoomEnd = scale;\r\n    } else {\r\n      this._isZooming = false;\r\n      this.zoom = scale;\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    return this._zoomPromise;\r\n  }\r\n\r\n  private _viewport: BoundingBox = null;\r\n  /**\r\n   * Gets the bounding box of the viewport of this camera in world coordinates\r\n   */\r\n  public get viewport(): BoundingBox {\r\n    if (this._viewport) {\r\n      return this._viewport;\r\n    }\r\n\r\n    return new BoundingBox(0, 0, 0, 0);\r\n  }\r\n\r\n  /**\r\n   * Adds a new camera strategy to this camera\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public addStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    this._cameraStrategies.push(cameraStrategy);\r\n  }\r\n\r\n  /**\r\n   * Removes a camera strategy by reference\r\n   * @param cameraStrategy Instance of an [[CameraStrategy]]\r\n   */\r\n  public removeStrategy<T>(cameraStrategy: CameraStrategy<T>) {\r\n    removeItemFromArray(cameraStrategy, this._cameraStrategies);\r\n  }\r\n\r\n  /**\r\n   * Clears all camera strategies from the camera\r\n   */\r\n  public clearAllStrategies() {\r\n    this._cameraStrategies.length = 0;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(engine, delta, this));\r\n    this.onPreUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(engine, delta, this));\r\n    this.onPostUpdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // Overridable\r\n  }\r\n\r\n  private _engine: Engine;\r\n  private _isInitialized = false;\r\n  public get isInitialized() {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  public _initialize(_engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this._engine = _engine;\r\n\r\n      const currentRes = this._engine.screen.resolution;\r\n      let center = vec(currentRes.width / 2, currentRes.height / 2);\r\n      if (!this._engine.loadingComplete) {\r\n        // If there was a loading screen, we peek the configured resolution\r\n        const res = this._engine.screen.peekResolution();\r\n        if (res) {\r\n          center = vec(res.width / 2, res.height / 2);\r\n        }\r\n      }\r\n      this._halfWidth = center.x;\r\n      this._halfHeight = center.x;\r\n\r\n      // If the user has not set the camera pos, apply default center screen position\r\n      if (!this._posChanged) {\r\n        this.pos = center;\r\n      }\r\n\r\n      this.onInitialize(_engine);\r\n      super.emit('initialize', new InitializeEvent(_engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onInitialize(_engine: Engine) {\r\n    // Overridable\r\n  }\r\n\r\n  public on(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public on(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public on(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public on(eventName: any, handler: any) {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: 'initialize', handler?: (event: InitializeEvent) => void): void;\r\n  public off(eventName: 'preupdate', handler?: (event: PreUpdateEvent) => void): void;\r\n  public off(eventName: 'postupdate', handler?: (event: PostUpdateEvent) => void): void;\r\n  public off(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public off(eventName: string, handler: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: 'initialize', handler: (event: InitializeEvent) => void): void;\r\n  public once(eventName: 'preupdate', handler: (event: PreUpdateEvent) => void): void;\r\n  public once(eventName: 'postupdate', handler: (event: PostUpdateEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<Camera>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this._initialize(_engine);\r\n    this._preupdate(_engine, delta);\r\n\r\n    // Update placements based on linear algebra\r\n    this.pos = this.pos.add(this.vel.scale(delta / 1000));\r\n    this.zoom += (this.dz * delta) / 1000;\r\n\r\n    this.vel = this.vel.add(this.acc.scale(delta / 1000));\r\n    this.dz += (this.az * delta) / 1000;\r\n\r\n    this.rotation += (this.angularVelocity * delta) / 1000;\r\n\r\n    if (this._isZooming) {\r\n      if (this._currentZoomTime < this._zoomDuration) {\r\n        const zoomEasing = this._zoomEasing;\r\n        const newZoom = zoomEasing(this._currentZoomTime, this._zoomStart, this._zoomEnd, this._zoomDuration);\r\n\r\n        this.zoom = newZoom;\r\n        this._currentZoomTime += delta;\r\n      } else {\r\n        this._isZooming = false;\r\n        this.zoom = this._zoomEnd;\r\n        this._currentZoomTime = 0;\r\n        this._zoomResolve(true);\r\n      }\r\n    }\r\n\r\n    if (this._cameraMoving) {\r\n      if (this._currentLerpTime < this._lerpDuration) {\r\n        const moveEasing = EasingFunctions.CreateVectorEasingFunction(this._easing);\r\n\r\n        const lerpPoint = moveEasing(this._currentLerpTime, this._lerpStart, this._lerpEnd, this._lerpDuration);\r\n\r\n        this.pos = lerpPoint;\r\n\r\n        this._currentLerpTime += delta;\r\n      } else {\r\n        this.pos = this._lerpEnd;\r\n        const end = this._lerpEnd.clone();\r\n\r\n        this._lerpStart = null;\r\n        this._lerpEnd = null;\r\n        this._currentLerpTime = 0;\r\n        this._cameraMoving = false;\r\n        // Order matters here, resolve should be last so any chain promises have a clean slate\r\n        this._lerpResolve(end);\r\n      }\r\n    }\r\n\r\n    if (this._isDoneShaking()) {\r\n      this._isShaking = false;\r\n      this._elapsedShakeTime = 0;\r\n      this._shakeMagnitudeX = 0;\r\n      this._shakeMagnitudeY = 0;\r\n      this._shakeDuration = 0;\r\n      this._xShake = 0;\r\n      this._yShake = 0;\r\n    } else {\r\n      this._elapsedShakeTime += delta;\r\n      this._xShake = ((Math.random() * this._shakeMagnitudeX) | 0) + 1;\r\n      this._yShake = ((Math.random() * this._shakeMagnitudeY) | 0) + 1;\r\n    }\r\n\r\n    for (const s of this._cameraStrategies) {\r\n      this.pos = s.action.call(s, s.target, this, _engine, delta);\r\n    }\r\n\r\n    this._viewport = new BoundingBox(\r\n      this.x - this._halfWidth,\r\n      this.y - this._halfHeight,\r\n      this.x + this._halfWidth,\r\n      this.y + this._halfHeight\r\n    );\r\n\r\n    this._postupdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Applies the relevant transformations to the game canvas to \"move\" or apply effects to the Camera\r\n   * @param ctx    Canvas context to apply transformations\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D): void;\r\n  public draw(ctx: ExcaliburGraphicsContext): void;\r\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext): void {\r\n    let canvasWidth = 0;\r\n    let canvasHeight = 0;\r\n    if (ctx instanceof CanvasRenderingContext2D) {\r\n      canvasWidth = ctx.canvas.width;\r\n      canvasHeight = ctx.canvas.height;\r\n    } else {\r\n      canvasWidth = ctx.width;\r\n      canvasHeight = ctx.height;\r\n    }\r\n    const focus = this.getFocus();\r\n    const pixelRatio = this._engine ? this._engine.pixelRatio : 1;\r\n    const zoom = this.zoom;\r\n\r\n    const newCanvasWidth = canvasWidth / zoom / pixelRatio;\r\n    const newCanvasHeight = canvasHeight / zoom / pixelRatio;\r\n\r\n    ctx.scale(zoom, zoom);\r\n    ctx.translate(-focus.x + newCanvasWidth / 2 + this._xShake, -focus.y + newCanvasHeight / 2 + this._yShake);\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n\r\n  private _isDoneShaking(): boolean {\r\n    return !this._isShaking || this._elapsedShakeTime >= this._shakeDuration;\r\n  }\r\n}\r\n","import { BoundingBox } from './Collision/BoundingBox';\r\nimport { Engine } from './Engine';\r\nimport { Vector, vec } from './Math/vector';\r\nimport { Logger } from './Util/Log';\r\nimport { SpriteSheet } from './Drawing/SpriteSheet';\r\nimport * as Events from './Events';\r\nimport { Configurable } from './Configurable';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { BodyComponent } from './Collision/BodyComponent';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { Shape } from './Collision/Colliders/Shape';\r\nimport { ExcaliburGraphicsContext, GraphicsComponent, hasGraphicsTick } from './Graphics';\r\nimport * as Graphics from './Graphics';\r\nimport { CanvasDrawComponent, Sprite } from './Drawing/Index';\r\nimport { Sprite as LegacySprite } from './Drawing/Index';\r\nimport { removeItemFromArray } from './Util/Util';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { MotionComponent } from './EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from './Collision/ColliderComponent';\r\nimport { CompositeCollider } from './Collision/Colliders/CompositeCollider';\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class TileMapImpl extends Entity {\r\n  private _token = 0;\r\n  private _onScreenXStart: number = 0;\r\n  private _onScreenXEnd: number = 9999;\r\n  private _onScreenYStart: number = 0;\r\n  private _onScreenYEnd: number = 9999;\r\n  private _spriteSheets: { [key: string]: Graphics.SpriteSheet } = {};\r\n\r\n  private _legacySpriteMap = new Map<Graphics.Sprite, Sprite>();\r\n  public logger: Logger = Logger.getInstance();\r\n  public readonly data: Cell[] = [];\r\n  private _rows: Cell[][] = [];\r\n  private _cols: Cell[][] = [];\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n  public readonly cellWidth: number;\r\n  public readonly cellHeight: number;\r\n  public readonly rows: number;\r\n  public readonly cols: number;\r\n\r\n  private _dirty = true;\r\n  public flagDirty() {\r\n    this._dirty = true;\r\n  }\r\n  private _transform: TransformComponent;\r\n  private _motion: MotionComponent;\r\n  private _collider: ColliderComponent;\r\n  private _composite: CompositeCollider;\r\n\r\n  public get x(): number {\r\n    return this._transform.pos.x ?? 0;\r\n  }\r\n\r\n  public set x(val: number) {\r\n    if (this._transform?.pos) {\r\n      this.get(TransformComponent).pos = vec(val, this.y);\r\n    }\r\n  }\r\n\r\n  public get y(): number {\r\n    return this._transform?.pos.y ?? 0;\r\n  }\r\n\r\n  public set y(val: number) {\r\n    if (this._transform?.pos) {\r\n      this._transform.pos = vec(this.x, val);\r\n    }\r\n  }\r\n\r\n  public get z(): number {\r\n    return this._transform.z ?? 0;\r\n  }\r\n\r\n  public set z(val: number) {\r\n    if (this._transform) {\r\n      this._transform.z = val;\r\n    }\r\n  }\r\n\r\n  public get rotation(): number {\r\n    return this._transform?.rotation ?? 0;\r\n  }\r\n\r\n  public set rotation(val: number) {\r\n    if (this._transform?.rotation) {\r\n      this._transform.rotation = val;\r\n    }\r\n  }\r\n\r\n  public get scale(): Vector {\r\n    return this._transform?.scale ?? Vector.One;\r\n  }\r\n  public set scale(val: Vector) {\r\n    if (this._transform?.scale) {\r\n      this._transform.scale = val;\r\n    }\r\n  }\r\n\r\n  public get pos(): Vector {\r\n    return this._transform.pos;\r\n  }\r\n\r\n  public set pos(val: Vector) {\r\n    this._transform.pos = val;\r\n  }\r\n\r\n  public get vel(): Vector {\r\n    return this._motion.vel;\r\n  }\r\n\r\n  public set vel(val: Vector) {\r\n    this._motion.vel = val;\r\n  }\r\n\r\n  public on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<TileMap>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<TileMap>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * @param xOrConfig     The x coordinate to anchor the TileMap's upper left corner (should not be changed once set) or TileMap option bag\r\n   * @param y             The y coordinate to anchor the TileMap's upper left corner (should not be changed once set)\r\n   * @param cellWidth     The individual width of each cell (in pixels) (should not be changed once set)\r\n   * @param cellHeight    The individual height of each cell (in pixels) (should not be changed once set)\r\n   * @param rows          The number of rows in the TileMap (should not be changed once set)\r\n   * @param cols          The number of cols in the TileMap (should not be changed once set)\r\n   */\r\n  constructor(xOrConfig: number | TileMapArgs, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number) {\r\n    super();\r\n    if (xOrConfig && typeof xOrConfig === 'object') {\r\n      const config = xOrConfig;\r\n      xOrConfig = config.x;\r\n      y = config.y;\r\n      cellWidth = config.cellWidth;\r\n      cellHeight = config.cellHeight;\r\n      rows = config.rows;\r\n      cols = config.cols;\r\n    }\r\n    this.addComponent(new TransformComponent());\r\n    this.addComponent(new MotionComponent());\r\n    this.addComponent(\r\n      new BodyComponent({\r\n        type: CollisionType.Fixed\r\n      })\r\n    );\r\n    this.addComponent(new CanvasDrawComponent((ctx, delta) => this.draw(ctx, delta)));\r\n    this.addComponent(\r\n      new GraphicsComponent({\r\n        onPostDraw: (ctx, delta) => this.draw(ctx, delta)\r\n      })\r\n    );\r\n    this.addComponent(new ColliderComponent());\r\n    this._transform = this.get(TransformComponent);\r\n    this._motion = this.get(MotionComponent);\r\n    this._collider = this.get(ColliderComponent);\r\n    this._composite = this._collider.useCompositeCollider([]);\r\n\r\n    this.x = <number>xOrConfig;\r\n    this.y = y;\r\n    this.cellWidth = cellWidth;\r\n    this.cellHeight = cellHeight;\r\n    this.rows = rows;\r\n    this.cols = cols;\r\n    this.data = new Array<Cell>(rows * cols);\r\n    this._rows = new Array(rows);\r\n    this._cols = new Array(cols);\r\n    let currentCol: Cell[] = [];\r\n    for (let i = 0; i < cols; i++) {\r\n      for (let j = 0; j < rows; j++) {\r\n        const cd = new Cell(i * cellWidth + <number>xOrConfig, j * cellHeight + y, cellWidth, cellHeight, i + j * cols);\r\n        cd.map = this;\r\n        this.data[i + j * cols] = cd;\r\n        currentCol.push(cd);\r\n        if (!this._rows[j]) {\r\n          this._rows[j] = [];\r\n        }\r\n        this._rows[j].push(cd);\r\n      }\r\n      this._cols[i] = currentCol;\r\n      currentCol = [];\r\n    }\r\n\r\n    this.get(GraphicsComponent).localBounds = new BoundingBox({\r\n      left: 0,\r\n      top: 0,\r\n      right: this.cols * this.cellWidth,\r\n      bottom: this.rows * this.cellHeight\r\n    });\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param key\r\n   * @param spriteSheet\r\n   * @deprecated No longer used, will be removed in v0.26.0\r\n   */\r\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet): void;\r\n  public registerSpriteSheet(key: string, spriteSheet: Graphics.SpriteSheet): void;\r\n  @obsolete({ message: 'No longer used, will be removed in v0.26.0' })\r\n  public registerSpriteSheet(key: string, spriteSheet: SpriteSheet | Graphics.SpriteSheet): void {\r\n    if (spriteSheet instanceof Graphics.SpriteSheet) {\r\n      this._spriteSheets[key] = spriteSheet;\r\n    } else {\r\n      this._spriteSheets[key] = Graphics.SpriteSheet.fromLegacySpriteSheet(spriteSheet);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tiles colliders based on the solid tiles in the tilemap.\r\n   */\r\n  private _updateColliders(): void {\r\n    this._composite.clearColliders();\r\n    const colliders: BoundingBox[] = [];\r\n    let current: BoundingBox;\r\n    // Bad square tessalation algo\r\n    for (let i = 0; i < this.cols; i++) {\r\n      // Scan column for colliders\r\n      for (let j = 0; j < this.rows; j++) {\r\n        // Columns start with a new collider\r\n        if (j === 0) {\r\n          current = null;\r\n        }\r\n        const tile = this.data[i + j * this.cols];\r\n        // Current tile in column is solid build up current collider\r\n        if (tile.solid) {\r\n          if (!current) {\r\n            current = tile.bounds;\r\n          } else {\r\n            current = current.combine(tile.bounds);\r\n          }\r\n        } else {\r\n          // Not solid skip and cut off the current collider\r\n          if (current) {\r\n            colliders.push(current);\r\n          }\r\n          current = null;\r\n        }\r\n      }\r\n      // After a column is complete check to see if it can be merged into the last one\r\n      if (current) {\r\n        // if previous is the same combine it\r\n        const prev = colliders[colliders.length - 1];\r\n        if (prev && prev.top === current.top && prev.bottom === current.bottom) {\r\n          colliders[colliders.length - 1] = prev.combine(current);\r\n        } else {\r\n          // else new collider\r\n          colliders.push(current);\r\n        }\r\n      }\r\n    }\r\n    this._composite = this._collider.useCompositeCollider([]);\r\n    for (const c of colliders) {\r\n      const collider = Shape.Box(c.width, c.height, Vector.Zero, vec(c.left - this.pos.x, c.top - this.pos.y));\r\n      collider.owner = this;\r\n      this._composite.addCollider(collider);\r\n    }\r\n    this._collider.update();\r\n  }\r\n\r\n  /**\r\n   * Returns the [[Cell]] by index (row major order)\r\n   */\r\n  public getCellByIndex(index: number): Cell {\r\n    return this.data[index];\r\n  }\r\n  /**\r\n   * Returns the [[Cell]] by its x and y coordinates\r\n   */\r\n  public getCell(x: number, y: number): Cell {\r\n    if (x < 0 || y < 0 || x >= this.cols || y >= this.rows) {\r\n      return null;\r\n    }\r\n    return this.data[x + y * this.cols];\r\n  }\r\n  /**\r\n   * Returns the [[Cell]] by testing a point in global coordinates,\r\n   * returns `null` if no cell was found.\r\n   */\r\n  public getCellByPoint(x: number, y: number): Cell {\r\n    x = Math.floor((x - this.pos.x) / this.cellWidth);\r\n    y = Math.floor((y - this.pos.y) / this.cellHeight);\r\n    const cell = this.getCell(x, y);\r\n    if (x >= 0 && y >= 0 && x < this.cols && y < this.rows && cell) {\r\n      return cell;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public getRows(): readonly Cell[][] {\r\n    return this._rows;\r\n  }\r\n\r\n  public getColumns(): readonly Cell[][] {\r\n    return this._cols;\r\n  }\r\n\r\n  public onPreUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  public onPostUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  public update(engine: Engine, delta: number) {\r\n    this.onPreUpdate(engine, delta);\r\n    this.emit('preupdate', new Events.PreUpdateEvent(engine, delta, this));\r\n    if (this._dirty) {\r\n      this._dirty = false;\r\n      this._updateColliders();\r\n    }\r\n\r\n    this._token++;\r\n    const worldBounds = engine.getWorldBounds();\r\n    const worldCoordsUpperLeft = vec(worldBounds.left, worldBounds.top);\r\n    const worldCoordsLowerRight = vec(worldBounds.right, worldBounds.bottom);\r\n\r\n    this._onScreenXStart = Math.max(Math.floor((worldCoordsUpperLeft.x - this.x) / this.cellWidth) - 2, 0);\r\n    this._onScreenYStart = Math.max(Math.floor((worldCoordsUpperLeft.y - this.y) / this.cellHeight) - 2, 0);\r\n    this._onScreenXEnd = Math.max(Math.floor((worldCoordsLowerRight.x - this.x) / this.cellWidth) + 2, 0);\r\n    this._onScreenYEnd = Math.max(Math.floor((worldCoordsLowerRight.y - this.y) / this.cellHeight) + 2, 0);\r\n    this._transform.pos = vec(this.x, this.y);\r\n\r\n    this.onPostUpdate(engine, delta);\r\n    this.emit('postupdate', new Events.PostUpdateEvent(engine, delta, this));\r\n  }\r\n\r\n  /**\r\n   * Draws the tile map to the screen. Called by the [[Scene]].\r\n   * @param ctx CanvasRenderingContext2D or ExcaliburGraphicsContext\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D | ExcaliburGraphicsContext, delta: number): void {\r\n    this.emit('predraw', new Events.PreDrawEvent(ctx as any, delta, this)); // TODO fix event\r\n\r\n    let x = this._onScreenXStart;\r\n    const xEnd = Math.min(this._onScreenXEnd, this.cols);\r\n    let y = this._onScreenYStart;\r\n    const yEnd = Math.min(this._onScreenYEnd, this.rows);\r\n\r\n    let graphics: Graphics.Graphic[], graphicsIndex: number, graphicsLen: number;\r\n\r\n    for (x; x < xEnd; x++) {\r\n      for (y; y < yEnd; y++) {\r\n        // get non-negative tile sprites\r\n        graphics = this.getCell(x, y).graphics;\r\n\r\n        for (graphicsIndex = 0, graphicsLen = graphics.length; graphicsIndex < graphicsLen; graphicsIndex++) {\r\n          // draw sprite, warning if sprite doesn't exist\r\n          const graphic = graphics[graphicsIndex];\r\n          if (graphic) {\r\n            if (!(ctx instanceof CanvasRenderingContext2D)) {\r\n              if (hasGraphicsTick(graphic)) {\r\n                graphic?.tick(delta, this._token);\r\n              }\r\n              graphic.draw(ctx, x * this.cellWidth, y * this.cellHeight);\r\n            } else if (graphic instanceof Graphics.Sprite) {\r\n              // TODO legacy drawing mode\r\n              if (!this._legacySpriteMap.has(graphic)) {\r\n                this._legacySpriteMap.set(graphic, Graphics.Sprite.toLegacySprite(graphic));\r\n              }\r\n              this._legacySpriteMap.get(graphic).draw(ctx, x * this.cellWidth, y * this.cellHeight);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      y = this._onScreenYStart;\r\n    }\r\n\r\n    this.emit('postdraw', new Events.PostDrawEvent(ctx as any, delta, this));\r\n  }\r\n}\r\n\r\nexport interface TileMapArgs extends Partial<TileMapImpl> {\r\n  x: number;\r\n  y: number;\r\n  cellWidth: number;\r\n  cellHeight: number;\r\n  rows: number;\r\n  cols: number;\r\n}\r\n\r\n/**\r\n * The [[TileMap]] class provides a lightweight way to do large complex scenes with collision\r\n * without the overhead of actors.\r\n */\r\nexport class TileMap extends Configurable(TileMapImpl) {\r\n  constructor(config: TileMapArgs);\r\n  constructor(x: number, y: number, cellWidth: number, cellHeight: number, rows: number, cols: number);\r\n  constructor(xOrConfig: number | TileMapArgs, y?: number, cellWidth?: number, cellHeight?: number, rows?: number, cols?: number) {\r\n    super(xOrConfig, y, cellWidth, cellHeight, rows, cols);\r\n  }\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class CellImpl extends Entity {\r\n  private _bounds: BoundingBox;\r\n  /**\r\n   * World space x coordinate of the left of the cell\r\n   */\r\n  public readonly x: number;\r\n  /**\r\n   * World space y coordinate of the top of the cell\r\n   */\r\n  public readonly y: number;\r\n  /**\r\n   * Width of the cell in pixels\r\n   */\r\n  public readonly width: number;\r\n  /**\r\n   * Height of the cell in pixels\r\n   */\r\n  public readonly height: number;\r\n  /**\r\n   * Current index in the tilemap\r\n   */\r\n  public readonly index: number;\r\n\r\n  /**\r\n   * Reference to the TileMap this Cell is associated with\r\n   */\r\n  public map: TileMap;\r\n\r\n  private _solid = false;\r\n  /**\r\n   * Wether this cell should be treated as solid by the tilemap\r\n   */\r\n  public get solid(): boolean {\r\n    return this._solid;\r\n  }\r\n  /**\r\n   * Wether this cell should be treated as solid by the tilemap\r\n   */\r\n  public set solid(val: boolean) {\r\n    this.map?.flagDirty();\r\n    this._solid = val;\r\n  }\r\n  /**\r\n   * Current list of graphics for this cell\r\n   */\r\n  public readonly graphics: Graphics.Graphic[] = [];\r\n  /**\r\n   * Abitrary data storage per cell, useful for any game specific data\r\n   */\r\n  public data = new Map<string, any>();\r\n\r\n  /**\r\n   * @param xOrConfig Gets or sets x coordinate of the cell in world coordinates or cell option bag\r\n   * @param y       Gets or sets y coordinate of the cell in world coordinates\r\n   * @param width   Gets or sets the width of the cell\r\n   * @param height  Gets or sets the height of the cell\r\n   * @param index   The index of the cell in row major order\r\n   * @param solid   Gets or sets whether this cell is solid\r\n   * @param graphics The list of tile graphics to use to draw in this cell (in order)\r\n   */\r\n  constructor(\r\n    xOrConfig: number | CellArgs,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n    index: number,\r\n    solid: boolean = false,\r\n    graphics: Graphics.Graphic[] = []\r\n  ) {\r\n    super();\r\n    if (xOrConfig && typeof xOrConfig === 'object') {\r\n      const config = xOrConfig;\r\n      xOrConfig = config.x;\r\n      y = config.y;\r\n      width = config.width;\r\n      height = config.height;\r\n      index = config.index;\r\n      solid = config.solid;\r\n      graphics = config.sprites;\r\n    }\r\n    this.x = <number>xOrConfig;\r\n    this.y = y;\r\n    this.width = width;\r\n    this.height = height;\r\n    this.index = index;\r\n    this.solid = solid;\r\n    this.graphics = graphics;\r\n    this._bounds = new BoundingBox(this.x, this.y, this.x + this.width, this.y + this.height);\r\n  }\r\n\r\n  public get bounds() {\r\n    return this._bounds;\r\n  }\r\n\r\n  public get center(): Vector {\r\n    return new Vector(this.x + this.width / 2, this.y + this.height / 2);\r\n  }\r\n\r\n  /**\r\n   * Add another [[Sprite]] to this cell\r\n   * @deprecated Use addSprite, will be removed in v0.26.0\r\n   */\r\n  @obsolete({ message: 'Will be removed in v0.26.0', alternateMethod: 'addSprite' })\r\n  public pushSprite(sprite: Graphics.Sprite | LegacySprite) {\r\n    this.addGraphic(sprite);\r\n  }\r\n\r\n  /**\r\n   * Add another [[Graphic]] to this TileMap cell\r\n   * @param graphic\r\n   */\r\n  public addGraphic(graphic: Graphics.Graphic | LegacySprite) {\r\n    if (graphic instanceof LegacySprite) {\r\n      this.graphics.push(Graphics.Sprite.fromLegacySprite(graphic));\r\n    } else {\r\n      this.graphics.push(graphic);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an instance of a [[Graphic]] from this cell\r\n   */\r\n  public removeGraphic(graphic: Graphics.Graphic | LegacySprite) {\r\n    removeItemFromArray(graphic, this.graphics);\r\n  }\r\n\r\n  /**\r\n   * Clear all graphis from this cell\r\n   */\r\n  public clearGraphics() {\r\n    this.graphics.length = 0;\r\n  }\r\n}\r\n\r\nexport interface CellArgs extends Partial<CellImpl> {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  index: number;\r\n  solid?: boolean;\r\n  sprites?: Graphics.Sprite[];\r\n}\r\n\r\n/**\r\n * TileMap Cell\r\n *\r\n * A light-weight object that occupies a space in a collision map. Generally\r\n * created by a [[TileMap]].\r\n *\r\n * Cells can draw multiple sprites. Note that the order of drawing is the order\r\n * of the sprites in the array so the last one will be drawn on top. You can\r\n * use transparency to create layers this way.\r\n */\r\nexport class Cell extends Configurable(CellImpl) {\r\n  constructor(config: CellArgs);\r\n  constructor(x: number, y: number, width: number, height: number, index: number, solid?: boolean, sprites?: Graphics.Sprite[]);\r\n  constructor(\r\n    xOrConfig: number | CellArgs,\r\n    y?: number,\r\n    width?: number,\r\n    height?: number,\r\n    index?: number,\r\n    solid?: boolean,\r\n    sprites?: Graphics.Sprite[]\r\n  ) {\r\n    super(xOrConfig, y, width, height, index, solid, sprites);\r\n  }\r\n}\r\n","import { Actor } from '../Actor';\r\nimport { ScreenElement } from '../ScreenElement';\r\nimport { Label } from '../Label';\r\nimport { Trigger } from '../Trigger';\r\n\r\n/**\r\n * Type guard to detect if something is an actor\r\n * @deprecated Will be removed in v0.26.0\r\n * @param actor\r\n */\r\nexport function isVanillaActor(actor: Actor) {\r\n  return !(actor instanceof ScreenElement) && !(actor instanceof Trigger) && !(actor instanceof Label);\r\n}\r\n\r\n/**\r\n * Type guard to detect a screen element\r\n * @todo move to ScreenElement\r\n */\r\nexport function isScreenElement(actor: Actor) {\r\n  return actor instanceof ScreenElement;\r\n}\r\n","import { Color } from './Color';\nimport { Engine } from './Engine';\nimport { EventDispatcher } from './EventDispatcher';\nimport { Vector } from './Math/vector';\nimport { ExitTriggerEvent, EnterTriggerEvent, CollisionEndEvent, CollisionStartEvent } from './Events';\nimport * as Util from './Util/Util';\nimport { CollisionType } from './Collision/CollisionType';\nimport { Entity } from './EntityComponentSystem';\nimport { Actor } from './Actor';\n\n/**\n * ITriggerOptions\n */\nexport interface TriggerOptions {\n  // position of the trigger\n  pos: Vector;\n  // width of the trigger\n  width: number;\n  // height of the trigger\n  height: number;\n  // whether the trigger is visible or not\n  visible: boolean;\n  // action to take when triggered\n  action: () => void;\n  // if specified the trigger will only fire on a specific actor and overrides any filter\n  target: Entity;\n  // Returns true if the triggers should fire on the collided actor\n  filter: (actor: Entity) => boolean;\n  // -1 if it should repeat forever\n  repeat: number;\n}\n\nconst triggerDefaults: Partial<TriggerOptions> = {\n  pos: Vector.Zero,\n  width: 10,\n  height: 10,\n  visible: false,\n  action: () => {\n    return;\n  },\n  filter: () => true,\n  repeat: -1\n};\n\n/**\n * Triggers are a method of firing arbitrary code on collision. These are useful\n * as 'buttons', 'switches', or to trigger effects in a game. By default triggers\n * are invisible, and can only be seen when [[Trigger.visible]] is set to `true`.\n */\nexport class Trigger extends Actor {\n  private _target: Entity;\n  /**\n   * Action to fire when triggered by collision\n   */\n  public action: () => void = () => {\n    return;\n  };\n  /**\n   * Filter to add additional granularity to action dispatch, if a filter is specified the action will only fire when\n   * filter return true for the collided actor.\n   */\n  public filter: (actor: Entity) => boolean = () => true;\n  /**\n   * Number of times to repeat before killing the trigger,\n   */\n  public repeat: number = -1;\n\n  /**\n   *\n   * @param opts Trigger options\n   */\n  constructor(opts: Partial<TriggerOptions>) {\n    super({ x: opts.pos.x, y: opts.pos.y, width: opts.width, height: opts.height });\n    opts = Util.extend({}, triggerDefaults, opts);\n\n    this.filter = opts.filter || this.filter;\n    this.repeat = opts.repeat || this.repeat;\n    this.action = opts.action || this.action;\n    if (opts.target) {\n      this.target = opts.target;\n    }\n\n    this.graphics.visible = opts.visible;\n    this.body.collisionType = CollisionType.Passive;\n    this.eventDispatcher = new EventDispatcher(this);\n\n    this.events.on('collisionstart', (evt: CollisionStartEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('enter', new EnterTriggerEvent(this, evt.other));\n        this._dispatchAction();\n        // remove trigger if its done, -1 repeat forever\n        if (this.repeat === 0) {\n          this.kill();\n        }\n      }\n    });\n\n    this.events.on('collisionend', (evt: CollisionEndEvent<Actor>) => {\n      if (this.filter(evt.other)) {\n        this.emit('exit', new ExitTriggerEvent(this, evt.other));\n      }\n    });\n  }\n\n  public set target(target: Entity) {\n    this._target = target;\n    this.filter = (actor: Entity) => actor === target;\n  }\n\n  public get target() {\n    return this._target;\n  }\n\n  public _initialize(engine: Engine) {\n    super._initialize(engine);\n  }\n\n  private _dispatchAction() {\n    if (this.repeat !== 0) {\n      this.action.call(this);\n      this.repeat--;\n    }\n  }\n\n  /* istanbul ignore next */\n  public debugDraw(ctx: CanvasRenderingContext2D) {\n    super.debugDraw(ctx);\n    // Meant to draw debug information about actors\n    ctx.save();\n    ctx.translate(this.pos.x, this.pos.y);\n\n    const bb = this.collider.bounds;\n    const wp = this.getGlobalPos();\n    bb.left = bb.left - wp.x;\n    bb.right = bb.right - wp.x;\n    bb.top = bb.top - wp.y;\n    bb.bottom = bb.bottom - wp.y;\n\n    ctx.fillStyle = Color.Violet.toString();\n    ctx.strokeStyle = Color.Violet.toString();\n    ctx.fillText('Trigger', 10, 10);\n    bb.debugDraw(ctx);\n\n    ctx.restore();\n  }\n}\n","import { Entity } from './Entity';\r\nimport { Message, Observer } from '../Util/Observable';\r\nimport { Component } from './Component';\r\nimport { Scene } from '../Scene';\r\n\r\n/**\r\n * Enum that determines whether to run the system in the update or draw phase\r\n */\r\nexport enum SystemType {\r\n  Update = 'update',\r\n  Draw = 'draw'\r\n}\r\n\r\nexport type SystemTypes<ComponentTypes> = ComponentTypes extends Component<infer TypeName> ? TypeName : never;\r\n\r\n/**\r\n * An Excalibur [[System]] that updates entities of certain types.\r\n * Systems are scene specific\r\n *\r\n * Excalibur Systems currently require at least 1 Component type to operated\r\n *\r\n * Multiple types are declared as a type union\r\n * For example:\r\n *\r\n * ```typescript\r\n * class MySystem extends System<ComponentA | ComponentB> {\r\n *   public readonly types = ['a', 'b'] as const;\r\n *   public readonly systemType = SystemType.Update;\r\n *   public update(entities: Entity<ComponentA | ComponentB>) {\r\n *      ...\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport abstract class System<ComponentTypeUnion extends Component = Component, ContextType = Scene>\r\nimplements Observer<AddedEntity | RemovedEntity> {\r\n  /**\r\n   * The types of entities that this system operates on\r\n   * For example ['transform', 'motion']\r\n   */\r\n  abstract readonly types: readonly SystemTypes<ComponentTypeUnion>[];\r\n\r\n  /**\r\n   * Determine whether the system is called in the [[SystemType.Update]] or the [[SystemType.Draw]] phase. Update is first, then Draw.\r\n   */\r\n  abstract readonly systemType: SystemType;\r\n\r\n  /**\r\n   * System can execute in priority order, by default all systems are priority 0. Lower values indicated higher priority.\r\n   * For a system to execute before all other a lower priority value (-1 for example) must be set.\r\n   * For a system to exectue after all other a higher priority value (10 for example) must be set.\r\n   */\r\n  public priority: number = 0;\r\n\r\n  /**\r\n   * Optionally specify a sort order for entities passed to the your system\r\n   * @param a The left entity\r\n   * @param b The right entity\r\n   */\r\n  sort?(a: Entity, b: Entity): number;\r\n\r\n  /**\r\n   * Optionally specify an initialize handler\r\n   * @param scene\r\n   */\r\n  initialize?(engine: ContextType): void;\r\n\r\n  /**\r\n   * Update all entities that match this system's types\r\n   * @param entities Entities to update that match this system's types\r\n   * @param delta Time in milliseconds\r\n   */\r\n  abstract update(entities: Entity[], delta: number): void;\r\n\r\n  /**\r\n   * Optionally run a preupdate before the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  preupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Optionally run a postupdate after the system processes matching entities\r\n   * @param engine\r\n   * @param elapsedMs Time in milliseconds since the last frame\r\n   */\r\n  postupdate?(engine: ContextType, elapsedMs: number): void;\r\n\r\n  /**\r\n   * Systems observe when entities match their types or no longer match their types, override\r\n   * @param _entityAddedOrRemoved\r\n   */\r\n  public notify(_entityAddedOrRemoved: AddedEntity | RemovedEntity) {\r\n    // Override me\r\n  }\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that matches a [[System]] types exists in the current scene.\r\n */\r\nexport class AddedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Added' = 'Entity Added';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * Type guard to check for AddedEntity messages\r\n * @param x\r\n */\r\nexport function isAddedSystemEntity(x: Message<Entity>): x is AddedEntity {\r\n  return !!x && x.type === 'Entity Added';\r\n}\r\n\r\n/**\r\n * An [[Entity]] with [[Component]] types that no longer matches a [[System]] types exists in the current scene.\r\n */\r\nexport class RemovedEntity implements Message<Entity> {\r\n  readonly type: 'Entity Removed' = 'Entity Removed';\r\n  constructor(public data: Entity) {}\r\n}\r\n\r\n/**\r\n * type guard to check for the RemovedEntity message\r\n */\r\nexport function isRemoveSystemEntity(x: Message<Entity>): x is RemovedEntity {\r\n  return !!x && x.type === 'Entity Removed';\r\n}\r\n","import { Entity, RemovedComponent, AddedComponent, isAddedComponent, isRemovedComponent } from './Entity';\r\nimport { Observer } from '../Util/Observable';\r\nimport { World } from './World';\r\nimport { Util } from '..';\r\n\r\n// Add/Remove entitys and components\r\n\r\nexport class EntityManager<ContextType = any> implements Observer<RemovedComponent | AddedComponent> {\r\n  public entities: Entity[] = [];\r\n  public _entityIndex: { [entityId: string]: Entity } = {};\r\n\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Runs the entity lifecycle\r\n   * @param _context\r\n   */\r\n  public updateEntities(_context: ContextType, elapsed: number) {\r\n    for (const entity of this.entities) {\r\n      // TODO is this right?\r\n      entity.update((_context as any).engine, elapsed);\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  public findEntitiesForRemoval() {\r\n    for (const entity of this.entities) {\r\n      if (!entity.active) {\r\n        this.removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * EntityManager observes changes on entities\r\n   * @param message\r\n   */\r\n  public notify(message: RemovedComponent | AddedComponent): void {\r\n    if (isAddedComponent(message)) {\r\n      // we don't need the component, it's already on the entity\r\n      this._world.queryManager.addEntity(message.data.entity);\r\n    }\r\n\r\n    if (isRemovedComponent(message)) {\r\n      this._world.queryManager.removeComponent(message.data.entity, message.data.component);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds an entity to be tracked by the EntityManager\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    entity.active = true;\r\n    if (entity && !this._entityIndex[entity.id]) {\r\n      this._entityIndex[entity.id] = entity;\r\n      this.entities.push(entity);\r\n      this._world.queryManager.addEntity(entity);\r\n      entity.componentAdded$.register(this);\r\n      entity.componentRemoved$.register(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.addEntity(c));\r\n      entity.childrenAdded$.register({\r\n        notify: (e) => {\r\n          this.addEntity(e);\r\n        }\r\n      });\r\n      entity.childrenRemoved$.register({\r\n        notify: (e) => {\r\n          this.removeEntity(e, false);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  public removeEntity(entity: Entity, deferred?: boolean): void;\r\n  public removeEntity(id: number, deferred?: boolean): void;\r\n  public removeEntity(idOrEntity: number | Entity, deferred = true): void {\r\n    let id = 0;\r\n    if (idOrEntity instanceof Entity) {\r\n      id = idOrEntity.id;\r\n    } else {\r\n      id = idOrEntity;\r\n    }\r\n    const entity = this._entityIndex[id];\r\n    if (entity && entity.active) {\r\n      entity.kill();\r\n    }\r\n\r\n    if (entity && deferred) {\r\n      this._entitiesToRemove.push(entity);\r\n      return;\r\n    }\r\n\r\n    delete this._entityIndex[id];\r\n    if (entity) {\r\n      Util.removeItemFromArray(entity, this.entities);\r\n      this._world.queryManager.removeEntity(entity);\r\n      entity.componentAdded$.unregister(this);\r\n      entity.componentRemoved$.unregister(this);\r\n\r\n      // if entity has children\r\n      entity.children.forEach((c) => this.removeEntity(c, deferred));\r\n      entity.childrenAdded$.clear();\r\n      entity.childrenRemoved$.clear();\r\n\r\n      // stats\r\n      if ((this._world.context as any)?.engine) {\r\n        (this._world.context as any).engine.stats.currFrame.actors.killed++;\r\n      }\r\n    }\r\n  }\r\n\r\n  private _entitiesToRemove: Entity[] = [];\r\n  public processEntityRemovals(): void {\r\n    for (const entity of this._entitiesToRemove) {\r\n      if (entity.active) {\r\n        continue;\r\n      }\r\n      this.removeEntity(entity, false);\r\n    }\r\n  }\r\n\r\n  public processComponentRemovals(): void {\r\n    for (const entity of this.entities) {\r\n      entity.processComponentRemoval();\r\n    }\r\n  }\r\n\r\n  public getById(id: number): Entity {\r\n    return this._entityIndex[id];\r\n  }\r\n\r\n  public getByName(name: string): Entity[]{\r\n    return this.entities.filter(e => e.name === name);\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const entity of this.entities) {\r\n      this.removeEntity(entity);\r\n    }\r\n  }\r\n}\r\n","export const buildTypeKey = (types: readonly string[]) => {\r\n  const key = [...types].sort((a, b) => a.localeCompare(b)).join('+');\r\n  return key;\r\n};\r\n","import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Observable } from '../Util/Observable';\r\nimport { Util, Component, ComponentCtor } from '..';\r\nimport { AddedEntity, RemovedEntity } from './System';\r\n\r\n/**\r\n * Represents query for entities that match a list of types that is cached and observable\r\n *\r\n * Queries can be strongly typed by supplying a type union in the optional type parameter\r\n * ```typescript\r\n * const queryAB = new ex.Query<ComponentTypeA | ComponentTypeB>(['A', 'B']);\r\n * ```\r\n */\r\nexport class Query<T extends Component = Component> extends Observable<AddedEntity | RemovedEntity> {\r\n  public types: readonly string[];\r\n  private _entities: Entity[] = [];\r\n  private _key: string;\r\n  public get key(): string {\r\n    if (this._key) {\r\n      return this._key;\r\n    }\r\n    return (this._key = buildTypeKey(this.types));\r\n  }\r\n\r\n  constructor(types: readonly string[]);\r\n  constructor(types: readonly ComponentCtor<T>[]);\r\n  constructor(types: readonly string[] | readonly ComponentCtor<T>[]) {\r\n    super();\r\n    if (types[0] instanceof Function) {\r\n      this.types = (types as ComponentCtor<T>[]).map(T =>  (new T).type);\r\n    } else {\r\n      this.types = types as string[];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns a list of entities that match the query\r\n   *\r\n   * @param sort Optional sorting function to sort entities returned from the query\r\n   */\r\n  public getEntities(sort?: (a: Entity, b: Entity) => number): Entity[] {\r\n    if (sort) {\r\n      this._entities.sort(sort);\r\n    }\r\n    return this._entities;\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the query, will only be added if the entity matches the query types\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity): void {\r\n    if (!Util.contains(this._entities, entity) && this.matches(entity)) {\r\n      this._entities.push(entity);\r\n      this.notifyAll(new AddedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * If the entity is part of the query it will be removed regardless of types\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity): void {\r\n    if (Util.removeItemFromArray(entity, this._entities)) {\r\n      this.notifyAll(new RemovedEntity(entity));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all entities and observers from the query\r\n   */\r\n  public clear(): void {\r\n    this._entities.length = 0;\r\n    for (const observer of this.observers) {\r\n      this.unregister(observer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns whether the entity's types match query\r\n   * @param entity\r\n   */\r\n  public matches(entity: Entity): boolean;\r\n\r\n  /**\r\n   * Returns whether the list of ComponentTypes have at least the same types as the query\r\n   * @param types\r\n   */\r\n  public matches(types: string[]): boolean;\r\n  public matches(typesOrEntity: string[] | Entity): boolean {\r\n    let types: string[] = [];\r\n    if (typesOrEntity instanceof Entity) {\r\n      types = typesOrEntity.types;\r\n    } else {\r\n      types = typesOrEntity;\r\n    }\r\n\r\n    let matches = true;\r\n    for (const type of this.types) {\r\n      matches = matches && types.indexOf(type) > -1;\r\n      if (!matches) {\r\n        return false;\r\n      }\r\n    }\r\n    return matches;\r\n  }\r\n\r\n  public contain(type: string) {\r\n    return this.types.indexOf(type) > -1;\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { buildTypeKey } from './Util';\r\nimport { Query } from './Query';\r\nimport { Component } from './Component';\r\nimport { World } from './World';\r\n\r\n/**\r\n * The query manager is responsible for updating all queries when entities/components change\r\n */\r\nexport class QueryManager {\r\n  private _queries: { [entityComponentKey: string]: Query<any> } = {};\r\n\r\n  constructor(private _world: World<any>) {}\r\n\r\n  /**\r\n   * Adds a query to the manager and populates with any entities that match\r\n   * @param query\r\n   */\r\n  private _addQuery(query: Query<any>) {\r\n    this._queries[buildTypeKey(query.types)] = query;\r\n    for (const entity of this._world.entityManager.entities) {\r\n      query.addEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes the query if there are no observers left\r\n   * @param query\r\n   */\r\n  public maybeRemoveQuery(query: Query): void {\r\n    if (query.observers.length === 0) {\r\n      query.clear();\r\n      delete this._queries[buildTypeKey(query.types)];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds the entity to any matching query in the query manage\r\n   * @param entity\r\n   */\r\n  public addEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      if (this._queries[queryType]) {\r\n        this._queries[queryType].addEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from queries if the removed component disqualifies it\r\n   * @param entity\r\n   * @param component\r\n   */\r\n  public removeComponent(entity: Entity, component: Component) {\r\n    for (const queryType in this._queries) {\r\n      // If the component being removed from an entity is a part of a query,\r\n      // it is now disqualified from that query, remove it\r\n      if (this._queries[queryType].contain(component.type)) {\r\n        this._queries[queryType].removeEntity(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes an entity from all queries it is currently a part of\r\n   * @param entity\r\n   */\r\n  public removeEntity(entity: Entity) {\r\n    for (const queryType in this._queries) {\r\n      this._queries[queryType].removeEntity(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a populated query and returns, if the query already exists that will be returned instead of a new instance\r\n   * @param types\r\n   */\r\n  public createQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const maybeExistingQuery = this.getQuery<T>(types);\r\n    if (maybeExistingQuery) {\r\n      return maybeExistingQuery;\r\n    }\r\n    const query = new Query<T>(types);\r\n    this._addQuery(query);\r\n    return query;\r\n  }\r\n\r\n  /**\r\n   * Retrieves an existing query by types if it exists otherwise returns null\r\n   * @param types\r\n   */\r\n  public getQuery<T extends Component = Component>(types: readonly string[]): Query<T> {\r\n    const key = buildTypeKey(types);\r\n    if (this._queries[key]) {\r\n      return this._queries[key] as Query<T>;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { System, SystemType } from './System';\r\nimport { Scene, Util } from '..';\r\nimport { World } from './World';\r\n\r\nexport interface SystemCtor<T extends System> {\r\n  new (): T;\r\n}\r\n\r\n/**\r\n * The SystemManager is responsible for keeping track of all systems in a scene.\r\n * Systems are scene specific\r\n */\r\nexport class SystemManager<ContextType> {\r\n  /**\r\n   * List of systems, to add a new system call [[SystemManager.addSystem]]\r\n   */\r\n  public systems: System<any, ContextType>[] = [];\r\n  public _keyToSystem: { [key: string]: System<any, ContextType> };\r\n  public initialized = false;\r\n  constructor(private _world: World<ContextType>) {}\r\n\r\n  /**\r\n   * Get a system registered in the manager by type\r\n   * @param systemType\r\n   * @returns\r\n   */\r\n  public get<T extends System>(systemType: SystemCtor<T>): T | null {\r\n    return this.systems.find((s) => s instanceof systemType) as unknown as T;\r\n  }\r\n\r\n  /**\r\n   * Adds a system to the manager, it will now be updated every frame\r\n   * @param system\r\n   */\r\n  public addSystem(system: System<any, ContextType>): void {\r\n    // validate system has types\r\n    if (!system.types || system.types.length === 0) {\r\n      throw new Error(`Attempted to add a System without any types`);\r\n    }\r\n\r\n    const query = this._world.queryManager.createQuery(system.types);\r\n    this.systems.push(system);\r\n    this.systems.sort((a, b) => a.priority - b.priority);\r\n    query.register(system);\r\n    if (this.initialized && system.initialize) {\r\n      system.initialize(this._world.context);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a system from the manager, it will no longer be updated\r\n   * @param system\r\n   */\r\n  public removeSystem(system: System<any, ContextType>) {\r\n    Util.removeItemFromArray(system, this.systems);\r\n    const query = this._world.queryManager.getQuery(system.types);\r\n    if (query) {\r\n      query.unregister(system);\r\n      this._world.queryManager.maybeRemoveQuery(query);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates all systems\r\n   * @param type whether this is an update or draw system\r\n   * @param context context reference\r\n   * @param delta time in milliseconds\r\n   */\r\n  public updateSystems(type: SystemType, context: ContextType, delta: number) {\r\n    if (!this.initialized) {\r\n      this.initialized = true;\r\n      for (const s of this.systems) {\r\n        if (s.initialize) {\r\n          s.initialize(this._world.context);\r\n        }\r\n      }\r\n    }\r\n\r\n    const systems = this.systems.filter((s) => s.systemType === type);\r\n    for (const s of systems) {\r\n      if (s.preupdate) {\r\n        s.preupdate(context, delta);\r\n      }\r\n    }\r\n\r\n    for (const s of systems) {\r\n      // Get entities that match the system types, pre-sort\r\n      const entities = this._world.queryManager.getQuery(s.types).getEntities(s.sort);\r\n      // Initialize entities if needed\r\n      if (context instanceof Scene) {\r\n        for (const entity of entities) {\r\n          entity._initialize(context?.engine);\r\n        }\r\n      }\r\n      s.update(entities, delta);\r\n    }\r\n\r\n    for (const s of systems) {\r\n      if (s.postupdate) {\r\n        s.postupdate(context, delta);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    for (const system of this.systems) {\r\n      this.removeSystem(system);\r\n    }\r\n  }\r\n}\r\n","import { Entity } from './Entity';\r\nimport { EntityManager } from './EntityManager';\r\nimport { QueryManager } from './QueryManager';\r\nimport { System, SystemType } from './System';\r\nimport { SystemManager } from './SystemManager';\r\n\r\n/**\r\n * The World is a self-contained entity component system for a particular context.\r\n */\r\nexport class World<ContextType> {\r\n  public queryManager: QueryManager = new QueryManager(this);\r\n  public entityManager: EntityManager<ContextType> = new EntityManager<ContextType>(this);\r\n  public systemManager: SystemManager<ContextType> = new SystemManager<ContextType>(this);\r\n\r\n  /**\r\n   * The context type is passed to the system updates\r\n   * @param context\r\n   */\r\n  constructor(public context: ContextType) {}\r\n\r\n  /**\r\n   * Update systems by type and time elapsed in milliseconds\r\n   */\r\n  update(type: SystemType, delta: number) {\r\n    if (type === SystemType.Update) {\r\n      this.entityManager.updateEntities(this.context, delta);\r\n    }\r\n    this.systemManager.updateSystems(type, this.context, delta);\r\n    this.entityManager.findEntitiesForRemoval();\r\n    this.entityManager.processComponentRemovals();\r\n    this.entityManager.processEntityRemovals();\r\n  }\r\n\r\n  /**\r\n   * Add an entity to the ECS world\r\n   * @param entity\r\n   */\r\n  add(entity: Entity): void;\r\n  /**\r\n   * Add a system to the ECS world\r\n   * @param system\r\n   */\r\n  add(system: System<any, ContextType>): void;\r\n  add(entityOrSystem: Entity | System<any, ContextType>): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.addEntity(entityOrSystem);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.addSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove an entity from the ECS world\r\n   * @param entity\r\n   */\r\n  remove(entity: Entity, deferred?: boolean): void;\r\n  /**\r\n   * Remove a system from the ECS world\r\n   * @param system\r\n   */\r\n  remove(system: System<any, ContextType>): void;\r\n  remove(entityOrSystem: Entity | System<any, ContextType>, deferred = true): void {\r\n    if (entityOrSystem instanceof Entity) {\r\n      this.entityManager.removeEntity(entityOrSystem, deferred);\r\n    }\r\n\r\n    if (entityOrSystem instanceof System) {\r\n      this.systemManager.removeSystem(entityOrSystem);\r\n    }\r\n  }\r\n\r\n  clearEntities(): void {\r\n    this.entityManager.clear();\r\n  }\r\n\r\n  clearSystems(): void {\r\n    this.systemManager.clear();\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { TransformComponent } from '../EntityComponentSystem';\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\n\nexport class EulerIntegrator {\n  static integrate(transform: TransformComponent, motion: MotionComponent, totalAcc: Vector, elapsedMs: number): void {\n    const seconds = elapsedMs / 1000;\n    motion.vel.addEqual(totalAcc.scale(seconds));\n    transform.pos.addEqual(motion.vel.scale(seconds)).addEqual(totalAcc.scale(0.5 * seconds * seconds));\n\n    motion.angularVelocity += motion.torque * (1.0 / motion.inertia) * seconds;\n    transform.rotation += motion.angularVelocity * seconds;\n\n    transform.scale.addEqual(motion.scaleFactor.scale(seconds));\n  }\n}\n","import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { Physics } from './Physics';\r\nimport { BodyComponent } from './BodyComponent';\r\nimport { CollisionType } from './CollisionType';\r\nimport { EulerIntegrator } from './Integrator';\r\n\r\nexport class MotionSystem extends System<TransformComponent | MotionComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  update(_entities: Entity[], elapsedMs: number): void {\r\n    let transform: TransformComponent;\r\n    let motion: MotionComponent;\r\n    for (const entity of _entities) {\r\n      transform = entity.get(TransformComponent);\r\n      motion = entity.get(MotionComponent);\r\n\r\n      const optionalBody = entity.get(BodyComponent);\r\n      if (optionalBody?.sleeping) {\r\n        continue;\r\n      }\r\n\r\n      const totalAcc = motion.acc.clone();\r\n      if (optionalBody?.collisionType === CollisionType.Active && optionalBody?.useGravity) {\r\n        totalAcc.addEqual(Physics.gravity);\r\n      }\r\n      optionalBody?.captureOldTransform();\r\n\r\n      // Update transform and motion based on Euler linear algebra\r\n      EulerIntegrator.integrate(transform, motion, totalAcc, elapsedMs);\r\n    }\r\n  }\r\n\r\n  debugDraw(_ctx: CanvasRenderingContext2D) {\r\n    // pass\r\n  }\r\n}\r\n","import { CollisionContact } from '../Detection/CollisionContact';\r\n\r\n/**\r\n * A collision solver figures out how to position colliders such that they are no longer overlapping\r\n *\r\n * Solvers are executed in the order\r\n *\r\n * 1. preSolve\r\n * 2. solveVelocity\r\n * 3. solvePosition\r\n * 4. postSolve\r\n * @inheritdoc\r\n */\r\nexport abstract class CollisionSolver {\r\n  /**\r\n   * Pre-solve is fired on contacts before any resolution is started. It is used for any setup work before collision resolution\r\n   * can proceed. Optionally contacts can be \"opted out\" of any collision processing by calling `contact.cancel()`\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract preSolve(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Post-solve is fired after all resolution is complete\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract postSolve(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solve velocity adjusts the velocity of colliders so that they are not overlapping or will not be overlapping from velocity\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract solveVelocity(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solve position adjust the position of collders so that they are not overlapping\r\n   * @param contacts\r\n   * @inheritdoc\r\n   */\r\n  abstract solvePosition(contacts: CollisionContact[]): void;\r\n\r\n  /**\r\n   * Solves overlapping contact in\r\n   *\r\n   * Solvers are executed in the order\r\n   * 1. preSolve\r\n   * 2. solveVelocity\r\n   * 3. solvePosition\r\n   * 4. postSolve\r\n   * @param contacts\r\n   */\r\n  public solve(contacts: CollisionContact[]): CollisionContact[] {\r\n    // Events and init\r\n    this.preSolve(contacts);\r\n\r\n    // Remove any canceled contacts\r\n    contacts = contacts.filter(c => !c.isCanceled());\r\n\r\n    // Solve velocity first\r\n    this.solveVelocity(contacts);\r\n\r\n    // Solve position last because non-overlap is the most important\r\n    this.solvePosition(contacts);\r\n\r\n    // Events and any contact house-keeping the solver needs\r\n    this.postSolve(contacts);\r\n\r\n    return contacts;\r\n  }\r\n}","import { PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { Side } from '../Side';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\n\r\n/**\r\n * ArcadeSolver is the default in Excalibur. It solves collisions so that there is no overlap between contacts,\r\n * and negates velocity along the collision normal.\r\n *\r\n * This is usually the type of collisions used for 2D games that don't need a more realistic collision simulation.\r\n *\r\n */\r\nexport class ArcadeSolver extends CollisionSolver {\r\n  public preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n      }\r\n      const side = Side.fromDirection(contact.mtv);\r\n      const mtv = contact.mtv.negate();\r\n      // Publish collision events on both participants\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, mtv));\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), mtv.negate())\r\n      );\r\n    }\r\n  }\r\n\r\n  public solvePosition(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      let mtv = contact.mtv;\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        if (bodyA.collisionType === CollisionType.Active && bodyB.collisionType === CollisionType.Active) {\r\n          // split overlaps if both are Active\r\n          mtv = mtv.scale(0.5);\r\n        }\r\n\r\n        // Resolve overlaps\r\n        if (bodyA.collisionType === CollisionType.Active) {\r\n          bodyA.pos.x -= mtv.x;\r\n          bodyA.pos.y -= mtv.y;\r\n        }\r\n\r\n        if (bodyB.collisionType === CollisionType.Active) {\r\n          bodyB.pos.x += mtv.x;\r\n          bodyB.pos.y += mtv.y;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public solveVelocity(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const colliderA = contact.colliderA;\r\n      const colliderB = contact.colliderB;\r\n      const bodyA = colliderA.owner?.get(BodyComponent);\r\n      const bodyB = colliderB.owner?.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        const normal = contact.normal;\r\n        const opposite = normal.negate();\r\n\r\n        // Cancel out velocity opposite direction of collision normal\r\n        if (bodyA.collisionType === CollisionType.Active) {\r\n          const velAdj = normal.scale(normal.dot(bodyA.vel.negate()));\r\n          bodyA.vel = bodyA.vel.add(velAdj);\r\n        }\r\n\r\n        if (bodyB.collisionType === CollisionType.Active) {\r\n          const velAdj = opposite.scale(opposite.dot(bodyB.vel.negate()));\r\n          bodyB.vel = bodyB.vel.add(velAdj);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../../Math/vector';\nimport { BodyComponent } from '../BodyComponent';\nimport { CollisionContact } from '../Detection/CollisionContact';\n\n/**\n * Holds information about contact points, meant to be reused over multiple frames of contact\n */\nexport class ContactConstraintPoint {\n  constructor(public point: Vector, public local: Vector, public contact: CollisionContact) {\n    this.update();\n  }\n\n  /**\n   * Updates the contact information\n   */\n  update() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n\n    if (bodyA && bodyB) {\n      const normal = this.contact.normal;\n      const tangent = this.contact.tangent;\n\n      this.aToContact = this.point.sub(bodyA.pos);\n      this.bToContact = this.point.sub(bodyB.pos);\n\n      const aToContactNormal = this.aToContact.cross(normal);\n      const bToContactNormal = this.bToContact.cross(normal);\n\n      this.normalMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactNormal * aToContactNormal +\n        bodyB.inverseInertia * bToContactNormal * bToContactNormal;\n\n      const aToContactTangent = this.aToContact.cross(tangent);\n      const bToContactTangent = this.bToContact.cross(tangent);\n\n      this.tangentMass =\n        bodyA.inverseMass +\n        bodyB.inverseMass +\n        bodyA.inverseInertia * aToContactTangent * aToContactTangent +\n        bodyB.inverseInertia * bToContactTangent * bToContactTangent;\n    }\n\n    return this;\n  }\n\n  /**\n   * Returns the relative velocity betwen bodyA and bodyB\n   */\n  public getRelativeVelocity() {\n    const bodyA = this.contact.colliderA.owner?.get(BodyComponent);\n    const bodyB = this.contact.colliderB.owner?.get(BodyComponent);\n    if (bodyA && bodyB) {\n      // Relative velocity in linear terms\n      // Angular to linear velocity formula -> omega = velocity/radius so omega x radius = velocity\n      const velA = bodyA.vel.add(Vector.cross(bodyA.angularVelocity, this.aToContact));\n      const velB = bodyB.vel.add(Vector.cross(bodyB.angularVelocity, this.bToContact));\n      return velB.sub(velA);\n    }\n    return Vector.Zero;\n  }\n\n  /**\n   * Impulse accumulated over time in normal direction\n   */\n  public normalImpulse: number = 0;\n\n  /**\n   * Impulse accumulated over time in the tangent direction\n   */\n  public tangentImpulse: number = 0;\n\n  /**\n   * Effective mass seen in the normal direction\n   */\n  public normalMass: number = 0;\n\n  /**\n   * Effective mass seen in the tangent direction\n   */\n  public tangentMass: number = 0;\n\n  /**\n   * Direction from center of mass of bodyA to contact point\n   */\n  public aToContact: Vector = new Vector(0, 0);\n\n  /**\n   * Direction from center of mass of bodyB to contact point\n   */\n  public bToContact: Vector = new Vector(0, 0);\n}\n","import { CollisionPostSolveEvent, CollisionPreSolveEvent, PostCollisionEvent, PreCollisionEvent } from '../../Events';\r\nimport { clamp } from '../../Util/Util';\r\nimport { CollisionContact } from '../Detection/CollisionContact';\r\nimport { CollisionType } from '../CollisionType';\r\nimport { ContactConstraintPoint } from './ContactConstraintPoint';\r\nimport { Side } from '../Side';\r\nimport { Physics } from '../Physics';\r\nimport { CollisionSolver } from './Solver';\r\nimport { BodyComponent } from '../BodyComponent';\r\nimport { CollisionJumpTable } from '../Colliders/CollisionJumpTable';\r\n\r\nexport class RealisticSolver extends CollisionSolver {\r\n  lastFrameContacts: Map<string, CollisionContact> = new Map();\r\n\r\n  // map contact id to contact points\r\n  idToContactConstraint: Map<string, ContactConstraintPoint[]> = new Map();\r\n\r\n  getContactConstraints(id: string) {\r\n    return this.idToContactConstraint.get(id) ?? [];\r\n  }\r\n\r\n  preSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('precollision', new PreCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'precollision',\r\n        new PreCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'beforecollisionresolve',\r\n        new CollisionPreSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n\r\n      // Match awake state for sleeping\r\n      contact.matchAwake();\r\n    }\r\n\r\n    // Keep track of contacts that done\r\n    const finishedContactIds = Array.from(this.idToContactConstraint.keys());\r\n    for (const contact of contacts) {\r\n      // Remove all current contacts that are not done\r\n      const index = finishedContactIds.indexOf(contact.id);\r\n      if (index > -1) {\r\n        finishedContactIds.splice(index, 1);\r\n      }\r\n      const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n      let pointIndex = 0;\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        for (const point of contact.points) {\r\n          const normal = contact.normal;\r\n          const tangent = contact.tangent;\r\n\r\n          const aToContact = point.sub(bodyA.pos);\r\n          const bToContact = point.sub(bodyB.pos);\r\n\r\n          const aToContactNormal = aToContact.cross(normal);\r\n          const bToContactNormal = bToContact.cross(normal);\r\n\r\n          const normalMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactNormal * aToContactNormal +\r\n            bodyB.inverseInertia * bToContactNormal * bToContactNormal;\r\n\r\n          const aToContactTangent = aToContact.cross(tangent);\r\n          const bToContactTangent = bToContact.cross(tangent);\r\n\r\n          const tangentMass =\r\n            bodyA.inverseMass +\r\n            bodyB.inverseMass +\r\n            bodyA.inverseInertia * aToContactTangent * aToContactTangent +\r\n            bodyB.inverseInertia * bToContactTangent * bToContactTangent;\r\n\r\n          // Preserve normal/tangent impulse by re-using the contact point if it's close\r\n          if (contactPoints[pointIndex] && contactPoints[pointIndex]?.point?.squareDistance(point) < 4) {\r\n            contactPoints[pointIndex].point = point;\r\n            contactPoints[pointIndex].local = contact.localPoints[pointIndex];\r\n          } else {\r\n            // new contact if it's not close or doesn't exist\r\n            contactPoints[pointIndex] = new ContactConstraintPoint(point, contact.localPoints[pointIndex], contact);\r\n          }\r\n\r\n          // Update contact point calculations\r\n          contactPoints[pointIndex].aToContact = aToContact;\r\n          contactPoints[pointIndex].bToContact = bToContact;\r\n          contactPoints[pointIndex].normalMass = normalMass;\r\n          contactPoints[pointIndex].tangentMass = tangentMass;\r\n\r\n          pointIndex++;\r\n        }\r\n      }\r\n      this.idToContactConstraint.set(contact.id, contactPoints);\r\n    }\r\n\r\n    // Clean up any contacts that did not occur last frame\r\n    for (const id of finishedContactIds) {\r\n      this.idToContactConstraint.delete(id);\r\n    }\r\n\r\n    // Warm contacts with accumulated impulse\r\n    // Useful for tall stacks\r\n    if (Physics.warmStart) {\r\n      this.warmStart(contacts);\r\n    } else {\r\n      for (const contact of contacts) {\r\n        const contactPoints = this.getContactConstraints(contact.id);\r\n        for (const point of contactPoints) {\r\n          point.normalImpulse = 0;\r\n          point.tangentImpulse = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  postSolve(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner.get(BodyComponent);\r\n\r\n      if (bodyA && bodyB) {\r\n        // Skip post solve for active+passive collisions\r\n        if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n          continue;\r\n        }\r\n\r\n        // Update motion values for sleeping\r\n        bodyA.updateMotion();\r\n        bodyB.updateMotion();\r\n      }\r\n\r\n      // Publish collision events on both participants\r\n      const side = Side.fromDirection(contact.mtv);\r\n      contact.colliderA.events.emit('postcollision', new PostCollisionEvent(contact.colliderA, contact.colliderB, side, contact.mtv));\r\n      contact.colliderA.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderA, contact.colliderB, side, contact.mtv, contact) as any\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'postcollision',\r\n        new PostCollisionEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate())\r\n      );\r\n      contact.colliderB.events.emit(\r\n        'aftercollisionresolve',\r\n        new CollisionPostSolveEvent(contact.colliderB, contact.colliderA, Side.getOpposite(side), contact.mtv.negate(), contact) as any\r\n      );\r\n    }\r\n\r\n    // Store contacts\r\n    this.lastFrameContacts.clear();\r\n    for (const c of contacts) {\r\n      this.lastFrameContacts.set(c.id, c);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Warm up body's based on previous frame contact points\r\n   * @param contacts\r\n   */\r\n  warmStart(contacts: CollisionContact[]) {\r\n    for (const contact of contacts) {\r\n      const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n      const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n      if (bodyA && bodyB) {\r\n        const contactPoints = this.idToContactConstraint.get(contact.id) ?? [];\r\n        for (const point of contactPoints) {\r\n          if (Physics.warmStart) {\r\n            const normalImpulse = contact.normal.scale(point.normalImpulse);\r\n            const tangentImpulse = contact.tangent.scale(point.tangentImpulse);\r\n            const impulse = normalImpulse.add(tangentImpulse);\r\n\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          } else {\r\n            point.normalImpulse = 0;\r\n            point.tangentImpulse = 0;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Iteratively solve the position overlap constraint\r\n   * @param contacts\r\n   */\r\n  solvePosition(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.positionIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n          for (const point of constraints) {\r\n            const normal = contact.normal;\r\n            const separation = CollisionJumpTable.FindContactSeparation(contact, point.local);\r\n\r\n            const steeringConstant = Physics.steeringFactor; //0.2;\r\n            const maxCorrection = -5;\r\n            const slop = Physics.slop; //1;\r\n\r\n            // Clamp to avoid over-correction\r\n            // Remember that we are shooting for 0 overlap in the end\r\n            const steeringForce = clamp(steeringConstant * (separation + slop), maxCorrection, 0);\r\n            const impulse = normal.scale(-steeringForce / point.normalMass);\r\n\r\n            // This is a pseudo impulse, meaning we aren't doing a real impulse calculation\r\n            // We adjust position and rotation instead of doing the velocity\r\n            if (bodyA.collisionType === CollisionType.Active) {\r\n              bodyA.pos = bodyA.pos.add(impulse.negate().scale(bodyA.inverseMass));\r\n              bodyA.rotation -= point.aToContact.cross(impulse) * bodyA.inverseInertia;\r\n            }\r\n\r\n            if (bodyB.collisionType === CollisionType.Active) {\r\n              bodyB.pos = bodyB.pos.add(impulse.scale(bodyB.inverseMass));\r\n              bodyB.rotation += point.bToContact.cross(impulse) * bodyB.inverseInertia;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  solveVelocity(contacts: CollisionContact[]) {\r\n    for (let i = 0; i < Physics.velocityIterations; i++) {\r\n      for (const contact of contacts) {\r\n        const bodyA = contact.colliderA.owner?.get(BodyComponent);\r\n        const bodyB = contact.colliderB.owner?.get(BodyComponent);\r\n\r\n        if (bodyA && bodyB) {\r\n          // Skip solving active+passive\r\n          if (bodyA.collisionType === CollisionType.Passive || bodyB.collisionType === CollisionType.Passive) {\r\n            continue;\r\n          }\r\n\r\n          const restitution = bodyA.bounciness * bodyB.bounciness;\r\n          const friction = Math.min(bodyA.friction, bodyB.friction);\r\n\r\n          const constraints = this.idToContactConstraint.get(contact.id) ?? [];\r\n\r\n          for (const point of constraints) {\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Negate velocity in tangent direction to simulate friction\r\n            const tangentVelocity = -relativeVelocity.dot(contact.tangent);\r\n            let impulseDelta = tangentVelocity / point.tangentMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2006 talk\r\n            // Correct clamping https://github.com/erincatto/box2d-lite/blob/master/docs/GDC2006_Catto_Erin_PhysicsTutorial.pdf\r\n            // Accumulated fiction impulse is always between -uMaxFriction < dT < uMaxFriction\r\n            // But deltas can vary\r\n            const maxFriction = friction * point.normalImpulse;\r\n            const newImpulse = clamp(point.tangentImpulse + impulseDelta, -maxFriction, maxFriction);\r\n            impulseDelta = newImpulse - point.tangentImpulse;\r\n            point.tangentImpulse = newImpulse;\r\n\r\n            const impulse = contact.tangent.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n\r\n          for (const point of constraints) {\r\n            // Need to recalc relative velocity because the previous step could have changed vel\r\n            const relativeVelocity = point.getRelativeVelocity();\r\n\r\n            // Compute impulse in normal direction\r\n            const normalVelocity = relativeVelocity.dot(contact.normal);\r\n            // See https://en.wikipedia.org/wiki/Collision_response\r\n            let impulseDelta = (-(1 + restitution) * normalVelocity) / point.normalMass;\r\n\r\n            // Clamping based in Erin Catto's GDC 2014 talk\r\n            // Accumulated impulse stored in the contact is always positive (dV > 0)\r\n            // But deltas can be negative\r\n            const newImpulse = Math.max(point.normalImpulse + impulseDelta, 0);\r\n            impulseDelta = newImpulse - point.normalImpulse;\r\n            point.normalImpulse = newImpulse;\r\n\r\n            const impulse = contact.normal.scale(impulseDelta);\r\n            bodyA.applyImpulse(point.point, impulse.negate());\r\n            bodyB.applyImpulse(point.point, impulse);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { AddedEntity, isAddedSystemEntity, RemovedEntity, System, SystemType } from '../EntityComponentSystem/System';\r\nimport { CollisionEndEvent, CollisionStartEvent, ContactEndEvent, ContactStartEvent } from '../Events';\r\nimport { CollisionResolutionStrategy, Physics } from './Physics';\r\nimport { ArcadeSolver } from './Solver/ArcadeSolver';\r\nimport { Collider } from './Colliders/Collider';\r\nimport { CollisionContact } from './Detection/CollisionContact';\r\nimport { DynamicTreeCollisionProcessor } from './Detection/DynamicTreeCollisionProcessor';\r\nimport { RealisticSolver } from './Solver/RealisticSolver';\r\nimport { CollisionSolver } from './Solver/Solver';\r\nimport { ColliderComponent } from './ColliderComponent';\r\nimport { CompositeCollider } from './Colliders/CompositeCollider';\r\nimport { Engine, ExcaliburGraphicsContext, Scene } from '..';\r\n\r\nexport class CollisionSystem extends System<TransformComponent | MotionComponent | ColliderComponent> {\r\n  public readonly types = ['ex.transform', 'ex.motion', 'ex.collider'] as const;\r\n  public systemType = SystemType.Update;\r\n  public priority = -1;\r\n\r\n  private _engine: Engine;\r\n  private _realisticSolver = new RealisticSolver();\r\n  private _arcadeSolver = new ArcadeSolver();\r\n  private _processor = new DynamicTreeCollisionProcessor();\r\n  private _lastFrameContacts = new Map<string, CollisionContact>();\r\n  private _currentFrameContacts = new Map<string, CollisionContact>();\r\n\r\n  private _trackCollider = (c: Collider) => this._processor.track(c);\r\n  private _untrackCollider = (c: Collider) => this._processor.untrack(c);\r\n\r\n  notify(message: AddedEntity | RemovedEntity) {\r\n    if (isAddedSystemEntity(message)) {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      colliderComponent.$colliderAdded.subscribe(this._trackCollider);\r\n      colliderComponent.$colliderRemoved.subscribe(this._untrackCollider);\r\n      const collider = colliderComponent.get();\r\n      if (collider) {\r\n        this._processor.track(collider);\r\n      }\r\n    } else {\r\n      const colliderComponent = message.data.get(ColliderComponent);\r\n      const collider = colliderComponent.get();\r\n      if (colliderComponent && collider) {\r\n        this._processor.untrack(collider);\r\n      }\r\n    }\r\n  }\r\n\r\n  initialize(scene: Scene) {\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  update(_entities: Entity[], elapsedMs: number): void {\r\n    if (!Physics.enabled) {\r\n      return;\r\n    }\r\n\r\n    // Collect up all the colliders\r\n    let colliders: Collider[] = [];\r\n    for (const entity of _entities) {\r\n      const colliderComp = entity.get(ColliderComponent);\r\n      const collider = colliderComp?.get();\r\n      if (colliderComp && colliderComp.owner?.active && collider) {\r\n        colliderComp.update();\r\n        if (collider instanceof CompositeCollider) {\r\n          colliders = colliders.concat(collider.getColliders());\r\n        } else {\r\n          colliders.push(collider);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update the spatial partitioning data structures\r\n    // TODO if collider invalid it will break the processor\r\n    // TODO rename \"update\" to something more specific\r\n    this._processor.update(colliders);\r\n\r\n    // Run broadphase on all colliders and locates potential collisions\r\n    const pairs = this._processor.broadphase(colliders, elapsedMs);\r\n\r\n    this._currentFrameContacts.clear();\r\n\r\n    // Given possible pairs find actual contacts\r\n    let contacts = this._processor.narrowphase(pairs, this._engine.debug.stats.currFrame);\r\n\r\n    const solver: CollisionSolver = this.getSolver();\r\n\r\n    // Solve, this resolves the position/velocity so entities arent overlapping\r\n    contacts = solver.solve(contacts);\r\n\r\n    // Record contacts\r\n    contacts.forEach((c) => this._currentFrameContacts.set(c.id, c));\r\n\r\n    // Emit contact start/end events\r\n    this.runContactStartEnd();\r\n\r\n    // reset the last frame cache\r\n    this._lastFrameContacts.clear();\r\n\r\n    // Keep track of collisions contacts that have started or ended\r\n    this._lastFrameContacts = new Map(this._currentFrameContacts);\r\n  }\r\n\r\n  getSolver(): CollisionSolver {\r\n    return Physics.collisionResolutionStrategy === CollisionResolutionStrategy.Realistic ? this._realisticSolver : this._arcadeSolver;\r\n  }\r\n\r\n  debug(ex: ExcaliburGraphicsContext) {\r\n    this._processor.debug(ex);\r\n  }\r\n\r\n  public runContactStartEnd() {\r\n    for (const [id, c] of this._currentFrameContacts) {\r\n      // find all new contacts\r\n      if (!this._lastFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionstart', new CollisionStartEvent(colliderA, colliderB, c));\r\n        colliderA.events.emit('contactstart', new ContactStartEvent(colliderA, colliderB, c) as any);\r\n        colliderB.events.emit('collisionstart', new CollisionStartEvent(colliderB, colliderA, c));\r\n        colliderB.events.emit('contactstart', new ContactStartEvent(colliderB, colliderA, c) as any);\r\n      }\r\n    }\r\n\r\n    // find all contacts taht have ceased\r\n    for (const [id, c] of this._lastFrameContacts) {\r\n      if (!this._currentFrameContacts.has(id)) {\r\n        const colliderA = c.colliderA;\r\n        const colliderB = c.colliderB;\r\n        colliderA.events.emit('collisionend', new CollisionEndEvent(colliderA, colliderB));\r\n        colliderA.events.emit('contactend', new ContactEndEvent(colliderA, colliderB) as any);\r\n        colliderB.events.emit('collisionend', new CollisionEndEvent(colliderB, colliderA));\r\n        colliderB.events.emit('contactend', new ContactEndEvent(colliderB, colliderA) as any);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Graphic, GraphicOptions } from './Graphic';\r\nimport { clamp } from '../Util/Util';\r\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { EventDispatcher } from '../EventDispatcher';\r\nimport { SpriteSheet } from './SpriteSheet';\r\nimport { Logger } from '../Util/Log';\r\nimport { Engine, LegacyDrawing } from '..';\r\nimport { Sprite } from '.';\r\n\r\nexport interface HasTick {\r\n  /**\r\n   *\r\n   * @param elapsedMilliseconds The amount of real world time in milliseconds that has elapsed that must be updated in the animation\r\n   * @param idempotencyToken Optional idempotencyToken prevents a ticking animation from updating twice per frame\r\n   */\r\n  tick(elapsedMilliseconds: number, idempotencyToken?: number): void;\r\n}\r\n\r\nexport enum AnimationDirection {\r\n  /**\r\n   * Animation is playing forwards\r\n   */\r\n  Forward = 'forward',\r\n  /**\r\n   * Animation is play backwards\r\n   */\r\n  Backward = 'backward'\r\n}\r\n\r\nexport enum AnimationStrategy {\r\n  /**\r\n   * Animation ends without displaying anything\r\n   */\r\n  End = 'end',\r\n  /**\r\n   * Animation loops to the first frame after the last frame\r\n   */\r\n  Loop = 'loop',\r\n  /**\r\n   * Animation plays to the last frame, then backwards to the first frame, then repeats\r\n   */\r\n  PingPong = 'pingpong',\r\n  /**\r\n   * Animation ends stopping on the last frame\r\n   */\r\n  Freeze = 'freeze'\r\n}\r\n\r\n/**\r\n * Frame of animation\r\n */\r\nexport interface Frame {\r\n  /**\r\n   * Optionally specify a graphic to show, no graphic shows an empty frame\r\n   */\r\n  graphic?: Graphic;\r\n  /**\r\n   * Optionally specify the number of ms the frame should be visible, overrids the animation duration (default 100 ms)\r\n   */\r\n  duration?: number;\r\n}\r\n\r\n/**\r\n * Animation options for building an animation via constructor.\r\n */\r\nexport interface AnimationOptions {\r\n  /**\r\n   * List of frames in the order you wish to play them\r\n   */\r\n  frames: Frame[];\r\n  /**\r\n   * Optionally reverse the direction of play\r\n   */\r\n  reverse?: boolean;\r\n  /**\r\n   * Optionally specify a default frame duration in ms (Default is 1000)\r\n   */\r\n  frameDuration?: number;\r\n  /**\r\n   * Optionally specify a total duration of the animation in ms to calculate each frame's duration\r\n   */\r\n  totalDuration?: number;\r\n  /**\r\n   * Optionally specify the [[AnimationStrategy]] for the Animation\r\n   */\r\n  strategy?: AnimationStrategy;\r\n}\r\n\r\n// TODO wire up to new Emitter\r\nexport type AnimationEvents = {\r\n  frame: Frame;\r\n  loop: Animation;\r\n  ended: Animation;\r\n};\r\n\r\n/**\r\n * Create an Animation given a list of [[Frame|frames]] in [[AnimationOptions]]\r\n *\r\n * To create an Animation from a [[SpriteSheet]], use [[Animation.fromSpriteSheet]]\r\n */\r\nexport class Animation extends Graphic implements HasTick {\r\n  private static _LOGGER = Logger.getInstance();\r\n  public events = new EventDispatcher<any>(this); // TODO replace with new Emitter\r\n  public frames: Frame[] = [];\r\n  public strategy: AnimationStrategy = AnimationStrategy.Loop;\r\n  public frameDuration: number = 100;\r\n  public timeScale: number = 1;\r\n\r\n  private _idempotencyToken = -1;\r\n\r\n  private _firstTick = true;\r\n  private _currentFrame = 0;\r\n  private _timeLeftInFrame = 0;\r\n  private _direction = 1; // TODO only used in ping-pong\r\n  private _done = false;\r\n  private _playing = true;\r\n\r\n  constructor(options: GraphicOptions & AnimationOptions) {\r\n    super(options);\r\n    this.frames = options.frames;\r\n    this.strategy = options.strategy ?? this.strategy;\r\n    this.frameDuration = options.totalDuration ? options.totalDuration / this.frames.length : options.frameDuration ?? this.frameDuration;\r\n    if (options.reverse) {\r\n      this.reverse();\r\n    }\r\n    this.goToFrame(0);\r\n  }\r\n\r\n  public clone(): Animation {\r\n    return new Animation({\r\n      frames: this.frames.map((f) => ({ ...f })),\r\n      frameDuration: this.frameDuration,\r\n      reverse: this._reversed,\r\n      strategy: this.strategy,\r\n      ...this.cloneGraphicOptions()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Create an Animation from a [[SpriteSheet]], a list of indices into the sprite sheet, a duration per frame\r\n   * and optional [[AnimationStrategy]]\r\n   *\r\n   * Example:\r\n   * ```typescript\r\n   * const spriteSheet = SpriteSheet.fromImageSource({...});\r\n   *\r\n   * const anim = Animation.fromSpriteSheet(spriteSheet, range(0, 5), 200, AnimationStrategy.Loop);\r\n   * ```\r\n   *\r\n   * @param spriteSheet\r\n   * @param frameIndices\r\n   * @param durationPerFrameMs\r\n   * @param strategy\r\n   */\r\n  public static fromSpriteSheet(\r\n    spriteSheet: SpriteSheet,\r\n    frameIndices: number[],\r\n    durationPerFrameMs: number,\r\n    strategy: AnimationStrategy = AnimationStrategy.Loop\r\n  ): Animation {\r\n    const maxIndex = spriteSheet.sprites.length - 1;\r\n    const invalidIndices = frameIndices.filter((index) => index < 0 || index > maxIndex);\r\n    if (invalidIndices.length) {\r\n      Animation._LOGGER.warn(\r\n        `Indices into SpriteSheet were provided that don\\'t exist: ${invalidIndices.join(',')} no frame will be shown`\r\n      );\r\n    }\r\n    return new Animation({\r\n      frames: spriteSheet.sprites\r\n        .filter((_, index) => frameIndices.indexOf(index) > -1)\r\n        .map((f) => ({\r\n          graphic: f,\r\n          duration: durationPerFrameMs\r\n        })),\r\n      strategy: strategy\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Converts an animation to a legacy animation\r\n   * @deprecated\r\n   * @param engine\r\n   * @param animation\r\n   * @returns LegacyDrawing.Animation\r\n   */\r\n  public static toLegacyAnimation(engine: Engine, animation: Animation): LegacyDrawing.Animation {\r\n    const legacySprites = animation.frames.map(f => Sprite.toLegacySprite(f.graphic as Sprite));\r\n    return new LegacyDrawing.Animation({\r\n      sprites: legacySprites,\r\n      loop: animation.strategy === AnimationStrategy.Loop,\r\n      freezeFrame: animation.strategy === AnimationStrategy.Freeze ? legacySprites.length - 1 : undefined,\r\n      speed: animation.frameDuration,\r\n      engine: engine\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Returns the current Frame of the animation\r\n   */\r\n  public get currentFrame(): Frame | null {\r\n    if (this._currentFrame >= 0 && this._currentFrame < this.frames.length) {\r\n      return this.frames[this._currentFrame];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Returns the current frame index of the animation\r\n   */\r\n  public get currentFrameIndex(): number {\r\n    return this._currentFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is playing\r\n   */\r\n  public get isPlaying(): boolean {\r\n    return this._playing;\r\n  }\r\n\r\n  private _reversed = false;\r\n  /**\r\n   * Reverses the play direction of the Animation, this preserves the current frame\r\n   */\r\n  public reverse(): void {\r\n    // Don't mutate with the original frame list, create a copy\r\n    this.frames = this.frames.slice().reverse();\r\n    this._reversed = !this._reversed;\r\n  }\r\n\r\n  /**\r\n   * Returns the current play direction of the animation\r\n   */\r\n  public get direction(): AnimationDirection {\r\n    // Keep logically consistent with ping-pong direction\r\n    // If ping-pong is forward = 1 and reversed is true then we are logically reversed\r\n    const reversed = (this._reversed && this._direction === 1) ? true : false;\r\n    return reversed ? AnimationDirection.Backward : AnimationDirection.Forward;\r\n  }\r\n\r\n  /**\r\n   * Plays or resumes the animation from the current frame\r\n   */\r\n  public play(): void {\r\n    this._playing = true;\r\n  }\r\n\r\n  /**\r\n   * Pauses the animation on the current frame\r\n   */\r\n  public pause(): void {\r\n    this._playing = false;\r\n    this._firstTick = true; // firstTick must be set to emit the proper frame event\r\n  }\r\n\r\n  /**\r\n   * Reset the animation back to the beginning, including if the animation were done\r\n   */\r\n  public reset(): void {\r\n    this._done = false;\r\n    this._firstTick = true;\r\n    this._currentFrame = 0;\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation can end\r\n   */\r\n  public get canFinish(): boolean {\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.End:\r\n      case AnimationStrategy.Freeze: {\r\n        return true;\r\n      }\r\n      default: {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns `true` if the animation is done, for looping type animations\r\n   * `ex.AnimationStrategy.PingPong` and `ex.AnimationStrategy.Loop` this will always return `false`\r\n   *\r\n   * See the `ex.Animation.canFinish()` method to know if an animation type can end\r\n   */\r\n  public get done(): boolean {\r\n    return this._done;\r\n  }\r\n\r\n  /**\r\n   * Jump the animation immediately to a specific frame if it exists\r\n   * @param frameNumber\r\n   */\r\n  public goToFrame(frameNumber: number) {\r\n    this._currentFrame = frameNumber;\r\n    this._timeLeftInFrame = this.frameDuration;\r\n    const maybeFrame = this.frames[this._currentFrame];\r\n    if (maybeFrame && !this._done) {\r\n      this._timeLeftInFrame = maybeFrame?.duration || this.frameDuration;\r\n      this.width = maybeFrame.graphic?.width;\r\n      this.height = maybeFrame.graphic?.height;\r\n      this.events.emit('frame', maybeFrame as any);\r\n    }\r\n  }\r\n\r\n  private _nextFrame(): number {\r\n    const currentFrame = this._currentFrame;\r\n    if (this._done) {\r\n      return currentFrame;\r\n    }\r\n    let next = -1;\r\n\r\n    switch (this.strategy) {\r\n      case AnimationStrategy.Loop: {\r\n        next = (currentFrame + 1) % this.frames.length;\r\n        if (next === 0) {\r\n          this.events.emit('loop', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.End: {\r\n        next = currentFrame + 1;\r\n        if (next >= this.frames.length) {\r\n          this._done = true;\r\n          this._currentFrame = this.frames.length;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.Freeze: {\r\n        next = clamp(currentFrame + 1, 0, this.frames.length - 1);\r\n        if (next >= this.frames.length - 1) {\r\n          this._done = true;\r\n          this.events.emit('end', this as any);\r\n        }\r\n        break;\r\n      }\r\n      case AnimationStrategy.PingPong: {\r\n        if (currentFrame + this._direction >= this.frames.length) {\r\n          this._direction = -1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        if (currentFrame + this._direction < 0) {\r\n          this._direction = 1;\r\n          this.events.emit('loop', this as any);\r\n        }\r\n\r\n        next = currentFrame + (this._direction % this.frames.length);\r\n        break;\r\n      }\r\n    }\r\n    return next;\r\n  }\r\n\r\n  /**\r\n   * Called internally by Excalibur to update the state of the animation potential update the current frame\r\n   * @param elapsedMilliseconds Milliseconds elapsed\r\n   * @param idempotencyToken Prevents double ticking in a frame by passing a unique token to the frame\r\n   */\r\n  public tick(elapsedMilliseconds: number, idempotencyToken: number = 0): void {\r\n    if (this._idempotencyToken === idempotencyToken) {\r\n      return;\r\n    }\r\n    this._idempotencyToken = idempotencyToken;\r\n    if (!this._playing) {\r\n      return;\r\n    }\r\n\r\n    // if it's the first frame emit frame event\r\n    if (this._firstTick) {\r\n      this._firstTick = false;\r\n      this.events.emit('frame', this.currentFrame as any);\r\n    }\r\n\r\n    this._timeLeftInFrame -= elapsedMilliseconds * this.timeScale;\r\n    if (this._timeLeftInFrame <= 0) {\r\n      this.goToFrame(this._nextFrame());\r\n    }\r\n    this._updateDimensions();\r\n  }\r\n\r\n  private _updateDimensions() {\r\n    if (this.currentFrame) {\r\n      this.width = this.currentFrame.graphic?.width;\r\n      this.height = this.currentFrame.graphic?.height;\r\n    }\r\n  }\r\n\r\n  protected _drawImage(ctx: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.currentFrame) {\r\n      this.currentFrame.graphic.draw(ctx, x, y);\r\n    }\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Actor } from './Actor';\r\nimport { Color } from './Color';\r\nimport { Vector, vec } from './Math/vector';\r\nimport * as Util from './Util/Util';\r\nimport * as DrawUtil from './Util/DrawUtil';\r\nimport * as Traits from './Traits/Index';\r\nimport { Configurable } from './Configurable';\r\nimport { Random } from './Math/Random';\r\nimport { CollisionType } from './Collision/CollisionType';\r\nimport { TransformComponent } from './EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsComponent } from './Graphics/GraphicsComponent';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { CanvasDrawComponent } from './Drawing/Index';\r\nimport { Sprite } from './Graphics/Sprite';\r\nimport { LegacyDrawing } from '.';\r\n\r\n/**\r\n * An enum that represents the types of emitter nozzles\r\n */\r\nexport enum EmitterType {\r\n  /**\r\n   * Constant for the circular emitter type\r\n   */\r\n  Circle,\r\n  /**\r\n   * Constant for the rectangular emitter type\r\n   */\r\n  Rectangle\r\n}\r\n\r\n/**\r\n * @hidden\r\n */\r\nexport class ParticleImpl extends Entity {\r\n  public position: Vector = new Vector(0, 0);\r\n  public velocity: Vector = new Vector(0, 0);\r\n  public acceleration: Vector = new Vector(0, 0);\r\n  public particleRotationalVelocity: number = 0;\r\n  public currentRotation: number = 0;\r\n\r\n  public focus: Vector = null;\r\n  public focusAccel: number = 0;\r\n  public opacity: number = 1;\r\n  public beginColor: Color = Color.White;\r\n  public endColor: Color = Color.White;\r\n\r\n  // Life is counted in ms\r\n  public life: number = 300;\r\n  public fadeFlag: boolean = false;\r\n\r\n  // Color transitions\r\n  private _rRate: number = 1;\r\n  private _gRate: number = 1;\r\n  private _bRate: number = 1;\r\n  private _aRate: number = 0;\r\n  private _currentColor: Color = Color.White;\r\n\r\n  public emitter: ParticleEmitter = null;\r\n  public particleSize: number = 5;\r\n  public particleSprite: LegacyDrawing.Sprite = null;\r\n\r\n  public startSize: number;\r\n  public endSize: number;\r\n  public sizeRate: number = 0;\r\n  public elapsedMultiplier: number = 0;\r\n\r\n  public visible = true;\r\n  public isOffscreen = false;\r\n\r\n  public transform: TransformComponent;\r\n  public graphics: GraphicsComponent;\r\n\r\n  constructor(\r\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  ) {\r\n    super();\r\n    let emitter = emitterOrConfig;\r\n    if (emitter && !(emitterOrConfig instanceof ParticleEmitter)) {\r\n      const config = emitterOrConfig;\r\n      emitter = config.emitter;\r\n      life = config.life;\r\n      opacity = config.opacity;\r\n      endColor = config.endColor;\r\n      beginColor = config.beginColor;\r\n      position = config.position;\r\n      velocity = config.velocity;\r\n      acceleration = config.acceleration;\r\n      startSize = config.startSize;\r\n      endSize = config.endSize;\r\n    }\r\n    this.emitter = <ParticleEmitter>emitter;\r\n    this.life = life || this.life;\r\n    this.opacity = opacity || this.opacity;\r\n    this.endColor = endColor || this.endColor.clone();\r\n    this.beginColor = beginColor || this.beginColor.clone();\r\n    this._currentColor = this.beginColor.clone();\r\n    this.position = (position || this.position).add(this.emitter.pos);\r\n    this.velocity = velocity || this.velocity;\r\n    this.acceleration = acceleration || this.acceleration;\r\n    this._rRate = (this.endColor.r - this.beginColor.r) / this.life;\r\n    this._gRate = (this.endColor.g - this.beginColor.g) / this.life;\r\n    this._bRate = (this.endColor.b - this.beginColor.b) / this.life;\r\n    this._aRate = this.opacity / this.life;\r\n\r\n    this.startSize = startSize || 0;\r\n    this.endSize = endSize || 0;\r\n\r\n    if (this.endSize > 0 && this.startSize > 0) {\r\n      this.sizeRate = (this.endSize - this.startSize) / this.life;\r\n      this.particleSize = this.startSize;\r\n    }\r\n\r\n    this.addComponent((this.transform = new TransformComponent()));\r\n    this.addComponent(new CanvasDrawComponent((ctx) => this.draw(ctx)));\r\n    this.addComponent((this.graphics = new GraphicsComponent()));\r\n\r\n    this.transform.pos = this.position;\r\n    this.transform.rotation = this.currentRotation;\r\n    this.transform.scale = vec(1, 1); // TODO wut\r\n    if (this.particleSprite) {\r\n      this.graphics.opacity = this.opacity;\r\n      this.graphics.use(Sprite.fromLegacySprite(this.particleSprite));\r\n    } else {\r\n      this.graphics.onPostDraw = (ctx) => {\r\n        ctx.save();\r\n        this.graphics.opacity = this.opacity;\r\n        const tmpColor = this._currentColor.clone();\r\n        tmpColor.a = 1;\r\n        ctx.debug.drawPoint(vec(0, 0), { color: tmpColor, size: this.particleSize });\r\n        ctx.restore();\r\n      };\r\n    }\r\n  }\r\n\r\n  public kill() {\r\n    this.emitter.removeParticle(this);\r\n  }\r\n\r\n  public update(_engine: Engine, delta: number) {\r\n    this.life = this.life - delta;\r\n    this.elapsedMultiplier = this.elapsedMultiplier + delta;\r\n\r\n    if (this.life < 0) {\r\n      this.kill();\r\n    }\r\n\r\n    if (this.fadeFlag) {\r\n      this.opacity = Util.clamp(this._aRate * this.life, 0.0001, 1);\r\n    }\r\n\r\n    if (this.startSize > 0 && this.endSize > 0) {\r\n      this.particleSize = Util.clamp(\r\n        this.sizeRate * delta + this.particleSize,\r\n        Math.min(this.startSize, this.endSize),\r\n        Math.max(this.startSize, this.endSize)\r\n      );\r\n    }\r\n\r\n    this._currentColor.r = Util.clamp(this._currentColor.r + this._rRate * delta, 0, 255);\r\n    this._currentColor.g = Util.clamp(this._currentColor.g + this._gRate * delta, 0, 255);\r\n    this._currentColor.b = Util.clamp(this._currentColor.b + this._bRate * delta, 0, 255);\r\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\r\n\r\n    if (this.focus) {\r\n      const accel = this.focus\r\n        .sub(this.position)\r\n        .normalize()\r\n        .scale(this.focusAccel)\r\n        .scale(delta / 1000);\r\n      this.velocity = this.velocity.add(accel);\r\n    } else {\r\n      this.velocity = this.velocity.add(this.acceleration.scale(delta / 1000));\r\n    }\r\n    this.position = this.position.add(this.velocity.scale(delta / 1000));\r\n\r\n    if (this.particleRotationalVelocity) {\r\n      this.currentRotation = (this.currentRotation + (this.particleRotationalVelocity * delta) / 1000) % (2 * Math.PI);\r\n    }\r\n\r\n    this.transform.pos = this.position;\r\n    this.transform.rotation = this.currentRotation;\r\n    this.transform.scale = vec(1, 1); // todo wut\r\n    this.graphics.opacity = this.opacity;\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    if (this.particleSprite) {\r\n      this.particleSprite.opacity(this.opacity);\r\n      this.particleSprite.draw(ctx, 0, 0);\r\n      return;\r\n    }\r\n\r\n    ctx.save();\r\n    this._currentColor.a = Util.clamp(this.opacity, 0.0001, 1);\r\n    ctx.fillStyle = this._currentColor.toString();\r\n    ctx.beginPath();\r\n    ctx.arc(0, 0, this.particleSize, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.closePath();\r\n    ctx.restore();\r\n  }\r\n}\r\n\r\nexport interface ParticleArgs extends Partial<ParticleImpl> {\r\n  emitter: ParticleEmitter;\r\n  position?: Vector;\r\n  velocity?: Vector;\r\n  acceleration?: Vector;\r\n  particleRotationalVelocity?: number;\r\n  currentRotation?: number;\r\n  particleSize?: number;\r\n  particleSprite?: LegacyDrawing.Sprite;\r\n}\r\n\r\n/**\r\n * Particle is used in a [[ParticleEmitter]]\r\n */\r\nexport class Particle extends Configurable(ParticleImpl) {\r\n  constructor(config: ParticleArgs);\r\n  constructor(\r\n    emitter: ParticleEmitter,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  );\r\n  constructor(\r\n    emitterOrConfig: ParticleEmitter | ParticleArgs,\r\n    life?: number,\r\n    opacity?: number,\r\n    beginColor?: Color,\r\n    endColor?: Color,\r\n    position?: Vector,\r\n    velocity?: Vector,\r\n    acceleration?: Vector,\r\n    startSize?: number,\r\n    endSize?: number\r\n  ) {\r\n    super(emitterOrConfig, life, opacity, beginColor, endColor, position, velocity, acceleration, startSize, endSize);\r\n  }\r\n}\r\n\r\nexport interface ParticleEmitterArgs {\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  width?: number;\r\n  height?: number;\r\n  isEmitting?: boolean;\r\n  minVel?: number;\r\n  maxVel?: number;\r\n  acceleration?: Vector;\r\n  minAngle?: number;\r\n  maxAngle?: number;\r\n  emitRate?: number;\r\n  particleLife?: number;\r\n  opacity?: number;\r\n  fadeFlag?: boolean;\r\n  focus?: Vector;\r\n  focusAccel?: number;\r\n  startSize?: number;\r\n  endSize?: number;\r\n  minSize?: number;\r\n  maxSize?: number;\r\n  beginColor?: Color;\r\n  endColor?: Color;\r\n  particleSprite?: LegacyDrawing.Sprite;\r\n  emitterType?: EmitterType;\r\n  radius?: number;\r\n  particleRotationalVelocity?: number;\r\n  randomRotation?: boolean;\r\n  random?: Random;\r\n}\r\n\r\n/**\r\n * Using a particle emitter is a great way to create interesting effects\r\n * in your game, like smoke, fire, water, explosions, etc. `ParticleEmitter`\r\n * extend [[Actor]] allowing you to use all of the features that come with.\r\n */\r\nexport class ParticleEmitter extends Actor {\r\n  private _particlesToEmit: number = 0;\r\n\r\n  public numParticles: number = 0;\r\n\r\n  /**\r\n   * Random number generator\r\n   */\r\n  public random: Random;\r\n\r\n  /**\r\n   * Gets or sets the isEmitting flag\r\n   */\r\n  public isEmitting: boolean = true;\r\n  /**\r\n   * Gets or sets the backing particle collection\r\n   */\r\n  public particles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the backing deadParticle collection\r\n   */\r\n  public deadParticles: Particle[] = [];\r\n\r\n  /**\r\n   * Gets or sets the minimum particle velocity\r\n   */\r\n  public minVel: number = 0;\r\n  /**\r\n   * Gets or sets the maximum particle velocity\r\n   */\r\n  public maxVel: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the acceleration vector for all particles\r\n   */\r\n  public acceleration: Vector = new Vector(0, 0);\r\n\r\n  /**\r\n   * Gets or sets the minimum angle in radians\r\n   */\r\n  public minAngle: number = 0;\r\n  /**\r\n   * Gets or sets the maximum angle in radians\r\n   */\r\n  public maxAngle: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the emission rate for particles (particles/sec)\r\n   */\r\n  public emitRate: number = 1; //particles/sec\r\n  /**\r\n   * Gets or sets the life of each particle in milliseconds\r\n   */\r\n  public particleLife: number = 2000;\r\n  /**\r\n   * Gets the opacity of each particle from 0 to 1.0\r\n   */\r\n  public get opacity(): number {\r\n    return super.graphics.opacity;\r\n  }\r\n  /**\r\n   * Gets the opacity of each particle from 0 to 1.0\r\n   */\r\n  public set opacity(opacity: number) {\r\n    super.graphics.opacity = opacity;\r\n  }\r\n  /**\r\n   * Gets or sets the fade flag which causes particles to gradually fade out over the course of their life.\r\n   */\r\n  public fadeFlag: boolean = false;\r\n\r\n  /**\r\n   * Gets or sets the optional focus where all particles should accelerate towards\r\n   */\r\n  public focus: Vector = null;\r\n  /**\r\n   * Gets or sets the acceleration for focusing particles if a focus has been specified\r\n   */\r\n  public focusAccel: number = null;\r\n  /**\r\n   * Gets or sets the optional starting size for the particles\r\n   */\r\n  public startSize: number = null;\r\n  /**\r\n   * Gets or sets the optional ending size for the particles\r\n   */\r\n  public endSize: number = null;\r\n\r\n  /**\r\n   * Gets or sets the minimum size of all particles\r\n   */\r\n  public minSize: number = 5;\r\n  /**\r\n   * Gets or sets the maximum size of all particles\r\n   */\r\n  public maxSize: number = 5;\r\n\r\n  /**\r\n   * Gets or sets the beginning color of all particles\r\n   */\r\n  public beginColor: Color = Color.White;\r\n  /**\r\n   * Gets or sets the ending color of all particles\r\n   */\r\n  public endColor: Color = Color.White;\r\n\r\n  private _og: LegacyDrawing.Sprite = null;\r\n  private _sprite: Sprite = null;\r\n  /**\r\n   * Gets or sets the sprite that a particle should use\r\n   */\r\n  public get particleSprite(): LegacyDrawing.Sprite {\r\n    return this._og;\r\n  }\r\n\r\n  public set particleSprite(val: LegacyDrawing.Sprite) {\r\n    this._og = val;\r\n    if (val) {\r\n      this._sprite = Sprite.fromLegacySprite(val);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the emitter type for the particle emitter\r\n   */\r\n  public emitterType: EmitterType = EmitterType.Rectangle;\r\n\r\n  /**\r\n   * Gets or sets the emitter radius, only takes effect when the [[emitterType]] is [[EmitterType.Circle]]\r\n   */\r\n  public radius: number = 0;\r\n\r\n  /**\r\n   * Gets or sets the particle rotational speed velocity\r\n   */\r\n  public particleRotationalVelocity: number = 0;\r\n\r\n  /**\r\n   * Indicates whether particles should start with a random rotation\r\n   */\r\n  public randomRotation: boolean = false;\r\n\r\n  /**\r\n   * @param config particle emitter options bag\r\n   */\r\n  constructor(config: ParticleEmitterArgs) {\r\n    super({ width: config.width ?? 0, height: config.height ?? 0 });\r\n\r\n    const {\r\n      x,\r\n      y,\r\n      pos,\r\n      isEmitting,\r\n      minVel,\r\n      maxVel,\r\n      acceleration,\r\n      minAngle,\r\n      maxAngle,\r\n      emitRate,\r\n      particleLife,\r\n      opacity,\r\n      fadeFlag,\r\n      focus,\r\n      focusAccel,\r\n      startSize,\r\n      endSize,\r\n      minSize,\r\n      maxSize,\r\n      beginColor,\r\n      endColor,\r\n      particleSprite,\r\n      emitterType,\r\n      radius,\r\n      particleRotationalVelocity,\r\n      randomRotation,\r\n      random\r\n    } = { ...config };\r\n\r\n    this.pos = pos ?? vec(x ?? 0, y ?? 0);\r\n    this.isEmitting = isEmitting ?? this.isEmitting;\r\n    this.minVel = minVel ?? this.minVel;\r\n    this.maxVel = maxVel ?? this.maxVel;\r\n    this.acceleration = acceleration ?? this.acceleration;\r\n    this.minAngle = minAngle ?? this.minAngle;\r\n    this.maxAngle = maxAngle ?? this.maxAngle;\r\n    this.emitRate = emitRate ?? this.emitRate;\r\n    this.particleLife = particleLife ?? this.particleLife;\r\n    this.opacity = opacity ?? this.opacity;\r\n    this.fadeFlag = fadeFlag ?? this.fadeFlag;\r\n    this.focus = focus ?? this.focus;\r\n    this.focusAccel = focusAccel ?? this.focusAccel;\r\n    this.startSize = startSize ?? this.startSize;\r\n    this.endSize = endSize ?? this.endSize;\r\n    this.minSize = minSize ?? this.minSize;\r\n    this.maxSize = maxSize ?? this.maxSize;\r\n    this.beginColor = beginColor ?? this.beginColor;\r\n    this.endColor = endColor ?? this.endColor;\r\n    this.particleSprite = particleSprite ?? this.particleSprite;\r\n    this.emitterType = emitterType ?? this.emitterType;\r\n    this.radius = radius ?? this.radius;\r\n    this.particleRotationalVelocity = particleRotationalVelocity ?? this.particleRotationalVelocity;\r\n    this.randomRotation = randomRotation ?? this.randomRotation;\r\n\r\n    this.body.collisionType = CollisionType.PreventCollision;\r\n\r\n    this.random = random ?? new Random();\r\n\r\n    // Remove offscreen culling from particle emitters\r\n    for (let i = 0; i < this.traits.length; i++) {\r\n      if (this.traits[i] instanceof Traits.OffscreenCulling) {\r\n        this.traits.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public removeParticle(particle: Particle) {\r\n    this.deadParticles.push(particle);\r\n  }\r\n\r\n  /**\r\n   * Causes the emitter to emit particles\r\n   * @param particleCount  Number of particles to emit right now\r\n   */\r\n  public emitParticles(particleCount: number) {\r\n    for (let i = 0; i < particleCount; i++) {\r\n      const p = this._createParticle();\r\n      this.particles.push(p);\r\n      if (this?.scene?.world) {\r\n        this.scene.world.add(p);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clearParticles() {\r\n    this.particles.length = 0;\r\n  }\r\n\r\n  // Creates a new particle given the constraints of the emitter\r\n  private _createParticle(): Particle {\r\n    // todo implement emitter constraints;\r\n    let ranX = 0;\r\n    let ranY = 0;\r\n\r\n    const angle = Util.randomInRange(this.minAngle, this.maxAngle, this.random);\r\n    const vel = Util.randomInRange(this.minVel, this.maxVel, this.random);\r\n    const size = this.startSize || Util.randomInRange(this.minSize, this.maxSize, this.random);\r\n    const dx = vel * Math.cos(angle);\r\n    const dy = vel * Math.sin(angle);\r\n\r\n    if (this.emitterType === EmitterType.Rectangle) {\r\n      ranX = Util.randomInRange(0, this.width, this.random);\r\n      ranY = Util.randomInRange(0, this.height, this.random);\r\n    } else if (this.emitterType === EmitterType.Circle) {\r\n      const radius = Util.randomInRange(0, this.radius, this.random);\r\n      ranX = radius * Math.cos(angle);\r\n      ranY = radius * Math.sin(angle);\r\n    }\r\n\r\n    const p = new Particle(\r\n      this,\r\n      this.particleLife,\r\n      this.opacity,\r\n      this.beginColor,\r\n      this.endColor,\r\n      new Vector(ranX, ranY),\r\n      new Vector(dx, dy),\r\n      this.acceleration,\r\n      this.startSize,\r\n      this.endSize\r\n    );\r\n    p.fadeFlag = this.fadeFlag;\r\n    p.particleSize = size;\r\n    if (this.particleSprite) {\r\n      p.particleSprite = this.particleSprite;\r\n      p.graphics.opacity = this.opacity;\r\n      p.graphics.use(this._sprite);\r\n    }\r\n    p.particleRotationalVelocity = this.particleRotationalVelocity;\r\n    if (this.randomRotation) {\r\n      p.currentRotation = Util.randomInRange(0, Math.PI * 2, this.random);\r\n    }\r\n    if (this.focus) {\r\n      p.focus = this.focus.add(new Vector(this.pos.x, this.pos.y));\r\n      p.focusAccel = this.focusAccel;\r\n    }\r\n    return p;\r\n  }\r\n\r\n  public update(engine: Engine, delta: number) {\r\n    super.update(engine, delta);\r\n\r\n    if (this.isEmitting) {\r\n      this._particlesToEmit += this.emitRate * (delta / 1000);\r\n      if (this._particlesToEmit > 1.0) {\r\n        this.emitParticles(Math.floor(this._particlesToEmit));\r\n        this._particlesToEmit = this._particlesToEmit - Math.floor(this._particlesToEmit);\r\n      }\r\n    }\r\n\r\n    // deferred removal\r\n    for (let i = 0; i < this.deadParticles.length; i++) {\r\n      Util.removeItemFromArray(this.deadParticles[i], this.particles);\r\n      if (this?.scene?.world) {\r\n        this.scene.world.remove(this.deadParticles[i], false);\r\n      }\r\n    }\r\n    this.deadParticles.length = 0;\r\n  }\r\n\r\n  public draw(ctx: CanvasRenderingContext2D) {\r\n    // todo is there a more efficient to draw\r\n    // possibly use a webgl offscreen canvas and shaders to do particles?\r\n    this.particles.forEach((p) => p.draw(ctx));\r\n  }\r\n\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    super.debugDraw(ctx);\r\n    ctx.fillStyle = Color.Black.toString();\r\n    ctx.fillText('Particles: ' + this.particles.length, this.pos.x, this.pos.y + 20);\r\n\r\n    if (this.focus) {\r\n      ctx.fillRect(this.focus.x + this.pos.x, this.focus.y + this.pos.y, 3, 3);\r\n      DrawUtil.line(ctx, Color.Yellow, this.focus.x + this.pos.x, this.focus.y + this.pos.y, this.center.x, this.center.y);\r\n      ctx.fillText('Focus', this.focus.x + this.pos.x, this.focus.y + this.pos.y);\r\n    }\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { Graphic, GraphicOptions } from './Graphic';\nimport { Animation, HasTick } from './Animation';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BoundingBox } from '../Collision/Index';\n\nexport interface GraphicsGroupingOptions {\n  members: GraphicsGrouping[];\n}\n\nexport interface GraphicsGrouping {\n  pos: Vector;\n  graphic: Graphic;\n}\n\nexport class GraphicsGroup extends Graphic implements HasTick {\n  public members: GraphicsGrouping[] = [];\n\n  constructor(options: GraphicsGroupingOptions & GraphicOptions) {\n    super(options);\n    this.members = options.members;\n    this._updateDimensions();\n  }\n\n  public clone(): GraphicsGroup {\n    return new GraphicsGroup({\n      members: [...this.members],\n      ...this.cloneGraphicOptions()\n    });\n  }\n\n  private _updateDimensions(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n\n    this.width = bb.width;\n    this.height = bb.height;\n\n    return bb;\n  }\n\n  public get localBounds(): BoundingBox {\n    let bb = new BoundingBox();\n    for (const { graphic, pos } of this.members) {\n      bb = graphic.localBounds.translate(pos).combine(bb);\n    }\n    return bb;\n  }\n\n  private _isAnimationOrGroup(graphic: Graphic): graphic is Animation | GraphicsGroup {\n    return graphic instanceof Animation || graphic instanceof GraphicsGroup;\n  }\n\n  public tick(elapsedMilliseconds: number, idempotencyToken?: number) {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.tick(elapsedMilliseconds, idempotencyToken);\n      }\n    }\n  }\n\n  public reset() {\n    for (const member of this.members) {\n      const maybeAnimation = member.graphic;\n      if (this._isAnimationOrGroup(maybeAnimation)) {\n        maybeAnimation.reset();\n      }\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    this._updateDimensions();\n    super._preDraw(ex, x, y);\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    for (const member of this.members) {\n      ex.save();\n      ex.translate(x, y);\n      member.graphic.draw(ex, member.pos.x, member.pos.y);\n      if (this.showDebug) {\n        /* istanbul ignore next */\n        ex.debug.drawRect(0, 0, this.width, this.height);\n      }\n      ex.restore();\n    }\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { Scene } from '../Scene';\r\nimport { GraphicsComponent } from './GraphicsComponent';\r\nimport { vec } from '../Math/vector';\r\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { Entity } from '../EntityComponentSystem/Entity';\r\nimport { Camera } from '../Camera';\r\nimport { System, SystemType, TagComponent } from '../EntityComponentSystem';\r\nimport { Engine } from '../Engine';\r\nimport { GraphicsDiagnostics } from './GraphicsDiagnostics';\r\nimport { EnterViewPortEvent, ExitViewPortEvent } from '../Events';\r\nimport { GraphicsGroup } from '.';\r\nimport { Particle } from '../Particles';\r\n\r\nexport class GraphicsSystem extends System<TransformComponent | GraphicsComponent> {\r\n  public readonly types = ['ex.transform', 'ex.graphics'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 0;\r\n  private _token = 0;\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\r\n  }\r\n\r\n  public update(entities: Entity[], delta: number): void {\r\n    this._clearScreen();\r\n    this._token++;\r\n    let transform: TransformComponent;\r\n    let graphics: GraphicsComponent;\r\n\r\n    for (const entity of entities) {\r\n      transform = entity.get(TransformComponent);\r\n      graphics = entity.get(GraphicsComponent);\r\n\r\n      // Figure out if entities are offscreen\r\n      const entityOffscreen = this._isOffscreen(transform, graphics);\r\n      if (entityOffscreen && !entity.hasTag('offscreen')) {\r\n        entity.eventDispatcher.emit('exitviewport', new ExitViewPortEvent(entity));\r\n        entity.addComponent(new TagComponent('offscreen'));\r\n      }\r\n\r\n      if (!entityOffscreen && entity.hasTag('offscreen')) {\r\n        entity.eventDispatcher.emit('enterviewport', new EnterViewPortEvent(entity));\r\n        entity.removeComponent('offscreen');\r\n      }\r\n      // Skip entities that have graphics offscreen\r\n      if (entityOffscreen) {\r\n        continue;\r\n      }\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(transform);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      // Tick any graphics state (but only once) for animations and graphics groups\r\n      graphics.update(delta, this._token);\r\n\r\n      // Position the entity\r\n      this._applyTransform(entity);\r\n\r\n      // Optionally run the onPreDraw graphics lifecycle draw\r\n      if (graphics.onPreDraw) {\r\n        graphics.onPreDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      // TODO remove this hack on the particle redo\r\n      const particleOpacity = (entity instanceof Particle) ? entity.opacity : 1;\r\n      this._graphicsContext.opacity = graphics.opacity * particleOpacity;\r\n\r\n      // Draw the graphics component\r\n      this._drawGraphicsComponent(graphics);\r\n\r\n      // Optionally run the onPostDraw graphics lifecycle draw\r\n      if (graphics.onPostDraw) {\r\n        graphics.onPostDraw(this._graphicsContext, delta);\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      // Reset the transform back to the original\r\n      this._popCameraTransform(transform);\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n  }\r\n\r\n  private _clearScreen(): void {\r\n    this._graphicsContext.clear();\r\n  }\r\n\r\n  private _isOffscreen(transform: TransformComponent, graphics: GraphicsComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      const graphicsOffscreen = !this._camera.viewport.intersect(graphics.localBounds.transform(transform.getGlobalMatrix()));\r\n      return graphicsOffscreen;\r\n    } else {\r\n      // TODO sceen coordinates\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private _drawGraphicsComponent(graphicsComponent: GraphicsComponent) {\r\n    if (graphicsComponent.visible) {\r\n      // this should be moved to the graphics system\r\n      for (const layer of graphicsComponent.layers.get()) {\r\n        for (const { graphic, options } of layer.graphics) {\r\n          let anchor = graphicsComponent.anchor;\r\n          let offset = graphicsComponent.offset;\r\n          if (options?.anchor) {\r\n            anchor = options.anchor;\r\n          }\r\n          if (options?.offset) {\r\n            offset = options.offset;\r\n          }\r\n          // See https://github.com/excaliburjs/Excalibur/pull/619 for discussion on this formula\r\n          const offsetX = -graphic.width * anchor.x + offset.x;\r\n          const offsetY = -graphic.height * anchor.y + offset.y;\r\n\r\n          graphic?.draw(this._graphicsContext, offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n\r\n          if (this._engine?.isDebug && this._engine.debug.graphics.showBounds) {\r\n            const offset = vec(offsetX + layer.offset.x, offsetY + layer.offset.y);\r\n            if (graphic instanceof GraphicsGroup) {\r\n              for (const g of graphic.members) {\r\n                g.graphic?.localBounds.translate(offset.add(g.pos)).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n              }\r\n            } else {\r\n              /* istanbul ignore next */\r\n              graphic?.localBounds.translate(offset).draw(this._graphicsContext, this._engine.debug.graphics.boundsColor);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Actor } from '../Actor';\r\nimport { Entity, System, SystemType } from '../EntityComponentSystem';\r\nimport { CanvasDrawComponent } from './CanvasDrawComponent';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { CoordPlane, TransformComponent } from '../EntityComponentSystem/Components/TransformComponent';\r\nimport { GraphicsDiagnostics } from '../Graphics/GraphicsDiagnostics';\r\n\r\n/**\r\n * Draws anything with a transform and a \"draw\" method\r\n * @deprecated Shim for canvas drawing, will be removed v0.26.0\r\n */\r\nexport class CanvasDrawingSystem extends System<TransformComponent | CanvasDrawComponent> {\r\n  public readonly types = ['ex.transform', 'ex.canvas'] as const;\r\n  public systemType = SystemType.Draw;\r\n  public priority = -1;\r\n\r\n  private _ctx: CanvasRenderingContext2D;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._ctx = scene.engine.ctx;\r\n    this._engine = scene.engine;\r\n    this._camera = scene.camera;\r\n  }\r\n\r\n  public sort(a: Entity, b: Entity) {\r\n    return a.get(TransformComponent).z - b.get(TransformComponent).z;\r\n  }\r\n\r\n  public update(entities: Entity[], delta: number) {\r\n    this._clearScreen();\r\n\r\n    let transform: TransformComponent;\r\n    let canvasdraw: CanvasDrawComponent;\r\n    const length = entities.length;\r\n    for (let i = 0; i < length; i++) {\r\n      const visible = (entities[i] as Actor)?.graphics?.visible ?? true;\r\n      const offscreen = (entities[i] as Actor).isOffScreen;\r\n      if (visible && !offscreen) {\r\n        transform = entities[i].get(TransformComponent);\r\n        canvasdraw = entities[i].get(CanvasDrawComponent);\r\n\r\n        this._ctx.save();\r\n        this._pushCameraTransform(transform);\r\n\r\n        this._ctx.save();\r\n        this._applyTransform(entities[i]);\r\n        canvasdraw.draw(this._ctx, delta);\r\n        this._ctx.restore();\r\n\r\n        this._popCameraTransform(transform);\r\n        this._ctx.restore();\r\n      }\r\n\r\n      if (this._engine.isDebug) {\r\n        this._ctx.save();\r\n        this._pushCameraTransform(transform);\r\n        this._ctx.strokeStyle = 'yellow';\r\n        (entities[i] as unknown as Actor).debugDraw(this._ctx);\r\n        this._popCameraTransform(transform);\r\n        this._ctx.restore();\r\n      }\r\n    }\r\n    if (this._engine.isDebug) {\r\n      this._ctx.save();\r\n      this._camera.draw(this._ctx);\r\n      this._camera.debugDraw(this._ctx);\r\n      this._ctx.restore();\r\n    }\r\n\r\n    this._engine.stats.currFrame.graphics.drawnImages = GraphicsDiagnostics.DrawnImagesCount;\r\n    this._engine.stats.currFrame.graphics.drawCalls = GraphicsDiagnostics.DrawCallCount;\r\n  }\r\n\r\n  private _applyTransform(entity: Entity) {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._ctx.translate(transform.pos.x, transform.pos.y);\r\n        this._ctx.rotate(transform.rotation);\r\n        this._ctx.scale(transform.scale.x, transform.scale.y);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _clearScreen(): void {\r\n    this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\r\n    this._ctx.fillStyle = this._engine.backgroundColor.toString();\r\n    this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\r\n  }\r\n\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera transform to place entity in world space\r\n      this._ctx.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._ctx);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Restore back to screen space from world space if we were drawing an entity there\r\n      this._ctx.restore();\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { Scene } from '../Scene';\r\nimport { Camera } from '../Camera';\r\nimport { MotionComponent } from '../EntityComponentSystem/Components/MotionComponent';\r\nimport { ColliderComponent } from '../Collision/ColliderComponent';\r\nimport { CoordPlane, Entity, TransformComponent } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ExcaliburGraphicsContext } from '../Graphics/Context/ExcaliburGraphicsContext';\r\nimport { vec, Vector } from '../Math/vector';\r\nimport { BodyComponent, CollisionSystem, CompositeCollider, GraphicsComponent, Particle, Util } from '..';\r\n\r\nexport class DebugSystem extends System<TransformComponent> {\r\n  public readonly types = ['ex.transform'] as const;\r\n  public readonly systemType = SystemType.Draw;\r\n  public priority = 999; // lowest priority\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n  private _collisionSystem: CollisionSystem;\r\n  private _camera: Camera;\r\n  private _engine: Engine;\r\n\r\n  public initialize(scene: Scene): void {\r\n    this._graphicsContext = scene.engine.graphicsContext;\r\n    this._camera = scene.camera;\r\n    this._engine = scene.engine;\r\n    this._collisionSystem = scene.world.systemManager.get(CollisionSystem);\r\n  }\r\n\r\n  update(entities: Entity[], _delta: number): void {\r\n    if (!this._engine.isDebug) {\r\n      return;\r\n    }\r\n\r\n    const filterSettings = this._engine.debug.filter;\r\n\r\n    let id: number;\r\n    let name: string;\r\n    const entitySettings = this._engine.debug.entity;\r\n\r\n    let tx: TransformComponent;\r\n    const txSettings = this._engine.debug.transform;\r\n\r\n    let motion: MotionComponent;\r\n    const motionSettings = this._engine.debug.motion;\r\n\r\n    let colliderComp: ColliderComponent;\r\n    const colliderSettings = this._engine.debug.collider;\r\n\r\n    const physicsSettings = this._engine.debug.physics;\r\n\r\n    let graphics: GraphicsComponent;\r\n    const graphicsSettings = this._engine.debug.graphics;\r\n\r\n    let body: BodyComponent;\r\n    const bodySettings = this._engine.debug.body;\r\n\r\n    const cameraSettings = this._engine.debug.camera;\r\n    for (const entity of entities) {\r\n      if (entity.hasTag('offscreen')) {\r\n        // skip offscreen entities\r\n        continue;\r\n      }\r\n      if (entity instanceof Particle) {\r\n        // Particles crush the renderer :(\r\n        continue;\r\n      }\r\n      if (filterSettings.useFilter) {\r\n        const allIds = filterSettings.ids.length === 0;\r\n        const idMatch = allIds || filterSettings.ids.includes(entity.id);\r\n        if (!idMatch) {\r\n          continue;\r\n        }\r\n        const allNames = filterSettings.nameQuery === '';\r\n        const nameMatch = allNames || entity.name.includes(filterSettings.nameQuery);\r\n        if (!nameMatch) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      let cursor = Vector.Zero;\r\n      const lineHeight = vec(0, 16);\r\n      id = entity.id;\r\n      name = entity.name;\r\n      tx = entity.get(TransformComponent);\r\n\r\n      // This optionally sets our camera based on the entity coord plan (world vs. screen)\r\n      this._pushCameraTransform(tx);\r\n\r\n      this._graphicsContext.save();\r\n\r\n      this._applyTransform(entity);\r\n      if (tx) {\r\n        if (txSettings.showAll || txSettings.showPosition) {\r\n          this._graphicsContext.debug.drawPoint(Vector.Zero, { size: 2, color: txSettings.positionColor });\r\n          this._graphicsContext.debug.drawText(`pos${tx.pos.toString(2)}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showId) {\r\n          this._graphicsContext.debug.drawText(`id(${id}) ${tx.parent ? 'child of id(' + tx.parent?.owner?.id + ')' : ''}`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (entitySettings.showAll || entitySettings.showName) {\r\n          this._graphicsContext.debug.drawText(`name(${name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showRotation) {\r\n          this._graphicsContext.drawLine(\r\n            Vector.Zero,\r\n            Vector.fromAngle(tx.rotation).scale(50).add(Vector.Zero),\r\n            txSettings.rotationColor,\r\n            2\r\n          );\r\n          this._graphicsContext.debug.drawText(`rot deg(${Util.toDegrees(tx.rotation).toFixed(2)})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (txSettings.showAll || txSettings.showScale) {\r\n          this._graphicsContext.drawLine(Vector.Zero, tx.scale.add(Vector.Zero), txSettings.scaleColor, 2);\r\n        }\r\n      }\r\n\r\n      graphics = entity.get(GraphicsComponent);\r\n      if (graphics) {\r\n        if (graphicsSettings.showAll || graphicsSettings.showBounds) {\r\n          const bounds = graphics.localBounds;\r\n          bounds.draw(this._graphicsContext, graphicsSettings.boundsColor);\r\n        }\r\n      }\r\n\r\n      body = entity.get(BodyComponent);\r\n      if (body) {\r\n        if (bodySettings.showAll || bodySettings.showCollisionGroup) {\r\n          this._graphicsContext.debug.drawText(`collision group(${body.group.name})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showCollisionType) {\r\n          this._graphicsContext.debug.drawText(`collision type(${body.collisionType})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMass) {\r\n          this._graphicsContext.debug.drawText(`mass(${body.mass})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showMotion) {\r\n          this._graphicsContext.debug.drawText(`motion(${body.sleepMotion})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (bodySettings.showAll || bodySettings.showSleeping) {\r\n          this._graphicsContext.debug.drawText(`sleeping(${body.canSleep ? body.sleeping: 'cant sleep'})`, cursor);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n      }\r\n\r\n      this._graphicsContext.restore();\r\n\r\n      motion = entity.get(MotionComponent);\r\n      if (motion) {\r\n        if (motionSettings.showAll || motionSettings.showVelocity) {\r\n          this._graphicsContext.debug.drawText(`vel${motion.vel.toString(2)}`, cursor.add(tx.globalPos));\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.vel), motionSettings.velocityColor, 2);\r\n          cursor = cursor.add(lineHeight);\r\n        }\r\n\r\n        if (motionSettings.showAll || motionSettings.showAcceleration) {\r\n          this._graphicsContext.drawLine(tx.globalPos, tx.globalPos.add(motion.acc), motionSettings.accelerationColor, 2);\r\n        }\r\n      }\r\n\r\n      // Colliders live in world space already so after the restore()\r\n      colliderComp = entity.get(ColliderComponent);\r\n      if (colliderComp) {\r\n        const collider = colliderComp.get();\r\n        if ((colliderSettings.showAll || colliderSettings.showGeometry) && collider) {\r\n          collider.debug(this._graphicsContext, colliderSettings.geometryColor);\r\n        }\r\n        if (colliderSettings.showAll || colliderSettings.showBounds) {\r\n          if (collider instanceof CompositeCollider) {\r\n            const colliders = collider.getColliders();\r\n            for (const collider of colliders) {\r\n              const bounds = collider.bounds;\r\n              const pos = vec(bounds.left, bounds.top);\r\n              this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n              if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n                this._graphicsContext.debug.drawText(`owner id(${collider.owner.id})`, pos);\r\n              }\r\n            }\r\n            colliderComp.bounds.draw(this._graphicsContext, colliderSettings.boundsColor);\r\n          } else if (collider) {\r\n            const bounds = colliderComp.bounds;\r\n            const pos = vec(bounds.left, bounds.top);\r\n            this._graphicsContext.debug.drawRect(pos.x, pos.y, bounds.width, bounds.height, { color: colliderSettings.boundsColor });\r\n            if (colliderSettings.showAll || colliderSettings.showOwner) {\r\n              this._graphicsContext.debug.drawText(`owner id(${colliderComp.owner.id})`, pos);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this._popCameraTransform(tx);\r\n    }\r\n\r\n    this._graphicsContext.save();\r\n    this._camera.draw(this._graphicsContext);\r\n    if (physicsSettings.showAll || physicsSettings.showBroadphaseSpacePartitionDebug) {\r\n      this._collisionSystem.debug(this._graphicsContext);\r\n    }\r\n    if (physicsSettings.showAll || physicsSettings.showCollisionContacts || physicsSettings.showCollisionNormals) {\r\n      for (const [_, contact] of this._engine.debug.stats.currFrame.physics.contacts) {\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionContacts) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawPoint(point, { size: 5, color: physicsSettings.collisionContactColor });\r\n          }\r\n        }\r\n\r\n        if (physicsSettings.showAll || physicsSettings.showCollisionNormals) {\r\n          for (const point of contact.points) {\r\n            this._graphicsContext.debug.drawLine(point, contact.normal.scale(30).add(point), {\r\n              color: physicsSettings.collisionNormalColor\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this._graphicsContext.restore();\r\n\r\n    if (cameraSettings) {\r\n      this._graphicsContext.save();\r\n      this._camera.draw(this._graphicsContext);\r\n      if (cameraSettings.showAll || cameraSettings.showFocus) {\r\n        this._graphicsContext.drawCircle(this._camera.pos, 4, cameraSettings.focusColor);\r\n      }\r\n      if (cameraSettings.showAll || cameraSettings.showZoom) {\r\n        this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`, this._camera.pos);\r\n      }\r\n      this._graphicsContext.restore();\r\n    }\r\n\r\n    this._graphicsContext.flush();\r\n  }\r\n\r\n  /**\r\n   * This applies the current entity transform to the graphics context\r\n   * @param entity\r\n   */\r\n  private _applyTransform(entity: Entity): void {\r\n    const ancestors = entity.getAncestors();\r\n    for (const ancestor of ancestors) {\r\n      const transform = ancestor?.get(TransformComponent);\r\n      if (transform) {\r\n        this._graphicsContext.translate(transform.pos.x, transform.pos.y);\r\n        this._graphicsContext.scale(transform.scale.x, transform.scale.y);\r\n        this._graphicsContext.rotate(transform.rotation);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Applies the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _pushCameraTransform(transform: TransformComponent) {\r\n    // Establish camera offset per entity\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      this._graphicsContext.save();\r\n      if (this._camera) {\r\n        this._camera.draw(this._graphicsContext);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the current camera transform if in world coordinates\r\n   * @param transform\r\n   */\r\n  private _popCameraTransform(transform: TransformComponent) {\r\n    if (transform.coordPlane === CoordPlane.World) {\r\n      // Apply camera world offset\r\n      this._graphicsContext.restore();\r\n    }\r\n  }\r\n}\r\n","import { Entity } from '../EntityComponentSystem';\r\nimport { System, SystemType } from '../EntityComponentSystem/System';\r\nimport { ActionsComponent } from './ActionsComponent';\r\n\r\n\r\nexport class ActionsSystem extends System<ActionsComponent> {\r\n  public readonly types = ['ex.actions'] as const;\r\n  systemType = SystemType.Update;\r\n  priority = -1;\r\n\r\n  update(entities: Entity[], delta: number): void {\r\n    let actions: ActionsComponent;\r\n    for (const entity of entities) {\r\n      actions = entity.get(ActionsComponent);\r\n      actions.update(delta);\r\n    }\r\n  }\r\n}","import { Logger } from './../Util/Log';\r\nimport { PostProcessor } from './PostProcessor';\r\nimport { Engine } from '../Engine';\r\n\r\nexport enum ColorBlindness {\r\n  Protanope,\r\n  Deuteranope,\r\n  Tritanope\r\n}\r\n\r\n/**\r\n * This post processor can correct colors and simulate color blindness.\r\n * It is possible to use this on every game, but the game's performance\r\n * will suffer measurably. It's better to use it as a helpful tool while developing your game.\r\n * Remember, the best practice is to design with color blindness in mind.\r\n */\r\nexport class ColorBlindCorrector implements PostProcessor {\r\n  /*eslint-disable */\r\n  private _vertexShader =\r\n    '' +\r\n    'attribute vec2 a_position;' +\r\n    'attribute vec2 a_texCoord;' +\r\n    'uniform vec2 u_resolution;' +\r\n    'varying vec2 v_texCoord;' +\r\n    'void main() {' +\r\n    // convert the rectangle from pixels to 0.0 to 1.0\r\n    'vec2 zeroToOne = a_position / u_resolution;' +\r\n    // convert from 0->1 to 0->2\r\n    'vec2 zeroToTwo = zeroToOne * 2.0;' +\r\n    // convert from 0->2 to -1->+1 (clipspace)\r\n    'vec2 clipSpace = zeroToTwo - 1.0;' +\r\n    'gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);' +\r\n    // pass the texCoord to the fragment shader\r\n    // The GPU will interpolate this value between points.\r\n    'v_texCoord = a_texCoord;' +\r\n    '}';\r\n\r\n  private _fragmentShader =\r\n    'precision mediump float;' +\r\n    // our texture\r\n    'uniform sampler2D u_image;' +\r\n    // the texCoords passed in from the vertex shader.\r\n    'varying vec2 v_texCoord;' +\r\n    // Color blind conversions\r\n    /*'mat3 m[9] =' +\r\n   '{' +\r\n      'mat3(1.0, 0.0, 0.0,  0.0, 1.0, 0.0,  0.0, 0.0, 1.0  ),' + // normal\r\n      'mat3(0.567, 0.433, 0.0,  0.558, 0.442, 0.0,  0.0, 0.242, 0.758),' + // protanopia\r\n      'mat3(0.817, 0.183, 0.0,  0.333, 0.667, 0.0,  0.0, 0.125,0.875),' + // protanomaly\r\n      'mat3(0.625, 0.375, 0.0,  0.7, 0.3, 0.0,  0.0, 0.3,0.7  ),' + // deuteranopia\r\n      'mat3(0.8, 0.2, 0.0,  0.258, 0.742, 0.0,  0.0, 0.142,0.858),' + // deuteranomaly\r\n      'mat3(0.95, 0.05, 0.0,  0.0, 0.433, 0.567,  0.0, 0.475,0.525),' + // tritanopia\r\n      'mat3(0.967, 0.033, 0.0,  0.0, 0.733, 0.267,  0.0, 0.183,0.817),' + // tritanomaly\r\n      'mat3(0.299, 0.587, 0.114,  0.299, 0.587, 0.114,  0.299, 0.587,0.114),' + // achromatopsia\r\n      'mat3(0.618, 0.320, 0.062,  0.163, 0.775, 0.062,  0.163, 0.320,0.516)' +  // achromatomaly\r\n   '};' +*/\r\n\r\n    'void main() {' +\r\n    'vec4 o =  texture2D(u_image, v_texCoord);' +\r\n    // RGB to LMS matrix conversion\r\n    'float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);' +\r\n    'float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);' +\r\n    'float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);' +\r\n    // Simulate color blindness\r\n\r\n    '//MODE CODE//' +\r\n    /* Deuteranope for testing\r\n      'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n            'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\r\n            'float s = 0.0 * L + 0.0 * M + 1.0 * S;' +*/\r\n\r\n    // LMS to RGB matrix conversion\r\n    'vec4 error;' +\r\n    'error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);' +\r\n    'error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);' +\r\n    'error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);' +\r\n    'error.a = 1.0;' +\r\n    'vec4 diff = o - error;' +\r\n    'vec4 correction;' +\r\n    'correction.r = 0.0;' +\r\n    'correction.g =  (diff.r * 0.7) + (diff.g * 1.0);' +\r\n    'correction.b =  (diff.r * 0.7) + (diff.b * 1.0);' +\r\n    'correction = o + correction;' +\r\n    'correction.a = o.a;' +\r\n    '//SIMULATE//' +\r\n    '}';\r\n\r\n  /*eslint-enable */\r\n  private _internalCanvas: HTMLCanvasElement;\r\n  private _gl: WebGLRenderingContext;\r\n  private _program: WebGLProgram;\r\n\r\n  constructor(public engine: Engine, public simulate: boolean = false, public colorMode: ColorBlindness = ColorBlindness.Protanope) {\r\n    this._internalCanvas = document.createElement('canvas');\r\n    this._internalCanvas.width = engine.drawWidth;\r\n    this._internalCanvas.height = engine.drawHeight;\r\n\r\n    // eslint-disable-next-line\r\n    this._gl = <WebGLRenderingContext>this._internalCanvas.getContext('webgl', { preserveDrawingBuffer: true });\r\n\r\n    this._program = this._gl.createProgram();\r\n    const fragmentShader = this._getShader('Fragment', this._getFragmentShaderByMode(colorMode));\r\n    const vertextShader = this._getShader('Vertex', this._vertexShader);\r\n\r\n    this._gl.attachShader(this._program, vertextShader);\r\n    this._gl.attachShader(this._program, fragmentShader);\r\n    this._gl.linkProgram(this._program);\r\n\r\n    if (!this._gl.getProgramParameter(this._program, this._gl.LINK_STATUS)) {\r\n      Logger.getInstance().error('Unable to link shader program!');\r\n    }\r\n\r\n    this._gl.useProgram(this._program);\r\n  }\r\n\r\n  private _getFragmentShaderByMode(colorMode: ColorBlindness) {\r\n    let code = '';\r\n    if (colorMode === ColorBlindness.Protanope) {\r\n      code =\r\n        'float l = 0.0 * L + 2.02344 * M + -2.52581 * S;' +\r\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\r\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\r\n    } else if (colorMode === ColorBlindness.Deuteranope) {\r\n      code =\r\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n        'float m = 0.494207 * L + 0.0 * M + 1.24827 * S;' +\r\n        'float s = 0.0 * L + 0.0 * M + 1.0 * S;';\r\n    } else if (colorMode === ColorBlindness.Tritanope) {\r\n      code =\r\n        'float l = 1.0 * L + 0.0 * M + 0.0 * S;' +\r\n        'float m = 0.0 * L + 1.0 * M + 0.0 * S;' +\r\n        'float s = -0.395913 * L + 0.801109 * M + 0.0 * S;';\r\n    }\r\n\r\n    if (this.simulate) {\r\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = error.rgba;');\r\n    } else {\r\n      this._fragmentShader = this._fragmentShader.replace('//SIMULATE//', 'gl_FragColor = correction.rgba;');\r\n    }\r\n\r\n    return this._fragmentShader.replace('//MODE CODE//', code);\r\n  }\r\n\r\n  private _setRectangle(x: number, y: number, width: number, height: number) {\r\n    const x1 = x;\r\n    const x2 = x + width;\r\n    const y1 = y;\r\n    const y2 = y + height;\r\n    this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), this._gl.STATIC_DRAW);\r\n  }\r\n\r\n  private _getShader(type: string, program: string): WebGLShader {\r\n    let shader: WebGLShader;\r\n    if (type === 'Fragment') {\r\n      shader = this._gl.createShader(this._gl.FRAGMENT_SHADER);\r\n    } else if (type === 'Vertex') {\r\n      shader = this._gl.createShader(this._gl.VERTEX_SHADER);\r\n    } else {\r\n      Logger.getInstance().error('Error unknown shader type', type);\r\n    }\r\n\r\n    this._gl.shaderSource(shader, program);\r\n    this._gl.compileShader(shader);\r\n\r\n    if (!this._gl.getShaderParameter(shader, this._gl.COMPILE_STATUS)) {\r\n      Logger.getInstance().error('Unable to compile shader!', this._gl.getShaderInfoLog(shader));\r\n      return null;\r\n    }\r\n\r\n    return shader;\r\n  }\r\n\r\n  public process(image: ImageData, out: CanvasRenderingContext2D) {\r\n    // look up where the vertex data needs to go.\r\n    const positionLocation = this._gl.getAttribLocation(this._program, 'a_position');\r\n    const texCoordLocation = this._gl.getAttribLocation(this._program, 'a_texCoord');\r\n\r\n    const texCoordBuffer = this._gl.createBuffer();\r\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, texCoordBuffer);\r\n    this._gl.bufferData(\r\n      this._gl.ARRAY_BUFFER,\r\n      new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\r\n      this._gl.STATIC_DRAW\r\n    );\r\n    this._gl.enableVertexAttribArray(texCoordLocation);\r\n    this._gl.vertexAttribPointer(texCoordLocation, 2, this._gl.FLOAT, false, 0, 0);\r\n\r\n    // Create a texture.\r\n    const texture = this._gl.createTexture();\r\n    this._gl.bindTexture(this._gl.TEXTURE_2D, texture);\r\n\r\n    // Set the parameters so we can render any size image.\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._gl.CLAMP_TO_EDGE);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._gl.CLAMP_TO_EDGE);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, this._gl.NEAREST);\r\n    this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, this._gl.NEAREST);\r\n    // Flip the texture when unpacking into the gl context, gl reads textures in the opposite order as everything else :/\r\n    this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, 1);\r\n    // Upload the image into the texture.\r\n    this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, image);\r\n\r\n    // lookup uniforms\r\n    const resolutionLocation = this._gl.getUniformLocation(this._program, 'u_resolution');\r\n\r\n    // set the resolution\r\n    this._gl.uniform2f(resolutionLocation, this._internalCanvas.width, this._internalCanvas.height);\r\n\r\n    // Create a buffer for the position of the rectangle corners.\r\n    const positionBuffer = this._gl.createBuffer();\r\n    this._gl.bindBuffer(this._gl.ARRAY_BUFFER, positionBuffer);\r\n    this._gl.enableVertexAttribArray(positionLocation);\r\n    this._gl.vertexAttribPointer(positionLocation, 2, this._gl.FLOAT, false, 0, 0);\r\n\r\n    // Set a rectangle the same size as the image.\r\n    this._setRectangle(0, 0, image.width, image.height);\r\n\r\n    // Draw the rectangle.\r\n    this._gl.drawArrays(this._gl.TRIANGLES, 0, 6);\r\n\r\n    // Grab transformed image from internal canvas\r\n    const pixelData = new Uint8Array(image.width * image.height * 4);\r\n    this._gl.readPixels(0, 0, image.width, image.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, pixelData);\r\n\r\n    (<any>image.data).set(pixelData);\r\n\r\n    out.putImageData(image, 0, 0);\r\n  }\r\n}\r\n","import { Logger } from '../Util/Log';\r\nimport { Class } from '../Class';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Enum representing physical input key codes\r\n */\r\nexport enum Keys {\r\n  // NUMPAD\r\n  Num0 = 'Numpad0',\r\n  Num1 = 'Numpad1',\r\n  Num2 = 'Numpad2',\r\n  Num3 = 'Numpad3',\r\n  Num4 = 'Numpad4',\r\n  Num5 = 'Numpad5',\r\n  Num6 = 'Numpad6',\r\n  Num7 = 'Numpad7',\r\n  Num8 = 'Numpad8',\r\n  Num9 = 'Numpad9',\r\n  NumAdd = 'NumpadAdd',\r\n  NumSubtract = 'NumpadSubtract',\r\n  NumMultiply = 'NumpadMultiply',\r\n  NumDivide = 'NumpadDivide',\r\n  // NumComma = 'NumpadComma', // not x-browser\r\n  NumDecimal = 'NumpadDecimal',\r\n  Numpad0 = 'Numpad0',\r\n  Numpad1 = 'Numpad1',\r\n  Numpad2 = 'Numpad2',\r\n  Numpad3 = 'Numpad3',\r\n  Numpad4 = 'Numpad4',\r\n  Numpad5 = 'Numpad5',\r\n  Numpad6 = 'Numpad6',\r\n  Numpad7 = 'Numpad7',\r\n  Numpad8 = 'Numpad8',\r\n  Numpad9 = 'Numpad9',\r\n  NumpadAdd = 'NumpadAdd',\r\n  NumpadSubtract = 'NumpadSubtract',\r\n  NumpadMultiply = 'NumpadMultiply',\r\n  NumpadDivide = 'NumpadDivide',\r\n  // NumpadComma = 'NumpadComma', // not x-browser\r\n  NumpadDecimal = 'NumpadDecimal',\r\n\r\n  // MODIFIERS\r\n  NumLock = 'NumLock',\r\n  ShiftLeft = 'ShiftLeft',\r\n  ShiftRight = 'ShiftRight',\r\n  AltLeft = 'AltLeft',\r\n  AltRight = 'AltRight',\r\n\r\n  // NUMBERS\r\n  Key0 = 'Digit0',\r\n  Key1 = 'Digit1',\r\n  Key2 = 'Digit2',\r\n  Key3 = 'Digit3',\r\n  Key4 = 'Digit4',\r\n  Key5 = 'Digit5',\r\n  Key6 = 'Digit6',\r\n  Key7 = 'Digit7',\r\n  Key8 = 'Digit8',\r\n  Key9 = 'Digit9',\r\n  Digit0 = 'Digit0',\r\n  Digit1 = 'Digit1',\r\n  Digit2 = 'Digit2',\r\n  Digit3 = 'Digit3',\r\n  Digit4 = 'Digit4',\r\n  Digit5 = 'Digit5',\r\n  Digit6 = 'Digit6',\r\n  Digit7 = 'Digit7',\r\n  Digit8 = 'Digit8',\r\n  Digit9 = 'Digit9',\r\n\r\n  // LETTERS\r\n  A = 'KeyA',\r\n  B = 'KeyB',\r\n  C = 'KeyC',\r\n  D = 'KeyD',\r\n  E = 'KeyE',\r\n  F = 'KeyF',\r\n  G = 'KeyG',\r\n  H = 'KeyH',\r\n  I = 'KeyI',\r\n  J = 'KeyJ',\r\n  K = 'KeyK',\r\n  L = 'KeyL',\r\n  M = 'KeyM',\r\n  N = 'KeyN',\r\n  O = 'KeyO',\r\n  P = 'KeyP',\r\n  Q = 'KeyQ',\r\n  R = 'KeyR',\r\n  S = 'KeyS',\r\n  T = 'KeyT',\r\n  U = 'KeyU',\r\n  V = 'KeyV',\r\n  W = 'KeyW',\r\n  X = 'KeyX',\r\n  Y = 'KeyY',\r\n  Z = 'KeyZ',\r\n  KeyA = 'KeyA',\r\n  KeyB = 'KeyB',\r\n  KeyC = 'KeyC',\r\n  KeyD = 'KeyD',\r\n  KeyE = 'KeyE',\r\n  KeyF = 'KeyF',\r\n  KeyG = 'KeyG',\r\n  KeyH = 'KeyH',\r\n  KeyI = 'KeyI',\r\n  KeyJ = 'KeyJ',\r\n  KeyK = 'KeyK',\r\n  KeyL = 'KeyL',\r\n  KeyM = 'KeyM',\r\n  KeyN = 'KeyN',\r\n  KeyO = 'KeyO',\r\n  KeyP = 'KeyP',\r\n  KeyQ = 'KeyQ',\r\n  KeyR = 'KeyR',\r\n  KeyS = 'KeyS',\r\n  KeyT = 'KeyT',\r\n  KeyU = 'KeyU',\r\n  KeyV = 'KeyV',\r\n  KeyW = 'KeyW',\r\n  KeyX = 'KeyX',\r\n  KeyY = 'KeyY',\r\n  KeyZ = 'KeyZ',\r\n\r\n  // SYMBOLS\r\n  Semicolon = 'Semicolon',\r\n  Quote = 'Quote',\r\n  Comma = 'Comma',\r\n  Minus = 'Minus',\r\n  Period = 'Period',\r\n  Slash = 'Slash',\r\n  Equal = 'Equal',\r\n  BracketLeft = 'BracketLeft',\r\n  Backslash = 'Backslash',\r\n  BracketRight = 'BracketRight',\r\n  Backquote = 'Backquote',\r\n\r\n  // DIRECTIONS\r\n  Up = 'ArrowUp',\r\n  Down = 'ArrowDown',\r\n  Left = 'ArrowLeft',\r\n  Right = 'ArrowRight',\r\n  ArrowUp = 'ArrowUp',\r\n  ArrowDown = 'ArrowDown',\r\n  ArrowLeft = 'ArrowLeft',\r\n  ArrowRight = 'ArrowRight',\r\n\r\n  // OTHER\r\n  Space = 'Space',\r\n  Esc = 'Escape',\r\n  Escape = 'Escape'\r\n}\r\n\r\n/**\r\n * Event thrown on a game object for a key event\r\n */\r\nexport class KeyEvent extends Events.GameEvent<any> {\r\n  /**\r\n   * @param key  The key responsible for throwing the event\r\n   * @param value The key's typed value the browser detected\r\n   * @param originalEvent The original keyboard event that Excalibur handled\r\n   */\r\n  constructor(public key: Keys, public value?: string, public originalEvent?: KeyboardEvent) {\r\n    super();\r\n  }\r\n}\r\n\r\n/**\r\n * Provides keyboard support for Excalibur.\r\n */\r\nexport class Keyboard extends Class {\r\n  private _keys: Keys[] = [];\r\n  private _keysUp: Keys[] = [];\r\n  private _keysDown: Keys[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public on(eventName: Events.press, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.release, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: Events.hold, handler: (event: KeyEvent) => void): void;\r\n  public on(eventName: string, handler: (event: Events.GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Initialize Keyboard event listeners\r\n   */\r\n  init(global?: GlobalEventHandlers): void {\r\n    if (!global) {\r\n      try {\r\n        // Try and listen to events on top window frame if within an iframe.\r\n        //\r\n        // See https://github.com/excaliburjs/Excalibur/issues/1294\r\n        //\r\n        // Attempt to add an event listener, which triggers a DOMException on\r\n        // cross-origin iframes\r\n        const noop = () => {\r\n          return;\r\n        };\r\n        window.top.addEventListener('blur', noop);\r\n        window.top.removeEventListener('blur', noop);\r\n\r\n        // this will be the same as window if not embedded within an iframe\r\n        global = window.top;\r\n      } catch {\r\n        // fallback to current frame\r\n        global = window;\r\n\r\n        Logger.getInstance().warn(\r\n          'Failed to bind to keyboard events to top frame. ' +\r\n            'If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.'\r\n        );\r\n      }\r\n    }\r\n\r\n    global.addEventListener('blur', () => {\r\n      this._keys.length = 0; // empties array efficiently\r\n    });\r\n\r\n    // key up is on window because canvas cannot have focus\r\n    global.addEventListener('keyup', (ev: KeyboardEvent) => {\r\n      const code = ev.code as Keys;\r\n      const key = this._keys.indexOf(code);\r\n      this._keys.splice(key, 1);\r\n      this._keysUp.push(code);\r\n      const keyEvent = new KeyEvent(code, ev.key, ev);\r\n\r\n      // alias the old api, we may want to deprecate this in the future\r\n      this.eventDispatcher.emit('up', keyEvent);\r\n      this.eventDispatcher.emit('release', keyEvent);\r\n    });\r\n\r\n    // key down is on window because canvas cannot have focus\r\n    global.addEventListener('keydown', (ev: KeyboardEvent) => {\r\n      const code = ev.code as Keys;\r\n      if (this._keys.indexOf(code) === -1) {\r\n        this._keys.push(code);\r\n        this._keysDown.push(code);\r\n        const keyEvent = new KeyEvent(code, ev.key, ev);\r\n        this.eventDispatcher.emit('down', keyEvent);\r\n        this.eventDispatcher.emit('press', keyEvent);\r\n      }\r\n    });\r\n  }\r\n\r\n  public update() {\r\n    // Reset keysDown and keysUp after update is complete\r\n    this._keysDown.length = 0;\r\n    this._keysUp.length = 0;\r\n\r\n    // Emit synthetic \"hold\" event\r\n    for (let i = 0; i < this._keys.length; i++) {\r\n      this.eventDispatcher.emit('hold', new KeyEvent(this._keys[i]));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets list of keys being pressed down\r\n   */\r\n  public getKeys(): Keys[] {\r\n    return this._keys;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just pressed this frame. This is cleared at the end of the update frame.\r\n   * @param key Test whether a key was just pressed\r\n   */\r\n  public wasPressed(key: Keys): boolean {\r\n    return this._keysDown.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key is held down. This is persisted between frames.\r\n   * @param key  Test whether a key is held down\r\n   */\r\n  public isHeld(key: Keys): boolean {\r\n    return this._keys.indexOf(key) > -1;\r\n  }\r\n\r\n  /**\r\n   * Tests if a certain key was just released this frame. This is cleared at the end of the update frame.\r\n   * @param key  Test whether a key was just released\r\n   */\r\n  public wasReleased(key: Keys): boolean {\r\n    return this._keysUp.indexOf(key) > -1;\r\n  }\r\n}\r\n","import { Actor } from '../Actor';\r\nimport { Vector } from '../Math/vector';\r\nimport { Class } from '../Class';\r\nimport * as Actors from '../Util/Actors';\r\nimport { removeItemFromArray } from '../Util/Util';\r\nimport { PointerMoveEvent, PointerDownEvent, PointerUpEvent, WheelEvent } from './PointerEvents';\r\n\r\nexport interface ActorsUnderPointer {\r\n  [ActorId: number]: Actor;\r\n  length: number;\r\n}\r\n\r\n/**\r\n * The type of pointer for a [[PointerEvent]].\r\n */\r\nexport enum PointerType {\r\n  Touch = 'Touch',\r\n  Mouse = 'Mouse',\r\n  Pen = 'Pen',\r\n  Unknown = 'Unknown'\r\n}\r\n\r\n/**\r\n * Determines the scope of handling mouse/touch events. See [[Pointers]] for more information.\r\n */\r\nexport enum PointerScope {\r\n  /**\r\n   * Handle events on the `canvas` element only. Events originating outside the\r\n   * `canvas` will not be handled.\r\n   */\r\n  Canvas = 'Canvas',\r\n\r\n  /**\r\n   * Handles events on the entire document. All events will be handled by Excalibur.\r\n   */\r\n  Document = 'Document'\r\n}\r\n\r\n/**\r\n * Captures and dispatches PointerEvents\r\n */\r\nexport class Pointer extends Class {\r\n  private static _MAX_ID = 0;\r\n  public readonly id = Pointer._MAX_ID++;\r\n  private _isDown: boolean = false;\r\n  private _wasDown: boolean = false;\r\n\r\n  private _actorsUnderPointer: ActorsUnderPointer = { length: 0 };\r\n\r\n  private _actors: Actor[] = [];\r\n  private _actorsLastFrame: Actor[] = [];\r\n  private _actorsNoLongerUnderPointer: Actor[] = [];\r\n\r\n  private _actorSortingFcn = (a: Actor, b: Actor) => {\r\n    if (a.z === b.z) {\r\n      return b.id - a.id;\r\n    }\r\n    return b.z - a.z;\r\n  };\r\n\r\n  /**\r\n   * Whether the Pointer is currently dragging.\r\n   */\r\n  public get isDragging(): boolean {\r\n    return this._isDown;\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just started dragging.\r\n   */\r\n  public get isDragStart(): boolean {\r\n    return !this._wasDown && this._isDown;\r\n  }\r\n\r\n  /**\r\n   * Whether the Pointer just ended dragging.\r\n   */\r\n  public get isDragEnd(): boolean {\r\n    return this._wasDown && !this._isDown;\r\n  }\r\n\r\n  /**\r\n   * Returns true if pointer has any actors under\r\n   */\r\n  public get hasActorsUnderPointer(): boolean {\r\n    return !!this._actorsUnderPointer.length;\r\n  }\r\n\r\n  /**\r\n   * The last position on the document this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastPagePos: Vector = null;\r\n\r\n  /**\r\n   * The last position on the screen this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastScreenPos: Vector = null;\r\n\r\n  /**\r\n   * The last position in the game world coordinates this pointer was at. Can be `null` if pointer was never active.\r\n   */\r\n  public lastWorldPos: Vector = null;\r\n\r\n  /**\r\n   * Returns the currently dragging target or null if it isn't exist\r\n   */\r\n  public dragTarget: Actor = null;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.on('move', this._onPointerMove);\r\n    this.on('down', this._onPointerDown);\r\n    this.on('up', this._onPointerUp);\r\n  }\r\n\r\n  on(event: 'move', handler: (event: PointerMoveEvent) => void): void;\r\n  on(event: 'down', handler: (event: PointerDownEvent) => void): void;\r\n  on(event: 'up', handler: (event: PointerUpEvent) => void): void;\r\n  on(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  on(event: string, handler: (event: any) => void): void {\r\n    super.on(event, handler);\r\n  }\r\n\r\n  once(event: 'move', handler: (event: PointerMoveEvent) => void): void;\r\n  once(event: 'down', handler: (event: PointerDownEvent) => void): void;\r\n  once(event: 'up', handler: (event: PointerUpEvent) => void): void;\r\n  once(event: 'wheel', handler: (event: WheelEvent) => void): void;\r\n  once(event: string, handler: (event: any) => void): void {\r\n    super.once(event, handler);\r\n  }\r\n\r\n  off(event: 'move', handler?: (event: PointerMoveEvent) => void): void;\r\n  off(event: 'down', handler?: (event: PointerDownEvent) => void): void;\r\n  off(event: 'up', handler?: (event: PointerUpEvent) => void): void;\r\n  off(event: 'wheel', handler?: (event: WheelEvent) => void): void;\r\n  off(event: string, handler?: (event: any) => void): void {\r\n    super.off(event, handler);\r\n  }\r\n\r\n  /**\r\n   * Update the state of current pointer, meant to be called a the end of frame\r\n   */\r\n  public update(): void {\r\n    if (this._wasDown && !this._isDown) {\r\n      this._wasDown = false;\r\n    } else if (!this._wasDown && this._isDown) {\r\n      this._wasDown = true;\r\n    }\r\n    this._actorsLastFrame = [...this._actors];\r\n    this._actorsNoLongerUnderPointer = [];\r\n  }\r\n\r\n  /**\r\n   * Adds an Actor to actorsUnderPointer object.\r\n   * @param actor An Actor to be added;\r\n   */\r\n  public addActorUnderPointer(actor: Actor): void {\r\n    if (!this.isActorAliveUnderPointer(actor)) {\r\n      this._actorsUnderPointer[actor.id] = actor;\r\n      this._actorsUnderPointer.length += 1;\r\n      this._actors.push(actor);\r\n    }\r\n\r\n    // Actors are processed in z-order highest z to lowest\r\n    // ties are broken by id highest id (newest) to lowest id (oldest)\r\n    this._actors.sort(this._actorSortingFcn);\r\n  }\r\n\r\n  /**\r\n   * Removes an Actor from actorsUnderPointer object.\r\n   * @param actor An Actor to be removed;\r\n   */\r\n  public removeActorUnderPointer(actor: Actor): void {\r\n    if (this.isActorAliveUnderPointer(actor)) {\r\n      delete this._actorsUnderPointer[actor.id];\r\n      this._actorsUnderPointer.length -= 1;\r\n      removeItemFromArray(actor, this._actors);\r\n      this._actorsNoLongerUnderPointer.push(actor);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns all actors under this pointer this frame\r\n   */\r\n  public getActorsUnderPointer(): Actor[] {\r\n    return this._actors;\r\n  }\r\n\r\n  /**\r\n   * Returns all actors that are no longer under the pointer this frame\r\n   */\r\n  public getActorsUnderPointerLastFrame(): Actor[] {\r\n    return this._actorsLastFrame;\r\n  }\r\n\r\n  /**\r\n   * Returns all actors relevant for events to pointer this frame\r\n   */\r\n  public getActorsForEvents(): Actor[] {\r\n    return this._actors\r\n      .concat(this._actorsLastFrame)\r\n      .filter((actor, i, self) => {\r\n        return self.indexOf(actor) === i; // de-dup\r\n      })\r\n      .sort(this._actorSortingFcn); // sort by z\r\n  }\r\n\r\n  /**\r\n   * Checks if Pointer location has a specific Actor bounds contained underneath.\r\n   * @param actor An Actor for check;\r\n   */\r\n  public checkActorUnderPointer(actor: Actor): boolean {\r\n    if (this.lastWorldPos) {\r\n      return actor.contains(this.lastWorldPos.x, this.lastWorldPos.y, !Actors.isScreenElement(actor));\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Checks if an actor was under the pointer last frame\r\n   * @param actor\r\n   */\r\n  public wasActorUnderPointer(actor: Actor): boolean {\r\n    return this._actorsLastFrame.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Checks if Pointer has a specific Actor in ActorsUnderPointer list.\r\n   * @param actor An Actor for check;\r\n   */\r\n  public isActorAliveUnderPointer(actor: Actor): boolean {\r\n    return !!(!actor.isKilled() && actor.scene && this._actorsUnderPointer.hasOwnProperty(actor.id.toString()));\r\n  }\r\n\r\n  private _onPointerMove(ev: PointerMoveEvent): void {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n  }\r\n\r\n  private _onPointerDown(ev: PointerDownEvent): void {\r\n    this.lastPagePos = new Vector(ev.pagePos.x, ev.pagePos.y);\r\n    this.lastScreenPos = new Vector(ev.screenPos.x, ev.screenPos.y);\r\n    this.lastWorldPos = new Vector(ev.worldPos.x, ev.worldPos.y);\r\n    this._isDown = true;\r\n  }\r\n\r\n  private _onPointerUp(_ev: PointerUpEvent): void {\r\n    this._isDown = false;\r\n    this.dragTarget = null;\r\n  }\r\n}\r\n","import { Actor } from '../Actor';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Vector } from '../Math/vector';\r\nimport { Pointer, PointerType } from './Pointer';\r\nimport { GameEvent } from '../Events';\r\n\r\n/**\r\n * Native browser button enumeration\r\n */\r\nexport enum NativePointerButton {\r\n  NoButton = -1,\r\n  Left = 0,\r\n  Middle = 1,\r\n  Right = 2,\r\n  Unknown = 3\r\n}\r\n\r\n/**\r\n * The mouse button being pressed.\r\n */\r\nexport enum PointerButton {\r\n  Left = 'Left',\r\n  Middle = 'Middle',\r\n  Right = 'Right',\r\n  Unknown = 'Unknown',\r\n  NoButton = 'NoButton'\r\n}\r\n\r\nexport enum WheelDeltaMode {\r\n  Pixel = 'Pixel',\r\n  Line = 'Line',\r\n  Page = 'Page'\r\n}\r\n\r\n/**\r\n * Type that indicates Excalibur's valid synthetic pointer events\r\n */\r\nexport type PointerEventName =\r\n  | 'pointerdragstart'\r\n  | 'pointerdragend'\r\n  | 'pointerdragmove'\r\n  | 'pointerdragenter'\r\n  | 'pointerdragleave'\r\n  | 'pointermove'\r\n  | 'pointerenter'\r\n  | 'pointerleave'\r\n  | 'pointerup'\r\n  | 'pointerdown';\r\n\r\n/**\r\n * Pointer events\r\n *\r\n * Represents a mouse, touch, or stylus event. See [[Pointers]] for more information on\r\n * handling pointer input.\r\n *\r\n * For mouse-based events, you can inspect [[PointerEvent.button]] to see what button was pressed.\r\n */\r\nexport class PointerEvent extends GameEvent<Actor> {\r\n  protected _name: string;\r\n\r\n  public get name() {\r\n    return this._name;\r\n  }\r\n\r\n  /** The world coordinates of the event. */\r\n  public get worldPos(): Vector {\r\n    return this.coordinates.worldPos.clone();\r\n  }\r\n\r\n  /** The page coordinates of the event. */\r\n  public get pagePos(): Vector {\r\n    return this.coordinates.pagePos.clone();\r\n  }\r\n\r\n  /** The screen coordinates of the event. */\r\n  public get screenPos(): Vector {\r\n    return this.coordinates.screenPos.clone();\r\n  }\r\n\r\n  /**\r\n   * @param coordinates         The [[GlobalCoordinates]] of the event\r\n   * @param pointer             The [[Pointer]] of the event\r\n   * @param index               The index of the pointer (zero-based)\r\n   * @param pointerType         The type of pointer\r\n   * @param button              The button pressed (if [[PointerType.Mouse]])\r\n   * @param ev                  The raw DOM event being handled\r\n   */\r\n  constructor(\r\n    protected coordinates: GlobalCoordinates,\r\n    public pointer: Pointer,\r\n    public index: number,\r\n    public pointerType: PointerType,\r\n    public button: PointerButton,\r\n    public ev: any\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  public get pos(): Vector {\r\n    return this.coordinates.worldPos.clone();\r\n  }\r\n\r\n  public _canceled = false;\r\n\r\n  /**\r\n   * Cancels pointer event propogation, event will not be transmitted to any other actors\r\n   */\r\n  public cancel() {\r\n    this._canceled = true;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns If the event is canceled it will no longer be transmitted to any other actors\r\n   */\r\n  public isCanceled() {\r\n    return this._canceled;\r\n  }\r\n\r\n  public propagate(actor: Actor): void {\r\n    this.doAction(actor);\r\n\r\n    if (this.bubbles && !this.isCanceled() && actor.parent) {\r\n      this.propagate(actor.parent as Actor); // TODO not true\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public doAction(actor: Actor): void {\r\n    if (actor) {\r\n      this._onActionStart(actor);\r\n      actor.emit(this._name, this);\r\n      this._onActionEnd(actor);\r\n    }\r\n  }\r\n\r\n  protected _onActionStart(_actor?: Actor) {\r\n    // to be rewritten\r\n  }\r\n\r\n  protected _onActionEnd(_actor?: Actor) {\r\n    // to be rewritten\r\n  }\r\n}\r\n\r\nexport class PointerEventFactory<T extends PointerEvent> {\r\n  constructor(\r\n    protected _pointerEventType: new (\r\n      coordinates: GlobalCoordinates,\r\n      pointer: Pointer,\r\n      index: number,\r\n      pointerType: PointerType,\r\n      button: PointerButton,\r\n      ev: any\r\n    ) => T\r\n  ) {}\r\n\r\n  /**\r\n   * Create specific PointerEvent\r\n   */\r\n  public create(\r\n    coordinates: GlobalCoordinates,\r\n    pointer: Pointer,\r\n    index: number,\r\n    pointerType: PointerType,\r\n    button: PointerButton,\r\n    ev: any\r\n  ): T {\r\n    return new this._pointerEventType(coordinates, pointer, index, pointerType, button, ev);\r\n  }\r\n}\r\n\r\nexport class PointerDragEvent extends PointerEvent {}\r\n\r\nexport class PointerUpEvent extends PointerEvent {\r\n  protected _name = 'pointerup';\r\n\r\n  protected _onActionEnd(actor: Actor) {\r\n    const pointer = this.pointer;\r\n\r\n    if (pointer.isDragEnd && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragend', this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class PointerDownEvent extends PointerEvent {\r\n  protected _name = 'pointerdown';\r\n\r\n  protected _onActionEnd(actor: Actor) {\r\n    if (this.pointer.isDragStart && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragstart', this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class PointerMoveEvent extends PointerEvent {\r\n  protected _name = 'pointermove';\r\n\r\n  public propagate(actor: Actor): void {\r\n    // If the actor was under the pointer last frame, but not this one it left\r\n    // if (this.pointer.wasActorUnderPointer(actor) && !this.pointer.isActorUnderPointer(actor)) {\r\n    //   this._onActorLeave(actor);\r\n    //   return;\r\n    // }\r\n\r\n    if (this.pointer.isActorAliveUnderPointer(actor)) {\r\n      this.doAction(actor);\r\n\r\n      if (this.bubbles && !this.isCanceled() && actor.parent) {\r\n        this.propagate(actor.parent as Actor); // TODO not true\r\n      }\r\n    }\r\n  }\r\n\r\n  protected _onActionStart(actor: Actor) {\r\n    if (!actor.capturePointer.captureMoveEvents) {\r\n      return;\r\n    }\r\n\r\n    // In the case this is new\r\n    // if (this.pointer.checkActorUnderPointer(actor) && !this.pointer.wasActorUnderPointer(actor)) {\r\n    //   this._onActorEnter(actor);\r\n    // }\r\n\r\n    if (this.pointer.isDragging && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragmove', this);\r\n    }\r\n  }\r\n\r\n  // private _onActorEnter(actor: Actor) {\r\n  //   const pe = createPointerEventByName('enter', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\r\n  //   pe.propagate(actor);\r\n  //   this.pointer.addActorUnderPointer(actor);\r\n\r\n  //   if (this.pointer.isDragging) {\r\n  //     this.pointer.dragTarget = actor;\r\n  //   }\r\n  // }\r\n\r\n  // private _onActorLeave(actor: Actor) {\r\n  //   const pe = createPointerEventByName('leave', this.coordinates, this.pointer, this.index, this.pointerType, this.button, this.ev);\r\n  //   pe.propagate(actor);\r\n  //   this.pointer.removeActorUnderPointer(actor);\r\n  // }\r\n}\r\n\r\nexport class PointerEnterEvent extends PointerEvent {\r\n  protected _name = 'pointerenter';\r\n\r\n  protected _onActionStart(actor: Actor) {\r\n    if (!actor.capturePointer.captureMoveEvents) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  protected _onActionEnd(actor: Actor) {\r\n    const pointer = this.pointer;\r\n\r\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragenter', this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class PointerLeaveEvent extends PointerEvent {\r\n  protected _name = 'pointerleave';\r\n\r\n  protected _onActionStart(actor: Actor) {\r\n    if (!actor.capturePointer.captureMoveEvents) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  protected _onActionEnd(actor: Actor) {\r\n    const pointer = this.pointer;\r\n\r\n    if (pointer.isDragging && actor.capturePointer.captureDragEvents) {\r\n      actor.eventDispatcher.emit('pointerdragleave', this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class PointerCancelEvent extends PointerEvent {\r\n  protected _name = 'pointercancel';\r\n}\r\n/**\r\n * Wheel Events\r\n *\r\n * Represents a mouse wheel event. See [[Pointers]] for more information on\r\n * handling point input.\r\n */\r\nexport class WheelEvent extends GameEvent<Actor> {\r\n  /**\r\n   * @param x            The `x` coordinate of the event (in world coordinates)\r\n   * @param y            The `y` coordinate of the event (in world coordinates)\r\n   * @param pageX        The `x` coordinate of the event (in document coordinates)\r\n   * @param pageY        The `y` coordinate of the event (in document coordinates)\r\n   * @param screenX      The `x` coordinate of the event (in screen coordinates)\r\n   * @param screenY      The `y` coordinate of the event (in screen coordinates)\r\n   * @param index        The index of the pointer (zero-based)\r\n   * @param deltaX       The type of pointer\r\n   * @param deltaY       The type of pointer\r\n   * @param deltaZ       The type of pointer\r\n   * @param deltaMode    The type of movement [[WheelDeltaMode]]\r\n   * @param ev           The raw DOM event being handled\r\n   */\r\n  constructor(\r\n    public x: number,\r\n    public y: number,\r\n    public pageX: number,\r\n    public pageY: number,\r\n    public screenX: number,\r\n    public screenY: number,\r\n    public index: number,\r\n    public deltaX: number,\r\n    public deltaY: number,\r\n    public deltaZ: number,\r\n    public deltaMode: WheelDeltaMode,\r\n    public ev: any\r\n  ) {\r\n    super();\r\n  }\r\n\r\n  private _isCanceled = false;\r\n\r\n  /**\r\n   * Cancels pointer event propogation, event will not be transmitted to any other actors\r\n   */\r\n  public cancel() {\r\n    this._isCanceled = true;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @returns If the event is canceled it will no longer be transmitted to any other actors\r\n   */\r\n  public isCanceled() {\r\n    return this._isCanceled;\r\n  }\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function createPointerEventByName(\r\n  eventName: string,\r\n  coordinates: GlobalCoordinates,\r\n  pointer: Pointer,\r\n  index: number,\r\n  pointerType: PointerType,\r\n  button: PointerButton,\r\n  ev: any\r\n) {\r\n  let factory: PointerEventFactory<PointerEvent>;\r\n\r\n  switch (eventName) {\r\n    case 'up':\r\n      factory = new PointerEventFactory(<any>PointerUpEvent);\r\n      break;\r\n    case 'down':\r\n      factory = new PointerEventFactory(<any>PointerDownEvent);\r\n      break;\r\n    case 'move':\r\n      factory = new PointerEventFactory(<any>PointerMoveEvent);\r\n      break;\r\n    case 'cancel':\r\n      factory = new PointerEventFactory(<any>PointerCancelEvent);\r\n      break;\r\n    case 'enter':\r\n      factory = new PointerEventFactory(<any>PointerEnterEvent);\r\n      break;\r\n    case 'leave':\r\n      factory = new PointerEventFactory(<any>PointerLeaveEvent);\r\n      break;\r\n  }\r\n\r\n  return factory.create(coordinates, pointer, index, pointerType, button, ev);\r\n}\r\n","import { ScreenElement } from './ScreenElement';\r\nimport {\r\n  InitializeEvent,\r\n  ActivateEvent,\r\n  DeactivateEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  PreDebugDrawEvent,\r\n  PostDebugDrawEvent,\r\n  GameEvent\r\n} from './Events';\r\nimport { Logger } from './Util/Log';\r\nimport { Timer } from './Timer';\r\nimport { Engine } from './Engine';\r\nimport { TileMap } from './TileMap';\r\nimport { Camera } from './Camera';\r\nimport { Actor } from './Actor';\r\nimport { Class } from './Class';\r\nimport { CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw } from './Interfaces/LifecycleEvents';\r\nimport * as Util from './Util/Util';\r\nimport * as Events from './Events';\r\nimport * as ActorUtils from './Util/Actors';\r\nimport { Trigger } from './Trigger';\r\nimport { SystemType } from './EntityComponentSystem/System';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { World } from './EntityComponentSystem/World';\r\nimport { MotionSystem } from './Collision/MotionSystem';\r\nimport { CollisionSystem } from './Collision/CollisionSystem';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { GraphicsSystem } from './Graphics/GraphicsSystem';\r\nimport { CanvasDrawingSystem } from './Drawing/CanvasDrawingSystem';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { DebugSystem } from './Debug/DebugSystem';\r\nimport { ActionsSystem } from './Actions/ActionsSystem';\r\n/**\r\n * [[Actor|Actors]] are composed together into groupings called Scenes in\r\n * Excalibur. The metaphor models the same idea behind real world\r\n * actors in a scene. Only actors in scenes will be updated and drawn.\r\n *\r\n * Typical usages of a scene include: levels, menus, loading screens, etc.\r\n */\r\nexport class Scene extends Class implements CanInitialize, CanActivate, CanDeactivate, CanUpdate, CanDraw {\r\n  private _logger: Logger = Logger.getInstance();\r\n  /**\r\n   * Gets or sets the current camera for the scene\r\n   */\r\n  public camera: Camera = new Camera();\r\n\r\n  /**\r\n   * The ECS world for the scene\r\n   */\r\n  public world = new World(this);\r\n\r\n  /**\r\n   * The actors in the current scene\r\n   */\r\n  public get actors(): Actor[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Actor;\r\n    }) as Actor[];\r\n  }\r\n\r\n  /**\r\n   * The entities in the current scene\r\n   */\r\n  public get entities(): Entity[] {\r\n    return this.world.entityManager.entities;\r\n  }\r\n\r\n  /**\r\n   * The triggers in the current scene\r\n   */\r\n  public get triggers(): Trigger[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof Trigger;\r\n    }) as Trigger[];\r\n  }\r\n\r\n  /**\r\n   * The [[TileMap]]s in the scene, if any\r\n   */\r\n  public get tileMaps(): TileMap[] {\r\n    return this.world.entityManager.entities.filter((e) => {\r\n      return e instanceof TileMap;\r\n    }) as TileMap[];\r\n  }\r\n\r\n  /**\r\n   * Access to the Excalibur engine\r\n   */\r\n  public engine: Engine;\r\n\r\n  /**\r\n   * The [[ScreenElement]]s in a scene, if any; these are drawn last\r\n   * @deprecated Use [[Scene.actors]]\r\n   */\r\n  @obsolete({\r\n    message: 'Will be removed in excalibur v0.26.0',\r\n    alternateMethod: 'ScreenElements now are normal actors with a Transform Coordinate Plane of Screen'\r\n  })\r\n  public get screenElements(): ScreenElement[] {\r\n    return this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n  }\r\n\r\n  private _isInitialized: boolean = false;\r\n  private _timers: Timer[] = [];\r\n  private _cancelQueue: Timer[] = [];\r\n\r\n  constructor() {\r\n    super();\r\n    // TODO how to people do there own systems\r\n    // Initialize systems\r\n    this.world.add(new ActionsSystem());\r\n    this.world.add(new MotionSystem());\r\n    this.world.add(new CollisionSystem());\r\n    if (Flags.isEnabled(Legacy.LegacyDrawing)) {\r\n      this.world.add(new CanvasDrawingSystem());\r\n    } else {\r\n      this.world.add(new GraphicsSystem());\r\n    }\r\n    this.world.add(new DebugSystem());\r\n  }\r\n\r\n  public on(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public on(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public on(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public on(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: InitializeEvent<Scene>) => void): void;\r\n  public once(eventName: Events.activate, handler: (event: ActivateEvent) => void): void;\r\n  public once(eventName: Events.deactivate, handler: (event: DeactivateEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: Events.predebugdraw, handler: (event: PreDebugDrawEvent) => void): void;\r\n  public once(eventName: Events.postdebugdraw, handler: (event: PostDebugDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: InitializeEvent<Scene>) => void): void;\r\n  public off(eventName: Events.activate, handler?: (event: ActivateEvent) => void): void;\r\n  public off(eventName: Events.deactivate, handler?: (event: DeactivateEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Scene>) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: Events.predebugdraw, handler?: (event: PreDebugDrawEvent) => void): void;\r\n  public off(eventName: Events.postdebugdraw, handler?: (event: PostDebugDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * This is called before the first update of the [[Scene]]. Initializes scene members like the camera. This method is meant to be\r\n   * overridden. This is where initialization of child actors should take place.\r\n   */\r\n  public onInitialize(_engine: Engine): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made active and started. It is meant to be overridden,\r\n   * this is where you should setup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onActivate(_oldScene: Scene, _newScene: Scene): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * This is called when the scene is made transitioned away from and stopped. It is meant to be overridden,\r\n   * this is where you should cleanup any DOM UI or event handlers needed for the scene.\r\n   */\r\n  public onDeactivate(_oldScene: Scene, _newScene: Scene): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreUpdate` is called directly before a scene is updated.\r\n   */\r\n  public onPreUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostUpdate lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostUpdate` is called directly after a scene is updated.\r\n   */\r\n  public onPostUpdate(_engine: Engine, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPreDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPreDraw` is called directly before a scene is drawn.\r\n   */\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Safe to override onPostDraw lifecycle event handler. Synonymous with `.on('preupdate', (evt) =>{...})`\r\n   *\r\n   * `onPostDraw` is called directly after a scene is drawn.\r\n   */\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    // will be overridden\r\n  }\r\n\r\n  /**\r\n   * Initializes actors in the scene\r\n   */\r\n  private _initializeChildren(): void {\r\n    for (const child of this.entities) {\r\n      child._initialize(this.engine);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets whether or not the [[Scene]] has been initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Initializes the scene before the first update, meant to be called by engine not by users of\r\n   * Excalibur\r\n   * @internal\r\n   */\r\n  public _initialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.engine = engine;\r\n      // Initialize camera first\r\n      this.camera._initialize(engine);\r\n\r\n      // This order is important! we want to be sure any custom init that add actors\r\n      // fire before the actor init\r\n      this.onInitialize.call(this, engine);\r\n      this._initializeChildren();\r\n\r\n      this._logger.debug('Scene.onInitialize', this, engine);\r\n      this.eventDispatcher.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Activates the scene with the base behavior, then calls the overridable `onActivate` implementation.\r\n   * @internal\r\n   */\r\n  public _activate(oldScene: Scene, newScene: Scene): void {\r\n    this._logger.debug('Scene.onActivate', this);\r\n    this.onActivate(oldScene, newScene);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Deactivates the scene with the base behavior, then calls the overridable `onDeactivate` implementation.\r\n   * @internal\r\n   */\r\n  public _deactivate(oldScene: Scene, newScene: Scene): void {\r\n    this._logger.debug('Scene.onDeactivate', this);\r\n    this.onDeactivate(oldScene, newScene);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPreUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _preupdate(_engine: Engine, delta: number): void {\r\n    this.emit('preupdate', new PreUpdateEvent(_engine, delta, this));\r\n    this.onPreUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   *  It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _preupdate handler for [[onPostUpdate]] lifecycle event\r\n   * @internal\r\n   */\r\n  public _postupdate(_engine: Engine, delta: number): void {\r\n    this.emit('postupdate', new PostUpdateEvent(_engine, delta, this));\r\n    this.onPostUpdate(_engine, delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _predraw handler for [[onPreDraw]] lifecycle event\r\n   *\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, _delta, this));\r\n    this.onPreDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * It is not recommended that internal excalibur methods be overridden, do so at your own risk.\r\n   *\r\n   * Internal _postdraw handler for [[onPostDraw]] lifecycle event\r\n   *\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: CanvasRenderingContext2D, _delta: number): void {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, _delta, this));\r\n    this.onPostDraw(_ctx, _delta);\r\n  }\r\n\r\n  /**\r\n   * Updates all the actors and timers in the scene. Called by the [[Engine]].\r\n   * @param engine  Reference to the current Engine\r\n   * @param delta   The number of milliseconds since the last update\r\n   */\r\n  public update(engine: Engine, delta: number) {\r\n    this._preupdate(engine, delta);\r\n    if (this.camera) {\r\n      this.camera.update(engine, delta);\r\n    }\r\n    // TODO differed entity removal for timers\r\n    let i: number, len: number;\r\n    // Remove timers in the cancel queue before updating them\r\n    for (i = 0, len = this._cancelQueue.length; i < len; i++) {\r\n      this.removeTimer(this._cancelQueue[i]);\r\n    }\r\n    this._cancelQueue.length = 0;\r\n\r\n    // Cycle through timers updating timers\r\n    for (const timer of this._timers) {\r\n      timer.update(delta);\r\n    }\r\n\r\n    this.world.update(SystemType.Update, delta);\r\n\r\n    this._collectActorStats(engine);\r\n\r\n    engine.input.pointers.dispatchPointerEvents();\r\n\r\n    this._postupdate(engine, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors in the Scene. Called by the [[Engine]].\r\n   * @param ctx    The current rendering context\r\n   * @param delta  The number of milliseconds since the last draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, delta: number) {\r\n    this._predraw(ctx, delta);\r\n\r\n    this.world.update(SystemType.Draw, delta);\r\n\r\n    if (this.engine?.isDebug) {\r\n      this.debugDraw(ctx);\r\n    }\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * Draws all the actors' debug information in the Scene. Called by the [[Engine]].\r\n   * @param ctx  The current rendering context\r\n   * @deprecated\r\n   */\r\n  /* istanbul ignore next */\r\n  public debugDraw(ctx: CanvasRenderingContext2D) {\r\n    this.emit('predebugdraw', new PreDebugDrawEvent(ctx, this));\r\n    // pass\r\n    this.emit('postdebugdraw', new PostDebugDrawEvent(ctx, this));\r\n  }\r\n\r\n  /**\r\n   * Checks whether an actor is contained in this scene or not\r\n   */\r\n  public contains(actor: Actor): boolean {\r\n    return this.actors.indexOf(actor) > -1;\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the current [[Scene]].\r\n   * @param timer  The timer to add to the current [[Scene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[Scene]], once this is done the [[TileMap]] will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Adds a [[Trigger]] to the [[Scene]], once this is done the [[Trigger]] will listen for interactions with other actors.\r\n   * @param trigger\r\n   */\r\n  public add(trigger: Trigger): void;\r\n\r\n  /**\r\n   * Adds an actor to the scene, once this is done the [[Actor]] will be drawn and updated.\r\n   * @param actor  The actor to add to the current scene\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  public add(entity: Entity): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the scene.\r\n   * @param screenElement  The ScreenElement to add to the current scene\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    this.emit('entityadded', { target: entity } as any);\r\n    this.world.add(entity);\r\n    entity.scene = this;\r\n    if (entity instanceof Timer) {\r\n      if (!Util.contains(this._timers, entity)) {\r\n        this.addTimer(entity);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the current scene, it will no longer be updated.\r\n   * @param timer  The timer to remove to the current scene.\r\n   */\r\n  public remove(timer: Timer): void;\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @param tileMap {TileMap}\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n\r\n  /**\r\n   * Removes an actor from the scene, it will no longer be drawn or updated.\r\n   * @param actor  The actor to remove from the current scene.\r\n   */\r\n  public remove(actor: Actor): void;\r\n\r\n  public remove(entity: Entity): void;\r\n\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the current scene\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.emit('entityremoved', { target: entity } as any);\r\n      this.world.remove(entity);\r\n    }\r\n    if (entity instanceof Timer) {\r\n      this.removeTimer(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds (any) actor to act as a piece of UI, meaning it is always positioned\r\n   * in screen coordinates. UI actors do not participate in collisions.\r\n   * @todo Should this be `ScreenElement` only?\r\n   * @deprecated Use [[Scene.add]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\r\n  public addScreenElement(actor: Actor) {\r\n    this.add(actor);\r\n  }\r\n\r\n  /**\r\n   * Removes an actor as a piece of UI\r\n   * @deprecated Use [[Scene.remove]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\r\n  public removeScreenElement(actor: Actor) {\r\n    this.remove(actor);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the scene, once this is done the TileMap will be drawn and updated.\r\n   * @deprecated Use [[Scene.add]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.add' })\r\n  public addTileMap(tileMap: TileMap) {\r\n    this.world.add(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the scene, it will no longer be drawn or updated.\r\n   * @deprecated Use [[Scene.remove]]\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Scene.remove' })\r\n  public removeTileMap(tileMap: TileMap) {\r\n    this.world.remove(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the scene\r\n   * @param timer  The timer to add\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    this._timers.push(timer);\r\n    timer.scene = this;\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the scene.\r\n   * @warning Can be dangerous, use [[cancelTimer]] instead\r\n   * @param timer  The timer to remove\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    const i = this._timers.indexOf(timer);\r\n    if (i !== -1) {\r\n      this._timers.splice(i, 1);\r\n    }\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Cancels a [[Timer]], removing it from the scene nicely\r\n   * @param timer  The timer to cancel\r\n   */\r\n  public cancelTimer(timer: Timer): Timer {\r\n    this._cancelQueue.push(timer);\r\n    return timer;\r\n  }\r\n\r\n  /**\r\n   * Tests whether a [[Timer]] is active in the scene\r\n   */\r\n  public isTimerActive(timer: Timer): boolean {\r\n    return this._timers.indexOf(timer) > -1 && !timer.complete;\r\n  }\r\n\r\n  public isCurrentScene(): boolean {\r\n    if (this.engine) {\r\n      return this.engine.currentScene === this;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private _collectActorStats(engine: Engine) {\r\n    const screenElements = this.actors.filter((a) => a instanceof ScreenElement) as ScreenElement[];\r\n    for (const _ui of screenElements) {\r\n      engine.stats.currFrame.actors.ui++;\r\n    }\r\n\r\n    for (const actor of this.actors) {\r\n      engine.stats.currFrame.actors.alive++;\r\n      for (const child of actor.children) {\r\n        if (ActorUtils.isScreenElement(child as Actor)) {\r\n          // TODO not true\r\n          engine.stats.currFrame.actors.ui++;\r\n        } else {\r\n          engine.stats.currFrame.actors.alive++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\r\nimport { ColorBlindCorrector, ColorBlindness } from '../PostProcessing/Index';\r\n\r\nexport interface DebugFlags {\r\n  colorBlindMode: ColorBlindFlags;\r\n}\r\n\r\nexport class ColorBlindFlags {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n  }\r\n\r\n  public correct(colorBlindness: ColorBlindness) {\r\n    this._engine.postProcessors.push(new ColorBlindCorrector(this._engine, false, colorBlindness));\r\n  }\r\n\r\n  public simulate(colorBlindness: ColorBlindness) {\r\n    this._engine.postProcessors.push(new ColorBlindCorrector(this._engine, true, colorBlindness));\r\n  }\r\n}\r\n","import { DebugFlags, ColorBlindFlags } from './DebugFlags';\r\nimport { Engine } from '../Engine';\r\nimport { Color } from '../Color';\r\nimport { CollisionContact } from '../Collision/Detection/CollisionContact';\r\n\r\n/**\r\n * Debug stats containing current and previous frame statistics\r\n */\r\nexport interface DebugStats {\r\n  currFrame: FrameStats;\r\n  prevFrame: FrameStats;\r\n}\r\n\r\n/**\r\n * Represents a frame's individual statistics\r\n */\r\nexport interface FrameStatistics {\r\n  /**\r\n   * The number of the frame\r\n   */\r\n  id: number;\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame scaled by [[Engine.timescale]]) (in ms)\r\n   */\r\n  delta: number;\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  fps: number;\r\n\r\n  /**\r\n   * Duration statistics (in ms)\r\n   */\r\n  duration: FrameDurationStats;\r\n\r\n  /**\r\n   * Actor statistics\r\n   */\r\n  actors: FrameActorStats;\r\n\r\n  /**\r\n   * Physics statistics\r\n   */\r\n  physics: PhysicsStatistics;\r\n\r\n  /**\r\n   * Graphics statistics\r\n   */\r\n  graphics: GraphicsStatistics;\r\n}\r\n\r\n/**\r\n * Represents actor stats for a frame\r\n */\r\nexport interface FrameActorStats {\r\n  /**\r\n   * Gets the frame's number of actors (alive)\r\n   */\r\n  alive: number;\r\n\r\n  /**\r\n   * Gets the frame's number of actors (killed)\r\n   */\r\n  killed: number;\r\n\r\n  /**\r\n   * Gets the frame's number of remaining actors (alive - killed)\r\n   */\r\n  remaining: number;\r\n\r\n  /**\r\n   * Gets the frame's number of UI actors\r\n   */\r\n  ui: number;\r\n\r\n  /**\r\n   * Gets the frame's number of total actors (remaining + UI)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents duration stats for a frame\r\n */\r\nexport interface FrameDurationStats {\r\n  /**\r\n   * Gets the frame's total time to run the update function (in ms)\r\n   */\r\n  update: number;\r\n\r\n  /**\r\n   * Gets the frame's total time to run the draw function (in ms)\r\n   */\r\n  draw: number;\r\n\r\n  /**\r\n   * Gets the frame's total render duration (update + draw duration) (in ms)\r\n   */\r\n  total: number;\r\n}\r\n\r\n/**\r\n * Represents physics stats for the current frame\r\n */\r\nexport interface PhysicsStatistics {\r\n  /**\r\n   * Gets the number of broadphase collision pairs which\r\n   */\r\n  pairs: number;\r\n\r\n  /**\r\n   * Gets the number of actual collisions\r\n   */\r\n  collisions: number;\r\n\r\n  /**\r\n   * Copy of the current frame contacts (only updated if debug is toggled on)\r\n   */\r\n  contacts: Map<string, CollisionContact>;\r\n\r\n  /**\r\n   * Gets the number of fast moving bodies using raycast continuous collisions in the scene\r\n   */\r\n  fastBodies: number;\r\n\r\n  /**\r\n   * Gets the number of bodies that had a fast body collision resolution\r\n   */\r\n  fastBodyCollisions: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the broadphase pairs\r\n   */\r\n  broadphase: number;\r\n\r\n  /**\r\n   * Gets the time it took to calculate the narrowphase\r\n   */\r\n  narrowphase: number;\r\n}\r\n\r\nexport interface GraphicsStatistics {\r\n  drawCalls: number;\r\n  drawnImages: number;\r\n}\r\n\r\n/**\r\n * Debug statistics and flags for Excalibur. If polling these values, it would be\r\n * best to do so on the `postupdate` event for [[Engine]], after all values have been\r\n * updated during a frame.\r\n */\r\nexport class Debug implements DebugFlags {\r\n  private _engine: Engine;\r\n\r\n  constructor(engine: Engine) {\r\n    this._engine = engine;\r\n\r\n    this.colorBlindMode = new ColorBlindFlags(this._engine);\r\n  }\r\n\r\n  /**\r\n   * Performance statistics\r\n   */\r\n  public stats: DebugStats = {\r\n    /**\r\n     * Current frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[postframe]] event. See [[FrameStats]]\r\n     */\r\n    currFrame: new FrameStats(),\r\n\r\n    /**\r\n     * Previous frame statistics. Engine reuses this instance, use [[FrameStats.clone]] to copy frame stats.\r\n     * Best accessed on [[preframe]] event. Best inspected on engine event `preframe`. See [[FrameStats]]\r\n     */\r\n    prevFrame: new FrameStats()\r\n  };\r\n\r\n  /**\r\n   * Correct or simulate color blindness using [[ColorBlindness]] post processor.\r\n   * @warning Will reduce FPS.\r\n   */\r\n  public colorBlindMode: ColorBlindFlags;\r\n\r\n  /**\r\n   * Filter debug context to named entities or entity ids\r\n   */\r\n  public filter: { useFilter: boolean; nameQuery: string; ids: number[] } = {\r\n    /**\r\n     * Toggle filter on or off (default off) must be on for DebugDraw to use filters\r\n     */\r\n    useFilter: false,\r\n    /**\r\n     * Query for entities by name, if the entity name contains `nameQuery` it will be included\r\n     */\r\n    nameQuery: '',\r\n    /**\r\n     * Query for Entity ids, if the id matches it will be included\r\n     */\r\n    ids: []\r\n  };\r\n\r\n  /**\r\n   * Entity debug settings\r\n   */\r\n  public entity = {\r\n    showAll: false,\r\n    showId: true,\r\n    showName: false\r\n  };\r\n\r\n  /**\r\n   * Transform component debug settings\r\n   */\r\n  public transform = {\r\n    showAll: false,\r\n\r\n    showPosition: false,\r\n    positionColor: Color.Yellow,\r\n\r\n    showScale: false,\r\n    scaleColor: Color.Green,\r\n\r\n    showRotation: false,\r\n    rotationColor: Color.Blue\r\n  };\r\n\r\n  /**\r\n   * Graphics component debug settings\r\n   */\r\n  public graphics = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Yellow\r\n  };\r\n\r\n  /**\r\n   * Collider component debug settings\r\n   */\r\n  public collider = {\r\n    showAll: false,\r\n\r\n    showBounds: true,\r\n    boundsColor: Color.Blue,\r\n\r\n    showOwner: false,\r\n\r\n    showGeometry: true,\r\n    geometryColor: Color.Green\r\n  };\r\n\r\n  /**\r\n   * Physics simulation debug settings\r\n   */\r\n  public physics = {\r\n    showAll: false,\r\n\r\n    showBroadphaseSpacePartitionDebug: false,\r\n\r\n    showCollisionNormals: false,\r\n    collisionNormalColor: Color.Cyan,\r\n\r\n    showCollisionContacts: true,\r\n    collisionContactColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Motion component debug settings\r\n   */\r\n  public motion = {\r\n    showAll: false,\r\n\r\n    showVelocity: false,\r\n    velocityColor: Color.Yellow,\r\n\r\n    showAcceleration: false,\r\n    accelerationColor: Color.Red\r\n  };\r\n\r\n  /**\r\n   * Body component debug settings\r\n   */\r\n  public body = {\r\n    showAll: false,\r\n\r\n    showCollisionGroup: false,\r\n    showCollisionType: false,\r\n    showSleeping: false,\r\n    showMotion: false,\r\n    showMass: false\r\n  };\r\n\r\n  /**\r\n   * Camera debug settings\r\n   */\r\n  public camera = {\r\n    showAll: false,\r\n\r\n    showFocus: false,\r\n    focusColor: Color.Red,\r\n\r\n    showZoom: false\r\n  };\r\n}\r\n\r\n/**\r\n * Implementation of a frame's stats. Meant to have values copied via [[FrameStats.reset]], avoid\r\n * creating instances of this every frame.\r\n */\r\nexport class FrameStats implements FrameStatistics {\r\n  private _id: number = 0;\r\n  private _delta: number = 0;\r\n  private _fps: number = 0;\r\n  private _actorStats: FrameActorStats = {\r\n    alive: 0,\r\n    killed: 0,\r\n    ui: 0,\r\n    get remaining() {\r\n      return this.alive - this.killed;\r\n    },\r\n    get total() {\r\n      return this.remaining + this.ui;\r\n    }\r\n  };\r\n  private _durationStats: FrameDurationStats = {\r\n    update: 0,\r\n    draw: 0,\r\n    get total() {\r\n      return this.update + this.draw;\r\n    }\r\n  };\r\n\r\n  private _physicsStats: PhysicsStats = new PhysicsStats();\r\n\r\n  private _graphicsStats: GraphicsStatistics = {\r\n    drawCalls: 0,\r\n    drawnImages: 0\r\n  };\r\n\r\n  /**\r\n   * Zero out values or clone other IFrameStat stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: FrameStatistics) {\r\n    if (otherStats) {\r\n      this.id = otherStats.id;\r\n      this.delta = otherStats.delta;\r\n      this.fps = otherStats.fps;\r\n      this.actors.alive = otherStats.actors.alive;\r\n      this.actors.killed = otherStats.actors.killed;\r\n      this.actors.ui = otherStats.actors.ui;\r\n      this.duration.update = otherStats.duration.update;\r\n      this.duration.draw = otherStats.duration.draw;\r\n      this._physicsStats.reset(otherStats.physics);\r\n      this.graphics.drawCalls = otherStats.graphics.drawCalls;\r\n      this.graphics.drawnImages = otherStats.graphics.drawnImages;\r\n    } else {\r\n      this.id = this.delta = this.fps = 0;\r\n      this.actors.alive = this.actors.killed = this.actors.ui = 0;\r\n      this.duration.update = this.duration.draw = 0;\r\n      this._physicsStats.reset();\r\n      this.graphics.drawnImages = this.graphics.drawCalls = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): FrameStats {\r\n    const fs = new FrameStats();\r\n\r\n    fs.reset(this);\r\n\r\n    return fs;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's id\r\n   */\r\n  public get id() {\r\n    return this._id;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's id\r\n   */\r\n  public set id(value: number) {\r\n    this._id = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's delta (time since last frame)\r\n   */\r\n  public get delta() {\r\n    return this._delta;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's delta (time since last frame). Internal use only.\r\n   * @internal\r\n   */\r\n  public set delta(value: number) {\r\n    this._delta = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's frames-per-second (FPS)\r\n   */\r\n  public get fps() {\r\n    return this._fps;\r\n  }\r\n\r\n  /**\r\n   * Sets the frame's frames-per-second (FPS). Internal use only.\r\n   * @internal\r\n   */\r\n  public set fps(value: number) {\r\n    this._fps = value;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's actor statistics\r\n   */\r\n  public get actors() {\r\n    return this._actorStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's duration statistics\r\n   */\r\n  public get duration() {\r\n    return this._durationStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's physics statistics\r\n   */\r\n  public get physics() {\r\n    return this._physicsStats;\r\n  }\r\n\r\n  /**\r\n   * Gets the frame's graphics statistics\r\n   */\r\n  public get graphics() {\r\n    return this._graphicsStats;\r\n  }\r\n}\r\n\r\nexport class PhysicsStats implements PhysicsStatistics {\r\n  private _pairs: number = 0;\r\n  private _collisions: number = 0;\r\n  private _contacts: Map<string, CollisionContact> = new Map();\r\n  private _fastBodies: number = 0;\r\n  private _fastBodyCollisions: number = 0;\r\n  private _broadphase: number = 0;\r\n  private _narrowphase: number = 0;\r\n\r\n  /**\r\n   * Zero out values or clone other IPhysicsStats stats. Allows instance reuse.\r\n   *\r\n   * @param [otherStats] Optional stats to clone\r\n   */\r\n  public reset(otherStats?: PhysicsStatistics) {\r\n    if (otherStats) {\r\n      this.pairs = otherStats.pairs;\r\n      this.collisions = otherStats.collisions;\r\n      this.contacts = otherStats.contacts;\r\n      this.fastBodies = otherStats.fastBodies;\r\n      this.fastBodyCollisions = otherStats.fastBodyCollisions;\r\n      this.broadphase = otherStats.broadphase;\r\n      this.narrowphase = otherStats.narrowphase;\r\n    } else {\r\n      this.pairs = this.collisions = this.fastBodies = 0;\r\n      this.fastBodyCollisions = this.broadphase = this.narrowphase = 0;\r\n      this.contacts.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Provides a clone of this instance.\r\n   */\r\n  public clone(): PhysicsStatistics {\r\n    const ps = new PhysicsStats();\r\n\r\n    ps.reset(this);\r\n\r\n    return ps;\r\n  }\r\n\r\n  public get pairs(): number {\r\n    return this._pairs;\r\n  }\r\n\r\n  public set pairs(value: number) {\r\n    this._pairs = value;\r\n  }\r\n\r\n  public get collisions(): number {\r\n    return this._collisions;\r\n  }\r\n\r\n  public set collisions(value: number) {\r\n    this._collisions = value;\r\n  }\r\n\r\n  public get contacts(): Map<string, CollisionContact> {\r\n    return this._contacts;\r\n  }\r\n\r\n  public set contacts(contacts: Map<string, CollisionContact>) {\r\n    this._contacts = contacts;\r\n  }\r\n\r\n  public get fastBodies(): number {\r\n    return this._fastBodies;\r\n  }\r\n\r\n  public set fastBodies(value: number) {\r\n    this._fastBodies = value;\r\n  }\r\n\r\n  public get fastBodyCollisions(): number {\r\n    return this._fastBodyCollisions;\r\n  }\r\n\r\n  public set fastBodyCollisions(value: number) {\r\n    this._fastBodyCollisions = value;\r\n  }\r\n\r\n  public get broadphase(): number {\r\n    return this._broadphase;\r\n  }\r\n\r\n  public set broadphase(value: number) {\r\n    this._broadphase = value;\r\n  }\r\n\r\n  public get narrowphase(): number {\r\n    return this._narrowphase;\r\n  }\r\n\r\n  public set narrowphase(value: number) {\r\n    this._narrowphase = value;\r\n  }\r\n}\r\n","import { Engine } from '../Engine';\nimport { Vector } from './vector';\n\nexport class GlobalCoordinates {\n  public static fromPagePosition(x: number, y: number, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(pos: Vector, engine: Engine): GlobalCoordinates;\n  public static fromPagePosition(xOrPos: number | Vector, yOrEngine: number | Engine, engineOrUndefined?: Engine): GlobalCoordinates {\n    let pageX: number;\n    let pageY: number;\n    let pagePos: Vector;\n    let engine: Engine;\n\n    if (arguments.length === 3) {\n      pageX = <number>xOrPos;\n      pageY = <number>yOrEngine;\n      pagePos = new Vector(pageX, pageY);\n      engine = engineOrUndefined;\n    } else {\n      pagePos = <Vector>xOrPos;\n      pageX = pagePos.x;\n      pageY = pagePos.y;\n      engine = <Engine>yOrEngine;\n    }\n\n    const screenPos = engine.screen.pageToScreenCoordinates(pagePos);\n    const worldPos = engine.screen.screenToWorldCoordinates(screenPos);\n\n    return new GlobalCoordinates(worldPos, pagePos, screenPos);\n  }\n\n  constructor(public worldPos: Vector, public pagePos: Vector, public screenPos: Vector) {}\n}\n","import { Class } from '../Class';\r\nimport { Engine, ScrollPreventionMode } from '../Engine';\r\nimport { Pointer, PointerType } from './Pointer';\r\nimport {\r\n  PointerEvent,\r\n  WheelEvent,\r\n  NativePointerButton,\r\n  PointerButton,\r\n  WheelDeltaMode,\r\n  createPointerEventByName,\r\n  PointerLeaveEvent,\r\n  PointerEnterEvent\r\n} from './PointerEvents';\r\nimport { GameEvent } from '../Events';\r\n\r\nimport * as Events from '../Events';\r\nimport * as Util from '../Util/Util';\r\nimport { vec } from '../Math/vector';\r\nimport { GlobalCoordinates } from '../Math/global-coordinates';\r\nimport { Vector } from '../Math/vector';\r\nimport { CapturePointer } from '../Traits/CapturePointer';\r\nimport { Actor } from '../Actor';\r\n\r\nexport type DOMPointerEvent = globalThis.PointerEvent;\r\nexport type DOMWheelEvent = globalThis.WheelEvent;\r\n\r\ninterface TouchEvent extends Event {\r\n  altKey: boolean;\r\n  changedTouches: Touch[];\r\n  ctrlKey: boolean;\r\n  metaKey: boolean;\r\n  shiftKey: boolean;\r\n  targetTouches: Touch[];\r\n  touches: Touch[];\r\n  type: string;\r\n  target: Element;\r\n}\r\n\r\ninterface Touch {\r\n  identifier: number;\r\n  screenX: number;\r\n  screenY: number;\r\n  clientX: number;\r\n  clientY: number;\r\n  pageX: number;\r\n  pageY: number;\r\n  radiusX: number;\r\n  radiusY: number;\r\n  rotationAngle: number;\r\n  force: number;\r\n  target: Element;\r\n}\r\n\r\n/**\r\n * A constant used to normalize wheel events across different browsers\r\n *\r\n * This normalization factor is pulled from https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Listening_to_this_event_across_browser\r\n */\r\nconst ScrollWheelNormalizationFactor = -1 / 40;\r\n\r\n/**\r\n * Handles pointer events (mouse, touch, stylus, etc.) and normalizes to\r\n * [W3C Pointer Events](http://www.w3.org/TR/pointerevents/).\r\n */\r\nexport class Pointers extends Class {\r\n  private _engine: Engine;\r\n\r\n  private _pointerDown: PointerEvent[] = [];\r\n  private _pointerUp: PointerEvent[] = [];\r\n  private _pointerMove: PointerEvent[] = [];\r\n  private _pointerCancel: PointerEvent[] = [];\r\n  private _wheel: WheelEvent[] = [];\r\n  private _pointers: Pointer[] = [];\r\n  private _activePointers: number[] = [];\r\n\r\n  constructor(engine: Engine) {\r\n    super();\r\n\r\n    this._engine = engine;\r\n    this._pointers.push(new Pointer());\r\n    this._activePointers = [-1];\r\n    this.primary = this._pointers[0];\r\n  }\r\n\r\n  public on(eventName: Events.up, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.down, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.move, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.enter, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.leave, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.cancel, handler: (event: PointerEvent) => void): void;\r\n  public on(eventName: Events.wheel, handler: (event: WheelEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Primary pointer (mouse, 1 finger, stylus, etc.)\r\n   */\r\n  public primary: Pointer;\r\n\r\n  /**\r\n   * Initializes pointer event listeners\r\n   */\r\n  public init(target?: GlobalEventHandlers): void {\r\n    target = target || this._engine.canvas;\r\n\r\n    // Touch Events\r\n    target.addEventListener('touchstart', this._handleTouchEvent('down', this._pointerDown));\r\n    target.addEventListener('touchend', this._handleTouchEvent('up', this._pointerUp));\r\n    target.addEventListener('touchmove', this._handleTouchEvent('move', this._pointerMove));\r\n    target.addEventListener('touchcancel', this._handleTouchEvent('cancel', this._pointerCancel));\r\n\r\n    // W3C Pointer Events\r\n    // Current: IE11, IE10\r\n    if ((<any>window).PointerEvent) {\r\n      // IE11\r\n      this._engine.canvas.style.touchAction = 'none';\r\n      target.addEventListener('pointerdown', this._handlePointerEvent('down', this._pointerDown));\r\n      target.addEventListener('pointerup', this._handlePointerEvent('up', this._pointerUp));\r\n      target.addEventListener('pointermove', this._handlePointerEvent('move', this._pointerMove));\r\n      target.addEventListener('pointercancel', this._handlePointerEvent('cancel', this._pointerCancel));\r\n    } else if ((<any>window).MSPointerEvent) {\r\n      // IE10\r\n      (this._engine.canvas.style as any).msTouchAction = 'none';\r\n      target.addEventListener('MSPointerDown', this._handlePointerEvent('down', this._pointerDown));\r\n      target.addEventListener('MSPointerUp', this._handlePointerEvent('up', this._pointerUp));\r\n      target.addEventListener('MSPointerMove', this._handlePointerEvent('move', this._pointerMove));\r\n      target.addEventListener('MSPointerCancel', this._handlePointerEvent('cancel', this._pointerCancel));\r\n    } else {\r\n      // Mouse Events\r\n      target.addEventListener('mousedown', this._handleMouseEvent('down', this._pointerDown));\r\n      target.addEventListener('mouseup', this._handleMouseEvent('up', this._pointerUp));\r\n      target.addEventListener('mousemove', this._handleMouseEvent('move', this._pointerMove));\r\n    }\r\n\r\n    // MDN MouseWheelEvent\r\n    const wheelOptions = {\r\n      passive: !(\r\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas\r\n      )\r\n    };\r\n    if ('onwheel' in document.createElement('div')) {\r\n      // Modern Browsers\r\n      target.addEventListener('wheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\r\n    } else if (document.onmousewheel !== undefined) {\r\n      // Webkit and IE\r\n      target.addEventListener('mousewheel', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\r\n    } else {\r\n      // Remaining browser and older Firefox\r\n      target.addEventListener('MozMousePixelScroll', this._handleWheelEvent('wheel', this._wheel), wheelOptions);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Synthesize a pointer event that looks like a real browser event to excalibur\r\n   * @param eventName\r\n   * @param pos\r\n   */\r\n  public triggerEvent(\r\n    eventName: 'up' | 'down' | 'move' | 'cancel' | 'wheel',\r\n    pos: Vector | GlobalCoordinates,\r\n    button: NativePointerButton = NativePointerButton.Left,\r\n    pointerType: 'mouse' | 'touch' | 'pen' = 'mouse',\r\n    pointerId: number = 0\r\n  ): void {\r\n    let x = 0;\r\n    let y = 0;\r\n    let coords: GlobalCoordinates;\r\n    if (pos instanceof GlobalCoordinates) {\r\n      x = pos.pagePos.x;\r\n      y = pos.pagePos.y;\r\n      coords = pos;\r\n    } else {\r\n      x = pos.x;\r\n      y = pos.y;\r\n      coords = new GlobalCoordinates(pos.clone(), pos.clone(), pos.clone());\r\n    }\r\n\r\n    const eventish = {\r\n      pageX: x,\r\n      pageY: y,\r\n      pointerId: pointerId,\r\n      pointerType: pointerType,\r\n      button: button,\r\n      preventDefault: () => {\r\n        /* do nothing */\r\n      }\r\n    };\r\n\r\n    switch (eventName) {\r\n      case 'move':\r\n        this._handlePointerEvent(eventName, this._pointerMove, coords)(eventish as DOMPointerEvent);\r\n        break;\r\n      case 'down':\r\n        this._handlePointerEvent(eventName, this._pointerDown, coords)(eventish as DOMPointerEvent);\r\n        break;\r\n      case 'up':\r\n        this._handlePointerEvent(eventName, this._pointerUp, coords)(eventish as DOMPointerEvent);\r\n        break;\r\n      case 'cancel':\r\n        this._handlePointerEvent(eventName, this._pointerCancel, coords)(eventish as DOMPointerEvent);\r\n        break;\r\n    }\r\n    for (const actor of this._engine.currentScene.actors) {\r\n      const capturePointer = actor.traits.filter((t) => t instanceof CapturePointer)[0];\r\n      if (capturePointer) {\r\n        capturePointer.update(actor, this._engine, 1);\r\n      }\r\n    }\r\n    this.dispatchPointerEvents();\r\n    this.update();\r\n  }\r\n\r\n  /**\r\n   * Update all pointer events and pointers, meant to be called at the end of frame\r\n   */\r\n  public update(): void {\r\n    this._pointerUp.length = 0;\r\n    this._pointerDown.length = 0;\r\n    this._pointerMove.length = 0;\r\n    this._pointerCancel.length = 0;\r\n    this._wheel.length = 0;\r\n\r\n    for (let i = 0; i < this._pointers.length; i++) {\r\n      this._pointers[i].update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely gets a Pointer at a specific index and initializes one if it doesn't yet exist\r\n   * @param index  The pointer index to retrieve\r\n   */\r\n  public at(index: number): Pointer {\r\n    if (index >= this._pointers.length) {\r\n      // Ensure there is a pointer to retrieve\r\n      for (let i = this._pointers.length - 1, max = index; i < max; i++) {\r\n        this._pointers.push(new Pointer());\r\n        this._activePointers.push(-1);\r\n      }\r\n    }\r\n\r\n    return this._pointers[index];\r\n  }\r\n\r\n  /**\r\n   * Get number of pointers being watched\r\n   */\r\n  public count(): number {\r\n    return this._pointers.length;\r\n  }\r\n\r\n  public checkAndUpdateActorUnderPointer(actor: Actor) {\r\n    for (const pointer of this._pointers) {\r\n      if (pointer.checkActorUnderPointer(actor)) {\r\n        pointer.addActorUnderPointer(actor);\r\n      } else {\r\n        pointer.removeActorUnderPointer(actor);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _dispatchWithBubble(events: PointerEvent[]) {\r\n    for (const evt of events) {\r\n      for (const actor of evt.pointer.getActorsForEvents()) {\r\n        if (!evt.isCanceled()) {\r\n          evt.propagate(actor);\r\n        }\r\n        if (!evt.bubbles || evt.isCanceled()) {\r\n          // if the event stops bubbling part way stop processing\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _dispatchPointerLeaveEvents() {\r\n    const lastMoveEventPerPointerPerActor: { [pointerId: string]: PointerEvent } = {};\r\n    const pointerLeave: PointerLeaveEvent[] = [];\r\n\r\n    for (const evt of this._pointerMove) {\r\n      for (const actor of evt.pointer.getActorsForEvents()) {\r\n        // If the actor was under the pointer last frame, but not this this frame, pointer left\r\n        if (\r\n          !lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] &&\r\n          evt.pointer.wasActorUnderPointer(actor) &&\r\n          !evt.pointer.isActorAliveUnderPointer(actor) &&\r\n          !evt.isCanceled()\r\n        ) {\r\n          lastMoveEventPerPointerPerActor[evt.pointer.id + '+' + actor.id] = evt;\r\n          const pe = createPointerEventByName(\r\n            'leave',\r\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\r\n            evt.pointer,\r\n            evt.index,\r\n            evt.pointerType,\r\n            evt.button,\r\n            evt.ev\r\n          );\r\n\r\n          pe.propagate(actor);\r\n          pointerLeave.push(<PointerLeaveEvent>pe);\r\n        }\r\n      }\r\n    }\r\n    return pointerLeave;\r\n  }\r\n\r\n  private _dispatchPointerEnterEvents() {\r\n    const lastMoveEventPerPointer: { [pointerId: number]: PointerEvent } = {};\r\n    const pointerEnter: PointerEnterEvent[] = [];\r\n\r\n    for (const evt of this._pointerMove) {\r\n      for (const actor of evt.pointer.getActorsForEvents()) {\r\n        // If the actor was not under the pointer last frame, but it is this frame, pointer entered\r\n        if (\r\n          !lastMoveEventPerPointer[evt.pointer.id] &&\r\n          !evt.pointer.wasActorUnderPointer(actor) &&\r\n          evt.pointer.isActorAliveUnderPointer(actor) &&\r\n          !evt.isCanceled()\r\n        ) {\r\n          lastMoveEventPerPointer[evt.pointer.id] = evt;\r\n          const pe = createPointerEventByName(\r\n            'enter',\r\n            new GlobalCoordinates(evt.worldPos, evt.pagePos, evt.screenPos),\r\n            evt.pointer,\r\n            evt.index,\r\n            evt.pointerType,\r\n            evt.button,\r\n            evt.ev\r\n          );\r\n          pe.propagate(actor);\r\n          pointerEnter.push(<PointerEnterEvent>pe);\r\n          // if pointer is dragging set the drag target\r\n          if (evt.pointer.isDragging) {\r\n            evt.pointer.dragTarget = actor;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return pointerEnter;\r\n  }\r\n\r\n  public dispatchPointerEvents() {\r\n    this._dispatchWithBubble(this._pointerDown);\r\n    this._dispatchWithBubble(this._pointerUp);\r\n    this._dispatchWithBubble(this._pointerMove);\r\n    this._dispatchPointerLeaveEvents();\r\n    this._dispatchPointerEnterEvents();\r\n    this._dispatchWithBubble(this._pointerCancel);\r\n\r\n    // TODO some duplication here\r\n    for (const evt of this._wheel) {\r\n      for (const actor of this._pointers[evt.index].getActorsUnderPointer()) {\r\n        this._propagateWheelPointerEvent(actor, evt);\r\n        if (!evt.bubbles || evt.isCanceled()) {\r\n          // if the event stops bubbling part way stop processing\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private _propagateWheelPointerEvent(actor: Actor, wheelEvent: WheelEvent) {\r\n    actor.emit('pointerwheel', wheelEvent);\r\n\r\n    // Recurse and propagate\r\n    if (wheelEvent.bubbles && !wheelEvent.isCanceled() && actor.parent) {\r\n      this._propagateWheelPointerEvent(actor.parent as Actor, wheelEvent); // TODO not true\r\n    }\r\n  }\r\n\r\n  private _handleMouseEvent(eventName: string, eventArr: PointerEvent[]) {\r\n    return (e: MouseEvent) => {\r\n      e.preventDefault();\r\n\r\n      const pointer = this.at(0);\r\n      const coordinates = GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\r\n      const pe = createPointerEventByName(\r\n        eventName,\r\n        coordinates,\r\n        pointer,\r\n        0,\r\n        PointerType.Mouse,\r\n        this._nativeButtonToPointerButton(e.button),\r\n        e\r\n      );\r\n\r\n      eventArr.push(pe);\r\n      pointer.eventDispatcher.emit(eventName, pe);\r\n    };\r\n  }\r\n\r\n  private _handleTouchEvent(eventName: string, eventArr: PointerEvent[]) {\r\n    return (e: TouchEvent) => {\r\n      e.preventDefault();\r\n      for (let i = 0, len = e.changedTouches.length; i < len; i++) {\r\n        const index = this._pointers.length > 1 ? this._getPointerIndex(e.changedTouches[i].identifier) : 0;\r\n        if (index === -1) {\r\n          continue;\r\n        }\r\n\r\n        const pointer = this.at(index);\r\n        const coordinates = GlobalCoordinates.fromPagePosition(e.changedTouches[i].pageX, e.changedTouches[i].pageY, this._engine);\r\n        const pe = createPointerEventByName(eventName, coordinates, pointer, index, PointerType.Touch, PointerButton.Unknown, e);\r\n\r\n        eventArr.push(pe);\r\n        pointer.eventDispatcher.emit(eventName, pe);\r\n        this.emit(eventName, pe);\r\n        // only with multi-pointer\r\n        if (this._pointers.length > 1) {\r\n          if (eventName === 'up') {\r\n            // remove pointer ID from pool when pointer is lifted\r\n            this._activePointers[index] = -1;\r\n          } else if (eventName === 'down') {\r\n            // set pointer ID to given index\r\n            this._activePointers[index] = e.changedTouches[i].identifier;\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private _handlePointerEvent(eventName: string, eventArr: PointerEvent[], coords?: GlobalCoordinates) {\r\n    return (e: DOMPointerEvent) => {\r\n      e.preventDefault();\r\n\r\n      // get the index for this pointer ID if multi-pointer is asked for\r\n      const index = this._pointers.length > 1 ? this._getPointerIndex(e.pointerId) : 0;\r\n      if (index === -1) {\r\n        return;\r\n      }\r\n\r\n      const pointer = this.at(index);\r\n      const coordinates = coords || GlobalCoordinates.fromPagePosition(e.pageX, e.pageY, this._engine);\r\n      const pe = createPointerEventByName(\r\n        eventName,\r\n        coordinates,\r\n        pointer,\r\n        index,\r\n        this._stringToPointerType(e.pointerType),\r\n        this._nativeButtonToPointerButton(e.button),\r\n        e\r\n      );\r\n\r\n      eventArr.push(pe);\r\n      pointer.eventDispatcher.emit(eventName, pe);\r\n      this.emit(eventName, pe);\r\n\r\n      // only with multi-pointer\r\n      if (this._pointers.length > 1) {\r\n        if (eventName === 'up') {\r\n          // remove pointer ID from pool when pointer is lifted\r\n          this._activePointers[index] = -1;\r\n        } else if (eventName === 'down') {\r\n          // set pointer ID to given index\r\n          this._activePointers[index] = e.pointerId;\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private _handleWheelEvent(eventName: string, eventArr: WheelEvent[]) {\r\n    return (e: DOMWheelEvent) => {\r\n      // Should we prevent page scroll because of this event\r\n      if (\r\n        this._engine.pageScrollPreventionMode === ScrollPreventionMode.All ||\r\n        (this._engine.pageScrollPreventionMode === ScrollPreventionMode.Canvas && e.target === this._engine.canvas)\r\n      ) {\r\n        e.preventDefault();\r\n      }\r\n      const screen = this._engine.screen.pageToScreenCoordinates(vec(e.pageX, e.pageY));\r\n      const world = this._engine.screen.screenToWorldCoordinates(screen);\r\n\r\n      // deltaX, deltaY, and deltaZ are the standard modern properties\r\n      // wheelDeltaX, wheelDeltaY, are legacy properties in webkit browsers and older IE\r\n      // e.detail is only used in opera\r\n\r\n      const deltaX = e.deltaX || e.wheelDeltaX * ScrollWheelNormalizationFactor || 0;\r\n      const deltaY =\r\n        e.deltaY || e.wheelDeltaY * ScrollWheelNormalizationFactor || e.wheelDelta * ScrollWheelNormalizationFactor || e.detail || 0;\r\n      const deltaZ = e.deltaZ || 0;\r\n      let deltaMode = WheelDeltaMode.Pixel;\r\n\r\n      if (e.deltaMode) {\r\n        if (e.deltaMode === 1) {\r\n          deltaMode = WheelDeltaMode.Line;\r\n        } else if (e.deltaMode === 2) {\r\n          deltaMode = WheelDeltaMode.Page;\r\n        }\r\n      }\r\n\r\n      const we = new WheelEvent(world.x, world.y, e.pageX, e.pageY, screen.x, screen.y, 0, deltaX, deltaY, deltaZ, deltaMode, e);\r\n\r\n      eventArr.push(we);\r\n      this.at(0).eventDispatcher.emit(eventName, we);\r\n      this.emit(eventName, we);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Gets the index of the pointer specified for the given pointer ID or finds the next empty pointer slot available.\r\n   * This is required because IE10/11 uses incrementing pointer IDs so we need to store a mapping of ID => idx\r\n   */\r\n  private _getPointerIndex(pointerId: number) {\r\n    let idx;\r\n    if ((idx = this._activePointers.indexOf(pointerId)) > -1) {\r\n      return idx;\r\n    }\r\n\r\n    for (let i = 0; i < this._activePointers.length; i++) {\r\n      if (this._activePointers[i] === -1) {\r\n        return i;\r\n      }\r\n    }\r\n\r\n    // ignore pointer because game isn't watching\r\n    return -1;\r\n  }\r\n\r\n  private _nativeButtonToPointerButton(s: NativePointerButton): PointerButton {\r\n    switch (s) {\r\n      case NativePointerButton.NoButton:\r\n        return PointerButton.NoButton;\r\n      case NativePointerButton.Left:\r\n        return PointerButton.Left;\r\n      case NativePointerButton.Middle:\r\n        return PointerButton.Middle;\r\n      case NativePointerButton.Right:\r\n        return PointerButton.Right;\r\n      case NativePointerButton.Unknown:\r\n        return PointerButton.Unknown;\r\n      default:\r\n        return Util.fail(s);\r\n    }\r\n  }\r\n\r\n  private _stringToPointerType(s: string) {\r\n    switch (s) {\r\n      case 'touch':\r\n        return PointerType.Touch;\r\n      case 'mouse':\r\n        return PointerType.Mouse;\r\n      case 'pen':\r\n        return PointerType.Pen;\r\n      default:\r\n        return PointerType.Unknown;\r\n    }\r\n  }\r\n}\r\n","import { Class } from './../Class';\r\nimport { GameEvent, GamepadConnectEvent, GamepadDisconnectEvent, GamepadButtonEvent, GamepadAxisEvent } from '../Events';\r\nimport * as Events from '../Events';\r\n\r\n/**\r\n * Excalibur leverages the HTML5 Gamepad API [where it is supported](http://caniuse.com/#feat=gamepad)\r\n * to provide controller support for your games.\r\n */\r\nexport class Gamepads extends Class {\r\n  /**\r\n   * Whether or not to poll for Gamepad input (default: `false`)\r\n   */\r\n  public enabled = false;\r\n\r\n  /**\r\n   * Whether or not Gamepad API is supported\r\n   */\r\n  public supported = !!(<any>navigator).getGamepads;\r\n\r\n  /**\r\n   * The minimum value an axis has to move before considering it a change\r\n   */\r\n  public static MinAxisMoveThreshold = 0.05;\r\n\r\n  private _gamePadTimeStamps = [0, 0, 0, 0];\r\n  private _oldPads: Gamepad[] = [];\r\n  private _pads: Gamepad[] = [];\r\n  private _initSuccess: boolean = false;\r\n  private _navigator: NavigatorGamepads = <any>navigator;\r\n  private _minimumConfiguration: GamepadConfiguration = null;\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  public init() {\r\n    if (!this.supported) {\r\n      return;\r\n    }\r\n    if (this._initSuccess) {\r\n      return;\r\n    }\r\n\r\n    // In Chrome, this will return 4 undefined items until a button is pressed\r\n    // In FF, this will not return any items until a button is pressed\r\n    this._oldPads = this._clonePads(this._navigator.getGamepads());\r\n    if (this._oldPads.length && this._oldPads[0]) {\r\n      this._initSuccess = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum gamepad configuration, for example {axis: 4, buttons: 4} means\r\n   * this game requires at minimum 4 axis inputs and 4 buttons, this is not restrictive\r\n   * all other controllers with more axis or buttons are valid as well. If no minimum\r\n   * configuration is set all pads are valid.\r\n   */\r\n  public setMinimumGamepadConfiguration(config: GamepadConfiguration): void {\r\n    this._enableAndUpdate(); // if config is used, implicitly enable\r\n    this._minimumConfiguration = config;\r\n  }\r\n\r\n  /**\r\n   * When implicitly enabled, set the enabled flag and run an update so information is updated\r\n   */\r\n  private _enableAndUpdate() {\r\n    if (!this.enabled) {\r\n      this.enabled = true;\r\n      this.update();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks a navigator gamepad against the minimum configuration if present.\r\n   */\r\n  private _isGamepadValid(pad: NavigatorGamepad): boolean {\r\n    if (!this._minimumConfiguration) {\r\n      return true;\r\n    }\r\n    if (!pad) {\r\n      return false;\r\n    }\r\n    const axesLength = pad.axes.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n\r\n    const buttonLength = pad.buttons.filter((value) => {\r\n      return typeof value !== undefined;\r\n    }).length;\r\n    return axesLength >= this._minimumConfiguration.axis && buttonLength >= this._minimumConfiguration.buttons && pad.connected;\r\n  }\r\n\r\n  public on(eventName: Events.connect, handler: (event: GamepadConnectEvent) => void): void;\r\n  public on(eventName: Events.disconnect, handler: (event: GamepadDisconnectEvent) => void): void;\r\n  public on(eventName: Events.button, handler: (event: GamepadButtonEvent) => void): void;\r\n  public on(eventName: Events.axis, handler: (event: GamepadAxisEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void) {\r\n    this._enableAndUpdate(); // implicitly enable\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Updates Gamepad state and publishes Gamepad events\r\n   */\r\n  public update() {\r\n    if (!this.enabled || !this.supported) {\r\n      return;\r\n    }\r\n    this.init();\r\n\r\n    const gamepads = this._navigator.getGamepads();\r\n\r\n    for (let i = 0; i < gamepads.length; i++) {\r\n      if (!gamepads[i]) {\r\n        const gamepad = this.at(i);\r\n        // If was connected, but now isn't emit the disconnect event\r\n        if (gamepad.connected) {\r\n          this.eventDispatcher.emit('disconnect', new GamepadDisconnectEvent(i, gamepad));\r\n        }\r\n        // Reset connection status\r\n        gamepad.connected = false;\r\n        continue;\r\n      } else {\r\n        if (!this.at(i).connected && this._isGamepadValid(gamepads[i])) {\r\n          this.eventDispatcher.emit('connect', new GamepadConnectEvent(i, this.at(i)));\r\n        }\r\n        // Set connection status\r\n        this.at(i).connected = true;\r\n      }\r\n\r\n      // Only supported in Chrome\r\n      if (gamepads[i].timestamp && gamepads[i].timestamp === this._gamePadTimeStamps[i]) {\r\n        continue;\r\n      }\r\n\r\n      this._gamePadTimeStamps[i] = gamepads[i].timestamp;\r\n\r\n      // Add reference to navigator gamepad\r\n      this.at(i).navigatorGamepad = gamepads[i];\r\n\r\n      // Buttons\r\n      let b: string, bi: number, a: string, ai: number, value: number;\r\n\r\n      for (b in Buttons) {\r\n        bi = <any>Buttons[b];\r\n        if (typeof bi === 'number') {\r\n          if (gamepads[i].buttons[bi]) {\r\n            value = gamepads[i].buttons[bi].value;\r\n            if (value !== this._oldPads[i].getButton(bi)) {\r\n              if (gamepads[i].buttons[bi].pressed) {\r\n                this.at(i).updateButton(bi, value);\r\n                this.at(i).eventDispatcher.emit('button', new GamepadButtonEvent(bi, value, this.at(i)));\r\n              } else {\r\n                this.at(i).updateButton(bi, 0);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Axes\r\n      for (a in Axes) {\r\n        ai = <any>Axes[a];\r\n        if (typeof ai === 'number') {\r\n          value = gamepads[i].axes[ai];\r\n          if (value !== this._oldPads[i].getAxes(ai)) {\r\n            this.at(i).updateAxes(ai, value);\r\n            this.at(i).eventDispatcher.emit('axis', new GamepadAxisEvent(ai, value, this.at(i)));\r\n          }\r\n        }\r\n      }\r\n\r\n      this._oldPads[i] = this._clonePad(gamepads[i]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Safely retrieves a Gamepad at a specific index and creates one if it doesn't yet exist\r\n   */\r\n  public at(index: number): Gamepad {\r\n    this._enableAndUpdate(); // implicitly enable gamepads when at() is called\r\n    if (index >= this._pads.length) {\r\n      // Ensure there is a pad to retrieve\r\n      for (let i = this._pads.length - 1, max = index; i < max; i++) {\r\n        this._pads.push(new Gamepad());\r\n        this._oldPads.push(new Gamepad());\r\n      }\r\n    }\r\n\r\n    return this._pads[index];\r\n  }\r\n\r\n  /**\r\n   * Returns a list of all valid gamepads that meet the minimum configuration requirement.\r\n   */\r\n  public getValidGamepads(): Gamepad[] {\r\n    this._enableAndUpdate();\r\n    const result: Gamepad[] = [];\r\n    for (let i = 0; i < this._pads.length; i++) {\r\n      if (this._isGamepadValid(this.at(i).navigatorGamepad) && this.at(i).connected) {\r\n        result.push(this.at(i));\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Gets the number of connected gamepads\r\n   */\r\n  public count() {\r\n    return this._pads.filter((p) => p.connected).length;\r\n  }\r\n\r\n  private _clonePads(pads: NavigatorGamepad[]): Gamepad[] {\r\n    const arr = [];\r\n    for (let i = 0, len = pads.length; i < len; i++) {\r\n      arr.push(this._clonePad(pads[i]));\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  /**\r\n   * Fastest way to clone a known object is to do it yourself\r\n   */\r\n  private _clonePad(pad: NavigatorGamepad): Gamepad {\r\n    let i, len;\r\n    const clonedPad = new Gamepad();\r\n\r\n    if (!pad) {\r\n      return clonedPad;\r\n    }\r\n\r\n    for (i = 0, len = pad.buttons.length; i < len; i++) {\r\n      if (pad.buttons[i]) {\r\n        clonedPad.updateButton(i, pad.buttons[i].value);\r\n      }\r\n    }\r\n    for (i = 0, len = pad.axes.length; i < len; i++) {\r\n      clonedPad.updateAxes(i, pad.axes[i]);\r\n    }\r\n\r\n    return clonedPad;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad holds state information for a connected controller. See [[Gamepads]]\r\n * for more information on handling controller input.\r\n */\r\nexport class Gamepad extends Class {\r\n  public connected = false;\r\n  public navigatorGamepad: NavigatorGamepad;\r\n  private _buttons: number[] = new Array(16);\r\n  private _axes: number[] = new Array(4);\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    for (let i = 0; i < this._buttons.length; i++) {\r\n      this._buttons[i] = 0;\r\n    }\r\n    for (let i = 0; i < this._axes.length; i++) {\r\n      this._axes[i] = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Whether or not the given button is pressed\r\n   * @param button     The button to query\r\n   * @param threshold  The threshold over which the button is considered to be pressed\r\n   */\r\n  public isButtonPressed(button: Buttons, threshold: number = 1) {\r\n    return this._buttons[button] >= threshold;\r\n  }\r\n\r\n  /**\r\n   * Gets the given button value between 0 and 1\r\n   */\r\n  public getButton(button: Buttons) {\r\n    return this._buttons[button];\r\n  }\r\n\r\n  /**\r\n   * Gets the given axis value between -1 and 1. Values below\r\n   * [[MinAxisMoveThreshold]] are considered 0.\r\n   */\r\n  public getAxes(axes: Axes) {\r\n    const value = this._axes[axes];\r\n\r\n    if (Math.abs(value) < Gamepads.MinAxisMoveThreshold) {\r\n      return 0;\r\n    } else {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  public updateButton(buttonIndex: number, value: number) {\r\n    this._buttons[buttonIndex] = value;\r\n  }\r\n\r\n  public updateAxes(axesIndex: number, value: number) {\r\n    this._axes[axesIndex] = value;\r\n  }\r\n}\r\n\r\n/**\r\n * Gamepad Buttons enumeration\r\n */\r\nexport enum Buttons {\r\n  /**\r\n   * Face 1 button (e.g. A)\r\n   */\r\n  Face1 = 0,\r\n  /**\r\n   * Face 2 button (e.g. B)\r\n   */\r\n  Face2 = 1,\r\n  /**\r\n   * Face 3 button (e.g. X)\r\n   */\r\n  Face3 = 2,\r\n  /**\r\n   * Face 4 button (e.g. Y)\r\n   */\r\n  Face4 = 3,\r\n  /**\r\n   * Left bumper button\r\n   */\r\n  LeftBumper = 4,\r\n  /**\r\n   * Right bumper button\r\n   */\r\n  RightBumper = 5,\r\n  /**\r\n   * Left trigger button\r\n   */\r\n  LeftTrigger = 6,\r\n  /**\r\n   * Right trigger button\r\n   */\r\n  RightTrigger = 7,\r\n  /**\r\n   * Select button\r\n   */\r\n  Select = 8,\r\n  /**\r\n   * Start button\r\n   */\r\n  Start = 9,\r\n  /**\r\n   * Left analog stick press (e.g. L3)\r\n   */\r\n  LeftStick = 10,\r\n  /**\r\n   * Right analog stick press (e.g. R3)\r\n   */\r\n  RightStick = 11,\r\n  /**\r\n   * D-pad up\r\n   */\r\n  DpadUp = 12,\r\n  /**\r\n   * D-pad down\r\n   */\r\n  DpadDown = 13,\r\n  /**\r\n   * D-pad left\r\n   */\r\n  DpadLeft = 14,\r\n  /**\r\n   * D-pad right\r\n   */\r\n  DpadRight = 15\r\n}\r\n\r\n/**\r\n * Gamepad Axes enumeration\r\n */\r\nexport enum Axes {\r\n  /**\r\n   * Left analogue stick X direction\r\n   */\r\n  LeftStickX = 0,\r\n  /**\r\n   * Left analogue stick Y direction\r\n   */\r\n  LeftStickY = 1,\r\n  /**\r\n   * Right analogue stick X direction\r\n   */\r\n  RightStickX = 2,\r\n  /**\r\n   * Right analogue stick Y direction\r\n   */\r\n  RightStickY = 3\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepads {\r\n  getGamepads(): NavigatorGamepad[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepad {\r\n  axes: number[];\r\n  buttons: NavigatorGamepadButton[];\r\n  connected: boolean;\r\n  id: string;\r\n  index: number;\r\n  mapping: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadButton {\r\n  pressed: boolean;\r\n  value: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface NavigatorGamepadEvent {\r\n  gamepad: NavigatorGamepad;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport interface GamepadConfiguration {\r\n  axis: number;\r\n  buttons: number;\r\n}\r\n","export interface NativeEventable {\r\n  addEventListener(name: string, handler: (...any: any[]) => any): any;\r\n  removeEventListener(name: string, handler: (...any: any[]) => any): any;\r\n}\r\n\r\nexport class BrowserComponent<T extends NativeEventable> {\r\n  private _paused = false;\r\n  private _nativeHandlers: { [key: string]: (handler: any) => void } = {};\r\n\r\n  on(eventName: string, handler: (evt: any) => void): void {\r\n    if (this._nativeHandlers[eventName]) {\r\n      this.off(eventName, this._nativeHandlers[eventName]);\r\n    }\r\n    this._nativeHandlers[eventName] = this._decorate(handler);\r\n    this.nativeComponent.addEventListener(eventName, this._nativeHandlers[eventName]);\r\n  }\r\n  off(eventName: string, handler?: (event: any) => void): void {\r\n    if (!handler) {\r\n      handler = this._nativeHandlers[eventName];\r\n    }\r\n    this.nativeComponent.removeEventListener(eventName, handler);\r\n    this._nativeHandlers[eventName] = null;\r\n  }\r\n\r\n  private _decorate(handler: (evt: any) => void): (evt: any) => void {\r\n    return (evt: any) => {\r\n      if (!this._paused) {\r\n        handler(evt);\r\n      }\r\n    };\r\n  }\r\n\r\n  public pause() {\r\n    this._paused = true;\r\n  }\r\n\r\n  public resume() {\r\n    this._paused = false;\r\n  }\r\n\r\n  public clear() {\r\n    for (const event in this._nativeHandlers) {\r\n      this.off(event);\r\n    }\r\n  }\r\n\r\n  constructor(public nativeComponent: T) {}\r\n}\r\n\r\nexport class BrowserEvents {\r\n  private _windowComponent: BrowserComponent<Window>;\r\n  private _documentComponent: BrowserComponent<Document>;\r\n  constructor(private _windowGlobal: Window, private _documentGlobal: Document) {\r\n    this._windowComponent = new BrowserComponent(this._windowGlobal);\r\n    this._documentComponent = new BrowserComponent(this._documentGlobal);\r\n  }\r\n\r\n  public get window(): BrowserComponent<Window> {\r\n    return this._windowComponent;\r\n  }\r\n\r\n  public get document(): BrowserComponent<Document> {\r\n    return this._documentComponent;\r\n  }\r\n\r\n  public pause() {\r\n    this.window.pause();\r\n    this.document.pause();\r\n  }\r\n\r\n  public resume() {\r\n    this.window.resume();\r\n    this.document.resume();\r\n  }\r\n\r\n  public clear() {\r\n    this.window.clear();\r\n    this.document.clear();\r\n  }\r\n}\r\n","import {\r\n  ExcaliburGraphicsContext,\r\n  LineGraphicsOptions,\r\n  PointGraphicsOptions,\r\n  ExcaliburGraphicsContextOptions,\r\n  DebugDraw,\r\n  HTMLImageSource\r\n} from './ExcaliburGraphicsContext';\r\nimport { Vector } from '../../Math/vector';\r\nimport { Color } from '../../Color';\r\nimport { StateStack } from './state-stack';\r\nimport { GraphicsDiagnostics } from '../GraphicsDiagnostics';\r\nimport { DebugText } from './debug-text';\r\n\r\nclass ExcaliburGraphicsContext2DCanvasDebug implements DebugDraw {\r\n  private _debugText = new DebugText();\r\n  constructor(private _ex: ExcaliburGraphicsContext2DCanvas) {}\r\n  /**\r\n   * Draw a debug rectangle to the context\r\n   * @param x\r\n   * @param y\r\n   * @param width\r\n   * @param height\r\n   */\r\n  drawRect(x: number, y: number, width: number, height: number): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.strokeStyle = 'red';\r\n    this._ex.__ctx.strokeRect(\r\n      this._ex.snapToPixel ? ~~x : x,\r\n      this._ex.snapToPixel ? ~~y : y,\r\n      this._ex.snapToPixel ? ~~width : width,\r\n      this._ex.snapToPixel ? ~~height : height\r\n    );\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawLine(start: Vector, end: Vector, lineOptions: LineGraphicsOptions = { color: Color.Black }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.strokeStyle = lineOptions.color.toString();\r\n    this._ex.__ctx.moveTo(this._ex.snapToPixel ? ~~start.x : start.x, this._ex.snapToPixel ? ~~start.y : start.y);\r\n    this._ex.__ctx.lineTo(this._ex.snapToPixel ? ~~end.x : end.x, this._ex.snapToPixel ? ~~end.y : end.y);\r\n    this._ex.__ctx.lineWidth = 2;\r\n    this._ex.__ctx.stroke();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawPoint(point: Vector, pointOptions: PointGraphicsOptions = { color: Color.Black, size: 5 }): void {\r\n    this._ex.__ctx.save();\r\n    this._ex.__ctx.beginPath();\r\n    this._ex.__ctx.fillStyle = pointOptions.color.toString();\r\n    this._ex.__ctx.arc(\r\n      this._ex.snapToPixel ? ~~point.x : point.x,\r\n      this._ex.snapToPixel ? ~~point.y : point.y,\r\n      pointOptions.size,\r\n      0,\r\n      Math.PI * 2\r\n    );\r\n    this._ex.__ctx.fill();\r\n    this._ex.__ctx.closePath();\r\n    this._ex.__ctx.restore();\r\n  }\r\n\r\n  drawText(text: string, pos: Vector) {\r\n    this._debugText.write(this._ex, text, pos);\r\n  }\r\n}\r\n\r\nexport class ExcaliburGraphicsContext2DCanvas implements ExcaliburGraphicsContext {\r\n  /**\r\n   * Meant for internal use only. Access the internal context at your own risk and no guarantees this will exist in the future.\r\n   * @internal\r\n   */\r\n  public __ctx: CanvasRenderingContext2D;\r\n  public get width() {\r\n    return this.__ctx.canvas.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.__ctx.canvas.height;\r\n  }\r\n\r\n  public backgroundColor: Color = Color.ExcaliburBlue;\r\n\r\n  private _state = new StateStack();\r\n\r\n  public get opacity(): number {\r\n    return this._state.current.opacity;\r\n  }\r\n\r\n  public set opacity(value: number) {\r\n    this._state.current.opacity = value;\r\n  }\r\n\r\n  public snapToPixel: boolean = true;\r\n\r\n  public get smoothing(): boolean {\r\n    return this.__ctx.imageSmoothingEnabled;\r\n  }\r\n\r\n  public set smoothing(value: boolean) {\r\n    this.__ctx.imageSmoothingEnabled = value;\r\n  }\r\n\r\n  constructor(options: ExcaliburGraphicsContextOptions) {\r\n    const { canvasElement, enableTransparency, snapToPixel, smoothing, backgroundColor } = options;\r\n    this.__ctx = canvasElement.getContext('2d', {\r\n      alpha: enableTransparency ?? true\r\n    });\r\n    this.backgroundColor = backgroundColor ?? this.backgroundColor;\r\n    this.snapToPixel = snapToPixel ?? this.snapToPixel;\r\n    this.smoothing = smoothing ?? this.smoothing;\r\n  }\r\n\r\n  public resetTransform(): void {\r\n    this.__ctx.resetTransform();\r\n  }\r\n\r\n  public updateViewport(): void {\r\n    // pass\r\n  }\r\n\r\n  /**\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate using the images width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context at an x and y coordinate with a specific width and height\r\n   */\r\n  drawImage(image: HTMLImageSource, x: number, y: number, width: number, height: number): void;\r\n  /**\r\n   *\r\n   * Draw an image to the Excalibur Graphics context specifying the source image coordinates (sx, sy, swidth, sheight)\r\n   * and to a specific destination on the context (dx, dy, dwidth, dheight)\r\n   */\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void;\r\n\r\n  drawImage(\r\n    image: HTMLImageSource,\r\n    sx: number,\r\n    sy: number,\r\n    swidth?: number,\r\n    sheight?: number,\r\n    dx?: number,\r\n    dy?: number,\r\n    dwidth?: number,\r\n    dheight?: number\r\n  ): void {\r\n    if (swidth === 0 || sheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (dwidth === 0 || dheight === 0) {\r\n      return; // zero dimension dest exit early\r\n    } else if (image.width === 0 || image.height === 0) {\r\n      return; // zero dimension source exit early\r\n    }\r\n\r\n    this.__ctx.globalAlpha = this.opacity;\r\n    const args = [image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight]\r\n      .filter((a) => a !== undefined)\r\n      .map((a) => (typeof a === 'number' && this.snapToPixel ? ~~a : a));\r\n    this.__ctx.drawImage.apply(this.__ctx, args);\r\n    GraphicsDiagnostics.DrawCallCount++;\r\n    GraphicsDiagnostics.DrawnImagesCount = 1;\r\n  }\r\n\r\n  public drawLine(start: Vector, end: Vector, color: Color, thickness = 1) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.strokeStyle = color.toString();\r\n    this.__ctx.moveTo(this.snapToPixel ? ~~start.x : start.x, this.snapToPixel ? ~~start.y : start.y);\r\n    this.__ctx.lineTo(this.snapToPixel ? ~~end.x : end.x, this.snapToPixel ? ~~end.y : end.y);\r\n    this.__ctx.lineWidth = thickness;\r\n    this.__ctx.stroke();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawRectangle(pos: Vector, width: number, height: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.fillRect(\r\n      this.snapToPixel ? ~~pos.x : pos.x,\r\n      this.snapToPixel ? ~~pos.y : pos.y,\r\n      this.snapToPixel ? ~~width : width,\r\n      this.snapToPixel ? ~~height : height\r\n    );\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  public drawCircle(pos: Vector, radius: number, color: Color) {\r\n    this.__ctx.save();\r\n    this.__ctx.beginPath();\r\n    this.__ctx.fillStyle = color.toString();\r\n    this.__ctx.arc(this.snapToPixel ? ~~pos.x : pos.x, this.snapToPixel ? ~~pos.y : pos.y, radius, 0, Math.PI * 2);\r\n    this.__ctx.fill();\r\n    this.__ctx.closePath();\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  debug = new ExcaliburGraphicsContext2DCanvasDebug(this);\r\n\r\n  /**\r\n   * Save the current state of the canvas to the stack (transforms and opacity)\r\n   */\r\n  save(): void {\r\n    this.__ctx.save();\r\n  }\r\n\r\n  /**\r\n   * Restore the state of the canvas from the stack\r\n   */\r\n  restore(): void {\r\n    this.__ctx.restore();\r\n  }\r\n\r\n  /**\r\n   * Translate the origin of the context by an x and y\r\n   * @param x\r\n   * @param y\r\n   */\r\n  translate(x: number, y: number): void {\r\n    this.__ctx.translate(this.snapToPixel ? ~~x : x, this.snapToPixel ? ~~y : y);\r\n  }\r\n\r\n  /**\r\n   * Rotate the context about the current origin\r\n   */\r\n  rotate(angle: number): void {\r\n    this.__ctx.rotate(angle);\r\n  }\r\n\r\n  /**\r\n   * Scale the context by an x and y factor\r\n   * @param x\r\n   * @param y\r\n   */\r\n  scale(x: number, y: number): void {\r\n    this.__ctx.scale(x, y);\r\n  }\r\n\r\n  clear(): void {\r\n    // Clear frame\r\n    this.__ctx.clearRect(0, 0, this.width, this.height);\r\n    this.__ctx.fillStyle = this.backgroundColor.toString();\r\n    this.__ctx.fillRect(0, 0, this.width, this.height);\r\n    GraphicsDiagnostics.clear();\r\n  }\r\n\r\n  /**\r\n   * Flushes the batched draw calls to the screen\r\n   */\r\n  flush(): void {\r\n    // pass\r\n  }\r\n}\r\n","import { EX_VERSION } from './';\r\nimport { Flags, Legacy } from './Flags';\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\nimport { CanUpdate, CanDraw, CanInitialize } from './Interfaces/LifecycleEvents';\r\nimport { Loadable } from './Interfaces/Loadable';\r\nimport { Vector } from './Math/vector';\r\nimport { Screen, DisplayMode, AbsolutePosition, ScreenDimension, Resolution } from './Screen';\r\nimport { ScreenElement } from './ScreenElement';\r\nimport { Actor } from './Actor';\r\nimport { Timer } from './Timer';\r\nimport { TileMap } from './TileMap';\r\nimport { Animation } from './Drawing/Animation';\r\nimport { Loader } from './Loader';\r\nimport { Detector } from './Util/Detector';\r\nimport {\r\n  VisibleEvent,\r\n  HiddenEvent,\r\n  GameStartEvent,\r\n  GameStopEvent,\r\n  PreUpdateEvent,\r\n  PostUpdateEvent,\r\n  PreFrameEvent,\r\n  PostFrameEvent,\r\n  GameEvent,\r\n  DeactivateEvent,\r\n  ActivateEvent,\r\n  PreDrawEvent,\r\n  PostDrawEvent,\r\n  InitializeEvent\r\n} from './Events';\r\nimport { Logger, LogLevel } from './Util/Log';\r\nimport { Color } from './Color';\r\nimport { Scene } from './Scene';\r\nimport { Entity } from './EntityComponentSystem/Entity';\r\nimport { PostProcessor } from './PostProcessing/PostProcessor';\r\nimport { Debug, DebugStats } from './Debug/Debug';\r\nimport { Class } from './Class';\r\nimport * as Input from './Input/Index';\r\nimport * as Events from './Events';\r\nimport { BrowserEvents } from './Util/Browser';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { ExcaliburGraphicsContext, ExcaliburGraphicsContext2DCanvas, ExcaliburGraphicsContextWebGL } from './Graphics';\r\n\r\n/**\r\n * Enum representing the different mousewheel event bubble prevention\r\n */\r\nexport enum ScrollPreventionMode {\r\n  /**\r\n   * Do not prevent any page scrolling\r\n   */\r\n  None,\r\n  /**\r\n   * Prevent page scroll if mouse is over the game canvas\r\n   */\r\n  Canvas,\r\n  /**\r\n   * Prevent all page scrolling via mouse wheel\r\n   */\r\n  All\r\n}\r\n\r\n/**\r\n * Defines the available options to configure the Excalibur engine at constructor time.\r\n */\r\nexport interface EngineOptions {\r\n  /**\r\n   * Optionally configure the width of the viewport in css pixels\r\n   */\r\n  width?: number;\r\n\r\n  /**\r\n   * Optionally configure the height of the viewport in css pixels\r\n   */\r\n  height?: number;\r\n\r\n  /**\r\n   * Optionally configure the width & height of the viewport in css pixels.\r\n   * Use `viewport` instead of [[EngineOptions.width]] and [[EngineOptions.height]], or vice versa.\r\n   */\r\n  viewport?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify the size the logical pixel resolution, if not specified it will be width x height.\r\n   * See [[Resolution]] for common presets.\r\n   */\r\n  resolution?: ScreenDimension;\r\n\r\n  /**\r\n   * Optionally specify antialiasing (smoothing), by default true (smooth pixels)\r\n   */\r\n  antialiasing?: boolean;\r\n\r\n  /**\r\n   * Optionally configure the native canvas transparent backdrop\r\n   */\r\n  enableCanvasTransparency?: boolean;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element to render the game in\r\n   */\r\n  canvasElementId?: string;\r\n\r\n  /**\r\n   * Optionally specify the target canvas DOM element directly\r\n   */\r\n  canvasElement?: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Optionally snap drawings to nearest pixel\r\n   */\r\n  snapToPixel?: boolean;\r\n\r\n  /**\r\n   * The [[DisplayMode]] of the game, by default [[DisplayMode.FitScreen]] with aspect ratio 4:3 (800x600).\r\n   * Depending on this value, [[width]] and [[height]] may be ignored.\r\n   */\r\n  displayMode?: DisplayMode;\r\n\r\n  /**\r\n   * Configures the pointer scope. Pointers scoped to the 'Canvas' can only fire events within the canvas viewport; whereas, 'Document'\r\n   * (default) scoped will fire anywhere on the page.\r\n   */\r\n  pointerScope?: Input.PointerScope;\r\n\r\n  /**\r\n   * Suppress boot up console message, which contains the \"powered by Excalibur message\"\r\n   */\r\n  suppressConsoleBootMessage?: boolean;\r\n\r\n  /**\r\n   * Suppress minimum browser feature detection, it is not recommended users of excalibur switch this off. This feature ensures that\r\n   * the currently running browser meets the minimum requirements for running excalibur. This can be useful if running on non-standard\r\n   * browsers or if there is a bug in excalibur preventing execution.\r\n   */\r\n  suppressMinimumBrowserFeatureDetection?: boolean;\r\n\r\n  /**\r\n   * Suppress HiDPI auto detection and scaling, it is not recommended users of excalibur switch off this feature. This feature detects\r\n   * and scales the drawing canvas appropriately to accommodate HiDPI screens.\r\n   */\r\n  suppressHiDPIScaling?: boolean;\r\n\r\n  /**\r\n   * Suppress play button, it is not recommended users of excalibur switch this feature. Some browsers require a user gesture (like a click)\r\n   * for certain browser features to work like web audio.\r\n   */\r\n  suppressPlayButton?: boolean;\r\n\r\n  /**\r\n   * Specify how the game window is to be positioned when the [[DisplayMode.Position]] is chosen. This option MUST be specified\r\n   * if the DisplayMode is set as [[DisplayMode.Position]]. The position can be either a string or an [[AbsolutePosition]].\r\n   * String must be in the format of css style background-position. The vertical position must precede the horizontal position in strings.\r\n   *\r\n   * Valid String examples: \"top left\", \"top\", \"bottom\", \"middle\", \"middle center\", \"bottom right\"\r\n   * Valid [[AbsolutePosition]] examples: `{top: 5, right: 10%}`, `{bottom: 49em, left: 10px}`, `{left: 10, bottom: 40}`\r\n   */\r\n  position?: string | AbsolutePosition;\r\n\r\n  /**\r\n   * Scroll prevention method.\r\n   */\r\n  scrollPreventionMode?: ScrollPreventionMode;\r\n\r\n  /**\r\n   * Optionally set the background color\r\n   */\r\n  backgroundColor?: Color;\r\n}\r\n\r\n/**\r\n * The Excalibur Engine\r\n *\r\n * The [[Engine]] is the main driver for a game. It is responsible for\r\n * starting/stopping the game, maintaining state, transmitting events,\r\n * loading resources, and managing the scene.\r\n */\r\nexport class Engine extends Class implements CanInitialize, CanUpdate, CanDraw {\r\n  /**\r\n   *\r\n   */\r\n  public browser: BrowserEvents;\r\n\r\n  /**\r\n   * Screen abstraction\r\n   */\r\n  public screen: Screen;\r\n\r\n  /**\r\n   * Direct access to the engine's canvas element\r\n   */\r\n  public canvas: HTMLCanvasElement;\r\n\r\n  /**\r\n   * Direct access to the engine's 2D rendering context\r\n   */\r\n  public ctx: CanvasRenderingContext2D;\r\n\r\n  public graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Direct access to the canvas element ID, if an ID exists\r\n   */\r\n  public canvasElementId: string;\r\n\r\n  /**\r\n   * The width of the game canvas in pixels (physical width component of the\r\n   * resolution of the canvas element)\r\n   */\r\n  public get canvasWidth(): number {\r\n    return this.screen.canvasWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half width of the game canvas in pixels (half physical width component)\r\n   */\r\n  public get halfCanvasWidth(): number {\r\n    return this.screen.halfCanvasWidth;\r\n  }\r\n\r\n  /**\r\n   * The height of the game canvas in pixels, (physical height component of\r\n   * the resolution of the canvas element)\r\n   */\r\n  public get canvasHeight(): number {\r\n    return this.screen.canvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half height of the game canvas in pixels (half physical height component)\r\n   */\r\n  public get halfCanvasHeight(): number {\r\n    return this.screen.halfCanvasHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawWidth(): number {\r\n    return this.screen.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns half the width of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawWidth(): number {\r\n    return this.screen.halfDrawWidth;\r\n  }\r\n\r\n  /**\r\n   * Returns the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get drawHeight(): number {\r\n    return this.screen.drawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns half the height of the engine's visible drawing surface in pixels including zoom and device pixel ratio.\r\n   */\r\n  public get halfDrawHeight(): number {\r\n    return this.screen.halfDrawHeight;\r\n  }\r\n\r\n  /**\r\n   * Returns whether excalibur detects the current screen to be HiDPI\r\n   */\r\n  public get isHiDpi(): boolean {\r\n    return this.screen.isHiDpi;\r\n  }\r\n\r\n  /**\r\n   * Access engine input like pointer, keyboard, or gamepad\r\n   */\r\n  public input: Input.EngineInput;\r\n\r\n  private _hasStarted: boolean = false;\r\n\r\n  /**\r\n   * Access Excalibur debugging functionality.\r\n   */\r\n  public debug: Debug;\r\n\r\n  /**\r\n   * Access [[stats]] that holds frame statistics.\r\n   */\r\n  public get stats(): DebugStats {\r\n    return this.debug.stats;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the list of post processors to apply at the end of drawing a frame (such as [[ColorBlindCorrector]])\r\n   */\r\n  public postProcessors: PostProcessor[] = [];\r\n\r\n  /**\r\n   * The current [[Scene]] being drawn and updated on screen\r\n   */\r\n  public currentScene: Scene;\r\n\r\n  /**\r\n   * The default [[Scene]] of the game, use [[Engine.goToScene]] to transition to different scenes.\r\n   */\r\n  public readonly rootScene: Scene;\r\n\r\n  /**\r\n   * Contains all the scenes currently registered with Excalibur\r\n   */\r\n  public readonly scenes: { [key: string]: Scene } = {};\r\n\r\n  /**\r\n   * @hidden\r\n   * @deprecated\r\n   */\r\n  private _animations: AnimationNode[] = [];\r\n\r\n  /**\r\n   * Indicates whether the engine is set to fullscreen or not\r\n   */\r\n  public get isFullscreen(): boolean {\r\n    return this.screen.isFullScreen;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current [[DisplayMode]] of the engine.\r\n   */\r\n  public get displayMode(): DisplayMode {\r\n    return this.screen.displayMode;\r\n  }\r\n\r\n  private _suppressPlayButton: boolean = false;\r\n  /**\r\n   * Returns the calculated pixel ration for use in rendering\r\n   */\r\n  public get pixelRatio(): number {\r\n    return this.screen.pixelRatio;\r\n  }\r\n\r\n  /**\r\n   * Indicates the current position of the engine. Valid only when DisplayMode is DisplayMode.Position\r\n   */\r\n  public position: string | AbsolutePosition;\r\n  /**\r\n   * Indicates whether audio should be paused when the game is no longer visible.\r\n   */\r\n  public pauseAudioWhenHidden: boolean = true;\r\n\r\n  /**\r\n   * Indicates whether the engine should draw with debug information\r\n   */\r\n  private _isDebug: boolean = false;\r\n  public get isDebug(): boolean {\r\n    return this._isDebug;\r\n  }\r\n  public debugColor: Color = new Color(255, 255, 255);\r\n  /**\r\n   * Sets the background color for the engine.\r\n   */\r\n  public backgroundColor: Color;\r\n\r\n  /**\r\n   * Sets the Transparency for the engine.\r\n   */\r\n  public enableCanvasTransparency: boolean = true;\r\n\r\n  /**\r\n   * The action to take when a fatal exception is thrown\r\n   */\r\n  public onFatalException = (e: any) => {\r\n    Logger.getInstance().fatal(e);\r\n  };\r\n\r\n  /**\r\n   * The mouse wheel scroll prevention mode\r\n   */\r\n  public pageScrollPreventionMode: ScrollPreventionMode;\r\n\r\n  private _logger: Logger;\r\n\r\n  // this is a reference to the current requestAnimationFrame return value\r\n  private _requestId: number;\r\n\r\n  // this determines whether excalibur is compatible with your browser\r\n  private _compatible: boolean;\r\n\r\n  private _timescale: number = 1.0;\r\n\r\n  // loading\r\n  private _loader: Loader;\r\n  private _isLoading: boolean = false;\r\n\r\n  private _isInitialized: boolean = false;\r\n\r\n  private _deferredGoTo: string = null;\r\n\r\n  public on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public on(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public on(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public on(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public on(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public on(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public on(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public on(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public on(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public on(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public on(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public on(eventName: string, handler: (event: any) => void): void {\r\n    super.on(eventName, handler);\r\n  }\r\n\r\n  public once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public once(eventName: Events.visible, handler: (event: VisibleEvent) => void): void;\r\n  public once(eventName: Events.hidden, handler: (event: HiddenEvent) => void): void;\r\n  public once(eventName: Events.start, handler: (event: GameStartEvent) => void): void;\r\n  public once(eventName: Events.stop, handler: (event: GameStopEvent) => void): void;\r\n  public once(eventName: Events.preupdate, handler: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.postupdate, handler: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public once(eventName: Events.preframe, handler: (event: PreFrameEvent) => void): void;\r\n  public once(eventName: Events.postframe, handler: (event: PostFrameEvent) => void): void;\r\n  public once(eventName: Events.predraw, handler: (event: PreDrawEvent) => void): void;\r\n  public once(eventName: Events.postdraw, handler: (event: PostDrawEvent) => void): void;\r\n  public once(eventName: string, handler: (event: GameEvent<any>) => void): void;\r\n  public once(eventName: string, handler: (event: any) => void): void {\r\n    super.once(eventName, handler);\r\n  }\r\n\r\n  public off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<Engine>) => void): void;\r\n  public off(eventName: Events.visible, handler?: (event: VisibleEvent) => void): void;\r\n  public off(eventName: Events.hidden, handler?: (event: HiddenEvent) => void): void;\r\n  public off(eventName: Events.start, handler?: (event: GameStartEvent) => void): void;\r\n  public off(eventName: Events.stop, handler?: (event: GameStopEvent) => void): void;\r\n  public off(eventName: Events.preupdate, handler?: (event: PreUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.postupdate, handler?: (event: PostUpdateEvent<Engine>) => void): void;\r\n  public off(eventName: Events.preframe, handler?: (event: PreFrameEvent) => void): void;\r\n  public off(eventName: Events.postframe, handler?: (event: PostFrameEvent) => void): void;\r\n  public off(eventName: Events.predraw, handler?: (event: PreDrawEvent) => void): void;\r\n  public off(eventName: Events.postdraw, handler?: (event: PostDrawEvent) => void): void;\r\n  public off(eventName: string, handler?: (event: GameEvent<any>) => void): void;\r\n  public off(eventName: string, handler?: (event: any) => void): void {\r\n    super.off(eventName, handler);\r\n  }\r\n\r\n  /**\r\n   * Default [[EngineOptions]]\r\n   */\r\n  private static _DEFAULT_ENGINE_OPTIONS: EngineOptions = {\r\n    width: 0,\r\n    height: 0,\r\n    enableCanvasTransparency: true,\r\n    canvasElementId: '',\r\n    canvasElement: undefined,\r\n    snapToPixel: false,\r\n    pointerScope: Input.PointerScope.Canvas,\r\n    suppressConsoleBootMessage: null,\r\n    suppressMinimumBrowserFeatureDetection: null,\r\n    suppressHiDPIScaling: null,\r\n    suppressPlayButton: null,\r\n    scrollPreventionMode: ScrollPreventionMode.Canvas,\r\n    backgroundColor: Color.fromHex('#2185d0') // Excalibur blue\r\n  };\r\n\r\n  /**\r\n   * Creates a new game using the given [[EngineOptions]]. By default, if no options are provided,\r\n   * the game will be rendered full screen (taking up all available browser window space).\r\n   * You can customize the game rendering through [[EngineOptions]].\r\n   *\r\n   * Example:\r\n   *\r\n   * ```js\r\n   * var game = new ex.Engine({\r\n   *   width: 0, // the width of the canvas\r\n   *   height: 0, // the height of the canvas\r\n   *   enableCanvasTransparency: true, // the transparencySection of the canvas\r\n   *   canvasElementId: '', // the DOM canvas element ID, if you are providing your own\r\n   *   displayMode: ex.DisplayMode.FullScreen, // the display mode\r\n   *   pointerScope: ex.Input.PointerScope.Document, // the scope of capturing pointer (mouse/touch) events\r\n   *   backgroundColor: ex.Color.fromHex('#2185d0') // background color of the engine\r\n   * });\r\n   *\r\n   * // call game.start, which is a Promise\r\n   * game.start().then(function () {\r\n   *   // ready, set, go!\r\n   * });\r\n   * ```\r\n   */\r\n  constructor(options?: EngineOptions) {\r\n    super();\r\n\r\n    options = { ...Engine._DEFAULT_ENGINE_OPTIONS, ...options };\r\n\r\n    Flags.freeze();\r\n\r\n    // Initialize browser events facade\r\n    this.browser = new BrowserEvents(window, document);\r\n\r\n    // Check compatibility\r\n    const detector = new Detector();\r\n    if (!options.suppressMinimumBrowserFeatureDetection && !(this._compatible = detector.test())) {\r\n      const message = document.createElement('div');\r\n      message.innerText = 'Sorry, your browser does not support all the features needed for Excalibur';\r\n      document.body.appendChild(message);\r\n\r\n      detector.failedTests.forEach(function (test) {\r\n        const testMessage = document.createElement('div');\r\n        testMessage.innerText = 'Browser feature missing ' + test;\r\n        document.body.appendChild(testMessage);\r\n      });\r\n\r\n      if (options.canvasElementId) {\r\n        const canvas = document.getElementById(options.canvasElementId);\r\n        if (canvas) {\r\n          canvas.parentElement.removeChild(canvas);\r\n        }\r\n      }\r\n\r\n      return;\r\n    } else {\r\n      this._compatible = true;\r\n    }\r\n\r\n    // Use native console API for color fun\r\n    // eslint-disable-next-line no-console\r\n    if (console.log && !options.suppressConsoleBootMessage) {\r\n      // eslint-disable-next-line no-console\r\n      console.log(\r\n        `%cPowered by Excalibur.js (v${EX_VERSION})`,\r\n        'background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;'\r\n      );\r\n      // eslint-disable-next-line no-console\r\n      console.log('\\n\\\r\n      /| ________________\\n\\\r\nO|===|* >________________>\\n\\\r\n      \\\\|');\r\n      // eslint-disable-next-line no-console\r\n      console.log('Visit', 'http://excaliburjs.com', 'for more information');\r\n    }\r\n\r\n    // Suppress play button\r\n    if (options.suppressPlayButton) {\r\n      this._suppressPlayButton = true;\r\n    }\r\n\r\n    this._logger = Logger.getInstance();\r\n\r\n    // If debug is enabled, let's log browser features to the console.\r\n    if (this._logger.defaultLevel === LogLevel.Debug) {\r\n      detector.logBrowserFeatures();\r\n    }\r\n\r\n    this._logger.debug('Building engine...');\r\n\r\n    this.canvasElementId = options.canvasElementId;\r\n\r\n    if (options.canvasElementId) {\r\n      this._logger.debug('Using Canvas element specified: ' + options.canvasElementId);\r\n      this.canvas = <HTMLCanvasElement>document.getElementById(options.canvasElementId);\r\n    } else if (options.canvasElement) {\r\n      this._logger.debug('Using Canvas element specified:', options.canvasElement);\r\n      this.canvas = options.canvasElement;\r\n    } else {\r\n      this._logger.debug('Using generated canvas element');\r\n      this.canvas = <HTMLCanvasElement>document.createElement('canvas');\r\n    }\r\n\r\n    let displayMode = options.displayMode ?? DisplayMode.Fixed;\r\n    if ((options.width && options.height) || options.viewport) {\r\n      if (options.displayMode === undefined) {\r\n        displayMode = DisplayMode.Fixed;\r\n      }\r\n      this._logger.debug('Engine viewport is size ' + options.width + ' x ' + options.height);\r\n    } else if (!options.displayMode) {\r\n      this._logger.debug('Engine viewport is fit');\r\n      displayMode = DisplayMode.FitScreen;\r\n    }\r\n\r\n    if (Flags.isEnabled(Legacy.Canvas)) {\r\n      const ex2dCtx = new ExcaliburGraphicsContext2DCanvas({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel\r\n      });\r\n      this.graphicsContext = ex2dCtx;\r\n      this.ctx = ex2dCtx.__ctx;\r\n    } else {\r\n      const exWebglCtx = new ExcaliburGraphicsContextWebGL({\r\n        canvasElement: this.canvas,\r\n        enableTransparency: this.enableCanvasTransparency,\r\n        smoothing: options.antialiasing,\r\n        backgroundColor: options.backgroundColor,\r\n        snapToPixel: options.snapToPixel\r\n      });\r\n      this.graphicsContext = exWebglCtx;\r\n      this.ctx = exWebglCtx.__ctx;\r\n    }\r\n\r\n    this.screen = new Screen({\r\n      canvas: this.canvas,\r\n      context: this.graphicsContext,\r\n      antialiasing: options.antialiasing ?? true,\r\n      browser: this.browser,\r\n      viewport: options.viewport ?? (options.width && options.height ? { width: options.width, height: options.height } : Resolution.SVGA),\r\n      resolution: options.resolution,\r\n      displayMode,\r\n      position: options.position,\r\n      pixelRatio: options.suppressHiDPIScaling ? 1 : null\r\n    });\r\n\r\n    if (options.backgroundColor) {\r\n      this.backgroundColor = options.backgroundColor.clone();\r\n    }\r\n\r\n    this.enableCanvasTransparency = options.enableCanvasTransparency;\r\n\r\n    this._loader = new Loader();\r\n    this.debug = new Debug(this);\r\n\r\n    this._initialize(options);\r\n\r\n    this.rootScene = this.currentScene = new Scene();\r\n\r\n    this.addScene('root', this.rootScene);\r\n  }\r\n\r\n  /**\r\n   * Returns a BoundingBox of the top left corner of the screen\r\n   * and the bottom right corner of the screen.\r\n   */\r\n  public getWorldBounds() {\r\n    return this.screen.getWorldBounds();\r\n  }\r\n\r\n  /**\r\n   * Gets the current engine timescale factor (default is 1.0 which is 1:1 time)\r\n   */\r\n  public get timescale() {\r\n    return this._timescale;\r\n  }\r\n\r\n  /**\r\n   * Sets the current engine timescale factor. Useful for creating slow-motion effects or fast-forward effects\r\n   * when using time-based movement.\r\n   */\r\n  public set timescale(value: number) {\r\n    if (value <= 0) {\r\n      Logger.getInstance().error('Cannot set engine.timescale to a value of 0 or less than 0.');\r\n      return;\r\n    }\r\n\r\n    this._timescale = value;\r\n  }\r\n\r\n  /**\r\n   * Plays a sprite animation on the screen at the specified `x` and `y`\r\n   * (in game coordinates, not screen pixels). These animations play\r\n   * independent of actors, and will be cleaned up internally as soon\r\n   * as they are complete. Note animations that loop will never be\r\n   * cleaned up.\r\n   *\r\n   * @param animation  Animation to play\r\n   * @param x          x game coordinate to play the animation\r\n   * @param y          y game coordinate to play the animation\r\n   * @deprecated\r\n   */\r\n  @obsolete({ message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use Actor.graphics' })\r\n  public playAnimation(animation: Animation, x: number, y: number) {\r\n    this._animations.push(new AnimationNode(animation, x, y));\r\n  }\r\n\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public addTileMap(tileMap: TileMap) {\r\n    this.currentScene.addTileMap(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public removeTileMap(tileMap: TileMap) {\r\n    this.currentScene.removeTileMap(tileMap);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public addTimer(timer: Timer): Timer {\r\n    return this.currentScene.addTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public removeTimer(timer: Timer): Timer {\r\n    return this.currentScene.removeTimer(timer);\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   *\r\n   * @param key  The name of the scene, must be unique\r\n   * @param scene The scene to add to the engine\r\n   */\r\n  public addScene(key: string, scene: Scene) {\r\n    if (this.scenes[key]) {\r\n      this._logger.warn('Scene', key, 'already exists overwriting');\r\n    }\r\n    this.scenes[key] = scene;\r\n  }\r\n\r\n  /**\r\n   * Removes a [[Scene]] instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public removeScene(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param key  The scene key to remove\r\n   */\r\n  public removeScene(key: string): void;\r\n  /**\r\n   * @internal\r\n   */\r\n  public removeScene(entity: any): void {\r\n    if (entity instanceof Scene) {\r\n      // remove scene\r\n      for (const key in this.scenes) {\r\n        if (this.scenes.hasOwnProperty(key)) {\r\n          if (this.scenes[key] === entity) {\r\n            delete this.scenes[key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      // remove scene\r\n      delete this.scenes[entity];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a [[Scene]] to the engine, think of scenes in Excalibur as you\r\n   * would levels or menus.\r\n   * @param sceneKey  The key of the scene, must be unique\r\n   * @param scene     The scene to add to the engine\r\n   */\r\n  public add(sceneKey: string, scene: Scene): void;\r\n  /**\r\n   * Adds a [[Timer]] to the [[currentScene]].\r\n   * @param timer  The timer to add to the [[currentScene]].\r\n   */\r\n  public add(timer: Timer): void;\r\n  /**\r\n   * Adds a [[TileMap]] to the [[currentScene]], once this is done the TileMap\r\n   * will be drawn and updated.\r\n   */\r\n  public add(tileMap: TileMap): void;\r\n  /**\r\n   * Adds an actor to the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.add(actor)`.\r\n   *\r\n   * Actors can only be drawn if they are a member of a scene, and only\r\n   * the [[currentScene]] may be drawn or updated.\r\n   *\r\n   * @param actor  The actor to add to the [[currentScene]]\r\n   */\r\n  public add(actor: Actor): void;\r\n\r\n  /**\r\n   * Adds a [[ScreenElement]] to the [[currentScene]] of the game,\r\n   * ScreenElements do not participate in collisions, instead the\r\n   * remain in the same place on the screen.\r\n   * @param screenElement  The ScreenElement to add to the [[currentScene]]\r\n   */\r\n  public add(screenElement: ScreenElement): void;\r\n  public add(entity: any): void {\r\n    if (arguments.length === 2) {\r\n      this.addScene(<string>arguments[0], <Scene>arguments[1]);\r\n      return;\r\n    }\r\n    if (this._deferredGoTo && this.scenes[this._deferredGoTo]) {\r\n      this.scenes[this._deferredGoTo].add(entity);\r\n    } else {\r\n      this.currentScene.add(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes a scene instance from the engine\r\n   * @param scene  The scene to remove\r\n   */\r\n  public remove(scene: Scene): void;\r\n  /**\r\n   * Removes a scene from the engine by key\r\n   * @param sceneKey  The scene to remove\r\n   */\r\n  public remove(sceneKey: string): void;\r\n  /**\r\n   * Removes a [[Timer]] from the [[currentScene]].\r\n   * @param timer  The timer to remove to the [[currentScene]].\r\n   */\r\n  public remove(timer: Timer): void;\r\n  /**\r\n   * Removes a [[TileMap]] from the [[currentScene]], it will no longer be drawn or updated.\r\n   */\r\n  public remove(tileMap: TileMap): void;\r\n  /**\r\n   * Removes an actor from the [[currentScene]] of the game. This is synonymous\r\n   * to calling `engine.currentScene.removeChild(actor)`.\r\n   * Actors that are removed from a scene will no longer be drawn or updated.\r\n   *\r\n   * @param actor  The actor to remove from the [[currentScene]].\r\n   */\r\n  public remove(actor: Actor): void;\r\n  /**\r\n   * Removes a [[ScreenElement]] to the scene, it will no longer be drawn or updated\r\n   * @param screenElement  The ScreenElement to remove from the [[currentScene]]\r\n   */\r\n  public remove(screenElement: ScreenElement): void;\r\n  public remove(entity: any): void {\r\n    if (entity instanceof Entity) {\r\n      this.currentScene.remove(entity);\r\n    }\r\n\r\n    if (entity instanceof Scene) {\r\n      this.removeScene(entity);\r\n    }\r\n\r\n    if (typeof entity === 'string') {\r\n      this.removeScene(entity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Changes the currently updating and drawing scene to a different,\r\n   * named scene. Calls the [[Scene]] lifecycle events.\r\n   * @param key  The key of the scene to transition to.\r\n   */\r\n  public goToScene(key: string): void {\r\n    // if not yet initialized defer goToScene\r\n    if (!this.isInitialized) {\r\n      this._deferredGoTo = key;\r\n      return;\r\n    }\r\n\r\n    if (this.scenes[key]) {\r\n      const oldScene = this.currentScene;\r\n      const newScene = this.scenes[key];\r\n\r\n      this._logger.debug('Going to scene:', key);\r\n\r\n      // only deactivate when initialized\r\n      if (this.currentScene.isInitialized) {\r\n        this.currentScene._deactivate.apply(this.currentScene, [oldScene, newScene]);\r\n        this.currentScene.eventDispatcher.emit('deactivate', new DeactivateEvent(newScene, this.currentScene));\r\n      }\r\n\r\n      // set current scene to new one\r\n      this.currentScene = newScene;\r\n      this.screen.setCurrentCamera(newScene.camera);\r\n\r\n      // initialize the current scene if has not been already\r\n      this.currentScene._initialize(this);\r\n\r\n      this.currentScene._activate.apply(this.currentScene, [oldScene, newScene]);\r\n      this.currentScene.eventDispatcher.emit('activate', new ActivateEvent(oldScene, this.currentScene));\r\n    } else {\r\n      this._logger.error('Scene', key, 'does not exist!');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transforms the current x, y from screen coordinates to world coordinates\r\n   * @param point  Screen coordinate to convert\r\n   */\r\n  public screenToWorldCoordinates(point: Vector): Vector {\r\n    return this.screen.screenToWorldCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Transforms a world coordinate, to a screen coordinate\r\n   * @param point  World coordinate to convert\r\n   */\r\n  public worldToScreenCoordinates(point: Vector): Vector {\r\n    return this.screen.worldToScreenCoordinates(point);\r\n  }\r\n\r\n  /**\r\n   * Initializes the internal canvas, rendering context, display mode, and native event listeners\r\n   */\r\n  private _initialize(options?: EngineOptions) {\r\n    this.pageScrollPreventionMode = options.scrollPreventionMode;\r\n\r\n    // initialize inputs\r\n    this.input = {\r\n      keyboard: new Input.Keyboard(),\r\n      pointers: new Input.Pointers(this),\r\n      gamepads: new Input.Gamepads()\r\n    };\r\n    this.input.keyboard.init();\r\n    this.input.pointers.init(options && options.pointerScope === Input.PointerScope.Document ? document : this.canvas);\r\n    this.input.gamepads.init();\r\n\r\n    // Issue #385 make use of the visibility api\r\n    // https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API\r\n\r\n    let hidden: keyof HTMLDocument, visibilityChange: string;\r\n    if (typeof document.hidden !== 'undefined') {\r\n      // Opera 12.10 and Firefox 18 and later support\r\n      hidden = 'hidden';\r\n      visibilityChange = 'visibilitychange';\r\n    } else if ('msHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'msHidden';\r\n      visibilityChange = 'msvisibilitychange';\r\n    } else if ('webkitHidden' in document) {\r\n      hidden = <keyof HTMLDocument>'webkitHidden';\r\n      visibilityChange = 'webkitvisibilitychange';\r\n    }\r\n\r\n    this.browser.document.on(visibilityChange, () => {\r\n      if (document[hidden]) {\r\n        this.eventDispatcher.emit('hidden', new HiddenEvent(this));\r\n        this._logger.debug('Window hidden');\r\n      } else {\r\n        this.eventDispatcher.emit('visible', new VisibleEvent(this));\r\n        this._logger.debug('Window visible');\r\n      }\r\n    });\r\n\r\n    if (!this.canvasElementId && !options.canvasElement) {\r\n      document.body.appendChild(this.canvas);\r\n    }\r\n  }\r\n\r\n  public onInitialize(_engine: Engine) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * If supported by the browser, this will set the antialiasing flag on the\r\n   * canvas. Set this to `false` if you want a 'jagged' pixel art look to your\r\n   * image resources.\r\n   * @param isSmooth  Set smoothing to true or false\r\n   */\r\n  public setAntialiasing(isSmooth: boolean) {\r\n    this.screen.antialiasing = isSmooth;\r\n  }\r\n\r\n  /**\r\n   * Return the current smoothing status of the canvas\r\n   */\r\n  public getAntialiasing(): boolean {\r\n    return this.screen.antialiasing;\r\n  }\r\n\r\n  /**\r\n   * Gets whether the actor is Initialized\r\n   */\r\n  public get isInitialized(): boolean {\r\n    return this._isInitialized;\r\n  }\r\n\r\n  private _overrideInitialize(engine: Engine) {\r\n    if (!this.isInitialized) {\r\n      this.onInitialize(engine);\r\n      super.emit('initialize', new InitializeEvent(engine, this));\r\n      this._isInitialized = true;\r\n      if (this._deferredGoTo) {\r\n        this.goToScene(this._deferredGoTo);\r\n      } else {\r\n        this.goToScene('root');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates the entire state of the game\r\n   * @param delta  Number of milliseconds elapsed since the last update.\r\n   */\r\n  private _update(delta: number) {\r\n    if (this._isLoading) {\r\n      // suspend updates until loading is finished\r\n      this._loader.update(this, delta);\r\n      // Update input listeners\r\n      this.input.keyboard.update();\r\n      this.input.pointers.update();\r\n      this.input.gamepads.update();\r\n      return;\r\n    }\r\n\r\n    this._overrideInitialize(this);\r\n\r\n    // Publish preupdate events\r\n    this._preupdate(delta);\r\n\r\n    // process engine level events\r\n    this.currentScene.update(this, delta);\r\n\r\n    // update animations\r\n    // TODO remove\r\n    this._animations = this._animations.filter(function (a) {\r\n      return !a.animation.isDone();\r\n    });\r\n\r\n    // Update input listeners\r\n    this.input.keyboard.update();\r\n    this.input.pointers.update();\r\n    this.input.gamepads.update();\r\n\r\n    // Publish update event\r\n    this._postupdate(delta);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _preupdate(delta: number) {\r\n    this.emit('preupdate', new PreUpdateEvent(this, delta, this));\r\n    this.onPreUpdate(this, delta);\r\n  }\r\n\r\n  public onPreUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postupdate(delta: number) {\r\n    this.emit('postupdate', new PostUpdateEvent(this, delta, this));\r\n    this.onPostUpdate(this, delta);\r\n  }\r\n\r\n  public onPostUpdate(_engine: Engine, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Draws the entire game\r\n   * @param delta  Number of milliseconds elapsed since the last draw.\r\n   */\r\n  private _draw(delta: number) {\r\n    const ctx = this.ctx;\r\n    this._predraw(ctx, delta);\r\n\r\n    if (this._isLoading) {\r\n      this._loader.canvas.draw(this.graphicsContext, 0, 0);\r\n      this.graphicsContext.flush();\r\n      // Drawing nothing else while loading\r\n      return;\r\n    }\r\n\r\n    // TODO move to graphics systems?\r\n    this.graphicsContext.backgroundColor = this.backgroundColor;\r\n\r\n    this.currentScene.draw(this.ctx, delta);\r\n\r\n    // todo needs to be a better way of doing this\r\n    let a = 0;\r\n    const len = this._animations.length;\r\n    for (a; a < len; a++) {\r\n      this._animations[a].animation.draw(ctx, this._animations[a].x, this._animations[a].y);\r\n    }\r\n\r\n    // Draw debug information\r\n    // TODO don't access ctx directly\r\n    if (this.isDebug) {\r\n      this.ctx.font = 'Consolas';\r\n      this.ctx.fillStyle = this.debugColor.toString();\r\n      const keys = this.input.keyboard.getKeys();\r\n      for (let j = 0; j < keys.length; j++) {\r\n        this.ctx.fillText(keys[j].toString() + ' : ' + (Input.Keys[keys[j]] ? Input.Keys[keys[j]] : 'Not Mapped'), 100, 10 * j + 10);\r\n      }\r\n\r\n      this.ctx.fillText('FPS:' + this.stats.currFrame.fps.toFixed(2).toString(), 10, 10);\r\n    }\r\n\r\n    // Post processing\r\n    for (let i = 0; i < this.postProcessors.length; i++) {\r\n      this.postProcessors[i].process(this.ctx.getImageData(0, 0, this.canvasWidth, this.canvasHeight), this.ctx);\r\n    }\r\n\r\n    this._postdraw(ctx, delta);\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _predraw(_ctx: CanvasRenderingContext2D, delta: number) {\r\n    this.emit('predraw', new PreDrawEvent(_ctx, delta, this));\r\n    this.onPreDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * @internal\r\n   */\r\n  public _postdraw(_ctx: CanvasRenderingContext2D, delta: number) {\r\n    this.emit('postdraw', new PostDrawEvent(_ctx, delta, this));\r\n    this.onPostDraw(_ctx, delta);\r\n  }\r\n\r\n  public onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    // Override me\r\n  }\r\n\r\n  /**\r\n   * Enable or disable Excalibur debugging functionality.\r\n   * @param toggle a value that debug drawing will be changed to\r\n   */\r\n  public showDebug(toggle: boolean): void {\r\n    this._isDebug = toggle;\r\n  }\r\n\r\n  /**\r\n   * Toggle Excalibur debugging functionality.\r\n   */\r\n  public toggleDebug(): boolean {\r\n    this._isDebug = !this._isDebug;\r\n    return this._isDebug;\r\n  }\r\n\r\n  private _loadingComplete: boolean = false;\r\n  /**\r\n   * Returns true when loading is totally complete and the player has clicked start\r\n   */\r\n  public get loadingComplete() {\r\n    return this._loadingComplete;\r\n  }\r\n  /**\r\n   * Starts the internal game loop for Excalibur after loading\r\n   * any provided assets.\r\n   * @param loader  Optional [[Loader]] to use to load resources. The default loader is [[Loader]], override to provide your own\r\n   * custom loader.\r\n   */\r\n  public start(loader?: Loader): Promise<void> {\r\n    if (!this._compatible) {\r\n      return Promise.reject('Excalibur is incompatible with your browser');\r\n    }\r\n    let loadingComplete: Promise<void>;\r\n    // Push the current user entered resolution/viewport\r\n    this.screen.pushResolutionAndViewport();\r\n    // Configure resolution for loader\r\n    this.screen.resolution = this.screen.viewport;\r\n    this.screen.applyResolutionAndViewport();\r\n    this.graphicsContext.updateViewport();\r\n    if (loader) {\r\n      this._loader = loader;\r\n      this._loader.suppressPlayButton = this._suppressPlayButton || this._loader.suppressPlayButton;\r\n      this._loader.wireEngine(this);\r\n      loadingComplete = this.load(this._loader);\r\n    } else {\r\n      loadingComplete = Promise.resolve();\r\n    }\r\n\r\n    loadingComplete.then(() => {\r\n      this.screen.popResolutionAndViewport();\r\n      this.screen.applyResolutionAndViewport();\r\n      this.graphicsContext.updateViewport();\r\n      this.emit('start', new GameStartEvent(this));\r\n      this._loadingComplete = true;\r\n    });\r\n\r\n    if (!this._hasStarted) {\r\n      // has started is a slight misnomer, it's really mainloop started\r\n      this._hasStarted = true;\r\n      this._logger.debug('Starting game...');\r\n      this.browser.resume();\r\n      Engine.createMainLoop(this, window.requestAnimationFrame, Date.now)();\r\n      this._logger.debug('Game started');\r\n    } else {\r\n      // Game already started;\r\n    }\r\n    return loadingComplete;\r\n  }\r\n\r\n  public static createMainLoop(game: Engine, raf: (func: Function) => number, nowFn: () => number) {\r\n    let lastTime = nowFn();\r\n\r\n    return function mainloop() {\r\n      if (!game._hasStarted) {\r\n        return;\r\n      }\r\n      try {\r\n        game._requestId = raf(mainloop);\r\n        game.emit('preframe', new PreFrameEvent(game, game.stats.prevFrame));\r\n\r\n        // Get the time to calculate time-elapsed\r\n        const now = nowFn();\r\n        let elapsed = Math.floor(now - lastTime) || 1;\r\n        // Resolves issue #138 if the game has been paused, or blurred for\r\n        // more than a 200 milliseconds, reset elapsed time to 1. This improves reliability\r\n        // and provides more expected behavior when the engine comes back\r\n        // into focus\r\n        if (elapsed > 200) {\r\n          elapsed = 1;\r\n        }\r\n        const delta = elapsed * game.timescale;\r\n\r\n        // reset frame stats (reuse existing instances)\r\n        const frameId = game.stats.prevFrame.id + 1;\r\n        game.stats.currFrame.reset();\r\n        game.stats.currFrame.id = frameId;\r\n        game.stats.currFrame.delta = delta;\r\n        game.stats.currFrame.fps = 1.0 / (delta / 1000);\r\n\r\n        const beforeUpdate = nowFn();\r\n        game._update(delta);\r\n        const afterUpdate = nowFn();\r\n        game._draw(delta);\r\n        const afterDraw = nowFn();\r\n\r\n        game.stats.currFrame.duration.update = afterUpdate - beforeUpdate;\r\n        game.stats.currFrame.duration.draw = afterDraw - afterUpdate;\r\n\r\n        lastTime = now;\r\n\r\n        game.emit('postframe', new PostFrameEvent(game, game.stats.currFrame));\r\n        game.stats.prevFrame.reset(game.stats.currFrame);\r\n      } catch (e) {\r\n        window.cancelAnimationFrame(game._requestId);\r\n        game.stop();\r\n        game.onFatalException(e);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Stops Excalibur's main loop, useful for pausing the game.\r\n   */\r\n  public stop() {\r\n    if (this._hasStarted) {\r\n      this.emit('stop', new GameStopEvent(this));\r\n      this.browser.pause();\r\n      this._hasStarted = false;\r\n      this._logger.debug('Game stopped');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the Engine's Running status, Useful for checking whether engine is running or paused.\r\n   */\r\n  public isPaused(): boolean {\r\n    return !this._hasStarted;\r\n  }\r\n\r\n  /**\r\n   * Takes a screen shot of the current viewport and returns it as an\r\n   * HTML Image Element.\r\n   */\r\n  public screenshot(): HTMLImageElement {\r\n    const result = new Image();\r\n    const raw = this.canvas.toDataURL('image/png');\r\n    result.src = raw;\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Another option available to you to load resources into the game.\r\n   * Immediately after calling this the game will pause and the loading screen\r\n   * will appear.\r\n   * @param loader  Some [[Loadable]] such as a [[Loader]] collection, [[Sound]], or [[Texture]].\r\n   */\r\n  public load(loader: Loadable<any>): Promise<void> {\r\n    const complete = new Promise<void>((resolve) => {\r\n      this._isLoading = true;\r\n\r\n      loader.load().then(() => {\r\n        if (this._suppressPlayButton) {\r\n          setTimeout(() => {\r\n            this._isLoading = false;\r\n            resolve();\r\n            // Delay is to give the logo a chance to show, otherwise don't delay\r\n          }, 500);\r\n        } else {\r\n          this._isLoading = false;\r\n          resolve();\r\n        }\r\n      });\r\n    });\r\n\r\n    return complete;\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n * @deprecated\r\n */\r\n@obsolete({ message: 'Will be removed in excalibur v0.26.0' })\r\nclass AnimationNode {\r\n  constructor(public animation: Animation, public x: number, public y: number) {}\r\n}\r\n","import { GameEvent } from '../Events';\r\nimport { Sound } from '../Resources/Sound/Sound';\r\nimport { Actor } from '../Actor';\r\nimport { WebAudioInstance } from '../Resources/Sound/WebAudioInstance';\r\n\r\nexport class MediaEvent extends GameEvent<Sound> {\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public set bubbles(_value: boolean) {\r\n    // stubbed\r\n  }\r\n  /**\r\n   * Media event cannot bubble\r\n   */\r\n  public get bubbles(): boolean {\r\n    return false;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected get _path(): Actor[] {\r\n    return null;\r\n  }\r\n  /**\r\n   * Media event cannot bubble, so they have no path\r\n   */\r\n  protected set _path(_val: Actor[]) {\r\n    // stubbed\r\n  }\r\n\r\n  constructor(public target: Sound, protected _name: string = 'MediaEvent') {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Prevents event from bubbling\r\n   */\r\n  public stopPropagation(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Action, that calls when event happens\r\n   */\r\n  public action(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n  /**\r\n   * Propagate event further through event path\r\n   */\r\n  public propagate(): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n\r\n  public layPath(_actor: Actor): void {\r\n    /**\r\n     * Stub\r\n     */\r\n  }\r\n}\r\n\r\nexport class NativeSoundEvent extends MediaEvent {\r\n  constructor(target: Sound, public track?: WebAudioInstance) {\r\n    super(target, 'NativeSoundEvent');\r\n  }\r\n}\r\n\r\nexport class NativeSoundProcessedEvent extends MediaEvent {\r\n  public data: string | AudioBuffer;\r\n\r\n  constructor(target: Sound, private _processedData: string | AudioBuffer) {\r\n    super(target, 'NativeSoundProcessedEvent');\r\n\r\n    this.data = this._processedData;\r\n  }\r\n}\r\n","import { Vector } from '../Math/vector';\nimport { BoundingBox } from '../Collision/Index';\nimport { Color } from '../Color';\nimport { line } from '../Util/DrawUtil';\nimport { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\nimport { BaseAlign, Direction, FontOptions, FontStyle, FontUnit, TextAlign, FontRenderer } from './FontCommon';\nimport { Raster, RasterOptions } from './Raster';\n\nexport class Font extends Raster implements FontRenderer {\n  constructor(options: FontOptions & RasterOptions = {}) {\n    super(options);\n    this.family = options?.family ?? this.family;\n    this.style = options?.style ?? this.style;\n    this.bold = options?.bold ?? this.bold;\n    this.size = options?.size ?? this.size;\n    this.unit = options?.unit ?? this.unit;\n    this.textAlign = options?.textAlign ?? this.textAlign;\n    this.baseAlign = options?.baseAlign ?? this.baseAlign;\n    this.direction = options?.direction ?? this.direction;\n    this.quality = options?.quality ?? this.quality;\n    if (options?.shadow) {\n      this.shadow = {};\n      this.shadow.blur = options.shadow.blur ?? this.shadow.blur;\n      this.shadow.offset = options.shadow.offset ?? this.shadow.offset;\n      this.shadow.color = options.shadow.color ?? this.shadow.color;\n    }\n    this.flagDirty();\n  }\n\n  public clone() {\n    return new Font({\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions(),\n      size: this.size,\n      unit: this.unit,\n      family: this.family,\n      style: this.style,\n      bold: this.bold,\n      textAlign: this.textAlign,\n      baseAlign: this.baseAlign,\n      direction: this.direction,\n      shadow: this.shadow\n        ? {\n          blur: this.shadow.blur,\n          offset: this.shadow.offset,\n          color: this.shadow.color\n        }\n        : null\n    });\n  }\n\n  /**\n   * Font quality determines the size of the underlying rastered text, higher quality means less jagged edges.\n   * If quality is set to 1, then just enough raster bitmap is generated to render the text.\n   *\n   * You can think of quality as how zoomed in to the text you can get before seeing jagged edges.\n   *\n   * (Default 4)\n   */\n  public quality = 2;\n\n  public family: string = 'sans-serif';\n  public style: FontStyle = FontStyle.Normal;\n  public bold: boolean = false;\n  public unit: FontUnit = FontUnit.Px;\n  public textAlign: TextAlign = TextAlign.Left;\n  public baseAlign: BaseAlign = BaseAlign.Alphabetic;\n  public direction: Direction = Direction.LeftToRight;\n  public size: number = 10;\n  public shadow: { blur?: number; offset?: Vector; color?: Color } = null;\n\n  public get fontString() {\n    return `${this.style} ${this.bold ? 'bold' : ''} ${this.size}${this.unit} ${this.family}`;\n  }\n\n  private _text: string;\n  private _lines: string[];\n  private _textBounds: BoundingBox = new BoundingBox();\n  private _textWidth: number = 0;\n  private _textHeight: number = 0;\n\n  public get width() {\n    return this._textWidth;\n  }\n\n  public set width(value: number) {\n    this._textWidth = value;\n  }\n\n  public get height() {\n    const numLines = this._lines?.length ?? 1;\n    return this._textHeight * numLines;\n  }\n\n  public set height(value: number) {\n    const numLines = this._lines?.length ?? 1;\n    this._textHeight = value / numLines;\n  }\n\n  private get _rasterWidth() {\n    return this._bitmap.width;\n  }\n\n  private get _rasterHeight() {\n    return this._bitmap.height;\n  }\n\n  private get _halfRasterWidth() {\n    return Math.floor(this._bitmap.width / 2);\n  }\n\n  private get _halfRasterHeight() {\n    return Math.floor(this._bitmap.height / 2);\n  }\n\n  public get localBounds(): BoundingBox {\n    return this._textBounds;\n  }\n\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\n    if (this.dirty) {\n      this.rasterize();\n    }\n\n    ex.drawImage(\n      this._bitmap,\n      0,\n      0,\n      this._rasterWidth,\n      this._rasterHeight,\n      x - this._rasterWidth / this.quality / 2,\n      y - this._rasterHeight / this.quality / 2,\n      this._rasterWidth / this.quality,\n      this._rasterHeight / this.quality\n    );\n  }\n\n  protected _rotate(ex: ExcaliburGraphicsContext) {\n    // TODO this needs to change depending on the bounding box...\n    const origin = this.origin ?? this._textBounds.center;\n    ex.translate(origin.x, origin.y);\n    ex.rotate(this.rotation);\n    ex.translate(-origin.x, -origin.y);\n  }\n\n  protected _flip(ex: ExcaliburGraphicsContext) {\n    if (this.flipHorizontal) {\n      ex.translate(this._textBounds.width / this.scale.x, 0);\n      ex.scale(-1, 1);\n    }\n\n    if (this.flipVertical) {\n      ex.translate(0, -this._textBounds.height / 2 / this.scale.y);\n      ex.scale(1, -1);\n    }\n  }\n\n  public updateText(text: string) {\n    if (this._text !== text) {\n      this._text = text;\n      this._lines = this._text.split('\\n');\n      this._updateDimensions();\n      this.flagDirty();\n    }\n  }\n\n  private _updateDimensions() {\n    if (this._text) {\n      this._applyFont(this._ctx);\n      const maxWidthLine = this._lines.reduce((a, b) => {\n        return a.length > b.length ? a : b;\n      });\n      const metrics = this._ctx.measureText(maxWidthLine);\n      this._textWidth = Math.abs(metrics.actualBoundingBoxLeft) + Math.abs(metrics.actualBoundingBoxRight);\n      this._textHeight = Math.abs(metrics.actualBoundingBoxAscent) + Math.abs(metrics.actualBoundingBoxDescent);\n\n      // TODO lineheight makes the text bounds wonky\n      const lineAdjustedHeight = this._textHeight * this._lines.length;\n      // this._textHeight = lineAdjustedHeight;\n      // Changing the width and height clears the context properties\n      // We double the bitmap width to account for alignment\n      // We scale by \"quality\" so we render text without jaggies\n      this._bitmap.width = (this._textWidth + this.padding * 2) * 2 * this.quality;\n      this._bitmap.height = (lineAdjustedHeight + this.padding * 2) * 2 * this.quality;\n\n      // These bounds exist in raster bitmap space where the top left corner is the corder of the bitmap\n      const x = 0;\n      const y = 0;\n      const bottomBounds = lineAdjustedHeight - Math.abs(metrics.actualBoundingBoxAscent);\n      this._textBounds = new BoundingBox({\n        left: x - Math.abs(metrics.actualBoundingBoxLeft) - this.padding,\n        top: y - Math.abs(metrics.actualBoundingBoxAscent) - this.padding,\n        bottom: y + bottomBounds + this.padding,\n        right: x + Math.abs(metrics.actualBoundingBoxRight) + this.padding\n      });\n    }\n  }\n\n  protected _preDraw(ex: ExcaliburGraphicsContext, x: number, y: number): void {\n    if (this.dirty) {\n      this._updateDimensions();\n    }\n    super._preDraw(ex, x, y);\n  }\n\n  protected _postDraw(ex: ExcaliburGraphicsContext): void {\n    if (this.showDebug) {\n      /* istanbul ignore next */\n      ex.debug.drawRect(-this._halfRasterWidth, -this._halfRasterHeight, this._rasterWidth, this._rasterHeight);\n    }\n    ex.restore();\n  }\n\n  private _applyFont(ctx: CanvasRenderingContext2D) {\n    ctx.translate(this.padding + this._halfRasterWidth, this.padding + this._halfRasterHeight);\n    ctx.scale(this.quality, this.quality);\n    ctx.textAlign = this.textAlign;\n    ctx.textBaseline = this.baseAlign;\n    ctx.font = this.fontString;\n    ctx.direction = this.direction;\n\n    if (this.shadow) {\n      ctx.shadowColor = this.shadow.color.toString();\n      ctx.shadowBlur = this.shadow.blur;\n      ctx.shadowOffsetX = this.shadow.offset.x;\n      ctx.shadowOffsetY = this.shadow.offset.y;\n    }\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this._text) {\n      // The reason we need to re-apply the font is setting raster properties (like width/height) can reset the context props\n      this._applyRasterProperites(ctx);\n      this._applyFont(ctx);\n\n      const lineHeight = this._textHeight; // TODO user specified line height\n      for (let i = 0; i < this._lines.length; i++) {\n        const line = this._lines[i];\n        if (this.color) {\n          ctx.fillText(line, 0, i * lineHeight);\n        }\n\n        if (this.strokeColor) {\n          ctx.strokeText(line, 0, i * lineHeight);\n        }\n      }\n\n      if (this.showDebug) {\n        // Horizontal line\n        /* istanbul ignore next */\n        line(ctx, Color.Red, -this._halfRasterWidth, 0, this._halfRasterWidth, 0, 2);\n        // Vertical line\n        /* istanbul ignore next */\n        line(ctx, Color.Red, 0, -this._halfRasterHeight, 0, this._halfRasterHeight, 2);\n      }\n    }\n  }\n\n  public render(ex: ExcaliburGraphicsContext, text: string, x: number, y: number) {\n    this.updateText(text);\n    this.draw(ex, x, y);\n  }\n}\n","import { ExcaliburGraphicsContext } from './Context/ExcaliburGraphicsContext';\r\nimport { BoundingBox } from '../Collision/BoundingBox';\r\nimport { SpriteFont } from './SpriteFont';\r\nimport { Graphic, GraphicOptions } from './Graphic';\r\nimport { Color } from '../Color';\r\nimport { Font } from './Font';\r\nimport { watch } from '../Util/Watch';\r\n\r\nexport interface TextOptions {\r\n  text: string;\r\n  color?: Color;\r\n  font?: Font | SpriteFont;\r\n}\r\n\r\nexport class Text extends Graphic {\r\n  constructor(options: TextOptions & GraphicOptions) {\r\n    super(options);\r\n    // This order is important font, color, then text\r\n    this.font = options.font ?? new Font();\r\n    this.color = options.color ?? this.color;\r\n    this.text = options.text;\r\n  }\r\n\r\n  public clone(): Text {\r\n    return new Text({\r\n      text: this.text.slice(),\r\n      color: this.color.clone(),\r\n      font: this.font.clone()\r\n    });\r\n  }\r\n\r\n  private _text: string = '';\r\n  public get text() {\r\n    return this._text;\r\n  }\r\n\r\n  public set text(value: string) {\r\n    this._text = value;\r\n    this.font.updateText(value);\r\n  }\r\n\r\n  // TODO SpriteFont doesn't support a color yet :(\r\n  public get color() {\r\n    if (this.font instanceof Font) {\r\n      return this.font.color;\r\n    }\r\n    return Color.Black;\r\n  }\r\n\r\n  public set color(color: Color) {\r\n    if (this.font instanceof Font) {\r\n      this.font.color = color;\r\n    }\r\n  }\r\n\r\n  private _font: Font | SpriteFont;\r\n  public get font(): Font | SpriteFont {\r\n    return this._font;\r\n  }\r\n  public set font(font: Font | SpriteFont) {\r\n    if (font instanceof Font) {\r\n      this._font = watch(font, (font) => font.flagDirty());\r\n    } else {\r\n      this._font = font;\r\n    }\r\n  }\r\n\r\n  public get width() {\r\n    return this.font.width;\r\n  }\r\n\r\n  public get height() {\r\n    return this.font.height;\r\n  }\r\n\r\n  public get localBounds(): BoundingBox {\r\n    return this.font.localBounds;\r\n  }\r\n\r\n  protected _rotate(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected _flip(_ex: ExcaliburGraphicsContext) {\r\n    // None this is delegated to font\r\n    // This override erases the default behavior\r\n  }\r\n\r\n  protected _drawImage(ex: ExcaliburGraphicsContext, x: number, y: number) {\r\n    if (this.font instanceof Font) {\r\n      this.font.color = this.color;\r\n    }\r\n    this.font.flipHorizontal = this.flipHorizontal;\r\n    this.font.flipVertical = this.flipVertical;\r\n    this.font.scale = this.scale;\r\n    this.font.rotation = this.rotation;\r\n    this.font.origin = this.origin;\r\n    this.font.opacity = this.opacity;\r\n    this.font.render(ex, this._text, x, y);\r\n  }\r\n}\r\n","import { Engine } from './Engine';\r\nimport { Color } from './Color';\r\nimport { vec, Vector } from './Math/vector';\r\nimport { Text } from './Graphics/Text';\r\nimport { BaseAlign, FontStyle, FontUnit, TextAlign } from './Graphics/FontCommon';\r\nimport { obsolete } from './Util/Decorators';\r\nimport { SpriteFont as LegacySpriteFont } from './Drawing/SpriteSheet';\r\nimport { ExcaliburGraphicsContext, GraphicsComponent, SpriteFont } from './Graphics';\r\nimport { Font } from './Graphics/Font';\r\nimport { Actor } from './Actor';\r\nimport { ActorArgs } from '.';\r\n\r\n/**\r\n * Option for creating a label\r\n */\r\nexport interface LabelOptions {\r\n  /**\r\n   * Specify the label text\r\n   */\r\n  text?: string;\r\n  /**\r\n   * Specify the color of the text (does not apply to SpriteFonts)\r\n   */\r\n  color?: Color;\r\n  x?: number;\r\n  y?: number;\r\n  pos?: Vector;\r\n  /**\r\n   * Optionally specify a sprite font, will take precedence over any other [[Font]]\r\n   */\r\n  spriteFont?: SpriteFont | LegacySpriteFont;\r\n  /**\r\n   * Specify a custom font\r\n   */\r\n  font?: Font\r\n}\r\n\r\n/**\r\n * Labels are the way to draw small amounts of text to the screen. They are\r\n * actors and inherit all of the benefits and capabilities.\r\n */\r\nexport class Label extends Actor {\r\n  public font: Font = new Font();\r\n  private _text: Text = new Text({ text: '', font: this.font });\r\n\r\n  /**\r\n   * The text to draw.\r\n   */\r\n  public get text(): string {\r\n    return this._text.text;\r\n  }\r\n\r\n  public set text(text: string) {\r\n    this._text.text = text;\r\n  }\r\n\r\n  public get color(): Color {\r\n    return this._text.color;\r\n  }\r\n\r\n  public set color(color: Color) {\r\n    this._text.color = color;\r\n  }\r\n\r\n  public get opacity(): number {\r\n    return this._text.opacity;\r\n  }\r\n\r\n  public set opacity(opacity: number) {\r\n    this._text.opacity = opacity;\r\n  }\r\n\r\n  /**\r\n   * Sets or gets the bold property of the label's text, by default it's false\r\n   * @deprecated Use [[Font.bold|Label.font.bold]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.bold will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.bold'\r\n  })\r\n  public get bold(): boolean {\r\n    return this.font.bold;\r\n  }\r\n\r\n  public set bold(isBold: boolean) {\r\n    this.font.bold = isBold;\r\n  }\r\n\r\n  /**\r\n   * The CSS font family string (e.g. `sans-serif`, `Droid Sans Pro`). Web fonts\r\n   * are supported, same as in CSS.\r\n   * @deprecated Use [[Font.family|Label.font.family]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontFamily will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.family'\r\n  })\r\n  public get fontFamily(): string {\r\n    return this.font.family;\r\n  }\r\n\r\n  public set fontFamily(family: string) {\r\n    this.font.family = family;\r\n  }\r\n\r\n  /**\r\n   * The font size in the selected units, default is 10 (default units is pixel)\r\n   * @deprecated Use [[Font.size|Label.font.size]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontSize will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.size'\r\n  })\r\n  public get fontSize(): number {\r\n    return this.font.size;\r\n  }\r\n\r\n  public set fontSize(sizeInUnit: number) {\r\n    this.font.size = sizeInUnit;\r\n  }\r\n\r\n  /**\r\n   * The font style for this label, the default is [[FontStyle.Normal]]\r\n   * @deprecated Use [[Font.style|Label.font.style]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontStyle will be removed in v0.26.0',\r\n    alternateMethod: 'Use Lable.font.style'\r\n  })\r\n  public get fontStyle(): FontStyle {\r\n    return this.font.style;\r\n  }\r\n\r\n  public set fontStyle(style: FontStyle) {\r\n    this.font.style = style;\r\n  }\r\n\r\n  /**\r\n   * The css units for a font size such as px, pt, em (SpriteFont only support px), by default is 'px';\r\n   * @deprecated Use [[Font.unit|Label.font.unit]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.fontUnit will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.unit'\r\n  })\r\n  public get fontUnit(): FontUnit {\r\n    return this.font.unit;\r\n  }\r\n\r\n  public set fontUnit(unit: FontUnit) {\r\n    this.font.unit = unit;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the horizontal text alignment property for the label.\r\n   * @deprecated Use [[Font.textAlign|Label.font.textAlign]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.textAlign will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.textAlign'\r\n  })\r\n  public get textAlign(): TextAlign {\r\n    return this.font.textAlign;\r\n  }\r\n\r\n  public set textAlign(align: TextAlign) {\r\n    this.font.textAlign = align;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the baseline alignment property for the label.\r\n   * @deprecated Use [[Font.baseAlign|Label.font.baseAlign]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.baseAlign will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.baseAlign'\r\n  })\r\n  public get baseAlign(): BaseAlign {\r\n    return this.font.baseAlign;\r\n  }\r\n\r\n  public set baseAlign(align: BaseAlign) {\r\n    this.font.baseAlign = align;\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the maximum width (in pixels) that the label should occupy\r\n   * @deprecated The maxWidth constraint is gone\r\n   */\r\n  public maxWidth: number;\r\n\r\n  private _legacySpriteFont: LegacySpriteFont;\r\n  private _spriteFont: SpriteFont;\r\n  /**\r\n   * The [[LegacyDrawing.SpriteFont]] to use, if any. Overrides [[fontFamily]] if present.\r\n   * @deprecated Use [[SpriteFont]]\r\n   */\r\n  @obsolete()\r\n  public get spriteFont(): LegacySpriteFont {\r\n    return this._legacySpriteFont;\r\n  }\r\n\r\n  public set spriteFont(sf: LegacySpriteFont | SpriteFont) {\r\n    if (sf) {\r\n      if (sf instanceof LegacySpriteFont) {\r\n        this._legacySpriteFont = sf;\r\n        this._spriteFont = SpriteFont.fromLegacySpriteFont(sf);\r\n        this._text.font = this._spriteFont;\r\n        return;\r\n      }\r\n      this._spriteFont = sf;\r\n      this._text.font = this._spriteFont;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets or sets the letter spacing on a Label. Only supported with Sprite Fonts.\r\n   * @deprecated Use [[SpriteFont.spacing]]\r\n   */\r\n  public letterSpacing: number = 0; //px\r\n\r\n  /**\r\n   * Whether or not the [[SpriteFont]] will be case-sensitive when matching characters.\r\n   * @deprecated Use Graphics.SpriteFont.caseInsensitve\r\n   */\r\n  public caseInsensitive: boolean = true;\r\n\r\n  private _graphicsContext: ExcaliburGraphicsContext;\r\n\r\n  /**\r\n   * Build a new label\r\n   * @param options\r\n   */\r\n  constructor(options?: LabelOptions & ActorArgs) {\r\n    super(options);\r\n    const {text, pos, x, y, spriteFont, font, color} = options;\r\n\r\n    this.pos = pos ?? (x && y ? vec(x, y) : this.pos);\r\n    this.text = text ?? this.text;\r\n    this.spriteFont = spriteFont ?? this.spriteFont;\r\n    this.font = font ?? this.font;\r\n    this.color = color ?? this.color;\r\n    const gfx = this.get(GraphicsComponent);\r\n    gfx.anchor = Vector.Zero;\r\n    gfx.use(this._text);\r\n  }\r\n\r\n  public _initialize(engine: Engine) {\r\n    super._initialize(engine);\r\n    this._graphicsContext = engine.graphicsContext;\r\n  }\r\n\r\n  /**\r\n   * Returns the width of the text in the label (in pixels);\r\n   */\r\n  public getTextWidth(): number {\r\n    return this._text.width;\r\n  }\r\n\r\n  /**\r\n   * Sets the text shadow for sprite fonts\r\n   * @param offsetX      The x offset in pixels to place the shadow\r\n   * @param offsetY      The y offset in pixels to place the shadow\r\n   * @param shadowColor  The color of the text shadow\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.setTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public setTextShadow(offsetX: number, offsetY: number, shadowColor: Color) {\r\n    this.font.shadow = { offset: vec(offsetX, offsetY), blur: 2, color: shadowColor };\r\n  }\r\n\r\n  /**\r\n   * Toggles text shadows on or off, only applies when using sprite fonts\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.useTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public useTextShadow(on: boolean) {\r\n    if (this.spriteFont) {\r\n      this.spriteFont.useTextShadow(on);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clears the current text shadow\r\n   * @deprecated Use [[Font.shadow|Label.font.shadow]]\r\n   */\r\n  @obsolete({\r\n    message: 'Label.clearTextShadow will be removed in v0.26.0',\r\n    alternateMethod: 'Use Label.font.shadow'\r\n  })\r\n  public clearTextShadow() {\r\n    this.font.shadow = null;\r\n  }\r\n\r\n  public draw(_ctx: CanvasRenderingContext2D, _delta: number) {\r\n    const exctx = this._graphicsContext;\r\n    this._text.draw(exctx, 0, 0);\r\n  }\r\n}\r\n","import { CollisionGroup } from './CollisionGroup';\r\n\r\n/**\r\n * Static class for managing collision groups in excalibur, there is a maximum of 32 collision groups possible in excalibur\r\n */\r\nexport class CollisionGroupManager {\r\n  // using bitmasking the maximum number of groups is 32, because that is the highest 32bit integer that JS can present.\r\n  private static _STARTING_BIT = 0b1 | 0;\r\n  private static _MAX_GROUPS = 32;\r\n  private static _CURRENT_GROUP = 1;\r\n  private static _CURRENT_BIT = CollisionGroupManager._STARTING_BIT;\r\n  private static _GROUPS: Map<string, CollisionGroup> = new Map<string, CollisionGroup>();\r\n\r\n  /**\r\n   * Create a new named collision group up to a max of 32.\r\n   * @param name Name for the collision group\r\n   * @param mask Optionally provide your own 32-bit mask, if none is provide the manager will generate one\r\n   */\r\n  public static create(name: string, mask?: number) {\r\n    if (this._CURRENT_GROUP > this._MAX_GROUPS) {\r\n      throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);\r\n    }\r\n    if (this._GROUPS.get(name)) {\r\n      throw new Error(`Collision group ${name} already exists`);\r\n    }\r\n    const group = new CollisionGroup(name, this._CURRENT_BIT, mask !== undefined ? mask : ~this._CURRENT_BIT);\r\n    this._CURRENT_BIT = (this._CURRENT_BIT << 1) | 0;\r\n    this._CURRENT_GROUP++;\r\n    this._GROUPS.set(name, group);\r\n    return group;\r\n  }\r\n\r\n  /**\r\n   * Get all collision groups currently tracked by excalibur\r\n   */\r\n  public static get groups(): CollisionGroup[] {\r\n    return Array.from(this._GROUPS.values());\r\n  }\r\n\r\n  /**\r\n   * Get a collision group by it's name\r\n   * @param name\r\n   */\r\n  public static groupByName(name: string) {\r\n    return this._GROUPS.get(name);\r\n  }\r\n\r\n  /**\r\n   * Resets the managers internal group management state\r\n   */\r\n  public static reset() {\r\n    this._GROUPS = new Map<string, CollisionGroup>();\r\n    this._CURRENT_BIT = this._STARTING_BIT;\r\n    this._CURRENT_GROUP = 1;\r\n  }\r\n}\r\n","import { Color } from '../Color';\r\nimport * as Effects from './SpriteEffects';\r\n\r\nimport { Drawable, DrawOptions } from '../Interfaces/Drawable';\r\nimport { Vector } from '../Math/vector';\r\nimport { obsolete } from '../Util/Decorators';\r\n\r\n/**\r\n * Creates a closed polygon drawing given a list of [[Vector]]s.\r\n *\r\n * @deprecated Use [[Polygon]]\r\n * @warning Use sparingly as Polygons are performance intensive\r\n */\r\n@obsolete({\r\n  message: 'Polygon will be removed in v0.26.0',\r\n  alternateMethod: 'Use Graphics.Polygon'\r\n})\r\nexport class Polygon implements Drawable {\r\n  public flipVertical: boolean;\r\n  public flipHorizontal: boolean;\r\n  public drawWidth: number;\r\n  public drawHeight: number;\r\n\r\n  public width: number;\r\n  public height: number;\r\n\r\n  /**\r\n   * The color to use for the lines of the polygon\r\n   */\r\n  public lineColor: Color;\r\n  /**\r\n   * The color to use for the interior of the polygon\r\n   */\r\n  public fillColor: Color;\r\n  /**\r\n   * The width of the lines of the polygon\r\n   */\r\n  public lineWidth: number = 5;\r\n  /**\r\n   * Indicates whether the polygon is filled or not.\r\n   */\r\n  public filled: boolean = false;\r\n\r\n  private _points: Vector[] = [];\r\n  public anchor = Vector.Zero;\r\n  public offset = Vector.Zero;\r\n  public rotation: number = 0;\r\n  public scale = Vector.One;\r\n  public opacity: number = 1;\r\n\r\n  /**\r\n   * @param points  The vectors to use to build the polygon in order\r\n   */\r\n  constructor(points: Vector[]) {\r\n    this._points = points;\r\n\r\n    const minX = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.min(prev, curr.x);\r\n    }, 0);\r\n    const maxX = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.max(prev, curr.x);\r\n    }, 0);\r\n\r\n    this.drawWidth = maxX - minX;\r\n\r\n    const minY = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.min(prev, curr.y);\r\n    }, 0);\r\n    const maxY = this._points.reduce((prev: number, curr: Vector) => {\r\n      return Math.max(prev, curr.y);\r\n    }, 0);\r\n\r\n    this.drawHeight = maxY - minY;\r\n\r\n    this.height = this.drawHeight;\r\n    this.width = this.drawWidth;\r\n  }\r\n\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public addEffect() {\r\n    // not supported on polygons\r\n  }\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect(index: number): void;\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect(effect: Effects.SpriteEffect): void;\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public removeEffect() {\r\n    // not supported on polygons\r\n  }\r\n\r\n  /**\r\n   * @notimplemented Effects are not supported on `Polygon`\r\n   */\r\n  public clearEffects() {\r\n    // not supported on polygons\r\n  }\r\n\r\n  public reset() {\r\n    //pass\r\n  }\r\n\r\n  /**\r\n   * Draws the sprite appropriately to the 2D rendering context, at an x and y coordinate.\r\n   * @param ctx  The 2D rendering context\r\n   * @param x    The x coordinate of where to draw\r\n   * @param y    The y coordinate of where to draw\r\n   */\r\n  public draw(ctx: CanvasRenderingContext2D, x: number, y: number): void;\r\n  /**\r\n   * Draws the sprite with custom options to override internals without mutating them.\r\n   * @param options\r\n   */\r\n  public draw(options: DrawOptions): void;\r\n  public draw(ctxOrOptions: CanvasRenderingContext2D | DrawOptions, x?: number, y?: number): void {\r\n    if (ctxOrOptions instanceof CanvasRenderingContext2D) {\r\n      this._drawWithOptions({ ctx: ctxOrOptions, x, y });\r\n    } else {\r\n      this._drawWithOptions(ctxOrOptions);\r\n    }\r\n  }\r\n\r\n  private _drawWithOptions(options: DrawOptions) {\r\n    const { ctx, x, y, rotation, drawWidth, drawHeight, anchor, offset, opacity, flipHorizontal, flipVertical } = {\r\n      ...options,\r\n      rotation: options.rotation ?? this.rotation,\r\n      drawWidth: options.drawWidth ?? this.drawWidth,\r\n      drawHeight: options.drawHeight ?? this.drawHeight,\r\n      flipHorizontal: options.flipHorizontal ?? this.flipHorizontal,\r\n      flipVertical: options.flipVertical ?? this.flipVertical,\r\n      anchor: options.anchor ?? this.anchor,\r\n      offset: options.offset ?? this.offset,\r\n      opacity: (options.opacity ?? 1) * (this.opacity ?? 1)\r\n    };\r\n\r\n    const xpoint = drawWidth * anchor.x + offset.x + x;\r\n    const ypoint = drawHeight * anchor.y + offset.y + y;\r\n\r\n    ctx.save();\r\n    ctx.translate(xpoint, ypoint);\r\n    ctx.scale(this.scale.x, this.scale.y);\r\n    ctx.rotate(rotation);\r\n    ctx.beginPath();\r\n    ctx.lineWidth = this.lineWidth;\r\n\r\n    // Iterate through the supplied points and construct a 'polygon'\r\n    const firstPoint = this._points[0];\r\n    ctx.moveTo(firstPoint.x, firstPoint.y);\r\n\r\n    let i = 0;\r\n    const len = this._points.length;\r\n\r\n    for (i; i < len; i++) {\r\n      ctx.lineTo(this._points[i].x, this._points[i].y);\r\n    }\r\n\r\n    ctx.lineTo(firstPoint.x, firstPoint.y);\r\n    ctx.closePath();\r\n\r\n    if (this.filled) {\r\n      ctx.fillStyle = this.fillColor.toString();\r\n      ctx.fill();\r\n    }\r\n\r\n    ctx.strokeStyle = this.lineColor.toString();\r\n\r\n    if (flipHorizontal) {\r\n      ctx.translate(drawWidth, 0);\r\n      ctx.scale(-1, 1);\r\n    }\r\n\r\n    if (flipVertical) {\r\n      ctx.translate(0, drawHeight);\r\n      ctx.scale(1, -1);\r\n    }\r\n\r\n    const oldAlpha = ctx.globalAlpha;\r\n    ctx.globalAlpha = opacity;\r\n    ctx.stroke();\r\n    ctx.globalAlpha = oldAlpha;\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","import { Audio } from './Audio';\r\n\r\nexport type ExResponseType = '' | 'arraybuffer' | 'blob' | 'document' | 'json' | 'text';\r\n\r\nexport interface ExResponseTypesLookup {\r\n  [name: string]: ExResponseType;\r\n}\r\n\r\nexport class ExResponse {\r\n  public static type: ExResponseTypesLookup = {\r\n    any: '',\r\n    blob: 'blob',\r\n    json: 'json',\r\n    text: 'text',\r\n    document: 'document',\r\n    arraybuffer: 'arraybuffer'\r\n  };\r\n}\r\n\r\n/**\r\n * Represents an audio implementation like [[WebAudioInstance]]\r\n */\r\nexport interface AudioImplementation {\r\n  /**\r\n   * XHR response type\r\n   */\r\n  responseType: ExResponseType;\r\n\r\n  /**\r\n   * Processes raw data and transforms into sound data\r\n   */\r\n  processData(data: Blob | ArrayBuffer): Promise<string | AudioBuffer>;\r\n\r\n  /**\r\n   * Factory method that returns an instance of a played audio track\r\n   */\r\n  createInstance(data: string | AudioBuffer): Audio;\r\n}\r\n","import { Engine } from './../Engine';\r\nimport * as Events from './../Events';\r\nimport { Scene } from '../Scene';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _initialize {\r\n  _initialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n * Type guard checking for internal initialize method\r\n * @internal\r\n * @param a\r\n */\r\nexport function has_initialize(a: any): a is _initialize {\r\n  return !!a._initialize;\r\n}\r\n\r\nexport interface OnInitialize {\r\n  onInitialize(engine: Engine): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnInitialize(a: any): a is OnInitialize {\r\n  return !!a.onInitialize;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _preupdate {\r\n  _preupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_preupdate(a: any): a is _preupdate {\r\n  return !!a._preupdate;\r\n}\r\n\r\nexport interface OnPreUpdate {\r\n  onPreUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPreUpdate(a: any): a is OnPreUpdate {\r\n  return !!a.onPreUpdate;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface _postupdate {\r\n  _postupdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function has_postupdate(a: any): a is _postupdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface OnPostUpdate {\r\n  onPostUpdate(engine: Engine, delta: number): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasOnPostUpdate(a: any): a is OnPostUpdate {\r\n  return !!a.onPostUpdate;\r\n}\r\n\r\nexport interface CanInitialize {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onInitialize(_engine: Engine): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  once(eventName: Events.initialize, handler: (event: Events.InitializeEvent<any>) => void): void;\r\n  off(eventName: Events.initialize, handler?: (event: Events.InitializeEvent<any>) => void): void;\r\n}\r\n\r\nexport interface CanActivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onActivate(oldScene: Scene, newScene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  once(eventName: Events.activate, handler: (event: Events.ActivateEvent) => void): void;\r\n  off(eventName: Events.activate, handler?: (event: Events.ActivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanDeactivate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onDeactivate(oldScene: Scene, newScene: Scene): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  once(eventName: Events.deactivate, handler: (event: Events.DeactivateEvent) => void): void;\r\n  off(eventName: Events.deactivate, handler?: (event: Events.DeactivateEvent) => void): void;\r\n}\r\n\r\nexport interface CanUpdate {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signature\r\n   */\r\n  on(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.preupdate, handler: (event: Events.PreUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.preupdate, handler?: (event: Events.PreUpdateEvent<any>) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostUpdate(_engine: Engine, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  once(eventName: Events.postupdate, handler: (event: Events.PostUpdateEvent<any>) => void): void;\r\n  off(eventName: Events.postupdate, handler?: (event: Events.PostUpdateEvent<any>) => void): void;\r\n}\r\n\r\nexport interface OnPreDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n}\r\n\r\nexport interface OnPostDraw {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostDraw(_ctx: CanvasRenderingContext2D, _delta: number): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\nexport interface CanDraw extends OnPreDraw, OnPostDraw {\r\n  on(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  on(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  once(eventName: Events.predraw, handler: (event: Events.PreDrawEvent) => void): void;\r\n  once(eventName: Events.postdraw, handler: (event: Events.PostDrawEvent) => void): void;\r\n\r\n  off(eventName: Events.predraw, handler?: (event: Events.PreDrawEvent) => void): void;\r\n  off(eventName: Events.postdraw, handler?: (event: Events.PostDrawEvent) => void): void;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPreDraw(a: any): a is OnPreDraw {\r\n  return !!a.onPreDraw;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nexport function hasPostDraw(a: any): a is OnPostDraw {\r\n  return !!a.onPostDraw;\r\n}\r\n\r\nexport interface CanBeKilled {\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPreKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  once(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n  off(eventName: Events.prekill, handler: (event: Events.PreKillEvent) => void): void;\r\n\r\n  /**\r\n   * Overridable implementation\r\n   */\r\n  onPostKill(_scene: Scene): void;\r\n\r\n  /**\r\n   * Event signatures\r\n   */\r\n  on(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  once(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n  off(eventName: Events.postkill, handler: (event: Events.PostKillEvent) => void): void;\r\n}\r\n","import { Audio } from '../../Interfaces/Audio';\r\nimport * as Util from '../../Util/Util';\r\nimport { AudioContextFactory } from './AudioContext';\r\n\r\n/**\r\n * Internal class representing a Web Audio AudioBufferSourceNode instance\r\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API\r\n */\r\nexport class WebAudioInstance implements Audio {\r\n  private _volume = 1;\r\n  private _duration: number | undefined = undefined;\r\n\r\n  private _playingPromise: Promise<boolean>;\r\n  private _playingResolve: (value: boolean) => void;\r\n\r\n  private _loop = false;\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    if (this._instance) {\r\n      this._instance.loop = value;\r\n      this._wireUpOnEnded();\r\n    }\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    value = Util.clamp(value, 0, 1.0);\r\n\r\n    this._volume = value;\r\n\r\n    if (this._isPlaying && this._volumeNode.gain.setTargetAtTime) {\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/AudioParam/setTargetAtTime\r\n      // After each .1 seconds timestep, the target value will ~63.2% closer to the target value.\r\n      // This exponential ramp provides a more pleasant transition in gain\r\n      this._volumeNode.gain.setTargetAtTime(value, this._audioContext.currentTime, 0.1);\r\n    } else {\r\n      this._volumeNode.gain.value = value;\r\n    }\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  public set duration(value: number | undefined) {\r\n    this._duration = value;\r\n  }\r\n\r\n  /**\r\n   * Duration of the sound, in seconds.\r\n   */\r\n  public get duration() {\r\n    return this._duration;\r\n  }\r\n\r\n  private get _playbackRate(): number {\r\n    return this._instance ? 1 / (this._instance.playbackRate.value || 1.0) : null;\r\n  }\r\n\r\n  private _isPlaying = false;\r\n  private _isPaused = false;\r\n  private _instance: AudioBufferSourceNode;\r\n  private _audioContext: AudioContext = AudioContextFactory.create();\r\n  private _volumeNode = this._audioContext.createGain();\r\n  private _startTime: number;\r\n\r\n  /**\r\n   * Current playback offset (in seconds)\r\n   */\r\n  private _currentOffset = 0;\r\n\r\n  constructor(private _src: AudioBuffer) {\r\n    this._createNewBufferSource();\r\n  }\r\n\r\n  public isPlaying() {\r\n    return this._isPlaying;\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n  public play(playStarted: () => any = () => {}) {\r\n    if (this._isPaused) {\r\n      this._resumePlayBack();\r\n      playStarted();\r\n    }\r\n\r\n    if (!this._isPlaying) {\r\n      this._startPlayBack();\r\n      playStarted();\r\n    }\r\n\r\n    return this._playingPromise;\r\n  }\r\n\r\n  public pause() {\r\n    if (!this._isPlaying) {\r\n      return;\r\n    }\r\n\r\n    this._isPaused = true;\r\n    this._isPlaying = false;\r\n\r\n    this._instance.stop(0);\r\n    // Playback rate will be a scale factor of how fast/slow the audio is being played\r\n    // default is 1.0\r\n    // we need to invert it to get the time scale\r\n\r\n    this._setPauseOffset();\r\n  }\r\n\r\n  public stop() {\r\n    if (!this._isPlaying) {\r\n      return;\r\n    }\r\n\r\n    this._isPlaying = false;\r\n    this._isPaused = false;\r\n\r\n    this._currentOffset = 0;\r\n    this._instance.stop(0);\r\n\r\n    // handler will not be wired up if we were looping\r\n    if (!this._instance.onended) {\r\n      this._handleOnEnded();\r\n    }\r\n  }\r\n\r\n  private _startPlayBack() {\r\n    this._isPlaying = true;\r\n    this._isPaused = false;\r\n    this._playingPromise = new Promise<boolean>((resolve) => {\r\n      this._playingResolve = resolve;\r\n    });\r\n\r\n    if (!this._instance) {\r\n      this._createNewBufferSource();\r\n    }\r\n\r\n    this._rememberStartTime();\r\n\r\n    this._volumeNode.connect(this._audioContext.destination);\r\n    this._instance.start(0, 0);\r\n    this._currentOffset = 0;\r\n\r\n    this._wireUpOnEnded();\r\n  }\r\n\r\n  private _resumePlayBack() {\r\n    if (!this._isPaused) {\r\n      return;\r\n    }\r\n\r\n    this._isPaused = false;\r\n    this._isPlaying = true;\r\n\r\n    // a buffer source can only be started once\r\n    // so we need to dispose of the previous instance before\r\n    // \"resuming\" the next one\r\n    this._instance.onended = null; // dispose of any previous event handler\r\n    this._createNewBufferSource();\r\n\r\n    const duration = this._playbackRate * this._src.duration;\r\n    const restartTime = this._currentOffset % duration;\r\n\r\n    this._rememberStartTime(restartTime * -1000);\r\n    this._instance.start(0, restartTime);\r\n    this._wireUpOnEnded();\r\n  }\r\n\r\n  private _wireUpOnEnded() {\r\n    if (!this.loop) {\r\n      this._instance.onended = () => this._handleOnEnded();\r\n    }\r\n  }\r\n\r\n  private _handleOnEnded() {\r\n    // pausing calls stop(0) which triggers onended event\r\n    // so we don't \"resolve\" yet (when we resume we'll try again)\r\n    if (!this._isPaused) {\r\n      this._isPlaying = false;\r\n      this._playingResolve(true);\r\n    }\r\n  }\r\n\r\n  private _rememberStartTime(amend?: number) {\r\n    this._startTime = new Date().getTime() + (amend | 0);\r\n  }\r\n\r\n  private _setPauseOffset() {\r\n    this._currentOffset = ((new Date().getTime() - this._startTime) * this._playbackRate) / 1000; // in seconds\r\n  }\r\n\r\n  private _createNewBufferSource() {\r\n    this._instance = this._audioContext.createBufferSource();\r\n    this._instance.buffer = this._src;\r\n    this._instance.loop = this.loop;\r\n    this._instance.playbackRate.setValueAtTime(1.0, 0);\r\n\r\n    this._instance.connect(this._volumeNode);\r\n  }\r\n}\r\n","import { Logger } from './Log';\r\n\r\n/**\r\n * Whether or not the browser can play this file as HTML5 Audio\r\n */\r\nexport function canPlayFile(file: string): boolean {\r\n  try {\r\n    const a = new Audio();\r\n    const filetype = /.*\\.([A-Za-z0-9]+)$/;\r\n    const type = file.match(filetype)[1];\r\n    if (a.canPlayType('audio/' + type)) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  } catch (e) {\r\n    Logger.getInstance().warn('Cannot determine audio support, assuming no support for the Audio Tag', e);\r\n    return false;\r\n  }\r\n}\r\n","import { ExResponse } from '../../Interfaces/AudioImplementation';\r\nimport { Audio } from '../../Interfaces/Audio';\r\nimport { Engine } from '../../Engine';\r\nimport { Resource } from '../Resource';\r\nimport { WebAudioInstance } from './WebAudioInstance';\r\nimport { AudioContextFactory } from './AudioContext';\r\nimport { NativeSoundEvent, NativeSoundProcessedEvent } from '../../Events/MediaEvents';\r\nimport { canPlayFile } from '../../Util/Sound';\r\nimport { Loadable } from '../../Interfaces/Index';\r\nimport { Logger } from '../../Util/Log';\r\nimport { Class } from '../../Class';\r\n\r\n/**\r\n * The [[Sound]] object allows games built in Excalibur to load audio\r\n * components, from soundtracks to sound effects. [[Sound]] is an [[Loadable]]\r\n * which means it can be passed to a [[Loader]] to pre-load before a game or level.\r\n */\r\nexport class Sound extends Class implements Audio, Loadable<AudioBuffer> {\r\n  public logger: Logger = Logger.getInstance();\r\n  public data: AudioBuffer;\r\n  private _resource: Resource<ArrayBuffer>;\r\n  /**\r\n   * Indicates whether the clip should loop when complete\r\n   * @param value  Set the looping flag\r\n   */\r\n  public set loop(value: boolean) {\r\n    this._loop = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.loop = this._loop;\r\n    }\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._loop);\r\n  }\r\n  public get loop(): boolean {\r\n    return this._loop;\r\n  }\r\n\r\n  public set volume(value: number) {\r\n    this._volume = value;\r\n\r\n    for (const track of this._tracks) {\r\n      track.volume = this._volume;\r\n    }\r\n\r\n    this.emit('volumechange', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Set loop for all instances of sound', this.path, 'to', this._volume);\r\n  }\r\n  public get volume(): number {\r\n    return this._volume;\r\n  }\r\n\r\n  public get duration(): number | undefined {\r\n    return this._duration;\r\n  }\r\n\r\n  /**\r\n   * Return array of Current AudioInstances playing or being paused\r\n   */\r\n  public get instances(): Audio[] {\r\n    return this._tracks;\r\n  }\r\n\r\n  public get path() {\r\n    return this._resource.path;\r\n  }\r\n\r\n  public set path(val: string) {\r\n    this._resource.path = val;\r\n  }\r\n\r\n  private _loop = false;\r\n  private _volume = 1;\r\n  private _duration: number | undefined = undefined;\r\n  private _isStopped = false;\r\n  private _isPaused = false;\r\n  private _tracks: Audio[] = [];\r\n  private _engine: Engine;\r\n  private _wasPlayingOnHidden: boolean = false;\r\n  private _audioContext = AudioContextFactory.create();\r\n\r\n  /**\r\n   * @param paths A list of audio sources (clip.wav, clip.mp3, clip.ogg) for this audio clip. This is done for browser compatibility.\r\n   */\r\n  constructor(...paths: string[]) {\r\n    super();\r\n    this._resource = new Resource('', ExResponse.type.arraybuffer);\r\n    /**\r\n     * Chrome : MP3, WAV, Ogg\r\n     * Firefox : WAV, Ogg,\r\n     * IE : MP3, WAV coming soon\r\n     * Safari MP3, WAV, Ogg\r\n     */\r\n    for (const path of paths) {\r\n      if (canPlayFile(path)) {\r\n        this.path = path;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!this.path) {\r\n      this.logger.warn('This browser does not support any of the audio files specified:', paths.join(', '));\r\n      this.logger.warn('Attempting to use', paths[0]);\r\n      this.path = paths[0]; // select the first specified\r\n    }\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  public async load(): Promise<AudioBuffer> {\r\n    if (this.data) {\r\n      return this.data;\r\n    }\r\n    const arraybuffer = await this._resource.load();\r\n    const audiobuffer = await this.decodeAudio(arraybuffer.slice(0));\r\n    this._duration = typeof audiobuffer === 'object' ? audiobuffer.duration : undefined;\r\n    this.emit('processed', new NativeSoundProcessedEvent(this, audiobuffer));\r\n    return this.data = audiobuffer;\r\n  }\r\n\r\n  public async decodeAudio(data: ArrayBuffer): Promise<AudioBuffer> {\r\n    try {\r\n      return await this._audioContext.decodeAudioData(data.slice(0));\r\n    } catch (e) {\r\n      this.logger.error(\r\n        'Unable to decode ' +\r\n          ' this browser may not fully support this format, or the file may be corrupt, ' +\r\n          'if this is an mp3 try removing id3 tags and album art from the file.'\r\n      );\r\n      return await Promise.reject();\r\n    }\r\n  }\r\n\r\n  public wireEngine(engine: Engine) {\r\n    if (engine) {\r\n      this._engine = engine;\r\n\r\n      this._engine.on('hidden', () => {\r\n        if (engine.pauseAudioWhenHidden && this.isPlaying()) {\r\n          this._wasPlayingOnHidden = true;\r\n          this.pause();\r\n        }\r\n      });\r\n\r\n      this._engine.on('visible', () => {\r\n        if (engine.pauseAudioWhenHidden && this._wasPlayingOnHidden) {\r\n          this.play();\r\n          this._wasPlayingOnHidden = false;\r\n        }\r\n      });\r\n\r\n      this._engine.on('start', () => {\r\n        this._isStopped = false;\r\n      });\r\n\r\n      this._engine.on('stop', () => {\r\n        this.stop();\r\n        this._isStopped = true;\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns how many instances of the sound are currently playing\r\n   */\r\n  public instanceCount(): number {\r\n    return this._tracks.length;\r\n  }\r\n\r\n  /**\r\n   * Whether or not the sound is playing right now\r\n   */\r\n  public isPlaying(): boolean {\r\n    return this._tracks.some((t) => t.isPlaying());\r\n  }\r\n\r\n  /**\r\n   * Play the sound, returns a promise that resolves when the sound is done playing\r\n   * An optional volume argument can be passed in to play the sound. Max volume is 1.0\r\n   */\r\n  public play(volume?: number): Promise<boolean> {\r\n    if (!this.isLoaded()) {\r\n      this.logger.warn('Cannot start playing. Resource', this.path, 'is not loaded yet');\r\n\r\n      return Promise.resolve(true);\r\n    }\r\n\r\n    if (this._isStopped) {\r\n      this.logger.warn('Cannot start playing. Engine is in a stopped state.');\r\n      return Promise.resolve(false);\r\n    }\r\n\r\n    this.volume = volume || this.volume;\r\n\r\n    if (this._isPaused) {\r\n      return this._resumePlayback();\r\n    } else {\r\n      return this._startPlayback();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Stop the sound, and do not rewind\r\n   */\r\n  public pause() {\r\n    if (!this.isPlaying()) {\r\n      return;\r\n    }\r\n\r\n    for (const track of this._tracks) {\r\n      track.pause();\r\n    }\r\n\r\n    this._isPaused = true;\r\n\r\n    this.emit('pause', new NativeSoundEvent(this));\r\n\r\n    this.logger.debug('Paused all instances of sound', this.path);\r\n  }\r\n\r\n  /**\r\n   * Stop the sound if it is currently playing and rewind the track. If the sound is not playing, rewinds the track.\r\n   */\r\n  public stop() {\r\n    for (const track of this._tracks) {\r\n      track.stop();\r\n    }\r\n\r\n    this.emit('stop', new NativeSoundEvent(this));\r\n\r\n    this._isPaused = false;\r\n    this._tracks.length = 0;\r\n    this.logger.debug('Stopped all instances of sound', this.path);\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Get Id of provided AudioInstance in current trackList\r\n   * @param track [[Audio]] which Id is to be given\r\n   */\r\n  public getTrackId(track: Audio): number {\r\n    return this._tracks.indexOf(track);\r\n  }\r\n\r\n  private async _resumePlayback(): Promise<boolean> {\r\n    if (this._isPaused) {\r\n      const resumed: Promise<boolean>[] = [];\r\n      // ensure we resume *current* tracks (if paused)\r\n      for (const track of this._tracks) {\r\n        resumed.push(track.play());\r\n      }\r\n\r\n      this._isPaused = false;\r\n\r\n      this.emit('resume', new NativeSoundEvent(this));\r\n\r\n      this.logger.debug('Resuming paused instances for sound', this.path, this._tracks);\r\n      // resolve when resumed tracks are done\r\n      await Promise.all(resumed);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Starts playback, returns a promise that resolves when playback is complete\r\n   */\r\n  private async _startPlayback(): Promise<boolean> {\r\n    const track = await this._getTrackInstance(this.data);\r\n\r\n    const complete = await track.play(() => {\r\n      this.emit('playbackstart', new NativeSoundEvent(this, track));\r\n      this.logger.debug('Playing new instance for sound', this.path);\r\n    });\r\n\r\n    // when done, remove track\r\n    this.emit('playbackend', new NativeSoundEvent(this, track));\r\n    this._tracks.splice(this.getTrackId(track), 1);\r\n\r\n    return complete;\r\n  }\r\n\r\n  private _getTrackInstance(data: AudioBuffer): WebAudioInstance {\r\n    const newTrack = new WebAudioInstance(data);\r\n\r\n    newTrack.loop = this.loop;\r\n    newTrack.volume = this.volume;\r\n    newTrack.duration = this.duration;\r\n\r\n    this._tracks.push(newTrack);\r\n\r\n    return newTrack;\r\n  }\r\n}\r\n","import { Resource } from './Resource';\r\nimport { Sprite } from '../Graphics/Sprite';\r\nimport { Color } from '../Color';\r\nimport { SpriteSheet } from '../Graphics/SpriteSheet';\r\nimport { Animation } from '../Graphics/Animation';\r\nimport { Engine } from '../Engine';\r\nimport { Loadable } from '../Interfaces/Index';\r\nimport { ImageSource } from '../Graphics/ImageSource';\r\nimport { LegacyDrawing } from '..';\r\nimport { range } from '../Util/Util';\r\n/**\r\n * The [[Texture]] object allows games built in Excalibur to load image resources.\r\n * [[Texture]] is an [[Loadable]] which means it can be passed to a [[Loader]]\r\n * to pre-load before starting a level or game.\r\n */\r\nexport class Gif implements Loadable<ImageSource[]> {\r\n  private _resource: Resource<ArrayBuffer>;\r\n\r\n  /**\r\n   * The width of the texture in pixels\r\n   */\r\n  public width: number;\r\n\r\n  /**\r\n   * The height of the texture in pixels\r\n   */\r\n  public height: number;\r\n\r\n\r\n  private _stream: Stream = null;\r\n  private _gif: ParseGif = null;\r\n  private _textures: ImageSource[] = [];\r\n  private _animation: Animation = null;\r\n  private _transparentColor: Color = null;\r\n\r\n  public data: ImageSource[];\r\n\r\n  /**\r\n   * @param path       Path to the image resource\r\n   * @param color      Optionally set the color to treat as transparent the gif, by default [[Color.Magenta]]\r\n   * @param bustCache  Optionally load texture with cache busting\r\n   */\r\n  constructor(public path: string, public color: Color = Color.Magenta, public bustCache = true) {\r\n    this._resource = new Resource(path, 'arraybuffer', bustCache);\r\n    this._transparentColor = color;\r\n  }\r\n\r\n  /**\r\n   * Begins loading the texture and returns a promise to be resolved on completion\r\n   */\r\n  public async load(): Promise<ImageSource[]> {\r\n    const arraybuffer = await this._resource.load();\r\n    this._stream = new Stream(arraybuffer);\r\n    this._gif = new ParseGif(this._stream, this._transparentColor);\r\n    const images = this._gif.images.map(i => new ImageSource(i.src, false));\r\n\r\n    // Load all textures\r\n    await Promise.all(images.map(t => t.load()));\r\n    return this.data = this._textures = images;\r\n  }\r\n\r\n  public isLoaded() {\r\n    return !!this.data;\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a legacy sprite by index\r\n   * @deprecated\r\n   */\r\n  public toLegacySprite(id: number = 0): LegacyDrawing.Sprite {\r\n    return Sprite.toLegacySprite(this.toSprite(id));\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a legacy spritesheet\r\n   * @deprecated\r\n   * @returns\r\n   */\r\n  public toLegacySpriteSheet(): LegacyDrawing.SpriteSheet {\r\n    return SpriteSheet.toLegacySpriteSheet(this.toSpriteSheet());\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a legacy animation\r\n   * @deprecated\r\n   * @param speed\r\n   */\r\n  public toLegacyAnimation(engine: Engine, speed: number): LegacyDrawing.Animation {\r\n    return Animation.toLegacyAnimation(engine, this.toAnimation(speed));\r\n  }\r\n\r\n  /**\r\n   * Return a frame of the gif as a sprite by id\r\n   * @param id\r\n   */\r\n  public toSprite(id: number = 0): Sprite {\r\n    const sprite = this._textures[id].toSprite();\r\n    return sprite;\r\n  }\r\n\r\n  /**\r\n   * Return the gif as a spritesheet\r\n   */\r\n  public toSpriteSheet(): SpriteSheet {\r\n    const sprites: Sprite[] = this._textures.map((image) => {\r\n      return image.toSprite();\r\n    });\r\n    return new SpriteSheet({ sprites });\r\n  }\r\n\r\n  /**\r\n   * Transform the GIF into an animation with duration per frame\r\n   */\r\n  public toAnimation(durationPerFrameMs: number): Animation {\r\n    const spriteSheet: SpriteSheet = this.toSpriteSheet();\r\n    const length = spriteSheet.sprites.length;\r\n    this._animation = Animation.fromSpriteSheet(spriteSheet, range(0, length), durationPerFrameMs);\r\n    return this._animation;\r\n  }\r\n\r\n  public get readCheckBytes(): number[] {\r\n    return this._gif.checkBytes;\r\n  }\r\n}\r\n\r\nexport interface GifFrame {\r\n  sentinel: number;\r\n  type: string;\r\n  leftPos: number;\r\n  topPos: number;\r\n  width: number;\r\n  height: number;\r\n  lctFlag: boolean;\r\n  interlaced: boolean;\r\n  sorted: boolean;\r\n  reserved: boolean[];\r\n  lctSize: number;\r\n  lzwMinCodeSize: number;\r\n  pixels: number[];\r\n}\r\n\r\nconst bitsToNum = (ba: any) => {\r\n  return ba.reduce(function (s: number, n: number) {\r\n    return s * 2 + n;\r\n  }, 0);\r\n};\r\n\r\nconst byteToBitArr = (bite: any) => {\r\n  const a = [];\r\n  for (let i = 7; i >= 0; i--) {\r\n    a.push(!!(bite & (1 << i)));\r\n  }\r\n  return a;\r\n};\r\n\r\nexport class Stream {\r\n  data: any = null;\r\n  len: number = 0;\r\n  position: number = 0;\r\n\r\n  constructor(dataArray: ArrayBuffer) {\r\n    this.data = new Uint8Array(dataArray);\r\n    this.len = this.data.byteLength;\r\n    if (this.len === 0) {\r\n      throw new Error('No data loaded from file');\r\n    }\r\n  }\r\n\r\n  public readByte = () => {\r\n    if (this.position >= this.data.byteLength) {\r\n      throw new Error('Attempted to read past end of stream.');\r\n    }\r\n    return this.data[this.position++];\r\n  };\r\n\r\n  public readBytes = (n: number) => {\r\n    const bytes = [];\r\n    for (let i = 0; i < n; i++) {\r\n      bytes.push(this.readByte());\r\n    }\r\n    return bytes;\r\n  };\r\n\r\n  public read = (n: number) => {\r\n    let s = '';\r\n    for (let i = 0; i < n; i++) {\r\n      s += String.fromCharCode(this.readByte());\r\n    }\r\n    return s;\r\n  };\r\n\r\n  public readUnsigned = () => {\r\n    // Little-endian.\r\n    const a = this.readBytes(2);\r\n    return (a[1] << 8) + a[0];\r\n  };\r\n}\r\n\r\nconst lzwDecode = function (minCodeSize: number, data: any) {\r\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\r\n  let pos = 0; // Maybe this streaming thing should be merged with the Stream?\r\n\r\n  const readCode = function (size: number) {\r\n    let code = 0;\r\n    for (let i = 0; i < size; i++) {\r\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\r\n        code |= 1 << i;\r\n      }\r\n      pos++;\r\n    }\r\n    return code;\r\n  };\r\n\r\n  const output: any[] = [];\r\n\r\n  const clearCode = 1 << minCodeSize;\r\n  const eoiCode = clearCode + 1;\r\n\r\n  let codeSize = minCodeSize + 1;\r\n\r\n  let dict: any[] = [];\r\n\r\n  const clear = function () {\r\n    dict = [];\r\n    codeSize = minCodeSize + 1;\r\n    for (let i = 0; i < clearCode; i++) {\r\n      dict[i] = [i];\r\n    }\r\n    dict[clearCode] = [];\r\n    dict[eoiCode] = null;\r\n  };\r\n\r\n  let code;\r\n  let last;\r\n\r\n  while (true) {\r\n    last = code;\r\n    code = readCode(codeSize);\r\n    if (code === clearCode) {\r\n      clear();\r\n      continue;\r\n    }\r\n    if (code === eoiCode) {\r\n      break;\r\n    }\r\n\r\n    if (code < dict.length) {\r\n      if (last !== clearCode) {\r\n        dict.push(dict[last].concat(dict[code][0]));\r\n      }\r\n    } else {\r\n      if (code !== dict.length) {\r\n        throw new Error('Invalid LZW code.');\r\n      }\r\n      dict.push(dict[last].concat(dict[last][0]));\r\n    }\r\n    output.push.apply(output, dict[code]);\r\n\r\n    if (dict.length === 1 << codeSize && codeSize < 12) {\r\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\r\n      codeSize++;\r\n    }\r\n  }\r\n\r\n  // I don't know if this is technically an error, but some GIFs do it.\r\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\r\n  return output;\r\n};\r\n\r\n// The actual parsing; returns an object with properties.\r\nexport class ParseGif {\r\n  private _st: Stream = null;\r\n  private _handler: any = {};\r\n  private _transparentColor: Color = null;\r\n  public frames: GifFrame[] = [];\r\n  public images: HTMLImageElement[] = [];\r\n  public globalColorTable: any[] = [];\r\n  public checkBytes: number[] = [];\r\n\r\n  constructor(stream: Stream, color: Color = Color.Magenta) {\r\n    this._st = stream;\r\n    this._handler = {};\r\n    this._transparentColor = color;\r\n    this.parseHeader();\r\n    this.parseBlock();\r\n  }\r\n\r\n  // LZW (GIF-specific)\r\n  parseColorTable = (entries: any) => {\r\n    // Each entry is 3 bytes, for RGB.\r\n    const ct = [];\r\n    for (let i = 0; i < entries; i++) {\r\n      const rgb: number[] = this._st.readBytes(3);\r\n      const rgba =\r\n        '#' +\r\n        rgb\r\n          .map((x: any) => {\r\n            const hex = x.toString(16);\r\n            return hex.length === 1 ? '0' + hex : hex;\r\n          })\r\n          .join('');\r\n      ct.push(rgba);\r\n    }\r\n    return ct;\r\n  };\r\n\r\n  readSubBlocks = () => {\r\n    let size, data;\r\n    data = '';\r\n    do {\r\n      size = this._st.readByte();\r\n      data += this._st.read(size);\r\n    } while (size !== 0);\r\n    return data;\r\n  };\r\n\r\n  parseHeader = () => {\r\n    const hdr: any = {\r\n      sig: null,\r\n      ver: null,\r\n      width: null,\r\n      height: null,\r\n      colorRes: null,\r\n      globalColorTableSize: null,\r\n      gctFlag: null,\r\n      sorted: null,\r\n      globalColorTable: [],\r\n      bgColor: null,\r\n      pixelAspectRatio: null // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n    };\r\n\r\n    hdr.sig = this._st.read(3);\r\n    hdr.ver = this._st.read(3);\r\n    if (hdr.sig !== 'GIF') {\r\n      throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\r\n    }\r\n\r\n    hdr.width = this._st.readUnsigned();\r\n    hdr.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    hdr.gctFlag = bits.shift();\r\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\r\n    hdr.sorted = bits.shift();\r\n    hdr.globalColorTableSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    hdr.bgColor = this._st.readByte();\r\n    hdr.pixelAspectRatio = this._st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\r\n\r\n    if (hdr.gctFlag) {\r\n      hdr.globalColorTable = this.parseColorTable(1 << (hdr.globalColorTableSize + 1));\r\n      this.globalColorTable = hdr.globalColorTable;\r\n    }\r\n    if (this._handler.hdr && this._handler.hdr(hdr)) {\r\n      this.checkBytes.push(this._handler.hdr);\r\n    }\r\n  };\r\n\r\n  parseExt = (block: any) => {\r\n    const parseGCExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 4\r\n\r\n      const bits = byteToBitArr(this._st.readByte());\r\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\r\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\r\n      block.userInput = bits.shift();\r\n      block.transparencyGiven = bits.shift();\r\n\r\n      block.delayTime = this._st.readUnsigned();\r\n\r\n      block.transparencyIndex = this._st.readByte();\r\n\r\n      block.terminator = this._st.readByte();\r\n\r\n      if (this._handler.gce && this._handler.gce(block)) {\r\n        this.checkBytes.push(this._handler.gce);\r\n      }\r\n    };\r\n\r\n    const parseComExt = (block: any) => {\r\n      block.comment = this.readSubBlocks();\r\n      if (this._handler.com && this._handler.com(block)) {\r\n        this.checkBytes.push(this._handler.com);\r\n      }\r\n    };\r\n\r\n    const parsePTExt = (block: any) => {\r\n      this.checkBytes.push(this._st.readByte()); // Always 12\r\n      block.ptHeader = this._st.readBytes(12);\r\n      block.ptData = this.readSubBlocks();\r\n      if (this._handler.pte && this._handler.pte(block)) {\r\n        this.checkBytes.push(this._handler.pte);\r\n      }\r\n    };\r\n\r\n    const parseAppExt = (block: any) => {\r\n      const parseNetscapeExt = (block: any) => {\r\n        this.checkBytes.push(this._st.readByte()); // Always 3\r\n        block.unknown = this._st.readByte(); // Q: Always 1? What is this?\r\n        block.iterations = this._st.readUnsigned();\r\n        block.terminator = this._st.readByte();\r\n        if (this._handler.app && this._handler.app.NETSCAPE && this._handler.app.NETSCAPE(block)) {\r\n          this.checkBytes.push(this._handler.app);\r\n        }\r\n      };\r\n\r\n      const parseUnknownAppExt = (block: any) => {\r\n        block.appData = this.readSubBlocks();\r\n        // FIXME: This won't work if a handler wants to match on any identifier.\r\n        if (this._handler.app && this._handler.app[block.identifier] && this._handler.app[block.identifier](block)) {\r\n          this.checkBytes.push(this._handler.app[block.identifier]);\r\n        }\r\n      };\r\n\r\n      this.checkBytes.push(this._st.readByte()); // Always 11\r\n      block.identifier = this._st.read(8);\r\n      block.authCode = this._st.read(3);\r\n      switch (block.identifier) {\r\n        case 'NETSCAPE':\r\n          parseNetscapeExt(block);\r\n          break;\r\n        default:\r\n          parseUnknownAppExt(block);\r\n          break;\r\n      }\r\n    };\r\n\r\n    const parseUnknownExt = (block: any) => {\r\n      block.data = this.readSubBlocks();\r\n      if (this._handler.unknown && this._handler.unknown(block)) {\r\n        this.checkBytes.push(this._handler.unknown);\r\n      }\r\n    };\r\n\r\n    block.label = this._st.readByte();\r\n    switch (block.label) {\r\n      case 0xf9:\r\n        block.extType = 'gce';\r\n        parseGCExt(block);\r\n        break;\r\n      case 0xfe:\r\n        block.extType = 'com';\r\n        parseComExt(block);\r\n        break;\r\n      case 0x01:\r\n        block.extType = 'pte';\r\n        parsePTExt(block);\r\n        break;\r\n      case 0xff:\r\n        block.extType = 'app';\r\n        parseAppExt(block);\r\n        break;\r\n      default:\r\n        block.extType = 'unknown';\r\n        parseUnknownExt(block);\r\n        break;\r\n    }\r\n  };\r\n\r\n  parseImg = (img: any) => {\r\n    const deinterlace = (pixels: any, width: any) => {\r\n      // Of course this defeats the purpose of interlacing. And it's *probably*\r\n      // the least efficient way it's ever been implemented. But nevertheless...\r\n\r\n      const newPixels = new Array(pixels.length);\r\n      const rows = pixels.length / width;\r\n      const cpRow = (toRow: any, fromRow: any) => {\r\n        const fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\r\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\r\n      };\r\n\r\n      const offsets = [0, 4, 2, 1];\r\n      const steps = [8, 8, 4, 2];\r\n\r\n      let fromRow = 0;\r\n      for (let pass = 0; pass < 4; pass++) {\r\n        for (let toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\r\n          cpRow(toRow, fromRow);\r\n          fromRow++;\r\n        }\r\n      }\r\n\r\n      return newPixels;\r\n    };\r\n\r\n    img.leftPos = this._st.readUnsigned();\r\n    img.topPos = this._st.readUnsigned();\r\n    img.width = this._st.readUnsigned();\r\n    img.height = this._st.readUnsigned();\r\n\r\n    const bits = byteToBitArr(this._st.readByte());\r\n    img.lctFlag = bits.shift();\r\n    img.interlaced = bits.shift();\r\n    img.sorted = bits.shift();\r\n    img.reserved = bits.splice(0, 2);\r\n    img.lctSize = bitsToNum(bits.splice(0, 3));\r\n\r\n    if (img.lctFlag) {\r\n      img.lct = this.parseColorTable(1 << (img.lctSize + 1));\r\n    }\r\n\r\n    img.lzwMinCodeSize = this._st.readByte();\r\n\r\n    const lzwData = this.readSubBlocks();\r\n\r\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\r\n\r\n    if (img.interlaced) {\r\n      // Move\r\n      img.pixels = deinterlace(img.pixels, img.width);\r\n    }\r\n\r\n    this.frames.push(img);\r\n    this.arrayToImage(img);\r\n    if (this._handler.img && this._handler.img(img)) {\r\n      this.checkBytes.push(this._handler);\r\n    }\r\n  };\r\n\r\n  public parseBlock = () => {\r\n    const block = {\r\n      sentinel: this._st.readByte(),\r\n      type: ''\r\n    };\r\n    const blockChar = String.fromCharCode(block.sentinel);\r\n    switch (blockChar) {\r\n      case '!':\r\n        block.type = 'ext';\r\n        this.parseExt(block);\r\n        break;\r\n      case ',':\r\n        block.type = 'img';\r\n        this.parseImg(block);\r\n        break;\r\n      case ';':\r\n        block.type = 'eof';\r\n        if (this._handler.eof && this._handler.eof(block)) {\r\n          this.checkBytes.push(this._handler.eof);\r\n        }\r\n        break;\r\n      default:\r\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16));\r\n    }\r\n\r\n    if (block.type !== 'eof') {\r\n      this.parseBlock();\r\n    }\r\n  };\r\n\r\n  arrayToImage = (frame: GifFrame) => {\r\n    let count = 0;\r\n    const c = document.createElement('canvas');\r\n    c.id = count.toString();\r\n    c.width = frame.width;\r\n    c.height = frame.height;\r\n    count++;\r\n    const context = c.getContext('2d');\r\n    const pixSize = 1;\r\n    let y = 0;\r\n    let x = 0;\r\n    for (let i = 0; i < frame.pixels.length; i++) {\r\n      if (x % frame.width === 0) {\r\n        y++;\r\n        x = 0;\r\n      }\r\n      if (this.globalColorTable[frame.pixels[i]] === this._transparentColor.toHex()) {\r\n        context.fillStyle = `rgba(0, 0, 0, 0)`;\r\n      } else {\r\n        context.fillStyle = this.globalColorTable[frame.pixels[i]];\r\n      }\r\n\r\n      context.fillRect(x, y, pixSize, pixSize);\r\n      x++;\r\n    }\r\n    const img = new Image();\r\n    img.src = c.toDataURL();\r\n    this.images.push(img);\r\n  };\r\n}\r\n","import { Vector, vec } from '../Math/vector';\nimport { Raster, RasterOptions } from './Raster';\n\nexport interface PolygonOptions {\n  points: Vector[];\n}\n\n/**\n * A polygon [[Graphic]] for drawing arbitrary polygons to the [[ExcaliburGraphicsContext]]\n */\nexport class Polygon extends Raster {\n  private _points: Vector[];\n  public get points(): Vector[] {\n    return this._points;\n  }\n  public set points(points: Vector[]) {\n    this._points = points;\n    const min = this.minPoint;\n    this.width = this._points.reduce((max, p) => Math.max(p.x, max), 0) - min.x;\n    this.height = this._points.reduce((max, p) => Math.max(p.y, max), 0) - min.y;\n    this.flagDirty();\n  }\n\n  public get minPoint() {\n    const minX = this._points.reduce((min, p) => Math.min(p.x, min), Infinity);\n    const minY = this._points.reduce((min, p) => Math.min(p.y, min), Infinity);\n    return vec(minX, minY);\n  }\n\n  constructor(options: RasterOptions & PolygonOptions) {\n    super(options);\n    this.points = options.points;\n    this.rasterize();\n  }\n\n  public clone(): Polygon {\n    return new Polygon({\n      points: this.points.map((p) => p.clone()),\n      ...this.cloneGraphicOptions(),\n      ...this.cloneRasterOptions()\n    });\n  }\n\n  execute(ctx: CanvasRenderingContext2D): void {\n    if (this.points && this.points.length) {\n      ctx.beginPath();\n      // Iterate through the supplied points and construct a 'polygon'\n      const min = this.minPoint.negate();\n      const firstPoint = this.points[0].add(min);\n      ctx.moveTo(firstPoint.x, firstPoint.y);\n      this.points.forEach((point) => {\n        ctx.lineTo(point.x + min.x, point.y + min.y);\n      });\n      ctx.lineTo(firstPoint.x, firstPoint.y);\n      ctx.closePath();\n      if (this.color) {\n        ctx.fill();\n      }\n      if (this.strokeColor) {\n        ctx.stroke();\n      }\n    }\n  }\n}\n","import { obsolete } from './Decorators';\r\n\r\n/**\r\n * A sorted list implementation. NOTE: this implementation is not self-balancing\r\n * @deprecated WIll be removed in v0.26.0 Use built in JS array.sort\r\n */\r\n@obsolete({message: 'Will be removed in excalibur v0.26.0', alternateMethod: 'Use built in JS array.sort'})\r\nexport class SortedList<T> {\r\n  private _getComparable: (item: T) => number;\r\n  private _root: BinaryTreeNode<T>;\r\n\r\n  constructor(getComparable: (item: T) => number) {\r\n    this._getComparable = getComparable;\r\n  }\r\n\r\n  public find(element: T): boolean {\r\n    return this._find(this._root, element);\r\n  }\r\n\r\n  private _find(node: BinaryTreeNode<T>, element: any): boolean {\r\n    if (node == null) {\r\n      return false;\r\n    } else if (this._getComparable(element) === node.getKey()) {\r\n      if (node.getData().indexOf(element) > -1) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    } else if (this._getComparable(element) < node.getKey()) {\r\n      return this._find(node.getLeft(), element);\r\n    } else {\r\n      return this._find(node.getRight(), element);\r\n    }\r\n  }\r\n\r\n  // returns the array of elements at a specific key value\r\n  public get(key: number): any[] {\r\n    return this._get(this._root, key);\r\n  }\r\n\r\n  private _get(node: BinaryTreeNode<T>, key: number): any[] {\r\n    if (node == null) {\r\n      return [];\r\n    } else if (key === node.getKey()) {\r\n      return node.getData();\r\n    } else if (key < node.getKey()) {\r\n      return this._get(node.getLeft(), key);\r\n    } else {\r\n      return this._get(node.getRight(), key);\r\n    }\r\n  }\r\n\r\n  public add(element: T): boolean {\r\n    if (this._root == null) {\r\n      this._root = new BinaryTreeNode(this._getComparable(element), [element], null, null);\r\n      return true;\r\n    } else {\r\n      return this._insert(this._root, element);\r\n    }\r\n  }\r\n\r\n  private _insert(node: BinaryTreeNode<T>, element: T): boolean {\r\n    if (node != null) {\r\n      if (this._getComparable(element) === node.getKey()) {\r\n        if (node.getData().indexOf(element) > -1) {\r\n          return false; // the element we're trying to insert already exists\r\n        } else {\r\n          node.getData().push(element);\r\n          return true;\r\n        }\r\n      } else if (this._getComparable(element) < node.getKey()) {\r\n        if (node.getLeft() == null) {\r\n          node.setLeft(new BinaryTreeNode(this._getComparable(element), [element], null, null));\r\n          return true;\r\n        } else {\r\n          return this._insert(node.getLeft(), element);\r\n        }\r\n      } else {\r\n        if (node.getRight() == null) {\r\n          node.setRight(new BinaryTreeNode(this._getComparable(element), [element], null, null));\r\n          return true;\r\n        } else {\r\n          return this._insert(node.getRight(), element);\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public removeByComparable(element: T): void {\r\n    this._root = this._remove(this._root, element);\r\n  }\r\n\r\n  private _remove(node: BinaryTreeNode<T>, element: T): BinaryTreeNode<T> {\r\n    if (node == null) {\r\n      return null;\r\n    } else if (this._getComparable(element) === node.getKey()) {\r\n      const elementIndex = node.getData().indexOf(element);\r\n      // if the node contains the element, remove the element\r\n      if (elementIndex > -1) {\r\n        node.getData().splice(elementIndex, 1);\r\n        // if we have removed the last element at this node, remove the node\r\n        if (node.getData().length === 0) {\r\n          // if the node is a leaf\r\n          if (node.getLeft() == null && node.getRight() == null) {\r\n            return null;\r\n          } else if (node.getLeft() == null) {\r\n            return node.getRight();\r\n          } else if (node.getRight() == null) {\r\n            return node.getLeft();\r\n          }\r\n          // if node has 2 children\r\n          const temp = this._findMinNode(node.getRight());\r\n          node.setKey(temp.getKey());\r\n          node.setData(temp.getData());\r\n          node.setRight(this._cleanup(node.getRight(), temp)); //\"cleanup nodes\" (move them up recursively)\r\n          return node;\r\n        } else {\r\n          // this prevents the node from being removed since it still contains elements\r\n          return node;\r\n        }\r\n      }\r\n    } else if (this._getComparable(element) < node.getKey()) {\r\n      node.setLeft(this._remove(node.getLeft(), element));\r\n      return node;\r\n    } else {\r\n      node.setRight(this._remove(node.getRight(), element));\r\n      return node;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // called once we have successfully removed the element we wanted, recursively corrects the part of the tree below the removed node\r\n  private _cleanup(node: BinaryTreeNode<T>, element: BinaryTreeNode<T>): BinaryTreeNode<T> {\r\n    const comparable = element.getKey();\r\n    if (node == null) {\r\n      return null;\r\n    } else if (comparable === node.getKey()) {\r\n      // if the node is a leaf\r\n      if (node.getLeft() == null && node.getRight() == null) {\r\n        return null;\r\n      } else if (node.getLeft() == null) {\r\n        return node.getRight();\r\n      } else if (node.getRight() == null) {\r\n        return node.getLeft();\r\n      }\r\n      // if node has 2 children\r\n      const temp = this._findMinNode(node.getRight());\r\n      node.setKey(temp.getKey());\r\n      node.setData(temp.getData());\r\n\r\n      node.setRight(this._cleanup(node.getRight(), temp));\r\n      return node;\r\n    } else if (element.getKey() < node.getKey()) {\r\n      node.setLeft(this._cleanup(node.getLeft(), element));\r\n      return node;\r\n    } else {\r\n      node.setRight(this._cleanup(node.getRight(), element));\r\n      return node;\r\n    }\r\n  }\r\n\r\n  private _findMinNode(node: BinaryTreeNode<T>): BinaryTreeNode<T> {\r\n    let current = node;\r\n    while (current.getLeft() != null) {\r\n      current = current.getLeft();\r\n    }\r\n    return current;\r\n  }\r\n\r\n  public list(): Array<T> {\r\n    const results = new Array<T>();\r\n    this._list(this._root, results);\r\n    return results;\r\n  }\r\n\r\n  private _list(treeNode: BinaryTreeNode<T>, results: Array<T>): void {\r\n    if (treeNode != null) {\r\n      this._list(treeNode.getLeft(), results);\r\n      treeNode.getData().forEach((element) => {\r\n        results.push(element);\r\n      });\r\n      this._list(treeNode.getRight(), results);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * A tree node part of [[SortedList]]\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\n@obsolete({message: 'Will be removed in excalibur v0.26.0'})\r\nexport class BinaryTreeNode<T> {\r\n  private _key: number;\r\n  private _data: Array<T>;\r\n  private _left: BinaryTreeNode<T>;\r\n  private _right: BinaryTreeNode<T>;\r\n\r\n  constructor(key: number, data: Array<T>, left: BinaryTreeNode<T>, right: BinaryTreeNode<T>) {\r\n    this._key = key;\r\n    this._data = data;\r\n    this._left = left;\r\n    this._right = right;\r\n  }\r\n\r\n  public getKey(): number {\r\n    return this._key;\r\n  }\r\n\r\n  public setKey(key: number) {\r\n    this._key = key;\r\n  }\r\n\r\n  public getData(): T[] {\r\n    return this._data;\r\n  }\r\n\r\n  public setData(data: T[]) {\r\n    this._data = data;\r\n  }\r\n\r\n  public getLeft(): BinaryTreeNode<T> {\r\n    return this._left;\r\n  }\r\n\r\n  public setLeft(left: BinaryTreeNode<T>) {\r\n    this._left = left;\r\n  }\r\n\r\n  public getRight(): BinaryTreeNode<T> {\r\n    return this._right;\r\n  }\r\n\r\n  public setRight(right: BinaryTreeNode<T>) {\r\n    this._right = right;\r\n  }\r\n}\r\n\r\n/**\r\n * Mock element for testing\r\n *\r\n * @internal\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport class MockedElement {\r\n  private _key: number = 0;\r\n\r\n  constructor(key: number) {\r\n    this._key = key;\r\n  }\r\n\r\n  public getTheKey() {\r\n    return this._key;\r\n  }\r\n\r\n  public setKey(key: number) {\r\n    this._key = key;\r\n  }\r\n}\r\n","// Promises/A+ Spec http://promises-aplus.github.io/promises-spec/\r\n\r\nimport { obsolete } from './Util/Decorators';\r\n\r\n/**\r\n * Valid states for a promise to be in\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport enum PromiseState {\r\n  Resolved,\r\n  Rejected,\r\n  Pending\r\n}\r\n\r\n/**\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\nexport interface PromiseLike<T> {\r\n  then(successCallback?: (value?: T) => any, rejectCallback?: (value?: T) => any): PromiseLike<T>;\r\n  error(rejectCallback?: (value?: any) => any): PromiseLike<T>;\r\n\r\n  //Cannot define static methods on interfaces\r\n  //wrap<T>(value?: T): IPromise<T>;\r\n\r\n  resolve(value?: T): PromiseLike<T>;\r\n  reject(value?: any): PromiseLike<T>;\r\n\r\n  state(): PromiseState;\r\n}\r\n\r\n/**\r\n * Promises are used to do asynchronous work and they are useful for\r\n * creating a chain of actions. In Excalibur they are used for loading,\r\n * sounds, animation, actions, and more.\r\n * @deprecated Will be removed in v0.26.0\r\n */\r\n@obsolete({\r\n  message: 'ex.Promises are being replaced by native browser promises in v0.26.0',\r\n  alternateMethod: 'Use browser native promises'\r\n})\r\nexport class Promise<T> implements PromiseLike<T> {\r\n  private _state: PromiseState = PromiseState.Pending;\r\n  private _value: T;\r\n  private _successCallbacks: { (value?: T): any }[] = [];\r\n  private _rejectCallback: (value?: any) => any = () => {\r\n    return;\r\n  };\r\n  private _errorCallback: (value?: any) => any;\r\n\r\n  /**\r\n   * Create and resolve a Promise with an optional value\r\n   * @param value  An optional value to wrap in a resolved promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static resolve<T>(value?: T): Promise<T> {\r\n    const promise = new Promise<T>().resolve(value);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Create and reject a Promise with an optional value\r\n   * @param value  An optional value to wrap in a rejected promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static reject<T>(value?: T): Promise<T> {\r\n    const promise = new Promise<T>().reject(value);\r\n\r\n    return promise;\r\n  }\r\n\r\n  /**\r\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\r\n   * when at least 1 promise rejects.\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static join<T>(promises: Promise<T>[]): Promise<T>;\r\n\r\n  /**\r\n   * Returns a new promise that resolves when all the promises passed to it resolve, or rejects\r\n   * when at least 1 promise rejects.\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public static join<T>(...promises: Promise<T>[]): Promise<T>;\r\n\r\n  public static join<T>() {\r\n    let promises: Promise<T>[] = [];\r\n\r\n    if (arguments.length > 0 && !Array.isArray(arguments[0])) {\r\n      for (let _i = 0; _i < arguments.length; _i++) {\r\n        promises[_i - 0] = arguments[_i];\r\n      }\r\n    } else if (arguments.length === 1 && Array.isArray(arguments[0])) {\r\n      promises = arguments[0];\r\n    }\r\n\r\n    const joinedPromise = new Promise<T>();\r\n    if (!promises || !promises.length) {\r\n      return joinedPromise.resolve();\r\n    }\r\n\r\n    const total = promises.length;\r\n    let successes = 0;\r\n    let rejects = 0;\r\n    const errors: any = [];\r\n\r\n    promises.forEach((p) => {\r\n      p.then(\r\n        () => {\r\n          successes += 1;\r\n          if (successes === total) {\r\n            joinedPromise.resolve();\r\n          } else if (successes + rejects + errors.length === total) {\r\n            joinedPromise.reject(errors);\r\n          }\r\n        },\r\n        () => {\r\n          rejects += 1;\r\n          if (successes + rejects + errors.length === total) {\r\n            joinedPromise.reject(errors);\r\n          }\r\n        }\r\n      ).error((e) => {\r\n        errors.push(e);\r\n        if (errors.length + successes + rejects === total) {\r\n          joinedPromise.reject(errors);\r\n        }\r\n      });\r\n    });\r\n\r\n    return joinedPromise;\r\n  }\r\n\r\n  /**\r\n   * Chain success and reject callbacks after the promise is resolved\r\n   * @param successCallback  Call on resolution of promise\r\n   * @param rejectCallback   Call on rejection of promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public then(successCallback?: (value?: T) => any, rejectCallback?: (value?: any) => any) {\r\n    if (successCallback) {\r\n      this._successCallbacks.push(successCallback);\r\n\r\n      // If the promise is already resolved call immediately\r\n      if (this.state() === PromiseState.Resolved) {\r\n        try {\r\n          successCallback.call(this, this._value);\r\n        } catch (e) {\r\n          this._handleError(e);\r\n        }\r\n      }\r\n    }\r\n    if (rejectCallback) {\r\n      this._rejectCallback = rejectCallback;\r\n\r\n      // If the promise is already rejected call immediately\r\n      if (this.state() === PromiseState.Rejected) {\r\n        try {\r\n          rejectCallback.call(this, this._value);\r\n        } catch (e) {\r\n          this._handleError(e);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Add an error callback to the promise\r\n   * @param errorCallback  Call if there was an error in a callback\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public error(errorCallback?: (value?: any) => any) {\r\n    if (errorCallback) {\r\n      this._errorCallback = errorCallback;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Resolve the promise and pass an option value to the success callbacks\r\n   * @param value  Value to pass to the success callbacks\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public resolve(value?: T): Promise<T> {\r\n    if (this._state === PromiseState.Pending) {\r\n      this._value = value;\r\n      try {\r\n        this._state = PromiseState.Resolved;\r\n        this._successCallbacks.forEach((cb) => {\r\n          cb.call(this, this._value);\r\n        });\r\n      } catch (e) {\r\n        this._handleError(e);\r\n      }\r\n    } else {\r\n      throw new Error('Cannot resolve a promise that is not in a pending state!');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Reject the promise and pass an option value to the reject callbacks\r\n   * @param value  Value to pass to the reject callbacks\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public reject(value?: any) {\r\n    if (this._state === PromiseState.Pending) {\r\n      this._value = value;\r\n      try {\r\n        this._state = PromiseState.Rejected;\r\n        this._rejectCallback.call(this, this._value);\r\n      } catch (e) {\r\n        this._handleError(e);\r\n      }\r\n    } else {\r\n      throw new Error('Cannot reject a promise that is not in a pending state!');\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Inspect the current state of a promise\r\n   * @deprecated Use browser native promises\r\n   */\r\n  public state(): PromiseState {\r\n    return this._state;\r\n  }\r\n\r\n  private _handleError(e: any) {\r\n    if (this._errorCallback) {\r\n      this._errorCallback.call(this, e);\r\n    } else {\r\n      // rethrow error\r\n      throw e;\r\n    }\r\n  }\r\n}\r\n","/**\r\n * The current Excalibur version string\r\n * @description `process.env.__EX_VERSION` gets replaced by Webpack on build\r\n */\r\nexport const EX_VERSION = process.env.__EX_VERSION;\r\nimport { polyfill } from './Polyfill';\r\npolyfill();\r\n\r\n// This file is used as the bundle entry point and exports everything\r\n// that will be exposed as the `ex` global variable.\r\nexport * from './Flags';\r\nexport * from './Id';\r\nexport * from './Engine';\r\nexport * from './Screen';\r\nexport { Actor, ActorArgs } from './Actor';\r\nexport * from './Math/Index';\r\nexport * from './Camera';\r\nexport * from './Class';\r\nexport * from './Configurable';\r\nexport * from './Debug/index';\r\nexport * from './EventDispatcher';\r\nexport * from './Events/MediaEvents';\r\nexport * from './Events';\r\nexport * from './Label';\r\nexport { FontStyle, FontUnit, TextAlign, BaseAlign } from './Graphics/FontCommon';\r\nexport * from './Loader';\r\nexport { Particle, ParticleEmitter, ParticleArgs, ParticleEmitterArgs, EmitterType } from './Particles';\r\nexport * from './Collision/Physics';\r\nexport * from './Scene';\r\nexport { TileMap, Cell, TileMapArgs, CellArgs } from './TileMap';\r\nexport * from './Timer';\r\nexport * from './Trigger';\r\nexport * from './ScreenElement';\r\n\r\nexport * from './Actions/Index';\r\nexport * from './Collision/Index';\r\n\r\n// ex.LegacyDrawing namespace\r\nimport * as legacyDrawing from './Drawing/Index';\r\nexport { legacyDrawing as LegacyDrawing };\r\nexport * from './Interfaces/Index';\r\nexport * from './PostProcessing/Index';\r\nexport * from './Resources/Index';\r\n\r\nexport * from './EntityComponentSystem/index';\r\n\r\nexport * from './Color';\r\n\r\nexport * from './Graphics/index';\r\n\r\n// ex.Events namespace\r\nimport * as events from './Events';\r\nexport { events as Events };\r\n\r\n// ex.Input namespace\r\nimport * as input from './Input/Index';\r\nexport { input as Input };\r\n\r\n// ex.Traits namespace\r\nimport * as traits from './Traits/Index';\r\nexport { traits as Traits };\r\n\r\n// ex.Util namespaces\r\nimport * as util from './Util/Index';\r\nexport { util as Util };\r\nexport {\r\n  clamp,\r\n  range,\r\n  toDegrees,\r\n  toRadians,\r\n  randomInRange,\r\n  randomIntInRange,\r\n  canonicalizeAngle\r\n} from './Util/Index';\r\n\r\nexport * from './Util/Browser';\r\nexport * from './Util/Decorators';\r\nexport * from './Util/Detector';\r\nexport * from './Util/CullingBox';\r\nexport * from './Util/EasingFunctions';\r\nexport * from './Util/Observable';\r\nexport * from './Util/Log';\r\nexport * from './Util/SortedList';\r\nexport * from './Util/Pool';\r\n\r\n// ex.Deprecated\r\nexport * from './Promises';\r\n// import * as deprecated from './Deprecated';\r\n// export { deprecated as Deprecated };\r\n// export * from './Deprecated';\r\n"],"names":["entryUnbind","module","exports","path","Object","keys","isCallable","tryToString","argument","TypeError","isObject","String","toIndexedObject","toLength","toAbsoluteIndex","createMethod","IS_INCLUDES","$this","el","fromIndex","value","O","length","index","includes","indexOf","fails","METHOD_NAME","method","call","floor","Math","mergeSort","array","comparefn","middle","insertionSort","merge","slice","element","j","i","left","right","llength","rlength","lindex","rindex","result","push","toString","it","TO_STRING_TAG_SUPPORT","classofRaw","TO_STRING_TAG","wellKnownSymbol","CORRECT_ARGUMENTS","arguments","tag","undefined","key","error","tryGet","callee","has","ownKeys","getOwnPropertyDescriptorModule","definePropertyModule","target","source","defineProperty","f","getOwnPropertyDescriptor","DESCRIPTORS","createPropertyDescriptor","object","bitmap","enumerable","configurable","writable","get","global","document","EXISTS","createElement","firefox","match","UA","test","getBuiltIn","version","userAgent","process","Deno","versions","v8","split","webkit","bind","Function","CONSTRUCTOR","METHOD","prototype","createNonEnumerableProperty","redefine","setGlobal","copyConstructorProperties","isForced","options","targetProperty","sourceProperty","descriptor","TARGET","GLOBAL","STATIC","stat","noTargetGet","forced","sham","exec","aCallable","fn","that","a","b","c","apply","FunctionPrototype","getDescriptor","PROPER","name","CONFIGURABLE","aFunction","namespace","V","P","func","check","globalThis","window","self","g","this","toObject","hasOwnProperty","hasOwn","classof","propertyIsEnumerable","store","functionToString","inspectSource","set","NATIVE_WEAK_MAP","objectHas","shared","sharedKey","hiddenKeys","OBJECT_ALREADY_INITIALIZED","WeakMap","state","wmget","wmhas","wmset","metadata","facade","STATE","enforce","getterFor","TYPE","type","replacement","feature","detection","data","normalize","POLYFILL","NATIVE","string","replace","toLowerCase","USE_SYMBOL_AS_UID","$Symbol","V8_VERSION","getOwnPropertySymbols","symbol","Symbol","IE8_DOM_DEFINE","anObject","toPropertyKey","$defineProperty","Attributes","propertyIsEnumerableModule","$getOwnPropertyDescriptor","internalObjectKeys","concat","getOwnPropertyNames","names","enumBugKeys","$propertyIsEnumerable","NASHORN_BUG","input","pref","val","valueOf","getOwnPropertyNamesModule","getOwnPropertySymbolsModule","InternalStateModule","CONFIGURABLE_FUNCTION_NAME","getInternalState","enforceInternalState","TEMPLATE","unsafe","simple","join","uid","SHARED","IS_PURE","mode","copyright","toInteger","max","min","integer","IndexedObject","requireObjectCoercible","ceil","isNaN","isSymbol","getMethod","ordinaryToPrimitive","TO_PRIMITIVE","exoticToPrim","toPrimitive","id","postfix","random","NATIVE_SYMBOL","iterator","WellKnownSymbolsStore","createWellKnownSymbol","withoutSetter","$","internalSort","arrayMethodIsStrict","FF","IE_OR_EDGE","V8","WEBKIT","nativeSort","sort","FAILS_ON_UNDEFINED","FAILS_ON_NULL","STRICT_METHOD","STABLE_SORT","code","chr","fromCharCode","k","v","charAt","proto","itemsLength","items","arrayLength","x","y","getSortCompare","nativeKeys","___CSS_LOADER_EXPORT___","cssWithMappingToString","list","map","item","content","needLayer","modules","media","dedupe","supports","layer","alreadyImportedModules","_i","_i2","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","sourceMapping","sourceURLs","sources","sourceRoot","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","definition","o","e","obj","prop","r","toStringTag","Experiments","Legacy","LogLevel","polyfill","audioContext","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setInterval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","AudioContext","webkitAudioContext","replaceMe","decodeAudioData","arrayBuffer","Promise","resolve","reject","mozAudioContext","msAudioContext","oAudioContext","devicePixelRatio","Flags","static","_FROZEN","_FLAGS","enable","WebGL","Canvas","LegacyDrawing","flagName","Error","createId","Logger","constructor","_appenders","defaultLevel","Info","_INSTANCE","addAppender","ConsoleAppender","appender","clearAppenders","_log","level","args","len","log","debug","Debug","info","warn","Warn","fatal","Fatal","console","consoleArgs","unshift","ScreenAppender","width","height","_messages","_canvas","innerWidth","innerHeight","style","position","_ctx","getContext","body","appendChild","message","clearRect","pos","opacity","fillStyle","toFixed","fillText","BITMASK32","Random","seed","_lowerMask","_upperMask","_w","_n","_m","_a","_u","_s","_b","_t","_c","_l","_f","_mt","Array","Date","now","s","_index","_twist","mag01","nextInt","next","floating","bool","likelihood","pickOne","pickSet","numPicks","allowDuplicates","_pickSetWithDuplicates","_pickSetWithoutDuplicates","currentPick","tempArray","splice","shuffle","swap","randomIndex","range","d4","d6","d8","d10","d12","d20","Side","getOpposite","side","Top","Bottom","Left","Right","None","fromDirection","direction","directions","Vector","Up","Down","directionEnum","Number","MAX_VALUE","maxIndex","dot","TwoPI","PI","extend","extended","deep","assignExists","assign","base64Encode","inputStr","b64","outputStr","byte1","charCodeAt","byte2","byte3","enc1","enc2","enc3","enc4","nullish","nullishVal","defaultVal","clamp","randomInRange","randomIntInRange","round","canonicalizeAngle","angle","tmpAngle","toDegrees","radians","toRadians","degrees","getPosition","oLeft","oTop","calcOffsetLeft","parent","offsetLeft","offsetParent","calcOffsetTop","offsetTop","addItemToArray","removeItemFromArray","contains","getOppositeSide","getSideFromDirection","Collection","initialSize","DefaultSize","_internalArray","_endPointer","_resize","newSize","newArray","count","pop","clear","internalSize","elementAt","insert","remove","removed","removeElement","toArray","forEach","fail","from","to","_x","delay","milliseconds","setTimeout","maxMessages","obsoleteMessage","resetObsoleteCounter","logMessage","suppressObsoleteMessages","isEnabled","getInstance","trace","showStackTrace","obsolete","alternateMethod","showStackTrack","property","SyntaxError","DecoratedClass","super","_y","Zero","One","Half","cos","sin","vec","Infinity","vec1","vec2","sqrt","pow","setTo","equals","vector","tolerance","abs","distance","squareDistance","magnitude","size","newLength","scale","average","add","sizeOrScale","sub","addEqual","subEqual","scaleEqual","cross","num","perpendicular","normal","negate","toAngle","atan2","rotate","anchor","sinAngle","cosAngle","clone","fixed","MatrixLocations","Color","parseInt","parseFloat","hex","h","l","HSLColor","toRGBA","lighten","factor","temp","fromRGBA","darken","saturate","desaturate","multiply","color","newR","newG","newB","newA","mulitiply","screen","color1","invert","color2","equal","format","toHSLA","toHex","_componentToHex","Black","fromHex","White","Gray","LightGray","DarkGray","Yellow","Orange","Red","Vermilion","Vermillion","Rose","Magenta","Violet","Blue","Azure","Cyan","Viridian","Green","Chartreuse","Transparent","ExcaliburBlue","p","q","t","hue2rgb","BoundingBox","leftOrOptions","top","bottom","intersection","points","minX","minY","maxX","maxY","hasZeroDimensions","center","translate","point","getPoints","fromPoints","shifted","transform","matrix","multv","getPerimeter","results","rayCast","ray","farClipDistance","tmin","tmax","xinv","dir","yinv","tx1","tx2","ty1","ty2","rayCastTime","combine","other","dimensions","intersect","totalBoundingBox","overlapX","overlapY","intersectWithSide","bb","getSideFromIntersection","debugDraw","ctx","strokeStyle","strokeRect","draw","ex","drawRect","sign","Matrix","Float32Array","_scaleSignX","_scaleSignY","near","far","mat","identity","sx","sy","angleRadians","multm","dest","a11","a21","a31","a41","a12","a22","a32","a42","a13","a23","a33","a43","a14","a24","a34","a44","b11","b21","b31","b41","b12","b22","b32","b42","b13","b23","b33","b43","b14","b24","b34","b44","getScale","setPosition","sine","cosine","setRotation","currentScale","getRotation","getScaleY","getScaleX","xscale","yscale","setScaleX","setScaleY","setScale","getBasisDeterminant","getAffineInverse","inverseDet","m","tx","ty","isIdentity","TransformStack","_transforms","_currentTransform","save","restore","current","StateStack","_states","_currentState","_getDefaultState","_cloneState","Shader","_gl","_vertexSource","_fragmentSource","program","uniforms","attributes","layout","compile","_createProgram","gl","vertexShader","fragmentShader","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","_compileShader","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","VERTEX_SHADER","FRAGMENT_SHADER","addUniformMatrix","location","getUniformLocation","addUniformIntegerArray","addAttribute","glType","normalized","getAttribLocation","vertexAttributeSize","vertexSize","vert","totalVertexSizeBytes","typeSize","FLOAT","getAttributeSize","use","useProgram","offset","vertexAttribPointer","enableVertexAttribArray","uniform","uniformMatrix4fv","uniform1iv","BatchCommand","_pool","commands","isFull","canAdd","cmd","dispose","GraphicsDiagnostics","DrawCallCount","DrawnImagesCount","Pool","builder","recycler","maxObjects","totalAllocations","objects","_logger","using","context","done","borrow","poolIndex","BatchRenderer","priority","_buffer","_maxCommandsPerBatch","_batches","command","_verticesPerCommand","verticesPerCommand","maxCommandsPerBatch","batchFactory","_batchPool","init","buildShader","_vertices","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","addCommand","lastBatch","newBatch","render","drawCallCount","drawnImagesCount","batch","vertexCount","buildBatchVertices","bufferSubData","renderBatch","DrawLine","start","end","LineRenderer","_contextInfo","addLine","vertexBuffer","_batch","drawArrays","LINES","DrawCommandType","DrawImageCommand","image","swidth","sheight","dx","dy","dwidth","dheight","snapToPixel","Image","view","_geom","initRect","Rectangle","initLine","thickness","Line","halfThick","startTop","startBottom","endTop","endBottom","initCircle","radius","Circle","topLeft","topRight","bottomRight","bottomLeft","applyTransform","geometry","isPowerOfTwo","ensurePowerOfTwo","nextHighestPowerOfTwo","TextureLoader","_GL","_TEXTURE_MAP","forceUpdate","tex","bindTexture","TEXTURE_2D","toPowerOfTwoImage","texImage2D","RGBA","UNSIGNED_BYTE","createTexture","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","potCanvas","_POT_CANVAS","potCtx","_POT_CTX","imageSmoothingEnabled","drawImage","Map","BatchImage","maxDraws","maxTextures","textures","_graphicMap","_isCommandFull","_isTextureFull","_wouldAddTexture","maybeAdd","texture","load","bindTextures","activeTexture","TEXTURE0","getBatchTextureId","ImageRenderer","getParameter","MAX_TEXTURE_IMAGE_UNITS","registerContext","maxGPUTextures","_transformFragmentSource","_","newSource","texturePickerBuilder","addCircle","addRectangle","addImage","graphic","TRIANGLES","vertIndex","sw","sh","potWidth","potHeight","textureId","commandColor","uvx0","uvy0","uvx1","uvy1","DrawPoint","PointRenderer","getExtension","addPoint","POINTS","Graphic","_ID","showDebug","flipHorizontal","flipVertical","rotation","origin","_width","_height","cloneGraphicOptions","localBounds","fromDimension","_preDraw","_drawImage","_postDraw","_rotate","_flip","scaleDirX","scaleDirY","watch","change","__isProxy","Proxy","watchAny","Raster","_dirty","_smoothing","_color","flagDirty","_lineWidth","_lineDash","_padding","strokeColor","smoothing","lineWidth","lineDash","padding","_bitmap","bitmapWidth","bitmapHeight","maybeCtx","cloneRasterOptions","dirty","_getTotalWidth","_originalWidth","_getTotalHeight","_originalHeight","_strokeColor","rasterize","_applyRasterProperites","execute","setLineDash","getLineDash","_options","cache","EventTypes","GameEvent","_bubbles","bubbles","stopPropagation","KillEvent","PreKillEvent","PostKillEvent","GameStartEvent","GameStopEvent","PreDrawEvent","delta","PostDrawEvent","PreDebugDrawEvent","PostDebugDrawEvent","PreUpdateEvent","engine","PostUpdateEvent","PreFrameEvent","prevStats","PostFrameEvent","stats","GamepadConnectEvent","gamepad","GamepadDisconnectEvent","GamepadButtonEvent","button","GamepadAxisEvent","axis","SubscribeEvent","topic","handler","UnsubscribeEvent","VisibleEvent","HiddenEvent","PreCollisionEvent","actor","PostCollisionEvent","ContactStartEvent","contact","ContactEndEvent","CollisionPreSolveEvent","CollisionPostSolveEvent","CollisionStartEvent","CollisionEndEvent","InitializeEvent","ActivateEvent","oldScene","DeactivateEvent","newScene","ExitViewPortEvent","EnterViewPortEvent","EnterTriggerEvent","ExitTriggerEvent","EventDispatcher","_handlers","_wiredEventDispatchers","_target","emit","eventName","event","on","off","eventHandlers","once","ev","wire","eventDispatcher","unwire","Resource","responseType","bustCache","logger","events","isLoaded","_cacheBust","uri","request","XMLHttpRequest","open","addEventListener","status","response","statusText","send","Grayscale","updatePixel","imageData","firstPixel","pixel","avg","Invert","Opacity","Colorize","Lighten","fromRGB","Darken","Saturate","Desaturate","Fill","Texture","_sprite","loaded","_loadedResolve","_resource","url","blob","URL","createObjectURL","src","decode","naturalWidth","naturalHeight","asSprite","Configurable","base","props","filter","SpriteImpl","imageOrConfig","drawAroundAnchor","effects","_spriteCanvas","_spriteCtx","_pixelData","_pixelsLoaded","_dirtyEffect","_opacity","_initPixelsFromTexture","drawWidth","drawHeight","_loadPixels","_flushTexture","grayscale","addEffect","fill","colorize","effect","_applyEffects","removeEffect","param","indexToRemove","getImageData","putImageData","clearEffects","reset","xpoint","ypoint","ctxOrOptions","CanvasRenderingContext2D","_drawWithOptions","anchorX","anchorY","oldAlpha","globalAlpha","Sprite","sourceView","destSize","_updateSpriteDimensions","ready","then","nativeWidth","nativeHeight","sprite","ImageSource","fromLegacyTexture","endsWith","toSprite","unload","AnimationImpl","engineOrConfig","sprites","speed","loop","currentFrame","_timeLeftInFrame","_idempotencyToken","freezeFrame","Engine","config","_engine","_setAnchor","_setRotation","_setScale","isDone","tick","elapsed","idempotencyToken","_updateValues","skip","frames","animOptions","currSprite","play","playAnimation","images","FontUnit","TextAlign","BaseAlign","FontStyle","Direction","imageOrConfigOrSprites","columns","rows","spWidth","spHeight","spacing","_sprites","_image","_columns","_rows","_spWidth","_spHeight","_spacing","loadFromImage","isWidthError","isHeightError","RangeError","getSpacingDimensions","row","col","margin","getAnimationByIndices","indices","getAnimationBetween","beginIndex","endIndex","getAnimationForAll","getSprite","getAnimationByCoords","spriteCoordinates","maxWidth","maxHeight","coord","anim","SpriteFont","alphabet","caseInsensitive","_currentColor","_currentOpacity","_spriteRecord","_textShadowOn","_textShadowDirty","_textShadowColor","_textShadowSprites","_shadowOffsetX","_shadowOffsetY","getTextSprites","lookup","char","setTextShadow","offsetX","offsetY","shadowColor","character","useTextShadow","text","_parseOptions","characterShadow","fontSize","letterSpacing","currX","textAlign","Start","End","Center","currY","baseAlign","Hanging","Ideographic","Alphabetic","Middle","charSprite","SpriteSheet","spriteIndex","legacySpriteSheet","oldSprite","fromLegacySprite","spriteSheet","toLegacySprite","grid","cols","spriteWidth","spriteHeight","originOffset","offsetDefaults","marginDefaults","_text","shadow","_updateDimensions","spriteFont","_getCharacterSprites","textToRender","toLocaleLowerCase","letterIndex","letter","letterSprite","updateText","cursor","DebugText","fontSheet","_imageSource","_spriteSheet","fromImageSource","_spriteFont","write","ExcaliburGraphicsContextWebGLDebug","_webglCtx","_debugText","rectOptions","drawLine","lineOptions","__lineRenderer","drawPoint","pointOptions","__pointRenderer","drawText","ExcaliburGraphicsContextWebGL","_transform","_state","backgroundColor","canvasElement","enableTransparency","__gl","antialias","premultipliedAlpha","alpha","depth","powerPreference","_init","canvas","checkIfResolutionSupported","dim","maxDim","MAX_TEXTURE_SIZE","supported","_ortho","ortho","viewport","clearColor","COLOR_BUFFER_BIT","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","__imageRenderer","__ctx","resetTransform","updateViewport","drawRectangle","drawCircle","flush","DisplayMode","Resolution","SVGA","Standard","Atari2600","GameBoy","GameBoyAdvance","NintendoDS","NES","SNES","Screen","_antialiasing","_resolutionStack","_viewportStack","_pixelRatioOverride","_isFullScreen","_isDisposed","_fullscreenChangeHandler","_pixelRatioChangeHandler","_devicePixelRatio","_calculateDevicePixelRatio","applyResolutionAndViewport","_resizeHandler","_setResolutionAndViewportByDisplayMode","_alreadyWarned","resolution","_displayMode","displayMode","Fixed","antialiasing","_browser","browser","_position","pixelRatio","_applyDisplayMode","_mediaQueryList","nativeComponent","matchMedia","_resizeObserver","disconnect","removeEventListener","isHiDpi","FillContainer","FitContainer","parentElement","_resolution","_viewport","aspectRatio","scaledWidth","scaledHeight","setCurrentCamera","camera","_camera","pushResolutionAndViewport","peekViewport","peekResolution","popResolutionAndViewport","imageRendering","isSmooth","isFullScreen","goFullScreen","requestFullscreen","exitFullScreen","exitFullscreen","pageToScreenCoordinates","newX","newY","screenHeight","screenWidth","screenToPageCoordinates","screenMarginY","screenMarginX","screenToWorldCoordinates","halfDrawWidth","halfDrawHeight","worldToScreenCoordinates","screenX","screenY","pageToWorldCoordinates","worldToPageCoordinates","getWorldBounds","canvasWidth","halfCanvasWidth","canvasHeight","halfCanvasHeight","zoom","_computeFit","overflow","aspect","adjustedWidth","adjustedHeight","_computeFitContainer","clientWidth","clientHeight","Position","_initializeDisplayModePosition","Window","ResizeObserver","observe","FillScreen","FitScreen","display","specifiedPosition","marginTop","marginLeft","AudioContextFactory","WebAudio","_UNLOCKED","create","unlockTimeoutTimer","resume","buffer","createBufferSource","ended","connect","destination","onended","playbackState","isLegacyWebAudioSource","currentTime","PLAYING_STATE","FINISHED_STATE","clearTimeout","Class","eventObject","line","x1","y1","x2","y2","cap","beginPath","lineCap","moveTo","lineTo","closePath","stroke","arc","roundRect","br","tl","tr","bl","defaultRadius","quadraticCurveTo","circle","Loader","loadables","_resourceList","_playButtonShown","_resourceCount","_numLoaded","_progressCounts","_totalCounts","logo","logoWidth","logoHeight","loadingBarColor","suppressPlayButton","_playButtonStyles","playButtonText","startButtonFactory","buttonElement","getElementById","textContent","addResources","_imageElement","playButtonRootElement","_playButtonRootElement","playButtonElement","_playButtonElement","_playButton","existingRoot","_styleBlock","head","wireEngine","addResource","loadable","showPlayButton","hidePlayButton","resizeHandler","_positionPlayButton","evt","click","promise","startButtonHandler","removeChild","update","_delta","all","finally","unlock","markResourceComplete","progress","buttonWidth","buttonHeight","playButtonPosition","fillRect","logoY","logoX","logoPosition","imageHeight","oldAntialias","getAntialiasing","setAntialiasing","loadingX","loadingY","loadingBarPosition","progressWidth","REPORTED_FEATURES","webgl","webaudio","gamepadapi","Detector","_features","failedTests","_criticalTests","canvasSupport","elem","arrayBufferSupport","xhr","dataUrlSupport","toDataURL","objectUrlSupport","rgbaSupport","cssText","_warningTest","webAudioSupport","webglSupport","_loadBrowserFeatures","getBrowserFeatures","logBrowserFeatures","msg","arraybuffer","dataurl","objecturl","rgba","navigator","getGamepads","failedCritical","warning","CollisionType","CollisionResolutionStrategy","BroadphaseStrategy","Integrator","Physics","gravity","acc","collisionResolutionStrategy","Arcade","Realistic","dynamicTreeVelocityMultiplyer","dynamicTreeVelocityMultiplier","enabled","broadphaseStrategy","DynamicAABBTree","defaultMass","integrator","Euler","boundsPadding","positionIterations","velocityIterations","slop","steeringFactor","warmStart","bodiesCanSleepByDefault","surfaceEpsilon","sleepEpsilon","wakeThreshold","sleepBias","checkForFastBodies","disableMinimumSpeedForFastBody","VectorView","_getX","getX","_getY","getY","_setX","setX","_setY","setY","Component","owner","newComponent","TagComponent","CoordPlane","TransformComponent","X","Y","createPosView","_rotation","_scale","createScaleView","coordPlane","World","z","_recalculate","getGlobalMatrix","getGlobalTransform","globalPos","globalScale","globalRotation","parentTransform","globalScaleX","globalScaleY","applyInverse","MotionComponent","vel","scaleFactor","angularVelocity","torque","inertia","CollisionGroup","category","mask","_name","_category","_mask","canCollide","collisionGroups","combinedName","combinedCategory","reduce","All","Observable","observers","subscriptions","register","observer","subscribe","unregister","unsubscribe","notifyAll","notify","cb","Pair","colliderA","colliderB","calculatePairHash","bodyA","BodyComponent","bodyB","group","collisionType","PreventCollision","active","collide","hasCollider","collider","idA","idB","Projection","overlaps","projection","getOverlap","TreeNode","bounds","isLeaf","DynamicTree","worldBounds","root","nodes","_insert","leaf","leafAABB","currentRoot","area","combinedArea","cost","inheritanceCost","leftCost","leftCombined","newArea","oldArea","rightCost","rightCombined","oldParent","newParent","currentNode","_balance","_remove","grandParent","sibling","trackCollider","node","updateCollider","untrackCollider","multdx","multdy","balance","getHeight","query","helper","rayCastQuery","getNodes","Ray","numerator","begin","getSlope","divisor","u","getLength","intersectPoint","time","getPoint","DynamicTreeCollisionProcessor","_dynamicCollisionTree","_collisions","Set","_collisionPairCache","_colliders","getColliders","track","CompositeCollider","colliders","untrack","_shouldGenerateCollisionPair","hash","broadphase","targets","seconds","potentialColliders","pair","physics","pairs","Active","updateDistance","minDimension","fastBodies","updateVec","oldPos","centerPoint","furthestPoint","getFurthestPoint","minCollider","minTranslate","hitPoint","isValid","shift","fastBodyCollisions","narrowphase","contacts","newContacts","collisions","updated","Collider","touching","_collisionProcessor","_dynamicAABBTree","addCollider","clearColliders","removeCollider","worldPos","axes","furthestPoints","bestPoint","maxDistance","getInertia","mass","totalInertia","otherColliders","potentialCollider","getClosestLineBetween","lines","maybeLine","minLength","minLine","minPoint","minDistance","project","projs","proj","newProjection","slope","intercept","getEdge","midpoint","flip","below","clip","sideVector","clipTime","distanceToPoint","signed","x0","y0","findVectorToPoint","aMinusP","findPoint","hasPoint","currPoint","threshold","dxc","dyc","dx1","dy1","ClosestLine","p0","q0","w0","denom","sDenom","tDenom","tClosestParallel","sClosest","tClosest","ClosestLineJumpTable","PolygonPolygonClosestLine","polygonA","polygonB","otherWorldPos","otherDirection","thisDirection","rayTowardsOther","rayTowardsThis","thisPoint","otherPoint","thisFace","getClosestFace","otherFace","face","PolygonEdgeClosestLine","polygon","edge","edgeLine","asLine","PolygonCircleClosestLine","circlex","circley","CircleCircleClosestLine","circleA","circleB","CircleEdgeClosestLine","circleWorlPos","EdgeEdgeClosestLine","edgeA","edgeB","edgeLineA","edgeLineB","CircleCollider","orig","discriminant","toi","toi1","toi2","positiveToi","mintoi","shape","PolygonCollider","EdgeCollider","CollisionJumpTable","CollideCircleCircle","CollideCirclePolygon","CollideCircleEdge","getFurthestLocalPoint","bodyPos","scalars","dotProduct","newPos","CollisionContact","mtv","tangent","localPoints","_canceled","matchAwake","sleeping","sleepMotion","setSleeping","isCanceled","cancel","SeparatingAxis","polyA","polyB","bestSeparation","bestSide","bestAxis","bestSideIndex","bestOtherPoint","sides","getSides","localSides","getLocalSides","vertB","vertSeparation","separation","localSide","sideId","localPoint","polyDir","closestPointOnPoly","minOverlap","minAxis","minIndex","proj1","proj2","overlap","circleAPos","circleBPos","combinedRadius","mvt","local","findCirclePolygonSeparation","samedir","findSide","findLocalSide","cc","edgeWorld","asLocalLine","da","dda","db","ddb","den","pointOnEdge","dd","CollideEdgeEdge","CollidePolygonEdge","pc","linePoly","CollidePolygonPolygon","separationA","findPolygonPolygonSeparation","separationB","incident","reference","refDir","clipRight","clipLeft","xf","FindContactSeparation","shapeA","txA","shapeB","txB","worldPoint","circlePoint","dist","_getBodyPos","_getTransformedBegin","_getTransformedEnd","transformedBegin","transformedEnd","_boundsFromBeginEnd","edgeNormal","_transformedPoints","_axes","_sides","_localSides","winding","clockwiseWinding","reverse","_calculateTransformation","getTransformedPoints","currentSide","mostDirection","testRay","accum","pts","POSITIVE_INFINITY","faceIndex","denominator","iplusone","crossTerm","minContactTime","contactIndex","contactTime","scalar","effectiveOffset","firstPoint","Shape","Box","ColliderComponent","$colliderAdded","$colliderRemoved","_collider","flipped","onAdd","entity","precollision","postcollision","onRemove","useBoxCollider","usePolygonCollider","poly","Polygon","useCircleCollider","useEdgeCollider","Edge","useCompositeCollider","DegreeOfFreedom","dependencies","canSleep","_sleeping","bounciness","friction","useGravity","limitDegreeOfFreedom","oldVel","oldAcc","oldRotation","oldScale","inverseMass","updateMotion","currentMotion","bias","inverseInertia","motion","xFactor","yFactor","rx","applyImpulse","impulse","finalImpulse","Rotation","distanceFromCenter","applyLinearImpulse","applyAngularImpulse","captureOldTransform","CullingBox","_topLeft","_topRight","_bottomLeft","_bottomRight","isSpriteOffScreen","drawingWidth","currentDrawing","drawingHeight","getGlobalPos","topLeftScreen","topRightScreen","bottomLeftScreen","bottomRightScreen","_xCoords","_yCoords","_xMin","_yMin","_xMax","_yMax","minWorld","maxWorld","_xMinWorld","_yMinWorld","_xMaxWorld","_yMaxWorld","boundingPoints","rect","OffscreenCulling","cullingBox","actorBoundsOffscreen","currentScene","isOffScreen","removeComponent","addComponent","CapturePointer","enableCapturePointer","isKilled","pointers","checkAndUpdateActorUnderPointer","AddedComponent","isAddedComponent","RemovedComponent","isRemovedComponent","Entity","components","_componentsToRemove","_componentTypeToInstance","_componentStringToInstance","_tagsMemo","_typesMemo","componentAdded$","componentRemoved$","_parent","childrenAdded$","childrenRemoved$","_children","_isInitialized","_setName","component","kill","tags","hasTag","addTag","removeTag","force","types","_rebuildMemos","values","getComponents","_notifyAddComponent","added","_notifyRemoveComponent","children","unparent","addChild","getAncestors","removeAllChildren","getDescendants","queue","curr","newEntity","child","addTemplate","templateEntity","ctor","constuctorType","componentOrType","_removeComponentByType","delete","processComponentRemoval","isInitialized","_initialize","onInitialize","_preupdate","onPreUpdate","_postupdate","onPostUpdate","CanvasDrawComponent","hasGraphicsTick","GraphicsLayer","_graphics","graphics","hide","nameOrGraphic","gfx","getGraphic","show","copyGraphics","getNames","order","currentKeys","GraphicsLayers","_component","_layers","_layerMap","default","_maybeAddLayer","_getLayer","graphicsLayerKeys","GraphicsComponent","visible","_bounds","onPreDraw","onPostDraw","layers","graphicToSet","_radius","RotationType","EasingFunctions","easing","duration","CreateReversibleEasingFunction","Linear","startValue","endValue","EaseInQuad","EaseOutQuad","EaseInOutQuad","EaseInCubic","EaseOutCubic","EaseInOutCubic","ActionQueue","_actions","_completedActions","_entity","action","clearActions","_currentAction","stop","getActions","hasNext","isComplete","elapsedMs","Repeat","repeatBuilder","repeat","_stopped","_repeatBuilder","_repeatContext","ActionContext","_actionQueue","getQueue","_repeat","_originalRepeat","RepeatForever","MoveBy","_started","_tx","_motion","_speed","_offset","_start","_end","_distance","_dir","MoveTo","destx","desty","RotateTo","rotationType","_rotationType","ShortestPath","_currentNonCannonAngle","distance1","distance2","_shortDistance","_longDistance","_shortestPathIsPositive","_direction","LongestPath","Clockwise","CounterClockwise","distanceTravelled","RotateBy","angleRadiansOffset","ScaleTo","scaleX","scaleY","speedX","speedY","_endX","_endY","_speedX","_speedY","_startX","_startY","_distanceX","_distanceY","directionX","directionY","ScaleBy","scaleOffsetX","scaleOffsetY","_startScale","_endScale","_directionX","_directionY","CallMethod","_method","_hasBeenCalled","EaseTo","easingFcn","_currentLerpTime","_lerpDuration","_lerpStart","_lerpEnd","_initialized","Blink","timeVisible","timeNotVisible","numBlinks","_timeVisible","_timeNotVisible","_elapsedTime","_totalTime","_duration","Fade","endOpacity","_multiplier","_endOpacity","Delay","_delay","Die","ActionsComponent","Follow","entityToFollow","followDistance","_followTx","_followMotion","_current","_maximumDistance","_distanceBetween","actorToFollowSpeed","Meet","actorToMeet","_speedWasSpecified","_meetTx","_meetMotion","actorToMeetSpeed","_queue","easeTo","xOrPos","yOrSpeed","speedOrUndefined","moveBy","xOffsetOrVector","yOffsetOrSpeed","xOffset","yOffset","rotateTo","rotateBy","scaleTo","sizeXOrVector","sizeYOrSpeed","speedXOrUndefined","speedYOrUndefined","sizeX","sizeY","scaleBy","sizeOffsetXOrVector","sizeOffsetYOrSpeed","sizeOffsetX","sizeOffsetY","blink","fade","die","callMethod","times","repeatForever","follow","meet","asPromise","toPromise","Actor","_anchor","_handleAnchorChange","scene","_draggable","_dragging","_pointerDragStartHandler","_pointerDragEndHandler","_pointerDragMoveHandler","pe","pointer","lastWorldPos","_pointerDragLeaveHandler","traits","capturePointer","captureMoveEvents","captureDragEvents","_capturePointerEvents","_captureMoveEvents","_captureDragEvents","collisionGroup","defaults","Passive","actions","thePos","theVel","theAcc","theAngle","isVisible","draggable","isDraggable","_checkForPointerOptIn","_prekill","_scene","onPreKill","_postkill","onPostKill","unkill","setDrawing","addDrawing","getZIndex","newZ","setZIndex","newIndex","getGlobalScale","getGlobalRotation","recurse","geom","containment","some","within","otherCollider","me","drawing","currFrame","trait","_predraw","_postdraw","useWorld","coords","Timer","fcn","interval","repeats","numberOfRepeats","_totalTimeAlive","_running","_numberOfTicks","maxNumberOfRepeats","_complete","_MAX_ID","_callbacks","complete","newInterval","newNumberOfRepeats","timesRepeated","getTimeRunning","timeToNextAction","timeElapsedTowardNextAction","isRunning","pause","unpause","cancelTimer","Axis","TileMapImpl","xOrConfig","cellWidth","cellHeight","_token","_onScreenXStart","_onScreenXEnd","_onScreenYStart","_onScreenYEnd","_spriteSheets","_legacySpriteMap","_cols","isOffscreen","_composite","currentCol","cd","Cell","registerSpriteSheet","_updateColliders","tile","solid","prev","getCellByIndex","getCell","getCellByPoint","cell","getRows","getColumns","worldCoordsUpperLeft","worldCoordsLowerRight","xEnd","yEnd","graphicsIndex","graphicsLen","TileMap","CellImpl","_solid","pushSprite","addGraphic","removeGraphic","clearGraphics","StrategyContainer","lockToActor","addStrategy","LockCameraToActorStrategy","lockToActorAxis","LockCameraToActorAxisStrategy","elasticToActor","cameraElasticity","cameraFriction","ElasticToActorStrategy","radiusAroundActor","RadiusAroundActorStrategy","limitCameraBounds","box","LimitCameraBoundsStrategy","_cam","_eng","cam","currentFocus","getFocus","focus","cameraVel","stretch","boundSizeChecked","focusX","focusY","Camera","_cameraStrategies","strategy","_z","dz","az","_posChanged","_pos","_cameraMoving","_isShaking","_shakeMagnitudeX","_shakeMagnitudeY","_shakeDuration","_elapsedShakeTime","_xShake","_yShake","_isZooming","_zoomStart","_zoomEnd","_currentZoomTime","_zoomDuration","_zoomEasing","_easing","_halfWidth","_halfHeight","_follow","ax","ay","move","easingFn","_lerpPromise","_lerpResolve","shake","magnitudeX","magnitudeY","zoomOverTime","_zoomPromise","_zoomResolve","cameraStrategy","removeStrategy","clearAllStrategies","currentRes","loadingComplete","res","newZoom","zoomEasing","lerpPoint","CreateVectorEasingFunction","moveEasing","_isDoneShaking","newCanvasWidth","newCanvasHeight","isScreenElement","triggerDefaults","opts","_dispatchAction","wp","SystemType","System","_entityAddedOrRemoved","AddedEntity","isAddedSystemEntity","RemovedEntity","isRemoveSystemEntity","EntityManager","_world","entities","_entityIndex","_entitiesToRemove","updateEntities","_context","removeEntity","findEntitiesForRemoval","queryManager","addEntity","idOrEntity","deferred","actors","killed","processEntityRemovals","processComponentRemovals","getById","getByName","buildTypeKey","localeCompare","Query","_entities","T","_key","getEntities","matches","typesOrEntity","contain","QueryManager","_queries","_addQuery","entityManager","maybeRemoveQuery","queryType","createQuery","maybeExistingQuery","getQuery","SystemManager","systems","initialized","systemType","find","addSystem","system","initialize","removeSystem","updateSystems","preupdate","Scene","postupdate","systemManager","Update","entityOrSystem","clearEntities","clearSystems","EulerIntegrator","totalAcc","MotionSystem","optionalBody","integrate","CollisionSolver","solve","preSolve","solveVelocity","solvePosition","postSolve","ArcadeSolver","opposite","velAdj","ContactConstraintPoint","normalImpulse","tangentImpulse","normalMass","tangentMass","aToContact","bToContact","aToContactNormal","bToContactNormal","aToContactTangent","bToContactTangent","getRelativeVelocity","velA","RealisticSolver","lastFrameContacts","idToContactConstraint","getContactConstraints","finishedContactIds","contactPoints","pointIndex","constraints","maxCorrection","steeringForce","restitution","impulseDelta","maxFriction","newImpulse","CollisionSystem","_realisticSolver","_arcadeSolver","_processor","_lastFrameContacts","_currentFrameContacts","_trackCollider","_untrackCollider","colliderComponent","colliderComp","getSolver","runContactStartEnd","AnimationDirection","AnimationStrategy","EmitterType","Animation","Loop","frameDuration","timeScale","_firstTick","_currentFrame","_done","_playing","_reversed","totalDuration","goToFrame","frameIndices","durationPerFrameMs","invalidIndices","_LOGGER","animation","legacySprites","Freeze","currentFrameIndex","isPlaying","Backward","Forward","canFinish","frameNumber","maybeFrame","_nextFrame","PingPong","elapsedMilliseconds","GraphicsGroup","members","_isAnimationOrGroup","member","maybeAnimation","ParticleImpl","emitterOrConfig","life","beginColor","endColor","velocity","acceleration","startSize","endSize","particleRotationalVelocity","currentRotation","focusAccel","fadeFlag","_rRate","_gRate","_bRate","_aRate","emitter","particleSize","particleSprite","sizeRate","elapsedMultiplier","ParticleEmitter","tmpColor","removeParticle","accel","Particle","_particlesToEmit","numParticles","isEmitting","particles","deadParticles","minVel","maxVel","minAngle","maxAngle","emitRate","particleLife","minSize","maxSize","_og","emitterType","randomRotation","particle","emitParticles","particleCount","_createParticle","world","clearParticles","ranX","ranY","GraphicsSystem","Draw","_graphicsContext","graphicsContext","_clearScreen","entityOffscreen","_isOffscreen","_pushCameraTransform","_applyTransform","particleOpacity","_drawGraphicsComponent","_popCameraTransform","drawnImages","drawCalls","graphicsComponent","isDebug","showBounds","boundsColor","ancestors","ancestor","CanvasDrawingSystem","canvasdraw","offscreen","DebugSystem","_collisionSystem","filterSettings","entitySettings","txSettings","motionSettings","colliderSettings","physicsSettings","graphicsSettings","bodySettings","cameraSettings","useFilter","ids","nameQuery","lineHeight","showAll","showPosition","positionColor","showId","showName","showRotation","fromAngle","rotationColor","showScale","scaleColor","showCollisionGroup","showCollisionType","showMass","showMotion","showSleeping","showVelocity","velocityColor","showAcceleration","accelerationColor","showGeometry","geometryColor","showOwner","showBroadphaseSpacePartitionDebug","showCollisionContacts","showCollisionNormals","collisionContactColor","collisionNormalColor","showFocus","focusColor","showZoom","ActionsSystem","ColorBlindness","Keys","PointerType","PointerScope","NativePointerButton","PointerButton","WheelDeltaMode","_timers","_cancelQueue","triggers","tileMaps","screenElements","onActivate","_oldScene","_newScene","onDeactivate","_initializeChildren","_activate","_deactivate","removeTimer","timer","_collectActorStats","dispatchPointerEvents","addTimer","addScreenElement","removeScreenElement","addTileMap","tileMap","removeTileMap","isTimerActive","isCurrentScene","_ui","ui","alive","ColorBlindCorrector","simulate","colorMode","Protanope","_vertexShader","_fragmentShader","_internalCanvas","preserveDrawingBuffer","_program","_getShader","_getFragmentShaderByMode","vertextShader","Deuteranope","Tritanope","_setRectangle","STATIC_DRAW","out","positionLocation","texCoordLocation","texCoordBuffer","pixelStorei","UNPACK_FLIP_Y_WEBGL","resolutionLocation","uniform2f","positionBuffer","pixelData","Uint8Array","readPixels","ColorBlindFlags","correct","colorBlindness","postProcessors","FrameStats","prevFrame","colorBlindMode","_id","_fps","_actorStats","remaining","total","_durationStats","_physicsStats","PhysicsStats","_graphicsStats","otherStats","fps","fs","_pairs","_contacts","_fastBodies","_fastBodyCollisions","_broadphase","_narrowphase","ps","KeyEvent","originalEvent","Keyboard","_keys","_keysUp","_keysDown","noop","keyEvent","getKeys","wasPressed","isHeld","wasReleased","Pointer","_isDown","_wasDown","_actorsUnderPointer","_actors","_actorsLastFrame","_actorsNoLongerUnderPointer","_actorSortingFcn","lastPagePos","lastScreenPos","dragTarget","_onPointerMove","_onPointerDown","_onPointerUp","isDragging","isDragStart","isDragEnd","hasActorsUnderPointer","addActorUnderPointer","isActorAliveUnderPointer","removeActorUnderPointer","getActorsUnderPointer","getActorsUnderPointerLastFrame","getActorsForEvents","checkActorUnderPointer","wasActorUnderPointer","pagePos","screenPos","_ev","PointerEvent","coordinates","pointerType","propagate","doAction","_onActionStart","_onActionEnd","_actor","PointerEventFactory","_pointerEventType","PointerDragEvent","PointerUpEvent","PointerDownEvent","PointerMoveEvent","PointerEnterEvent","PointerLeaveEvent","PointerCancelEvent","WheelEvent","pageX","pageY","deltaX","deltaY","deltaZ","deltaMode","_isCanceled","createPointerEventByName","factory","GlobalCoordinates","yOrEngine","engineOrUndefined","ScrollWheelNormalizationFactor","Pointers","_pointerDown","_pointerUp","_pointerMove","_pointerCancel","_wheel","_pointers","_activePointers","primary","_handleTouchEvent","touchAction","_handlePointerEvent","MSPointerEvent","msTouchAction","_handleMouseEvent","wheelOptions","passive","pageScrollPreventionMode","ScrollPreventionMode","_handleWheelEvent","onmousewheel","triggerEvent","pointerId","eventish","preventDefault","at","_dispatchWithBubble","_dispatchPointerLeaveEvents","lastMoveEventPerPointerPerActor","pointerLeave","_dispatchPointerEnterEvents","lastMoveEventPerPointer","pointerEnter","_propagateWheelPointerEvent","wheelEvent","eventArr","fromPagePosition","Mouse","_nativeButtonToPointerButton","changedTouches","_getPointerIndex","identifier","Touch","Unknown","_stringToPointerType","wheelDeltaX","wheelDeltaY","wheelDelta","detail","Pixel","Page","we","idx","NoButton","Pen","Gamepads","_gamePadTimeStamps","_oldPads","_pads","_initSuccess","_navigator","_minimumConfiguration","_clonePads","setMinimumGamepadConfiguration","_enableAndUpdate","_isGamepadValid","pad","axesLength","buttonLength","buttons","connected","gamepads","timestamp","bi","ai","navigatorGamepad","Buttons","getButton","pressed","updateButton","Axes","getAxes","updateAxes","_clonePad","Gamepad","getValidGamepads","pads","arr","clonedPad","MinAxisMoveThreshold","_buttons","isButtonPressed","buttonIndex","axesIndex","BrowserComponent","_paused","_nativeHandlers","_decorate","BrowserEvents","_windowGlobal","_documentGlobal","_windowComponent","_documentComponent","ExcaliburGraphicsContext2DCanvasDebug","_ex","ExcaliburGraphicsContext2DCanvas","_hasStarted","scenes","_animations","_suppressPlayButton","pauseAudioWhenHidden","_isDebug","debugColor","enableCanvasTransparency","onFatalException","_timescale","_isLoading","_deferredGoTo","_loadingComplete","_DEFAULT_ENGINE_OPTIONS","freeze","detector","suppressMinimumBrowserFeatureDetection","_compatible","innerText","testMessage","canvasElementId","suppressConsoleBootMessage","EX_VERSION","ex2dCtx","exWebglCtx","suppressHiDPIScaling","_loader","rootScene","addScene","isFullscreen","timescale","AnimationNode","removeScene","goToScene","hidden","visibilityChange","scrollPreventionMode","keyboard","pointerScope","_overrideInitialize","_update","_draw","font","toggle","toggleDebug","loader","createMainLoop","game","raf","nowFn","lastTime","mainloop","_requestId","frameId","beforeUpdate","afterUpdate","afterDraw","isPaused","screenshot","raw","MediaEvent","_value","_path","_val","layPath","NativeSoundEvent","NativeSoundProcessedEvent","_processedData","Font","quality","family","Normal","bold","unit","Px","LeftToRight","_textBounds","_textWidth","_textHeight","blur","fontString","numLines","_lines","_rasterWidth","_rasterHeight","_halfRasterWidth","_halfRasterHeight","_applyFont","maxWidthLine","metrics","measureText","actualBoundingBoxLeft","actualBoundingBoxRight","actualBoundingBoxAscent","actualBoundingBoxDescent","lineAdjustedHeight","bottomBounds","textBaseline","shadowBlur","shadowOffsetX","shadowOffsetY","strokeText","Text","_font","isBold","fontFamily","sizeInUnit","fontStyle","fontUnit","align","_legacySpriteFont","sf","getTextWidth","clearTextShadow","exctx","CollisionGroupManager","_CURRENT_GROUP","_MAX_GROUPS","_GROUPS","_CURRENT_BIT","groups","_STARTING_BIT","filled","_points","fillColor","lineColor","ExResponse","has_initialize","hasOnInitialize","has_preupdate","hasOnPreUpdate","has_postupdate","hasOnPostUpdate","hasPreDraw","hasPostDraw","any","json","WebAudioInstance","_src","_volume","_loop","_isPlaying","_isPaused","_audioContext","_volumeNode","createGain","_currentOffset","_createNewBufferSource","_instance","_wireUpOnEnded","volume","gain","setTargetAtTime","_playbackRate","playbackRate","playStarted","_resumePlayBack","_startPlayBack","_playingPromise","_setPauseOffset","_handleOnEnded","_playingResolve","_rememberStartTime","restartTime","amend","_startTime","getTime","setValueAtTime","canPlayFile","file","Audio","filetype","canPlayType","Sound","paths","_isStopped","_tracks","_wasPlayingOnHidden","instances","audiobuffer","decodeAudio","instanceCount","_resumePlayback","_startPlayback","getTrackId","resumed","_getTrackInstance","newTrack","Gif","_stream","_gif","_textures","_animation","_transparentColor","Stream","ParseGif","toLegacySpriteSheet","toSpriteSheet","toLegacyAnimation","toAnimation","fromSpriteSheet","readCheckBytes","checkBytes","bitsToNum","ba","byteToBitArr","bite","dataArray","readByte","byteLength","readBytes","bytes","read","readUnsigned","stream","_st","_handler","globalColorTable","parseColorTable","entries","ct","readSubBlocks","parseHeader","hdr","sig","ver","colorRes","globalColorTableSize","gctFlag","sorted","bgColor","pixelAspectRatio","bits","parseExt","block","parseGCExt","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","authCode","parseUnknownExt","label","extType","parseImg","img","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","pixels","minCodeSize","readCode","output","clearCode","eoiCode","codeSize","dict","last","lzwDecode","newPixels","cpRow","toRow","fromRow","fromPixels","offsets","steps","pass","deinterlace","arrayToImage","parseBlock","sentinel","eof","frame","SortedList","getComparable","_getComparable","_find","_root","getKey","getData","getLeft","getRight","_get","BinaryTreeNode","setLeft","setRight","removeByComparable","elementIndex","_findMinNode","setKey","setData","_cleanup","comparable","_list","treeNode","_data","_left","_right","MockedElement","getTheKey","PromiseState","Pending","_successCallbacks","_rejectCallback","promises","isArray","joinedPromise","successes","rejects","errors","successCallback","rejectCallback","Resolved","_handleError","Rejected","errorCallback","_errorCallback"],"sourceRoot":""}